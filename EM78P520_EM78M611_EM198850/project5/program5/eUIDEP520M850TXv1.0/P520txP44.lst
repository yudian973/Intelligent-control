     1                     /*****************************************************************
     2                     * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3                     * Author       :  yu.wei
     4                     * Company      :  ELAN
     5                     * VERSION      :  1.1
     6                     * CRYSTAL      :  8MHZ
     7                     * Creat date   :  2009/11/4
     8                     * tool ver.    :  WicePlus 2.7/eUIDE
     9                     * Description  :  modify for code conformity
    10                     *****************************************************************/
    11                     ;-----------------------------------------------------------------
    12                     include "D:\include\EM78xx\EM78P520.H"
     1            C        ;******************************************************;
     2            C        ;                                                      ;
     3            C        ;  Tilte:       EM78x510xx include file                ;
     4            C        ;  Description: The Definition of EM78x510xx Registers ;
     5            C        ;  Company:     Elan Electronic Corp.                  ;
     6            C        ;  Author:      hongxi.tang                            ;
     7            C        ;  Date:        24/05/2006                             ;
     8            C        ;  Version:     v1.0                                   ;
     9            C        ;                                                      ;
    10            C        ;******************************************************;
    11            C        ;
    12            C        ;======================================================;
    13            C        ; Operational Registers Define                         ;
    14            C        ;======================================================;
    15            C        EM78P520.H    EQU    EM78P520.H
    16            C        
    17            C        ;
    18            C        ;======================================================;
    19            C        ; Register R0~R4                                       ;
    20            C        ;======================================================;
    21            C        ;
    22            C        ; Indirect Addressing register
    23            C        ;
    24       0000 C         R0     ==    0x00
    25       0000 C         IAR    ==    0x00
    26            C        ;
    27            C        ; Time Clock/Counter
    28            C        ;
    29       0001 C         R1     ==    0x01
    30       0001 C         TCC    ==    0x01    ; TCC Counter Preset
    31            C        ;
    32            C        ; Program Counter
    33            C        ;
    34       0002 C         R2     ==    0X02
    35       0002 C         PC     ==    0X02
    36            C        ;
    37            C        ; Status Register and Voltage Detect
    38            C        ;
    39       0003 C         R3    ==    0X03
    40       0003 C         SR    ==    0X03
    41       0003 C         STATUS	==	0x03
    42            C        ;
    43            C             ;{
    44       0007 C             	 LVDEN	==    0x07    ; Voltage Detect Enable Bit
    45       0006 C                 LVDS1	==    0x06    ; Detect Voltage Select Bit[1]
    46       0005 C                 LVDS0	==    0x05    ; Detect Voltage Select Bit[0]
    47            C                                       ;
    48            C                                       ; |-------|-------|----------------|
    49            C                                       ; | LVDS1 | LVDS0 | Detect Voltage |
    50            C                                       ; |-------|-------|----------------|
    51            C                                       ; |   0   |   0   |      2.4V      |
    52            C                                       ; |   0   |   1   |      2.7V      |
    53            C                                       ; |   1   |   0   |      3.3V      |
    54            C                                       ; |   1   |   1   |      3.9V      |
    55            C                                       ; |-------|-------|----------------|
    56            C                                       ;
    57       0004 C                 T       ==    0x04    ; Time-Out Bit
    58       0003 C                 P       ==    0x03    ; Power Down Bit
    59       0002 C                 Z       ==    0x02    ; Zero Flag
    60       0001 C                 DC      ==    0x01    ; Auxiliary Carry Flag
    61       0000 C                 C       ==    0x00    ; Carry Flag
    62            C                                       ;
    63            C             ;}
    64            C        ;
    65            C        ; RAM Select Register (RSR)
    66            C        ;
    67       0004 C         R4     ==    0X04
    68       0004 C         RSR    ==    0X04
    69            C             ;{
    70            C                                        ; Bits 5~0 are used to select up to 64 registers in the
    71            C                                        ; indirect addressing mode.
    72            C                                        ;
    73       0007 C                 VDB	  ==    0x07    ; Voltage Detector
    74       0006 C                 BNC      ==    0x06    ; Bank Control Register
    75            C                                        ;
    76       0005 C                 RSR5     ==    0x05    ;
    77       0004 C                 RSR4     ==    0x04    ;
    78       0003 C                 RSR3     ==    0x03    ;
    79       0002 C                 RSR2     ==    0x02    ;
    80       0001 C                 RSR1     ==    0x01    ;
    81       0000 C                 RSR0     ==    0x00    ;
    82            C                                        ;
    83            C             ;}
    84            C        ;======================================================;
    85            C        ; Bank0~6 Register R5~RF                               ;
    86            C        ;======================================================;
    87            C        ;
    88            C        ; Bank0 R5(RAM Bank Select Register)
    89            C        ;
    90       0005 C         B0_R5    ==	0X05
    91       0005 C         BSR      ==    0X05
    92            C        ;
    93            C             ;{
    94            C             				    ; Bit3~7 is "0"
    95       0002 C                 BS2          ==    0x02    ; RAM Bank Select Register Bits[2]
    96       0001 C                 BS1          ==    0x01    ; RAM Bank Select Register Bits[1]
    97       0000 C                 BS0          ==    0x00    ; RAM Bank Select Register Bits[0]
    98            C             ;}
    99            C        ;
   100            C        ; Bank 0 R6(Program Page Select Register)
   101            C        ;
   102       0006 C         B0_R6    ==    0X06
   103       0006 C         PSR      ==    0X06
   104            C        ;
   105            C             ;{
   106            C             			       ; Bit3~7 is "0"
   107       0002 C                 PS2     ==    0x02    ; Program Page Select Register Bits[2]
   108       0001 C                 PS1     ==    0x01    ; Program Page Select Register Bits[1]
   109       0000 C                 PS0     ==    0x00    ; Program Page Select Register Bits[0]
   110            C             ;}
   111            C        ;
   112            C        ; Bank0 R7(Port 7 data Register)
   113            C        ;
   114       0007 C         B0_R7    ==    0X07
   115       0007 C         PORT7    ==    0X07
   116            C        ;
   117            C             ;{
   118       0007 C                 R77     ==    0x07    ; I/O data of P7.7
   119       0006 C                 R76     ==    0x06    ; I/O data of P7.6
   120       0005 C                 R75     ==    0x05    ; I/O data of P7.5
   121       0004 C                 R74     ==    0x04    ; I/O data of P7.4
   122       0003 C                 R73     ==    0x03    ; I/O data of P7.3
   123       0002 C                 R72     ==    0x02    ; I/O data of P7.2
   124       0001 C                 R71     ==    0x01    ; I/O data of P7.1
   125       0000 C                 R70     ==    0x00    ; I/O data of P7.0
   126            C             ;}
   127            C        ;
   128            C        ; Bank0 R8(Port 8 data Register)
   129            C        ;
   130       0008 C         B0_R8    ==    0X08
   131       0008 C         PORT8    ==    0X08
   132            C        ;
   133            C             ;{
   134       0007 C                 R87     ==    0x07    ; I/O data of P8.7
   135       0006 C                 R86     ==    0x06    ; I/O data of P8.6
   136       0005 C                 R85     ==    0x05    ; I/O data of P8.5
   137       0004 C                 R84     ==    0x04    ; I/O data of P8.4
   138       0003 C                 R83     ==    0x03    ; I/O data of P8.3
   139       0002 C                 R82     ==    0x02    ; I/O data of P8.2
   140       0001 C                 R81     ==    0x01    ; I/O data of P8.1
   141       0000 C                 R80     ==    0x00    ; I/O data of P8.0
   142            C             ;}
   143            C        ;
   144            C        ; Bank0 R9(PORT 9 Data Register)
   145            C        ;
   146       0009 C         B0_R9    ==    0X09
   147       0009 C         PORT9    ==    0X09
   148            C        ;
   149            C             ;{
   150       0007 C                 R97     ==    0x07    ; I/O data of P9.7
   151       0006 C                 R96     ==    0x06    ; I/O data of P9.6
   152       0005 C                 R95     ==    0x05    ; I/O data of P9.5
   153       0004 C                 R94     ==    0x04    ; I/O data of P9.4
   154       0003 C                 R93     ==    0x03    ; I/O data of P9.3
   155       0002 C                 R92     ==    0x02    ; I/O data of P9.2
   156       0001 C                 R91     ==    0x01    ; I/O data of P9.1
   157       0000 C                 R90     ==    0X00    ; I/O data of P9.0
   158            C             ;}
   159            C        ;
   160            C        ;  Bank0 RA(PORTA Data Register)
   161            C        ;
   162       000A C         B0_RA	  ==	0X0A
   163       000A C         PORTA	  ==	0X0A
   164            C        ;
   165            C        	;{
   166       0007 C        		RA7	==	0X07	; I/O Data of PA.7
   167       0006 C        		RA6	==	0X06 	; I/O Data of PA.6
   168       0005 C        		RA5	==	0X05	; I/O Data of PA.5
   169       0004 C        		RA4	==	0X04	; I/O Data of PA.4
   170       0003 C        		RA3	==	0X03	; I/O Data of PA.3
   171       0002 C        		RA2	==	0X02	; I/O Data of PA.2
   172       0001 C        		RA1	==	0X01	; I/O Data of PA.1
   173       0000 C        		RA0	==	0X00	; I/O Data of PA.0
   174            C        	;}
   175            C        ;
   176            C        ;  Bank0 RB(PORT8 Data Register)
   177            C        ;
   178       000B C         B0_RB	==	0X0B
   179       000B C         PORTB	==	0X0B
   180            C        ;
   181            C        	;{
   182       0007 C        		RB7	==	0X07	; I/O Data of PB.7
   183       0006 C        		RB6	==	0X06 	; I/O Data of PB.6
   184       0005 C        		RB5	==	0X05	; I/O Data of PB.5
   185       0004 C        		RB4	==	0X04	; I/O Data of PB.4
   186       0003 C        		RB3	==	0X03	; I/O Data of PB.3
   187       0002 C        		RB2	==	0X02	; I/O Data of PB.2
   188       0001 C        		RB1	==	0X01	; I/O Data of PB.1
   189       0000 C        		RB0	==	0X00	; I/O Data of PB.0
   190            C        	;}
   191            C        ;
   192            C        ;  Bank0 RC(System Clock Control Register)
   193            C        ;
   194       000C C         B0_RC	==	0X0C
   195       000C C         SCCR	==	0X0C
   196            C        ;
   197            C        	;{
   198            C        				 ; Bit7 is "0"
   199       0006 C        		CLK2	==  0X06 ;
   200       0005 C        		CLK1	==  0X05 ;
   201       0004 C        		CLK0	==  0X04 ; Main Clock Select Bit for PLL Mode
   202            C        				 ; |------|------|------|------------|---------------|
   203            C        				 ; | CLK2 | CLK1 | CLK0 | Main Clock | Ex:Fs=32.768k |
   204            C        				 ; |------|------|------|------------|---------------|
   205            C        				 ; |  0   |  0   |  0   |   Fs*122   |   3.997 MHz   |
   206            C        				 ; |------|------|------|------------|---------------|
   207            C        				 ; |  0   |  0   |  1   |    Fs*61   |   1.998 MHz   |
   208            C        				 ; |------|------|------|------------|---------------|
   209            C        				 ; |  0   |  1   |  0   |   Fs*61/2  |   0.999 MHz   |
   210            C        				 ; |------|------|------|------------|---------------|
   211            C        				 ; |  0   |  1   |  1   |   Fs*61/4  |   499.7 kHz   |
   212            C        				 ; |------|------|------|------------|---------------|
   213            C        				 ; |  1   |  0   |  0   |   Fs*244   |   7.995 MHz   |
   214            C        				 ; |------|------|------|------------|---------------|
   215            C        				 ; |  1   |  0   |  1   |   Fs*366   |   11.99 MHz   |
   216            C        				 ; |------|------|------|------------|---------------|
   217            C        				 ; |  1   |  1   |  X   |   Fs*488   |   15.99 MHz   |
   218            C        				 ; |------|------|------|------------|---------------|
   219       0003 C        		IDLE	==  0X03 ; Idle Mode Enable Bit.
   220            C        		 		 ; IDLE="0"+SLEP instruction=>sleep mode
   221            C        		 		 ; IDLE="1"+SLEP instruction=>idle mode
   222       0002 C        		BF1	==  0x02 ;
   223       0001 C        		BF0	==  0x01 ; LCD Booster Frequency Select Bit.
   224            C        				 ; |-----|-----|-------------------|
   225            C        				 ; | BF1 | BF0 | Booster frequency |
   226            C        				 ; |-----|-----|-------------------|
   227            C        				 ; |  0  |  0  |        Fs         |
   228            C        				 ; |-----|-----|-------------------|
   229            C        				 ; |  0  |  1  |       Fs/4        |
   230            C        				 ; |-----|-----|-------------------|
   231            C        				 ; |  1  |  0  |       Fs/8        |
   232            C        				 ; |-----|-----|-------------------|
   233            C        				 ; |  1  |  1  |       Fs/16       |
   234            C        				 ; |-----|-----|-------------------|
   235       0000 C        		CPUS	==  0x00 ; CPU Oscillator Source Select.
   236            C        				 ; 0/1=>sub-oscillator(fs)/main oscillator(fm)
   237            C        	;}
   238            C        ;
   239            C        ; Bank0 RD(TCC and WDT Timer control register)
   240            C        ;
   241       000D C         B0_RD	==	0X0D
   242       000D C         TWTCR	==	0X0D
   243            C        ;
   244            C        	;{
   245       0007 C        		WDTE	==  0X07 ; Watchdog Timer Enable.0/1=>disable/enable
   246       0006 C        		WPSR2	==  0X06
   247       0005 C        		WPSR1	==  0X05
   248       0004 C        		WPSR0	==  0X04 ; WDT Prescaler Bits
   249            C        				 ; |-----|-----|-----|-----------|
   250            C        				 ; |WPSR2|WPSR1|WPSR0| Prescaler |
   251            C        				 ; |-----|-----|-----|-----------|
   252            C        				 ; |  0  |  0  |  0  |    1:1    |
   253            C        				 ; |-----|-----|-----|-----------|
   254            C        				 ; |  0  |  0  |  1  |    1:2    |
   255            C        				 ; |-----|-----|-----|-----------|
   256            C        				 ; |  0  |  1  |  0  |    1:4    |
   257            C        				 ; |-----|-----|-----|-----------|
   258            C        				 ; |  0  |  1  |  1  |    1:8    |
   259            C        				 ; |-----|-----|-----|-----------|
   260            C        				 ; |  1  |  0  |  0  |   1:16    |
   261            C        				 ; |-----|-----|-----|-----------|
   262            C        				 ; |  1  |  0  |  1  |   1:32    |
   263            C        				 ; |-----|-----|-----|-----------|
   264            C        				 ; |  1  |  1  |  0  |   1:64    |
   265            C        				 ; |-----|-----|-----|-----------|
   266            C        				 ; |  1  |  1  |  1  |   1:128   |
   267            C        				 ; |-----|-----|-----|-----------|
   268       0003 C        		TCCS	==  0x03 ; TCC Clock Source Select Bit.0/1=>Fm/Fs
   269       0002 C        		TPSR2	==  0x02
   270       0001 C        		TPSR1	==  0X01
   271       0000 C        		TPSR0	==  0X00 ; TCC Prescaler Bits
   272            C        				 ; |-----|-----|-----|-----------|
   273            C        				 ; |TPSR2|TPSR1|TPSR0| Prescaler |
   274            C        				 ; |-----|-----|-----|-----------|
   275            C        				 ; |  0  |  0  |  0  |    1:2    |
   276            C        				 ; |-----|-----|-----|-----------|
   277            C        				 ; |  0  |  0  |  1  |    1:4    |
   278            C        				 ; |-----|-----|-----|-----------|
   279            C        				 ; |  0  |  1  |  0  |    1:8    |
   280            C        				 ; |-----|-----|-----|-----------|
   281            C        				 ; |  0  |  1  |  1  |   1:16    |
   282            C        				 ; |-----|-----|-----|-----------|
   283            C        				 ; |  1  |  0  |  0  |   1:32    |
   284            C        				 ; |-----|-----|-----|-----------|
   285            C        				 ; |  1  |  0  |  1  |   1:64    |
   286            C        				 ; |-----|-----|-----|-----------|
   287            C        				 ; |  1  |  1  |  0  |   1:128   |
   288            C        				 ; |-----|-----|-----|-----------|
   289            C        				 ; |  1  |  1  |  1  |   1:256   |
   290            C        				 ; |-----|-----|-----|-----------|
   291            C        	;}
   292            C        ;
   293            C        ; Bank0 RE (Interrupt Mask Register)
   294            C        ;
   295       000E C         B0_RE	==	0X0E
   296       000E C         RE	==	0X0E							;ADD
   297       000E C         IMR	==	0X0E
   298            C        ;
   299            C        	;{
   300       0007 C        		T1IE	==  0X07 ; Timer1 Interrupt Enable Bit
   301       0006 C        		LVDIE   ==  0X06 ; low Voltage Detect Interrupt Enable Bit
   302       0005 C        		ADIE	==  0X05 ; A/D convert Interrupt Enable Bit
   303       0004 C        		SPIE    ==  0X04 ; SPI transfer Interrupt Enable Bit
   304       0003 C        		URTIE	==  0X03 ; UART transmit Interrupt Enable Bit
   305       0002 C        		EXIE9	==  0X02 ; External interrupt 9 Enable Bit
   306       0001 C        		EXIE8	==  0X01 ; External interrupt 8 Enable Bit
   307       0000 C        		TCIE	==  0X00 ; TCC Overflow Interrupt Enable Bit
   308            C        	;}
   309            C        ;
   310            C        ;  Bank0 RF (Interrupt Status Register)
   311            C        ;
   312       000F C         B0_RF	==	0X0F
   313       000F C         RF     ==  0x0F
   314       000F C         ISR	==	0X0F
   315            C        ;
   316            C        	;{
   317       0007 C        		T1IF	==  0X07 ; interrupt flag of timer1 interrupt
   318       0006 C        		LVDIF	==  0X06 ; interrupt flag of low voltage detector interrupt
   319       0005 C        		ADIF	==  0X05 ; interrupt flag of A/D convert Complete
   320       0004 C        		SPIF	==  0X04 ; interrupt flag of SPI transfer complete
   321       0003 C        		URTIF	==  0X03 ; interrupt flag of UART transfer complete
   322       0002 C        		EXIF9	==  0X02 ; interrupt flag of external interrupt 9 Occur.
   323       0001 C        		EXIF8	==  0X01 ; interrupt flag of external interrupt 8 Occur.
   324       0000 C        		TCIF	==  0X00 ; interrupt flag of TCC Overflow
   325            C        	;}
   326            C        ;
   327            C        ;  Bank1 R5 (LCD Control Register)
   328            C        ;
   329       0005 C         B1_R5	==	0X05
   330       0005 C         LCDCR	==	0X05
   331            C        ;
   332            C        	;{
   333       0007 C        		LCDEN	==  0X07 ; lCD Enable Select Bit.0/1=>disable/enable
   334       0006 C        		LCDTYPE	==  0X06 ; LCD Drive Waveform Type Select Bit
   335       0005 C        		LBS1	==  0x05
   336       0004 C        		LBS0	==  0x04 ; LCD Bias Select Bits
   337            C        				 ; |---|---|---------------|
   338            C        				 ; |BS1|BS0|LCD Bias Select|
   339            C        				 ; |---|---|---------------|
   340            C        				 ; | 0 | 0 |   1/2 Bias    |
   341            C        				 ; |---|---|---------------|
   342            C        				 ; | 0 | 1 |   1/3 Bias    |
   343            C        				 ; |---|---|---------------|
   344            C        				 ; | 1 | X |   1/4 Bias    |
   345            C        				 ; |---|---|---------------|
   346       0003 C        		DS1	==  0x03
   347       0002 C        		DS0	==  0x02 ; LCD Duty Select Bits
   348            C        				 ; |---|---|---------------|
   349            C        				 ; |DS1|DS0|LCD Duty Select|
   350            C        				 ; |---|---|---------------|
   351            C        				 ; | 0 | 0 |    Static     |
   352            C        				 ; |---|---|---------------|
   353            C        				 ; | 0 | 1 |   1/3 Duty    |
   354            C        				 ; |---|---|---------------|
   355            C        				 ; | 1 | 0 |   1/4 Duty    |
   356            C        				 ; |---|---|---------------|
   357            C        				 ; | 1 | 1 |   1/8 Duty    |
   358            C        				 ; |---|---|---------------|
   359       0001 C        		LCDF1	==  0x01 ;
   360       0000 C        		LCDF0	==  0x00 ; LCD Frame Frequency Control Bits
   361            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   362            C        				 ; |LCDF1|LCDF0|     Static    |    1/3 Duty   |    1/4 Duty   |   1/8 Duty   |
   363            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   364            C        				 ; |  0  |  0  |Fs/(512*1)=64.0|Fs/(172*3)=63.5|Fs/(128*4)=64.0|Fs/(64*8)=64.0|
   365            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   366            C        				 ; |  0  |  1  |Fs/(560*1)=58.5|Fs/(188*3)=58.0|Fs/(140*4)=58.5|Fs/(70*8)=58.5|
   367            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   368            C        				 ; |  1  |  0  |Fs/(608*1)=53.9|Fs/(204*3)=53.5|Fs/(152*4)=53.9|Fs/(76*8)=53.9|
   369            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   370            C        				 ; |  1  |  1  |Fs/(464*1)=70.6|Fs/(156*3)=70.0|Fs/(116*4)=70.6|Fs/(58*8)=70.6|
   371            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   372            C        	;}
   373            C        ;
   374            C        ;  Bank1 R6 (LCD Address Register)
   375            C        ;
   376       0006 C         B1_R6	==    0X06
   377       0006 C         LCDAR	==    0X06
   378            C        ;
   379            C        	;{
   380            C        				 ; Bit5~7 is "0"
   381       0004 C        		LCD_A4	==  0x04 ; LCD RAM Address:00H~16H
   382       0003 C        		LCD_A3	==  0x03
   383       0002 C        		LCD_A2  ==  0x02
   384       0001 C        		LCD_A1	==  0x01
   385       0000 C        		LCD_A0	==  0x00
   386            C        	;}
   387            C        ;
   388            C        ; Bank1 R7 (LCD Data Buffer)
   389            C        ;
   390       0007 C         B1_R7	==    0X07
   391       0007 C         LCDBR	==    0X07
   392            C        ;
   393            C        	;{
   394       0007 C        		LCD_D7	==  0x07
   395       0006 C        		LCD_D6	==  0x06
   396       0005 C        		LCD_D5	==  0x05
   397       0004 C        		LCD_D4	==  0x04
   398       0003 C        		LCD_D3	==  0x03
   399       0002 C        		LCD_D2	==  0x02
   400       0001 C        		LCD_D1	==  0x01
   401       0000 C        		LCD_D0	==  0x00
   402            C        	;}
   403            C        ;
   404            C        ;  Bank1 R8 (LCD Voltage Control Register)
   405            C        ;
   406       0008 C         B1_R8	==	0x08
   407       0008 C         LCDVCR	==	0x08
   408            C        ;
   409            C        	;{
   410            C        				 ; Bit5~6 is "0"
   411       0004 C        		LCDC1	==  0x04
   412       0003 C        		LCDC0	==  0x03 ; LCD Clock
   413            C        				 ; |-----|-----|------|--------|
   414            C        				 ; |LCDC1|LCDC0|  Fm  |  Flcd  |
   415            C        				 ; |-----|-----|------|--------|
   416            C        				 ; |  0  |  0  | 16M  | Fc/2^9 |
   417            C        				 ; |-----|-----|------|--------|
   418            C        				 ; |  0  |  1  |  8M  | Fc/2^8 |
   419            C        				 ; |-----|-----|------|--------|
   420            C        				 ; |  1  |  0  |  4M  | Fc/2^7 |
   421            C        				 ; |-----|-----|------|--------|
   422            C        				 ; |  1  |  1  |  2M  | Fc/2^6 |
   423            C        				 ; |-----|-----|------|--------|
   424       0002 C        		LCDVC2	==  0x02
   425       0001 C        		LCDVC1	==  0x01
   426       0000 C        		LCDVC0	==  0x00 ; LCD Voltage Control Bits
   427            C        				 ; |------|------|------|--------------|
   428            C        				 ; |LCDVC2|LCDVC1|LCDVC0|    Output    |
   429            C        				 ; |------|------|------|--------------|
   430            C        				 ; |   0  |   0  |   0  |  0.4VDD~VDD  |
   431            C        				 ; |------|------|------|--------------|
   432            C        				 ; |   0  |   0  |   1  | 0.34VDD~VDD  |
   433            C        				 ; |------|------|------|--------------|
   434            C        				 ; |   0  |   1  |   0  | 0.26VDD~VDD  |
   435            C        				 ; |------|------|------|--------------|
   436            C        				 ; |   0  |   1  |   1  | 0.18VDD~VDD  |
   437            C        				 ; |------|------|------|--------------|
   438            C        				 ; |   1  |   0  |   0  | 0.13VDD~VDD  |
   439            C        				 ; |------|------|------|--------------|
   440            C        				 ; |   1  |   0  |   1  | 0.07VDD~VDD  |
   441            C        				 ; |------|------|------|--------------|
   442            C        				 ; |   1  |   1  |   0  | 0.04VDD~VDD  |
   443            C        				 ; |------|------|------|--------------|
   444            C        				 ; |   1  |   1  |   1  |    0V~VDD    |
   445            C        				 ; |------|------|------|--------------|
   446            C        	;}
   447            C        ;
   448            C        ;  Bank1 R9 (LCD Com Control Register)
   449            C        ;
   450       0009 C         B1_R9	==	0x09
   451       0009 C         LCDCCR	==	0x09
   452            C        ;
   453            C        	;{
   454       0007 C        		COM7	==  0x07 ; 0:I/O Function,1:LCD common driver pin.
   455       0006 C        		COM6	==  0x06
   456       0005 C        		COM5	==  0x05
   457       0004 C        		COM4	==  0x04
   458       0003 C        		COM3	==  0x03
   459       0002 C        		COM2	==  0x02
   460       0001 C        		COM1	==  0x01
   461       0000 C        		COM0	==  0x00
   462            C        	;}
   463            C        ;
   464            C        ;  Bank1 RA (LCD Segment Control Register0)
   465            C        ;
   466       000A C         B1_RA		==	0X0A
   467       000A C         LCDSCR0	==	0X0A
   468            C        ;
   469            C        	;{
   470       0007 C        		SEG7	==  0X07 ; LCD Segment7 Control Bit.0:I/O,1:LCD Driver pin.
   471       0006 C        		SEG6	==  0X06 ; LCD Segment6 Control Bit.0:I/O,1:LCD Driver pin.
   472       0005 C        		SEG5	==  0X05 ; LCD Segment5 Control Bit.0:I/O,1:LCD Driver pin.
   473       0004 C        		SEG4	==  0X04 ; LCD Segment4 Control Bit.0:I/O,1:LCD Driver pin.
   474       0003 C        		SEG3	==  0X03 ; LCD Segment3 Control Bit.0:I/O,1:LCD Driver pin.
   475       0002 C        		SEG2	==  0X02 ; LCD Segment2 Control Bit.0:I/O,1:LCD Driver pin.
   476       0001 C        		SEG1	==  0X01 ; LCD Segment1 Control Bit.0:I/O,1:LCD Driver pin.
   477       0000 C        		SEG0	==  0X00 ; LCD Segment0 Control Bit.0:I/O,1:LCD Driver pin.
   478            C        	;}
   479            C        ;
   480            C        ;  Bank1 RB (LCD Segment Control Register1)
   481            C        ;
   482       000B C         B1_RB		==	0X0B
   483       000B C         LCDSCR1	==	0X0B
   484            C        ;
   485            C        	;{
   486       0007 C        		SEG15	==  0X07 ; LCD Segment15 Control Bit.0:I/O,1:LCD Driver pin.
   487       0006 C        		SEG14	==  0X06 ; LCD Segment14 Control Bit.0:I/O,1:LCD Driver pin.
   488       0005 C        		SEG13	==  0X05 ; LCD Segment13 Control Bit.0:I/O,1:LCD Driver pin.
   489       0004 C        		SEG12	==  0X04 ; LCD Segment12 Control Bit.0:I/O,1:LCD Driver pin.
   490       0003 C        		SEG11	==  0X03 ; LCD Segment11 Control Bit.0:I/O,1:LCD Driver pin.
   491       0002 C        		SEG10	==  0X02 ; LCD Segment10 Control Bit.0:I/O,1:LCD Driver pin.
   492       0001 C        		SEG9	==  0X01 ; LCD Segment9 Control Bit.0:I/O,1:LCD Driver pin.
   493       0000 C        		SEG8	==  0X00 ; LCD Segment8 Control Bit.0:I/O,1:LCD Driver pin.
   494            C        	;}
   495            C        ;
   496            C        ;  Bank1 RC (LCD Segment Control Register2)
   497            C        ;
   498       000C C         B1_RC		==	0X0C
   499       000C C         LCDSCR2	==	0X0C
   500            C        ;
   501            C        	;{
   502            C        				 ; Bit7 not used
   503       0006 C        		SEG22	==  0X06 ; LCD Segment22 Control Bit.0:I/O,1:LCD Driver pin.
   504       0005 C        		SEG21	==  0X05 ; LCD Segment21 Control Bit.0:I/O,1:LCD Driver pin.
   505       0004 C        		SEG20	==  0X04 ; LCD Segment20 Control Bit.0:I/O,1:LCD Driver pin.
   506       0003 C        		SEG19	==  0X03 ; LCD Segment19 Control Bit.0:I/O,1:LCD Driver pin.
   507       0002 C        		SEG18	==  0X02 ; LCD Segment18 Control Bit.0:I/O,1:LCD Driver pin.
   508       0001 C        		SEG17	==  0X01 ; LCD Segment17 Control Bit.0:I/O,1:LCD Driver pin.
   509       0000 C        		SEG16	==  0X00 ; LCD Segment16 Control Bit.0:I/O,1:LCD Driver pin.
   510            C        	;}
   511            C        ;
   512            C        ;  Bank1 RE (External Interrupt Mask Register)
   513            C        ;
   514       000E C         B1_RE	==	0X0E
   515       000E C         EIMR	==	0X0E
   516            C        ;
   517            C        	;{
   518       0007 C        		EXIE7	==  0x07 ; /INT7 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   519       0006 C        		EXIE6	==  0x06 ; /INT6 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   520       0005 C        		EXIE5	==  0x05 ; /INT5 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   521       0004 C        		EXIE4	==  0x04 ; /INT4 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   522       0003 C        		EXIE3	==  0x03 ; /INT3 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   523       0002 C        		EXIE2	==  0x02 ; /INT2 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   524       0001 C        		EXIE1	==  0x01 ; /INT1 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   525       0000 C        		EXIE0	==  0x00 ; /INT0 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   526            C        	;}
   527            C        ;
   528            C        ;  Bank1 RF (External Interrupt Status Register)
   529            C        ;
   530       000F C         B1_RF	==	0X0F
   531       000F C         EISR	==	0X0F
   532            C        ;
   533            C        	;{
   534       0007 C        		EXIF7	==  0x07 ; /INT7 Interrupt Flag Bit.
   535       0006 C        		EXIF6	==  0x06 ; /INT6 Interrupt Flag Bit.
   536       0005 C        		EXIF5	==  0x05 ; /INT5 Interrupt Flag Bit.
   537       0004 C        		EXIF4	==  0x04 ; /INT4 Interrupt Flag Bit.
   538       0003 C        		EXIF3	==  0x03 ; /INT3 Interrupt Flag Bit.
   539       0002 C        		EXIF2	==  0x02 ; /INT2 Interrupt Flag Bit.
   540       0001 C        		EXIF1	==  0x01 ; /INT1 Interrupt Flag Bit.
   541       0000 C        		EXIF0	==  0x00 ; /INT0 Interrupt Flag Bit.
   542            C        	;}
   543            C        ;
   544            C        ;  Bank2 R5 (Timer1 Control Register)
   545            C        ;
   546       0005 C         B2_R5	==	0X05
   547       0005 C         T1CR	==	0X05
   548            C        ;
   549            C        	;{
   550       0007 C        		T1S1	==  0x07
   551       0006 C        		T1S0	==  0x06 ; Timer1 and Timer2 Interrupt Type Select Bits.
   552            C        				 ; |----|----|---------------------------------------|
   553            C        				 ; |T1S1|T1S0|Timer1 and Timer2 Interrupt Type Select|
   554            C        				 ; |----|----|---------------------------------------|
   555            C        				 ; |  0 |  0 |           T1PD underflow              |
   556            C        				 ; |----|----|---------------------------------------|
   557            C        				 ; |  0 |  1 |           T1TD underflow              |
   558            C        				 ; |----|----|---------------------------------------|
   559            C        				 ; |  1 |  X |      T1PD and T1TD underflow          |
   560            C        				 ; |----|----|---------------------------------------|
   561       0005 C        		T1MS2	==  0x05
   562       0004 C        		T1MS1	==  0x04
   563       0003 C        		T1MS0	==  0x03 ; Timer1 Operation Mode Select Bits
   564            C        				 ; |-----|-----|-----|-------------------------|
   565            C        				 ; |T1MS2|T1MS1|T1MS0|   Timer1 Mode Select    |
   566            C        				 ; |-----|-----|-----|-------------------------|
   567            C        				 ; |  0  |  0  |  0  |         Timer1          |
   568            C        				 ; |-----|-----|-----|-------------------------|
   569            C        				 ; |  0  |  0  |  1  |        T1OUT Mode       |
   570            C        				 ; |-----|-----|-----|-------------------------|
   571            C        				 ; |  0  |  1  |  0  |Capture Mode Rising Edge |
   572            C        				 ; |-----|-----|-----|-------------------------|
   573            C        				 ; |  0  |  1  |  1  |Capture Mode Falling Edge|
   574            C        				 ; |-----|-----|-----|-------------------------|
   575            C        				 ; |  1  |  0  |  0  |UART Baud Rate Generator |
   576            C        				 ; |-----|-----|-----|-------------------------|
   577            C        				 ; |  1  |  0  |  1  |                         |
   578            C        				 ; |-----|-----|-----|                         |
   579            C        				 ; |  1  |  1  |  0  |          PWM1           |
   580            C        				 ; |-----|-----|-----|                         |
   581            C        				 ; |  1  |  1  |  1  |                         |
   582            C        				 ; |-----|-----|-----|-------------------------|
   583       0002 C        		T1P2	==  0x02
   584       0001 C        		T1P1	==  0x01
   585       0000 C        		T1P0	==  0x00 ; Timer1 Prescaler Bits
   586            C        				 ; |-----|-----|-----|-----------------|
   587            C        				 ; | T1P2| T1P1| T1P0|   Prescalaer    |
   588            C        				 ; |-----|-----|-----|-----------------|
   589            C        				 ; |  0  |  0  |  0  |      1:2        |
   590            C        				 ; |-----|-----|-----|-----------------|
   591            C        				 ; |  0  |  0  |  1  |      1:4        |
   592            C        				 ; |-----|-----|-----|-----------------|
   593            C        				 ; |  0  |  1  |  0  |	    1:8        |
   594            C        				 ; |-----|-----|-----|-----------------|
   595            C        				 ; |  0  |  1  |  1  |      1:16       |
   596            C        				 ; |-----|-----|-----|-----------------|
   597            C        				 ; |  1  |  0  |  0  |      1:32       |
   598            C        				 ; |-----|-----|-----|-----------------|
   599            C        				 ; |  1  |  0  |  1  |      1:64       |
   600            C        				 ; |-----|-----|-----|-----------------|                         |
   601            C        				 ; |  1  |  1  |  0  |      1:128      |
   602            C        				 ; |-----|-----|-----|-----------------|
   603            C        				 ; |  1  |  1  |  1  |      1:256      |
   604            C        				 ; |-----|-----|-----|-----------------|
   605            C        	;}
   606            C        ;
   607            C        ;  Bank2 R6 (Timer Status Register)
   608            C        ;
   609       0006 C         B2_R6	==	0X06
   610       0006 C         TSR	==	0X06
   611            C        ;
   612            C        	;{
   613       0007 C        		T1MOD	==  0X07 ; Timer Operates Mode Select Bit.
   614       0006 C        		TRCB	==  0x06 ; Timer1,2 Read Control Bit.
   615       0005 C        		T1CSS1	==  0x05 ;
   616       0004 C        		T1CSS0	==  0x04 ; Timer1 Clock Source Select Bits
   617            C        				 ; |------|------|--------------------------|
   618            C        				 ; |T1CSS1|T1CSS0|Timer1 Clock Source select|
   619            C        				 ; |------|------|--------------------------|
   620            C        				 ; |  0   |  0   |            Fm            |
   621            C        				 ; |------|------|--------------------------|
   622            C        				 ; |  0   |  1   |            Fs            |
   623            C        				 ; |------|------|--------------------------|
   624            C        				 ; |  1   |  X   |           T1CK           |
   625            C        				 ; |------|------|--------------------------|
   626       0003 C        		T2CSS	==  0x03 ; Timer2 Clock Source Select Bit.0/1=>Fm/Fs.
   627       0002 C        		T1EN	==  0x02 ; Timer1 Start Bit.
   628       0001 C        		T1OMS	==  0x01 ; Timer1 Output Mode Select Bit.0/1=>repeating/on-shot.
   629       0000 C        		T1OC	==  0x00 ; Timer1 Output Flip-Flop Control Bit.
   630            C        	;}
   631            C        ;
   632            C        ;  Bank2 R7 (Timer1 Period Buffer)
   633            C        ;
   634       0007 C         B2_R7	==	0X07
   635       0007 C         T1PD	==	0X07
   636            C        ;
   637            C        ;  Bank2 R8 (Timer1 Duty Buffer)
   638            C        ;
   639       0008 C         B2_R8	==	0X08
   640       0008 C         T1TD	==	0X08
   641            C        ;
   642            C        ;  Bank2 R9 (Timer2 Control Register)
   643            C        ;
   644       0009 C         B2_R9	==	0X09
   645       0009 C         T2CR	==	0X09
   646            C        ;
   647            C        	;{
   648       0007 C        		T2IF	==  0X07 ; Interrupt Flag of Timer2 Interrupt
   649       0006 C        		T2IE	==  0X06 ; Timer2 Interrupt Mask Bit
   650       0005 C        		T2EN	==  0X05 ; Timer2 Start Bit
   651       0005 C        		T2S     ==  0x05 ;
   652       0004 C        		T2MS1	==  0X04 ;
   653       0003 C        		T2MS0	==  0X03 ; Timer2 Operation Mode Select Bits.
   654            C        				 ; |-----|-----|-----------------------|
   655            C        				 ; |T2MS1|T2MS0|   Timer2 Mode Select  |
   656            C        				 ; |-----|-----|-----------------------|
   657            C        				 ; |  0  |  0  |        Timer2         |
   658            C        				 ; |-----|-----|-----------------------|
   659            C        				 ; |  0  |  1  |SPI Baud Rate Generator|
   660            C        				 ; |-----|-----|-----------------------|
   661            C        				 ; |  1  |  0  |                       |
   662            C        				 ; |-----|-----|         PWM2          |
   663            C        				 ; |  1  |  0  |                       |
   664            C        				 ; |-----|-----|-----------------------|
   665       0002 C        		T2P2	==  0x02
   666       0001 C        		T2P1	==  0x01
   667       0000 C        		T2P0	==  0x00 ; Timer2 Prescaler Bits
   668            C        				 ; |-----|-----|-----|-----------------|
   669            C        				 ; | T2P2| T2P1| T2P0|   Prescalaer    |
   670            C        				 ; |-----|-----|-----|-----------------|
   671            C        				 ; |  0  |  0  |  0  |      1:2        |
   672            C        				 ; |-----|-----|-----|-----------------|
   673            C        				 ; |  0  |  0  |  1  |      1:4        |
   674            C        				 ; |-----|-----|-----|-----------------|
   675            C        				 ; |  0  |  1  |  0  |	    1:8        |
   676            C        				 ; |-----|-----|-----|-----------------|
   677            C        				 ; |  0  |  1  |  1  |      1:16       |
   678            C        				 ; |-----|-----|-----|-----------------|
   679            C        				 ; |  1  |  0  |  0  |      1:32       |
   680            C        				 ; |-----|-----|-----|-----------------|
   681            C        				 ; |  1  |  0  |  1  |      1:64       |
   682            C        				 ; |-----|-----|-----|-----------------|                         |
   683            C        				 ; |  1  |  1  |  0  |      1:128      |
   684            C        				 ; |-----|-----|-----|-----------------|
   685            C        				 ; |  1  |  1  |  1  |      1:256      |
   686            C        				 ; |-----|-----|-----|-----------------|
   687            C        	;}
   688            C        ;
   689            C        ;  Bank2 RA (Timer2 Period Buffer)
   690            C        ;
   691       000A C         B2_RA	==	0X0A
   692       000A C         T2PD	==	0X0A
   693            C        ;
   694            C        ; Bank2 RB (Timer Duty Buffer)
   695            C        ;
   696       000B C         B2_RB	==	0X0B
   697       000B C         T2TD	==	0X0B
   698            C        ;
   699            C        ;  Bank2 RC (SPI Status Register)
   700            C        ;
   701       000C C         B2_RC	==	0X0C
   702       000C C         SPIS	==	0X0C
   703            C        ;
   704            C        	;{
   705       0007 C        		DORD	==  0X07 ; Data Shift Control Bit.0/1=>left/right
   706       0006 C        		TD1	==  0X06 ;
   707       0005 C        		TD0	==  0X05 ; SDO Status Output Delay Times Options
   708            C        				 ; |---|---|----------|
   709            C        				 ; |TD1|TD0|Delay Time|
   710            C        				 ; |---|---|----------|
   711            C        				 ; | 0 | 0 |   8 CLK  |
   712            C        				 ; |---|---|----------|
   713            C        				 ; | 0 | 1 |  16 CLK  |
   714            C        				 ; |---|---|----------|
   715            C        				 ; | 1 | 0 |  24 CLK  |
   716            C        				 ; |---|---|----------|
   717            C        				 ; | 1 | 1 |  32 CLK  |
   718            C        				 ; |---|---|----------|
   719            C        				 ; Bit4 Reserved
   720       0003 C        		OD3	==  0X03 ; Open-Drain Control Bit
   721       0002 C        		OD4	==  0X02 ;
   722            C        				 ; Bi1 Reserved
   723       0000 C        		RIBF	==  0X00 ; Read Buffer Full Flag
   724            C        	;}
   725            C        ;
   726            C        ;  Bank2 RD (SPI Control Register)
   727            C        ;
   728       000D C         B2_RD	==	0X0D
   729       000D C         SPIC	==	0X0D
   730            C        ;
   731            C        	;{
   732       0007 C        		CES	==  0X07 ; Clock Edge Select Bit
   733       0006 C        		SPIEB	==  0X06 ; SPI Enable Bit
   734       0005 C        		SRO	==  0X05 ; SPI Read Overflow Bit
   735       0004 C        		SSE	==  0X04 ; SPI Shift Enable Bit
   736       0003 C        		SDOC	==  0X03 ; SDO Output Status Control Bit
   737       0002 C        		SBRS2	==  0X02
   738       0001 C        		SBRS1	==  0X01
   739       0000 C        		SBRS0	==  0X00 ; SPI Baud Rate Select Bits
   740            C        				 ; |-----|-----------|--------|-------------------|
   741            C        				 ; |SBRS2|SBRS1|SBRS0|  Mode  |   SPI Baud Rate   |
   742            C        				 ; |-----|-----------|--------|-------------------|
   743            C        				 ; |  0  |  0  |  0  | Master |       Fcsc/2      |
   744            C        				 ; |-----|-----------|--------|-------------------|
   745            C        				 ; |  0  |  0  |  1  | Master |       Fcsc/4      |
   746            C        				 ; |-----|-----------|--------|-------------------|
   747            C        				 ; |  0  |  1  |  0  | Master |       Fcsc/8      |
   748            C        				 ; |-----|-----------|--------|-------------------|
   749            C        				 ; |  0  |  1  |  1  | Master |      Fcsc/16      |
   750            C        				 ; |-----|-----------|--------|-------------------|
   751            C        				 ; |  1  |  0  |  0  | Master |      Fcsc/32      |
   752            C        				 ; |-----|-----------|--------|-------------------|
   753            C        				 ; |  1  |  0  |  1  | Master |       Timer2      |
   754            C        				 ; |-----|-----------|--------|-------------------|
   755            C        				 ; |  1  |  1  |  0  | Slave  |     /SS enable    |
   756            C        				 ; |-----|-----------|--------|-------------------|
   757            C        				 ; |  1  |  1  |  1  | Slave  |     /SS enable    |
   758            C        				 ; |-----|-----------|--------|-------------------|
   759            C        	;}
   760            C        ;
   761            C        ;  Bank2 RE (SPI Read Buffer)
   762            C        ;
   763       000E C         B2_RE	==	0X0E
   764       000E C         SPIR	==	0X0E
   765            C        ;
   766            C        ;  Bank2 RF (SPI Write Buffer)
   767            C        ;
   768       000F C         B2_RF	==	0X0F
   769       000F C         SPIW	==	0X0F
   770            C        ;
   771            C        ;  Bank3 R5 (UART Control Register)
   772            C        ;
   773       0005 C         B3_R5	==	0X05
   774       0005 C         URC	==	0X05
   775            C        ;
   776            C        	;{
   777       0007 C        		URTD8	==  0X07 ; Transmission Data Bit8
   778       0006 C        		UMODE1	==  0X06
   779       0005 C        		UM0DE0	==  0X05 ; UART Transmission Mode Select Bit
   780            C        				 ; |------|------|-----------|
   781            C        				 ; |UMODE1|UMODE0| UART Mode |
   782            C        				 ; |  0   |   0  |Mode1:7-Bit|
   783            C        				 ; |------|------|-----------|
   784            C        				 ; |  0   |   1  |Mode1:8-Bit|
   785            C        				 ; |------|------|-----------|
   786            C        				 ; |  1   |   0  |Mode1:9-Bit|
   787            C        				 ; |------|------|-----------|
   788            C        				 ; |  1   |   1  | Reserved  |
   789            C        				 ; |------|------|-----------|
   790       0004 C        		BRATE2	==  0X04
   791       0003 C        		BRATE1	==  0X03
   792       0002 C        		BRATE0	==  0X02 ; Transmit Baud Rate Select(Tuart=Fc/16)
   793            C        				 ; |------|------|------|-------------|-------------|
   794            C        				 ; |BRATE2|BRATE1|BRATE0|  Baud Rate  | e.g.FC=8Mhz |
   795            C        				 ; |------|------|------|-------------|-------------|
   796            C        				 ; |  0   |  0   |  0   |   Tuart/13  |    38400    |
   797            C        				 ; |------|------|------|-------------|-------------|
   798            C        				 ; |  0   |  0   |  1   |   Tuart/26  |    19200    |
   799            C        				 ; |------|------|------|-------------|-------------|
   800            C        				 ; |  0   |  1   |  0   |   Tuart/52  |     9600    |
   801            C        				 ; |------|------|------|-------------|-------------|
   802            C        				 ; |  0   |  1   |  1   |  Tuart/104  |     4800    |
   803            C        				 ; |------|------|------|-------------|-------------|
   804            C        				 ; |  1   |  0   |  0   |  Tuart/208  |     2400    |
   805            C        				 ; |------|------|------|-------------|-------------|
   806            C        				 ; |  1   |  0   |  1   |  Tuart/416  |     1200    |
   807            C        				 ; |------|------|------|---------------------------|
   808            C        				 ; |  1   |  1   |  0   |            Timer1         |
   809            C        				 ; |------|------|------|---------------------------|
   810            C        				 ; |  1   |  1   |  1   |           Reserved        |
   811            C        				 ; |------|------|------|---------------------------|
   812       0001 C        		UTBE ==  0X01
   813       0000 C        		TXE	 ==  0X00 ; Enable transmission
   814            C        	;}
   815            C        ;
   816            C        ;  Bank 3 R6 (UART Status)
   817            C        ;
   818       0006 C         B3_R6	==  0X06
   819       0006 C         URS	==  0X06
   820            C        ;
   821            C        	;{
   822       0007 C        		URRD8	==  0X07 	; Receiving Data Bit8
   823       0006 C        		EVEN	==  0X06 	; Select Parity Check
   824       0005 C        		PRE		==  0X05	; Enable Parity Check
   825       0004 C        		PRERR	==  0X04 	; Parity Error Flag
   826       0003 C        		OVERR	==  0X03 	; Over Running Error Flag
   827       0002 C        		FMERR	==  0X02 	; Framing Error Flag
   828       0001 C        		URBF	==  0X01 	; UART Read Buffer Full Flag
   829       0000 C        		RXE	==  0X00 		; Enable Receiving
   830            C        	;}
   831            C        ;
   832            C        ;  Bank3 R7 (UART_RD Data Buffer)
   833            C        ;
   834       0007 C         B3_R7	==	0X07
   835       0007 C         URRD	==	0X07
   836            C        ;
   837            C        ;  Bank3 R8 (UART_TD Data Buffer)
   838            C        ;
   839       0008 C         B3_R8	==	0X08
   840       0008 C         URTD	==	0X08
   841            C        ;
   842            C        ;  Bank3 R9 (A/D Control Register)
   843            C        ;
   844       0009 C         B3_R9	==	0X09
   845       0009 C         ADCR	==	0X09
   846            C        ;
   847            C        	;{
   848       0007 C        		ADRUN	==  0X07 ; AD Conversion Start
   849       0006 C        		ADP	==  0X06 ; A/D Power Control
   850       0005 C        		ADCK1	==  0X05
   851       0004 C        		ADCK0	==  0X04 ; A/D Input Select Bits
   852            C        				 ; |-----|-----|------------|---------------------------|
   853            C        				 ; |ADCK1|ADCK0|Clock Source|Max.Operating Frequency(Fc)|
   854            C        				 ; |-----|-----|------------|---------------------------|
   855            C        				 ; |  0	 |  0  |    Fc/4    |           1MHz            |
   856            C        				 ; |-----|-----|------------|---------------------------|
   857            C        				 ; |  0	 |  1  |   Fc/16    |           4MHz            |
   858            C        				 ; |-----|-----|------------|---------------------------|
   859            C        				 ; |  1	 |  0  |   Fc/32    |           8MHz            |
   860            C        				 ; |-----|-----|------------|---------------------------|
   861            C        				 ; |  1	 |  1  |   Fc/64    |          16MHz            |
   862            C        				 ; |-----|-----|------------|---------------------------|
   863       0003 C        		ADIS3	==  0X03
   864       0002 C        		ADIS2	==  0X02
   865       0001 C        		ADIS1	==  0X01
   866       0000 C        		ADIS0	==  0X00 ; A/D Input Select Bits
   867            C        				 ; |-----|-----|-----|----------------------|
   868            C        				 ; |ADIS3|ADIS2|ADIS1|ADIS0|Analog Input Pin|
   869            C        				 ; |-----|-----|-----|----------------------|
   870            C        				 ; |  0  |  0  |  0  |  0  |      AD0       |
   871            C        				 ; |-----|-----|-----|----------------------|
   872            C        				 ; |  0  |  0  |  0  |  1  |      AD1       |
   873            C        				 ; |-----|-----|-----|----------------------|
   874            C        				 ; |  0  |  0  |  1  |  0  |      AD2       |
   875            C        				 ; |-----|-----|-----|----------------------|
   876            C        				 ; |  0  |  0  |  1  |  1  |      AD3       |
   877            C        				 ; |-----|-----|-----|----------------------|
   878            C        				 ; |  0  |  1  |  0  |  0  |      AD4       |
   879            C        				 ; |-----|-----|-----|----------------------|
   880            C        				 ; |  0  |  1  |  0  |  1  |      AD5       |
   881            C        				 ; |-----|-----|-----|----------------------|
   882            C        				 ; |  0  |  1  |  1  |  0  |      AD6       |
   883            C        				 ; |-----|-----|-----|----------------------|
   884            C        				 ; |  0  |  1  |  1  |  1  |      AD7       |
   885            C        				 ; |-----|-----|-----|----------------------|
   886            C        				 ; |  1  |  0  |  0  |  0  |      AD8       |
   887            C        				 ; |-----|-----|-----|----------------------|
   888            C        				 ; |  1  |  0  |  0  |  1  |      AD9       |
   889            C        				 ; |-----|-----|-----|----------------------|
   890            C        				 ; |  1  |  0  |  1  |  0  |      AD10      |
   891            C        				 ; |-----|-----|-----|----------------------|
   892            C        				 ; |  1  |  0  |  1  |  1  |      AD11      |
   893            C        				 ; |-----|-----|-----|----------------------|
   894            C        	;}
   895            C        ;
   896            C        ;  Bank3 RA (A/D Input Control Register)
   897            C        ;
   898       000A C         B3_RA	==	0X0A
   899       000A C         ADICH	==	0X0A
   900            C        ;
   901            C        	;{
   902       0007 C        		CALI	==  0X07 ; Calibration Enable Bit for A/D Offset
   903       0006 C        		ADREF	==  0X06 ; AD Reference Voltage Input Select
   904            C        				 ; Bit4~5:Reserved
   905       0003 C        		ADE11	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   906       0002 C        		ADE10	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   907       0001 C        		ADE9	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   908       0000 C        		ADE8	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   909            C        	;}
   910            C        ;
   911            C        ;  Bank3 RB (A/D Input Control Register)
   912            C        ;
   913       000B C         B3_RB	==	0X0B
   914       000B C         ADICL	==	0X0B
   915            C        ;
   916            C        	;{
   917       0007 C        		ADE7	==  0X07 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   918       0006 C        		ADE6	==  0X06 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   919       0005 C        		ADE5	==  0x05 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   920       0004 C        		ADE4	==  0X04 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   921       0003 C        		ADE3	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   922       0002 C        		ADE2	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   923       0001 C        		ADE1	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   924       0000 C        		ADE0	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   925            C        	;}
   926            C        ;
   927            C        ;  Bank3 RC (A/D High 8-bits Data Buffer)
   928            C        ;
   929       000C C         B3_RC	==	0X0C
   930       000C C         ADDH	==	0X0C
   931            C        ;
   932            C        ;  Bank3 RD (A/D Low 4-bits Data Buffer)
   933            C        ;
   934       000D C         B3_RD	==	0X0D
   935       000D C         ADDL	==	0X0D
   936            C        ;
   937            C        	;{
   938       0007 C        		SIGN	==  0X07 ; Polarity Bit of Offset Voltage.0/1=>Negative/Positive
   939       0006 C        		VOF2	==  0X06
   940       0005 C        		VOF1	==  0X05
   941       0004 C        		VOF0	==  0X04 ; Offset Voltage Bits.
   942            C        				 ; |----|----|----|---------|
   943            C        				 ; |VOF2|VOF1|VOF0|EM78P510N|
   944            C        				 ; |----|----|----|---------|
   945            C        				 ; |  0 |  0 |  0 |   0LSB  |
   946            C        				 ; |----|----|----|---------|
   947            C        				 ; |  0 |  0 |  1 |   2LSB  |
   948            C        				 ; |----|----|----|---------|
   949            C        				 ; |  0 |  1 |  0 |   4LSB  |
   950            C        				 ; |----|----|----|---------|
   951            C        				 ; |  0 |  1 |  1 |   6LSB  |
   952            C        				 ; |----|----|----|---------|
   953            C        				 ; |  1 |  0 |  0 |   8LSB  |
   954            C        				 ; |----|----|----|---------|
   955            C        				 ; |  1 |  0 |  1 |  10LSB  |
   956            C        				 ; |----|----|----|---------|
   957            C        				 ; |  1 |  1 |  0 |  12LSB  |
   958            C        				 ; |----|----|----|---------|
   959            C        				 ; |  1 |  1 |  1 |  14LSB  |
   960            C        				 ; |----|----|----|---------|
   961       0003 C        		ADD3	==  0X03
   962       0002 C        		ADD2	==  0X02
   963       0001 C        		ADD1	==  0X01
   964       0000 C        		ADD0	==  0X00
   965            C        	;}
   966            C        ;
   967            C        ;  Bank3 RE (External Interrupt Edge Select Control Register High Byte)
   968            C        ;
   969       000E C         B3_RE	==	0X0E
   970       000E C         EIESH	==	0X0E
   971            C        ;
   972            C        	;{
   973       0007 C        		EIES7	==  0X07 ; External Interrupt 7 Edge Select Bit.0/1=>Falling/Rising
   974       0006 C        		EIES6	==  0X06 ; External Interrupt 6 Edge Select Bit.0/1=>Falling/Rising
   975       0005 C        		EIES5	==  0X05 ; External Interrupt 5 Edge Select Bit.0/1=>Falling/Rising
   976       0004 C        		EIES4	==  0X04 ; External Interrupt 4 Edge Select Bit.0/1=>Falling/Rising
   977       0003 C        		EIES3	==  0X03 ; External Interrupt 3 Edge Select Bit.0/1=>Falling/Rising
   978       0002 C        		EIES2	==  0X02 ; External Interrupt 2 Edge Select Bit.0/1=>Falling/Rising
   979       0001 C        		EIES1	==  0X01 ; External Interrupt 1 Edge Select Bit.0/1=>Falling/Rising
   980       0000 C        		EIES0	==  0X00 ; External Interrupt 0 Edge Select Bit.0/1=>Falling/Rising
   981            C        	;}
   982            C        ;
   983            C        ;  Bank3 RF (External Interrupt Edge Select Control Register Low Byte)
   984            C        ;
   985       000F C         B3_RF	==	0X0F
   986       000F C         EIESL	==	0X0F
   987            C        ;
   988            C        	;{
   989            C        				 ;Bit4~7 is "0"
   990       0004 C        		ADWK	==  0X04 ; A/D Converter Wake Up Function Enable Bit
   991       0003 C        		INTWK9	==  0X03 ; External Interrupt 9 Wake Up Function Enable Bit
   992       0002 C        		INTWK8	==  0X02 ; External Interrupt 8 Wake Up Function Enable Bit
   993       0001 C        		EIES9	==  0X01 ; External Interrupt 9 Edge Select Bit
   994       0000 C        		EIES8	==  0x00 ; External Interrupt 8 Edge Select Bit
   995            C        	;}
   996            C        ;
   997            C        ;  Bank4 R5 (LED Drive Control Register)
   998            C        ;
   999       0005 C         B4_R5	==	0X05
  1000       0005 C         LEDDCR	==	0X05
  1001            C        ;
  1002            C        	;{
  1003       0007 C        		LEDD7	==  0X07 ; 0:P9.7 as normal I/O,1:P9.7 as LED direct drive I/O.
  1004       0006 C        		LEDD6	==  0X06 ; 0:P9.6 as normal I/O,1:P9.6 as LED direct drive I/O.
  1005       0005 C        		LEDD5	==  0X05 ; 0:P9.5 as normal I/O,1:P9.5 as LED direct drive I/O.
  1006       0004 C        		LEDD4	==  0X04 ; 0:P9.4 as normal I/O,1:P9.4 as LED direct drive I/O.
  1007       0003 C        		LEDD3	==  0X03 ; 0:P9.3 as normal I/O,1:P9.3 as LED direct drive I/O.
  1008       0002 C        		LEDD2	==  0X02 ; 0:P9.2 as normal I/O,1:P9.2 as LED direct drive I/O.
  1009       0001 C        		LEDD1	==  0X01 ; 0:P9.1 as normal I/O,1:P9.1 as LED direct drive I/O.
  1010       0000 C        		LEDD0	==  0X00 ; 0:P9.0 as normal I/O,1:P9.0 as LED direct drive I/O.
  1011            C        	;}
  1012            C        ;
  1013            C        ;  Bank4 R6 (Watch Timer and Buzzer Control Register)
  1014            C        ;
  1015       0006 C         B4_R6	==	0X06
  1016       0006 C         WBCR	==	0X06
  1017            C        ;
  1018            C        	;{
  1019       0007 C        		WTCS	==  0X07 ; Watch Timer and Buzzer Clock Source Select Bit.
  1020       0006 C        		WTIE	==  0X06 ; Watch Timer Enable Bit and Interrupt Mask
  1021       0005 C        		WTIF	==  0X05 ; Watch Timer Interrupt Flag
  1022       0004 C        		WTSSB1	==  0X04 ;
  1023       0003 C        		WTSSB0  ==  0X03 ; Watch Timer Interval Select Bits
  1024            C        				 ; |------|------|-----------------------------------|
  1025            C        				 ; |WTSSB1|WTSSB0|Watch Timer Interval Select(WTCS=1)|
  1026            C        				 ; |  0   |   0  |                1.0S               |
  1027            C        				 ; |------|------|-----------------------------------|
  1028            C        				 ; |  0   |   1  |                0.5S               |
  1029            C        				 ; |------|------|-----------------------------------|
  1030            C        				 ; |  1   |   0  |               0.25S               |
  1031            C        				 ; |------|------|-----------------------------------|
  1032            C        				 ; |  1   |   1  |              3.91MS               |
  1033            C        				 ; |------|------|-----------------------------------|
  1034       0002 C        		BUZE	==  0X02 ; Buzzer Enable and PORT91 as Buzzer Output Pin
  1035       0001 C        		BSSB1	==  0X01
  1036       0000 C        		BSSB0	==  0X00 ; Buzzer Output Frequency Select Bits
  1037            C        				 ; |-----|-----|----------------------------|
  1038            C        				 ; |BSSB1|BSSB0|Buzzer Signal Select(WTCS=1)|
  1039            C        				 ; |-----|-----|----------------------------|
  1040            C        				 ; |  0  |  0  |           0.5KHz           |
  1041            C        				 ; |-----|-----|----------------------------|
  1042            C        				 ; |  0  |  1  |           1.0KHz           |
  1043            C        				 ; |-----|-----|----------------------------|
  1044            C        				 ; |  1  |  0  |           2.0KHz           |
  1045            C        				 ; |-----|-----|----------------------------|
  1046            C        				 ; |  1  |  1  |           4.0KHz           |
  1047            C        				 ; |-----|-----|----------------------------|
  1048            C        	;}
  1049            C        ;
  1050            C        ;  Bank4 R7 (PORT7 I/O Control Register)
  1051            C        ;
  1052       0007 C         B4_R7	==	0X07
  1053       0007 C         IOC7	==	0X07
  1054       0007 C         P7IOCR	==	0X07
  1055            C        ;
  1056            C        ;  Bank4 R8 (PORT8 I/O Control Register)
  1057            C        ;
  1058       0008 C         B4_R8	==	0X08
  1059       0008 C         IOC8	==	0X08
  1060       0008 C         P8IOCR	==	0X08
  1061            C        ;
  1062            C        ;  Bank4 R9 (PORT9 I/O Control Register)
  1063            C        ;
  1064       0009 C         B4_R9	==	0X09
  1065       0009 C         IOC9	==	0X09
  1066       0009 C         P9IOCR	==	0X09
  1067            C        ;
  1068            C        ;  Bank4 RA (PORTA I/O Control Register)
  1069            C        ;
  1070       000A C         B4_RA	==	0X0A
  1071       000A C         IOCA	==	0X0A
  1072       000A C         PAIOCR	==	0X0A
  1073            C        ;
  1074            C        ;  Bank4 RB (PORTB I/O Control Register)
  1075            C        ;
  1076       000B C         B4_RB	==	0X0B
  1077       000B C         IOCB	==	0X0B
  1078       000B C         PBIOCR	==	0X0B
  1079            C        ;
  1080            C        ;  Bank4 RC (PORTC I/O Control Register)
  1081            C        ;
  1082       000C C         B4_RC	==	0X0C
  1083       000C C         IOCC	==	0X0C
  1084       000C C         PCIOCR	==	0X0C
  1085            C        ;
  1086            C        ;  Bank4 RF (Wake Up Control Register)
  1087            C        ;
  1088       000F C         B4_RF	==	0X0F
  1089       000F C         WKCR	==	0X0F
  1090            C        ;
  1091            C        	;{
  1092       0007 C        		INTWK7	==  0X07 ; External Interrupt 7 Wake Up Function Enable Bit.
  1093       0006 C        		INTWK6	==  0X06 ; External Interrupt 6 Wake Up Function Enable Bit.
  1094       0005 C        		INTWK5	==  0X05 ; External Interrupt 5 Wake Up Function Enable Bit.
  1095       0004 C        		INTWK4	==  0X04 ; External Interrupt 4 Wake Up Function Enable Bit.
  1096       0003 C        		INTWK3	==  0X03 ; External Interrupt 3 Wake Up Function Enable Bit.
  1097       0002 C        		INTWK2	==  0X02 ; External Interrupt 2 Wake Up Function Enable Bit.
  1098       0001 C        		INTWK1	==  0X01 ; External Interrupt 1 Wake Up Function Enable Bit.
  1099       0000 C        		INTWK0	==  0X00 ; External Interrupt 0 Wake Up Function Enable Bit.
  1100            C        	;}
  1101            C        ;
  1102            C        ;  Bank4 R6 (UART Control Register 2)
  1103            C        ;
  1104       0006 C         B5_R6	==	0X06
  1105       0006 C         UARC2	==	0X06
  1106            C        ;
  1107            C        	;{
  1108       0005 C        		UARTE	==  0X05  ; UART Function Enable
  1109       0003 C        		UINVEN	==  0X03  ; Enable UART TX and RX Port Inverse Ouput
  1110            C        				  ; other Bits is "0"
  1111            C        	;}
  1112            C        ;
  1113            C        ; Bank5 R7 (PORT7 Pull High Control Register)
  1114            C        ;
  1115       0007 C         B5_R7	==	0X07
  1116       0007 C         P7PHCR	==	0X07
  1117            C        ;
  1118            C        	;{
  1119       0007 C        		PH77	==  0X07 ;
  1120       0006 C        		PH76	==  0X06 ;
  1121       0005 C        		PH75	==  0X05 ;
  1122       0004 C        		PH74	==  0X04 ;
  1123       0003 C        		PH73	==  0X03 ;
  1124       0002 C        		PH72	==  0X02 ;
  1125       0001 C        		PH71	==  0X01 ;
  1126       0000 C        		PH70	==  0X00 ;
  1127            C        	;}
  1128            C        ;
  1129            C        ; Bank5 R8 (PORT8 Pull High Control Register)
  1130            C        ;
  1131       0008 C         B5_R8	==	0X08
  1132       0008 C         P8PHCR	==	0X08
  1133            C        ;
  1134            C        	;{
  1135       0007 C        		PH87	==  0X07 ;
  1136       0006 C        		PH86	==  0X06 ;
  1137       0005 C        		PH85	==  0X05 ;
  1138       0004 C        		PH84	==  0X04 ;
  1139       0003 C        		PH83	==  0X03 ;
  1140       0002 C        		PH82	==  0X02 ;
  1141       0001 C        		PH81	==  0X01 ;
  1142       0000 C        		PH80	==  0X00 ;
  1143            C        	;}
  1144            C        ;
  1145            C        ; Bank5 R9 (PORT9 Pull High Control Register)
  1146            C        ;
  1147       0009 C         B5_R9	==	0X09
  1148       0009 C         P9PHCR	==	0X09
  1149            C        ;
  1150            C        	;{
  1151       0007 C        		PH97	==  0X07 ;
  1152       0006 C        		PH96	==  0X06 ;
  1153       0005 C        		PH95	==  0X05 ;
  1154       0004 C        		PH94	==  0X04 ;
  1155       0003 C        		PH93	==  0X03 ;
  1156       0002 C        		PH92	==  0X02 ;
  1157       0001 C        		PH91	==  0X01 ;
  1158       0000 C        		PH90	==  0X00 ;
  1159            C        	;}
  1160            C        ;
  1161            C        ; Bank5 RA (PORTA Pull High Control Register)
  1162            C        ;
  1163       000A C         B5_RA	==	0X0A
  1164       000A C         PAPHCR	==	0X0A
  1165            C        ;
  1166            C        	;{
  1167       0007 C        		PHA7	==  0X07 ;
  1168       0006 C        		PHA6	==  0X06 ;
  1169       0005 C        		PHA5	==  0X05 ;
  1170       0004 C        		PHA4	==  0X04 ;
  1171       0003 C        		PHA3	==  0X03 ;
  1172       0002 C        		PHA2	==  0X02 ;
  1173       0001 C        		PHA1	==  0X01 ;
  1174       0000 C        		PHA0	==  0X00 ;
  1175            C        	;}
  1176            C        ;
  1177            C        ; Bank5 RB (PORTB Pull High Control Register)
  1178            C        ;
  1179       000B C         B5_RB	==	0X0B
  1180       000B C         PBPHCR	==	0X0B
  1181            C        ;
  1182            C        	;{
  1183       0007 C        		PHB7	==  0X07 ;
  1184       0006 C        		PHB6	==  0X06 ;
  1185       0005 C        		PHB5	==  0X05 ;
  1186       0004 C        		PHB4	==  0X04 ;
  1187       0003 C        		PHB3	==  0X03 ;
  1188       0002 C        		PHB2	==  0X02 ;
  1189       0001 C        		PHB1	==  0X01 ;
  1190       0000 C        		PHB0	==  0X00 ;
  1191            C        	;}
  1192            C        ;
  1193            C        ; Bank5 RC (PORTC Pull High Control Register)
  1194            C        ;
  1195       000C C         B5_RC	==	0X0C
  1196       000C C         PCPHCR	==	0X0C
  1197            C        ;
  1198            C        	;{
  1199       0003 C        		PHC3	==  0X03 ;
  1200       0002 C        		PHC2	==  0X02 ;
  1201       0001 C        		PHC1	==  0X01 ;
  1202       0000 C        		PHC0	==  0X00 ;
  1203            C        				 ; Other Bits is "0"
  1204            C        	;}
  1205            C        ;
  1206            C        ;  Bank6 R6 (Low Voltage Reset Control Register)
  1207            C        ;
  1208       0006 C         B6_R6  ==  0x06
  1209       0006 C         LVRCR  ==  0x06
  1210            C        ;
  1211            C            ;{
  1212       0002 C                LVREN   ==  0x02 ;
  1213       0001 C                LVRS1   ==  0x01 ;
  1214       0000 C                LVRS0   ==  0x00 ;
  1215            C            ;}
  1216            C        
  1217            C        ;  Bank6 R7 (PORT7 Open Drain Control Reister)
  1218            C        ;
  1219       0007 C         B6_R7	==	0X07
  1220       0007 C         P7ODCR	==	0X07
  1221            C        ;
  1222            C        	;{
  1223       0007 C        		P7OD7	==  0X07 ;
  1224       0006 C        		P7OD6	==  0X06 ;
  1225       0005 C        		P7OD5	==  0X05 ;
  1226       0004 C        		P7OD4	==  0X04 ;
  1227       0003 C        		P7OD3	==  0X03 ;
  1228       0002 C        		P7OD2	==  0X02 ;
  1229       0001 C        		P7OD1	==  0X01 ;
  1230       0000 C        		P7OD0	==  0X00 ;
  1231            C        	;}
  1232            C        ;
  1233            C        ;  Bank6 R8 (PORT8 Open Drain Control Reister)
  1234            C        ;
  1235       0008 C         B6_R8	==	0X08
  1236       0008 C         P8ODCR	==	0X08
  1237            C        ;
  1238            C        	;{
  1239       0007 C        		P8OD7	==  0X07 ;
  1240       0006 C        		P8OD6	==  0X06 ;
  1241       0005 C        		P8OD5	==  0X05 ;
  1242       0004 C        		P8OD4	==  0X04 ;
  1243       0003 C        		P8OD3	==  0X03 ;
  1244       0002 C        		P8OD2	==  0X02 ;
  1245       0001 C        		P8OD1	==  0X01 ;
  1246       0000 C        		P8OD0	==  0X00 ;
  1247            C        	;}
  1248            C        ;
  1249            C        ;  Bank6 R9 (PORT9 Open Drain Control Reister)
  1250            C        ;
  1251       0009 C         B6_R9	==	0X09
  1252       0009 C         P9ODCR	==	0X09
  1253            C        ;
  1254            C        	;{
  1255       0007 C        		P9OD7	==  0X07 ;
  1256       0006 C        		P9OD6	==  0X06 ;
  1257       0005 C        		P9OD5	==  0X05 ;
  1258       0004 C        		P9OD4	==  0X04 ;
  1259       0003 C        		P9OD3	==  0X03 ;
  1260       0002 C        		P9OD2	==  0X02 ;
  1261       0001 C        		P9OD1	==  0X01 ;
  1262       0000 C        		P9OD0	==  0X00 ;
  1263            C        	;}
  1264            C        ;
  1265            C        ;  Bank6 RA (PORTA Open Drain Control Reister)
  1266            C        ;
  1267       000A C         B6_RA	==	0X0A
  1268       000A C         PAODCR	==	0X0A
  1269            C        ;
  1270            C        	;{
  1271       0007 C        		PAOD7	==  0X07 ;
  1272       0006 C        		PAOD6	==  0X06 ;
  1273       0005 C        		PAOD5	==  0X05 ;
  1274       0004 C        		PAOD4	==  0X04 ;
  1275       0003 C        		PAOD3	==  0X03 ;
  1276       0002 C        		PAOD2	==  0X02 ;
  1277       0001 C        		PAOD1	==  0X01 ;
  1278       0000 C        		PAOD0	==  0X00 ;
  1279            C        	;}
  1280            C        ;
  1281            C        ;  Bank6 RB (PORTB Open Drain Control Reister)
  1282            C        ;
  1283       000B C         B6_RB	==	0X0B
  1284       000B C         PBODCR	==	0X0B
  1285            C        ;
  1286            C        	;{
  1287       0007 C        		PBOD7	==  0X07 ;
  1288       0006 C        		PBOD6	==  0X06 ;
  1289       0005 C        		PBOD5	==  0X05 ;
  1290       0004 C        		PBOD4	==  0X04 ;
  1291       0003 C        		PBOD3	==  0X03 ;
  1292       0002 C        		PBOD2	==  0X02 ;
  1293       0001 C        		PBOD1	==  0X01 ;
  1294       0000 C        		PBOD0	==  0X00 ;
  1295            C        	;}
  1296            C        ;
  1297            C        ;  Bank6 RC (PORTC Open Drain Control Reister)
  1298            C        ;
  1299       000C C         B6_RC	==	0X0C
  1300       000C C         PCODCR	==	0X0C
  1301            C        ;
  1302            C        	;{
  1303            C        				 ; Other
  1304       0003 C        		PCOD3	==  0X03 ;
  1305       0002 C        		PCOD2	==  0X02 ;
  1306       0001 C        		PCOD1	==  0X01 ;
  1307       0000 C        		PCOD0	==  0X00 ;
  1308            C        	;}
  1309            C        ;
  1310            C        ;======================================================;
  1311            C        ; Register R10~R3F                                     ;
  1312            C        ;======================================================;
  1313            C        ;
  1314            C        ; (R10 ~ R3F): General Purpose Register
  1315            C        ;
  1316       0010 C         R10    ==    0x10
  1317       0011 C         R11    ==    0x11
  1318       0012 C         R12    ==    0x12
  1319       0013 C         R13    ==    0x13
  1320       0014 C         R14    ==    0x14
  1321       0015 C         R15    ==    0x15
  1322       0016 C         R16    ==    0x16
  1323       0017 C         R17    ==    0x17
  1324       0018 C         R18    ==    0x18
  1325       0019 C         R19    ==    0x19
  1326       001A C         R1A    ==    0x1A
  1327       001B C         R1B    ==    0x1B
  1328       001C C         R1C    ==    0x1C
  1329       001D C         R1D    ==    0x1D
  1330       001E C         R1E    ==    0x1E
  1331       001F C         R1F    ==    0x1F
  1332            C        ;
  1333       0020 C         R20    ==    0x20
  1334       0021 C         R21    ==    0x21
  1335       0022 C         R22    ==    0x22
  1336       0023 C         R23    ==    0x23
  1337       0024 C         R24    ==    0x24
  1338       0025 C         R25    ==    0x25
  1339       0026 C         R26    ==    0x26
  1340       0027 C         R27    ==    0x27
  1341       0028 C         R28    ==    0x28
  1342       0029 C         R29    ==    0x29
  1343       002A C         R2A    ==    0x2A
  1344       002B C         R2B    ==    0x2B
  1345       002C C         R2C    ==    0x2C
  1346       002D C         R2D    ==    0x2D
  1347       002E C         R2E    ==    0x2E
  1348       002F C         R2F    ==    0x2F
  1349            C        ;
  1350       0030 C         R30    ==    0x30
  1351       0031 C         R31    ==    0x31
  1352       0032 C         R32    ==    0x32
  1353       0033 C         R33    ==    0x33
  1354       0034 C         R34    ==    0x34
  1355       0035 C         R35    ==    0x35
  1356       0036 C         R36    ==    0x36
  1357       0037 C         R37    ==    0x37
  1358       0038 C         R38    ==    0x38
  1359       0039 C         R39    ==    0x39
  1360       003A C         R3A    ==    0x3A
  1361       003B C         R3B    ==    0x3B
  1362       003C C         R3C    ==    0x3C
  1363       003D C         R3D    ==    0x3D
  1364       003E C         R3E    ==    0x3E
  1365       003F C         R3F    ==    0x3F
  1366            C        
    13                     include "D:\include\EM78xx\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        ;**********************************************************************;
    18            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    19            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    20            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    21            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    22            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    23            C        ; Input:       reg_acc1                                                ;
    24            C        ; Output:      reg_acc3, reg_acc2                                      ;
    25            C        ; Variable Register:None                                               ;
    26            C        ; Register Changed: R3, 0 ;ACC                                         ;
    27            C        ;**********************************************************************;
    28            C        ;-----------------------------------------------------------------
    29            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    30            C        ;
    31            C                CLR     reg_acc2        ;clear BCD data register
    32            C                CLR     reg_acc3
    33            C                MOV     A, reg_acc1
    34            C        $Bin_Bcd1:
    35            C                ADD     A, @156         ;subtract 100 from binary that is transform
    36            C                JBS     STATUS, C       ;borrow bigit?
    37            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    38            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    39            C                JMP     $Bin_Bcd1       ;backing out
    40            C        $Bin_Bcd2:
    41            C                ADD     A, @100         ;100
    42            C                MOV     reg_acc1, A
    43            C        $Bin_Bcd3:
    44            C                ADD     A, @246         ;10
    45            C                JBS     STATUS, C       ;
    46            C                JMP     $Bin_Bcd4       ;
    47            C                INC     reg_acc2        ;BCD1
    48            C                JMP     $Bin_Bcd3
    49            C        $Bin_Bcd4:
    50            C                ADD     A, @10          ;10
    51            C                SWAP    reg_acc2        ;BCDreg_acc2
    52            C                ADD     reg_acc2, A     ;BCDreg_acc2
    53            C                ENDM
    54            C        ;
    55            C        ;**********************************************************************;
    56            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    57            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    58            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    59            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    60            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    61            C        ; Input:       reg_acc1, reg_acc2                                      ;
    62            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    63            C        ; Variable Register:reg_acc, reg_accd                                  ;
    64            C        ; Register Changed: R3, 0; ACC                                         ;
    65            C        ; Status:      1                                                       ;
    66            C        ;**********************************************************************;
    67            C        ;
    68            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    69            C        ;
    70            C                MOV     A, @16          ;(=byte*8)
    71            C                MOV     reg_acc, A
    72            C                CLR     reg_acc5        ;BCD
    73            C                CLR     reg_acc4
    74            C                CLR     reg_acc3
    75            C                BC      STATUS, C       ;R3C
    76            C        $Bin_Bcd1:
    77            C                RLC     reg_acc1        ;
    78            C                RLC     reg_acc2        ;
    79            C                RLC     reg_acc3        ;BCD
    80            C                RLC     reg_acc4
    81            C                RLC     reg_acc5        ;BCD
    82            C                DJZ     reg_acc         ;
    83            C                JMP     $Bin_Bcd2       ;BCD
    84            C                JMP     $Bin_Bcd3       ;
    85            C        $Bin_Bcd2:
    86            C                MOV     A, reg_acc3     ;reg_acc3BCD
    87            C                CALL    $bcdadj         ;BCD
    88            C                MOV     reg_acc3, A     ;
    89            C                MOV     A, reg_acc4     ;reg_acc4BCD
    90            C                CALL    $BCDADJ
    91            C                MOV     reg_acc4, A
    92            C                MOV     A, reg_acc5     ;reg_acc5BCD
    93            C                CALL    $BCDADJ
    94            C                MOV     reg_acc5, A
    95            C                JMP     $Bin_Bcd1       ;
    96            C        ;-------BCD Code Adjust Subprogram---------------
    97            C        $BCDADJ:
    98            C                ADD     A, @51
    99            C                MOV     reg_accd, A
   100            C                JBS     reg_accd, 3
   101            C                ADD     A, @253
   102            C                JBS     reg_accd, 7
   103            C                ADD     A, @208
   104            C                RET
   105            C        $Bin_Bcd3:
   106            C                ENDM
   107            C        ;
   108            C        ;**********************************************************************;
   109            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   110            C        ; Description:reg_acc7BCD                    ;
   111            C        ;             reg_acc4BCD,                     ;
   112            C        ;             reg_acc3                         ;
   113            C        ;             reg_acc1                         ;
   114            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   115            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   116            C        ; Variable Register:reg_acc, reg_accd                                  ;
   117            C        ; Register Changed: R3, 0;ACC                                          ;
   118            C        ; stack:      1                                                        ;
   119            C        ;**********************************************************************;
   120            C        ;
   121            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   122            C        ;
   123            C                MOV     A, @24          ;=byte*8)
   124            C                MOV     reg_acc, A
   125            C                CLR     reg_acc4
   126            C                CLR     reg_acc5
   127            C                CLR     reg_acc6
   128            C                CLR     reg_acc7
   129            C                BC      STATUS, C       ;R3C
   130            C        $Bin_Bcd1:
   131            C                RLC     reg_acc1        ;
   132            C                RLC     reg_acc2
   133            C                RLC     reg_acc3        ;
   134            C                RLC     reg_acc4        ;BCD
   135            C                RLC     reg_acc5
   136            C                RLC     reg_acc6
   137            C                RLC     reg_acc7        ;BCD
   138            C                DJZ     reg_acc         ;
   139            C                JMP     $Bin_Bcd2       ;BCD
   140            C                JMP     $Bin_Bcd3       ;
   141            C        $Bin_Bcd2:
   142            C                MOV     A, reg_acc4     ;reg_acc4BCD
   143            C                CALL    $BCDADJ         ;BCD
   144            C                MOV     reg_acc4, A
   145            C                MOV     A, reg_acc5     ;reg_acc5BCD
   146            C                CALL    $BCDADJ
   147            C                MOV     reg_acc5, A
   148            C                MOV     A, reg_acc6     ;reg_acc6BCD
   149            C                CALL    $BCDADJ
   150            C                MOV     reg_acc6, A
   151            C                MOV     A, reg_acc7     ;reg_acc7BCD
   152            C                CALL    $BCDADJ
   153            C                MOV     reg_acc7, A
   154            C                JMP     $Bin_Bcd1       ;
   155            C        ;-------BCD Code Adjust Subprogram---------------
   156            C        $BCDADJ:
   157            C                ADD     A, @51
   158            C                MOV     reg_accd, A
   159            C                JBS     reg_accd, 3
   160            C                ADD     A, @253
   161            C                JBS     reg_accd, 7
   162            C                ADD     A, @208
   163            C                RET
   164            C        $Bin_Bcd3:
   165            C                ENDM
   166            C        ;
   167            C        ;**********************************************************************;
   168            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   169            C        ; Description:reg_acc9BCD                    ;
   170            C        ;             reg_acc5BCD                    ;
   171            C        ;             reg_acc4                         ;
   172            C        ;             reg_acc1?                          ;
   173            C        ; Arithmetic:                                                          ;
   174            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   175            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   176            C        ; Variable Register:reg_acc, reg_accd                                  ;
   177            C        ; Register Changed: R3, 0; ACC                                         ;
   178            C        ; stack:      1                                                        ;
   179            C        ;**********************************************************************;
   180            C        ;
   181            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   182            C        ;
   183            C                MOV     A,  @32         ;(=byte*8)
   184            C                MOV     reg_acc, A
   185            C                CLR     reg_acc5        ;BCD
   186            C                CLR     reg_acc6
   187            C                CLR     reg_acc7
   188            C                CLR     reg_acc8
   189            C                CLR     reg_acc9
   190            C                BC      STATUS, C       ;R3C
   191            C        $Bin_Bcd1:
   192            C                RLC     reg_acc1        ;
   193            C                RLC     reg_acc2
   194            C                RLC     reg_acc3
   195            C                RLC     reg_acc4        ;
   196            C                RLC     reg_acc5
   197            C                RLC     reg_acc6        ;BCD
   198            C                RLC     reg_acc7
   199            C                RLC     reg_acc8
   200            C                RLC     reg_acc9        ;BCD
   201            C                DJZ     reg_acc         ;
   202            C                JMP     $Bin_Bcd2       ;BCD
   203            C                JMP     $Bin_Bcd3       ;
   204            C        $Bin_Bcd2:
   205            C                MOV     A, reg_acc5     ;reg_acc5BCD
   206            C                CALL    $BCDADJ         ;BCD
   207            C                MOV     reg_acc5, A
   208            C                MOV     A, reg_acc6     ;reg_acc6BCD
   209            C                CALL    $BCDADJ
   210            C                MOV     reg_acc6, A
   211            C                MOV     A, reg_acc7     ;reg_acc7BCD
   212            C                CALL    $BCDADJ
   213            C                MOV     reg_acc7, A
   214            C                MOV     A, reg_acc8     ;reg_acc8BCD
   215            C                CALL    $BCDADJ
   216            C                MOV     reg_acc8, A
   217            C                MOV     A, reg_acc9     ;reg_acc9BCD
   218            C                CALL    $BCDADJ
   219            C                MOV     reg_acc9, A
   220            C                JMP     $Bin_Bcd1       ;
   221            C        ;-------BCD Code Adjust Subprogram---------------
   222            C        $BCDADJ:
   223            C                ADD     A, @51
   224            C                MOV     reg_accd, A
   225            C                JBS     reg_accd, 3
   226            C                ADD     A, @253
   227            C                JBS     reg_accd, 7
   228            C                ADD     A, @208
   229            C                RET
   230            C        $Bin_Bcd3:
   231            C                ENDM
   232            C        ;**********************************************************************;
   233            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   234            C        ; Description:reg_acccBCD                      ;
   235            C        ;             reg_acc6BCD                      ;
   236            C        ;             reg_acc5                         ;
   237            C        ;             reg_acc1                         ;
   238            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   239            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   240            C        ;             reg_accb, reg_accc                                       ;
   241            C        ; Variable Register:reg_acc, reg_accd                                  ;
   242            C        ; Register Changed: R3, 0;ACC                                          ;
   243            C        ; Stack:      1                                                        ;
   244            C        ;**********************************************************************;
   245            C        ;
   246            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   247            C        ;
   248            C                MOV     A,  @40         ;(=byte*8)
   249            C                MOV     reg_acc, A
   250            C                CLR     reg_acc6        ;BCD
   251            C                CLR     reg_acc7
   252            C                CLR     reg_acc8
   253            C                CLR     reg_acc9
   254            C                CLR     reg_acca
   255            C                CLR     reg_accb
   256            C                CLR     reg_accc
   257            C                BC      STATUS, C       ;R3C
   258            C        $Bin_Bcd1:
   259            C                RLC     reg_acc1
   260            C                RLC     reg_acc2
   261            C                RLC     reg_acc3        ;
   262            C                RLC     reg_acc4        ;
   263            C                RLC     reg_acc5        ;
   264            C        ;
   265            C                RLC     reg_acc6        ;BCD
   266            C                RLC     reg_acc7
   267            C                RLC     reg_acc8
   268            C                RLC     reg_acc9
   269            C                RLC     reg_acca
   270            C                RLC     reg_accb
   271            C                RLC     reg_accc        ;BCD
   272            C                DJZ     reg_acc         ;
   273            C                JMP     $Bin_Bcd2       ;BCD
   274            C                JMP     $Bin_Bcd3       ;
   275            C        $Bin_Bcd2:
   276            C                MOV     A, reg_acc6     ;reg_acc6BCD
   277            C                CALL    $BCDADJ         ;BCD
   278            C                MOV     reg_acc6, A
   279            C                MOV     A, reg_acc7     ;reg_acc7BCD
   280            C                CALL    $BCDADJ
   281            C                MOV     reg_acc7, A
   282            C                MOV     A, reg_acc8     ;reg_acc8BCD
   283            C                CALL    $BCDADJ
   284            C                MOV     reg_acc8, A
   285            C                MOV     A, reg_acc9     ;reg_acc9BCD
   286            C                CALL    $BCDADJ
   287            C                MOV     reg_acc9, A
   288            C                MOV     A, reg_acca     ;reg_accaBCD
   289            C                CALL    $BCDADJ
   290            C                MOV     reg_acca, A
   291            C                MOV     A, reg_accb     ;reg_accbBCD
   292            C                CALL    $BCDADJ
   293            C                MOV     reg_accb, A
   294            C                MOV     A, reg_accc     ;reg_acccBCD
   295            C                CALL    $BCDADJ
   296            C                MOV     reg_accc, A
   297            C                JMP     $Bin_Bcd1       ;
   298            C        ;
   299            C        ;-------BCD Code Adjust Subprogram---------------
   300            C        $BCDADJ:
   301            C                ADD     A, @51
   302            C                MOV     reg_accd, A
   303            C                JBS     reg_accd, 3
   304            C                ADD     A, @253
   305            C                JBS     reg_accd, 7
   306            C                ADD     A, @208
   307            C                RET
   308            C        $Bin_Bcd3:
   309            C                ENDM
   310            C        ;
   311            C        ;**********************************************************************;
   312            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   313            C        ; Input:      reg_acc1(BCD code)                                       ;
   314            C        ; Output:     reg_acc2(Binary Code)                                    ;
   315            C        ; Register Changed: STATUS, C;ACC                                      ;
   316            C        ;**********************************************************************;
   317            C        ;
   318            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   319            C        ;
   320            C                CLR     reg_acc2
   321            C                SWAPA   reg_acc1        ;reg_acc1A
   322            C                AND     A, @0X0F        ;reg_acc1, 0-3bit.
   323            C                MOV     reg_acc2, A
   324            C                BC      STATUS, C
   325            C                RLC     reg_acc2        ;reg_acc2*10
   326            C                RLC     reg_acc2
   327            C                ADD     reg_acc2, A
   328            C                RLC     reg_acc2
   329            C                MOV     A, reg_acc1
   330            C                AND     A, @0X0F        ;reg_acc1, 4-7bit
   331            C                ADD     reg_acc2, A     ;bcd code10bcd code
   332            C                ENDM
   333            C        ;
   334            C        ;**********************************************************************;
   335            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   336            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   337            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   338            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   339            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   340            C        ; Register Changed: STATUS, C; ACC                                     ;
   341            C        ; Stack:     1                                                         ;
   342            C        ;**********************************************************************;
   343            C        ;
   344            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   345            C        ;
   346            C                CLR     reg_acc3        ;clear binary code register
   347            C                CLR     reg_acc4
   348            C                MOV     A, @16          ;reg_acc==byte*8)
   349            C                Mov     reg_acc, A
   350            C        $Bcd_Bin1:
   351            C                BC      STATUS, C
   352            C                RRC     reg_acc2        ;BCDBINARY
   353            C                RRC     reg_acc1
   354            C                RRC     reg_acc4
   355            C                RRC     reg_acc3
   356            C                MOV     A, reg_acc1     ;BCDBCD
   357            C                CALL    $Binadj
   358            C                MOV     reg_acc1, A
   359            C                MOV     A, reg_acc2
   360            C                CALL    $Binadj
   361            C                MOV     reg_acc2, A
   362            C                DJZ     reg_acc
   363            C                JMP     $Bcd_Bin1
   364            C                JMP     $Bcd_Bin2
   365            C        $Binadj:
   366            C                MOV     reg_accd, A
   367            C                JBC     reg_accd, 3
   368            C                ADD     A, @253
   369            C                JBC     reg_accd, 7
   370            C                ADD     A, @208
   371            C                RET
   372            C        $Bcd_Bin2:
   373            C                ENDM
   374            C        ;
   375            C        ;**********************************************************************;
   376            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   377            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   378            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   379            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   380            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   381            C        ; Register Changed: STATUS, C; ACC                                     ;
   382            C        ; Stack:     1                                                         ;
   383            C        ;**********************************************************************;
   384            C        ;
   385            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   386            C        ;
   387            C                CLR     reg_acc4
   388            C                CLR     reg_acc5
   389            C                CLR     reg_acc6
   390            C                MOV     A, @24          ;reg_acc==BYTE*8)
   391            C                MOV     reg_acc, A
   392            C        $Bcd_Bin1:
   393            C                BC      STATUS, C
   394            C                RRC     reg_acc3
   395            C                RRC     reg_acc2
   396            C                RRC     reg_acc1
   397            C                RRC     reg_acc6
   398            C                RRC     reg_acc5
   399            C                RRC     reg_acc4
   400            C                MOV     A, reg_acc1
   401            C                CALL    $Binadj
   402            C                MOV     reg_acc1, A
   403            C                MOV     A, reg_acc2
   404            C                CALL    $Binadj
   405            C                MOV     reg_acc2, A
   406            C                MOV     A, reg_acc3
   407            C                CALL    $Binadj
   408            C                MOV     reg_acc3, A
   409            C                DJZ     reg_acc
   410            C                JMP     $Bcd_Bin1
   411            C                JMP     $Bcd_Bin2
   412            C        $Binadj:
   413            C                MOV     reg_accd, A
   414            C                JBC     reg_accd, 3
   415            C                ADD     A, @253
   416            C                JBC     reg_accd, 7
   417            C                ADD     A, @208
   418            C                RET
   419            C        $Bcd_Bin2:
   420            C                ENDM
   421            C        ;
   422            C        ;**********************************************************************;
   423            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   424            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   425            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   426            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   427            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   428            C        ; Register Changed: STATUS, C;ACC                                      ;
   429            C        ; Stack:     1                                                         ;
   430            C        ;**********************************************************************;
   431            C        ;
   432            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   433            C        ;
   434            C                CLR     reg_acc5
   435            C                CLR     reg_acc6
   436            C                CLR     reg_acc7
   437            C                CLR     reg_acc8
   438            C                MOV     A, @32          ;reg_acc==BYTE*8)
   439            C                MOV     reg_acc, A
   440            C        $Bcd_Bin1:
   441            C                BC      STATUS, C
   442            C                RRC     reg_acc4
   443            C                RRC     reg_acc3
   444            C                RRC     reg_acc2
   445            C                RRC     reg_acc1
   446            C                RRC     reg_acc8
   447            C                RRC     reg_acc7
   448            C                RRC     reg_acc6
   449            C                RRC     reg_acc5
   450            C                MOV     A, reg_acc1
   451            C                CALL    $Binadj
   452            C                MOV     reg_acc1, A
   453            C                MOV     A, reg_acc2
   454            C                CALL    $Binadj
   455            C                MOV     reg_acc2, A
   456            C                MOV     A, reg_acc3
   457            C                CALL    $Binadj
   458            C                MOV     reg_acc3, A
   459            C                MOV     A, reg_acc4
   460            C                CALL    $Binadj
   461            C                MOV     reg_acc4, A
   462            C                DJZ     reg_acc
   463            C                JMP     $Bcd_Bin1
   464            C                JMP     $Bcd_Bin2
   465            C        $Binadj:
   466            C                MOV     reg_accd, A
   467            C                JBC     reg_accd, 3
   468            C                ADD     A, @253
   469            C                JBC     reg_accd, 7
   470            C                ADD     A, @208
   471            C                RET
   472            C        $Bcd_Bin2:
   473            C                ENDM
   474            C        ;
   475            C        ;**********************************************************************;
   476            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   477            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   478            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   479            C        ;            Bcd Code.                                                 ;
   480            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   481            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   482            C        ;            Of Binary Code.                                           ;
   483            C        ; Register Changed: STATUS, C; ACC                                     ;
   484            C        ; Stack:     1                                                         ;
   485            C        ;**********************************************************************;
   486            C        ;
   487            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   488            C        ;
   489            C                CLR     reg_acc6
   490            C                CLR     reg_acc7
   491            C                CLR     reg_acc8
   492            C                CLR     reg_acc9
   493            C                CLR     reg_acca
   494            C                MOV     A, @40          ;reg_acc==BYTE*8)
   495            C                MOV     reg_acc, A
   496            C        $Bcd_Bin1:
   497            C                BC      STATUS, C
   498            C                RRC     reg_acc5
   499            C                RRC     reg_acc4
   500            C                RRC     reg_acc3
   501            C                RRC     reg_acc2
   502            C                RRC     reg_acc1
   503            C                RRC     reg_acca
   504            C                RRC     reg_acc9
   505            C                RRC     reg_acc8
   506            C                RRC     reg_acc7
   507            C                RRC     reg_acc6
   508            C                MOV     A, reg_acc1
   509            C                CALL    $Binadj
   510            C                MOV     reg_acc1, A
   511            C                MOV     A, reg_acc2
   512            C                CALL    $Binadj
   513            C                MOV     reg_acc2, A
   514            C                MOV     A, reg_acc3
   515            C                CALL    $Binadj
   516            C                MOV     reg_acc3, A
   517            C                MOV     A, reg_acc4
   518            C                CALL    $Binadj
   519            C                MOV     reg_acc4, A
   520            C                MOV     A, reg_acc5
   521            C                CALL    $Binadj
   522            C                MOV     reg_acc5, A
   523            C                DJZ     reg_acc
   524            C                JMP     $Bcd_Bin1
   525            C                JMP     $Bcd_Bin2
   526            C        $Binadj:
   527            C                MOV     reg_accd, A
   528            C                JBC     reg_accd, 3
   529            C                ADD     A, @253
   530            C                JBC     reg_accd, 7
   531            C                ADD     A, @208
   532            C                RET
   533            C        $Bcd_Bin2:
   534            C                ENDM
   535            C        
   536            C        
   537            C        ;*****************************************************************
   538            C        ;Function:    Subtration
   539            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   540            C        ;Output:      reg_acc2, reg_acc1
   541            C        ;description: reg_acc2/reg_acc1 is the reslut;
   542            C        ;             reg_acc3 is a symbol:
   543            C        ;             0X00 Mean reslut is plus
   544            C        ;             0X01 Mean reslut is negative
   545            C        ;*****************************************************************
   546            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   547            C                BC      STATUS,C
   548            C                MOV     A,reg_acc3
   549            C                SUB     reg_acc1,A
   550            C                JBC     STATUS,C
   551            C                JMP     Subtration_End  
   552            C                CLR     reg_acc3
   553            C                MOV     A,@0X01
   554            C                SUB     A,reg_acc2
   555            C                JBC     STATUS,C
   556            C                DEC     reg_acc2
   557            C                JBC     STATUS,C
   558            C                INC     reg_acc3        
   559            C        Subtration_End:
   560            C                ENDM
   561            C        
   562            C        ;**********************************************************************;
   563            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   564            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   565            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   566            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   567            C        ; Variable Register:None                                               ;
   568            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   569            C        ;**********************************************************************;
   570            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   571            C        ;
   572            C                MOV     A, @8           ;Recurrence Cortrol Data
   573            C                MOV     reg_acc, A
   574            C                CLRA                    ;Check Divisor Is Zero
   575            C                OR      A, reg_acc2     ;Divisor load into A register
   576            C                JBC     STATUS, 2
   577            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   578            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin PerationThen A=1
   579            C        $_Div_Sub:
   580            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   581            C                RLC     reg_acc2
   582            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   583            C                SUB     reg_acc2, a
   584            C                JBC     STATUS, C
   585            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   586            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   587            C                ADD     reg_acc2, A     ;Revert Dividend
   588            C        $_Div_Cnt:
   589            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   590            C                JMP     $_Div_Sub
   591            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   592            C        $_Div_Out:
   593            C                ENDM
   594            C        ;
   595            C        ;**********************************************************************;
   596            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   597            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   598            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   599            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   600            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   601            C        ; Variable Register:None                                               ;
   602            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   603            C        ;**********************************************************************;
   604            C        ;
   605            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   606            C        ;
   607            C                MOV     A, @16          ;Recurrence Cortrol Data
   608            C                MOV     reg_acc, A
   609            C                CLRA                    ;Check Divisor Is Zero
   610            C                OR      A, reg_acc3     ;Divisor load into A register
   611            C                JBC     STATUS, Z
   612            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   613            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin PerationThen A=1
   614            C        $_Div_Sub:
   615            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   616            C                RLC     reg_acc2
   617            C                RLC     reg_acc3
   618            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   619            C                JBS     STATUS, C
   620            C                JMP     $_Div_S_0
   621            C                SUB     reg_acc3, A
   622            C                JMP     $_Div_Cnt
   623            C        $_Div_S_0:
   624            C                SUB     reg_acc3, A
   625            C                JBC     STATUS, C
   626            C                JMP     $_Div_Cnt
   627            C                BC      reg_acc1, 0
   628            C                ADD     reg_acc3, A
   629            C        $_Div_Cnt:
   630            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   631            C                JMP     $_Div_Sub
   632            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   633            C        $_Div_Out:
   634            C                ENDM
   635            C        ;
   636            C        ;**********************************************************************;
   637            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   638            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   639            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   640            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   641            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   642            C        ; Variable Register:None                                               ;
   643            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   644            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   645            C        ;**********************************************************************;
   646            C        ;
   647            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   648            C        ;
   649            C                CLRA
   650            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   651            C                OR      A, reg_acc4
   652            C                JBC     STATUS, Z
   653            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   654            C                MOV     A, @16          ;Recurrence Cortrol Data
   655            C                MOV     reg_acc, A
   656            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1
   657            C                CLR     reg_acc6
   658            C        $_Div_Sub:
   659            C                BC      STATUS, C       ;Clear c Flag
   660            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   661            C                RLC     reg_acc2
   662            C                RLC     reg_acc5
   663            C                RLC     reg_acc6
   664            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   665            C                SUB     A, reg_acc6     ;Check High Word  Equal
   666            C                JBS     STATUS, Z
   667            C                JMP     $_Div_Set
   668            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   669            C                SUB     A, reg_acc5
   670            C        $_Div_Set:
   671            C                JBS     STATUS, C
   672            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   673            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   674            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   675            C                SUB     reg_acc5, A     ;Save Diviso
   676            C                JBS     STATUS, C
   677            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   678            C                MOV     A, reg_acc4
   679            C                SUB     reg_acc6, A
   680            C        $_Div_S_0:
   681            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   682            C                JMP     $_Div_Sub
   683            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   684            C                MOV     reg_acc4, A
   685            C                MOV     A, reg_acc5
   686            C                MOV     reg_acc3, A
   687            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   688            C        $_Div_Out:
   689            C                ENDM
   690            C        ;
   691            C        ;**********************************************************************;
   692            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   693            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   694            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   695            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   696            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   697            C        ; Variable Register:None                                               ;
   698            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   699            C        ;**********************************************************************;
   700            C        ;
   701            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   702            C        ;
   703            C                MOV     A, @24          ;Recurrence Cortrol Data
   704            C                MOV     reg_acc, A
   705            C                CLRA                    ;Check Divisor Is Zero
   706            C                OR      A, reg_acc4     ;Divisor load into A register
   707            C                JBC     STATUS, Z
   708            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   709            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin PerationThen A=1
   710            C        $_Div_Sub:
   711            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   712            C                RLC     reg_acc2
   713            C                RLC     reg_acc3
   714            C                RLC     reg_acc4
   715            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   716            C                JBS     STATUS, C
   717            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   718            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   719            C                JMP     $_Div_Cnt
   720            C        $_Div_S_0:
   721            C                SUB     reg_acc4, A
   722            C                JBC     STATUS, C
   723            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   724            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   725            C                ADD     reg_acc4, A     ;Revert Dividend
   726            C        $_Div_Cnt:
   727            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   728            C                JMP     $_Div_Sub
   729            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   730            C        $_Div_Out:
   731            C                ENDM
   732            C        ;
   733            C        ;**********************************************************************;
   734            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   735            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   736            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   737            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   738            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   739            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   740            C        ;               Remainder reg_acc5, reg_acc4                           ;
   741            C        ; Variable Register: None                                              ;
   742            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   743            C        ;                   , reg_acc7(0x27)                                   ;
   744            C        ;**********************************************************************;
   745            C        ;
   746            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   747            C        ;
   748            C                CLRA
   749            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   750            C                OR      A, reg_acc5
   751            C                JBC     STATUS, Z
   752            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   753            C                MOV     A, @24          ;Recurrence Cortrol Data
   754            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   755            C                CLR     reg_acc6        ;clear Remainder register
   756            C                CLR     reg_acc7
   757            C        $_Div_Sub:
   758            C                BC      STATUS, C       ;Clear c Flag
   759            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   760            C                RLC     reg_acc2
   761            C                RLC     reg_acc3
   762            C                RLC     reg_acc6
   763            C                RLC     reg_acc7
   764            C                JBC     STATUS, C
   765            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   766            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   767            C                SUB     A, reg_acc7     ;Check High Word  Equal
   768            C                JBS     STATUS, Z
   769            C                JMP     $_Div_Set
   770            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   771            C                SUB     A, reg_acc6
   772            C        $_Div_Set:
   773            C                JBS     STATUS, C
   774            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   775            C        $_Div_Set_1:
   776            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   777            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   778            C                SUB     reg_acc6, A     ;Save Diviso
   779            C                JBS     STATUS, C
   780            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   781            C                MOV     A, reg_acc5
   782            C                SUB     reg_acc7, A
   783            C        $_Div_S_0:
   784            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   785            C                JMP     $_Div_Sub
   786            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   787            C                MOV     reg_acc5, A
   788            C                MOV     A, reg_acc6
   789            C                MOV     reg_acc4, A
   790            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   791            C        $_Div_Out:
   792            C                ENDM
   793            C        ;
   794            C        ;**********************************************************************;
   795            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   796            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   797            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   798            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   799            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   800            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   801            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   802            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   803            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   804            C        ; Variable Register:None                                               ;
   805            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   806            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   807            C        ;**********************************************************************;
   808            C        ;
   809            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   810            C        ;
   811            C                CLRA
   812            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   813            C                OR      A, reg_acc5
   814            C                OR      A, reg_acc6
   815            C                JBC     STATUS, Z
   816            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   817            C                MOV     A, @24          ;Recurrence Cortrol Data
   818            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   819            C                CLR     reg_acc7        ;clear Remainder register
   820            C                CLR     reg_acc8
   821            C                CLR     reg_acc9
   822            C        $_Div_Sub:
   823            C                BC      STATUS, C       ;Clear c Flag
   824            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   825            C                RLC     reg_acc2
   826            C                RLC     reg_acc3
   827            C                RLC     reg_acc7
   828            C                RLC     reg_acc8
   829            C                RLC     reg_acc9
   830            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   831            C                SUB     A, reg_acc9     ;Check High Word  Equal
   832            C                JBS     STATUS, Z
   833            C                JMP     $_Div_Set
   834            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   835            C                SUB     A, reg_acc8
   836            C                JBS     STATUS, Z
   837            C                JMP     $_Div_Set
   838            C                MOV     A, reg_acc4
   839            C                SUB     A, reg_acc7
   840            C        $_Div_Set:
   841            C                JBS     STATUS, C
   842            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   843            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   844            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   845            C                SUB     reg_acc7, A     ;Save Diviso
   846            C                JBS     STATUS, C
   847            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   848            C                MOV     A, reg_acc5
   849            C                SUB     reg_acc8, A
   850            C                JBS     STATUS, C
   851            C                DEC     reg_acc9
   852            C                MOV     A, reg_acc6
   853            C                SUB     reg_acc9, A
   854            C        $_Div_S_0:
   855            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   856            C                JMP     $_Div_Sub
   857            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   858            C                MOV     reg_acc6, A
   859            C                MOV     A, reg_acc8
   860            C                MOV     reg_acc5, A
   861            C                MOV     A, reg_acc7
   862            C                MOV     reg_acc4, A
   863            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   864            C        $_Div_Out:
   865            C                ENDM
   866            C        ;
   867            C        ;**********************************************************************;
   868            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   869            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   870            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   871            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   872            C        ;               Divisor   reg_acc5                                     ;
   873            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   874            C        ;               Remainder reg_acc5                                     ;
   875            C        ; Variable Register:None                                               ;
   876            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   877            C        ;**********************************************************************;
   878            C        ;
   879            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   880            C        ;
   881            C                MOV     A, @32          ;Recurrence Cortrol Data
   882            C                MOV     reg_acc, A
   883            C                CLRA                    ;Check Divisor Is Zero
   884            C                OR      A, reg_acc5     ;Divisor load into A register
   885            C                JBC     STATUS, Z
   886            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   887            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1.
   888            C        $_Div_Sub:
   889            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   890            C                RLC     reg_acc2
   891            C                RLC     reg_acc3
   892            C                RLC     reg_acc4
   893            C                RLC     reg_acc5
   894            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   895            C                JBS     STATUS, C
   896            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   897            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   898            C                JMP     $_Div_Cnt
   899            C        $_Div_S_0:
   900            C                SUB     reg_acc5, A
   901            C                JBC     STATUS, C
   902            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   903            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   904            C                ADD     reg_acc5, A     ;Revert Dividend
   905            C        $_Div_Cnt:
   906            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   907            C                JMP     $_Div_Sub
   908            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   909            C        $_Div_Out:
   910            C                ENDM
   911            C        ;
   912            C        ;**********************************************************************;
   913            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   914            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   915            C        ;               (reg_acc6, reg_acc5)                                   ;
   916            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   917            C        ;               --(reg_acc6, reg_acc5)                                 ;
   918            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   919            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   920            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   921            C        ;               Remainder reg_acc6, reg_acc5                           ;
   922            C        ; Variable Register:None                                               ;
   923            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   924            C        ;                   , reg_acc8(0x28)                                   ;
   925            C        ;**********************************************************************;
   926            C        ;
   927            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   928            C        ;
   929            C                CLRA
   930            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   931            C                OR      A, reg_acc5
   932            C                JBC     STATUS, Z
   933            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   934            C                MOV     A, @32          ;Recurrence Cortrol Data
   935            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   936            C                CLR     reg_acc7        ;clear Remainder register
   937            C                CLR     reg_acc8
   938            C        $_Div_Sub:
   939            C                BC      STATUS, C       ;Clear c Flag
   940            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   941            C                RLC     reg_acc2
   942            C                RLC     reg_acc3
   943            C                RLC     reg_acc4
   944            C                RLC     reg_acc7
   945            C                RLC     reg_acc8
   946            C                JBC     STATUS, C
   947            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   948            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   949            C                SUB     A, reg_acc8     ;Check High Word  Equal
   950            C                JBS     STATUS, Z
   951            C                JMP     $_Div_Set
   952            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   953            C                SUB     A, reg_acc7
   954            C        $_Div_Set:
   955            C                JBS     STATUS, C
   956            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   957            C        $_Div_Set_1:
   958            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   959            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   960            C                SUB     reg_acc7, A     ;Save Divisor
   961            C                JBS     STATUS, C
   962            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   963            C                MOV     A, reg_acc6
   964            C                SUB     reg_acc8, A
   965            C        $_Div_S_0:
   966            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   967            C                JMP     $_Div_Sub
   968            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   969            C                MOV     reg_acc6, A
   970            C                MOV     A, reg_acc7
   971            C                MOV     reg_acc5, A
   972            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   973            C        $_Div_Out:
   974            C                ENDM
   975            C        ;
   976            C        ;**********************************************************************;
   977            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   978            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   979            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   980            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   981            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   982            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   983            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   984            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   985            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   986            C        ; Variable Register:None                                               ;
   987            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   988            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   989            C        ;**********************************************************************;
   990            C        ;
   991            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   992            C        ;
   993            C                CLRA
   994            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   995            C                OR      A, reg_acc6
   996            C                OR      A, reg_acc5
   997            C                JBC     STATUS, Z
   998            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   999            C                MOV     A, @32          ;Recurrence Cortrol Data
  1000            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1001            C                CLR     reg_acc8        ;clear Remainder register
  1002            C                CLR     reg_acc9
  1003            C                CLR     reg_acca
  1004            C        $_Div_Sub:
  1005            C                BC      STATUS, 0       ;Clear c Flag
  1006            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1007            C                RLC     reg_acc2
  1008            C                RLC     reg_acc3
  1009            C                RLC     reg_acc4
  1010            C                RLC     reg_acc8
  1011            C                RLC     reg_acc9
  1012            C                RLC     reg_acca
  1013            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1014            C                JMP     $_Div_Set_1
  1015            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1016            C                SUB     A, reg_acca     ;Check High Word  Equal
  1017            C                JBS     STATUS, Z
  1018            C                JMP     $_Div_Set
  1019            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1020            C                SUB     A, reg_acc9
  1021            C                JBS     STATUS, Z
  1022            C                JMP     $_Div_Set
  1023            C                MOV     A, reg_acc5
  1024            C                SUB     A, reg_acc8
  1025            C        $_Div_Set:
  1026            C                JBS     STATUS, C
  1027            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1028            C        $_Div_Set_1:
  1029            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1030            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1031            C                SUB     reg_acc8, A     ;Save Divisor
  1032            C                JBS     STATUS, C
  1033            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1034            C                MOV     A, reg_acc6
  1035            C                SUB     reg_acc9, A
  1036            C                JBS     STATUS, C
  1037            C                DEC     reg_acca
  1038            C                MOV     A, reg_acc7
  1039            C                SUB     reg_acca, A
  1040            C        $_Div_S_0:
  1041            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1042            C                JMP     $_Div_Sub
  1043            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1044            C                MOV     reg_acc7, A
  1045            C                MOV     A, reg_acc9
  1046            C                MOV     reg_acc6, A
  1047            C                MOV     A, reg_acc8
  1048            C                MOV     reg_acc5, A
  1049            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1050            C        $_Div_Out:
  1051            C                ENDM
  1052            C        ;
  1053            C        ;**********************************************************************;
  1054            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1055            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1056            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1057            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1058            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1059            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1060            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1061            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1062            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1063            C        ; Variable Register:None                                               ;
  1064            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1065            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1066            C        ;**********************************************************************;
  1067            C        ;
  1068            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1069            C        ;
  1070            C                CLRA
  1071            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1072            C                OR      A, reg_acc7
  1073            C                OR      A, reg_acc6
  1074            C                OR      A, reg_acc5
  1075            C                JBC     STATUS, Z
  1076            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1077            C                MOV     A, @32          ;Recurrence Cortrol Data
  1078            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1079            C                CLR     reg_acc9        ;clear Remainder register
  1080            C                CLR     reg_acca
  1081            C                CLR     reg_accb
  1082            C                CLR     reg_accc
  1083            C        $_Div_Sub:
  1084            C                BC      STATUS, C       ;Clear c Flag
  1085            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1086            C                RLC     reg_acc2
  1087            C                RLC     reg_acc3
  1088            C                RLC     reg_acc4
  1089            C                RLC     reg_acc9
  1090            C                RLC     reg_acca
  1091            C                RLC     reg_accb
  1092            C                RLC     reg_accc
  1093            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1094            C                SUB     A, reg_accc     ;Check High Word  Equal
  1095            C                JBS     STATUS, Z
  1096            C                JMP     $_Div_Set
  1097            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1098            C                SUB     A, reg_accb
  1099            C                JBS     STATUS, Z
  1100            C                JMP     $_Div_Set
  1101            C                MOV     A, reg_acc6
  1102            C                SUB     A, reg_acca
  1103            C                JBS     STATUS, Z
  1104            C                JMP     $_Div_Set
  1105            C                MOV     A, reg_acc5
  1106            C                SUB     A, reg_acc9
  1107            C        $_Div_Set:
  1108            C                JBS     STATUS, C
  1109            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1110            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1111            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1112            C                SUB     reg_acc9, A     ;Save Divisor
  1113            C                JBS     STATUS, C
  1114            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1115            C                MOV     A, reg_acc6
  1116            C                SUB     reg_acca, A
  1117            C                JBS     STATUS, C
  1118            C                DEC     reg_accb
  1119            C                MOV     A, reg_acc7
  1120            C                SUB     reg_accb, A
  1121            C                JBS     STATUS, C
  1122            C                DEC     reg_accc
  1123            C                MOV     A, reg_acc8
  1124            C                SUB     reg_accc, A
  1125            C        $_Div_S_0:
  1126            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1127            C                JMP     $_Div_Sub
  1128            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1129            C                MOV     reg_acc8, A
  1130            C                MOV     A, reg_accb
  1131            C                MOV     reg_acc7, A
  1132            C                MOV     A, reg_acca
  1133            C                MOV     reg_acc6, A
  1134            C                MOV     A, reg_acc9
  1135            C                MOV     reg_acc5, A
  1136            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1137            C        $_Div_Out:
  1138            C                ENDM
  1139            C        ;
  1140            C        ;**********************************************************************;
  1141            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1142            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1143            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1144            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1145            C        ; Register change:reg_acc                                              ;
  1146            C        ;**********************************************************************;
  1147            C        ;
  1148            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1149            C        ;
  1150            C                MOV     A, @8
  1151            C                MOV     reg_acc, A
  1152            C                MOV     A, reg_acc2
  1153            C                CLR     reg_acc2
  1154            C        $Mul11_Loop:
  1155            C                BC      STATUS, C
  1156            C                JBC     reg_acc1, 0
  1157            C                ADD     reg_acc2, A
  1158            C                RRC     reg_acc2
  1159            C                RRC     reg_acc1
  1160            C        ;
  1161            C                DJZ     reg_acc
  1162            C                JMP     $Mul11_Loop
  1163            C                ENDM
  1164            C        ;
  1165            C        ;**********************************************************************;
  1166            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1167            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1168            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1169            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1170            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Register change:reg_acc                                              ;
  1172            C        ;**********************************************************************;
  1173            C        ;
  1174            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1175            C        ;
  1176            C                MOV     A, @16
  1177            C                MOV     reg_acc, A
  1178            C                MOV     A, reg_acc3
  1179            C                CLR     reg_acc3
  1180            C        $Mul12_Loop:
  1181            C                BC      STATUS, C
  1182            C                JBC     reg_acc1, 0
  1183            C                ADD     reg_acc3, A
  1184            C                RRC     reg_acc3
  1185            C                RRC     reg_acc2
  1186            C                RRC     reg_acc1
  1187            C        ;
  1188            C                DJZ     reg_acc
  1189            C                JMP     $Mul12_Loop
  1190            C                ENDM
  1191            C        ;
  1192            C        ;**********************************************************************;
  1193            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1194            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1195            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1196            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1197            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Register change:reg_acc                                              ;
  1199            C        ;**********************************************************************;
  1200            C        ;
  1201            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1202            C        ;
  1203            C                MOV     A, @24
  1204            C                MOV     reg_acc, A
  1205            C                MOV     A, reg_acc4
  1206            C                CLR     reg_acc4
  1207            C        $Mul13_Loop:
  1208            C                BC      STATUS, C
  1209            C                JBC     reg_acc1, 0
  1210            C                ADD     reg_acc4, A
  1211            C                RRC     reg_acc4
  1212            C                RRC     reg_acc3
  1213            C                RRC     reg_acc2
  1214            C                RRC     reg_acc1
  1215            C        ;
  1216            C                DJZ     reg_acc
  1217            C                JMP     $Mul13_Loop
  1218            C                ENDM
  1219            C        ;
  1220            C        ;**********************************************************************;
  1221            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1222            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1223            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1224            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1225            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Register change:reg_acc                                              ;
  1227            C        ;**********************************************************************;
  1228            C        ;
  1229            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1230            C        ;
  1231            C                MOV     A, @32
  1232            C                MOV     reg_acc, A
  1233            C                MOV     A, reg_acc5
  1234            C                CLR     reg_acc5
  1235            C        $Mul14_Loop:
  1236            C                BC      STATUS, C
  1237            C                JBC     reg_acc1, 0
  1238            C                ADD     reg_acc5, A
  1239            C                RRC     reg_acc5
  1240            C                RRC     reg_acc4
  1241            C                RRC     reg_acc3
  1242            C                RRC     reg_acc2
  1243            C                RRC     reg_acc1
  1244            C        ;
  1245            C                DJZ     reg_acc
  1246            C                JMP     $Mul14_Loop
  1247            C                ENDM
  1248            C        ;
  1249            C        ;**********************************************************************;
  1250            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1251            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1252            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1253            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1254            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1256            C        ;**********************************************************************;
  1257            C        ;
  1258            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1259            C        ;
  1260            C                MOV     A, @16
  1261            C                MOV     reg_acc, A
  1262            C                MOV     A, reg_acc4
  1263            C                MOV     reg_acc6, A
  1264            C                MOV     A, reg_acc3
  1265            C                MOV     reg_acc5, A
  1266            C                CLR     reg_acc3
  1267            C                CLR     reg_acc4
  1268            C        $Mul22_Loop:
  1269            C                BC      STATUS, C
  1270            C                JBS     reg_acc1, 0
  1271            C                JMP     $Mul22_Rs
  1272            C                MOV     A, reg_acc5
  1273            C                ADD     reg_acc3, A
  1274            C        ;--------------------------------------
  1275            C                MOV     A, reg_acc4
  1276            C                JBC     STATUS, C
  1277            C                ADD     A, @1
  1278            C                RLC     reg_acc
  1279            C                ADD     A, reg_acc6
  1280            C                MOV     reg_acc4, A
  1281            C                JBC     STATUS, C
  1282            C                BS      reg_acc, 0
  1283            C                RRC     reg_acc
  1284            C        $Mul22_Rs:
  1285            C                RRC     reg_acc4
  1286            C                RRC     reg_acc3
  1287            C                RRC     reg_acc2
  1288            C                RRC     reg_acc1
  1289            C        ;
  1290            C                BC      reg_acc, 7
  1291            C                DJZ     reg_acc
  1292            C                JMP     $Mul22_Loop
  1293            C                ENDM
  1294            C        ;
  1295            C        ;**********************************************************************;
  1296            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1297            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1298            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1299            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1300            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1302            C        ;**********************************************************************;
  1303            C        ;
  1304            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1305            C        ;
  1306            C                MOV     A, @24
  1307            C                MOV     reg_acc, A
  1308            C                MOV     A, reg_acc5
  1309            C                MOV     reg_acc7, A
  1310            C                MOV     A, reg_acc4
  1311            C                MOV     reg_acc6, A
  1312            C                CLR     reg_acc4
  1313            C                CLR     reg_acc5
  1314            C        $Mul23_Loop:
  1315            C                BC      STATUS, C
  1316            C                JBS     reg_acc1, 0
  1317            C                JMP     $Mul23_Rs
  1318            C                MOV     A, reg_acc6
  1319            C                ADD     reg_acc4, A
  1320            C        ;--------------------------------------
  1321            C                MOV     A, reg_acc5
  1322            C                JBC     STATUS, C
  1323            C                ADD     A, @1
  1324            C                RLC     reg_acc
  1325            C                ADD     A, reg_acc7
  1326            C                MOV     reg_acc5, A
  1327            C                JBC     STATUS, C
  1328            C                BS      reg_acc, 0
  1329            C                RRC     reg_acc
  1330            C        $Mul23_Rs:
  1331            C                RRC     reg_acc5
  1332            C                RRC     reg_acc4
  1333            C                RRC     reg_acc3
  1334            C                RRC     reg_acc2
  1335            C                RRC     reg_acc1
  1336            C        ;
  1337            C                BC      reg_acc, 7
  1338            C                DJZ     reg_acc
  1339            C                JMP     $Mul23_Loop
  1340            C                ENDM
  1341            C        ;
  1342            C        ;**********************************************************************;
  1343            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1344            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1345            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1346            C        ;                 , reg_acc2, reg_acc1)                                ;
  1347            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1348            C        ;                 reg_acc6                                             ;
  1349            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1350            C        ;                 reg_acc6                                             ;
  1351            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1352            C        ;**********************************************************************;
  1353            C        ;
  1354            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1355            C        ;
  1356            C                MOV     A, @32
  1357            C                MOV     reg_acc, A
  1358            C                MOV     A, reg_acc6
  1359            C                MOV     reg_acc8, A
  1360            C                MOV     A, reg_acc5
  1361            C                MOV     reg_acc7, A
  1362            C                CLR     reg_acc5
  1363            C                CLR     reg_acc6
  1364            C        $Mul24_Loop:
  1365            C                BC      STATUS, C
  1366            C                JBS     reg_acc1, 0
  1367            C                JMP     $Mul24_Rs
  1368            C                MOV     A, reg_acc7
  1369            C                ADD     reg_acc5, A
  1370            C        ;--------------------------------------
  1371            C                MOV     A, reg_acc6
  1372            C                JBC     STATUS, C
  1373            C                ADD     A, @1
  1374            C                RLC     reg_acc
  1375            C                ADD     A, reg_acc8
  1376            C                MOV     reg_acc6, A
  1377            C                JBC     STATUS, C
  1378            C                BS      reg_acc, 0
  1379            C                RRC     reg_acc
  1380            C        $Mul24_Rs:
  1381            C                RRC     reg_acc6
  1382            C                RRC     reg_acc5
  1383            C                RRC     reg_acc4
  1384            C                RRC     reg_acc3
  1385            C                RRC     reg_acc2
  1386            C                RRC     reg_acc1
  1387            C        ;
  1388            C                BC      reg_acc, 7
  1389            C                DJZ     reg_acc
  1390            C                JMP     $Mul24_Loop
  1391            C                ENDM
  1392            C        ;
  1393            C        ;**********************************************************************;
  1394            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1395            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1396            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1397            C        ;                 , reg_acc2, reg_acc1)                                ;
  1398            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1399            C        ;                 , reg_acc6                                           ;
  1400            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1401            C        ;                 , reg_acc6                                           ;
  1402            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1403            C        ;**********************************************************************;
  1404            C        ;
  1405            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1406            C        ;
  1407            C                MOV     A, @24
  1408            C                MOV     reg_acc, A
  1409            C                MOV     A, reg_acc4
  1410            C                MOV     reg_acc7, A
  1411            C                MOV     A, reg_acc5
  1412            C                MOV     reg_acc8, A
  1413            C                MOV     A, reg_acc6
  1414            C                MOV     reg_acc9, A
  1415            C                CLR     reg_acc4
  1416            C                CLR     reg_acc5
  1417            C                CLR     reg_acc6
  1418            C        $Mul33_Loop:
  1419            C                BC      STATUS, C
  1420            C                JBS     reg_acc1, 0
  1421            C                JMP     $Mul33_Rs
  1422            C                MOV     A, reg_acc7
  1423            C                ADD     reg_acc4, A
  1424            C        ;--------------------------------------
  1425            C                MOV     A, reg_acc5
  1426            C                JBC     STATUS, C
  1427            C                ADD     A, @1
  1428            C                RLC     reg_acc
  1429            C                ADD     A, reg_acc8
  1430            C                MOV     reg_acc5, A
  1431            C                JBC     STATUS, C
  1432            C                BS      reg_acc, 0
  1433            C                RRC     reg_acc
  1434            C        ;--------------------------------------
  1435            C                MOV     A, reg_acc6
  1436            C                JBC     STATUS, C
  1437            C                ADD     A, @1
  1438            C                RLC     reg_acc
  1439            C                ADD     A, reg_acc9
  1440            C                MOV     reg_acc6, A
  1441            C                JBC     STATUS, C
  1442            C                BS      reg_acc, 0
  1443            C                RRC     reg_acc
  1444            C        $Mul33_Rs:
  1445            C                RRC     reg_acc6
  1446            C                RRC     reg_acc5
  1447            C                RRC     reg_acc4
  1448            C                RRC     reg_acc3
  1449            C                RRC     reg_acc2
  1450            C                RRC     reg_acc1
  1451            C        ;
  1452            C                BC      reg_acc, 7
  1453            C                DJZ     reg_acc
  1454            C                JMP     $Mul33_Loop
  1455            C                ENDM
  1456            C        ;
  1457            C        ;**********************************************************************;
  1458            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1459            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1460            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1461            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1462            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1463            C        ;                 , reg_acc6, reg_acc7                                 ;
  1464            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1465            C        ;                 , reg_acc6, reg_acc7                                 ;
  1466            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1467            C        ;**********************************************************************;
  1468            C        ;
  1469            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1470            C        ;
  1471            C                MOV     A, @32
  1472            C                MOV     reg_acc, A
  1473            C                MOV     A, reg_acc5
  1474            C                MOV     reg_acc8, A
  1475            C                MOV     A, reg_acc6
  1476            C                MOV     reg_acc9, A
  1477            C                MOV     A, reg_acc7
  1478            C                MOV     reg_acca, A
  1479            C                CLR     reg_acc5
  1480            C                CLR     reg_acc6
  1481            C                CLR     reg_acc7
  1482            C        $Mul34_Loop:
  1483            C                BC      STATUS, C
  1484            C                JBS     reg_acc1, 0
  1485            C                JMP     $Mul34_Rs
  1486            C                MOV     A, reg_acc8
  1487            C                ADD     reg_acc5, A
  1488            C        ;--------------------------------------
  1489            C                MOV     A, reg_acc6
  1490            C                JBC     STATUS, C
  1491            C                ADD     A, @1
  1492            C                RLC     reg_acc
  1493            C                ADD     A, reg_acc9
  1494            C                MOV     reg_acc6, A
  1495            C                JBC     STATUS, C
  1496            C                BS      reg_acc, 0
  1497            C                RRC     reg_acc
  1498            C        ;--------------------------------------
  1499            C                MOV     A, reg_acc7
  1500            C                JBC     STATUS, C
  1501            C                ADD     A, @1
  1502            C                RLC     reg_acc
  1503            C                ADD     A, reg_acca
  1504            C                MOV     reg_acc7, A
  1505            C                JBC     STATUS, C
  1506            C                BS      reg_acc, 0
  1507            C                RRC     reg_acc
  1508            C        $Mul34_Rs:
  1509            C                RRC     reg_acc7
  1510            C                RRC     reg_acc6
  1511            C                RRC     reg_acc5
  1512            C                RRC     reg_acc4
  1513            C                RRC     reg_acc3
  1514            C                RRC     reg_acc2
  1515            C                RRC     reg_acc1
  1516            C        ;
  1517            C                BC      reg_acc, 7
  1518            C                DJZ     reg_acc
  1519            C                JMP     $Mul34_Loop
  1520            C                ENDM
  1521            C        ;
  1522            C        ;**********************************************************************;
  1523            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1524            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1525            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1526            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1527            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1528            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1529            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1530            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1531            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1532            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1533            C        ;**********************************************************************;
  1534            C        ;
  1535            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1536            C        ;
  1537            C                MOV     A, @32
  1538            C                MOV     reg_acc, A
  1539            C                MOV     A, reg_acc5
  1540            C                MOV     reg_acc9, A
  1541            C                MOV     A, reg_acc6
  1542            C                MOV     reg_acca, A
  1543            C                MOV     A, reg_acc7
  1544            C                MOV     reg_accb, A
  1545            C                MOV     A, reg_acc8
  1546            C                MOV     reg_accc, A
  1547            C                CLR     reg_acc5
  1548            C                CLR     reg_acc6
  1549            C                CLR     reg_acc7
  1550            C                CLR     reg_acc8
  1551            C        $Mul44_Loop:
  1552            C                BC      STATUS, C
  1553            C                JBS     reg_acc1, 0
  1554            C                JMP     $Mul44_Rs
  1555            C                MOV     A, reg_acc9
  1556            C                ADD     reg_acc5, A
  1557            C        ;--------------------------------------
  1558            C                MOV     A, reg_acc6
  1559            C                JBC     STATUS, C
  1560            C                ADD     A, @1
  1561            C                RLC     reg_acc
  1562            C                ADD     A, reg_acca
  1563            C                MOV     reg_acc6, A
  1564            C                JBC     STATUS, C
  1565            C                BS      reg_acc, 0
  1566            C                RRC     reg_acc
  1567            C        ;--------------------------------------
  1568            C                MOV     A, reg_acc7
  1569            C                JBC     STATUS, C
  1570            C                ADD     A, @1
  1571            C                RLC     reg_acc
  1572            C                ADD     A, reg_accb
  1573            C                MOV     reg_acc7, A
  1574            C                JBC     STATUS, C
  1575            C                BS      reg_acc, 0
  1576            C                RRC     reg_acc
  1577            C        ;--------------------------------------
  1578            C                MOV     A, reg_acc8
  1579            C                JBC     STATUS, C
  1580            C                ADD     A, @1
  1581            C                RLC     reg_acc
  1582            C                ADD     A, reg_accc
  1583            C                MOV     reg_acc8, A
  1584            C                JBC     STATUS, C
  1585            C                BS      reg_acc, 0
  1586            C                RRC     reg_acc
  1587            C        $Mul44_Rs:
  1588            C                RRC     reg_acc8
  1589            C                RRC     reg_acc7
  1590            C                RRC     reg_acc6
  1591            C                RRC     reg_acc5
  1592            C                RRC     reg_acc4
  1593            C                RRC     reg_acc3
  1594            C                RRC     reg_acc2
  1595            C                RRC     reg_acc1
  1596            C        ;
  1597            C                BC      reg_acc, 7
  1598            C                DJZ     reg_acc
  1599            C                JMP     $Mul44_Loop
  1600            C                ENDM
  1601            C        
  1602            C        
  1603            C        
  1604            C        ;*****************************************************************
  1605            C        ;Function:    generat random data
  1606            C        ;Input:       @banksel,@address,@length
  1607            C        ;Output:      rang by address which is the lowest address
  1608            C        ;description: used common register temp,temp1,temp2 for operation
  1609            C        ;             rand address must be in the same bank
  1610            C        ;             TEMP:  Operate Data TEMP
  1611            C        ;             TEMP1:
  1612            C        ;             TEMP2:
  1613            C        ;*****************************************************************
  1614            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1615            C        	MOV         TEMP,A
  1616            C        	BANK        @BankSel
  1617            C        	MOV         A,Address
  1618            C        	ADD         TEMP,A        ; save latest data as current seed
  1619            C        
  1620            C        	CLR         RSR
  1621            C        $_RAND_SEED_LOOP1:
  1622            C        	MOV         A,R0
  1623            C        	ADD         TEMP,A        ; seed
  1624            C        
  1625            C        	RLC         TEMP          ; x*y+1 MOD z
  1626            C        	RLC         TEMP
  1627            C        	RLC         TEMP
  1628            C        	INC         TEMP
  1629            C        	RRC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	JBS         STATUS,C
  1633            C        	BC          TEMP,0
  1634            C        	JBC         STATUS,C
  1635            C        	BS          TEMP,0
  1636            C        
  1637            C        	INC         RSR
  1638            C        	MOV         A,RSR
  1639            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1640            C        	XOR         A,@0X40
  1641            C        	JBS         STATUS,Z
  1642            C        	JMP         $_RAND_SEED_LOOP1
  1643            C        	MOV         A,R0
  1644            C        	ADD         TEMP,A          ;next seed
  1645            C        
  1646            C        	MOV         A,@length
  1647            C        	MOV         TEMP1,A
  1648            C        	MOV         A,@Address
  1649            C        	MOV         TEMP2,A
  1650            C        	MOV         RSR,A
  1651            C        	BANK        @BankSel
  1652            C        	MOV         A,RSR
  1653            C        	MOV         TEMP2,A       ; save address base
  1654            C        	MESSAGE     "adding form 0x00 to bank 0"
  1655            C        
  1656            C        $_RAND_DATA_LOOP1:
  1657            C        	MOV         A,TEMP2
  1658            C        	MOV         RSR,A
  1659            C        	MOV         A,TEMP
  1660            C        	MOV         R0,A
  1661            C        
  1662            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1663            C        	RLC         TEMP
  1664            C        	RLC         TEMP
  1665            C        	INC         TEMP
  1666            C        	RRC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	JBS         STATUS,C
  1670            C        	BC          TEMP,0
  1671            C        	JBC         STATUS,C
  1672            C        	BS          TEMP,0
  1673            C        
  1674            C        	INC         TEMP2
  1675            C        	DJZ         TEMP1
  1676            C        	JMP         $_RAND_DATA_LOOP1:
  1677            C        	NOP
  1678            C        
  1679            C        ENDM
  1680            C        
    14                     include "D:\include\EM78xx\EM78CtrlIns.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 
   284            C        ; :,ACC,R3
   285            C        ; A      -> A_TEMP
   286            C        ; RSR    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;RSR              ;SAVE RSR(R4)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;RSR              ;SAVE RSR(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;RSR,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;RSR,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;=================== EM78P520 ======================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;RSR              ;SAVE RSR(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;RSR,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ; 
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; 
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; 
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; 
   426            C        ; :NUM = ,  ADDRESS =  B
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; 
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ;
   460            C        ; :NUM = ,  ADDRESS =  B
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; 
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C        	MOV     A, @0XE0        ; RAM 
   513            C        	MOV     R4, A           ;
   514            C        	CLR     BSR
   515            C        	;INC     BSR            ; BANK 0 is used for exchange reg(FIFO)
   516            C        ;CLEAR_RAM_LOOP_P510:
   517            C        	WDTC
   518            C        	CLR     R0
   519            C        	INC     R4
   520            C        	MOV     A, R4
   521            C        	AND     A, @0X3F
   522            C        	JBS     R3, Z
   523            C        	JMP     $-5            ; CLEAR_RAM_LOOP_P510
   524            C        	INC     BSR
   525            C        	MOV     A, BSR         ; BANK0 (BSR == 0X05)
   526            C        	AND     A, @0X07
   527            C        	BS      R4, 5
   528            C        	BS      R4, 6
   529            C        	JBS     R3, 2
   530            C        	JMP     $-13           ; CLEAR_RAM_LOOP_P510
   531            C        	CLR     R4
   532            C        	CLR     BSR
   533            C        	BS      R4,6
   534            C        
   535            C        ELSEIFDEF EM78M611.H
   536            C        	CLR     RC
   537            C        	CLR     RD
   538            C        	CLR     0X10
   539            C        	MOV     A,@0X2F
   540            C        	MOV     0X10,A
   541            C        
   542            C        	MOV     A,@0X11
   543            C        	MOV     RSR,A
   544            C        ;CLRLOOPU1:
   545            C        	CLR     R0
   546            C        	INC     RSR
   547            C        	DJZ     0X10
   548            C        	JMP     $-3        ;CLRLOOPU1
   549            C            CLR     R0
   550            C        	MOV     A,@0X20
   551            C        	MOV     0X10,A
   552            C        	MOV     A,@0X60
   553            C        	MOV     RSR,A
   554            C        
   555            C        ;CLRLOOPU2:
   556            C        	CLR     R0
   557            C        	INC     RSR
   558            C        	DJZ     0X10
   559            C        	JMP     $-3             ;CLRLOOPU2
   560            C        
   561            C        	CLR     R0
   562            C        	MOV     A,@0X20
   563            C        	MOV     0X10,A
   564            C        	MOV     A,@0XA0
   565            C        	MOV     RSR,A
   566            C        
   567            C        ;CLRLOOPU3:
   568            C        	CLR     R0
   569            C        	INC     RSR
   570            C        	DJZ     0X10
   571            C        	JMP     $-3            ;CLRLOOPU3
   572            C        	CLR     R0
   573            C        
   574            C        	MOV     A,@0X11
   575            C        	MOV     RD,A
   576            C        	CLR     RE
   577            C        	MOV     A,@1
   578            C        	MOV     RD,A
   579            C        	MOV     A,@0X00
   580            C        	MOV     RE,A
   581            C        	MOV     RE,A
   582            C        	MOV     RE,A
   583            C        	MOV     RE,A
   584            C        	MOV     RE,A
   585            C        	MOV     RE,A
   586            C        	MOV     RE,A
   587            C        	MOV     RE,A
   588            C        	BS      RC,5
   589            C        
   590            C        
   591            C        ELSEIFDEF EM78P447.H
   592            C         	MOV     A,@0x10
   593            C        	MOV     R4,A
   594            C        ;CLEAR_RAM_LOOP_P447:
   595            C        	CLR     R0
   596            C        	INC     R4
   597            C        	JBC     R4,6
   598            C        	BS      R4,5
   599            C        	JBC     R4,7
   600            C        	BS      R4,5
   601            C        	JBS     R3,Z
   602            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P447:
   603            C        	CLR     R4
   604            C        
   605            C        ELSEIFDEF EM78P468.H
   606            C        	MOV     A,@0X10
   607            C        	MOV     RSR,A
   608            C        ;CLEAR_RAM_LOOP_P468:
   609            C        	CLR     R0
   610            C        	INC     RSR
   611            C        	JBC     RSR,6
   612            C        	BS      RSR,5
   613            C        	JBC     RSR,7
   614            C        	BS      RSR,5
   615            C        	JBS     STATUS,Z
   616            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P468
   617            C        	CLR     RSR
   618            C        
   619            C        ELSEIFDEF EM78P458.H
   620            C                MOV     A,@0X10
   621            C                MOV     RSR,A
   622            C        ;CLEAR_RAM_LOOP_P458:
   623            C                CLR     R0
   624            C                INC     RSR
   625            C                JBC     RSR,6
   626            C                BS      RSR,5
   627            C                JBS     RSR,7
   628            C                JMP     $-5        ; CLEAR_RAM_LOOP_P458
   629            C                CLR     RSR
   630            C        
   631            C        ELSEIFDEF EM78P451.H
   632            C                MOV     A,@0X10
   633            C                MOV     RSR,A
   634            C        ;CLEAR_RAM_LOOP_P451:
   635            C                CLR     R0
   636            C                INC     RSR
   637            C                JBC     RSR,6
   638            C                BS      RSR,5
   639            C                JBC     RSR,7
   640            C                BS      RSR,5
   641            C                JBS     STATUS,Z
   642            C                JMP     $-7        ; CLEAR_RAM_LOOP_P451
   643            C        
   644            C        ELSE
   645            C        	MOV     A,@0x10        ; clear all ram bank
   646            C        	MOV     R4,A
   647            C        ;CLEAR_RAM_LOOP:
   648            C        	CLR     R0
   649            C        	INC     R4
   650            C        	JBC     R4,6
   651            C        	BS      R4,5
   652            C        	JBC     R4,7
   653            C        	BS      R4,5
   654            C        	JBS     R3,Z
   655            C        	JMP     $-7            ; CLEAR_RAM_LOOP:
   656            C        	CLR     R4
   657            C        	MESSAGE "Clear all RAM bank"
   658            C        ENDIF
   659            C        ENDM
   660            C        
   661            C        ;*******************************************
   662            C        ; RAM clear function
   663            C        ; [ELSE]: default the MCU have four bank
   664            C        ; others: xx.h must be define in "xx.h"
   665            C        ;*******************************************
   666            C        ClrCommRamBank MACRO
   667            C        	MOV                 A, @0X10                ; RAM 
   668            C        	MOV                 R4, A
   669            C        CLEAR_10_1F_RAM_LOOP:
   670            C        	WDTC
   671            C        	CLR                 R0
   672            C        	INC                 R4
   673            C        	MOV                 A,@0B00111111
   674            C        	AND                 A,R4
   675            C        	SUB                 A,@0X1F
   676            C        	JBC                 R3,C
   677            C        	JMP                 CLEAR_10_1F_RAM_LOOP
   678            C        	CLR                 R4
   679            C        ENDM
   680            C        
   681            C        
    15                     include "config.h"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        ; Company       : ELAN
     5            C        ; VERSION       : 1.1
     6            C        ; CRYSTAL       : 8MHZ
     7            C        ; Creat date    : 2009/11/4
     8            C        ; tool ver.     : WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-------------------------------------------------------------------------
    12            C        config.h   EQU    config.h
    13            C        
    14            C        ;-------------------------------------------------------------------------
    15            C        
    16       0000 C        USED_PID_FUNCTION               EQU     0     ; 1:used this function; 0:not used
    17       0020 C        DataBufferBase                  EQU     0x20  ; address:0x20 ,bit6:select all bank
    18       0002 C        DelayTime                       EQU     2     ; Delay Time
    19       0004 C        ComuSyncTime                    EQU     4     ; 4ms sync header time
    20       0004 C        ComuTime                        EQU     4     ; 4ms Communicte System
    21       0000 C        RetryCNT                        EQU     0     ; transmit 2 Times
    22       00FA C        SetSleepTime                    EQU     250   ; Into sleep Time=(SetSleepTime+1)*2s
    23       009D C        RX_IDH_DEFAULT                  EQU     0X9D  
    24       00BC C        RX_IDL_DEFAULT                  EQU     0XBC  ; Adress_default =  [RX_IDH_DEFAULT,RX_IDL_DEFAULT&0x0f]
    25       0003 C        LossframeSum                    EQU     3
    26       0032 C        LEDTwinklingFreq                EQU     50    ; T=LEDTwinklingFreq*(ComuSyncTime+n*ComuTime), default=400ms
    27            C        
    28            C        
    29            C        
    16                     include "P520txP44.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.1
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/4
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;  Description: PAGE0(0X0000-0X03FF): MCU initial
    12            C        ;               PAGE1(0X0400-0X07FF): searchmode
    13            C        ;               PAGE2(0X0800-0X0BFF): normalmode
    14            C        ;               PAGE3(0X0C00-0X0FFF): RF driver
    15            C        ;               PAGE4(0X1000-0X13FF): key scan driver
    16            C        ;               PAGE5(0X1400-0X17FF): CMOS driver
    17            C        ;               PAGE6(0X1800-0X1BFF): CMOS/GS driver
    18            C        ;               PAGE7(0X1C00-0X1FFF): Kalman Filter arithmetic
    19            C        
    20            C        ;========================================================================
    21            C        P520txP44.H                EQU     P520txP44.H
    22            C        
    23            C        
    24            C        
    25            C        ;========================================================================
    26       0010 C        TEMP                            EQU     0X10
    27       0011 C        TEMP1                           EQU     0X11
    28       0012 C        TEMP2                           EQU     0X12
    29       0013 C        TEMP3                           EQU     0X13
    30       0014 C        TEMP4                           EQU     0X14
    31       0015 C        TEMP5                           EQU     0X15
    32       0016 C        TEMP6                           EQU     0X16
    33            C        
    34       0017 C        ComuClock                       EQU     0X17  ;communicateion clock
    35       0018 C        ComuCycleNum                    EQU     0X18  ;communicateion time
    36       0019 C        ComuEndNum                      EQU     0X19  ;communicateion end time
    37       001A C        Databytelength                  EQU     0X1A  ;FIFO READ/WRITE DATA LENGTH
    38       001B C        DataShiftCounter                EQU     0X1B  ;data counter
    39       001C C        SleepCNT                        EQU     0X1C  ;data conunter
    40            C        
    41       001D C        GeneralStatusFlag1              EQU     0X1D
    42       01D7 C        	RFInitialFailFlag           ==      GeneralStatusFlag1*16+7 ;
    43       01D6 C        	RFInitialOKFlag             ==      GeneralStatusFlag1*16+6
    44       01D5 C        	RFTestFailFlag              ==      GeneralStatusFlag1*16+5
    45       01D1 C        	IntoSleepFlag               ==      GeneralStatusFlag1*16+1
    46       01D0 C        	ToWakeupFlag                ==      GeneralStatusFlag1*16+0
    47            C        
    48       001E C        GeneralStatusFlag2              EQU     0X1E
    49            C        	;System2sFlag                ==      GeneralStatusFlag2*16+7	
    50       01E6 C        	System16msFlag              ==      GeneralStatusFlag2*16+6
    51            C        	;System8msFlag               ==      GeneralStatusFlag2*16+5
    52       01E3 C        	KeyScanFinishFlag           ==      GeneralStatusFlag2*16+3
    53       01E2 C        	KeyStatusFlag               ==      GeneralStatusFlag2*16+2
    54       01E1 C        	KeyScanStatusFlag           ==      GeneralStatusFlag2*16+1
    55       01E0 C        	ReadLengthError             ==      GeneralStatusFlag2*16+0
    56            C        
    57       001F C        CommuStatusFlag                 EQU     0X1F
    58       01F7 C        	DescriptorFinishFlag        ==      CommuStatusFlag*16+7   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    59       01F6 C        	FccTestModeFlag             ==      CommuStatusFlag*16+6
    60       01F5 C        	ForceLinkModeFlag           ==      CommuStatusFlag*16+5   ; force link flag
    61       01F4 C        	LinkModeFlag                ==      CommuStatusFlag*16+4   ; link flag
    62       01F3 C        	EEpromWRStatusFlag          ==      CommuStatusFlag*16+3
    63       01F2 C        	LoseFrameStatusFlag         ==      CommuStatusFlag*16+2   ; lose frequency and search mode flag
    64       01F1 C        	NormalStatusFlag            ==      CommuStatusFlag*16+1   ; Normal mode Flag
    65       01F0 C        	SearchStatusFlag            ==      CommuStatusFlag*16+0   ; Search mode flag
    66            C        
    67            C        ;------------------------------------------------------------------
    68       0011 C        r_acc1                          EQU     TEMP1
    69       0012 C        r_acc2                          EQU     TEMP2
    70       0013 C        r_acc3                          EQU     TEMP3
    71       0014 C        DataAddressInMCU                EQU     TEMP4         ;93C46
    72       0015 C        DataAddressInEEPROM             EQU     TEMP5
    73            C        
    74       0014 C        A_TEMP                          EQU     TEMP4  ;used for PUSH1 and POP1
    75       0015 C        RSR_TEMP                        EQU     TEMP5
    76       0016 C        STATUS_TEMP                     EQU     TEMP6
    77            C        
    78            C        ;------------------------------------------------------------------
    79       0019 C        FccFreqIndex                    EQU     ComuEndNum    ;FCC TEST
    80            C        
    81            C        
    82            C        ;========================= I/O Port Define ==============================
    83       00A7 C        SPI_SS                      ==      PortA*16+7 ;PA7    EM198810/EM198850 enable select
    84       00A6 C        SPI_CLK                     ==      PortA*16+6 ;PA6
    85       00A5 C        SPI_MOSI                    ==      PortA*16+5 ;PA5
    86       00A4 C        SPI_MISO                    ==      PortA*16+4 ;PA4
    87       00A3 C        RESET_N                     ==      PortA*16+3 ;PA3
    88       00A2 C        FIFO_FLAG                   ==      PortA*16+2 ;PB1
    89       00B0 C        PKT_FLAG                    ==      PortB*16+0 ;PB0
    90            C        
    91       00A1 C        CMOS_RST                    ==      PortA*16+1 ;PA1
    92       00A0 C        CMOS_SS                     ==      PortA*16+0 ;PA0
    93            C        
    94       0073 C        AT93C46_CS                  ==      Port7*16+3 ;4  93c46 enable select
    95            C        
    96       0081 C        LED1_STATUS                 ==      PORT8*16+1 ;LED
    97       0082 C        LED2_STATUS                 ==      PORT8*16+2 ;LED
    98            C        
    99       0007 C        Reference                   ==      7          ;port87
   100       0006 C        Leakresis                   ==      6          ;port86
   101       0000 C        LeftYAxis                   ==      0          ;port90  LY
   102       0001 C        LeftXAxis                   ==      1          ;port91  LX
   103       0002 C        RightYAxis                  ==      2          ;port92  RY
   104       0003 C        RightXAxis                  ==      3          ;port93  RX
   105            C        
   106            C        
   107            C        
   108            C        
   109            C        ;======================= BANK 0 (data buffer)============================
   110            C        ; bank0 20-3f used for data exchange section
   111            C        ; such as read or write EEPROM and RF,it used for data buffer
   112            C        
   113            C        ;------------------------------------------------------------------
   114       0020 C        PID_DATA_Buffer         EQU     0X20    ; PID DATA
   115       0021 C        RX_IDH_Buffer           EQU     0X21    ; master ID
   116       0022 C        RX_IDL_Buffer           EQU     0X22
   117       0023 C        CHN_FLAG_Buffer         EQU     0X23    ; Channel flag, gamepad status
   118       0024 C        CommuStatusFlag_Buffer  EQU     0X24
   119       0025 C        DirectionCtrl_Buffer    EQU     0X25    ; Communication trsmitter direction
   120       0026 C        N_CHN_Buffer            EQU     0X26    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   121       0026 C        TX_ID_Buffer            EQU     0X26    ; repeat package data
   122            C        
   123       0027 C        TX1_ID_Buffer           EQU     0X27     ;
   124       0028 C        TX2_ID_Buffer           EQU     0X28     ;
   125       0029 C        TX3_ID_Buffer           EQU     0X29     ;
   126       002A C        TX4_ID_Buffer           EQU     0X2A     ;
   127       002B C        TX5_ID_Buffer           EQU     0X2B     ;
   128       002C C        TX6_ID_Buffer           EQU     0X2C     ;
   129            C        ;-----------------------------------------------------------------
   130       0027 C        DataA_Buffer            EQU     0X27 ;rocker, left-x(left-right) data
   131       0028 C        DataB_Buffer            EQU     0X28 ;rocker, left-y(up-down) data
   132       0029 C        DataC_Buffer            EQU     0X29 ;rocker, right-x(left-right) data
   133       002A C        DataD_Buffer            EQU     0X2A ;rocker, right-y(up-down) data
   134       002B C        DataE_Buffer            EQU     0X2B ;A,B,C,D,L1,R1,L2,R2
   135       002C C        DataF_Buffer            EQU     0X2C ;Select,start,LSW,RSW,MODE,MACRO,TEST1,TEST2
   136       002D C        DataG_Buffer            EQU     0X2D ;000:00001:45010:90011:135100:180101:225110:270111:315
   137            C        
   138            C        ;======================= BANK 1 (RF variable)============================
   139       0020 C        PID_DATA                EQU     0X20
   140       0021 C        RX_IDH                  EQU     0X21    ; master ID
   141       0022 C        RX_IDL                  EQU     0X22
   142       0023 C        CHN_FLAG                EQU     0X23    ; Channel flag, gamepad status
   143            C        ;CommuStatusFlag
   144       0025 C        DirectionCtrl           EQU     0X25    ; Communication trsmitter direction
   145       0026 C        N_CHN                   EQU     0X26    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   146       0026 C        TX_ID                   EQU     0X26     ;
   147       0027 C        TX1_ID                  EQU     0X27     ;
   148       0028 C        TX2_ID                  EQU     0X28     ;
   149       0029 C        TX3_ID                  EQU     0X29     ;
   150       002A C        TX4_ID                  EQU     0X2A     ;
   151       002B C        TX5_ID                  EQU     0X2B     ;
   152       002C C        TX6_ID                  EQU     0X2C     ;
   153            C        
   154            C        ;-----------------------------------------------------------------
   155       0030 C        ADDR                    EQU     0X30 ;in/out Data Address
   156       0031 C        VALUE                   EQU     0X31 ;in/out Data
   157       0032 C        CH_NO                   EQU     0X32
   158       0033 C        LossframeCNT            EQU     0X33
   159       0034 C        TABLE_INDEX             EQU     0x34  ;descriptor table's start position
   160       0035 C        RF_RSSI                 EQU     0X35
   161            C        
   162            C        
   163            C        ;======================= BANK 2 (key data)==============================
   164       0020 C        DataA                   EQU     0X20 ;rocker left-x(left-right)  RF transmitter data
   165       0021 C        DataB                   EQU     0X21 ;rocker left-y(up-down)     RF transmitter data
   166       0022 C        DataC                   EQU     0X22 ;rocker right-x(left-right) RF transmitter data
   167       0023 C        DataD                   EQU     0X23 ;rocker right-y(up-down)    RF transmitter data
   168       0024 C        DataE                   EQU     0x24 ;DataA(s10-s5):
   169            C                                ;bit7  bit6  Bit5  Bit4  Bit3  bit2  bit1  bit0
   170            C                                ;A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   171       0025 C        DataF                   EQU     0x25 ;DataB(s4-s1):
   172            C                                ;bit7      bit6      Bit5      Bit4   Bit3  bit2    bit1    bit0
   173            C                                ;SELECT_9  START_10  TEST2_14  MACRO  MODE  RSW_12  LSW_11  TEST1_13
   174            C                                ;MODE: 1:DealWithDigital  0:DealWithAnalog (default:1)
   175       0026 C        DataG                   EQU     0X26 ;bit[7..4]Hat Switch, bit[3..0]reserve.
   176            C                                ;000:00001:45010:90011:135100:180101:225110:270111:315
   177            C        
   178       002D C        IOcheckTimeCNT          EQU     0X2D    ; used for count check time
   179       002E C        KeySystemTimeCNT        EQU     0x2E    ; key scan time
   180       002F C        LEDSystemTimeCNT        EQU     0X2F
   181            C        
   182       0030 C        KEY_LEFT_X              EQU     0X30 ;rocker,AD convert result left-x(left-right) data
   183       0031 C        KEY_LEFT_Y              EQU     0X31 ;rocker,AD convert result left-y(up-down) data
   184       0032 C        KEY_RIGHT_X             EQU     0X32 ;rocker,AD convert result right-x(left-right) data
   185       0033 C        KEY_RIGHT_Y             EQU     0X33 ;rocker,AD convert result right-y(up-down) data
   186       0036 C        KeystokeFlag_Befor      EQU     0X36
   187       0037 C        KeystokeTimeCNT         EQU     0X37        ;       Click                     Dblclick                    Lasting_Press
   188            C                                                    ;________    _______.__________    ______    ________.___________         ____________
   189            C                                                    ;        |__|                  |__|      |__|                    |_______|
   190       0038 C        KEY_NUM                 EQU     0X38
   191            C                                                    ;___________                       _________                              ____________
   192            C                                                    ;           |_______._____________|         |________.___________________|
   193            C        
   194            C        ;F_MODE                  EQU     0X32 ;Analog jugde falg
   195            C        ;F_MODE_BEFOR            EQU     0X33 ;Store keyboard select
   196       0039 C        KeyTempFlag             EQU     0X39 ;Store LINE4_KEY_INPUT TEMP
   197       0394 C        	ModeSelFlag         ==      KeyTempFlag*16+4 ;1:analog  0:digital(default 0)
   198       0395 C        	MacroFlag           ==      KeyTempFlag*16+5
   199       0396 C        	Test1Flag           ==      KeyTempFlag*16+6
   200       0397 C        	Test2Flag           ==      KeyTempFlag*16+7
   201            C        
   202       003A C        KeyTempBakupFlag        EQU     0X3A
   203       03A4 C        	ModeSelBakupFlag    ==      KeyTempBakupFlag*16+4 ;1:analog  0:digital(default 0)
   204       03A5 C        	MacroBakupFlag      ==      KeyTempBakupFlag*16+5
   205       03A6 C        	Test1BakupFlag      ==      KeyTempBakupFlag*16+6
   206       03A7 C        	Test2BakupFlag      ==      KeyTempBakupFlag*16+7
   207            C        
   208       003B C        LINE1_KEY_INPUT_CACHE   EQU     0X3B ;line 1,direction data
   209       003C C        LINE2_KEY_INPUT_CACHE   EQU     0X3C ;line 2,X_LINE2 output
   210       003D C        LINE3_KEY_INPUT_CACHE   EQU     0X3D ;line 3,X_LINE3 output
   211       003E C        LINE4_KEY_INPUT_CACHE   EQU     0X3E ;line 4,X_LINE4 output
   212       003F C        LINE5_KEY_INPUT_CACHE   EQU     0X3F ;line 5,X_LINE5 output
   213            C        
   214            C        ;======================= BANK 3 (reserve)===============================
   215            C        
   216            C        
   217            C        
   218            C        ;======================= BANK 4 (Push data)=============================
   219       0020 C        ATcc_TEMP               EQU     0X20  ;used for TCC and POP3
   220       0021 C        RSRTcc_TEMP             EQU     0X21
   221       0022 C        StatusTcc_TEMP          EQU     0X22
   222            C        
   223       0023 C        AExt_TEMP               EQU     0X23  ;used for External and POP3
   224       0024 C        RSRExt_TEMP             EQU     0X24
   225       0025 C        StatusExt_TEMP          EQU     0X25
   226            C        
   227       0026 C        A1_TEMP                 EQU     0X26  ;used for time1 and POP1
   228       0027 C        RSR1_TEMP               EQU     0X27
   229       0028 C        STATUS1_TEMP            EQU     0X28
   230            C        
   231       0029 C        A2_TEMP                 EQU     0X29  ;used for time2 and POP2
   232       002A C        RSR2_TEMP               EQU     0X2A
   233       002B C        STATUS2_TEMP            EQU     0X2B
   234            C        
   235            C        ;-----------------------------------------------------------
   236       0030 C        SPIS_TEMP               EQU     0X30
   237       0031 C        SPIC_TEMP               EQU     0X31
   238            C        
   239            C        ;======================= BANK 5 (CMOS Data)============================
   240       0020 C        CMOS_PARAMETER          EQU     0X20
   241       0021 C        CMOS_STATUS             EQU     0X21
   242       0210 C        	CMOSInitFlag        ==      CMOS_STATUS*16+0
   243       0211 C        	CMOSSleepFlag       ==      CMOS_STATUS*16+1
   244       0212 C        	CMOSGetDataFlag     ==      CMOS_STATUS*16+2		
   245            C        
   246       0022 C        CMOS_XPOINT_LOW         EQU     0X22
   247       0023 C        CMOS_YPOINT_LOW         EQU     0X23
   248       0024 C        CMOS_POINT_HIGH         EQU     0X24
   249            C        
   250            C        
   251            C        
   252            C        
   253            C        ;======================= BANK 6 (CMOS Data)============================
   254       0020 C        CMOS_X1_H               EQU     0X20    ; X1[9..8]
   255       0021 C        CMOS_X1_L               EQU     0X21    ; X1[7..0]
   256       0022 C        CMOS_Y1_H               EQU     0X22    ; Y1[9..8]
   257       0023 C        CMOS_Y1_L               EQU     0X23    ; Y1[7..0]
   258       0024 C        CMOS_Size1              EQU     0X24    ; Size1[3..0]
   259            C        
   260       0025 C        CMOS_X2_H               EQU     0X25    ; X1[9..8]
   261       0026 C        CMOS_X2_L               EQU     0X26    ; X1[7..0]
   262       0027 C        CMOS_Y2_H               EQU     0X27    ; Y1[9..8]
   263       0028 C        CMOS_Y2_L               EQU     0X28    ; Y1[7..0]
   264       0029 C        CMOS_Size2              EQU     0X29    ; Size1[3..0]
   265            C        
   266       002A C        CMOSDataCNT             EQU     0X2A
   267            C        ;======================= BANK 7 (GS Data)============================
   268       0020 C        GS_PARAMETER            EQU     0X20
   269       0021 C        GS_STATUS               EQU     0X21
   270       0210 C        	GSInitFlag          ==      GS_STATUS*16+0
   271       0211 C        	GSSleepFlag         ==      GS_STATUS*16+1
   272       0212 C        	GSGetDataFlag       ==      GS_STATUS*16+2
   273            C        
   274       0022 C        GS_XPOINT_LOW           EQU     0X22
   275       0023 C        GS_YPOINT_LOW           EQU     0X23
   276       0024 C        GS_ZPOINT_LOW           EQU     0X24
   277       0035 C        GS_POINT_HIGH           EQU     0X35
    17                     include "EM198850_For_EM78P520.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM198850 Driver.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL	   :  4MHZ
     7            C        * Creat date   :  2009/9/11
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE v1.01.01
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        
    12            C        ;-------------------------------------------------------------
    13            C        EM198850_FOR_EM78P520.ASM    EQU    EM198850_FOR_EM78P520.ASM
    14            C        
    15            C        ifndef EM198850_For_EM78P520.H
    16            C        include "EM198850_For_EM78P520.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL	   :  4MHZ
     7            C        * Creat date   :  2009/9/11
     8            C        * tool ver.    :  WicePlus 2.7
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        
    12            C        ;--------------------------------------------------------------------------
    13       0052 C        FIFO_PTR                EQU     82              ; FIFO POINTER CONTROL=REG 82
    14       0080 C        CLR_W_PTR               EQU     0X80            ; CLR POINTER MARK VALUE
    15       0050 C        FIFO_REG                EQU     80              ; FIFO POINTER=REG 80
    16       0080 C        READ_MASK               EQU     0X80            ; READ REG,MSB SET TO 1
    17       0080 C        RX_MASK                 EQU     0X80            ; ENABLE RX
    18            C        
    19       0020 C        PKT_LEN                 EQU     0X20            ; DataByteLength = 32
    20       0000 C        TXADDRL                 EQU     0X00
    21       0011 C        TXADDRH                 EQU     0X11
    22       00E0 C        RX_BUF                  EQU     0B11100000
    23       00E0 C        TX_BUF                  EQU     0B11100000
    24       0025 C        NoiseStrobe             EQU     0X25
    25       004B C        ChannelSum              EQU     75;(CH_TABLE_END-CH_TABLE_START)
    26            C        
    27            C        
    28            C        
    29            C        
    30            C        ;==================================================================
    31            C        
    17            C        endif
    18            C        
    19            C        
    20            C        ;-------------------------------------------------------------
    21            C        
    22            C        	ORG     0X0C00    ;PAGE 3
    23            C        	MESSAGE "define 'EM198850_FOR_EM78P520.ASM' ROM address"
***     USER MESSAGE: DEFINE 'EM198850_FOR_EM78P520.ASM' ROM ADDRESS
    24            C        ;**************************************************
    25            C        ;LOOKUP TABLE
    26            C        ;Famer Register initial value(Reg48~57)
    27            C        ;**************************************************
    28 00C00      C        FRAME_TABLE:
    29 00C00 03C2 C        	ADD                 PC,A
    30 00C01 1C4E C        	RETL                @0X4E		;1		01---16M
    31 00C02 1C02 C        	RETL                @0X02		;2		10---24M
    32            C        
    33 00C03 1C4D C        	RETL                @0X4D		;3		RESET FIFO
    34 00C04 1C01 C        	RETL                @0X01		;4
    35            C        
    36 00C05 1C42 C        	RETL                @0X42		;5		24M/1MBPS
    37 00C06 1C98 C        	RETL                @0X98		;6
    38            C        
    39 00C07 1C43 C        	RETL                @0X43		;7
    40 00C08 1CC8 C        	RETL                @0XC8 		;8		;default:C4  Set sync word lengthCRC count
    41            C        
    42 00C09 1C44 C        	RETL                @0X44		;9		PKT_LEN
    43 00C0A 1C20 C        	RETL                @PKT_LEN	;10		24 DATA
    44            C        
    45 00C0B 1C45 C        	RETL                @0X45		;11		PKTCNT
    46 00C0C 1C10 C        	RETL                @0X10		;12		1 packet
    47            C        
    48 00C0D 1C46 C        	RETL                @0X46		;13		BIT3~5	TX AMPLIFIER DELAY 10+5X
    49 00C0E 1C09 C        	RETL                @0X09		;14		BIT0~2	PLL DELAY 120+20X
    50            C        
    51 00C0F 1C47 C        	RETL                @0X47		;15		BIT4~7  RETRY CNT
    52 00C10 1C11 C        	RETL                @0X11		;16		BIT0~3	SLOT TIME UNIT 10US
    53            C        
    54 00C11 1C48 C        	RETL                @0X48		;17		SLOT
    55 00C12 1C01 C        	RETL                @0X01		;18
    56            C        
    57 00C13 1C49 C        	RETL                @0X49		;19		ACKTOSLOT
    58 00C14 1C14 C        	RETL                @0X14 		;20     default: 0X8A
    59            C        
    60 00C15 1C4A C        	RETL                @0X4A		;21		RSSITH
    61 00C16 1C27 C        	RETL                @0X27		;22
    62            C        
    63 00C17 1C4B C        	RETL                @0X4B		;23		RF_RSSI
    64 00C18 1C00 C        	RETL                @0X00		;24
    65            C        
    66 00C19 1C4C C        	RETL                @0X4C		;25		TD_PLL	IN UNIT 10US
    67 00C1A 1C06 C        	RETL                @0X06		;26
    68            C        
    69 00C1B 1C50 C        	RETL                @0X50		;27		TXADDR
    70 00C1C 1C00 C        	RETL                @TXADDRL	;28
    71            C        
    72 00C1D 1C51 C        	RETL                @0X51		;29		TX ADDR
    73 00C1E 1C11 C        	RETL                @TXADDRH	;30
    74            C        
    75 00C1F 1C52 C        	RETL                @0X52		;31		RX	ADDR1
    76 00C20 1C22 C        	RETL                @0X22		;32
    77            C        
    78 00C21 1C53 C        	RETL                @0X53		;33		RX	ADDR2
    79 00C22 1C33 C        	RETL                @0X33		;34
    80            C        
    81 00C23 1C54 C        	RETL                @0X54		;35		RX	ADDR3
    82 00C24 1C44 C        	RETL                @0X44		;36
    83            C        
    84 00C25 1C55 C        	RETL                @0X55		;37		RX	ADDR4
    85 00C26 1C55 C        	RETL                @0X55		;38
    86            C        
    87 00C27 1C56 C        	RETL                @0X56		;39		RX	ADDR5
    88 00C28 1C66 C        	RETL                @0X66		;40
    89            C        
    90 00C29 1C57 C        	RETL                @0X57		;41		RX	ADDR6
    91 00C2A 1C77 C        	RETL                @0X77		;42
    92            C        
    93 00C2B 1C58 C        	RETL                @0X58		;43
    94 00C2C 1C08 C        	RETL                @0X08		;44
    95            C        
    96            C        ;-----------------------------------------------------------
    97 00C2D 1C00 C        	RETL                @0X00		;45
    98 00C2E 1CE5 C        	RETL                @0XE5		;46
    99            C        
   100 00C2F 1C01 C        	RETL                @0X01		;47
   101 00C30 1C84 C        	RETL                @0X84		;48
   102            C        
   103 00C31 1C02 C        	RETL                @0X02		;49
   104 00C32 1C00 C        	RETL                @0X00		;50		CHANNEL
   105            C        
   106 00C33 1C03 C        	RETL                @0X03		;51
   107 00C34 1CC6 C        	RETL                @0XC6		;52
   108            C        
   109 00C35 1C04 C        	RETL                @0X04		;53
   110 00C36 1C00 C        	RETL                @0X00		;54
   111            C        
   112 00C37 1C05 C        	RETL                @0X05		;55
   113 00C38 1C40 C        	RETL                @0X40		;56
   114            C        
   115 00C39 1C06 C        	RETL                @0X06		;57
   116 00C3A 1C5D C        	RETL                @0X5D		;58
   117            C        
   118 00C3B 1C07 C        	RETL                @0X07		;59
   119 00C3C 1C18 C        	RETL                @0X18		;60
   120            C        
   121 00C3D 1C08 C        	RETL                @0X08		;61
   122 00C3E 1C40 C        	RETL                @0X40		;62
   123            C        
   124 00C3F 1C09 C        	RETL                @0X09		;63
   125 00C40 1C18 C        	RETL                @0X18		;64
   126            C        
   127 00C41 1C0A C        	RETL                @0X0A		;65
   128 00C42 1C47 C        	RETL                @0X47		;66
   129            C        
   130 00C43 1C0B C        	RETL                @0X0B		;67
   131 00C44 1C0B C        	RETL                @0X0B		;68
   132            C        
   133 00C45 1C0C C        	RETL                @0X0C		;69
   134 00C46 1CE0 C        	RETL                @0XE0		;70
   135            C        
   136 00C47 1C0D C        	RETL                @0X0D		;71
   137 00C48 1C4F C        	RETL                @0X4F		;72
   138            C        
   139 00C49 1C0E C        	RETL                @0X0E		;73
   140 00C4A 1C11 C        	RETL                @0X11		;74
   141            C        
   142 00C4B 1C0F C        	RETL                @0X0F		;75
   143 00C4C 1C1C C        	RETL                @0X1C		;76
   144            C        
   145 00C4D 1C20 C        	RETL                @0X20		;77
   146 00C4E 1CAD C        	RETL                @0XAD		;78
   147            C        
   148 00C4F 1C21 C        	RETL                @0X21		;79
   149 00C50 1C64 C        	RETL                @0X64		;80
   150            C        
   151 00C51 1C22 C        	RETL                @0X22		;81
   152 00C52 1C00 C        	RETL                @0X00		;82
   153            C        
   154 00C53 1C23 C        	RETL                @0X23		;83
   155 00C54 1CC3 C        	RETL                @0XC3		;84
   156            C        
   157 00C55 1C24 C        	RETL                @0X24		;85
   158 00C56 1CBD C        	RETL                @0XBD		;86
   159            C        
   160 00C57 1C25 C        	RETL                @0X25		;87
   161 00C58 1CA2 C        	RETL                @0XA2		;88
   162            C        
   163 00C59 1C26 C        	RETL                @0X26		;89
   164 00C5A 1C1A C        	RETL                @0X1A		;90
   165            C        
   166 00C5B 1C27 C        	RETL                @0X27		;91
   167 00C5C 1C09 C        	RETL                @0X09		;92
   168            C        
   169 00C5D 1C28 C        	RETL                @0X28		;93
   170 00C5E 1C00 C        	RETL                @0X00		;94
   171            C        
   172 00C5F 1C29 C        	RETL                @0X29		;95
   173 00C60 1CB8 C        	RETL                @0XB8		;96
   174            C        
   175 00C61 1C2A C        	RETL                @0X2A		;97
   176 00C62 1C71 C        	RETL                @0X71		;98
   177            C        
   178 00C63 1C2B C        	RETL                @0X2B		;99
   179 00C64 1C06 C        	RETL                @0X06		;100
   180            C        
   181 00C65 1C2C C        	RETL                @0X2C		;101
   182 00C66 1C80 C        	RETL                @0X80		;102
   183            C        
   184 00C67 1C2D C        	RETL                @0X2D		;103
   185 00C68 1C1A C        	RETL                @0X1A		;104
   186            C        
   187 00C69 1C2E C        	RETL                @0X2E		;105
   188 00C6A 1C09 C        	RETL                @0X09;03		;106
   189            C        
   190 00C6B 1C2F C        	RETL                @0X2F		;107
   191 00C6C 1C64 C        	RETL                @0X64		;108
   192            C        
   193 00C6D 1C30 C        	RETL                @0X30		;109
   194 00C6E 1CC0 C        	RETL                @0XC0		;110
   195            C        
   196 00C6F 1C31 C        	RETL                @0X31		;111
   197 00C70 1C00 C        	RETL                @0X00		;112
   198            C        
   199 00C71 1C32 C        	RETL                @0X32		;113
   200 00C72 1C40 C        	RETL                @0X40		;114
   201            C        
   202 00C73 1C33 C        	RETL                @0X33		;115
   203 00C74 1C3B C        	RETL                @0X3B		;116
   204            C        
   205 00C75 1C00 C        	RETL                @0X00		;117
   206 00C76 1CA7 C        	RETL                @0XA7		;118
   207            C        
   208 00C77 1C32 C        	RETL                @0X32		;119
   209 00C78 1C4A C        	RETL                @0X4A		;120
   210            C        
   211 00C79 1C00 C        	RETL                @0X00		;121
   212 00C7A 1CE5 C        	RETL                @0XE5		;122
   213            C        
   214 00C7B 1C0E C        	RETL                @0X0E		;123
   215 00C7C 1C91 C        	RETL                @0X91		;124
   216            C        
   217 00C7D 1C40 C        	RETL                @0X40		;125
   218 00C7E 1C51 C        	RETL                @0X51		;126
   219            C        
   220 00C7F 1C41 C        	RETL                @0X41		;127
   221 00C80 1CBF C        	RETL                @0XBF		;128
   222            C        
   223 00C81 1C0C C        	RETL                @0X0C		;129
   224 00C82 1CC0 C        	RETL                @0XC0		;130
   225            C        
   226 00C83 1C02 C        	RETL                @0X02		;131
   227 00C84 1C80 C        	RETL                @0X80		;132
   228            C        
   229 00C85 1C04 C        	RETL                @0X04		;133
   230 00C86 1C4A C        	RETL                @0X4A		;134
   231            C        
   232 00C87 1C05 C        	RETL                @0X05		;135
   233 00C88 1CDA C        	RETL                @0XDA		;136
   234            C        
   235 00C89 1C06 C        	RETL                @0X06		;137
   236 00C8A 1CFA C        	RETL                @0XFA		;138
   237            C        
   238 00C8B 1CFF C        	RETL                @0XFF
   239            C        
   240            C        ;===========================================================
   241 00C8C      C        RF_TABLE:			;LENGTH 30
   242 00C8C 03C2 C        	ADD                 PC,A
   243 00C8D 1C4E C        	RETL                @0X4E
   244 00C8E 1C02 C        	RETL                @0X02
   245            C        
   246 00C8F 1C43 C        	RETL                @0X43
   247 00C90 1CC8 C        	RETL                @0XC8
   248            C        
   249 00C91 1C44 C        	RETL                @0X44
   250 00C92 1C20 C        	RETL                @PKT_LEN
   251            C        
   252 00C93 1C45 C        	RETL                @0X45
   253 00C94 1C10 C        	RETL                @0X10
   254            C        
   255 00C95 1C48 C        	RETL                @0X48
   256 00C96 1C01 C        	RETL                @0X01
   257            C        
   258 00C97 1C4C C        	RETL                @0X4C
   259 00C98 1C06 C         	RETL                @0X06
   260            C        
   261 00C99 1C50 C        	RETL                @0X50
   262 00C9A 1C00 C        	RETL                @TXADDRL
   263            C        
   264 00C9B 1C51 C        	RETL                @0X51
   265 00C9C 1C11 C        	RETL                @TXADDRH
   266            C        
   267 00C9D 1C52 C        	RETL                @0X52
   268 00C9E 1C22 C        	RETL                @0X22
   269            C        
   270 00C9F 1C53 C        	RETL                @0X53
   271 00CA0 1C33 C        	RETL                @0X33
   272            C        
   273 00CA1 1C54 C        	RETL                @0X54
   274 00CA2 1C44 C        	RETL                @0X44
   275            C        
   276 00CA3 1C55 C        	RETL                @0X55
   277 00CA4 1C55 C        	RETL                @0X55
   278            C        
   279 00CA5 1C56 C        	RETL                @0X56
   280 00CA6 1C66 C        	RETL                @0X66
   281            C        
   282 00CA7 1C57 C        	RETL                @0X57
   283 00CA8 1C77 C        	RETL                @0X77
   284            C        
   285 00CA9 1C58 C        	RETL                @0X58
   286 00CAA 1C08 C        	RETL                @0X08
   287            C        
   288 00CAB 1CFF C        	RETL                @0XFF
   289            C        
   290            C        ;===========================================================
   291 00CAC      C        CH_TABLE:
   292 00CAC 03C2 C        	ADD                 PC,A
   293 00CAD      C          CH_TABLE_START:
   294            C        	;1
   295 00CAD 1C14 C        	RETL                @20        ;00 ;0x14
   296 00CAE 1C26 C        	RETL                @38        ;01 ;0x26
   297 00CAF 1C38 C        	RETL                @56        ;02 ;0x38
   298 00CB0 1C4F C        	RETL                @79        ;03 ;0x4F
   299            C        
   300            C        	;2
   301 00CB1 1C04 C        	RETL                @4         ;04 ;0x04
   302 00CB2 1C17 C        	RETL                @23        ;05 ;0x17
   303 00CB3 1C2A C        	RETL                @42        ;06 ;0x2A
   304 00CB4 1C3D C        	RETL                @61        ;07 ;0x3D
   305            C        
   306            C        	;3
   307 00CB5 1C07 C        	RETL                @7         ;08 ;0x07
   308 00CB6 1C1B C        	RETL                @27        ;09 ;0x1B
   309 00CB7 1C2F C        	RETL                @47        ;10 ;0x2F
   310 00CB8 1C3E C        	RETL                @62        ;11 ;0x3E
   311            C        
   312            C        	;4
   313 00CB9 1C0A C        	RETL                @10        ;12 ;0x02
   314 00CBA 1C1F C        	RETL                @31        ;13 ;0x1F
   315 00CBB 1C34 C        	RETL                @52        ;14 ;0x34
   316 00CBC 1C3F C        	RETL                @63        ;15 ;0x3F
   317            C        
   318            C        	;5
   319 00CBD 1C0D C        	RETL                @13        ;16 ;0x0D
   320 00CBE 1C23 C        	RETL                @35        ;17 ;0x23
   321 00CBF 1C39 C        	RETL                @57        ;18 ;0x39
   322 00CC0 1C40 C        	RETL                @64        ;19 ;0x40
   323            C        
   324            C        	;6
   325 00CC1 1C10 C        	RETL                @16        ;20 ;0x10
   326 00CC2 1C27 C        	RETL                @39        ;21 ;0x27
   327 00CC3 1C2B C        	RETL                @43        ;22 ;0x2B
   328 00CC4 1C41 C        	RETL                @65        ;23 ;0x41
   329            C        
   330            C        	;7
   331 00CC5 1C13 C        	RETL                @19        ;24 ;0x13
   332 00CC6 1C18 C        	RETL                @24        ;25 ;0x18
   333 00CC7 1C30 C        	RETL                @48        ;26 ;0x30
   334 00CC8 1C42 C        	RETL                @66        ;27 ;0x42
   335            C        
   336            C        	;8
   337 00CC9 1C16 C        	RETL                @22        ;28 ;0x16
   338 00CCA 1C1C C        	RETL                @28        ;29 ;0x1C
   339 00CCB 1C35 C        	RETL                @53        ;30 ;0x35
   340 00CCC 1C43 C        	RETL                @67        ;31 ;0x43
   341            C        
   342            C        	;9
   343 00CCD 1C06 C        	RETL                @6         ;32 ;0x06
   344 00CCE 1C20 C        	RETL                @32        ;33 ;0x20
   345 00CCF 1C3A C        	RETL                @58        ;34 ;0x3A
   346 00CD0 1C44 C        	RETL                @68        ;35 ;0x44
   347            C        
   348            C        	;10
   349 00CD1 1C09 C        	RETL                @9         ;36 ;0x09
   350 00CD2 1C24 C        	RETL                @36        ;37 ;0x24
   351 00CD3 1C2C C        	RETL                @44        ;38 ;0x2C
   352 00CD4 1C45 C        	RETL                @69        ;39 ;0x45
   353            C        
   354            C        	;11
   355 00CD5 1C0C C        	RETL                @12        ;40 ;0x0C
   356 00CD6 1C28 C        	RETL                @40        ;41 ;0x28
   357 00CD7 1C31 C        	RETL                @49        ;42 ;0x31
   358 00CD8 1C46 C        	RETL                @70        ;43 ;0x46
   359            C        
   360            C        	;12
   361 00CD9 1C0F C        	RETL                @15        ;44 ;0x0F
   362 00CDA 1C19 C        	RETL                @25        ;45 ;0x19
   363 00CDB 1C36 C        	RETL                @54        ;46 ;0x36
   364 00CDC 1C47 C        	RETL                @71        ;47 ;0x36
   365            C        
   366            C        	;13
   367 00CDD 1C12 C        	RETL                @18        ;48 ;0x12
   368 00CDE 1C1D C        	RETL                @29        ;49 ;0x1D
   369 00CDF 1C3B C        	RETL                @59        ;50 ;0x3B
   370 00CE0 1C48 C        	RETL                @72        ;51 ;0x48
   371            C        
   372            C        	;14
   373 00CE1 1C15 C        	RETL                @21        ;52 ;0x15
   374 00CE2 1C21 C        	RETL                @33        ;53 ;0x21
   375 00CE3 1C2D C        	RETL                @45        ;54 ;0x2D
   376 00CE4 1C49 C        	RETL                @73        ;55 ;0x49
   377            C        
   378            C        	;15
   379 00CE5 1C05 C        	RETL                @5         ;56 ;0x05
   380 00CE6 1C25 C        	RETL                @37        ;57 ;0x25
   381 00CE7 1C32 C        	RETL                @50        ;58 ;0x32
   382 00CE8 1C4A C        	RETL                @74        ;59 ;0x4A
   383            C        
   384            C        	;16
   385 00CE9 1C08 C        	RETL                @8         ;60 ;0x08
   386 00CEA 1C29 C        	RETL                @41        ;61 ;0x29
   387 00CEB 1C37 C        	RETL                @55        ;62 ;0x37
   388 00CEC 1C4B C        	RETL                @75        ;63 ;0x4B
   389            C        
   390            C        	;17
   391 00CED 1C0B C        	RETL                @11        ;64 ;0x03
   392 00CEE 1C1A C        	RETL                @26        ;65 ;0x1A
   393 00CEF 1C3C C        	RETL                @60        ;66 ;0x3C
   394 00CF0 1C4C C        	RETL                @76        ;67 ;0x4C
   395            C        
   396            C        	;18
   397 00CF1 1C0E C        	RETL                @14        ;68 ;0x0E
   398 00CF2 1C1E C        	RETL                @30        ;69 ;0x1E
   399 00CF3 1C2E C        	RETL                @46        ;70 ;0x2E
   400 00CF4 1C4D C        	RETL                @77        ;71 ;0x4D
   401            C        
   402            C        	;19
   403 00CF5 1C11 C        	RETL                @17        ;72 ;0x11
   404 00CF6 1C22 C        	RETL                @34        ;73 ;0x22
   405 00CF7 1C33 C        	RETL                @51        ;74 ;0x33
   406 00CF8 1C4E C        	RETL                @78        ;75 ;0x4E
   407 00CF9      C          CH_TABLE_END:
   408            C        
   409            C        
   410            C        
   411            C        ;===========================================================
   412            C        ; RF Initialize SubRoutine
   413            C        ;===========================================================
   414 00CF9      C        EM198850_RESET:
   415 00CF9 0004 C        	WDTC
   416 00CFA 1E00 C        	BANK                0
   417 00CFB 08CA C        	BC                  RESET_N/16,RESET_N%16
   418 00CFC 180A C        	MOV                 A,@10                         ; wating 3ms
   419 00CFD 1351 C        	CALL                DELAY_X100US
   420 00CFE 0ACA C        	BS                  RESET_N/16,RESET_N%16          ; RESET=1
   421 00CFF 1864 C        	MOV                 A,@100                          ; wating 10ms
   422 00D00 1351 C        	CALL                DELAY_X100US
   423 00D01 0000 C        	NOP
   424            C        
   425 00D02 095D C        	BC                  RFTestfailFlag/16,RFTestfailFlag%16
   426 00D03 110E C        	CALL                INIT_FRAMEREG                  ; load	FRAMER TABLE send
   427 00D04 1805 C        	MOV                 A,@5
   428 00D05 1351 C        	CALL                DELAY_X100US
   429 00D06 1121 C        	CALL                INIT_RSSI_CALIBRATION
   430 00D07 0000 C        	NOP
   431 00D08 135B C        	CALL                TEST_INITIAL_RF
   432 00D09 0D5D C        	JBC                 RFTestfailFlag/16,RFTestfailFlag%16
   433 00D0A 14F9 C        	JMP                 EM198850_RESET
   434            C        
   435 00D0B 12AF C        	CALL                Enter_StandbyII_Mode
   436 00D0C 0B9D C        	BS                  RFInitialOKflag/16,RFInitialOKflag%16
   437            C        
   438 00D0D 0012 C        	RET
   439            C        
   440            C        ;===============================================
   441 00D0E      C        INIT_FRAMEREG:
   442 00D0E 1E01 C        	BANK                1
   443 00D0F 00F4 C        	CLR                 TABLE_INDEX
   444 00D10      C          Set_FrameReg:
   445 00D10 0434 C        	MOV                 A,TABLE_INDEX
   446 00D11 1000 C        	CALL                FRAME_TABLE
   447 00D12 0070 C        	MOV                 ADDR,A
   448 00D13 1BFF C        	XOR                 A,@0XFF
   449 00D14 0C83 C        	JBC                 STATUS,Z
   450 00D15 151F C        	JMP                 Set_Framereg_End
   451 00D16 0574 C        	INC                 TABLE_INDEX
   452 00D17 0434 C        	MOV                 A,TABLE_INDEX
   453 00D18 1000 C        	CALL                FRAME_TABLE
   454 00D19 0000 C        	NOP
   455 00D1A 0071 C        	MOV                 VALUE,A
   456 00D1B 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   457 00D1C 0000 C        	NOP
   458 00D1D 0574 C        	INC                 TABLE_INDEX
   459 00D1E 1510 C        	JMP                 Set_FrameReg
   460 00D1F      C          Set_Framereg_End:
   461 00D1F 0000 C        	NOP
   462 00D20 0012 C        	RET
   463            C        
   464            C        ;=================================================
   465 00D21      C        INIT_RSSI_CALIBRATION:
   466 00D21 1E01 C        	BANK                1
   467 00D22 1805 C        	MOV                 A,@0X05
   468 00D23 005A C        	MOV                 DataByteLength,A
   469 00D24 00F5 C        	CLR                 RF_RSSI
   470 00D25      C          Repeat_Read_RSSI:
   471 00D25 184B C        	MOV                 A,@0X4B
   472 00D26 0070 C        	MOV                 ADDR,A
   473 00D27 115C C        	CALL                READ_SPI_REG
   474 00D28 0000 C        	NOP
   475 00D29 0435 C        	MOV                 A,RF_RSSI
   476 00D2A 0131 C        	SUB                 A,VALUE
   477 00D2B 0E03 C        	JBS                 STATUS,C
   478 00D2C 152F C        	JMP                 $+3
   479 00D2D 0431 C        	MOV                 A,VALUE
   480 00D2E 0075 C        	MOV                 RF_RSSI,A
   481 00D2F 05DA C        	DJZ                 DataByteLength
   482 00D30 1525 C        	JMP                 Repeat_Read_RSSI
   483            C        
   484 00D31 1804 C        	MOV                 A,@0X04
   485 00D32 0175 C        	SUB                 RF_RSSI,A
   486 00D33 0435 C        	MOV                 A,RF_RSSI
   487 00D34 0071 C        	MOV                 VALUE,A
   488 00D35 184A C        	MOV                 A,@0X4A
   489 00D36 0070 C        	MOV                 ADDR,A
   490 00D37 114C C        	CALL                WRITE_SPI_REG
   491 00D38 0000 C        	NOP
   492 00D39 1805 C        	MOV                 A,@0X05
   493 00D3A 0070 C        	MOV                 ADDR,A
   494 00D3B 1840 C        	MOV                 A,@0X40
   495 00D3C 0071 C        	MOV                 VALUE,A
   496 00D3D 114C C        	CALL                WRITE_SPI_REG
   497 00D3E 0000 C        	NOP
   498 00D3F 1802 C        	MOV                 A,@0X02
   499 00D40 0070 C        	MOV                 ADDR,A
   500 00D41 1800 C        	MOV                 A,@0X00
   501 00D42 0071 C        	MOV                 VALUE,A
   502 00D43 114C C        	CALL                WRITE_SPI_REG
   503 00D44 0000 C        	NOP
   504 00D45 180C C        	MOV                 A,@0X0C
   505 00D46 0070 C        	MOV                 ADDR,A
   506 00D47 18E0 C        	MOV                 A,@0XE0
   507 00D48 0071 C        	MOV                 VALUE,A
   508 00D49 114C C        	CALL                WRITE_SPI_REG
   509 00D4A 0000 C        	NOP
   510 00D4B 0012 C        	RET
   511            C        
   512            C        ;===========================================================
   513            C        ; RF Initialize End
   514            C        ;===========================================================
   515            C        ;===============================================
   516            C        ; Function: Write SPI Register
   517            C        ; Input:    ADDR,VALUE
   518            C        ; Output:   None
   519            C        ;===============================================
   520 00D4C      C        WRITE_SPI_REG:
   521 00D4C 1E00 C        	BANK                0
   522 00D4D 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;	/SS	=0
   523 00D4E 1E01 C        	BANK                1
   524 00D4F 0430 C        	MOV                 A,ADDR
   525 00D50 1170 C        	CALL                SIM_SPI_WRITE
   526 00D51 0431 C        	MOV                 A,VALUE
   527 00D52 1170 C        	CALL                SIM_SPI_WRITE
   528            C        
   529 00D53 1E02 C        	BANK                2
   530 00D54 098D C        	BC                  SPIC,SPIEB
   531 00D55 1E00 C        	BANK                0
   532 00D56 098A C        	BC                  SPI_CLK/16,SPI_CLK%16
   533 00D57 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   534 00D58 1E02 C        	BANK                2
   535 00D59 0B8D C        	BS                  SPIC,SPIEB
   536 00D5A 1E01 C        	BANK                1
   537            C        
   538 00D5B 0012 C        	RET
   539            C        
   540            C        ;===============================================
   541            C        ; Function: Read SPI Register
   542            C        ; Input:   SPIWB
   543            C        ; Output:  SPIRB
   544            C        ;===============================================
   545 00D5C      C        READ_SPI_REG:
   546 00D5C 1E00 C        	BANK                0
   547 00D5D 09CA C        	BC                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   548 00D5E 1E01 C        	BANK                1
   549 00D5F 0430 C        	MOV                 A,ADDR
   550 00D60 1980 C        	OR                  A,@0X80
   551 00D61 1170 C        	CALL                SIM_SPI_WRITE
   552 00D62 0000 C        	NOP
   553 00D63 117C C        	CALL                SIM_SPI_READ
   554 00D64 0071 C        	MOV                 VALUE,A
   555            C        
   556 00D65 1E02 C        	BANK                2
   557 00D66 098D C        	BC                  SPIC,SPIEB
   558 00D67 1E00 C        	BANK                0
   559 00D68 098A C        	BC                  SPI_CLK/16,SPI_CLK%16
   560 00D69 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   561 00D6A 1E02 C        	BANK                2
   562 00D6B 0B8D C        	BS                  SPIC,SPIEB
   563 00D6C 1E01 C        	BANK                1
   564            C        
   565 00D6D 0000 C        	NOP
   566 00D6E 0000 C        	NOP
   567 00D6F 0012 C        	RET
   568            C        
   569            C        ;===============================================
   570            C        ; Function: Write SPI communication subroutine rising edge
   571            C        ; Input:    ACC
   572            C        ; Output:   None
   573            C        ;===============================================
   574 00D70      C        SIM_SPI_WRITE:
   575 00D70 1E02 C        	BANK                2
   576 00D71 00CC C        	CLR                 SPIS
   577 00D72 00CE C        	CLR                 SPIR
   578 00D73 004F C        	MOV                 SPIW,A         ; Write data to buffer
   579 00D74 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   580 00D75 0000 C        	NOP
   581 00D76 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   582 00D77 1575 C        	JMP                 $-2
   583 00D78 1E01 C        	BANK                1
   584 00D79 0000 C        	NOP
   585 00D7A 0012 C        	RET
   586 00D7B 0000 C        	NOP
   587            C        
   588            C        ;===============================================
   589            C        ; Function: Read SPI communication subroutine rising edge
   590            C        ; Input:    None
   591            C        ; Output:   SPI Data
   592            C        ;===============================================
   593 00D7C      C        SIM_SPI_READ:
   594 00D7C 1E02 C        	BANK                2
   595 00D7D 00CC C        	CLR                 SPIS
   596 00D7E 00CE C        	CLR                 SPIR
   597 00D7F 00CF C        	CLR                 SPIW            ; Write data to buffer
   598 00D80 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   599 00D81 0000 C        	NOP
   600 00D82 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   601 00D83 1581 C        	JMP                 $-2
   602 00D84 040E C        	MOV                 A,SPIR
   603 00D85 1E01 C        	BANK                1
   604 00D86 0000 C        	NOP
   605 00D87 0012 C           	RET
   606 00D88 0000 C           	NOP
   607            C        
   608            C        ;==========================================================
   609            C        ; Read/Write subroutine
   610            C        ;==========================================================
   611 00D89      C        SIM_SPI_READ_WRITE:
   612 00D89 1E02 C        	BANK                2
   613 00D8A 00CC C        	CLR                 SPIS
   614 00D8B 00CE C        	CLR                 SPIR
   615 00D8C 004F C        	MOV                 SPIW,A            ; Write data to buffer
   616 00D8D 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   617 00D8E 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   618 00D8F 158E C        	JMP                 $-1
   619 00D90 040E C        	MOV                 A,SPIR
   620 00D91 1E01 C        	BANK                1
   621 00D92 0000 C        	NOP
   622 00D93 0012 C           	RET
   623 00D94 0000 C           	NOP
   624            C        
   625            C        
   626            C        ;===============================================
   627            C        ; Function: Read FIFO RAM
   628            C        ; Input:    None
   629            C        ; Output:   RX_BUF	,Receive_Error
   630            C        ;===============================================
   631 00D95      C        READ_FIFO_RAM:
   632 00D95 1E00 C        	BANK                0
   633 00D96 18E0 C        	MOV                 A,@RX_BUF					;READ DATA START Address
   634 00D97 0044 C        	MOV                 RSR,A
   635 00D98 0000 C        	NOP
   636 00D99 0000 C        	NOP
   637 00D9A 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;/SS=0
   638 00D9B 18FF C        	MOV                 A,@0XFF						;0X7F||0X80 FIFO ADDRESS
   639 00D9C 1170 C        	CALL                SIM_SPI_WRITE
   640 00D9D 0000 C        	NOP
   641 00D9E 1820 C        	MOV                 A,@PKT_LEN
   642 00D9F 005A C        	MOV                 DataByteLength,A
   643 00DA0      C          Read_FIFO_Loop:
   644 00DA0 117C C        	CALL                SIM_SPI_READ	 					;Packet & Device	ID
   645 00DA1 1E00 C        	BANK                0
   646 00DA2 0040 C        	MOV                 R0,A
   647 00DA3 0544 C        	INC                 RSR
   648 00DA4 05DA C        	DJZ                 DataByteLength
   649 00DA5 15A0 C        	JMP                 Read_FIFO_Loop
   650 00DA6 0B84 C        	BS                  RSR,BNC                      ; include EM78P520.H
   651 00DA7 0BCA C        	BS                  SPI_SS/16,SPI_SS%16				;/SS=1
   652 00DA8 1E01 C        	BANK                1
   653 00DA9 0000 C        	NOP
   654 00DAA 0012 C        	RET
   655 00DAB 0000 C        	NOP
   656            C        
   657            C        
   658            C        ;===============================================
   659            C        ; Function: Write FIFO RAM
   660            C        ; Input:    None
   661            C        ; Output:   RX_Buf	,Receive_Error%16
   662            C        ;===============================================
   663 00DAC      C        WRITE_FIFO_RAM:
   664 00DAC 1E00 C        	BANK                0
   665 00DAD 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;/SS=1
   666 00DAE 187F C        	MOV                 A,@0X7F						;reg0X7F	SET
   667 00DAF 1170 C        	CALL                SIM_SPI_WRITE
   668 00DB0 1E00 C        	BANK                0
   669 00DB1 1820 C        	MOV                 A,@PKT_LEN
   670 00DB2 005A C        	MOV                 DataByteLength,A
   671 00DB3 18E0 C        	MOV                 A,@TX_BUF					;Write DATA START Address
   672 00DB4 0044 C        	MOV                 RSR, A
   673            C        
   674 00DB5      C          Write_FIFO_Loop:
   675 00DB5 0400 C        	MOV                 A,R0
   676 00DB6 1170 C        	CALL                SIM_SPI_WRITE
   677 00DB7 0000 C        	NOP
   678 00DB8 1E00 C        	BANK                0
   679 00DB9 0544 C        	INC                 RSR
   680 00DBA 05DA C        	DJZ                 DataByteLength
   681 00DBB 15B5 C        	JMP                 Write_FIFO_Loop
   682 00DBC 0BCA C        	BS                  SPI_SS/16,SPI_SS%16				;/SS=1
   683 00DBD 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16
   684 00DBE 15BD C        	JMP                 $-1
   685 00DBF 0B84 C        	BS                  RSR,BNC                      ; include EM78P520.H
   686 00DC0 1E01 C        	BANK                1
   687 00DC1 0000 C        	NOP
   688 00DC2 0012 C        	RET
   689 00DC3 0000 C        	NOP
   690            C        
   691            C        
   692            C        ;===============================================
   693            C        ; Function: Reset RF FIFO
   694            C        ; Input:    None
   695            C        ; Output:   None
   696            C        ;===============================================
   697 00DC4      C        RESET_RF_FIFO:
   698 00DC4 1E00 C        	BANK                0
   699 00DC5 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=0
   700 00DC6 1E01 C        	BANK                1
   701 00DC7 184D C        	MOV                 A,@0X4D
   702 00DC8 0070 C        	MOV                 ADDR,A					;ADDR=0X4D
   703 00DC9 1801 C        	MOV                 A,@0X01
   704 00DCA 0071 C        	MOV                 VALUE,A
   705 00DCB 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   706            C        	;MOV                 A,@12
   707            C        	;CALL                DELAY_X10US
   708            C        	MESSAGE "Make sure that anything take-over or send out in 120us "
***     USER MESSAGE: MAKE SURE THAT ANYTHING TAKE-OVER OR SEND OUT IN 120US 
   709 00DCC 0012 C        	RET
   710            C        
   711            C        
   712            C        ;***********************************************************
   713            C        ; Function: Enter TX Buffered ACK
   714            C        ; Input:    None
   715            C        ; Output:   None
   716            C        ;***********************************************************
   717 00DCD      C        ENTER_TX_BUFFER_ACK:
   718 00DCD 1E00 C        	BANK                0
   719 00DCE 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   720 00DCF 1E01 C        	BANK                1
   721 00DD0 1800 C        	MOV                 A,@0X00
   722 00DD1 0070 C        	MOV                 ADDR,A
   723 00DD2 18E5 C        	MOV                 A,@0XE5
   724 00DD3 0071 C        	MOV                 VALUE,A
   725 00DD4 114C C        	CALL                WRITE_SPI_REG
   726 00DD5 1801 C        	MOV                 A,@0X01
   727 00DD6 0070 C        	MOV                 ADDR,A
   728 00DD7 1884 C        	MOV                 A,@0X84
   729 00DD8 0071 C        	MOV                 VALUE,A
   730 00DD9 114C C        	CALL                WRITE_SPI_REG
   731 00DDA 1841 C        	MOV                 A,@0X41
   732 00DDB 0070 C        	MOV                 ADDR,A
   733 00DDC 18BF C        	MOV                 A,@0XBF
   734 00DDD 0071 C        	MOV                 VALUE,A
   735 00DDE 114C C        	CALL                WRITE_SPI_REG
   736 00DDF 1840 C        	MOV                 A,@0X40
   737 00DE0 0070 C        	MOV                 ADDR,A
   738 00DE1 1856 C        	MOV                 A,@0X56
   739            C        	if                  USED_PID_FUNCTION
   740            C        		OR              A,@0X80
   741            C        	endif
   742 00DE2 0071 C        	MOV                 VALUE,A
   743 00DE3 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   744 00DE4 0000 C        	NOP
   745 00DE5 0012 C        	RET
   746 00DE6 0000 C        	NOP
   747            C        
   748            C        
   749            C        ;***********************************************************
   750            C        ; Function: Enter TX Buffered NACK
   751            C        ; Input:    None
   752            C        ; Output:   None
   753            C        ;***********************************************************
   754 00DE7      C        Enter_TX_Buffer_NACK:
   755 00DE7 1E00 C        	BANK                0
   756 00DE8 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   757 00DE9 1E01 C        	BANK                1
   758 00DEA 1800 C        	MOV                 A,@0X00
   759 00DEB 0070 C        	MOV                 ADDR,A
   760 00DEC 18E5 C        	MOV                 A,@0XE5
   761 00DED 0071 C        	MOV                 VALUE,A
   762 00DEE 114C C        	CALL                WRITE_SPI_REG
   763 00DEF 1801 C        	MOV                 A,@0X01
   764 00DF0 0070 C        	MOV                 ADDR,A
   765 00DF1 1884 C        	MOV                 A,@0X84
   766 00DF2 0071 C        	MOV                 VALUE,A
   767 00DF3 114C C        	CALL                WRITE_SPI_REG
   768 00DF4 1841 C        	MOV                 A,@0X41
   769 00DF5 0070 C        	MOV                 ADDR,A
   770 00DF6 18BF C        	MOV                 A,@0XBF
   771 00DF7 0071 C        	MOV                 VALUE,A
   772 00DF8 114C C        	CALL                WRITE_SPI_REG
   773 00DF9 1840 C        	MOV                 A,@0X40
   774 00DFA 0070 C        	MOV                 ADDR,A
   775 00DFB 1852 C        	MOV                 A,@0X52
   776            C        	if                  USED_PID_FUNCTION
   777            C        		OR              A,@0X80
   778            C        	endif
   779 00DFC 0071 C        	MOV                 VALUE,A
   780 00DFD 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   781 00DFE 0000 C        	NOP
   782 00DFF 0012 C        	RET
   783 00E00 0000 C        	NOP
   784            C        
   785            C        ;***********************************************************
   786            C        ; Function: Enter TX Direct ACK
   787            C        ; Input:    None
   788            C        ; Output:   None
   789            C        ;***********************************************************
   790 00E01      C        Enter_TX_Direct_ACK:
   791 00E01 1E00 C        	BANK                0
   792 00E02 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   793 00E03 1E01 C        	BANK                1
   794 00E04 1800 C        	MOV                 A,@0X00
   795 00E05 0070 C        	MOV                 ADDR,A
   796 00E06 1885 C        	MOV                 A,@0X85
   797 00E07 0071 C        	MOV                 VALUE,A
   798 00E08 114C C        	CALL                WRITE_SPI_REG
   799 00E09 1801 C        	MOV                 A,@0X01
   800 00E0A 0070 C        	MOV                 ADDR,A
   801 00E0B 1884 C        	MOV                 A,@0X84
   802 00E0C 0071 C        	MOV                 VALUE,A
   803 00E0D 114C C        	CALL                WRITE_SPI_REG
   804 00E0E 1841 C        	MOV                 A,@0X41
   805 00E0F 0070 C        	MOV                 ADDR,A
   806 00E10 18BF C        	MOV                 A,@0XBF
   807 00E11 0071 C        	MOV                 VALUE,A
   808 00E12 114C C        	CALL                WRITE_SPI_REG
   809 00E13 1840 C        	MOV                 A,@0X40
   810 00E14 0070 C        	MOV                 ADDR,A
   811 00E15 1856 C        	MOV                 A,@0X56
   812            C        	if                  USED_PID_FUNCTION
   813            C        		OR              A,@0X80
   814            C        	endif
   815 00E16 0071 C        	MOV                 VALUE,A
   816 00E17 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   817 00E18 0000 C        	NOP
   818 00E19 0012 C        	RET
   819            C        
   820            C        
   821            C        ;***********************************************************
   822            C        ; Function: Enter TX Direct NACK
   823            C        ; Input:    None
   824            C        ; Output:   None
   825            C        ;***********************************************************
   826 00E1A      C        Enter_TX_Direct_NACK:
   827 00E1A 1E00 C        	BANK                0
   828 00E1B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   829 00E1C 1E01 C        	BANK                1
   830 00E1D 1800 C        	MOV                 A,@0X00
   831 00E1E 0070 C        	MOV                 ADDR,A
   832 00E1F 1885 C        	MOV                 A,@0X85
   833 00E20 0071 C        	MOV                 VALUE,A
   834 00E21 114C C        	CALL                WRITE_SPI_REG
   835 00E22 1801 C        	MOV                 A,@0X01
   836 00E23 0070 C        	MOV                 ADDR,A
   837 00E24 1884 C        	MOV                 A,@0X84
   838 00E25 0071 C        	MOV                 VALUE,A
   839 00E26 114C C        	CALL                WRITE_SPI_REG
   840 00E27 1841 C        	MOV                 A,@0X41
   841 00E28 0070 C        	MOV                 ADDR,A
   842 00E29 18BF C        	MOV                 A,@0XBF
   843 00E2A 0071 C        	MOV                 VALUE,A
   844 00E2B 114C C        	CALL                WRITE_SPI_REG
   845 00E2C 1840 C        	MOV                 A,@0X40
   846 00E2D 0070 C        	MOV                 ADDR,A
   847 00E2E 1852 C        	MOV                 A,@0X52
   848            C        	if                  USED_PID_FUNCTION
   849            C        		OR              A,@0X80
   850            C        	endif
   851 00E2F 0071 C        	MOV                 VALUE,A
   852 00E30 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   853 00E31 0000 C        	NOP
   854 00E32 0012 C        	RET
   855 00E33 0000 C        	NOP
   856            C        
   857            C        ;***********************************************************
   858            C        ; Function: Enter RX Buffered ACK
   859            C        ; Input:    None
   860            C        ; Output:   None
   861            C        ;***********************************************************
   862 00E34      C        Enter_RX_Buffer_ACK:
   863 00E34 1E00 C        	BANK                0
   864 00E35 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   865 00E36 1E01 C        	BANK                1
   866 00E37 1800 C        	MOV                 A,@0X00
   867 00E38 0070 C        	MOV                 ADDR,A
   868 00E39 18E5 C        	MOV                 A,@0XE5
   869 00E3A 0071 C        	MOV                 VALUE,A
   870 00E3B 114C C        	CALL                WRITE_SPI_REG
   871 00E3C 1801 C        	MOV                 A,@0X01
   872 00E3D 0070 C        	MOV                 ADDR,A
   873 00E3E 1884 C        	MOV                 A,@0X84
   874 00E3F 0071 C        	MOV                 VALUE,A
   875 00E40 114C C        	CALL                WRITE_SPI_REG
   876 00E41 1841 C        	MOV                 A,@0X41
   877 00E42 0070 C        	MOV                 ADDR,A
   878 00E43 18BF C        	MOV                 A,@0XBF
   879 00E44 0071 C        	MOV                 VALUE,A
   880 00E45 114C C        	CALL                WRITE_SPI_REG
   881 00E46 1840 C        	MOV                 A,@0X40
   882 00E47 0070 C        	MOV                 ADDR,A
   883 00E48 1859 C        	MOV                 A,@0X59
   884            C        	if                  USED_PID_FUNCTION
   885            C        		OR              A,@0X80
   886            C        	endif
   887 00E49 0071 C        	MOV                 VALUE,A
   888 00E4A 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   889 00E4B 0000 C        	NOP
   890 00E4C 0012 C        	RET
   891 00E4D 0000 C        	NOP
   892            C        
   893            C        ;**********************************************************
   894            C        ; Function: Enter RX Buffered NACK
   895            C        ; Input:    None
   896            C        ; Output:   None
   897            C        ;***********************************************************
   898 00E4E      C        Enter_RX_Buffer_NACK:
   899 00E4E 1E00 C        	BANK                0
   900 00E4F 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   901 00E50 1E01 C        	BANK                1
   902 00E51 1800 C        	MOV                 A,@0X00
   903 00E52 0070 C        	MOV                 ADDR,A
   904 00E53 18E5 C        	MOV                 A,@0XE5
   905 00E54 0071 C        	MOV                 VALUE,A
   906 00E55 114C C        	CALL                WRITE_SPI_REG
   907 00E56 1801 C        	MOV                 A,@0X01
   908 00E57 0070 C        	MOV                 ADDR,A
   909 00E58 1884 C        	MOV                 A,@0X84
   910 00E59 0071 C        	MOV                 VALUE,A
   911 00E5A 114C C        	CALL                WRITE_SPI_REG
   912 00E5B 1841 C        	MOV                 A,@0X41
   913 00E5C 0070 C        	MOV                 ADDR,A
   914 00E5D 18BF C        	MOV                 A,@0XBF
   915 00E5E 0071 C        	MOV                 VALUE,A
   916 00E5F 114C C        	CALL                WRITE_SPI_REG
   917 00E60 1840 C        	MOV                 A,@0X40
   918 00E61 0070 C        	MOV                 ADDR,A
   919 00E62 1851 C        	MOV                 A,@0X51
   920            C        	if                  USED_PID_FUNCTION
   921            C        		OR              A,@0X80
   922            C        	endif
   923 00E63 0071 C        	MOV                 VALUE,A
   924 00E64 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   925 00E65 0000 C        	NOP
   926 00E66 0012 C        	RET
   927 00E67 0000 C        	NOP
   928            C        
   929            C        ;***********************************************************
   930            C        ; Function: Enter RX Direct ACK
   931            C        ; Input:    None
   932            C        ; Output:   None
   933            C        ;***********************************************************
   934 00E68      C        Enter_RX_Direct_ACK:
   935 00E68 1E00 C        	BANK                0
   936 00E69 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   937 00E6A 1E01 C        	BANK                1
   938 00E6B 1800 C        	MOV                 A,@0X00
   939 00E6C 0070 C        	MOV                 ADDR,A
   940 00E6D 1885 C        	MOV                 A,@0X85
   941 00E6E 0071 C        	MOV                 VALUE,A
   942 00E6F 114C C        	CALL                WRITE_SPI_REG
   943 00E70 1801 C        	MOV                 A,@0X01
   944 00E71 0070 C        	MOV                 ADDR,A
   945 00E72 1884 C        	MOV                 A,@0X84
   946 00E73 0071 C        	MOV                 VALUE,A
   947 00E74 114C C        	CALL                WRITE_SPI_REG
   948 00E75 1841 C        	MOV                 A,@0X41
   949 00E76 0070 C        	MOV                 ADDR,A
   950 00E77 18BF C        	MOV                 A,@0XBF
   951 00E78 0071 C        	MOV                 VALUE,A
   952 00E79 114C C        	CALL                WRITE_SPI_REG
   953 00E7A 1840 C        	MOV                 A,@0X40
   954 00E7B 0070 C        	MOV                 ADDR,A
   955 00E7C 1859 C        	MOV                 A,@0X59
   956            C        	if                  USED_PID_FUNCTION
   957            C        		OR              A,@0X80
   958            C        	endif
   959 00E7D 0071 C        	MOV                 VALUE,A
   960 00E7E 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   961 00E7F 0012 C        	RET
   962            C        
   963            C        
   964            C        ;**********************************************************
   965            C        ; Function: Enter RX Direct NACK
   966            C        ; Input:    None
   967            C        ; Output:   None
   968            C        ;***********************************************************
   969 00E80      C        Enter_RX_Direct_NACK:
   970 00E80 1E00 C        	BANK                0
   971 00E81 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   972 00E82 1E01 C        	BANK                1
   973 00E83 1800 C        	MOV                 A,@0X00
   974 00E84 0070 C        	MOV                 ADDR,A
   975 00E85 1885 C        	MOV                 A,@0X85
   976 00E86 0071 C        	MOV                 VALUE,A
   977 00E87 114C C        	CALL                WRITE_SPI_REG
   978 00E88 1801 C        	MOV                 A,@0X01
   979 00E89 0070 C        	MOV                 ADDR,A
   980 00E8A 1884 C        	MOV                 A,@0X84
   981 00E8B 0071 C        	MOV                 VALUE,A
   982 00E8C 114C C        	CALL                WRITE_SPI_REG
   983 00E8D 1841 C        	MOV                 A,@0X41
   984 00E8E 0070 C        	MOV                 ADDR,A
   985 00E8F 18BF C        	MOV                 A,@0XBF
   986 00E90 0071 C        	MOV                 VALUE,A
   987 00E91 114C C        	CALL                WRITE_SPI_REG
   988 00E92 1840 C        	MOV                 A,@0X40
   989 00E93 0070 C        	MOV                 ADDR,A
   990 00E94 1851 C        	MOV                 A,@0X51
   991            C        	if                  USED_PID_FUNCTION
   992            C        		OR              A,@0X80
   993            C        	endif
   994 00E95 0071 C        	MOV                 VALUE,A
   995 00E96 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   996 00E97 0000 C        	NOP
   997 00E98 0012 C        	RET
   998 00E99 0000 C        	NOP
   999            C        
  1000            C        ;***********************************************************
  1001            C        ; Function: Enter StandbyI Mode
  1002            C        ; Input:    None
  1003            C        ; Output:   None
  1004            C        ; description:
  1005            C        ;***********************************************************
  1006 00E9A      C        Enter_StandbyI_Mode:
  1007 00E9A 1E00 C        	BANK                0
  1008 00E9B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1009 00E9C 1E01 C        	BANK                1
  1010 00E9D 1800 C        	MOV                 A,@0X00
  1011 00E9E 0070 C        	MOV                 ADDR,A
  1012 00E9F 1865 C        	MOV                 A,@0X65
  1013 00EA0 0071 C        	MOV                 VALUE,A
  1014 00EA1 114C C        	CALL                WRITE_SPI_REG
  1015 00EA2 1801 C        	MOV                 A,@0X01
  1016 00EA3 0070 C        	MOV                 ADDR,A
  1017 00EA4 188C C        	MOV                 A,@0X8C
  1018 00EA5 0071 C        	MOV                 VALUE,A
  1019 00EA6 114C C        	CALL                WRITE_SPI_REG
  1020 00EA7 1840 C        	MOV                 A,@0X40
  1021 00EA8 0070 C        	MOV                 ADDR,A
  1022 00EA9 1850 C        	MOV                 A,@0X50
  1023            C        	if                  USED_PID_FUNCTION
  1024            C        		OR              A,@0X80
  1025            C        	endif
  1026 00EAA 0071 C        	MOV                 VALUE,A
  1027 00EAB 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1028 00EAC 0000 C        	NOP
  1029 00EAD 0012 C        	RET
  1030 00EAE 0000 C        	NOP
  1031            C        
  1032            C        ;***********************************************************
  1033            C        ; Function: Enter StandbyII Mode
  1034            C        ; Input:    None
  1035            C        ; Output:   None
  1036            C        ; description: auto enter
  1037            C        ;***********************************************************
  1038 00EAF      C        Enter_StandbyII_Mode:
  1039 00EAF 1E00 C        	BANK                0
  1040 00EB0 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=0
  1041 00EB1 1E01 C        	BANK                1
  1042 00EB2 1800 C        	MOV                 A,@0X00
  1043 00EB3 0070 C        	MOV                 ADDR,A
  1044 00EB4 18E5 C        	MOV                 A,@0XE5
  1045 00EB5 0071 C        	MOV                 VALUE,A
  1046 00EB6 114C C        	CALL                WRITE_SPI_REG
  1047 00EB7 1801 C        	MOV                 A,@0X01
  1048 00EB8 0070 C        	MOV                 ADDR,A
  1049 00EB9 1884 C        	MOV                 A,@0X84
  1050 00EBA 0071 C        	MOV                 VALUE,A
  1051 00EBB 114C C        	CALL                WRITE_SPI_REG
  1052 00EBC 1841 C        	MOV                 A,@0X41
  1053 00EBD 0070 C        	MOV                 ADDR,A
  1054 00EBE 18BF C        	MOV                 A,@0XBF
  1055 00EBF 0071 C        	MOV                 VALUE,A
  1056 00EC0 114C C        	CALL                WRITE_SPI_REG
  1057 00EC1 1840 C        	MOV                 A,@0X40
  1058 00EC2 0070 C        	MOV                 ADDR,A
  1059 00EC3 1852 C        	MOV                 A,@0X52
  1060            C        	if                  USED_PID_FUNCTION
  1061            C        		OR              A,@0X80
  1062            C        	endif
  1063 00EC4 0071 C        	MOV                 VALUE,A
  1064 00EC5 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1065 00EC6 0000 C        	NOP
  1066 00EC7 0012 C        	RET
  1067 00EC8 0000 C        	NOP
  1068            C        
  1069            C        ;===============================================
  1070            C        ; Function: Enter Idle Mode
  1071            C        ; Input:    None
  1072            C        ; Output:   None
  1073            C        ;===============================================
  1074 00EC9      C        ENTER_IDLE_MODE:
  1075 00EC9 1E00 C        	BANK                0
  1076 00ECA 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1077 00ECB 1E01 C        	BANK                1
  1078 00ECC 1800 C        	MOV                 A,@0X00
  1079 00ECD 0070 C        	MOV                 ADDR,A
  1080 00ECE 18C0 C        	MOV                 A,@0XC0
  1081 00ECF 0071 C        	MOV                 VALUE,A
  1082 00ED0 114C C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1083 00ED1 1801 C        	MOV                 A,@0X01
  1084 00ED2 0070 C        	MOV                 ADDR,A
  1085 00ED3 188A C        	MOV                 A,@0X8A
  1086 00ED4 0071 C        	MOV                 VALUE,A
  1087 00ED5 114C C        	CALL                WRITE_SPI_REG
  1088 00ED6 1E00 C        	BANK                0
  1089 00ED7 08CA C        	BC                  RESET_N/16,RESET_N%16
  1090 00ED8 1E01 C        	BANK                1
  1091 00ED9 0000 C        	NOP
  1092 00EDA 0012 C        	RET
  1093 00EDB 0000 C        	NOP
  1094            C        
  1095            C        ;===============================================
  1096            C        ; Function: EXIT Idle Mode
  1097            C        ; Input:    None
  1098            C        ; Output:   None
  1099            C        ;===============================================
  1100 00EDC      C        EXIT_IDLE_MODE:
  1101 00EDC 1E00 C        	BANK                0
  1102 00EDD 0ACA C        	BS		            RESET_N/16,RESET_N%16
  1103 00EDE 1E01 C        	BANK                1
  1104 00EDF 1832 C        	MOV                 A,@50                          ; wating 10ms
  1105 00EE0 1351 C        	CALL                DELAY_X100US
  1106 00EE1 12AF C        	CALL                Enter_StandbyII_Mode
  1107 00EE2 0000 C        	NOP
  1108 00EE3 0012 C        	RET
  1109 00EE4 0000 C        	NOP
  1110            C        
  1111            C        ;===============================================
  1112            C        ; Function: RF Enter Sleep Mode
  1113            C        ; Input:    ADDR,VALUE
  1114            C        ; Output:   None
  1115            C        ;===============================================
  1116 00EE5      C        RF_SLEEP:
  1117 00EE5 1E00 C        	BANK                0
  1118 00EE6 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1119 00EE7 1E01 C        	BANK                1
  1120 00EE8 1800 C        	MOV                 A,@0X00
  1121 00EE9 0070 C        	MOV                 ADDR,A
  1122 00EEA 18E5 C        	MOV                 A,@0XE5
  1123 00EEB 0071 C        	MOV                 VALUE,A
  1124 00EEC 114C C        	CALL                WRITE_SPI_REG
  1125 00EED 0000 C        	NOP
  1126 00EEE 1E00 C        	BANK                0
  1127 00EEF 08CA C        	BC                  RESET_N/16,RESET_N%16
  1128 00EF0 1E01 C        	BANK                1
  1129 00EF1 0000 C        	NOP
  1130 00EF2 0012 C        	RET
  1131 00EF3 0000 C        	NOP
  1132            C        
  1133            C        ;===============================================
  1134            C        ; Function: RF Wake Up
  1135            C        ; Input:    None
  1136            C        ; Output:   None
  1137            C        ;===============================================
  1138 00EF4      C        RF_WAKEUP:
  1139 00EF4 1E00 C        	BANK                0
  1140 00EF5 0ACA C        	BS                  RESET_N/16,RESET_N%16
  1141 00EF6 1819 C        	MOV                 A,@25
  1142 00EF7 1351 C        	CALL                DELAY_X100US
  1143 00EF8 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1144 00EF9 1E01 C        	BANK                1
  1145 00EFA 1800 C        	MOV                 A,@0X00
  1146 00EFB 0070 C        	MOV                 ADDR,A
  1147 00EFC 18E5 C        	MOV                 A,@0XE5
  1148 00EFD 0071 C        	MOV                 VALUE,A
  1149 00EFE 114C C        	CALL                WRITE_SPI_REG
  1150 00EFF 0000 C        	NOP
  1151 00F00 0012 C        	RET
  1152 00F01 0000 C        	NOP
  1153            C        
  1154            C        ;===============================================
  1155            C        ; Function: RF Channel Frequency Set
  1156            C        ; Input:    TABLE_INDEX
  1157            C        ; Output:   None
  1158            C        ;===============================================
  1159 00F02      C        RF_FREQ_SET:
  1160 00F02 1E00 C        	BANK                0
  1161 00F03 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1162 00F04 1E01 C        	BANK                1
  1163 00F05 1802 C        	MOV                 A,@0X02
  1164 00F06 0070 C        	MOV                 ADDR,A
  1165 00F07 0432 C        	MOV                 A,CH_NO
  1166 00F08 10AC C        	CALL                CH_TABLE
  1167 00F09 0071 C        	MOV                 VALUE,A
  1168 00F0A 114C C        	CALL                WRITE_SPI_REG
  1169 00F0B 0000 C        	NOP
  1170 00F0C 0012 C        	RET
  1171 00F0D 0000 C        	NOP
  1172            C        
  1173            C        ;===============================================
  1174            C        ; Function: Read PKT Lost Count
  1175            C        ; Input:    None
  1176            C        ; Output:   PKT_Lost_Count
  1177            C        ;===============================================
  1178 00F0E      C        READ_PKTLOSTCNT:
  1179 00F0E 184F C        	MOV                 A,@0X4F
  1180 00F0F 0070 C        	MOV                 ADDR,A
  1181 00F10 115C C        	CALL                READ_SPI_REG
  1182 00F11 0000 C        	NOP
  1183 00F12 0012 C        	RET
  1184 00F13 0000 C        	NOP
  1185            C        
  1186            C        ;===============================================
  1187            C        ; Function: Clr PKT Lost Count
  1188            C        ; Input:    Zero
  1189            C        ; Output:   None
  1190            C        ;===============================================
  1191 00F14      C        CLR_PKTLOSTCNT:
  1192 00F14 184F C        	MOV                 A,@0X4F
  1193 00F15 0070 C        	MOV                 ADDR,A
  1194 00F16 1800 C        	MOV                 A,@0X00
  1195 00F17 0071 C        	MOV                 VALUE,A
  1196 00F18 114C C        	CALL                WRITE_SPI_REG
  1197 00F19 0012 C        	RET
  1198            C        
  1199            C        ;===============================================
  1200            C        ; Function: Address change function
  1201            C        ; Input:    RX_IDH,RX_IDL
  1202            C        ; Output:   None
  1203            C        ;===============================================
  1204 00F1A      C        CHANGE_ADDRESS_VALUE:
  1205 00F1A 1E01 C        	BANK                1
  1206 00F1B 1841 C        	MOV                 A,@0X41
  1207 00F1C 0070 C        	MOV                 ADDR,A
  1208 00F1D 18BF C        	MOV                 A,@0B10111111
  1209 00F1E 0071 C        	MOV                 VALUE,A
  1210 00F1F 114C C        	CALL                WRITE_SPI_REG    ; Enalbe 6 TX
  1211            C        
  1212 00F20 1851 C        	MOV                 A,@0X51
  1213 00F21 0070 C        	MOV                 ADDR,A
  1214 00F22 0421 C        	MOV                 A,RX_IDH
  1215 00F23 0071 C        	MOV                 VALUE,A
  1216 00F24 114C C        	CALL                WRITE_SPI_REG
  1217            C        
  1218 00F25 1853 C        	MOV                 A,@0X53
  1219 00F26 0070 C        	MOV                 ADDR,A
  1220 00F27 0421 C        	MOV                 A,RX_IDH
  1221 00F28 0071 C        	MOV                 VALUE,A
  1222 00F29 114C C        	CALL                WRITE_SPI_REG
  1223            C        
  1224 00F2A 1850 C        	MOV                 A,@0X50
  1225 00F2B 0070 C        	MOV                 ADDR,A
  1226 00F2C 0422 C        	MOV                 A,RX_IDL
  1227 00F2D 0071 C        	MOV                 VALUE,A
  1228 00F2E 114C C        	CALL                WRITE_SPI_REG
  1229            C        /*
  1230            C        	MOV                 A,@0X52
  1231            C        	MOV                 ADDR,A
  1232            C        	MOV                 A,RX_IDL
  1233            C        	AND                 A,@0B11110000
  1234            C        	MOV                 VALUE,A
  1235            C        	INC                 VALUE         ; TX_ID1=(RX_IDL&0XF0)|0X01
  1236            C        	INC                 VALUE         ; TX_ID2=(RX_IDL&0XF0)|0X02
  1237            C        	CALL                WRITE_SPI_REG
  1238            C        
  1239            C        	MOV                 A,@0X54
  1240            C        	MOV                 ADDR,A
  1241            C        	INC                 VALUE         ; TX_ID3=(RX_IDL&0XF0)|0X03
  1242            C        	CALL                WRITE_SPI_REG
  1243            C        
  1244            C        	MOV                 A,@0X55
  1245            C        	MOV                 ADDR,A
  1246            C        	INC                 VALUE         ; TX_ID4=(RX_IDL&0XF0)|0X04
  1247            C        	CALL                WRITE_SPI_REG
  1248            C        
  1249            C        	MOV                 A,@0X56
  1250            C        	MOV                 ADDR,A
  1251            C        	INC                 VALUE         ; TX_ID5=(RX_IDL&0XF0)|0X05
  1252            C        	CALL                WRITE_SPI_REG
  1253            C        
  1254            C        	MOV                 A,@0X57
  1255            C        	MOV                 ADDR,A
  1256            C        	INC                 VALUE         ; TX_ID6=(RX_IDL&0XF0)|0X06
  1257            C        	CALL                WRITE_SPI_REG
  1258            C        */
  1259 00F2F 0000 C        	NOP
  1260 00F30 0012 C        	RET
  1261 00F31 0000 C        	NOP
  1262            C        
  1263            C        ;***********************************************************
  1264            C        ; Function: RF RSSI Check the channel if is clean
  1265            C        ; Input:    None
  1266            C        ; Output:   None
  1267            C        ;***********************************************************
  1268 00F32      C        RF_RSSI_CHECK:
  1269 00F32 124E C        	CALL                Enter_RX_Buffer_NACK
  1270 00F33      C          Scan_Clean_Channel:
  1271 00F33 1001 C        	CALL                1
  1272 00F34 184B C        	MOV                 A,@0X4B
  1273 00F35 0070 C        	MOV                 ADDR,A
  1274 00F36 115C C        	CALL                READ_SPI_REG
  1275 00F37 0431 C        	MOV                 A,VALUE
  1276 00F38 1D25 C        	SUB                 A,@NoiseStrobe
  1277 00F39 0E03 C        	JBS                 STATUS,C
  1278 00F3A 1745 C        	JMP                 Exit_RSSI_Check
  1279            C        
  1280 00F3B 1001 C        	CALL                1
  1281 00F3C 0572 C        	INC                 CH_NO
  1282 00F3D 0432 C        	MOV                 A,CH_NO
  1283 00F3E 1D4B C        	SUB                 A,@ChannelSum
  1284 00F3F 0E03 C        	JBS                 STATUS,C
  1285 00F40 00F2 C        	CLR                 CH_NO
  1286 00F41 1302 C        	CALL                RF_FREQ_SET
  1287 00F42 1805 C        	MOV                 A,@5
  1288 00F43 1351 C        	CALL                DELAY_X100US
  1289            C        
  1290            C        	;MOV                 A,@0X80      ; (test)P57 exchange when intrrupt
  1291            C        	;XOR                 PORT5,A
  1292            C        
  1293 00F44 1733 C        	JMP                 Scan_Clean_Channel
  1294 00F45      C          Exit_RSSI_Check:
  1295 00F45 0000 C        	NOP
  1296 00F46 0012 C        	RET
  1297 00F47 0000 C        	NOP
  1298            C        
  1299            C        ;===============================================
  1300            C        ; Function: Delay 20us
  1301            C        ; Input:    None
  1302            C        ; Output:   None
  1303            C        ;===============================================
  1304 00F48      C        DELAY_X10US:
  1305 00F48 0051 C        	MOV                 TEMP1,A
  1306 00F49      C          Delay_Loop_X10US:
  1307 00F49 1808 C        	MOV                 A,@8      ;
  1308 00F4A 0052 C        	MOV                 TEMP2,A
  1309 00F4B      C          Waiting_X10US:
  1310 00F4B 05D2 C        	DJZ                 TEMP2
  1311 00F4C 174B C        	JMP                 Waiting_X10US
  1312 00F4D 05D1 C        	DJZ                 TEMP1
  1313 00F4E 1749 C        	JMP                 Delay_Loop_X10US
  1314 00F4F 0012 C        	RET
  1315 00F50 0000 C        	NOP
  1316            C        
  1317            C        ;===============================================
  1318            C        ; Function: Delay 100us
  1319            C        ; Input:    None
  1320            C        ; Output:   None
  1321            C        ;===============================================
  1322 00F51      C        DELAY_X100US:
  1323 00F51 0051 C        	MOV                 TEMP1,A
  1324 00F52      C          Delay_Loop:
  1325 00F52 1850 C        	MOV                 A,@0X50      ;
  1326 00F53 0052 C        	MOV                 TEMP2,A
  1327 00F54      C          Waiting:
  1328 00F54 0000 C        	NOP
  1329 00F55 05D2 C        	DJZ                 TEMP2
  1330 00F56 1754 C        	JMP                 Waiting
  1331 00F57 05D1 C        	DJZ                 TEMP1
  1332 00F58 1752 C        	JMP                 Delay_Loop
  1333 00F59 0012 C        	RET
  1334 00F5A 0000 C        	NOP
  1335            C        
  1336            C        
  1337            C        ;===============================================
  1338            C        ;test RF Register, if read==write test pass
  1339            C        ;===============================================
  1340 00F5B      C        TEST_INITIAL_RF:
  1341 00F5B      C          Analog_Reg_Test:
  1342 00F5B 1807 C        	MOV                 A,@0X07
  1343 00F5C 0070 C        	MOV                 ADDR,A
  1344 00F5D 1858 C        	MOV                 A,@0X58						;R7[6]=1
  1345 00F5E 0071 C        	MOV                 VALUE,A
  1346 00F5F 114C C        	CALL                WRITE_SPI_REG
  1347 00F60 0000 C        	NOP
  1348 00F61 180E C        	MOV                 A,@0X0E
  1349 00F62 0070 C        	MOV                 ADDR,A
  1350 00F63 1811 C        	MOV                 A,@0X11						;RE[7]=0
  1351 00F64 0071 C        	MOV                 VALUE,A
  1352 00F65 114C C        	CALL                WRITE_SPI_REG
  1353 00F66 0000 C        	NOP
  1354 00F67 182E C        	MOV                 A,@0X2E
  1355 00F68 0070 C        	MOV                 ADDR,A
  1356 00F69 1823 C        	MOV                 A,@0X23						;R2E[5]=1
  1357 00F6A 0071 C        	MOV                 VALUE,A
  1358 00F6B 114C C        	CALL                WRITE_SPI_REG
  1359 00F6C 0000 C        	NOP
  1360 00F6D 180E C        	MOV                 A,@0X0E
  1361 00F6E 0070 C        	MOV                 ADDR,A
  1362 00F6F 1891 C        	MOV                 A,@0X91						;RE[7]=1
  1363 00F70 0071 C        	MOV                 VALUE,A
  1364 00F71 114C C        	CALL                WRITE_SPI_REG
  1365 00F72 0000 C        	NOP
  1366 00F73 1234 C        	CALL                Enter_RX_Buffer_ACK
  1367 00F74 0000 C        	NOP
  1368 00F75 1808 C        	MOV                 A,@8
  1369 00F76 1351 C        	CALL                DELAY_X100US
  1370 00F77 0000 C        	NOP
  1371 00F78 184B C        	MOV                 A,@0X4B
  1372 00F79 0070 C        	MOV                 ADDR,A
  1373 00F7A 115C C        	CALL                READ_SPI_REG
  1374 00F7B 0000 C        	NOP
  1375 00F7C 0C31 C        	JBC                 VALUE,0					;R4B[0]:LD=1,Analog Reg Initial is OK
  1376 00F7D 1780 C        	JMP                 Digit_Reg_Test
  1377 00F7E 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1378 00F7F 1795 C        	JMP                 RF_TEST_RET
  1379 00F80      C          Digit_Reg_Test:
  1380 00F80 00F4 C        	CLR                 TABLE_INDEX
  1381 00F81      C          Check_Digit_Reg:
  1382 00F81 0434 C        	MOV                 A,TABLE_INDEX
  1383 00F82 108C C        	CALL                RF_TABLE
  1384 00F83 0000 C        	NOP
  1385 00F84 0070 C        	MOV                 ADDR,A
  1386 00F85 1BFF C        	XOR                 A, @0XFF
  1387 00F86 0C83 C        	JBC                 STATUS,Z
  1388 00F87 1795 C        	JMP                 RF_TEST_RET
  1389 00F88 115C C        	CALL                READ_SPI_REG
  1390 00F89 0000 C        	NOP
  1391 00F8A 0574 C        	INC                 TABLE_INDEX
  1392 00F8B 0434 C        	MOV                 A,TABLE_INDEX
  1393 00F8C 108C C        	CALL                RF_TABLE
  1394 00F8D 0000 C        	NOP
  1395 00F8E 0331 C        	XOR                 A,VALUE
  1396 00F8F 0C83 C        	JBC                 STATUS,Z
  1397 00F90 1793 C        	JMP                 RF_TABLE_INC
  1398 00F91 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1399 00F92 1795 C        	JMP                 RF_TEST_RET
  1400 00F93      C          RF_TABLE_INC:
  1401 00F93 0574 C        	INC                 TABLE_INDEX
  1402 00F94 1781 C        	JMP                 Check_Digit_Reg
  1403 00F95      C          RF_TEST_RET:
  1404 00F95 0012 C        	RET
  1405            C        
    18                     include "P520SkipFreqFunc.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.1
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/4
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        P520SkipFreqFunc.ASM    EQU    P520SkipFreqFunc.ASM
    12            C        
    13            C        ifndef EM78CtrlIns.H
    14            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    15            C        endif
    16            C        
    17            C        ifndef keyscan.asm
    18            C        include "keyscan.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.1
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        
    14            C        ;---------------------------------------------------
    15            C        keyscan.asm             EQU       keyscan.asm
    16            C        include "keyscan.H"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.1
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : eUIDE
    10            C        ; descripition  : FOR_EM78P520,
    11            C        ;=============================================================================
    12            C        
    13            C        
    14            C        keyscan.h           EQU        keyscan.h
    15            C        
    16            C        ;KeystokePort        EQU        0b00100000
    17       0032 C        LeakresisTimeCNT    EQU        50
    18            C        
    19            C        ;======================= key scan port define =========================
    20       0007 C        X_KeyLine           EQU        PORT7
    21       0074 C        X_LINE1             EQU        X_KeyLine*16+4		;R74
    22       0075 C        X_LINE2             EQU        X_KeyLine*16+5		;R73
    23       0076 C        X_LINE3             EQU        X_KeyLine*16+6		;R72
    24       0077 C        X_LINE4             EQU        X_KeyLine*16+7		;R71
    25            C        
    26       0009 C        X_Keyrow            EQU        PORT9
    27       0097 C        X_ROW1              EQU        X_Keyrow*16+7		;R97
    28       0096 C        X_ROW2              EQU        X_Keyrow*16+6		;R96
    29       0095 C        X_ROW3              EQU        X_Keyrow*16+5		;R95
    30       0094 C        X_ROW4              EQU        X_Keyrow*16+4		;R94
    31            C        
    32            C        ;------------------------ Define form SCH ----------------------------
    33       0005 C        _UP                 EQU        5    ;Port85
    34       0004 C        _RIGHT              EQU        4    ;Port84
    35       0002 C        _DOWN               EQU        2    ;Port82
    36       0001 C        _LEFT               EQU        1    ;Port81
    37            C        
    38       0007 C        _A                  EQU        7    ;Port97
    39       0006 C        _B                  EQU        6    ;Port96
    40       0005 C        _C                  EQU        5    ;Port95
    41       0004 C        _D                  EQU        4    ;Port94
    42            C        
    43       0007 C        _L1                 EQU        7    ;Port97
    44       0006 C        _R1                 EQU        6    ;Port96
    45       0005 C        _L2                 EQU        5    ;Port95
    46       0004 C        _R2                 EQU        4    ;Port94
    47            C        
    48       0007 C        _SELECT             EQU        7    ;Port97
    49       0006 C        _START              EQU        6    ;Port96
    50       0007 C        _LSW                EQU        7    ;Port97
    51       0004 C        _RSW                EQU        4    ;Port94
    52            C        
    53       0005 C        _MODE               EQU        5    ;Port95
    54       0004 C        _MACRO              EQU        4    ;Port94
    55       0006 C        _TEST1              EQU        6    ;Port96
    56       0005 C        _TEST2              EQU        5    ;Port95
    57            C        
    58            C        ;---------------------------------------------------------
    59            C        
    60       0000 C        A_1                 EQU        0    ;DataE
    61       0001 C        B_2                 EQU        1
    62       0002 C        C_3                 EQU        2
    63       0003 C        D_4                 EQU        3
    64       0004 C        L1_5                EQU        4
    65       0005 C        R1_6                EQU        5
    66       0006 C        L2_7                EQU        6
    67       0007 C        R2_8                EQU        7
    68            C        
    69       0000 C        SELECT_9            EQU        0    ;DataF
    70       0001 C        START_10            EQU        1
    71       0002 C        LSW_11              EQU        2
    72       0003 C        RSW_12              EQU        3
    73       0004 C        MODE_13             EQU        4
    74       0005 C        MACRO_14            EQU        5
    75       0006 C        TEST1_15            EQU        6
    76       0007 C        TEST2_16            EQU        7
    77            C        
    78            C        
    79            C        ;=============== Connect key scan ======================
    80       00B4 C        KeyPressTime                EQU    180
    81       003C C        KeyScanTime                 EQU    60
    82       001E C        CrossingTime                EQU    30
    83       0002 C        KeyScanTimeCNT_default      EQU    2     
    84            C        
    85            C        
    86            C        
    87            C        
    88            C        
    17            C        
    18            C        ifndef EM78CtrlIns.H
    19            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    20            C        endif
    21            C        ;----------------------------------------------------
    22            C        	ORG                 0x1100    ;PAGE 4
    23            C        	MESSAGE "define 'keyscan.asm' ROM address"
***     USER MESSAGE: DEFINE 'KEYSCAN.ASM' ROM ADDRESS
    24 01100      C        Key_Scan:
    25            C        ;=============================== I/O config ================================
    26 01100 1E05 C        	BANK                5
    27 01101 1837 C        	MOV                 A,@00110111B
    28 01102 004B C        	MOV                 PBPHCR,A	    	;PB0 PB1 PB2 PB4 PB5 ENABLE PULL HIGH
    29 01103 18F0 C         	MOV                 A,@11110000B
    30 01104 0049 C         	MOV                 P9PHCR,A		    ;SET PULL UP
    31            C         ;===========================================================================
    32            C         ;Setting LED Status
    33            C         ;===========================================================================
    34 01105 1E02 C        	BANK                2
    35 01106 0F25 C        	JBS                 DataF,MODE_13    ; 1:analog  0:digital(default 0),LED light
    36 01107 1509 C        	JMP                 SET_VR_STATUS_0
    37 01108 150D C        	JMP                 SET_VR_STATUS_1
    38 01109      C          SET_VR_STATUS_0:
    39 01109 0000 C        	NOP
    40 0110A 1E00 C        	BANK                0
    41 0110B 0848 C        	BC                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    42 0110C 1511 C        	JMP                 SET_VR_STATUS_END
    43 0110D      C          SET_VR_STATUS_1:
    44 0110D 0000 C        	NOP
    45 0110E 1E00 C        	BANK                0
    46 0110F 0A48 C        	BS                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    47 01110 1511 C        	JMP                 SET_VR_STATUS_END
    48 01111      C          SET_VR_STATUS_END:
    49 01111 1E02 C        	BANK                2
    50 01112 0000 C         	NOP
    51            C        
    52            C        ;================================================================================
    53            C        ;Keyscan Main
    54            C        ;================================================================================
    55 01113 116B C        	CALL                KeyPort_Check
    56 01114 0000 C        	NOP
    57            C        ;--------------------- Judge mode status ------------------------
    58 01115 0D39 C        	JBC                 ModeSelFlag/16,ModeSelFlag%16
    59 01116 151D C        	JMP                 MODE_NOCHANGE
    60 01117 0F3A C        	JBS                 ModeSelBakupFlag/16,ModeSelBakupFlag%16
    61 01118 151D C        	JMP                 MODE_NOCHANGE
    62 01119 0000 C        	NOP
    63            C      M 	COM                 DataF,MODE_13
       0111A 1810     1     MOV A,@( 16 )
       0111B 0365     1     XOR  DATAF ,A
    64 0111C 0000 C        	NOP
    65 0111D      C          MODE_NOCHANGE:
    66            C      M 	MOVB                KeyTempBakupFlag,MODE_13,KeyTempFlag,MODE_13
       0111D 0F39     1     JBS  KEYTEMPFLAG , MODE_13 
       0111E 093A     1     BC  KEYTEMPBAKUPFLAG , MODE_13 
       0111F 0D39     1     JBC  KEYTEMPFLAG , MODE_13 
       01120 0B3A     1     BS  KEYTEMPBAKUPFLAG , MODE_13 
    67 01121 0939 C        	BC                  ModeSelFlag/16,ModeSelFlag%16
    68            C        
    69            C        ;----------------deal with DataA/DataB/DataC/DataD/DataG-----------------
    70 01122 0000 C        	NOP
    71 01123 1235 C        	CALL                ADC_Rocker_KeyScan
    72 01124 0000 C        	NOP
    73            C        	;CALL                IO_Rocker_KeyScan
    74 01125 0000 C        	NOP
    75 01126 125F C        	CALL                Rocker_KeyScan
    76 01127 0000 C        	NOP
    77 01128 11A6 C        	CALL                Direction_KeyCheck
    78            C        
    79            C        ;-----------------------deal with DataE------------------------------------------
    80            C        ; bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0
    81            C        ; A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
    82            C        ;--------------------------------------------------------------------------------
    83 01129 00D0 C        	CLR                 TEMP
    84            C      M 	MOVB                TEMP,A_1,LINE2_KEY_INPUT_CACHE,_A
       0112A 0FFC     1     JBS  LINE2_KEY_INPUT_CACHE , _A 
       0112B 0810     1     BC  TEMP , A_1 
       0112C 0DFC     1     JBC  LINE2_KEY_INPUT_CACHE , _A 
       0112D 0A10     1     BS  TEMP , A_1 
    85            C      M 	MOVB                TEMP,B_2,LINE3_KEY_INPUT_CACHE,_B
       0112E 0FBD     1     JBS  LINE3_KEY_INPUT_CACHE , _B 
       0112F 0850     1     BC  TEMP , B_2 
       01130 0DBD     1     JBC  LINE3_KEY_INPUT_CACHE , _B 
       01131 0A50     1     BS  TEMP , B_2 
    86            C      M 	MOVB                TEMP,C_3,LINE4_KEY_INPUT_CACHE,_C
       01132 0F7E     1     JBS  LINE4_KEY_INPUT_CACHE , _C 
       01133 0890     1     BC  TEMP , C_3 
       01134 0D7E     1     JBC  LINE4_KEY_INPUT_CACHE , _C 
       01135 0A90     1     BS  TEMP , C_3 
    87            C      M 	MOVB                TEMP,D_4,LINE5_KEY_INPUT_CACHE,_D
       01136 0F3F     1     JBS  LINE5_KEY_INPUT_CACHE , _D 
       01137 08D0     1     BC  TEMP , D_4 
       01138 0D3F     1     JBC  LINE5_KEY_INPUT_CACHE , _D 
       01139 0AD0     1     BS  TEMP , D_4 
    88            C      M 	MOVB                TEMP,L1_5,LINE3_KEY_INPUT_CACHE,_L1
       0113A 0FFD     1     JBS  LINE3_KEY_INPUT_CACHE , _L1 
       0113B 0910     1     BC  TEMP , L1_5 
       0113C 0DFD     1     JBC  LINE3_KEY_INPUT_CACHE , _L1 
       0113D 0B10     1     BS  TEMP , L1_5 
    89            C      M 	MOVB                TEMP,R1_6,LINE4_KEY_INPUT_CACHE,_R1
       0113E 0FBE     1     JBS  LINE4_KEY_INPUT_CACHE , _R1 
       0113F 0950     1     BC  TEMP , R1_6 
       01140 0DBE     1     JBC  LINE4_KEY_INPUT_CACHE , _R1 
       01141 0B50     1     BS  TEMP , R1_6 
    90            C      M 	MOVB                TEMP,L2_7,LINE2_KEY_INPUT_CACHE,_L2
       01142 0F7C     1     JBS  LINE2_KEY_INPUT_CACHE , _L2 
       01143 0990     1     BC  TEMP , L2_7 
       01144 0D7C     1     JBC  LINE2_KEY_INPUT_CACHE , _L2 
       01145 0B90     1     BS  TEMP , L2_7 
    91            C      M 	MOVB                TEMP,R2_8,LINE3_KEY_INPUT_CACHE,_R2
       01146 0F3D     1     JBS  LINE3_KEY_INPUT_CACHE , _R2 
       01147 09D0     1     BC  TEMP , R2_8 
       01148 0D3D     1     JBC  LINE3_KEY_INPUT_CACHE , _R2 
       01149 0BD0     1     BS  TEMP , R2_8 
    92 0114A 0410 C        	MOV                 A,TEMP
    93 0114B 0264 C        	OR                  DataE,A
    94            C        
    95            C        ;-----------------------deal with DataF------------------------------------------
    96            C        ; bit0      bit1      bit2     bit3     bit4     bit5      bit6      bit7
    97            C        ; Select_9  Start_10  LSW_11   RSW_12   MODE_13  MACRO_14  TEST1_15  TEST2_16
    98            C        ;--------------------------------------------------------------------------------
    99            C        	;CLR                 DataF
   100            C      M 	MOVB                DataF,SELECT_9,LINE4_KEY_INPUT_CACHE,_Select
       0114C 0FFE     1     JBS  LINE4_KEY_INPUT_CACHE , _SELECT 
       0114D 0825     1     BC  DATAF , SELECT_9 
       0114E 0DFE     1     JBC  LINE4_KEY_INPUT_CACHE , _SELECT 
       0114F 0A25     1     BS  DATAF , SELECT_9 
   101            C      M 	MOVB                DataF,Start_10,LINE5_KEY_INPUT_CACHE,_Start
       01150 0FBF     1     JBS  LINE5_KEY_INPUT_CACHE , _START 
       01151 0865     1     BC  DATAF , START_10 
       01152 0DBF     1     JBC  LINE5_KEY_INPUT_CACHE , _START 
       01153 0A65     1     BS  DATAF , START_10 
   102            C      M 	MOVB                DataF,LSW_11,LINE5_KEY_INPUT_CACHE,_LSW
       01154 0FFF     1     JBS  LINE5_KEY_INPUT_CACHE , _LSW 
       01155 08A5     1     BC  DATAF , LSW_11 
       01156 0DFF     1     JBC  LINE5_KEY_INPUT_CACHE , _LSW 
       01157 0AA5     1     BS  DATAF , LSW_11 
   103            C      M 	MOVB                DataF,RSW_12,LINE2_KEY_INPUT_CACHE,_RSW
       01158 0F3C     1     JBS  LINE2_KEY_INPUT_CACHE , _RSW 
       01159 08E5     1     BC  DATAF , RSW_12 
       0115A 0D3C     1     JBC  LINE2_KEY_INPUT_CACHE , _RSW 
       0115B 0AE5     1     BS  DATAF , RSW_12 
   104            C        	;MOVB                DataF,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE
   105            C      M 	MOVB                DataF,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO
       0115C 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       0115D 0965     1     BC  DATAF , MACRO_14 
       0115E 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       0115F 0B65     1     BS  DATAF , MACRO_14 
   106            C      M 	MOVB                DataF,TEST1_15,LINE2_KEY_INPUT_CACHE,_TEST1
       01160 0FBC     1     JBS  LINE2_KEY_INPUT_CACHE , _TEST1 
       01161 09A5     1     BC  DATAF , TEST1_15 
       01162 0DBC     1     JBC  LINE2_KEY_INPUT_CACHE , _TEST1 
       01163 0BA5     1     BS  DATAF , TEST1_15 
   107            C      M 	MOVB                DataF,TEST2_16,LINE5_KEY_INPUT_CACHE,_TEST2
       01164 0F7F     1     JBS  LINE5_KEY_INPUT_CACHE , _TEST2 
       01165 09E5     1     BC  DATAF , TEST2_16 
       01166 0D7F     1     JBC  LINE5_KEY_INPUT_CACHE , _TEST2 
       01167 0BE5     1     BS  DATAF , TEST2_16 
   108            C        
   109 01168 0000 C        	NOP
   110 01169 0012 C        	RET
   111 0116A 0000 C        	NOP
   112            C        
   113            C        ;===========================================================================
   114            C        ;Scan data form keyboard port
   115            C        ;===========================================================================
   116 0116B      C        KeyPort_Check:
   117            C        ;LINE1:	read direct data from PortB to LINE1_KEY_INPUT
   118 0116B 1E00 C        	BANK                0
   119 0116C 040B C        	MOV                 A,PORTB		;PortB = 00110110
   120 0116D 1E02 C        	BANK                2
   121 0116E 007B C        	MOV                 LINE1_KEY_INPUT_CACHE,A
   122 0116F 04FB C        	COM                 LINE1_KEY_INPUT_CACHE
   123 01170 1836 C        	MOV                 A,@0B00110110
   124 01171 02FB C        	AND                 LINE1_KEY_INPUT_CACHE,A
   125            C        
   126            C        ;LINE2:	;SET P77=1 P76=1 P75=1 P74=0
   127 01172 1E00 C        	BANK                0
   128 01173 18E8 C        	MOV                 A,@11101000B
   129 01174 0047 C        	MOV                 PORT7,A
   130 01175 122C C        	CALL                KEY_DELAY
   131 01176 0409 C        	MOV                 A,PORT9
   132 01177 1E02 C        	BANK                2
   133 01178 007C C        	MOV                 LINE2_KEY_INPUT_CACHE,A
   134 01179 04FC C        	COM                 LINE2_KEY_INPUT_CACHE
   135 0117A 18F0 C        	MOV                 A,@0XF0
   136 0117B 02FC C        	AND                 LINE2_KEY_INPUT_CACHE,A
   137            C        
   138            C        ;LINE3:	;SET P77=1 P76=1 P75=0 P74=1
   139 0117C 1E00 C        	BANK                0
   140 0117D 18D8 C        	MOV                 A,@11011000B
   141 0117E 0047 C        	MOV                 PORT7,A
   142 0117F 122C C        	CALL                KEY_DELAY
   143 01180 0409 C        	MOV                 A,PORT9
   144 01181 1E02 C        	BANK                2
   145 01182 007D C        	MOV                 LINE3_KEY_INPUT_CACHE,A
   146 01183 04FD C        	COM                 LINE3_KEY_INPUT_CACHE
   147 01184 18F0 C        	MOV                 A,@0XF0
   148 01185 02FD C        	AND                 LINE3_KEY_INPUT_CACHE,A
   149            C        
   150            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   151 01186 1E00 C        	BANK                0
   152 01187 18B8 C        	MOV                 A,@10111000B
   153 01188 0047 C        	MOV                 PORT7,A
   154 01189 122C C        	CALL                KEY_DELAY
   155 0118A 0409 C        	MOV                 A,PORT9
   156 0118B 1E02 C        	BANK                2
   157 0118C 007E C        	MOV                 LINE4_KEY_INPUT_CACHE,A
   158 0118D 04FE C        	COM                 LINE4_KEY_INPUT_CACHE
   159 0118E 18F0 C        	MOV                 A,@0XF0
   160 0118F 02FE C        	AND                 LINE4_KEY_INPUT_CACHE,A
   161            C        
   162            C        ;LINE5:	;SET P77=0 P76=1 P75=1 P74=1
   163 01190 1E00 C        	BANK                0
   164 01191 1878 C        	MOV                 A,@01111000B
   165 01192 0047 C        	MOV                 PORT7,A
   166 01193 122C C        	CALL                KEY_DELAY
   167 01194 0409 C        	MOV                 A,PORT9
   168 01195 1E02 C        	BANK                2
   169 01196 007F C        	MOV                 LINE5_KEY_INPUT_CACHE,A
   170 01197 04FF C        	COM                 LINE5_KEY_INPUT_CACHE
   171 01198 18F0 C        	MOV                 A,@0XF0
   172 01199 02FF C        	AND                 LINE5_KEY_INPUT_CACHE,A
   173 0119A 0000 C        	NOP
   174            C        
   175            C        ;----------------------------------------------------------------
   176            C      M 	MOVB                KeyTempFlag,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE  ;save MODE FLAG
       0119B 0F7D     1     JBS  LINE3_KEY_INPUT_CACHE , _MODE 
       0119C 0939     1     BC  KEYTEMPFLAG , MODE_13 
       0119D 0D7D     1     JBC  LINE3_KEY_INPUT_CACHE , _MODE 
       0119E 0B39     1     BS  KEYTEMPFLAG , MODE_13 
   177            C      M 	MOVB                KeyTempFlag,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO ;save MACRO FLAG
       0119F 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       011A0 0979     1     BC  KEYTEMPFLAG , MACRO_14 
       011A1 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       011A2 0B79     1     BS  KEYTEMPFLAG , MACRO_14 
   178 011A3 0000 C        	NOP
   179 011A4 0012 C        	RET
   180 011A5 0000 C        	NOP
   181            C        
   182            C        ;==============================================================================
   183            C        ;=======================Direction key board scan===============================
   184            C        ;==============================================================================
   185            C        ;------------------------deal with DataA/DataB---------------------------------
   186            C        ;DataA	left-right: left=0x00, right=0xff, no-left-right=0x7f
   187            C        ;DataB	up-down:    down=0x00, up=0xff,    no-left-right=0x7f
   188            C        ;DataG  000:00 001:45 010:90 011:135 100:180 101:225 110:270 111:315
   189            C        ;------------------------------------------------------------------------------
   190 011A6      C        Direction_KeyCheck:
   191 011A6 0000 C        	NOP
   192 011A7 0F25 C        	JBS                 DataF,MODE_13
   193 011A8 15AA C        	JMP                 DealWith_Direction_Digital
   194 011A9 15E9 C        	JMP                 DealWith_HatSwitch_Analog
   195            C        
   196 011AA      C        DealWith_Direction_Digital:
   197 011AA      C        LEFT_RIGHT_KEY:
   198 011AA 0D3B C        	JBC                 LINE1_KEY_INPUT_CACHE,_RIGHT   ;judge right
   199 011AB 15AF C        	JMP                 JudgeRight
   200 011AC 0C7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_LEFT    ;judeg left
   201 011AD 15BA C        	JMP                 JudgeLeft
   202 011AE 15C4 C        	JMP                 Left_Right_Finsh
   203 011AF      C          JudgeRight:
   204 011AF 1800 C        	MOV                 A,@0X00
   205 011B0 0320 C        	XOR                 A,DataA
   206 011B1 0E83 C        	JBS                 STATUS,Z
   207 011B2 15B4 C        	JMP                 JudgeRight_1
   208 011B3 15B6 C        	JMP                 JudgeRight_2
   209 011B4      C          JudgeRight_1:
   210 011B4 18FF C        	MOV                 A,@0XFF
   211 011B5 15B8 C        	JMP                 JudgeRight_End
   212 011B6      C          JudgeRight_2:
   213 011B6 187F C        	MOV                 A,@0X7F
   214 011B7 15B8 C        	JMP                 JudgeRight_End
   215 011B8      C          JudgeRight_End:
   216 011B8 0060 C        	MOV                 DataA,A
   217 011B9 15C4 C        	JMP                 Left_Right_Finsh
   218            C        
   219 011BA      C          JudgeLeft:
   220 011BA 18FF C        	MOV                 A,@0XFF
   221 011BB 0320 C        	XOR                 A,DataA
   222 011BC 0E83 C        	JBS                 STATUS,Z
   223 011BD 15BF C        	JMP                 JudgeLeft_1  ;Z=0,sameness
   224 011BE 15C1 C        	JMP                 JudgeLeft_2  ;Z=1,reverse
   225 011BF      C          JudgeLeft_1:
   226 011BF 1800 C        	MOV                 A,@0X00
   227 011C0 15C3 C        	JMP                 JudgeLeft_End
   228 011C1      C          JudgeLeft_2:
   229 011C1 187F C        	MOV                 A,@0X7F
   230 011C2 15C3 C        	JMP                 JudgeLeft_End
   231 011C3      C          JudgeLeft_End:
   232 011C3 0060 C        	MOV                 DataA,A
   233 011C4      C          Left_Right_Finsh:
   234 011C4 0000 C        	NOP
   235            C        ;--------------------------------------------------------------
   236 011C5      C        UP_DOWN_KEY:
   237 011C5 0D7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_UP     ;judge up(0X00)
   238 011C6 15D5 C        	JMP                 JudgeDown
   239 011C7 0CBB C        	JBC                 LINE1_KEY_INPUT_CACHE,_DOWN   ;judeg down(0XFF)
   240 011C8 15CA C        	JMP                 JudgeUp
   241 011C9 15E0 C        	JMP                 UP_DOWN_Finsh
   242 011CA      C          JudgeUp:
   243 011CA 1800 C        	MOV                 A,@0X00
   244 011CB 0321 C        	XOR                 A,DataB
   245 011CC 0E83 C        	JBS                 STATUS,Z
   246 011CD 15CF C        	JMP                 JudgeUp_1
   247 011CE 15D1 C        	JMP                 JudgeUp_2
   248 011CF      C          JudgeUp_1:
   249 011CF 18FF C        	MOV                 A,@0XFF
   250 011D0 15D3 C        	JMP                 JudgeUp_End
   251 011D1      C          JudgeUp_2:
   252 011D1 187F C        	MOV                 A,@0X7F
   253 011D2 15D3 C        	JMP                 JudgeUp_End
   254 011D3      C          JudgeUp_End:
   255 011D3 0061 C        	MOV                 DataB,A
   256 011D4 15E0 C        	JMP                 UP_DOWN_Finsh
   257            C        
   258 011D5      C          JudgeDown:
   259 011D5 18FF C        	MOV                 A,@0XFF
   260 011D6 0321 C        	XOR                 A,DataB
   261 011D7 0E83 C        	JBS                 STATUS,Z
   262 011D8 15DA C        	JMP                 JudgeDown_1
   263 011D9 15DC C        	JMP                 JudgeDown_2
   264 011DA      C          JudgeDown_1:
   265 011DA 1800 C        	MOV                 A,@0X00
   266 011DB 15DE C        	JMP                 JudgeDown_End
   267 011DC      C          JudgeDown_2:
   268 011DC 187F C        	MOV                 A,@0X7F
   269 011DD 15DE C        	JMP                 JudgeDown_End
   270 011DE      C          JudgeDown_End:
   271 011DE 0061 C        	MOV                 DataB,A
   272 011DF 15E0 C        	JMP                 UP_DOWN_Finsh
   273 011E0      C          UP_DOWN_Finsh:
   274 011E0 0000 C        	NOP
   275 011E1 187F C        	MOV                 A,@0X7F
   276 011E2 0062 C        	MOV                 DataC,A
   277 011E3 0063 C        	MOV                 DataD,A
   278 011E4 180F C          	MOV                 A,@0X0F
   279 011E5 0066 C          	MOV                 DataG,A
   280 011E6 0000 C        	NOP
   281 011E7 0012 C        	RET
   282 011E8 0000 C        	NOP
   283            C        
   284            C        ;----------------------------------------------------
   285 011E9      C        DealWith_HatSwitch_Analog:
   286 011E9 00E4 C        	CLR                 DataE
   287 011EA 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   288 011EB 1B00 C        	XOR                 A,@0B00000000
   289 011EC 0E83 C        	JBS                 STATUS,Z
   290 011ED 15F1 C        	JMP                 DATAG_0
   291            C      M 	MOV                 DataG,@0X0F          ;none
       011EE 180F     1     MOV A,@( 15 )
       011EF 0066     1     MOV  DATAG ,A
   292 011F0 1629 C        	JMP                 HAT_SWITCH_END
   293 011F1      C          DataG_0:
   294 011F1 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   295 011F2 1B20 C        	XOR                 A,@0B00100000
   296 011F3 0E83 C        	JBS                 STATUS,Z
   297 011F4 15F8 C        	JMP                 DataG_45
   298            C      M 	MOV                 DataG,@0X00          ;0
       011F5 1800     1     MOV A,@( 0 )
       011F6 0066     1     MOV  DATAG ,A
   299 011F7 1629 C        	JMP                 HAT_SWITCH_END
   300 011F8      C          DataG_45:
   301 011F8 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   302 011F9 1B30 C        	XOR                 A,@0B00110000
   303 011FA 0E83 C        	JBS                 STATUS,Z
   304 011FB 15FF C        	JMP                 DataG_90
   305            C      M 	MOV                 DataG,@0X01          ;45
       011FC 1801     1     MOV A,@( 1 )
       011FD 0066     1     MOV  DATAG ,A
   306 011FE 1629 C        	JMP                 HAT_SWITCH_END
   307 011FF      C          DataG_90:
   308 011FF 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   309 01200 1B10 C        	XOR                 A,@0B00010000
   310 01201 0E83 C        	JBS                 STATUS,Z
   311 01202 1606 C        	JMP                 DataG_135
   312            C      M 	MOV                 DataG,@0X02          ;90
       01203 1802     1     MOV A,@( 2 )
       01204 0066     1     MOV  DATAG ,A
   313 01205 1629 C        	JMP                 HAT_SWITCH_END
   314 01206      C          DataG_135:
   315 01206 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   316 01207 1B14 C        	XOR                 A,@0B00010100
   317 01208 0E83 C        	JBS                 STATUS,Z
   318 01209 160D C        	JMP                 DataG_180
   319            C      M 	MOV                 DataG,@0X03          ;135
       0120A 1803     1     MOV A,@( 3 )
       0120B 0066     1     MOV  DATAG ,A
   320 0120C 1629 C        	JMP                 HAT_SWITCH_END
   321 0120D      C          DataG_180:
   322 0120D 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   323 0120E 1B04 C        	XOR                 A,@0B00000100
   324 0120F 0E83 C        	JBS                 STATUS,Z
   325 01210 1614 C        	JMP                 DataG_225
   326            C      M 	MOV                 DataG,@0X04          ;180
       01211 1804     1     MOV A,@( 4 )
       01212 0066     1     MOV  DATAG ,A
   327 01213 1629 C        	JMP                 HAT_SWITCH_END
   328 01214      C          DataG_225:
   329 01214 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   330 01215 1B06 C        	XOR                 A,@0B00000110
   331 01216 0E83 C        	JBS                 STATUS,Z
   332 01217 161B C        	JMP                 DataG_270
   333            C      M 	MOV                 DataG,@0X05          ;225
       01218 1805     1     MOV A,@( 5 )
       01219 0066     1     MOV  DATAG ,A
   334 0121A 1629 C        	JMP                 HAT_SWITCH_END
   335 0121B      C          DataG_270:
   336 0121B 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   337 0121C 1B02 C        	XOR                 A,@0B00000010
   338 0121D 0E83 C        	JBS                 STATUS,Z
   339 0121E 1622 C        	JMP                 DataG_315
   340            C      M 	MOV                 DataG,@0X06          ;270
       0121F 1806     1     MOV A,@( 6 )
       01220 0066     1     MOV  DATAG ,A
   341 01221 1629 C        	JMP                 HAT_SWITCH_END
   342 01222      C          DataG_315:
   343 01222 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   344 01223 1B22 C        	XOR                 A,@0B00100010
   345 01224 0E83 C        	JBS                 STATUS,Z
   346 01225 1629 C        	JMP                 HAT_SWITCH_END
   347            C      M 	MOV                 DataG,@0X07          ;315
       01226 1807     1     MOV A,@( 7 )
       01227 0066     1     MOV  DATAG ,A
   348 01228 1629 C        	JMP                 HAT_SWITCH_END
   349            C        
   350 01229      C          HAT_SWITCH_END:
   351 01229 0000 C        	NOP
   352 0122A 0012 C        	RET
   353 0122B 0000 C        	NOP
   354            C        
   355            C        ;===================================================================
   356            C        ; Delay function
   357            C        ;===================================================================
   358 0122C      C        KEY_DELAY:
   359 0122C 0000 C        	NOP
   360 0122D 0000 C        	NOP
   361 0122E 0000 C        	NOP
   362 0122F 0000 C        	NOP
   363 01230 0000 C        	NOP
   364 01231 0000 C        	NOP
   365 01232 0000 C        	NOP
   366 01233 0012 C        	RET
   367 01234 0000 C        	NOP
   368            C        
   369            C        
   370            C        ;============================================================================
   371            C        ;file name:     ADC 3D Rocker KeyScan
   372            C        ;INPUT PORT:
   373            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   374            C        ;TIME:          1050uS
   375            C        ;Descrition:    Use for check AD rocker data
   376            C        ;============================================================================
   377 01235      C        ADC_Rocker_KeyScan:
   378 01235 0000 C        	NOP
   379 01236 12E1 C        	CALL                 SUB_RINIT
   380 01237 12CF C        	CALL                 SUB_ADJ
   381 01238 1E03 C        	BANK                 3
   382 01239 1880 C        	MOV                  A,@0X80             ;SELECT ADE0/P93.Rx
   383 0123A 0249 C        	OR                   ADCR, A
   384 0123B 12EB C        	CALL                 SUB_ADC
   385 0123C 040C C        	MOV                  A, ADDH
   386 0123D 1E02 C        	BANK                 2
   387 0123E 0072 C        	MOV                  KEY_RIGHT_X,A
   388            C        
   389 0123F 12E1 C        	CALL                 SUB_RINIT
   390 01240 12CF C        	CALL                 SUB_ADJ
   391 01241 1E03 C        	BANK                 3
   392 01242 1881 C        	MOV                  A,@0X81             ;SELECT ADE1/P92.Ry
   393 01243 0249 C        	OR                   ADCR, A
   394 01244 12EB C        	CALL                 SUB_ADC
   395 01245 040C C        	MOV                  A, ADDH
   396 01246 1E02 C        	BANK                 2
   397 01247 0073 C        	MOV                  KEY_RIGHT_Y,A
   398 01248 04F3 C        	COM                  KEY_RIGHT_Y
   399            C        
   400 01249 12E1 C        	CALL                 SUB_RINIT
   401 0124A 12CF C        	CALL                 SUB_ADJ
   402 0124B 1E03 C        	BANK                 3
   403 0124C 1882 C        	MOV                  A,@0X82             ;SELECT ADE2/P91.Lx
   404 0124D 0249 C        	OR                   ADCR,A
   405 0124E 12EB C        	CALL                 SUB_ADC
   406 0124F 040C C        	MOV                  A,ADDH
   407 01250 1E02 C        	BANK                 2
   408 01251 0070 C        	MOV                  KEY_LEFT_X,A
   409            C        
   410 01252 12E1 C        	CALL                 SUB_RINIT
   411 01253 12CF C        	CALL                 SUB_ADJ
   412 01254 1E03 C        	BANK                 3
   413 01255 1883 C        	MOV                  A,@0X83             ;SELECT ADE3/P90.Ly
   414 01256 0249 C        	OR                   ADCR, A
   415 01257 12EB C        	CALL                 SUB_ADC
   416 01258 040C C        	MOV                  A,ADDH
   417 01259 1E02 C        	BANK                 2
   418 0125A 0071 C        	MOV                  KEY_LEFT_Y,A
   419 0125B 04F1 C        	COM                  KEY_LEFT_Y
   420 0125C 0000 C        	NOP
   421 0125D 0012 C        	RET
   422 0125E 0000 C        	NOP
   423            C        
   424 0125F      C        Rocker_KeyScan:
   425            C        ;======================== jugde rocker signal select ==========================
   426 0125F 0F25 C        	JBS                 DataF,MODE_13       ;select digital or analog
   427 01260 1662 C        	JMP                 DealWith_ADC_Digital
   428 01261 1678 C        	JMP                 DealWith_ADC_Analog
   429            C        
   430 01262      C          DealWith_ADC_Digital:
   431 01262 00E0 C        	CLR                 DataA
   432 01263 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   433 01264 0051 C        	MOV                 TEMP1,A
   434 01265 1284 C        	CALL                AreaJudge_direction
   435 01266 0060 C        	MOV                 DataA,A
   436            C        
   437 01267 00E1 C        	CLR                 DataB
   438 01268 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   439 01269 0051 C        	MOV                 TEMP1,A
   440 0126A 1284 C        	CALL                AreaJudge_direction
   441 0126B 0061 C        	MOV                 DataB,A
   442            C        
   443 0126C 187F C        	MOV                 A,@0X7F
   444 0126D 0062 C        	MOV                 DataC,A
   445 0126E 0063 C        	MOV                 DataD,A
   446            C        
   447 0126F 00E4 C        	CLR                 DataE
   448 01270 0432 C        	MOV                 A,KEY_RIGHT_X		;A,B,C,D,
   449 01271 0052 C        	MOV                 TEMP2,A
   450 01272 0433 C        	MOV                 A,KEY_RIGHT_Y
   451 01273 0053 C        	MOV                 TEMP3,A
   452 01274 1298 C        	CALL                AreaJudge_Button
   453 01275 0410 C        	MOV                 A,TEMP
   454 01276 0064 C        	MOV                 DataE,A
   455 01277 1681 C        	JMP                 RockerCheakFinish
   456            C        
   457 01278      C          DealWith_ADC_Analog:
   458 01278 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   459 01279 0060 C        	MOV                 DataA,A
   460 0127A 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   461 0127B 0061 C        	MOV                 DataB,A
   462 0127C 0432 C        	MOV                 A,KEY_RIGHT_X		;R-left_right
   463 0127D 0062 C        	MOV                 DataC,A
   464 0127E 0433 C        	MOV                 A,KEY_RIGHT_Y		;R-up_down
   465 0127F 0063 C        	MOV                 DataD,A
   466 01280 1681 C        	JMP                 RockerCheakFinish
   467            C        
   468 01281      C          RockerCheakFinish:
   469 01281 0000 C        	NOP
   470 01282 0012 C        	RET
   471 01283 0000 C        	NOP
   472            C        
   473            C        ;=============================jugde the direction=====================================
   474            C        ;Input:      TEMP1
   475            C        ;output:     A
   476            C        ;=====================================================================================
   477 01284      C        AreaJudge_direction:
   478 01284 1E02 C        	BANK                2
   479 01285 0411 C        	MOV                 A,TEMP1     ;Store
   480 01286 1DBF C        	SUB                 A,@0XBF
   481 01287 0E03 C        	JBS                 R3,0        ;R3,bit0(C)
   482 01288 168A C        	JMP                 CheakTop_Left
   483 01289 168C C        	JMP                 CheakMiddle_Left
   484 0128A      C          CheakTop_Left:
   485 0128A 18FF C        	MOV                 A,@0XFF   ;up
   486 0128B 1694 C        	JMP                 CheakAreaFinish_Left
   487 0128C      C          CheakMiddle_Left:
   488 0128C 0411 C        	MOV                 A,TEMP1
   489 0128D 1D40 C        	SUB                 A,@0X40
   490 0128E 0C03 C        	JBC                 R3,0
   491 0128F 1692 C        	JMP                 CheakBottom_Left
   492 01290 187F C        	MOV                 A,@0X7F
   493 01291 1694 C        	JMP                 CheakAreaFinish_Left
   494 01292      C          CheakBottom_Left:
   495 01292 1800 C        	MOV                 A,@0X00   ;down
   496 01293 1694 C        	JMP                 CheakAreaFinish_Left
   497 01294      C          CheakAreaFinish_Left:
   498 01294 0000 C        	NOP
   499 01295 0000 C        	NOP
   500 01296 0012 C        	RET
   501 01297 0000 C        	NOP
   502            C        
   503            C        ;============================jugde what button press============================
   504            C        ;input:     TEMP2,TEMP3
   505            C        ;output:    TEMP
   506            C        ;===============================================================================
   507 01298      C        AreaJudge_Button:
   508 01298 1E02 C        	BANK                2
   509 01299 0412 C        	MOV                 A,TEMP2    ;KEY_RIGHT_Y
   510 0129A 1DD0 C        	SUB                 A,@0XD0
   511 0129B 0E03 C        	JBS                 R3,C	     ;R3,bit0(C)
   512 0129C 169E C        	JMP                 CheakTop_Right_y
   513 0129D 16A0 C        	JMP                 CheakMiddle_Right_y
   514            C        
   515 0129E      C          CheakTop_Right_y:
   516 0129E 18FF C        	MOV                 A,@0XFF  ;up
   517 0129F 16A8 C        	JMP                 CheakAreaFinish_Right_y
   518 012A0      C          CheakMiddle_Right_y:
   519 012A0 0412 C        	MOV                 A,TEMP2
   520 012A1 1D25 C        	SUB                 A,@0X25
   521 012A2 0E03 C        	JBS                 R3,C
   522 012A3 16A6 C        	JMP                 CheakBottom_Right_y
   523 012A4 1800 C        	MOV                 A,@0X00  ;dwon
   524 012A5 16A8 C        	JMP                 CheakAreaFinish_Right_y
   525 012A6      C          CheakBottom_Right_y:
   526 012A6 187F C        	MOV                 A,@0X7F
   527 012A7 16A8 C        	JMP                 CheakAreaFinish_Right_y
   528 012A8      C          CheakAreaFinish_Right_y:
   529 012A8 0052 C        	MOV                 TEMP2,A
   530 012A9 0000 C        	NOP
   531            C        ;---------------------------------------------------
   532 012AA 1E02 C        	BANK                2
   533 012AB 0413 C        	MOV                 A,TEMP3    ;KEY_RIGHT_Y
   534 012AC 1DD0 C        	SUB                 A,@0XD0
   535 012AD 0E03 C        	JBS                 R3,C       ;R3,bit0(C)
   536 012AE 16B0 C        	JMP                 CheakTop_Right_x
   537 012AF 16B2 C        	JMP                 CheakMiddle_Right_x
   538 012B0      C          CheakTop_Right_x:
   539 012B0 18FF C        	MOV                 A,@0XFF   ;right
   540 012B1 16BA C        	JMP                 CheakAreaFinish_Right_x
   541 012B2      C          CheakMiddle_Right_x:
   542 012B2 0413 C        	MOV                 A,TEMP3
   543 012B3 1D25 C        	SUB                 A,@0X25
   544 012B4 0E03 C        	JBS                 R3,0
   545 012B5 16B8 C        	JMP                 CheakBottom_Right_x
   546 012B6 1800 C        	MOV                 A,@0X00   ;left
   547 012B7 16BA C        	JMP                 CheakAreaFinish_Right_x
   548 012B8      C          CheakBottom_Right_x:
   549 012B8 187F C        	MOV                 A,@0X7F
   550 012B9 16BA C        	JMP                 CheakAreaFinish_Right_x
   551 012BA      C          CheakAreaFinish_Right_x:
   552 012BA 0053 C        	MOV                 TEMP3,A
   553 012BB 0000 C        	NOP
   554            C        
   555            C        ;-----------------------------------------------------
   556 012BC 00D0 C        	CLR                 TEMP
   557 012BD 0412 C        	MOV                 A,TEMP2      ;left
   558 012BE 1B00 C        	XOR                 A,@0X00
   559 012BF 0C83 C        	JBC                 STATUS,Z
   560 012C0 0A10 C        	BS                  TEMP,A_1
   561            C        
   562 012C1 0412 C        	MOV                 A,TEMP2      ;right
   563 012C2 1BFF C        	XOR                 A,@0XFF
   564 012C3 0C83 C        	JBC                 STATUS,Z
   565 012C4 0A90 C        	BS                  TEMP,C_3
   566            C        
   567 012C5 0413 C        	MOV                 A,TEMP3      ;down
   568 012C6 1BFF C        	XOR                 A,@0XFF
   569 012C7 0C83 C        	JBC                 STATUS,Z
   570 012C8 0AD0 C        	BS                  TEMP,D_4
   571            C        
   572 012C9 0413 C        	MOV                 A,TEMP3      ;up
   573 012CA 1B00 C        	XOR                 A,@0X00
   574 012CB 0C83 C        	JBC                 STATUS,Z
   575 012CC 0A50 C        	BS                  TEMP,B_2
   576 012CD 0012 C        	RET
   577 012CE 0000 C        	NOP
   578            C        
   579            C        ;-----------------------------------------------------------------
   580 012CF      C        SUB_ADJ:
   581 012CF 1E03 C        	BANK                3
   582 012D0 0BCA C        	BS                  ADICH,CALI    ;ENABLE CALIBRATION
   583 012D1      C          ADCJUDGE_LOOP:
   584 012D1 0BC9 C        	BS                  ADCR,ADRUN
   585 012D2 0DC9 C        	JBC                 ADCR,ADRUN
   586 012D3 16D2 C        	JMP                 $-1
   587            C        
   588 012D4 040D C        	MOV                 A,ADDL
   589 012D5 1A0F C        	AND                 A,@0X0F
   590 012D6 0E83 C        	JBS                 R3,Z
   591 012D7 16DE C        	JMP                 ADCJUDGE_DONE
   592 012D8 040C C        	MOV                 A,ADDH
   593 012D9 0E83 C        	JBS                 R3,Z
   594 012DA 16DE C        	JMP                 ADCJUDGE_DONE
   595 012DB 1810 C        	MOV                 A,@0X10
   596 012DC 03CD C        	ADD                 ADDL,A
   597 012DD 16D1 C        	JMP                 ADCJUDGE_LOOP
   598 012DE      C          ADCJUDGE_DONE:
   599 012DE 09CA C        	BC                  ADICH,CALI
   600 012DF 1E00 C        	BANK                0
   601 012E0 0012 C        	RET
   602            C        
   603 012E1      C          SUB_RINIT:
   604 012E1 1E05 C         	BANK                5
   605 012E2 1800 C         	MOV                 A,@00000000B
   606 012E3 0049 C         	MOV                 P9PHCR,A      ;SET PULL LOW
   607 012E4 1E03 C        	BANK                3
   608 012E5 180F C        	MOV                 A,@0X0F
   609 012E6 004B C        	MOV                 ADICL,A      ;SELECT ADE0~ ADE3 AS ANALOG INPUT
   610 012E7 00CA C        	CLR                 ADICH         ;VREFS==VDD
   611 012E8 1860 C        	MOV                 A,@0X60
   612 012E9 0049 C        	MOV                 ADCR,A       ;SELECT  AD0,SELECT ADCKR1/ADCKR0=1:0,ADP=1
   613 012EA 0012 C        	RET
   614 012EB      C          SUB_ADC:
   615 012EB 1E03 C        	BANK                3
   616 012EC 0BC9 C        	BS                  ADCR,ADRUN
   617 012ED 0DC9 C        	JBC                 ADCR,ADRUN
   618 012EE 16ED C        	JMP                 $-1
   619 012EF 0000 C        	NOP
   620 012F0 0012 C        	RET
   621 012F1 0000 C        	NOP
   622            C        
   623            C        
   624            C        
   625            C        ;============================================================================
   626            C        ;file name:     IO 3D Rocker KeyScan
   627            C        ;INPUT PORT:
   628            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   629            C        ;TIME:
   630            C        ;Descrition:    Use for check AD rocker data
   631            C        ;============================================================================
   632 012F2      C        IO_Rocker_KeyScan:
   633 012F2 0000 C        	NOP
   634 012F3 0B49 C        	BS                  T2CR,T2EN          ; START
   635            C        	;CALL                Discharge
   636            C        	;CALL                SampingRefTiming
   637 012F4 1304 C        	CALL                Discharge
   638 012F5 1324 C        	CALL                SampingLyTiming    ; Ly
   639 012F6 0000 C        	NOP
   640 012F7 1304 C        	CALL                Discharge
   641 012F8 1338 C        	CALL                SampingLxTiming    ; Lx
   642 012F9 0000 C        	NOP
   643 012FA 1304 C        	CALL                Discharge
   644 012FB 134C C        	CALL                SampingRyTiming    ; Ry
   645 012FC 0000 C        	NOP
   646 012FD 1304 C        	CALL                Discharge
   647 012FE 1360 C        	CALL                SampingRxTiming    ; Rx
   648 012FF 0949 C        	BC                  T2CR,T2EN          ; Disable
   649 01300 0000 C        	NOP
   650 01301 0000 C        	NOP
   651 01302 0012 C        	RET
   652 01303 0000 C        	NOP
   653            C        
   654            C        ;---------------------------------------------------------------
   655 01304      C        Discharge:
   656 01304 1E04 C        	BANK                4
   657 01305 18FF C        	MOV                 A,@0B11111111
   658 01306 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   659            C        	;BS                  P8IOCR,Reference    ; Input  P87
   660            C        	;BC                  P8IOCR,Leakresis    ; Output P86
   661 01307 0408 C        	MOV                 A,P8IOCR
   662 01308 1A3F C        	AND                 A,@0B00111111
   663 01309 1980 C        	OR                  A,@0B10000000
   664 0130A 0048 C        	MOV                 P8IOCR,A            ;Set P87->Input,P86->Output
   665 0130B 1E00 C        	BANK                0
   666            C        	;BS                  PORT9,LeftYAxis
   667            C        	;BS                  PORT9,LeftXAxis
   668            C        	;BS                  PORT9,RightYAxis
   669            C        	;BS                  PORT9,RightXAxis
   670            C        	;BS                  PORT8,Reference    ; Set P87 Pull High
   671 0130C 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   672            C        
   673 0130D 1E02 C        	BANK                2
   674 0130E 00ED C        	CLR                 IOcheckTimeCNT
   675 0130F 042D C        	MOV                 A,IOcheckTimeCNT
   676 01310 1D32 C        	SUB                 A,@LeakresisTimeCNT
   677 01311 0C03 C        	JBC                 STATUS,C
   678 01312 170F C        	JMP                 $-3
   679 01313 0012 C        	RET
   680            C        
   681            C        ;---------------------------------------------------------------
   682 01314      C        SampingRefTiming:
   683 01314 1E04 C        	BANK                4
   684            C        	;MOV                 A,@0B11111111
   685            C        	;MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   686            C        	;BS                  P8IOCR,Leakresis    ; Input  P86
   687            C        	;BC                  P8IOCR,Reference    ; Output P87
   688 01315 0408 C        	MOV                 A,P8IOCR
   689 01316 1A3F C        	AND                 A,@0B00111111
   690 01317 1940 C        	OR                  A,@0B01000000
   691 01318 0048 C        	MOV                 P8IOCR,A             ;Set P87->Output,P86->Input
   692 01319 1E00 C        	BANK                0
   693            C        	;BS                  PORT9,LeftYAxis
   694            C        	;BS                  PORT9,LeftXAxis
   695            C        	;BS                  PORT9,RightYAxis
   696            C        	;BS                  PORT9,RightXAxis
   697 0131A 0BC8 C        	BS                  PORT8,Reference    ; Set P87 High
   698            C        	;BS                  PORT8,Leakresis    ; Set P86
   699            C        
   700 0131B 1E02 C        	BANK                2
   701 0131C 00ED C        	CLR                 IOcheckTimeCNT
   702 0131D 1E00 C        	BANK                0
   703 0131E 0F88 C        	JBS                 PORT8,Leakresis
   704 0131F 171E C        	JMP                 $-1
   705 01320 1E02 C        	BANK                2
   706 01321 042D C        	MOV                 A,IOcheckTimeCNT
   707 01322 0050 C        	MOV                 TEMP,A
   708 01323 0012 C        	RET
   709            C        
   710            C        ;---------------------------------------------------------------
   711 01324      C        SampingLyTiming:
   712 01324 1E04 C        	BANK                4
   713 01325 18FE C        	MOV                 A,@0B11111110
   714 01326 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   715            C        	;BS                  P8IOCR,Leakresis    ; input
   716            C        	;BS                  P8IOCR,Reference    ; output
   717 01327 0408 C        	MOV                 A,P8IOCR
   718 01328 1A3F C        	AND                 A,@0B00111111
   719 01329 19C0 C        	OR                  A,@0B11000000
   720 0132A 0048 C        	MOV                 P8IOCR,A
   721 0132B 1E00 C        	BANK                0
   722 0132C 0A09 C        	BS                  PORT9,LeftYAxis    ; Set P90
   723            C        	;BS                  PORT9,LeftXAxis
   724            C        	;BS                  PORT9,RightYAxis
   725            C        	;BS                  PORT9,RightXAxis
   726            C        	;BC                  PORT8,Reference    ; Set P87
   727            C        	;BS                  PORT8,Leakresis    ; Set P86
   728            C        
   729 0132D 1E02 C        	BANK                2
   730 0132E 00ED C        	CLR                 IOcheckTimeCNT
   731 0132F 1E00 C        	BANK                0
   732 01330 0F88 C        	JBS                 PORT8,Leakresis
   733 01331 1730 C        	JMP                 $-1
   734 01332 1E02 C        	BANK                2
   735 01333 042D C        	MOV                 A,IOcheckTimeCNT
   736 01334 0071 C        	MOV                 KEY_LEFT_Y,A        ; Left y Axis
   737 01335 0000 C        	NOP
   738 01336 0000 C        	NOP
   739 01337 0012 C        	RET
   740            C        
   741            C        ;---------------------------------------------------------------
   742 01338      C        SampingLxTiming:
   743 01338 1E04 C        	BANK                4
   744 01339 18FD C        	MOV                 A,@0B11111101
   745 0133A 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   746            C        	;BS                  P8IOCR,Leakresis    ; input
   747            C        	;BS                  P8IOCR,Reference    ; output
   748 0133B 0408 C        	MOV                 A,P8IOCR
   749 0133C 1A3F C        	AND                 A,@0B00111111
   750 0133D 19C0 C        	OR                  A,@0B11000000
   751 0133E 0048 C        	MOV                 P8IOCR,A
   752 0133F 1E00 C        	BANK                0
   753            C        	;BS                  PORT9,LeftYAxis
   754 01340 0A49 C        	BS                  PORT9,LeftXAxis    ; Set P91
   755            C        	;BS                  PORT9,RightYAxis
   756            C        	;BS                  PORT9,RightXAxis
   757            C        	;BC                  PORT8,Reference    ; Set P87
   758            C        	;BS                  PORT8,Leakresis    ; Set P86
   759            C        
   760 01341 1E02 C        	BANK                2
   761 01342 00ED C        	CLR                 IOcheckTimeCNT
   762 01343 1E00 C        	BANK                0
   763 01344 0F88 C        	JBS                 PORT8,Leakresis
   764 01345 1744 C        	JMP                 $-1
   765 01346 1E02 C        	BANK                2
   766 01347 042D C        	MOV                 A,IOcheckTimeCNT
   767 01348 0070 C        	MOV                 KEY_LEFT_X,A        ; Left x Axis
   768 01349 0000 C        	NOP
   769 0134A 0000 C        	NOP
   770 0134B 0012 C        	RET
   771            C        
   772            C        ;---------------------------------------------------------------
   773 0134C      C        SampingRyTiming:
   774 0134C 1E04 C        	BANK                4
   775 0134D 18FB C        	MOV                 A,@0B11111011
   776 0134E 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   777            C        	;BS                  P8IOCR,Leakresis    ; input
   778            C        	;BS                  P8IOCR,Reference    ; output
   779 0134F 0408 C        	MOV                 A,P8IOCR
   780 01350 1A3F C        	AND                 A,@0B00111111
   781 01351 19C0 C        	OR                  A,@0B11000000
   782 01352 0048 C        	MOV                 P8IOCR,A
   783 01353 1E00 C        	BANK                0
   784            C        	;BS                  PORT9,LeftYAxis
   785            C        	;BS                  PORT9,LeftXAxis
   786 01354 0A89 C        	BS                  PORT9,RightYAxis
   787            C        	;BS                  PORT9,RightXAxis
   788            C        	;BC                  PORT8,Reference    ; Set P87
   789            C        	;BS                  PORT8,Leakresis    ; Set P86
   790            C        
   791 01355 1E02 C        	BANK                2
   792 01356 00ED C        	CLR                 IOcheckTimeCNT
   793 01357 1E00 C        	BANK                0
   794 01358 0F88 C        	JBS                 PORT8,Leakresis
   795 01359 1758 C        	JMP                 $-1
   796 0135A 1E02 C        	BANK                2
   797 0135B 042D C        	MOV                 A,IOcheckTimeCNT
   798 0135C 0073 C        	MOV                 KEY_RIGHT_Y,A        ; right y Axis
   799 0135D 0000 C        	NOP
   800 0135E 0000 C        	NOP
   801 0135F 0012 C        	RET
   802            C        
   803            C        ;---------------------------------------------------------------
   804 01360      C        SampingRxTiming:
   805 01360 1E04 C        	BANK                4
   806 01361 18F7 C        	MOV                 A,@0B11110111
   807 01362 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   808            C        	;BS                  P8IOCR,Leakresis    ; input
   809            C        	;BS                  P8IOCR,Reference    ; output
   810 01363 0408 C        	MOV                 A,P8IOCR
   811 01364 1A3F C        	AND                 A,@0B00111111
   812 01365 19C0 C        	OR                  A,@0B11000000
   813 01366 0048 C        	MOV                 P8IOCR,A
   814 01367 1E00 C        	BANK                0
   815            C        	;BS                  PORT9,LeftYAxis
   816            C        	;BS                  PORT9,LeftXAxis
   817            C        	;BS                  PORT9,RightYAxis
   818 01368 0AC9 C        	BS                  PORT9,RightXAxis
   819            C        	;BC                  PORT8,Reference    ; Set P87
   820            C        	;BS                  PORT8,Leakresis    ; Set P86
   821            C        
   822 01369 1E02 C        	BANK                2
   823 0136A 00ED C        	CLR                 IOcheckTimeCNT
   824 0136B 1E00 C        	BANK                0
   825 0136C 0F88 C        	JBS                 PORT8,Leakresis
   826 0136D 176C C        	JMP                 $-1
   827 0136E 1E02 C        	BANK                2
   828 0136F 042D C        	MOV                 A,IOcheckTimeCNT
   829 01370 0072 C        	MOV                 KEY_RIGHT_X,A       ; right x Axis
   830 01371 0000 C        	NOP
   831 01372 0000 C        	NOP
   832 01373 0012 C        	RET
   833            C        
   834            C        
   835            C        ;**********************************************************************************
   836            C        ;*********************************************************************************
   837            C        ; Connect Key Scan
   838            C        ; Input:
   839            C        ; output: KEY_NUM
   840            C        ; KeyScanStatusFlag
   841            C        ; change: temp,KeystokeFlag_Befor(INITIAL)
   842            C        ;*********************************************************************************
   843 01374      C        ConnectKey_Scan:
   844 01374 1E02 C        	BANK                2
   845 01375 042E C        	MOV                 A,KeySystemTimeCNT
   846 01376 1D01 C        	SUB                 A,@1                   ; Control key scan clock
   847 01377 0C03 C        	JBC                 STATUS,C
   848 01378 177B C        	JMP                 Keyscan_Start_Up
   849 01379 0B9E C        	BS                  System16msFlag/16,System16msFlag%16
   850 0137A 00EE C        	CLR                 KeySystemTimeCNT
   851            C        	;BANK                0
   852            C        	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   853            C        	;XOR                 PORT8,A
   854            C        
   855 0137B      C          Keyscan_Start_Up:
   856 0137B 0F9E C        	JBS                 System16msFlag/16,System16msFlag%16
   857 0137C 0012 C        	RET
   858 0137D 0000 C        	NOP
   859            C        	;BANK                0
   860            C        	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   861            C        	;XOR                 PORT8,A
   862            C        
   863            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   864 0137E 1E00 C        	BANK                0
   865 0137F 18B8 C        	MOV                 A,@10111000B
   866 01380 0047 C        	MOV                 PORT7,A
   867 01381 122C C        	CALL                KEY_DELAY
   868 01382 0409 C        	MOV                 A,PORT9                ;(Slect,Start,MODE,MACRO(Connect),x,x,x,x)
   869 01383 1E02 C        	BANK                2
   870 01384 1A10 C        	AND                 A,@00010000B           ;
   871 01385 0050 C        	MOV                 TEMP,A
   872 01386 1810 C        	MOV                 A,@00010000B           ; Bit4
   873 01387 02F6 C        	AND                 KeystokeFlag_Befor,A
   874            C        
   875            C        ;---------------------------------------------------------------------
   876 01388      C          Falling_Edge_Judge:
   877 01388 0410 C        	MOV                 A,TEMP
   878 01389 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
   879 0138A 0C83 C        	JBC                 STATUS,Z
   880 0138B 1796 C        	JMP                 Rising_Edge_Judge         ; no edge occur
   881 0138C 0410 C        	MOV                 A,TEMP                    ; Falling edge will change
   882 0138D 1B00 C        	XOR                 A,@00000000B
   883 0138E 0E83 C        	JBS                 STATUS,Z
   884 0138F 1796 C        	JMP                 Rising_Edge_Judge         ; no falling edge
   885 01390 0E5E C        	JBS                 KeyScanStatusFlag/16,KeyScanStatusFlag%16        ; scan the first falling edge
   886 01391 0A38 C        	BS                  KEY_NUM,0                            ; Will into key scan, Set guide bit
   887 01392 00F7 C        	CLR                 KeystokeTimeCNT                      ; press times ,recalculate
   888 01393 089E C        	BC                  KeyStatusFlag/16,KeyStatusFlag%16    ; key status, press(0) or release(1)
   889 01394 0A5E C        	BS                  KeyScanStatusFlag/16,KeyScanStatusFlag%16	     ; into scan key status
   890 01395 17A2 C        	JMP                 Edge_Judge_End
   891            C        
   892            C        ;--------------------------------------------------------------------
   893 01396      C          Rising_Edge_Judge:
   894 01396 0410 C        	MOV                 A,TEMP
   895 01397 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
   896 01398 0C83 C        	JBC                 STATUS,Z
   897 01399 17A2 C        	JMP                 Edge_Judge_End
   898 0139A 0410 C        	MOV                 A,TEMP                    ; rising edge will change
   899 0139B 1B10 C        	XOR                 A,@00010000B
   900 0139C 0E83 C        	JBS                 STATUS,Z
   901 0139D 17A2 C        	JMP                 Edge_Judge_End
   902 0139E 0000 C        	NOP
   903 0139F 13B4 C        	CALL                KeyStatus_Low_Scan        ; rising edge ,check low level time
   904 013A0 00F7 C        	CLR                 KeystokeTimeCNT           ; press times ,recalculate
   905 013A1 0A9E C        	BS                  KeyStatusFlag/16,KeyStatusFlag%16
   906 013A2      C          Edge_Judge_End:
   907 013A2 0410 C        	MOV                 A,TEMP                    ; save currently press key status used for next judge
   908 013A3 0076 C        	MOV                 KeystokeFlag_Befor,A
   909            C        
   910            C        ;------------------------------------------------------------------------------
   911 013A4      C          KeystokeScan_End:                                                ; a cycle scan end
   912 013A4 0E5E C        	JBS                 KeyScanStatusFlag/16,KeyScanStatusFlag%16
   913 013A5 00F8 C        	CLR                 KEY_NUM
   914 013A6 0DF8 C        	JBC                 KEY_NUM,7                                  ; Count overflow
   915 013A7 00F8 C        	CLR                 KEY_NUM
   916 013A8 099E C        	BC                  System16msFlag/16,System16msFlag%16
   917            C        
   918 013A9 0437 C        	MOV                 A,KeystokeTimeCNT
   919 013AA 1DB4 C        	SUB                 A,@KeyPressTime                            ; KeyPressTime*16ms=3600ms(ComuTime=56ms)
   920 013AB 0C03 C        	JBC                 STATUS,C
   921 013AC 0577 C        	INC                 KeystokeTimeCNT                            ; press times ,recalculate
   922            C        
   923 013AD 0437 C        	MOV                 A,KeystokeTimeCNT
   924 013AE 1D3C C        	SUB                 A,@KeyScanTime                             ; 60*16ms=960ms(ComuTime=56ms)
   925 013AF 0C03 C        	JBC                 STATUS,C                                   ; Scan finish edge
   926 013B0 0012 C        	RET
   927 013B1 085E C        	BC                  KeyScanStatusFlag/16,KeyScanStatusFlag%16  ; more than 60*16ms=960ms ,EXIT scan status
   928 013B2 0ADE C        	BS                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
   929 013B3 0012 C        	RET
   930            C        
   931            C        ;=========================================================================
   932 013B4      C        KeyStatus_Low_Scan:     ; rising edge ,check low level time
   933 013B4 0437 C        	MOV                 A,KeystokeTimeCNT
   934 013B5 1D1E C        	SUB                 A,@CrossingTime                      ;30*16ms=400ms(ComuTime=56ms)
   935 013B6 0C03 C        	JBC                 STATUS,C                   ;
   936 013B7 17B9 C        	JMP                 KeyScan_Short_Press	       ;less than 400ms
   937 013B8 17BC C        	JMP                 KeyScan_Lasting_Press      ;more than 400ms
   938 013B9      C          KeyScan_Short_Press:
   939 013B9 0803 C        	BC                  STATUS,C
   940 013BA 06F8 C        	RLC                 KEY_NUM
   941 013BB 0012 C        	RET
   942 013BC      C          KeyScan_Lasting_Press:
   943 013BC 0A03 C        	BS                  STATUS,C
   944 013BD 06F8 C        	RLC                 KEY_NUM
   945 013BE 0012 C        	RET
   946            C        
   947            C        
    19            C        endif
    20            C        
    21            C        ;---------------------------------------------------------
    22            C        
    23            C        
    24            C        
    25            C        	ORG                 0X400    ; PAGE 1
    26            C        	MESSAGE "define 'P520SkipFreqFun.ASM' ROM address"
***     USER MESSAGE: DEFINE 'P520SKIPFREQFUN.ASM' ROM ADDRESS
    27            C        ;***************************************************************
    28            C        ; Search mode
    29            C        ;***************************************************************
    30 00400      C        Search_Equipment:
    31 00400 0004 C        	WDTC
    32 00401 1E00 C        	BANK                0
    33            C        	;MOV                 A,@0x07               ; N=250,P=256,f=8MHz ==> T=8ms
    34            C        	;MOV                 TWTCR,A
    35 00402 1806 C        	MOV                 A,@(256-250)           ; load initial value
    36 00403 0041 C        	MOV                 TCC,A
    37 00404 1EA0 C        	LCALL               RF_FREQ_SET
    37 00405 0F02 C        	LCALL               RF_FREQ_SET
    38 00406 1EA0 C        	LCALL               RESET_RF_FIFO
    38 00407 0DC4 C        	LCALL               RESET_RF_FIFO
    39 00408 1EA0 C        	LCALL               Enter_StandbyII_Mode
    39 00409 0EAF C        	LCALL               Enter_StandbyII_Mode
    40 0040A 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
    40 0040B 0E4E C        	LCALL               ENTER_RX_BUFFER_NACK
    41 0040C 0000 C        	NOP
    42            C        
    43 0040D      C        Detected_Connect_Key:
    44            C        ;=========================== SLEEP ==============================
    45 0040D      C        SearchSleep_Status_Judge:
    46 0040D 0E5D C        	JBS                 IntoSleepFlag/16,IntoSleepFlag%16
    47 0040E 142E C        	JMP                 SearchSleep_Status_Judge_End
    48 0040F      C        Wakeup_status_judeg:
    49 0040F 0011 C        	DISI
    50 00410 1EA0 C        	LCALL               RF_SLEEP
    50 00411 0EE5 C        	LCALL               RF_SLEEP
    51 00412 1EA0 C        	LCALL               MCU_EnterSleep_Set
    51 00413 02AC C        	LCALL               MCU_EnterSleep_Set
    52 00414 1E00 C        	BANK                0
    53 00415 0848 C        	BC                  LED1_STATUS/16,LED1_STATUS%16
    54 00416 0010 C        	ENI
    55 00417 0000 C        	NOP
    56 00418 0003 C        	SLEP                                                 ; enter Sleep mode
    57 00419 0000 C        	NOP
    58 0041A 1EA0 C        	LCALL               MCU_WakeUp_Set
    58 0041B 02BE C        	LCALL               MCU_WakeUp_Set
    59            C        ;-------------------- initial --------------------------------------
    60 0041C 1E00 C        	BANK                0
    61 0041D 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16      ; Disable 93C46
    62 0041E 0BCA C        	BS                  SPI_SS/16,SPI_SS%16              ; Disable EM198810
    63            C        ;-------------------------------------------------------------
    64            C        	;CALL                SearchLinkMode_Set
    65 0041F 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
    66 00420 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
    67 00421 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
    68 00422 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
    69 00423 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
    70 00424 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
    71            C        ;-------------------------------------------------------------
    72 00425 1EA0 C        	LCALL               EM198850_RESET
    72 00426 0CF9 C        	LCALL               EM198850_RESET
    73 00427 1EA0 C        	LCALL               RESET_RF_FIFO
    73 00428 0DC4 C        	LCALL               RESET_RF_FIFO
    74 00429 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
    74 0042A 0F1A C        	LCALL               CHANGE_ADDRESS_VALUE
    75 0042B 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
    75 0042C 0E4E C        	LCALL               ENTER_RX_BUFFER_NACK
    76 0042D 0000 C        	NOP
    77 0042E      C        SearchSleep_Status_Judge_End:
    78 0042E 085D C        	BC                  IntoSleepFlag/16,IntoSleepFlag%16
    79            C        ;======================================================================
    80            C        
    81            C        	;BANK                0
    82            C        	;MOV                 A,@0x07                ; N=31,P=256,f=8MHz ==> T=1ms
    83            C        	;MOV                 TWTCR,A
    84            C        
    85 0042F 1EA0 C        	LCALL               ConnectKey_Scan
    85 00430 1374 C        	LCALL               ConnectKey_Scan
    86 00431 0EDE C        	JBS                 KeyScanFinishFlag/16,KeyScanFinishFlag%16
    87 00432 1440 C        	JMP                 Keystoke_No_Press
    88            C        
    89 00433 0438 C        	MOV                 A,KEY_NUM
    90 00434 1B02 C        	XOR                 A,@00000010B
    91 00435 0C83 C        	JBC                 STATUS,Z
    92 00436 1515 C        	JMP                 Click_Select                  ;Click Select
    93            C        
    94 00437 0438 C        	MOV                 A,KEY_NUM
    95 00438 1B03 C        	XOR                 A,@00000011B
    96 00439 0C83 C        	JBC                 STATUS,Z
    97 0043A 151E C        	JMP                 Lasting_Press_Select          ;Lasting_Press Select
    98            C        
    99 0043B 0438 C        	MOV                 A,KEY_NUM
   100 0043C 1B04 C        	XOR                 A,@00000100B
   101 0043D 0C83 C        	JBC                 STATUS,Z
   102 0043E 1522 C        	JMP                 Dblclick_Select               ;Dblclick Select
   103            C        
   104 0043F 08DE C        	BC                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
   105            C        ;-------------------------------------------------------------------------
   106 00440      C        Keystoke_No_Press:
   107 00440 1E00 C        	BANK                0
   108 00441      C        Waiting_For_SearchData_Arrive:
   109 00441 0417 C        	MOV                 A,ComuClock                  ; 8ms Interrupt ,8ms*1=8ms
   110 00442 1D00 C        	SUB                 A,@0                         ; (ComuSyncTime-1)
   111 00443 0E03 C        	JBS                 STATUS,C
   112 00444 14E8 C        	JMP                 Search_Detect_Timeout        ; RX1  ; Timeout but have not received TX data
   113 00445 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   114 00446 140D C        	JMP                 Detected_Connect_Key
   115            C        ;-----------------------------------------------------------------------------------
   116 00447 0000 C        	NOP
   117            C        	;LCALL               LoseFrameLinkMode_Set
   118 00448 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   119 00449 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   120 0044A 0A9F C        	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   121            C        
   122 0044B 1E00 C        	BANK                0
   123            C        	;MOV                 A,@0x07              ; N=31,P=256,f=8MHz ==> T=1ms
   124            C        	;MOV                 TWTCR,A
   125 0044C 18E0 C        	MOV                 A,@(256-32)           ; Rload TCC value
   126 0044D 0041 C        	MOV                 TCC,A
   127 0044E 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   128 0044F 0348 C        	XOR                 PORT8,A
   129            C        
   130 00450 00D7 C        	CLR                 ComuClock
   131 00451 1EA0 C        	LCALL               Enter_StandbyII_Mode
   131 00452 0EAF C        	LCALL               Enter_StandbyII_Mode
   132 00453 0000 C        	NOP
   133 00454 0000 C        	NOP
   134            C        ;-----------------------------------------------------------------------------------
   135 00455 1EA0 C        	LCALL               READ_FIFO_RAM
   135 00456 0D95 C        	LCALL               READ_FIFO_RAM
   136 00457 1EA0 C        	LCALL               RESET_RF_FIFO
   136 00458 0DC4 C        	LCALL               RESET_RF_FIFO
   137 00459 0000 C        	NOP
   138 0045A 0000 C        	NOP
   139 0045B 0C1E C        	JBC                 ReadLengthError/16,ReadLengthError%16
   140 0045C 14E8 C        	JMP                 Search_Detect_Timeout
   141 0045D 0D5F C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   142 0045E 14D1 C        	JMP                 ForceLink_Mode_Task
   143 0045F 00D8 C        	CLR                 ComuCycleNum
   144 00460 00D9 C        	CLR                 ComuEndNum
   145            C        
   146            C        ;------------------- check sync imformation ---------------------
   147 00461 1E01 C        	BANK                1
   148 00462 0421 C        	MOV                 A,RX_IDH
   149 00463 1E00 C        	BANK                0
   150 00464 0361 C        	XOR                 RX_IDH_Buffer,A
   151 00465 0E83 C        	JBS                 STATUS,Z
   152 00466 1400 C        	JMP                 Search_Equipment      ;RX_ID_ERROR
   153 00467 1E01 C        	BANK                1
   154 00468 0422 C        	MOV                 A,RX_IDL
   155 00469 1E00 C        	BANK                0
   156 0046A 0362 C        	XOR                 RX_IDL_Buffer,A
   157 0046B 0E83 C        	JBS                 STATUS,Z
   158 0046C 1400 C        	JMP                 Search_Equipment      ;RX_ID_ERROR
   159            C        ;---------------------------------------------------------------------------
   160 0046D 00D2 C        	CLR                 TEMP2                 ;CHN_FLAG TEMP
   161 0046E 1E01 C        	BANK                1
   162 0046F 0426 C        	MOV                 A,TX_ID               ;
   163 00470 1A0F C        	AND                 A,@0X0F
   164 00471 0050 C        	MOV                 TEMP,A
   165            C        
   166 00472 0A03 C        	BS                  STATUS,C
   167 00473 06D2 C        	RLC                 TEMP2
   168 00474 05D0 C        	DJZ                 TEMP
   169 00475 1473 C        	JMP                 $-2
   170 00476 0412 C        	MOV                 A,TEMP2
   171 00477 0063 C        	MOV                 CHN_FLAG,A            ;repeat used channel
   172 00478 1E00 C        	BANK                0
   173 00479 0063 C        	MOV                 CHN_FLAG_Buffer,A
   174            C        
   175            C        ;------------------------------------------------------------------
   176            C        	MESSAGE             "TX_ID = (RX_IDL&0XF0)|N, {N=1,2,3,4...}"
***     USER MESSAGE: TX_ID = (RX_IDL&0XF0)|N, {N=1,2,3,4...}
   177 0047A      C        SearchComu_Cycle_work:
   178 0047A 1E01 C        	BANK                1
   179 0047B 00D8 C        	CLR                 ComuCycleNum
   180 0047C 0426 C        	MOV                 A,TX_ID
   181 0047D 1A0F C        	AND                 A,@0X0F
   182 0047E 005B C        	MOV                 DataShiftCounter,A        ;decode ComuCycleNum by TX_ID
   183 0047F 01DB C        	DEC                 DataShiftCounter
   184 00480 0C83 C        	JBC                 STATUS,Z
   185 00481 1486 C        	JMP                 ComuCycleNum_End
   186 00482      C        ComuCycleNum_Loop:
   187 00482 1804 C        	MOV                 A,@ComuTime
   188 00483 03D8 C        	ADD                 ComuCycleNum,A
   189 00484 05DB C        	DJZ                 DataShiftCounter
   190 00485 1482 C        	JMP                 ComuCycleNum_Loop
   191 00486      C        ComuCycleNum_End:
   192 00486 0000 C        	NOP
   193            C        
   194 00487 1E00 C        	BANK                0
   195 00488 0726 C        	SWAPA               N_CHN_Buffer          ;decode ComuEndNum  by N_CHN
   196 00489 1A0F C        	AND                 A,@0X0F
   197 0048A 005B C        	MOV                 DataShiftCounter,A          ;End communicate cycle
   198 0048B      C        ComuEndNum_Loop:
   199 0048B 1804 C        	MOV                 A,@ComuTime
   200 0048C 03D9 C        	ADD                 ComuEndNum,A
   201 0048D 05DB C        	DJZ                 DataShiftCounter
   202 0048E 148B C        	JMP                 ComuEndNum_Loop
   203 0048F 01D9 C        	DEC                 ComuEndNum
   204            C        
   205            C        ;-------------------------------------------------------------------------------
   206 00490 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   207 00491 0118 C        	SUB                 A,ComuCycleNum
   208 00492 0C03 C        	JBC                 STATUS,C
   209 00493 1490 C        	JMP                 $-3
   210            C        ;-------------------------------------------------------------------------------
   211            C            ;MOV                 A,@16                 ; Transmitter data ,SYNC HEAD = 7 byte
   212            C            ;MOV                 Databytelength,A
   213 00494 0000 C        	NOP
   214 00495 1E01 C            BANK                1
   215 00496 0420 C            MOV                 A,PID_DATA
   216 00497 1E00 C            BANK                0
   217 00498 0060 C            MOV                 PID_DATA_Buffer,A
   218 00499 1E01 C            BANK                1
   219 0049A 0421 C            MOV                 A,RX_IDH
   220 0049B 1E00 C            BANK                0
   221 0049C 0061 C            MOV                 RX_IDH_Buffer,A
   222 0049D 1E01 C            BANK                1
   223 0049E 0422 C            MOV                 A,RX_IDL
   224 0049F 1E00 C            BANK                0
   225 004A0 0062 C            MOV                 RX_IDL_Buffer,A
   226 004A1 1E01 C            BANK                1
   227 004A2 0423 C            MOV                 A,CHN_FLAG
   228 004A3 1E00 C            BANK                0
   229 004A4 0063 C            MOV                 CHN_FLAG_Buffer,A
   230 004A5 041F C            MOV                 A,CommuStatusFlag
   231 004A6 0064 C            MOV                 CommuStatusFlag_Buffer,A
   232 004A7 1E01 C            BANK                1
   233 004A8 0425 C            MOV                 A,DirectionCtrl
   234 004A9 1E00 C            BANK                0
   235 004AA 0065 C            MOV                 DirectionCtrl_Buffer,A
   236 004AB 1E01 C            BANK                1
   237 004AC 0426 C            MOV                 A,TX_ID
   238 004AD 1E00 C            BANK                0
   239 004AE 0066 C            MOV                 TX_ID_Buffer,A
   240            C        
   241 004AF 1E00 C        	BANK                0
   242 004B0 187F C        	MOV                 A,@0X7F
   243 004B1 0067 C        	MOV                 DataA_Buffer,A
   244 004B2 0068 C        	MOV                 DataB_Buffer,A
   245 004B3 0069 C        	MOV                 DataC_Buffer,A
   246 004B4 006A C        	MOV                 DataD_Buffer,A
   247 004B5 00EB C        	CLR                 DataE_Buffer
   248 004B6 00EC C        	CLR                 DataF_Buffer
   249 004B7 180F C        	MOV                 A,@0X0F
   250 004B8 006D C        	MOV                 DataG_Buffer,A
   251            C        
   252 004B9 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   252 004BA 0DCD C        	LCALL               Enter_TX_Buffer_ACK
   253 004BB 1EA0 C        	LCALL               WRITE_FIFO_RAM
   253 004BC 0DAC C        	LCALL               WRITE_FIFO_RAM
   254 004BD 1EA0 C        	LCALL               Enter_StandbyI_Mode
   254 004BE 0E9A C        	LCALL               Enter_StandbyI_Mode
   255            C        
   256 004BF 0000 C        	NOP
   257 004C0 1E01 C        	BANK                1
   258 004C1 0D5F C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   259 004C2 152F C        	JMP                 Write_EEprom_Task
   260 004C3 00F3 C        	CLR                 LossframeCNT
   261            C        ;-------------------------------------------------------------------------------
   262            C        
   263            C        	;LCALL               Key_Scan
   264            C        ;-------------------------------------------------
   265            C        	;LCALL               NormalLinkMode_Set
   266 004C4 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   267 004C5 0A5F C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   268 004C6 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   269 004C7 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   270 004C8 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   271 004C9 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   272            C        
   273            C        ;-------------------------------------------------------------------------------
   274 004CA 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   275 004CB 0119 C        	SUB                 A,ComuEndNum
   276 004CC 0C03 C        	JBC                 STATUS,C
   277 004CD 14CA C        	JMP                 $-3
   278            C        ;-------------------------------------------------------------------------------
   279 004CE 0000 C        	NOP
   280 004CF 0000 C        	NOP
   281 004D0 0012 C        	RET
   282            C        
   283            C        
   284 004D1      C        ForceLink_Mode_Task:
   285 004D1 1E00 C        	BANK                0
   286 004D2 00D1 C        	CLR                 TEMP1                 ;TEMP COUNTER
   287 004D3 0423 C        	MOV                 A,CHN_FLAG_Buffer     ;READ CHN_FLAG From Buffer
   288 004D4 0050 C        	MOV                 TEMP,A
   289 004D5 0803 C        	BC                  STATUS,C
   290 004D6 0650 C        	RRC                 TEMP
   291 004D7 0551 C        	INC                 TEMP1
   292 004D8 0C03 C        	JBC                 STATUS,C               ;CHN_FLAG: 00,01,03,07,0F,1F,3F,7F
   293 004D9 14D6 C        	JMP                 $-3                    ;TX_ID   :  1  2  3  4  5  6  7  8
   294 004DA 0411 C        	MOV                 A,TEMP1
   295 004DB 1E01 C        	BANK                1
   296 004DC 0066 C        	MOV                 TX_ID,A
   297            C        
   298 004DD 1E00 C            BANK                0
   299 004DE 0421 C        	MOV                 A,RX_IDH_Buffer        ;RX_IDH
   300 004DF 1E01 C        	BANK                1
   301 004E0 0061 C        	MOV                 RX_IDH,A
   302 004E1 1E00 C        	BANK                0
   303 004E2 0422 C        	MOV                 A,RX_IDL_Buffer
   304 004E3 1E01 C        	BANK                1
   305 004E4 0062 C        	MOV                 RX_IDL,A
   306 004E5 1AF0 C        	AND                 A,@0XF0
   307 004E6 0266 C        	OR                  TX_ID,A                ; TX_ID = (RX_IDL & OXF0) | (TX_ID & 0X0F)
   308 004E7 147A C        	JMP                 SearchComu_Cycle_work
   309            C        
   310 004E8      C        Search_Detect_Timeout:
   311            C        	;LCALL               SearchLinkMode_Set
   312 004E8 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   313 004E9 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   314 004EA 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   315            C        
   316 004EB 1E01 C        	BANK                1
   317 004EC 0572 C        	INC                 CH_NO
   318 004ED 0432 C        	MOV                 A,CH_NO
   319 004EE 1D4B C        	SUB                 A,@ChannelSum
   320 004EF 0E03 C        	JBS                 STATUS,C
   321 004F0 00F2 C        	CLR                 CH_NO
   322 004F1 00D7 C        	CLR                 ComuClock
   323 004F2 1EA0 C        	LCALL               RF_FREQ_SET
   323 004F3 0F02 C        	LCALL               RF_FREQ_SET
   324            C        	;BANK                0
   325            C        	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   326            C        	;XOR                 PORT8,A
   327 004F4 0000 C        	NOP
   328 004F5 1E00 C        	BANK                0
   329            C        
   330            C        ;---------------------------- LED Control --------------------------------
   331 004F6 0F5F C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   332 004F7 14F9 C        	JMP                 LED_NormalSearch
   333 004F8 1503 C        	JMP                 LED_ForcelinkSearch
   334 004F9      C        LED_NormalSearch:
   335 004F9 1E02 C        	BANK                2
   336 004FA 042F C        	MOV                 A,LEDSystemTimeCNT
   337 004FB 1D32 C        	SUB                 A,@LEDTwinklingFreq   ; Control key scan clock
   338 004FC 0C03 C        	JBC                 STATUS,C
   339 004FD 1504 C        	JMP                 LED_End_Control
   340 004FE 00EF C        	CLR                 LEDSystemTimeCNT
   341 004FF 1E00 C        	BANK                0
   342 00500 1802 C        	MOV                 A,@0B00000010         ; P81 exchange when Timeout
   343 00501 0348 C        	XOR                 PORT8,A
   344 00502 1504 C        	JMP                 LED_End_Control
   345 00503      C        LED_ForcelinkSearch:
   346 00503 0A48 C        	BS                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
   347 00504      C          LED_End_Control:
   348 00504 0000 C        	NOP
   349            C        ;--------------------------------------------------------------------------
   350            C        
   351 00505 081E C        	BC                  ReadLengthError/16,ReadLengthError%16
   352 00506 00DA C        	CLR                 Databytelength
   353 00507 00E1 C        	CLR                 RX_IDH_Buffer
   354 00508 00E2 C        	CLR                 RX_IDL_Buffer
   355 00509 00E3 C        	CLR                 CHN_FLAG_Buffer
   356 0050A 00E6 C        	CLR                 N_CHN_Buffer
   357 0050B 00E6 C        	CLR                 TX_ID_Buffer
   358 0050C 1EA0 C        	LCALL               Enter_StandbyII_Mode
   358 0050D 0EAF C        	LCALL               Enter_StandbyII_Mode
   359 0050E 1EA0 C        	LCALL               RESET_RF_FIFO		         ; REGISTER=82  INITIAL=0X80 CLEAR TX POINT
   359 0050F 0DC4 C        	LCALL               RESET_RF_FIFO		         ; REGISTER=82  INITIAL=0X80 CLEAR TX POINT
   360 00510 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   360 00511 0E4E C        	LCALL               ENTER_RX_BUFFER_NACK
   361 00512 0000 C        	NOP
   362 00513 0000 C        	NOP
   363 00514 140D C        	JMP                 Detected_Connect_Key
   364            C        
   365            C        
   366            C        
   367            C        
   368            C        ;**********************************************************************************
   369            C        ;*********************************************************************************
   370            C        ; FCC test mode frequency index
   371            C        ;*********************************************************************************
   372 00515      C        Click_Select:
   373 00515 0000 C        	NOP
   374 00516 0F9F C        	JBS                 FccTestModeFlag/16,FccTestModeFlag%16
   375 00517 1440 C        	JMP                 Keystoke_No_Press
   376 00518 0559 C        	INC                 FccFreqIndex
   377 00519 0419 C        	MOV                 A,FccFreqIndex
   378 0051A 1D0F C        	SUB                 A,@0X0F
   379 0051B 0E03 C        	JBS                 STATUS,C
   380 0051C 00D9 C        	CLR                 FccFreqIndex
   381 0051D 1440 C        	JMP                 Keystoke_No_Press
   382            C        
   383            C        
   384            C        
   385            C        ;**********************************************************************************
   386            C        ;*********************************************************************************
   387            C        ; Into FCC mode
   388            C        ;*********************************************************************************
   389 0051E      C        Lasting_Press_Select:
   390 0051E 0000 C        	NOP
   391            C        	;LCALL               FccSearchLinkMode_Set
   392            C        	;BC                  LinkModeFlag/16,LinkModeFlag%16
   393            C        	;BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   394 0051F 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   395 00520 0000 C        	NOP
   396 00521 140D C        	JMP                 Detected_Connect_Key
   397            C        
   398            C        
   399            C        ;**********************************************************************************
   400            C        ;*********************************************************************************
   401            C        ; Into force link mode
   402            C        ;*********************************************************************************
   403 00522      C        Dblclick_Select:                                  ; Into Forcelink Mode:
   404 00522 0000 C        	NOP
   405 00523 1E01 C        	BANK                1
   406            C        	;LCALL               SearchForceLinkMode_Set
   407 00524 091F C        	BC                  LinkModeFlag/16,LinkModeFlag%16
   408 00525 0B5F C        	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   409 00526 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   410            C        
   411 00527 189D C        	MOV                 A,@RX_IDH_DEFAULT         ; Address , default value 0X0DB3
   412 00528 0061 C        	MOV                 RX_IDH,A
   413 00529 18BC C        	MOV                 A,@RX_IDL_DEFAULT
   414 0052A 0062 C        	MOV                 RX_IDL,A
   415 0052B 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   415 0052C 0F1A C        	LCALL               CHANGE_ADDRESS_VALUE
   416 0052D 0000 C        	NOP
   417 0052E 1440 C        	JMP                 Keystoke_No_Press
   418            C        
   419            C        ;---------------------------------------------------------------
   420 0052F      C        Write_EEprom_Task:
   421 0052F 0011 C        	DISI
   422 00530 0000 C        	NOP
   423 00531 1E01 C        	BANK                1
   424 00532 0421 C        	MOV                 A,RX_IDH         ; Read ID
   425 00533 1E00 C        	BANK                0
   426 00534 0061 C        	MOV                 RX_IDH_Buffer,A
   427 00535 1E01 C        	BANK                1
   428 00536 0422 C        	MOV                 A,RX_IDL
   429 00537 1E00 C        	BANK                0
   430 00538 0062 C        	MOV                 RX_IDL_Buffer,A
   431 00539 1E01 C        	BANK                1
   432 0053A 0426 C        	MOV                 A,TX_ID
   433 0053B 1E00 C        	BANK                0
   434 0053C 0066 C        	MOV                 TX_ID_Buffer,A
   435 0053D 1E01 C        	BANK                1
   436 0053E 0426 C        	MOV                 A,N_CHN
   437 0053F 1E00 C        	BANK                0
   438 00540 0066 C        	MOV                 N_CHN_Buffer,A
   439 00541 0000 C        	NOP
   440            C        
   441 00542 1EA0 C        	LCALL               IO_93C46_INITIAL
   441 00543 101F C        	LCALL               IO_93C46_INITIAL
   442            C      M 	mEWEN                                      ; Enable
       00544 1EA0     1     LCALL  START_BIT ,
       00545 1000     1     LCALL  START_BIT ,
       00546 1830     1     MOV A,@( EWEN )
       00547 0051     1     MOV  R_ACC1 ,A
       00548 1809     1     MOV A,@( 9 )
       00549 1EA0     1     LCALL  RL_COMD ,
       0054A 100E     1     LCALL  RL_COMD ,
       0054B 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0054C 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0054D 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   443 0054E 0000 C        	NOP
   444 0054F 1800 C        	MOV                 A,@0X00
   445 00550 0055 C        	MOV                 DataAddressInEEPROM,A
   446 00551 1860 C        	MOV                 A,@0X60
   447 00552 0054 C        	MOV                 DataAddressInMCU,A
   448            C      M  	mWRITE              DataAddressInEEPROM,@0,DataAddressInMCU,@16
       00553 1E00     1     BANK @( 0 ),
       00554 0414     1     MOV A, DATAADDRESSINMCU 
       00555 0044     1     MOV  R4 ,A
       00556 1810     1     MOV A,@( 16 )
       00557 0053     1     MOV  R_ACC3 ,A
       00558          1    ??002B$WRITE_DATA:   
       00558 1EA0     1     LCALL  START_BIT ,
       00559 1000     1     LCALL  START_BIT ,
       0055A 0803     1     BC  STATUS , C 
       0055B 0615     1     RRCA  DATAADDRESSINEEPROM ,
       0055C 1940     1     OR A,@( WRITE )
       0055D 0051     1     MOV  R_ACC1 ,A
       0055E 1808     1     MOV A,@( 8 )
       0055F 1EA0     1     LCALL  RL_COMD ,
       00560 100E     1     LCALL  RL_COMD ,
       00561 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00562 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       00563 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       00564 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       00565 0B4A     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       00566 1567     1     JMP ( $ + 1 ),
       00567 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00568 0555     1     INC  DATAADDRESSINEEPROM ,
       00569          1    ??002B$DATA_H_L:   
       00569 0400     1     MOV A, R0 
       0056A 0051     1     MOV  R_ACC1 ,A
       0056B 0544     1     INC  R4 ,
       0056C 1808     1     MOV A,@( 8 )
       0056D 1EA0     1     LCALL  RL_COMD ,
       0056E 100E     1     LCALL  RL_COMD ,
       0056F 1570     1     JMP ( $ + 1 ),
       00570 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00571 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00572 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       00573 1574     1     JMP ( $ + 1 ),
       00574 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00575 0AC7     1     BS ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00576 0F0A     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       00577 1576     1     JMP ( $ - 1 ),
       00578 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00579 05D3     1     DJZ  R_ACC3 ,
       0057A 1558     1     JMP  ??002B$WRITE_DATA ,
   449            C      M  	mEWDS                                      ; disable
       0057B 1EA0     1     LCALL  START_BIT ,
       0057C 1000     1     LCALL  START_BIT ,
       0057D 1800     1     MOV A,@( EWDS )
       0057E 0051     1     MOV  R_ACC1 ,A
       0057F 1809     1     MOV A,@( 9 )
       00580 1EA0     1     LCALL  RL_COMD ,
       00581 100E     1     LCALL  RL_COMD ,
       00582 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00583 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00584 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   450 00585 1EA0 C         	LCALL               IO_93C46_QUIT
   450 00586 102A C         	LCALL               IO_93C46_QUIT
   451 00587 0000 C         	NOP
   452            C         	;BANK                0
   453            C        	;MOV                 A,@0x07
   454            C        	;MOV                 TWTCR,A
   455 00588 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   455 00589 0F1A C        	LCALL               CHANGE_ADDRESS_VALUE
   456 0058A 0000 C        	NOP
   457 0058B 0010 C        	ENI
   458 0058C 00D7 C        	CLR                 ComuClock
   459 0058D 00D8 C        	CLR                 ComuCycleNum
   460 0058E 00D9 C        	CLR                 ComuEndNum
   461 0058F 00DF C        	CLR                 CommuStatusFlag
   462 00590 00DD C        	CLR                 GeneralStatusFlag1
   463 00591 00DE C        	CLR                 GeneralStatusFlag2
   464 00592 00E3 C        	CLR                 CHN_FLAG
   465            C        	;LCALL               SearchLinkMode_Set
   466 00593 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   467 00594 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   468 00595 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   469 00596 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   470 00597 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   471 00598 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   472            C        
   473 00599 1E00 C        	BANK                0
   474 0059A 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16    ; Disable 93C46
   475 0059B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16            ; Disable EM198810
   476 0059C 140D C        	JMP                 Detected_Connect_Key
   477 0059D 0000 C        	NOP
   478            C        
   479            C        
   480            C        
   481            C        ;**********************************************************************************
   482            C        ;*************************************************************************
   483            C        ; Normal communicate
   484            C        ;*************************************************************************
   485            C        	ORG                 0X800   ; PAGE 2
   486 00800      C        Normal_Communicate:
   487 00800      C        Lossframe_Communicate:
   488 00800 0004 C        	WDTC
   489 00801 00D7 C        	CLR                 ComuClock
   490 00802 1E01 C        	BANK                1
   491 00803 0432 C        	MOV                 A,CH_NO
   492 00804 1D4B C        	SUB                 A,@ChannelSum
   493 00805 0E03 C        	JBS                 STATUS,C
   494 00806 00F2 C        	CLR                 CH_NO
   495 00807 1EA0 C        	LCALL               RF_FREQ_SET
   495 00808 0F02 C        	LCALL               RF_FREQ_SET
   496 00809 1EA0 C        	LCALL               RESET_RF_FIFO
   496 0080A 0DC4 C        	LCALL               RESET_RF_FIFO
   497 0080B 10C1 C        	CALL                Sampling_Task
   498            C        
   499            C        ;-------------------------------------------------------------------------------
   500 0080C 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   501 0080D 1D02 C        	SUB                 A,@DelayTime
   502 0080E 0C03 C        	JBC                 STATUS,C
   503 0080F 140C C        	JMP                 $-3
   504            C        ;-------------------------------------------------------------------------------
   505 00810 1EA0 C        	LCALL               Enter_StandbyII_Mode
   505 00811 0EAF C        	LCALL               Enter_StandbyII_Mode
   506 00812 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   506 00813 0E4E C        	LCALL               ENTER_RX_BUFFER_NACK
   507 00814 1E00 C        	BANK                0
   508            C        
   509 00815      C        Waiting_For_NormalData_arrive:
   510 00815 0417 C        	MOV                 A,ComuClock                    ; "T=ComuTime" a cycle ,
   511 00816 1D03 C        	SUB                 A,@(ComuSyncTime-1)            ; CMD time, "T=ComuTime"
   512 00817 0E03 C        	JBS                 STATUS,C                       ; Sync Timing no recive any data
   513 00818 149E C        	JMP                 LoseFrameStatus_Timeout        ; RX1  ; Timeout but have not received TX data
   514 00819 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	       ; 1:TX data receive finished  0:wating PKT pull high
   515 0081A 1415 C        	JMP                 Waiting_For_NormalData_arrive
   516            C        ;-----------------------------------------------------------------------------------
   517 0081B 1E00 C        	BANK                0
   518            C        	;MOV                 A,@0x07                ; N=31,P=256,f=8MHz ==> T=1ms
   519            C        	;MOV                 TWTCR,A
   520 0081C 18E1 C        	MOV                 A,@(256-31)           ;Rload TCC value
   521 0081D 0041 C        	MOV                 TCC,A                  ;adjust time by PKT sync
   522 0081E 00D7 C        	CLR                 ComuClock
   523 0081F 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   524 00820 0348 C        	XOR                 PORT8,A
   525            C        
   526 00821 1EA0 C        	LCALL               READ_FIFO_RAM
   526 00822 0D95 C        	LCALL               READ_FIFO_RAM
   527 00823 1EA0 C        	LCALL               Enter_StandbyI_Mode
   527 00824 0E9A C        	LCALL               Enter_StandbyI_Mode
   528 00825 0C1E C        	JBC                 ReadLengthError/16,ReadLengthError%16
   529 00826 149E C        	JMP                 LoseFrameStatus_Timeout
   530            C        
   531            C        ;------------------- check sync imformation ---------------------
   532 00827 1E01 C        	BANK                1
   533 00828 0421 C        	MOV                 A,RX_IDH
   534 00829 1E00 C        	BANK                0
   535 0082A 0361 C        	XOR                 RX_IDH_Buffer,A
   536 0082B 0E83 C        	JBS                 STATUS,Z
   537 0082C 149E C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   538 0082D 1E01 C        	BANK                1
   539 0082E 0422 C        	MOV                 A,RX_IDL
   540 0082F 1E00 C        	BANK                0
   541 00830 0362 C        	XOR                 RX_IDL_Buffer,A
   542 00831 0E83 C        	JBS                 STATUS,Z
   543 00832 149E C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   544            C        ;------------------------------------------------------------------
   545 00833 1E01 C        	BANK                1
   546            C        	;LCALL               NormalLinkMode_Set
   547 00834 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   548 00835 0A5F C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   549 00836 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   550 00837 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   551 00838 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   552 00839 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   553 0083A 00F3 C        	CLR                 LossframeCNT
   554            C        
   555            C        	;RRCA                ComuEndNum
   556            C        	;MOV                 TEMP,A
   557            C        	;MOV                 A,ComuCycleNum
   558            C        	;SUB                 A,TEMP
   559            C        	;JBS                 STATUS,C
   560            C        	;CALL                Sampling_Task
   561            C        ;-------------------------------------------------------------------------------
   562 0083B 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   563 0083C 0118 C        	SUB                 A,ComuCycleNum
   564 0083D 0C03 C        	JBC                 STATUS,C
   565 0083E 143B C        	JMP                 $-3
   566            C        ;-------------------------------------------------------------------------------
   567            C        	;RRCA                ComuEndNum
   568            C        	;MOV                 TEMP,A
   569            C        	;MOV                 A,ComuCycleNum
   570            C        	;SUB                 A,TEMP
   571            C        	;JBC                 STATUS,C
   572            C        	;CALL               Sampling_Task
   573            C        
   574            C        ;------------------ sleep status judge --------------------------
   575 0083F      C        NormalSleep_Status_Judge:
   576 0083F 1E02 C        	BANK                2
   577 00840 0420 C        	MOV                 A,DataA
   578 00841 1B7F C        	XOR                 A,@0X7F
   579 00842 0E83 C        	JBS                 STATUS,Z
   580 00843 1458 C        	JMP                 NormalSleep_Status_Judge_End1
   581 00844 0421 C        	MOV                 A,DataB
   582 00845 1B7F C        	XOR                 A,@0X7F
   583 00846 0E83 C        	JBS                 STATUS,Z
   584 00847 1458 C        	JMP                 NormalSleep_Status_Judge_End1
   585            C        	;MOV                 A,DataC
   586            C        	;XOR                 A,@0X7F
   587            C        	;JBS                 STATUS,Z
   588            C        	;JMP                 NormalSleep_Status_Judge_End1
   589            C        	;MOV                 A,DataD
   590            C        	;XOR                 A,@0X7F
   591            C        	;JBS                 STATUS,Z
   592            C        	;JMP                 NormalSleep_Status_Judge_End1
   593 00848 0424 C        	MOV                 A,DataE
   594 00849 1B00 C        	XOR                 A,@0X00
   595 0084A 0E83 C        	JBS                 STATUS,Z
   596 0084B 1458 C        	JMP                 NormalSleep_Status_Judge_End1
   597            C        	;MOV                 A,DataF
   598            C        	;XOR                 A,@0X7F
   599            C        	;JBS                 STATUS,Z
   600            C        	;JMP                 NormalSleep_Status_Judge_End1
   601 0084C 0426 C        	MOV                 A,DataG
   602 0084D 1B0F C        	XOR                 A,@0X0F
   603 0084E 0E83 C        	JBS                 STATUS,Z
   604 0084F 1458 C        	JMP                 NormalSleep_Status_Judge_End1
   605            C        
   606 00850 0E5D C        	JBS                 IntoSleepFlag/16,IntoSleepFlag%16
   607 00851 1459 C        	JMP                 NormalSleep_Status_Judge_End2
   608            C        	;LCALL               SearchLinkMode_Set
   609 00852 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   610 00853 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   611 00854 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   612 00855 00D7 C        	CLR                 ComuClock
   613 00856 00F2 C        	CLR                 CH_NO
   614 00857 0012 C        	RET
   615 00858      C        NormalSleep_Status_Judge_End1:
   616 00858 00DC C        	CLR                 SleepCNT
   617 00859      C        NormalSleep_Status_Judge_End2:
   618 00859 0000 C        	NOP
   619            C        
   620            C        ;===================================================================
   621 0085A 180E C            MOV                 A,@14                         ;Transmitter data ,7 byte
   622 0085B 005A C            MOV                 Databytelength,A
   623 0085C 1E01 C            BANK                1
   624 0085D 0421 C            MOV                 A,RX_IDH                     ;sync header
   625 0085E 1E00 C            BANK                0
   626 0085F 0061 C            MOV                 RX_IDH_Buffer,A
   627 00860 1E01 C            BANK                1
   628 00861 0422 C            MOV                 A,RX_IDL
   629 00862 1E00 C            BANK                0
   630 00863 0062 C            MOV                 RX_IDL_Buffer,A
   631 00864 1E01 C            BANK                1
   632 00865 0423 C            MOV                 A,CHN_FLAG
   633 00866 1E00 C            BANK                0
   634 00867 0063 C            MOV                 CHN_FLAG_Buffer,A
   635            C        
   636 00868 041F C            MOV                 A,CommuStatusFlag
   637 00869 0064 C            MOV                 CommuStatusFlag_Buffer,A
   638            C        
   639 0086A 1E01 C            BANK                1
   640 0086B 0425 C            MOV                 A,DirectionCtrl
   641 0086C 1E00 C            BANK                0
   642 0086D 0065 C            MOV                 DirectionCtrl_Buffer,A
   643            C        
   644 0086E 1E01 C            BANK                1
   645 0086F 0426 C            MOV                 A,TX_ID
   646 00870 1E00 C            BANK                0
   647 00871 0066 C            MOV                 TX_ID_Buffer,A
   648 00872 1E02 C            BANK                2                            ;Data output
   649 00873 0420 C            MOV                 A,DataA
   650 00874 1E00 C            BANK                0
   651 00875 0067 C            MOV                 DataA_Buffer,A
   652 00876 1E02 C            BANK                2
   653 00877 0421 C            MOV                 A,DataB
   654 00878 1E00 C            BANK                0
   655 00879 0068 C            MOV                 DataB_Buffer,A
   656 0087A 1E02 C            BANK                2
   657 0087B 0422 C            MOV                 A,DataC
   658 0087C 1E00 C            BANK                0
   659 0087D 0069 C            MOV                 DataC_Buffer,A
   660 0087E 1E02 C        	BANK                2
   661 0087F 0423 C            MOV                 A,DataD
   662 00880 1E00 C            BANK                0
   663 00881 006A C            MOV                 DataD_Buffer,A
   664 00882 1E02 C            BANK                2
   665 00883 0424 C            MOV                 A,DataE
   666 00884 1E00 C            BANK                0
   667 00885 006B C            MOV                 DataE_Buffer,A
   668 00886 1E02 C            BANK                2
   669 00887 0425 C            MOV                 A,DataF
   670 00888 1E00 C            BANK                0
   671 00889 006C C            MOV                 DataF_Buffer,A
   672 0088A 1E02 C            BANK                2
   673 0088B 0426 C            MOV                 A,DataG
   674 0088C 1E00 C            BANK                0
   675 0088D 006D C            MOV                 DataG_Buffer,A
   676            C        
   677 0088E 1EA0 C        	LCALL               Enter_StandbyII_Mode
   677 0088F 0EAF C        	LCALL               Enter_StandbyII_Mode
   678 00890 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   678 00891 0DCD C        	LCALL               Enter_TX_Buffer_ACK
   679 00892 1EA0 C        	LCALL               Write_FIFO_RAM
   679 00893 0DAC C        	LCALL               Write_FIFO_RAM
   680 00894 1EA0 C        	LCALL               Enter_StandbyI_Mode
   680 00895 0E9A C        	LCALL               Enter_StandbyI_Mode
   681 00896 0000 C        	NOP
   682            C        
   683            C        ;--------------------------- Wating a cycle end --------------------------------------
   684 00897 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   685 00898 0119 C        	SUB                 A,ComuEndNum
   686 00899 0C03 C        	JBC                 STATUS,C
   687 0089A 1497 C        	JMP                 $-3
   688            C        ;--------------------------------------------------------------------------------------
   689 0089B 0000 C        	NOP
   690 0089C 0000 C        	NOP
   691 0089D 1400 C        	JMP                 Normal_Communicate    ; a cycle End
   692            C        
   693            C        
   694            C        
   695            C        ;============================================================================================
   696 0089E      C        LoseFrameStatus_Timeout:
   697 0089E 00D7 C        	CLR                 ComuClock
   698 0089F 0419 C        	MOV                 A,ComuEndNum
   699 008A0 0117 C        	SUB                 A,ComuClock                       ;2ms a cycle ,
   700 008A1 0C03 C        	JBC                 STATUS,C
   701 008A2 149F C        	JMP                 $-3
   702 008A3 0000 C        	NOP
   703 008A4      C        LoseFrameStatus_RXID_Error:
   704 008A4 1E00 C        	BANK                0
   705 008A5 081E C        	BC                  ReadLengthError/16,ReadLengthError%16
   706 008A6 00DA C        	CLR                 Databytelength
   707 008A7 00E1 C        	CLR                 RX_IDH_Buffer
   708 008A8 00E2 C        	CLR                 RX_IDL_Buffer
   709 008A9 00E3 C        	CLR                 CHN_FLAG_Buffer
   710 008AA 00E6 C        	CLR                 N_CHN_Buffer
   711 008AB 00E6 C        	CLR                 TX_ID_Buffer
   712 008AC 1E01 C        	BANK                1
   713            C        	;LCALL               LoseFrameLinkMode_Set
   714 008AD 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   715 008AE 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   716 008AF 0A9F C        	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   717 008B0 0433 C        	MOV                 A,LossframeCNT                    ;LossframeCNT>1 stand for loss frequency
   718 008B1 1D03 C        	SUB                 A,@LossframeSum
   719 008B2 0E03 C        	JBS                 STATUS,C
   720 008B3 14B6 C        	JMP                 LoseFreqStatus_Timeout
   721 008B4 0573 C        	INC                 LossframeCNT
   722 008B5 1400 C        	JMP                 Lossframe_Communicate
   723            C        
   724 008B6      C        LoseFreqStatus_Timeout:
   725            C        	;LCALL               SearchLinkMode_Set
   726 008B6 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   727 008B7 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   728 008B8 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   729 008B9 1E01 C        	BANK                1
   730 008BA 00D7 C        	CLR                 ComuClock
   731 008BB 00D8 C        	CLR                 ComuCycleNum
   732 008BC 00D9 C        	CLR                 ComuEndNum
   733 008BD 00F3 C        	CLR                 LossframeCNT
   734 008BE 00E3 C        	CLR                 CHN_FLAG
   735 008BF 0012 C        	RET                                                ;return to search status
   736 008C0 0000 C        	NOP
   737            C        
   738            C        ;==========================================================================
   739            C        ; data Sampling function
   740            C        ;==========================================================================
   741 008C1      C        Sampling_Task:
   742 008C1 1EA0 C        	LCALL                Key_Scan              ;get key data
   742 008C2 1100 C        	LCALL                Key_Scan              ;get key data
   743            C        	;LCALL               CmosSensor_Function
   744            C        	;LCALL               GS_Sensor
   745 008C3 0000 C        	NOP
   746 008C4 0012 C        	RET
   747            C        ;==========================================================================
   748            C        
   749            C        
   750            C        
   751            C        
   752            C        
    19                     include "XX93C46_For_EM78P520.ASM"
     1            C        ;***********************************************************************;
     2            C        ; Tilte: Em78x510x spi FOR AT93C46 Function macro Code                  ;
     3            C        ; Description:                                  ;
     4            C        ;     1."mEWEN"  /                                    ;
     5            C        ;     2."mEWDS"  /                                    ;
     6            C        ;     3."mWRITE"    ;
     7            C        ;     4."mREAD"                         ;
     8            C        ;     5."mERASE"                    ;
     9            C        ;     6."mERAL"  "FF"             ;
    10            C        ;     7."mWRAL"                             ;
    11            C        ; Company: Elan Corp. Inc                                               ;
    12            C        ; Author:  yu.wei                                                     ;
    13            C        ; Date:    2009.3.20                                                    ;
    14            C        ; Version: v1.0                                                         ;
    15            C        ;                         ;
    16            C        ;***********************************************************************
    17            C        ;
    18            C        ;    1. 8bit;
    19            C        ;------------------------------------------------------
    20            C        ; spi          Port Used For 93C46 Control.
    21            C        ; cs           Port Pin Tied To cs On 93C46.
    22            C        ; sk           Port Pin Tied To sk On 93C46.
    23            C        ; di           Port Pin Tied To di On 93C46.
    24            C        ; DO           Port Pin Tied To DO On 93C46.
    25            C        ; r_acc1     This Register Contains The 2 Bit 93C46
    26            C        ;              Command Is The High 2 Bit Positions And
    27            C        ;              memory Address In The Lower 6.
    28            C        ;--------------------------------------------------
    29            C        ;Instruction   SB    Op Code     Address               Data
    30            C        ;                               x8       x16       x8       x16
    31            C        ;    READ       1      10 	A6 - A0  A5 - A0
    32            C        ;    EWEN       1 	   00     11XXXXX  11XXXX
    33            C        ;    ERASE      1      11     A6 - A0  A5 - A0
    34            C        ;    WRITE      1 	   01 	A6 - A0  A5 - A0   D7 - D0  D15- D0
    35            C        ;    ERAL       1 	   00 	10XXXXX  10XXXX
    36            C        ;    WRAL       1 	   00 	01XXXXX  01XXXX    D7 - D0  D15- D0
    37            C        ;    EWDS       1 	   00 	00XXXXX  00XXXX
    38            C        ;=================================================================================
    39            C        
    40            C        XX93C46_For_EM78P520.ASM       EQU        XX93C46_For_EM78P510.ASM
    41            C        include "XX93C46_For_EM78P520.H"
     1            C        ;---------------------------------------------------
     2            C        XX93C46_For_EM78P510.H       EQU        XX93C46_For_EM78P510.H
     3            C        
     4            C        ;---------------------------------------------------
     5            C        ;  93C46 INSTRUCTION  COmmAND
     6            C        ;--------------------------------------------------
     7       0080 C                READ        EQU     0X80    ;93C46 Read Command.
     8       0040 C                WRITE       EQU     0X40    ;93C46 Write Command.
     9       00C0 C                ERASE       EQU     0XC0    ;93C46 Erase Command.
    10       0030 C                EWEN        EQU     0X30    ;93C46 Erase/Write Enable Command.
    11       0000 C                EWDS        EQU     0X00    ;93C46 Erase/Write Disable Command.
    12       0020 C                ERAL        EQU     0X20    ;92C46 Erase All Command.
    13       0010 C                WRAL        EQU     0X10    ;92C46 Write All Command.
    14            C        ;--------------------------------------------------
    42            C        
    43            C        ifndef EM78CtrlIns.H
    44            C        include "EM78CtrlIns.H"
    45            C        endif
    46            C        ;--------------------------------------------------
    47            C        
    48            C                ORG     0X1000
    49            C        ;***********************************************************************;
    50            C        ;Program name: mEWEN m,spi    m 8BIT16BIT               ;
    51            C        ;Description:  /                                ;
    52            C        ;Input:         m==8m==16  m                  ;
    53            C        ;              spics,sk,di,DO                               ;
    54            C        ;Output:       /                                          ;
    55            C        ;Variable Register:None                                                 ;
    56            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    57            C        ;***********************************************************************;
    58            C        mEWEN   MACRO
    59            C                LCALL   Start_Bit       ;load start bit
    60            C                MOV     A,@ewen         ;enable erase/write
    61            C                MOV     r_acc1,A
    62            C                ;
    63            C                MOV     A,@9
    64            C                ;
    65            C                LCALL    Rl_Comd         ;finish enable erase/write
    66            C                BC      AT93C46_CS/16,AT93C46_CS%16          ;load end bit
    67            C                BC      SPI_CLK/16,SPI_CLK%16
    68            C                BC      SPI_MOSI/16,SPI_MOSI%16
    69            C                ENDM
    70            C        ;
    71            C        ;***********************************************************************;
    72            C        ;Program name:  mEWDS m,spi    m 8BIT16BIT              ;
    73            C        ;Description:   /                               ;
    74            C        ;Input:          m==8m==16  m               ;
    75            C        ;               spics,sk,di,DO                              ;
    76            C        ;Output:        /                                         ;
    77            C        ;Variable Register:None                                                 ;
    78            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    79            C        ;***********************************************************************;
    80            C        mEWDS   MACRO
    81            C                LCALL    Start_Bit       ;
    82            C                MOV      A,@ewds         ;
    83            C                MOV      r_acc1,A
    84            C                ;
    85            C                MOV      A,@9
    86            C                ;
    87            C                LCALL    Rl_Comd
    88            C                BC       AT93C46_CS/16,AT93C46_CS%16
    89            C                BC       SPI_CLK/16,SPI_CLK%16
    90            C                BC       SPI_MOSI/16,SPI_MOSI%16          ;
    91            C                ENDM
    92            C        ;
    93            C        ;***********************************************************************;
    94            C        ;Program name:  mWRITE m,DataAddressInEEPROM,k,DataAddressInMCU,spi                            ;
    95            C        ;Description:                                   ;
    96            C        ;Input:         m  m==816                                 ;
    97            C        ;               DataAddressInEEPROM  (93C46      ;
    98            C        ;               k                                   ;
    99            C        ;               DataAddressInMCU  mCU         ;
   100            C        ;               spi  PORTcs,sk,di,DO      ;
   101            C        ;Output:                                      ;
   102            C        ;Variable Register:None                                                 ;
   103            C        ;Register Changed: STATUS,ACC ,
   104            C        ;                  r_acc1(0X21) ,
   105            C        ;                  r_acc2(0X22),         ;
   106            C        ;                  r_acc3(0X23)                                       ;
   107            C        ;***********************************************************************;
   108            C        mWRITE  MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   109            C                BANK    @BankSel
   110            C                MOV     A,DataAddressInMCU    ;0X24mCU
   111            C                MOV     R4,A                   ;
   112            C                MOV     A,@k
   113            C                MOV     r_acc3,A               ;93C46
   114            C        $Write_Data:
   115            C                LCALL    Start_Bit             ;
   116            C               ;
   117            C                BC      STATUS,C
   118            C                RRCA    DataAddressInEEPROM
   119            C                ;
   120            C                OR      A,@write
   121            C                MOV     r_acc1,A               ;
   122            C                MOV     A,@8                   ;93C46
   123            C                LCALL    Rl_Comd               ;
   124            C               ;
   125            C                BC      SPI_CLK/16,SPI_CLK%16
   126            C                JBS     DataAddressInEEPROM,0        ;8BIT
   127            C                BC      SPI_MOSI/16,SPI_MOSI%16
   128            C                JBC     DataAddressInEEPROM,0
   129            C                BS      SPI_MOSI/16,SPI_MOSI%16
   130            C                JMP     $+1
   131            C                BS      SPI_CLK/16,SPI_CLK%16          ;OPADDRESS
   132            C                ;
   133            C                INC     DataAddressInEEPROM
   134            C        $Data_H_L:
   135            C                MOV     A,R0
   136            C                MOV     r_acc1,A      ;
   137            C                INC     R4
   138            C                MOV     A,@8
   139            C                LCALL    Rl_Comd         ;8BIT
   140            C               ;
   141            C                JMP     $+1
   142            C               ;
   143            C                BC      AT93C46_CS/16,AT93C46_CS%16
   144            C                BC      SPI_CLK/16,SPI_CLK%16          ;
   145            C                ;BC      AT93C46_CS/16,AT93C46_CS%16
   146            C                BC      SPI_MOSI/16,SPI_MOSI%16
   147            C                JMP     $+1
   148            C                BS      SPI_CLK/16,SPI_CLK%16
   149            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;
   150            C                JBS     SPI_MISO/16,SPI_MISO%16
   151            C                JMP     $-1
   152            C                BC      AT93C46_CS/16,AT93C46_CS%16
   153            C                DJZ     r_acc3        ;
   154            C                JMP     $Write_Data
   155            C                ENDM
   156            C        ;
   157            C        ;***********************************************************************;
   158            C        ;Program name:  mREAD m,DataAddressInEEPROM,k,DataAddressInMCU,spi                             ;
   159            C        ;Description:   93C46(CPU)          ;
   160            C        ;Input:         m  m==816                                 ;
   161            C        ;               DataAddressInEEPROM  (93C46      ;
   162            C        ;               k                                   ;
   163            C        ;               DataAddressInMCU  mCU         ;
   164            C        ;               spi  PORTcs,sk,di,DO      ;
   165            C        ;Output:                                          ;
   166            C        ;Variable Register:None                                                 ;
   167            C        ;Register Changed: STATUS,ACC ,
   168            C        ;                  r_acc1(0X21) ,
   169            C        ;                  r_acc2(0X22),         ;
   170            C        ;                  r_acc3(0X23)                                       ;
   171            C        ;***********************************************************************;
   172            C        mREAD   MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   173            C                BANK    @BankSel
   174            C                MOV     A,DataAddressInMCU              ;mCU     ;
   175            C                MOV     R4,A
   176            C                MOV     A,@k
   177            C                MOV     r_acc3,A
   178            C        $Write_Data:
   179            C                LCALL    Start_Bit       ;
   180            C               ;
   181            C                RRCA    DataAddressInEEPROM
   182            C                ;
   183            C                OR      A,@READ
   184            C                MOV     r_acc1,A      ;
   185            C                MOV     A,@8            ;93C46
   186            C                LCALL    Rl_Comd         ;
   187            C               ;
   188            C                BC      SPI_CLK/16,SPI_CLK%16
   189            C                JBS     DataAddressInEEPROM,0        ;8BIT
   190            C                BC      SPI_MOSI/16,SPI_MOSI%16
   191            C                JBC     DataAddressInEEPROM,0
   192            C                BS      SPI_MOSI/16,SPI_MOSI%16
   193            C                JMP     $+1
   194            C                BS      SPI_CLK/16,SPI_CLK%16
   195            C               ;
   196            C                INC     DataAddressInEEPROM          ;1
   197            C                BC      SPI_MOSI/16,SPI_MOSI%16
   198            C                JMP     $+1
   199            C                BC      SPI_CLK/16,SPI_CLK%16
   200            C                JMP     $+1
   201            C                JMP     $+1
   202            C                BS      SPI_CLK/16,SPI_CLK%16
   203            C        
   204            C        $Read_Data1:
   205            C                MOV     A,@8
   206            C                MOV     r_acc2,A
   207            C        $Read_Data2:
   208            C                BC      SPI_CLK/16,SPI_CLK%16
   209            C                NOP
   210            C                NOP
   211            C                JBC     SPI_MISO/16,SPI_MISO%16
   212            C                BS      STATUS,C
   213            C                JBS     SPI_MISO/16,SPI_MISO%16
   214            C                BC      STATUS,C
   215            C                RLC     R0
   216            C                BS      SPI_CLK/16,SPI_CLK%16
   217            C                JMP     $+1
   218            C                DJZ     r_acc2
   219            C                JMP     $Read_Data2
   220            C                INC     R4
   221            C                ;
   222            C                NOP
   223            C                ;
   224            C                BC      AT93C46_CS/16,AT93C46_CS%16
   225            C                DJZ     r_acc3
   226            C                JMP     $Write_Data
   227            C                ENDM
   228            C        ;
   229            C        ;***********************************************************************;
   230            C        ;Program name:  mERASE m,DataAddressInEEPROM,k,spi                                   ;
   231            C        ;Description:                                       ;
   232            C        ;Input:         m  m==816                                 ;
   233            C        ;               DataAddressInEEPROM (93C46       ;
   234            C        ;               k                                   ;
   235            C        ;               spi    PORTcs,sk,di,DO    ;
   236            C        ;Output:                                          ;
   237            C        ;Variable Register:None                                                 ;
   238            C        ;Register Changed: STATUS,ACC ,
   239            C        ;                  r_acc1(0X21) ,
   240            C        ;                  r_acc2(0X22),         ;
   241            C        ;                  r_acc3(0X23)                                       ;
   242            C        ;***********************************************************************;
   243            C        mERASE  MACRO    DataAddressInEEPROM,k
   244            C                MOV     A,@k
   245            C                MOV     r_acc3,A      ;93C46
   246            C        $Write_Data:
   247            C                LCALL    Start_Bit       ;
   248            C               ;
   249            C                RRCA    DataAddressInEEPROM
   250            C               ;
   251            C                OR      A,@ERASE
   252            C                MOV     r_acc1,A      ;
   253            C                MOV     A,@8            ;93C46
   254            C                LCALL    Rl_Comd         ;
   255            C                ;
   256            C                BC      SPI_CLK/16,SPI_CLK%16
   257            C                JBS     DataAddressInEEPROM,0        ;8BIT
   258            C                BC      SPI_MOSI/16,SPI_MOSI%16
   259            C                JBC     DataAddressInEEPROM,0
   260            C                BS      SPI_MOSI/16,SPI_MOSI%16
   261            C                JMP     $+1
   262            C                BS      SPI_CLK/16,SPI_CLK%16          ;
   263            C                JMP     $+1
   264            C                JMP     $+1
   265            C               ;
   266            C                INC     DataAddressInEEPROM
   267            C                BC      AT93C46_CS/16,AT93C46_CS%16
   268            C                BC      SPI_CLK/16,SPI_CLK%16
   269            C                BC      SPI_MOSI/16,SPI_MOSI%16
   270            C                JMP     $+1
   271            C                BS      SPI_CLK/16,SPI_CLK%16
   272            C                BS      AT93C46_CS/16,AT93C46_CS%16
   273            C                JBS     SPI_MISO/16,SPI_MISO%16
   274            C                JMP     $-1
   275            C                BC      AT93C46_CS/16,AT93C46_CS%16
   276            C        ;
   277            C                DJZ     r_acc3
   278            C                JMP     $Write_Data
   279            C                ENDM
   280            C        ;
   281            C        ;***********************************************************************;
   282            C        ;Program name:  mERAL m,spi                                             ;
   283            C        ;Description:                                         ;
   284            C        ;Input:         m  m==816                                 ;
   285            C        ;               spi  PORTcs,sk,di,DO      ;
   286            C        ;Output:        FF"                         ;
   287            C        ;Variable Register:None                                                 ;
   288            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   289            C        ;***********************************************************************
   290            C        mERAL   MACRO
   291            C        $Write_Data:
   292            C                LCALL   Start_Bit       ;
   293            C                MOV     A,@ERAL
   294            C                MOV     r_acc1,A      ;
   295            C               ;
   296            C                MOV     A,@9
   297            C               ;
   298            C                LCALL    Rl_Comd
   299            C                BC      AT93C46_CS/16,AT93C46_CS%16
   300            C                BC      SPI_CLK/16,SPI_CLK%16
   301            C                BC      SPI_MOSI/16,SPI_MOSI%16
   302            C                JMP     $+1
   303            C                BS      SPI_CLK/16,SPI_CLK%16
   304            C                BS      AT93C46_CS/16,AT93C46_CS%16
   305            C                JBS     SPI_MISO/16,SPI_MISO%16
   306            C                JMP     $-1
   307            C                BC      AT93C46_CS/16,AT93C46_CS%16
   308            C                ENDM
   309            C        ;
   310            C        ;***********************************************************************;
   311            C        ;Program name:  mWRAL m,DataAddressInMCU,spi                                      ;
   312            C        ;Description:                                 ;
   313            C        ;Input:         m  m==816                                 ;
   314            C        ;               spi  PORTcs,sk,di,DO      ;
   315            C        ;               DataAddressInMCU  mCU         ;
   316            C        ;Output:                                        ;
   317            C        ;Variable Register:None                                                 ;
   318            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   319            C        ;***********************************************************************;
   320            C        mWRAL   MACRO   @DataAddressInMCU
   321            C                MOV     A,@DataAddressInMCU
   322            C                MOV     R4,A            ;
   323            C                LCALL    Start_Bit       ;
   324            C                MOV     A,@WRAL
   325            C                MOV     r_acc1,A      ;
   326            C                ;
   327            C                MOV     A,@9
   328            C                ;
   329            C                LCALL    Rl_Comd
   330            C        $Data_H_L:
   331            C                MOV     A,R0
   332            C                MOV     r_acc1,A      ;
   333            C                INC     R4
   334            C                MOV     A,@8
   335            C                LCALL    Rl_Comd         ;8BIT
   336            C                ;
   337            C                NOP
   338            C                ;
   339            C                BC      SPI_CLK/16,SPI_CLK%16          ;
   340            C                BC      AT93C46_CS/16,AT93C46_CS%16
   341            C                BC      SPI_MOSI/16,SPI_MOSI%16
   342            C                JMP     $+1
   343            C                BS      SPI_CLK/16,SPI_CLK%16
   344            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;
   345            C                JBS     SPI_MISO/16,SPI_MISO%16
   346            C                JMP     $-1
   347            C                BC      AT93C46_CS/16,AT93C46_CS%16
   348            C                BC      SPI_CLK/16,SPI_CLK%16
   349            C                ENDM
   350            C        
   351            C        
   352            C        ;-------------------------------------------------------
   353 01000      C        Start_Bit:
   354 01000 1E00 C        		BANK    @0
   355 01001 08C7 C                BC      AT93C46_CS/16,AT93C46_CS%16
   356 01002 098A C                BC      SPI_CLK/16,SPI_CLK%16
   357 01003 094A C                BC      SPI_MOSI/16,SPI_MOSI%16
   358 01004 1405 C                JMP     $+1
   359 01005 1406 C                JMP     $+1
   360 01006 0AC7 C                BS      AT93C46_CS/16,AT93C46_CS%16
   361 01007 1408 C                JMP     $+1
   362 01008 1409 C                JMP     $+1
   363 01009 0B4A C                BS      SPI_MOSI/16,SPI_MOSI%16       ;PORT6,SPI_MOSI;
   364 0100A 140B C                JMP     $+1
   365 0100B 140C C                JMP     $+1
   366 0100C 0B8A C                BS      SPI_CLK/16,SPI_CLK%16
   367 0100D 0012 C                RET
   368            C        
   369            C        ;--------------------------------------------------------
   370 0100E      C        Rl_Comd:
   371 0100E 005B C        	MOV     DataShiftCounter,A
   372 0100F 1E00 C        	BANK    @0
   373 01010      C        Rl_Comd1:
   374 01010 098A C        	BC      SPI_CLK/16,SPI_CLK%16
   375 01011 1412 C        	JMP     $+1
   376 01012 0803 C        	bc      status,c
   377 01013 06D1 C        	RLC     r_acc1        ;
   378 01014 0E03 C        	JBS     STATUS,C
   379 01015 094A C        	BC      SPI_MOSI/16,SPI_MOSI%16
   380 01016 0C03 C        	JBC     STATUS,C
   381 01017 0B4A C        	BS      SPI_MOSI/16,SPI_MOSI%16
   382 01018 0000 C        	NOP
   383 01019 0000 C        	NOP
   384 0101A 0B8A C        	BS      SPI_CLK/16,SPI_CLK%16
   385 0101B 141C C        	JMP     $+1
   386 0101C 05DB C        	DJZ     DataShiftCounter
   387 0101D 1410 C        	JMP     Rl_Comd1
   388 0101E 0012 C        	RET                   ;    return
   389            C        
   390            C        ;=============== SPI Config for EM78P510====================
   391 0101F      C        IO_93C46_INITIAL:
   392 0101F 1E00 C        	BANK                0
   393 01020 0BCA C        	BS                  SPI_SS/16,SPI_SS%16          ; Disable EM198810
   394 01021 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16        ; Disable CMOS
   395 01022 0AC7 C        	BS                 AT93C46_CS/16,AT93C46_CS%16   ; Enable 93C46
   396            C        
   397 01023 1E02 C        	BANK                2
   398 01024 040D C        	MOV                 A,SPIC
   399 01025 1E04 C        	BANK                4
   400 01026 0071 C        	MOV                 SPIC_TEMP,A
   401 01027 1E02 C        	BANK                2
   402 01028 00CD C        	CLR                 SPIC
   403 01029 0012 C        	RET
   404            C        
   405 0102A      C        IO_93C46_QUIT:
   406 0102A 1E00 C        	BANK                0
   407            C        	;BS                 SPI_SS/16,SPI_SS%16           ; Disable EM198810
   408            C        	;BS                 CMOS_SS/16,CMOS_SS%16         ; Disable CMOS
   409 0102B 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   410            C        
   411 0102C 1E04 C        	BANK                4
   412 0102D 0431 C        	MOV                 A,SPIC_TEMP
   413 0102E 1E02 C        	BANK                2
   414 0102F 004D C        	MOV                 SPIC,A
   415 01030 0012 C        	RET
    20                     ;include "CmosSensorDev.ASM"
    21                     ;include "FccTest.asm"
    22                     
    23                     ;-----------------------------------------------------------------
    24                     
    25                     
    26                     
    27                     ;--------------------------MAIN PROGRAM---------------------------
    28                     	ORG                 0X00
    29 00000 1EB0          	LJMP                INITIAL
    29 00001 019C          	LJMP                INITIAL
***     Warning A053:The lcall/ljmp address is not over page (1K).
    30                     	ORG                 0X03
    31 00003 1EB0          	LJMP                TCC_INT
    31 00004 0100          	LJMP                TCC_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    32                     	ORG                 0X06
    33 00006 1EB0          	LJMP                EXTERNAL_INT
    33 00007 0134          	LJMP                EXTERNAL_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    34                     	ORG                 0X09
    35 00009 1EB0          	LJMP                WDT_INT
    35 0000A 0151          	LJMP                WDT_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    36                     	ORG                 0X0C
    37 0000C 1EB0          	LJMP                TIMER1_INT
    37 0000D 0153          	LJMP                TIMER1_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    38                     	ORG                 0X0F
    39 0000F 1EB0          	LJMP                TIMER2_INT
    39 00010 017B          	LJMP                TIMER2_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    40                     	ORG                 0X12
    41 00012 1EB0          	LJMP                AD_INT
    41 00013 0152          	LJMP                AD_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    42                     	ORG                 0X15
    43 00015 1EB0          	LJMP                UART_INT
    43 00016 0199          	LJMP                UART_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    44                     	ORG                 0X18
    45 00018 1EB0          	LJMP                SPI_INT
    45 00019 019A          	LJMP                SPI_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    46                     	ORG                 0X1B
    47 0001B 1EB0          	LJMP                LVD_INT
    47 0001C 019B          	LJMP                LVD_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    48                     
    49                     
    50                     	ORG                 0X100
    51                     ;========================= TCC Interrupt Service ==================================
    52 00100               TCC_INT:
    53                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTCC_Temp,RSRTcc_TEMP
       00100 0054     1     MOV  A_TEMP ,A
       00101 0754     1     SWAP  A_TEMP ,
       00102 0703     1     SWAPA  3 ,
       00103 0056     1     MOV  STATUS_TEMP ,A
       00104 0705     1     SWAPA  5 ,
       00105 0055     1     MOV  RSR_TEMP ,A
       00106 00C3     1     CLR  3 ,
       00107 1E04     1     BANK @( 4 ),
       00108 0414     1     MOV A, A_TEMP 
       00109 0060     1     MOV  ATCC_TEMP ,A
       0010A 0416     1     MOV A, STATUS_TEMP 
       0010B 0062     1     MOV  STATUSTCC_TEMP ,A
       0010C 0415     1     MOV A, RSR_TEMP 
       0010D 0061     1     MOV  RSRTCC_TEMP ,A
    54 0010E 1E00          	BANK                0
    55 0010F 080F          	BC                  ISR,TCIF               ;clear TCC interrupt flag
    56 00110 0C1F          	JBC                 SearchStatusFlag/16,SearchStatusFlag%16
    57 00111 151A          	JMP                 Search_Status_Mode
    58 00112 0C9F          	JBC                 LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
    59 00113 1520          	JMP                 LoseFrame_Status_Mode
    60 00114 0C5F          	JBC                 NormalStatusFlag/16,NormalStatusFlag%16
    61 00115 1517          	JMP                 Normal_Status_Mode
    62 00116 1523          	JMP                 TCC_INT_END
    63                     ;---------------------------------------------------------------------------
    64 00117               	Normal_Status_Mode:
    65                     		;MOV             A,@0x07                ; N=31,P=256,f=8MHz ==> T=1ms
    66                     		;MOV             TWTCR,A
    67 00117 18E1          		MOV             A,@(256-31)           ; load initial value
    68 00118 0041          		MOV             TCC,A
    69 00119 1523          		JMP             TCC_INT_END
    70                     ;-------------------------------------------------------------------
    71 0011A               	Search_Status_Mode:
    72                     		;MOV             A,@0X07                ; N=250,P=256,f=8MHz ==> T=8ms
    73                     		;MOV             TWTCR,A
    74 0011A 1806          		MOV             A,@(256-250)           ; load initial value
    75 0011B 0041          		MOV             TCC,A
    76 0011C 1E02          		BANK            2
    77 0011D 056E          		INC             KeySystemTimeCNT
    78 0011E 056F          		INC             LEDSystemTimeCNT
    79                     /*
    80                     		MOV             A,KeySystemTimeCNT
    81                     		SUB             A,@1                   ; Control key scan clock
    82                     		JBC             STATUS,C
    83                     		JMP             TCC_INT_END
    84                     		BS              System16msFlag/16,System16msFlag%16
    85                     		CLR             KeySystemTimeCNT
    86                     		;BANK            0
    87                     		;MOV             A,@0B00100000          ; (test)P85 exchange when intrrupt
    88                     		;XOR             PORT8,A
    89                     */
    90 0011F 1523          		JMP             TCC_INT_END
    91                     ;-------------------------------------------------------------------
    92 00120               	LoseFrame_Status_Mode:
    93                     		;MOV             A,@0x07                ; N=31,P=256,f=8MHz ==> T=1ms
    94                     		;MOV             TWTCR,A
    95 00120 18E1          		MOV             A,@(256-31)           ; load initial value
    96 00121 0041          		MOV             TCC,A
    97 00122 1523          		JMP             TCC_INT_END
    98 00123               TCC_INT_END:
    99 00123 1E00          	BANK                0
   100 00124 1820          	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   101 00125 0348          	XOR                 PORT8,A
   102 00126 0557          	INC                 ComuClock
   103                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTcc_Temp,RSRTcc_TEMP
       00127 1E04     1     BANK @( 4 ),
       00128 0420     1     MOV A, ATCC_TEMP 
       00129 0054     1     MOV  A_TEMP ,A
       0012A 0422     1     MOV A, STATUSTCC_TEMP 
       0012B 0056     1     MOV  STATUS_TEMP ,A
       0012C 0415     1     MOV A, RSR_TEMP 
       0012D 0061     1     MOV  RSRTCC_TEMP ,A
       0012E 0716     1     SWAPA  STATUS_TEMP ,
       0012F 0043     1     MOV  3 ,A
       00130 0715     1     SWAPA  RSR_TEMP ,
       00131 0045     1     MOV  5 ,A
       00132 0714     1     SWAPA  A_TEMP ,
   104 00133 0013          	RETI
   105                     
   106 00134               EXTERNAL_INT:
   107                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,STATUSExt_Temp,RSRExt_Temp
       00134 0054     1     MOV  A_TEMP ,A
       00135 0754     1     SWAP  A_TEMP ,
       00136 0703     1     SWAPA  3 ,
       00137 0056     1     MOV  STATUS_TEMP ,A
       00138 0705     1     SWAPA  5 ,
       00139 0055     1     MOV  RSR_TEMP ,A
       0013A 00C3     1     CLR  3 ,
       0013B 1E04     1     BANK @( 4 ),
       0013C 0414     1     MOV A, A_TEMP 
       0013D 0063     1     MOV  AEXT_TEMP ,A
       0013E 0416     1     MOV A, STATUS_TEMP 
       0013F 0065     1     MOV  STATUSEXT_TEMP ,A
       00140 0415     1     MOV A, RSR_TEMP 
       00141 0064     1     MOV  RSREXT_TEMP ,A
   108 00142 1E01          	BANK                1
   109 00143 00CF          	CLR                 EISR               ;clear the external interrupt flag
   110                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,StatusExt_Temp,RSRExt_Temp
       00144 1E04     1     BANK @( 4 ),
       00145 0423     1     MOV A, AEXT_TEMP 
       00146 0054     1     MOV  A_TEMP ,A
       00147 0425     1     MOV A, STATUSEXT_TEMP 
       00148 0056     1     MOV  STATUS_TEMP ,A
       00149 0415     1     MOV A, RSR_TEMP 
       0014A 0064     1     MOV  RSREXT_TEMP ,A
       0014B 0716     1     SWAPA  STATUS_TEMP ,
       0014C 0043     1     MOV  3 ,A
       0014D 0715     1     SWAPA  RSR_TEMP ,
       0014E 0045     1     MOV  5 ,A
       0014F 0714     1     SWAPA  A_TEMP ,
   111 00150 0013          	RETI
   112                     
   113 00151               WDT_INT:
   114 00151 0013          	RETI
   115                     
   116 00152               AD_INT:
   117 00152 0013          	RETI
   118                     
   119 00153               TIMER1_INT:
   120                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,Status1_Temp,RSR1_Temp
       00153 0054     1     MOV  A_TEMP ,A
       00154 0754     1     SWAP  A_TEMP ,
       00155 0703     1     SWAPA  3 ,
       00156 0056     1     MOV  STATUS_TEMP ,A
       00157 0705     1     SWAPA  5 ,
       00158 0055     1     MOV  RSR_TEMP ,A
       00159 00C3     1     CLR  3 ,
       0015A 1E04     1     BANK @( 4 ),
       0015B 0414     1     MOV A, A_TEMP 
       0015C 0066     1     MOV  A1_TEMP ,A
       0015D 0416     1     MOV A, STATUS_TEMP 
       0015E 0068     1     MOV  STATUS1_TEMP ,A
       0015F 0415     1     MOV A, RSR_TEMP 
       00160 0067     1     MOV  RSR1_TEMP ,A
   121 00161 1E00          	BANK                0
   122 00162 09CF          	BC                  ISR,T1IF               ; clear Timer1 interrupt flag
   123                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   124                     	;XOR                 PORT8,A
   125 00163 1E02          	BANK                2
   126 00164 18FF          	MOV                 A,@255                ; N=256, Auto reload
   127 00165 0047          	MOV                 T1PD,A
   128 00166 055C          	INC                 SleepCNT               ; 2s  at a time
   129 00167 041C          	MOV                 A,SleepCNT
   130 00168 1DFA          	SUB                 A,@SetSleepTime        ;
   131 00169 0C03          	JBC                 STATUS,C
   132 0016A 156D          	JMP                 TIMER1_INT_END
   133 0016B 0A5D          	BS                  IntoSleepFlag/16,IntoSleepFlag%16
   134                     	;BANK                0
   135                     	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   136                     	;XOR                 PORT8,A
   137 0016C 00DC          	CLR                 SleepCNT
   138 0016D                 TIMER1_INT_END:
   139 0016D 0000          	NOP
   140                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,STATUS1_Temp,RSR1_Temp
       0016E 1E04     1     BANK @( 4 ),
       0016F 0426     1     MOV A, A1_TEMP 
       00170 0054     1     MOV  A_TEMP ,A
       00171 0428     1     MOV A, STATUS1_TEMP 
       00172 0056     1     MOV  STATUS_TEMP ,A
       00173 0415     1     MOV A, RSR_TEMP 
       00174 0067     1     MOV  RSR1_TEMP ,A
       00175 0716     1     SWAPA  STATUS_TEMP ,
       00176 0043     1     MOV  3 ,A
       00177 0715     1     SWAPA  RSR_TEMP ,
       00178 0045     1     MOV  5 ,A
       00179 0714     1     SWAPA  A_TEMP ,
   141 0017A 0013          	RETI
   142                     
   143 0017B               TIMER2_INT:
   144                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
       0017B 0054     1     MOV  A_TEMP ,A
       0017C 0754     1     SWAP  A_TEMP ,
       0017D 0703     1     SWAPA  3 ,
       0017E 0056     1     MOV  STATUS_TEMP ,A
       0017F 0705     1     SWAPA  5 ,
       00180 0055     1     MOV  RSR_TEMP ,A
       00181 00C3     1     CLR  3 ,
       00182 1E04     1     BANK @( 4 ),
       00183 0414     1     MOV A, A_TEMP 
       00184 0069     1     MOV  A2_TEMP ,A
       00185 0416     1     MOV A, STATUS_TEMP 
       00186 006B     1     MOV  STATUS2_TEMP ,A
       00187 0415     1     MOV A, RSR_TEMP 
       00188 006A     1     MOV  RSR2_TEMP ,A
   145 00189 1E02          	BANK                2
   146 0018A 09C9          	BC                  T2CR,T2IF              ; clear Timer2 interrupt flag
   147 0018B 056D          	INC                 IOcheckTimeCNT
   148                     	;BANK                0
   149                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   150                     	;XOR                 PORT8,A
   151                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
       0018C 1E04     1     BANK @( 4 ),
       0018D 0429     1     MOV A, A2_TEMP 
       0018E 0054     1     MOV  A_TEMP ,A
       0018F 042B     1     MOV A, STATUS2_TEMP 
       00190 0056     1     MOV  STATUS_TEMP ,A
       00191 0415     1     MOV A, RSR_TEMP 
       00192 006A     1     MOV  RSR2_TEMP ,A
       00193 0716     1     SWAPA  STATUS_TEMP ,
       00194 0043     1     MOV  3 ,A
       00195 0715     1     SWAPA  RSR_TEMP ,
       00196 0045     1     MOV  5 ,A
       00197 0714     1     SWAPA  A_TEMP ,
   152 00198 0013          	RETI
   153 00199               UART_INT:
   154 00199 0013          	RETI
   155 0019A               SPI_INT:
   156 0019A 0013          	RETI
   157 0019B               LVD_INT:
   158 0019B 0013          	RETI
   159                     
   160                     
   161                     ;=======================================================================
   162                     ;============================ Begin Program ============================
   163 0019C               INITIAL:
   164 0019C 0000          	NOP
   165 0019D 0000          	NOP
   166 0019E 0000          	NOP
   167 0019F 0000          	NOP
   168 001A0 0000          	NOP
   169 001A1 0000          	NOP
   170 001A2 0000          	NOP
   171 001A3 0000          	NOP
   172 001A4 0000          	NOP
   173 001A5 0011          	DISI
   174 001A6 0000          	NOP
   175 001A7 0000          	NOP
   176 001A8 0000          	NOP
   177 001A9 0011          	DISI
   178 001AA 0000          	NOP
   179 001AB 0000          	NOP
   180 001AC 0000          	NOP
   181 001AD 0011          	DISI
   182 001AE 0000          	NOP
   183 001AF 0004          	WDTC
   184                   M 	ClrCommRamBank
       001B0 1810     1     MOV A,@( 16 )
       001B1 0044     1     MOV  R4 ,A
       001B2          1    CLEAR_10_1F_RAM_LOOP:   
       001B2 0004     1     WDTC 
       001B3 00C0     1     CLR  R0 ,
       001B4 0544     1     INC  R4 ,
       001B5 183F     1     MOV A,@( 63 )
       001B6 0284     1     AND A, R4 
       001B7 1D1F     1     SUB A,@( 31 )
       001B8 0C03     1     JBC  R3 , C 
       001B9 15B2     1     JMP  CLEAR_10_1F_RAM_LOOP ,
       001BA 00C4     1     CLR  R4 ,
   185 001BB 0000          	NOP
   186                   M 	ClrRamBank
       001BC 18E0     1     MOV A,@( 224 )
       001BD 0044     1     MOV  R4 ,A
       001BE 00C5     1     CLR  BSR ,
       001BF 0004     1     WDTC 
       001C0 00C0     1     CLR  R0 ,
       001C1 0544     1     INC  R4 ,
       001C2 0404     1     MOV A, R4 
       001C3 1A3F     1     AND A,@( 63 )
       001C4 0E83     1     JBS  R3 , Z 
       001C5 15C0     1     JMP ( $ - 5 ),
       001C6 0545     1     INC  BSR ,
       001C7 0405     1     MOV A, BSR 
       001C8 1A07     1     AND A,@( 7 )
       001C9 0B44     1     BS  R4 , 5 
       001CA 0B84     1     BS  R4 , 6 
       001CB 0E83     1     JBS  R3 , 2 
       001CC 15BF     1     JMP ( $ - 13 ),
       001CD 00C4     1     CLR  R4 ,
       001CE 00C5     1     CLR  BSR ,
       001CF 0B84     1     BS  R4 , 6 
   187 001D0 0000          	NOP
   188 001D1 1262          	CALL                IO_INITIAL
   189 001D2 0000          	NOP
   190 001D3 1E00          	BANK                0
   191 001D4 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16      ; Disable 93C46
   192 001D5 0BCA          	BS                  SPI_SS/16,SPI_SS%16              ; Disable EM198810
   193 001D6 1EA0          	LCALL               EM198850_RESET
   193 001D7 0CF9          	LCALL               EM198850_RESET
   194 001D8 0000          	NOP
   195 001D9 0000          	NOP
   196                     
   197                     ;==============================================================================
   198 001DA 1EA0          	LCALL               IO_93C46_INITIAL    ; Set I/O
   198 001DB 101F          	LCALL               IO_93C46_INITIAL    ; Set I/O
   199 001DC 1E00          	BANK                0
   200 001DD 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16     ; Disable 93C46
   201 001DE 0BCA          	BS                  SPI_SS/16,SPI_SS%16             ; Disable EM198810
   202 001DF 1800          	MOV                 A,@0X00
   203 001E0 0055          	MOV                 DataAddressInEEPROM,A
   204 001E1 1860          	MOV                 A,@0X60
   205 001E2 0054          	MOV                 DataAddressInMCU,A
   206                   M 	mREAD               DataAddressInEEPROM,@0,DataAddressInMCU,@16
       001E3 1E00     1     BANK @( 0 ),
       001E4 0414     1     MOV A, DATAADDRESSINMCU 
       001E5 0044     1     MOV  R4 ,A
       001E6 1810     1     MOV A,@( 16 )
       001E7 0053     1     MOV  R_ACC3 ,A
       001E8          1    ??0028$WRITE_DATA:   
       001E8 1EA0     1     LCALL  START_BIT ,
       001E9 1000     1     LCALL  START_BIT ,
       001EA 0615     1     RRCA  DATAADDRESSINEEPROM ,
       001EB 1980     1     OR A,@( READ )
       001EC 0051     1     MOV  R_ACC1 ,A
       001ED 1808     1     MOV A,@( 8 )
       001EE 1EA0     1     LCALL  RL_COMD ,
       001EF 100E     1     LCALL  RL_COMD ,
       001F0 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001F1 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       001F2 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001F3 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       001F4 0B4A     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001F5 15F6     1     JMP ( $ + 1 ),
       001F6 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001F7 0555     1     INC  DATAADDRESSINEEPROM ,
       001F8 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001F9 15FA     1     JMP ( $ + 1 ),
       001FA 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001FB 15FC     1     JMP ( $ + 1 ),
       001FC 15FD     1     JMP ( $ + 1 ),
       001FD 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001FE          1    ??0028$READ_DATA1:   
       001FE 1808     1     MOV A,@( 8 )
       001FF 0052     1     MOV  R_ACC2 ,A
       00200          1    ??0028$READ_DATA2:   
       00200 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00201 0000     1     NOP 
       00202 0000     1     NOP 
       00203 0D0A     1     JBC ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       00204 0A03     1     BS  STATUS , C 
       00205 0F0A     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       00206 0803     1     BC  STATUS , C 
       00207 06C0     1     RLC  R0 ,
       00208 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00209 160A     1     JMP ( $ + 1 ),
       0020A 05D2     1     DJZ  R_ACC2 ,
       0020B 1600     1     JMP  ??0028$READ_DATA2 ,
       0020C 0544     1     INC  R4 ,
       0020D 0000     1     NOP 
       0020E 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0020F 05D3     1     DJZ  R_ACC3 ,
       00210 15E8     1     JMP  ??0028$WRITE_DATA ,
   207                   M 	mEWDS
       00211 1EA0     1     LCALL  START_BIT ,
       00212 1000     1     LCALL  START_BIT ,
       00213 1800     1     MOV A,@( EWDS )
       00214 0051     1     MOV  R_ACC1 ,A
       00215 1809     1     MOV A,@( 9 )
       00216 1EA0     1     LCALL  RL_COMD ,
       00217 100E     1     LCALL  RL_COMD ,
       00218 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00219 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0021A 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   208 0021B 1EA0          	LCALL               IO_93C46_QUIT       ; Set I/O
   208 0021C 102A          	LCALL               IO_93C46_QUIT       ; Set I/O
   209 0021D 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16     ; Disable 93C46
   210 0021E 0BCA          	BS                  SPI_SS/16,SPI_SS%16             ; Disable EM198810
   211                     
   212 0021F 1E00          	BANK                0
   213 00220 0421          	MOV                 A,RX_IDH_Buffer     ; Read ID
   214 00221 1E01          	BANK                1
   215 00222 0061          	MOV                 RX_IDH,A
   216 00223 1E00          	BANK                0
   217 00224 0422          	MOV                 A,RX_IDL_Buffer
   218 00225 1E01          	BANK                1
   219 00226 0062          	MOV                 RX_IDL,A
   220 00227 1E00          	BANK                0
   221 00228 0426          	MOV                 A,TX_ID_Buffer
   222 00229 1E01          	BANK                1
   223 0022A 0066          	MOV                 TX_ID,A
   224 0022B 1E00          	BANK                0
   225 0022C 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16        ; Disable 93C46
   226 0022D 0BCA          	BS                  SPI_SS/16,SPI_SS%16                ; Disable EM198810
   227                     
   228                     
   229 0022E 1E01          	BANK                1
   230 0022F 18FF          	MOV                 A,@0XFF             ; judge RX_ID,TX_ID
   231 00230 0321          	XOR                 A,RX_IDH
   232 00231 0C83          	JBC                 STATUS,Z
   233 00232 1638          	JMP                 Used_Default_Sync
   234 00233 18FF          	MOV                 A,@0XFF
   235 00234 0322          	XOR                 A,RX_IDL
   236 00235 0C83          	JBC                 STATUS,Z
   237 00236 1638          	JMP                 Used_Default_Sync
   238 00237 163C          	JMP                 Start_Up
   239 00238               Used_Default_Sync:
   240 00238 189D          	MOV                 A,@RX_IDH_DEFAULT             ; SYNC ,used default 0X0DB3
   241 00239 0061          	MOV                 RX_IDH,A
   242 0023A 18BC          	MOV                 A,@RX_IDL_DEFAULT
   243 0023B 0062          	MOV                 RX_IDL,A
   244                     
   245                     ;==============================================================================
   246 0023C               Start_Up:
   247 0023C 1EA0          	LCALL               CHANGE_ADDRESS_VALUE
   247 0023D 0F1A          	LCALL               CHANGE_ADDRESS_VALUE
   248 0023E 00F2          	CLR                 CH_NO
   249 0023F 1EA0          	LCALL               RF_FREQ_SET
   249 00240 0F02          	LCALL               RF_FREQ_SET
   250                     
   251 00241 0010          	ENI
   252 00242 1E00          	BANK                0
   253 00243 00D7          	CLR                 ComuClock
   254 00244 00D8          	CLR                 ComuCycleNum
   255 00245 00D9          	CLR                 ComuEndNum
   256 00246 0A48          	BS                  LED1_STATUS/16,LED1_STATUS%16		     ; PORT81,LED
   257 00247 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16              ; Disable 93C46
   258 00248 0BCA          	BS                  SPI_SS/16,SPI_SS%16                      ; Disable EM198810
   259                     
   260 00249 00DC          	CLR                 SleepCNT
   261 0024A 00DF          	CLR                 CommuStatusFlag
   262 0024B 00DD          	CLR                 GeneralStatusFlag1
   263 0024C 00DE          	CLR                 GeneralStatusFlag2
   264 0024D 00E3          	CLR                 CHN_FLAG
   265                     
   266 0024E 1E02          	BANK                2
   267 0024F 18FF          	MOV                 A,@0XFF
   268 00250 0076          	MOV                 KeystokeFlag_Befor,A
   269 00251 0077          	MOV                 KeystokeTimeCNT,A
   270                     ;-----------------------------------------------------------------
   271                     	;CALL                SearchLinkMode_Set
   272 00252 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   273 00253 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   274 00254 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   275 00255 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   276 00256 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   277 00257 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   278 00258 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   279                     ;-----------------------------------------------------------------
   280 00259 0000          	NOP
   281                     
   282                     
   283                     ;=============================================================================
   284 0025A               MAIN:
   285                     
   286                     
   287 0025A 1EA0          	LCALL               Search_Equipment
   287 0025B 0400          	LCALL               Search_Equipment
   288 0025C 1E00          	BANK                0
   289 0025D 0848          	BC                  LED1_STATUS/16,LED1_STATUS%16
   290 0025E 1EA0          	LCALL               Normal_Communicate
   290 0025F 0800          	LCALL               Normal_Communicate
   291                     
   292                     
   293                     
   294                     	;LCALL               ConnectKey_Scan
   295                     
   296                     /*
   297                     	BC                  SearchStatusFlag/16,SearchStatusFlag%16
   298                     	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   299                     	BC                  NormalStatusFlag/16,NormalStatusFlag%16
   300                     */
   301                     
   302                     /*
   303                     	BANK                5
   304                     	MOV                 A,@0B00000100
   305                     	MOV                 GS_PARAMETER,A
   306                     	LCALL               CmosSensor_Function
   307                     */
   308                     	;LCALL               Key_Scan
   309                     	;LCALL               IO_Rocker_KeyScan
   310 00260 0000          	NOP
   311 00261 165A          	JMP                 MAIN
   312                     
   313                     
   314                     ;*****************************************************************
   315                     ;Function:    IO INITIAL SET
   316                     ;Input:       None
   317                     ;Output:      None
   318                     ;*****************************************************************
   319 00262               IO_INITIAL:
   320                     ;============================ TCC config ====================================
   321 00262 1E00          	BANK                0
   322 00263 1807          	MOV                 A,@0X07         ; N=250,P=256,f=8MHz ==> T=8ms
   323 00264 004D          	MOV                 TWTCR,A
   324 00265 1806          	MOV                 A,@(256-250)    ; load initial value
   325 00266 0041          	MOV                 TCC,A
   326 00267 0A0E          	BS                  IMR,TCIE        ; set   TCIE=1  tcc enable interrupt
   327 00268 00CF          	CLR                 ISR             ; clear interrupt flag
   328 00269 1E01          	BANK                1
   329 0026A 00CF          	CLR                 EISR            ; Clear External Interrupt Status Register
   330 0026B 00CE          	CLR                 EIMR            ; Clear External Interrupt Mask  Register
   331                     
   332                     ;============================ Timer 1 config ===================================
   333 0026C 1E00          	BANK                0
   334 0026D 0BCE          	BS                  IMR,T1IE         ; Enable Timier1
   335 0026E 09CF          	BC                  ISR,T1IF         ; Clear timer1 intrrupt flag
   336 0026F 1E02          	BANK                2
   337 00270 1807          	MOV                 A,@0B00000111    ; N=255, P=128, T=1s
   338 00271 0045          	MOV                 T1CR,A
   339 00272 18FF          	MOV                 A,@255           ; N=255, Auto reload
   340 00273 0047          	MOV                 T1PD,A
   341 00274 1814          	MOV                 A,@0B00010100    ; 8 bit counter ,f=32.768KHz
   342 00275 0046          	MOV                 TSR,A
   343 00276 0A85          	BS                  T1CR,T1EN
   344                     
   345                     ;============================ Timer 2 config ===================================
   346 00277 1E00          	BANK                0
   347 00278 0B89          	BS                  T2CR,T2IE        ; Enable Timier2
   348 00279 09C9          	BC                  T2CR,T2IF        ; Clear timer1 intrrupt flag
   349 0027A 1E02          	BANK                2
   350 0027B 1840          	MOV                 A,@0B01000000    ; N=25, P=2, T=50us
   351 0027C 0249          	OR                  T2CR,A
   352 0027D 1832          	MOV                 A,@50            ; N=25, Auto reload
   353 0027E 004A          	MOV                 T2PD,A
   354 0027F 08C6          	BC                  TSR,T2CSS       ; Set Timer2 Clock Source(Fm)
   355 00280 09C6          	BC                  TSR,T1MOD       ; Set 8 Bit Timer
   356 00281 0949          	BC                  T2CR,T2EN       ; Disable
   357                     
   358                     ;==============================PORT A/B======================================
   359 00282 1E04          	BANK                4		        ; Power On Disable PA PB Pull High
   360 00283 1810          	MOV                 A,@00010000B	; Set PA4 (MISO) as input pin
   361 00284 004A          	MOV                 PAIOCR,A       ; SO,SCK output pin
   362 00285 1810          	MOV                 A,@00010000B    ; PA4 PULL HIGH
   363 00286 004A          	MOV                 PAPHCR,A
   364 00287 1837          	MOV                 A,@00110111B	; PB0 PB1 PB2 PB4 PB5 PB1AS INPUT
   365 00288 004B          	MOV                 PBIOCR,A       	; PKT FIFO Output Pin
   366 00289 1E05          	BANK                5
   367 0028A 1837          	MOV                 A,@00110111B
   368 0028B 004B          	MOV                 PBPHCR,A	    	;PB0 PB2 Enable Pull High
   369 0028C 1E00          	BANK                0
   370 0028D 00CA          	CLR                 PORTA           ; PortA output logic "0"
   371                     	;CLR                 PORTB           ; PortB output logic "0"
   372                     ;---------------------------------------------------------
   373 0028E 1E02          	BANK                2
   374 0028F 1800          	MOV                 A,@00000000B   ; Shift left, SDO delay time: 16clk,
   375 00290 004C          	MOV                 SPIS, A        ; disable open-drain
   376 00291 18C9          	MOV                 A,@11001001B   ; Data shift out rising edge, is on hold during low
   377 00292 004D          	MOV                 SPIC,A         ; Enable SPI mode, after data output SDO remain low
   378                                                            ; SPI Baud Rate: 001->Fosc/4
   379                     ;==========================PORT 7/8/9 INITIAL===============================
   380 00293 1E04           	BANK                4
   381 00294 18F0           	MOV                 A,@11110000B
   382 00295 0049           	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Ouput
   383 00296 1800           	MOV                 A,@00000000B
   384 00297 0047           	MOV                 IOC7,A          ;Set Output
   385 00298 1800           	MOV                 A,@00000000B
   386 00299 0048           	MOV                 IOC8,A          ;Set Output
   387 0029A 1E05           	BANK                5
   388 0029B 18F0           	MOV                 A,@11110000B
   389 0029C 0049           	MOV                 P9PHCR,A		;SET PULL UP
   390 0029D 1E06           	BANK                6
   391 0029E 00C7           	CLR                 P7ODCR          ;Disable Open Drain
   392 0029F 00C8           	CLR                 P8ODCR
   393 002A0 00C9           	CLR                 P9ODCR
   394 002A1 1E01           	BANK                1
   395 002A2 1800           	MOV                 A,@00000000B	;Disable LCD common dirver pin
   396 002A3 02CA           	AND                 LCDSCR0,A
   397 002A4 02CB           	AND                 LCDSCR1,A
   398 002A5 02CC           	AND                 LCDSCR2,A
   399 002A6 1E00          	BANK                0
   400 002A7 00C7          	CLR                 PORT7           ; Port7 output logic "0"
   401 002A8 00C8          	CLR                 PORT8           ; Port8 output logic "0"
   402                     	;CLR                 PORT9           ; Port9 output logic "0"
   403 002A9 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   404 002AA 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   405 002AB 0012          	RET
   406                     
   407                     ;*****************************************************************
   408                     ;Function:    MCU SLEEP SET
   409                     ;Input:       None
   410                     ;Output:      None
   411                     ;*****************************************************************
   412 002AC               MCU_EnterSleep_Set:
   413 002AC 1E00          	BANK                0
   414 002AD 00CE          	CLR                 IMR               ;Disable Timier1/TCC
   415 002AE 00CF          	CLR                 ISR
   416 002AF 1E03          	BANK                3
   417 002B0 00CE          	CLR                 EIESH             ;SET Falling Edge
   418 002B1 1E01          	BANK                1
   419 002B2 1860          	MOV                 A,@0B01100000     ;Enable EX6(PB2)/EX5(PB1) Interrupt
   420 002B3 004E          	MOV                 EIMR,A
   421 002B4 00CF          	CLR                 EISR
   422 002B5 1E04          	BANK                4
   423 002B6 1860          	MOV                 A,@0B01100000
   424 002B7 004F          	MOV                 WKCR,A            ;enable EX6(PB2)/EX5(PB1) wake up
   425 002B8 08CC          	BC                  SCCR,IDLE         ;Set IDLE=0(SLEEP MODE)
   426 002B9 1E00          	BANK                0
   427 002BA 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   428 002BB 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   429 002BC 0000          	NOP
   430 002BD 0012          	RET
   431                     
   432                     ;*****************************************************************
   433                     ;Function:    MCU wakeup SET
   434                     ;Input:       None
   435                     ;Output:      None
   436                     ;*****************************************************************
   437 002BE               MCU_WakeUp_Set:
   438 002BE 1E03          	BANK                3
   439 002BF 00CE          	CLR                 EIESH             ; SET Falling Edge
   440 002C0 1E01          	BANK                1
   441 002C1 1800          	MOV                 A,@0B00000000     ; Disable EX6(PB2)/EX5(PB1) Interrupt
   442 002C2 004E          	MOV                 EIMR,A
   443 002C3 00CF          	CLR                 EISR
   444 002C4 1E04          	BANK                4
   445 002C5 1800          	MOV                 A,@0B00000000
   446 002C6 004F          	MOV                 WKCR,A            ; Disable EX6(PB2)/EX5(PB1) wake up
   447 002C7 0000          	NOP
   448 002C8 1E00          	BANK                0
   449 002C9 1881          	MOV                 A,@0B10000001
   450 002CA 004E          	MOV                 IMR,A             ; Enable Timier1/TCC
   451 002CB 00CF          	CLR                 ISR
   452 002CC 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   453 002CD 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   454 002CE 0012          	RET
   455                     
   456                     ;*****************************************************************
   457                     ;Function:    mode select
   458                     ;Input:
   459                     ;Output:      None
   460                     ;desciption:  set timing and select mode
   461                     ;*****************************************************************
   462 002CF               SearchLinkMode_Set:         ;0X11
   463 002CF 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   464 002D0 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   465 002D1 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   466 002D2 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   467 002D3 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   468 002D4 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   469 002D5 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   470 002D6 0012          	RET
   471                     
   472 002D7               SearchForceLinkMode_Set:    ;0X24
   473 002D7 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   474 002D8 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   475 002D9 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   476 002DA 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   477 002DB 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   478 002DC 0B5F          	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   479 002DD 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   480 002DE 0012          	RET
   481                     
   482 002DF               NormalLinkMode_Set:         ;0X12
   483 002DF 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   484 002E0 0A5F          	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   485 002E1 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   486 002E2 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   487 002E3 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   488 002E4 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   489 002E5 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   490 002E6 0012          	RET
   491                     
   492 002E7               LoseFrameLinkMode_Set:      ;0X16
   493 002E7 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   494 002E8 0A5F          	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   495 002E9 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   496 002EA 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   497 002EB 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   498 002EC 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   499 002ED 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   500 002EE 0012          	RET
   501                     
   502 002EF               LoseFrameForceLinkMode_Set: ;0X25
   503 002EF 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   504 002F0 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   505 002F1 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   506 002F2 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   507 002F3 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   508 002F4 0B5F          	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   509 002F5 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   510 002F6 0012          	RET
   511                     
   512 002F7               FccSearchLinkMode_Set:      ;0X41
   513 002F7 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   514 002F8 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   515 002F9 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   516 002FA 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   517 002FB 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   518 002FC 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   519 002FD 0B9F          	BS                  FccTestModeFlag/16,FccTestModeFlag%16
   520 002FE 0012          	RET
   521                     
   522                     
  0 Error(s), 10 Warning(s), 5 User Message(s)