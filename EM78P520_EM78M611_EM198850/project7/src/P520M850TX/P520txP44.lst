     1                     /*********************************************************************
     2                     * Filename     :  EM78P520P44TX.ASM
     3                     * Author       :  yu.wei
     4                     * Company      :  KEN YEAR
     5                     * VERSION      :  4.0
     6                     * CRYSTAL      :  8MHZ
     7                     * Creat date   :  2010.06.25
     8                     * tool Ver.    :  eUIDE 1.02.11
     9                     * Description  :  modify for 2.4G remote control in Intelligen Home
    10                     **********************************************************************/
    11                     ;-----------------------------------------------------------------
    12                     include "..\..\..\..\include\EM78xx\inc\EM78P520.H"
     1            C        ;******************************************************;
     2            C        ;                                                      ;
     3            C        ;  Tilte:       EM78x510xx include file                ;
     4            C        ;  Description: The Definition of EM78x510xx Registers ;
     5            C        ;  Company:     Elan Electronic Corp.                  ;
     6            C        ;  Author:      hongxi.tang                            ;
     7            C        ;  Date:        24/05/2006                             ;
     8            C        ;  Version:     v1.0                                   ;
     9            C        ;                                                      ;
    10            C        ;******************************************************;
    11            C        ;
    12            C        ;======================================================;
    13            C        ; Operational Registers Define                         ;
    14            C        ;======================================================;
    15            C        EM78P510.H    EQU    EM78P510.H
    16            C        EM78P520.H    EQU    EM78P520.H
    17            C        
    18            C        ;
    19            C        ;======================================================;
    20            C        ; Register R0~R4                                       ;
    21            C        ;======================================================;
    22            C        ;
    23            C        ; Indirect Addressing register
    24            C        ;
    25       0000 C         R0     ==    0x00
    26       0000 C         IAR    ==    0x00
    27            C        ;
    28            C        ; Time Clock/Counter
    29            C        ;
    30       0001 C         R1     ==    0x01
    31       0001 C         TCC    ==    0x01    ; TCC Counter Preset
    32            C        ;
    33            C        ; Program Counter
    34            C        ;
    35       0002 C         R2     ==    0X02
    36       0002 C         PC     ==    0X02
    37            C        ;
    38            C        ; Status Register and Voltage Detect
    39            C        ;
    40       0003 C         R3    ==    0X03
    41       0003 C         SR    ==    0X03
    42       0003 C         STATUS	==	0x03
    43            C        ;
    44            C             ;{
    45       0007 C             	 LVDEN	==    0x07    ; Voltage Detect Enable Bit
    46       0006 C                 LVDS1	==    0x06    ; Detect Voltage Select Bit[1]
    47       0005 C                 LVDS0	==    0x05    ; Detect Voltage Select Bit[0]
    48            C                                       ;
    49            C                                       ; |-------|-------|----------------|
    50            C                                       ; | LVDS1 | LVDS0 | Detect Voltage |
    51            C                                       ; |-------|-------|----------------|
    52            C                                       ; |   0   |   0   |      2.4V      |
    53            C                                       ; |   0   |   1   |      2.7V      |
    54            C                                       ; |   1   |   0   |      3.3V      |
    55            C                                       ; |   1   |   1   |      3.9V      |
    56            C                                       ; |-------|-------|----------------|
    57            C                                       ;
    58       0004 C                 T       ==    0x04    ; Time-Out Bit
    59       0003 C                 P       ==    0x03    ; Power Down Bit
    60       0002 C                 Z       ==    0x02    ; Zero Flag
    61       0001 C                 DC      ==    0x01    ; Auxiliary Carry Flag
    62       0000 C                 C       ==    0x00    ; Carry Flag
    63            C                                       ;
    64            C             ;}
    65            C        ;
    66            C        ; RAM Select Register (RSR)
    67            C        ;
    68       0004 C         R4     ==    0X04
    69       0004 C         RSR    ==    0X04
    70            C             ;{
    71            C                                        ; Bits 5~0 are used to select up to 64 registers in the
    72            C                                        ; indirect addressing mode.
    73            C                                        ;
    74       0007 C                 VDB	  ==    0x07    ; Voltage Detector
    75       0006 C                 BNC      ==    0x06    ; Bank Control Register
    76            C                                        ;
    77       0005 C                 RSR5     ==    0x05    ;
    78       0004 C                 RSR4     ==    0x04    ;
    79       0003 C                 RSR3     ==    0x03    ;
    80       0002 C                 RSR2     ==    0x02    ;
    81       0001 C                 RSR1     ==    0x01    ;
    82       0000 C                 RSR0     ==    0x00    ;
    83            C                                        ;
    84            C             ;}
    85            C        ;======================================================;
    86            C        ; Bank0~6 Register R5~RF                               ;
    87            C        ;======================================================;
    88            C        ;
    89            C        ; Bank0 R5(RAM Bank Select Register)
    90            C        ;
    91       0005 C         B0_R5    ==	0X05
    92       0005 C         BSR      ==    0X05
    93            C        ;
    94            C             ;{
    95            C             				    ; Bit3~7 is "0"
    96       0002 C                 BS2          ==    0x02    ; RAM Bank Select Register Bits[2]
    97       0001 C                 BS1          ==    0x01    ; RAM Bank Select Register Bits[1]
    98       0000 C                 BS0          ==    0x00    ; RAM Bank Select Register Bits[0]
    99            C             ;}
   100            C        ;
   101            C        ; Bank 0 R6(Program Page Select Register)
   102            C        ;
   103       0006 C         B0_R6    ==    0X06
   104       0006 C         PSR      ==    0X06
   105            C        ;
   106            C             ;{
   107            C             			       ; Bit3~7 is "0"
   108       0002 C                 PS2     ==    0x02    ; Program Page Select Register Bits[2]
   109       0001 C                 PS1     ==    0x01    ; Program Page Select Register Bits[1]
   110       0000 C                 PS0     ==    0x00    ; Program Page Select Register Bits[0]
   111            C             ;}
   112            C        ;
   113            C        ; Bank0 R7(Port 7 data Register)
   114            C        ;
   115       0007 C         B0_R7    ==    0X07
   116       0007 C         PORT7    ==    0X07
   117            C        ;
   118            C             ;{
   119       0007 C                 R77     ==    0x07    ; I/O data of P7.7
   120       0006 C                 R76     ==    0x06    ; I/O data of P7.6
   121       0005 C                 R75     ==    0x05    ; I/O data of P7.5
   122       0004 C                 R74     ==    0x04    ; I/O data of P7.4
   123       0003 C                 R73     ==    0x03    ; I/O data of P7.3
   124       0002 C                 R72     ==    0x02    ; I/O data of P7.2
   125       0001 C                 R71     ==    0x01    ; I/O data of P7.1
   126       0000 C                 R70     ==    0x00    ; I/O data of P7.0
   127            C             ;}
   128            C        ;
   129            C        ; Bank0 R8(Port 8 data Register)
   130            C        ;
   131       0008 C         B0_R8    ==    0X08
   132       0008 C         PORT8    ==    0X08
   133            C        ;
   134            C             ;{
   135       0007 C                 R87     ==    0x07    ; I/O data of P8.7
   136       0006 C                 R86     ==    0x06    ; I/O data of P8.6
   137       0005 C                 R85     ==    0x05    ; I/O data of P8.5
   138       0004 C                 R84     ==    0x04    ; I/O data of P8.4
   139       0003 C                 R83     ==    0x03    ; I/O data of P8.3
   140       0002 C                 R82     ==    0x02    ; I/O data of P8.2
   141       0001 C                 R81     ==    0x01    ; I/O data of P8.1
   142       0000 C                 R80     ==    0x00    ; I/O data of P8.0
   143            C             ;}
   144            C        ;
   145            C        ; Bank0 R9(PORT 9 Data Register)
   146            C        ;
   147       0009 C         B0_R9    ==    0X09
   148       0009 C         PORT9    ==    0X09
   149            C        ;
   150            C             ;{
   151       0007 C                 R97     ==    0x07    ; I/O data of P9.7
   152       0006 C                 R96     ==    0x06    ; I/O data of P9.6
   153       0005 C                 R95     ==    0x05    ; I/O data of P9.5
   154       0004 C                 R94     ==    0x04    ; I/O data of P9.4
   155       0003 C                 R93     ==    0x03    ; I/O data of P9.3
   156       0002 C                 R92     ==    0x02    ; I/O data of P9.2
   157       0001 C                 R91     ==    0x01    ; I/O data of P9.1
   158       0000 C                 R90     ==    0X00    ; I/O data of P9.0
   159            C             ;}
   160            C        ;
   161            C        ;  Bank0 RA(PORTA Data Register)
   162            C        ;
   163       000A C         B0_RA	  ==	0X0A
   164       000A C         PORTA	  ==	0X0A
   165            C        ;
   166            C        	;{
   167       0007 C        		RA7	==	0X07	; I/O Data of PA.7
   168       0006 C        		RA6	==	0X06 	; I/O Data of PA.6
   169       0005 C        		RA5	==	0X05	; I/O Data of PA.5
   170       0004 C        		RA4	==	0X04	; I/O Data of PA.4
   171       0003 C        		RA3	==	0X03	; I/O Data of PA.3
   172       0002 C        		RA2	==	0X02	; I/O Data of PA.2
   173       0001 C        		RA1	==	0X01	; I/O Data of PA.1
   174       0000 C        		RA0	==	0X00	; I/O Data of PA.0
   175            C        	;}
   176            C        ;
   177            C        ;  Bank0 RB(PORT8 Data Register)
   178            C        ;
   179       000B C         B0_RB	==	0X0B
   180       000B C         PORTB	==	0X0B
   181            C        ;
   182            C        	;{
   183       0007 C        		RB7	==	0X07	; I/O Data of PB.7
   184       0006 C        		RB6	==	0X06 	; I/O Data of PB.6
   185       0005 C        		RB5	==	0X05	; I/O Data of PB.5
   186       0004 C        		RB4	==	0X04	; I/O Data of PB.4
   187       0003 C        		RB3	==	0X03	; I/O Data of PB.3
   188       0002 C        		RB2	==	0X02	; I/O Data of PB.2
   189       0001 C        		RB1	==	0X01	; I/O Data of PB.1
   190       0000 C        		RB0	==	0X00	; I/O Data of PB.0
   191            C        	;}
   192            C        ;
   193            C        ;  Bank0 RC(System Clock Control Register)
   194            C        ;
   195       000C C         B0_RC	==	0X0C
   196       000C C         SCCR	==	0X0C
   197            C        ;
   198            C        	;{
   199            C        				 ; Bit7 is "0"
   200       0006 C        		CLK2	==  0X06 ;
   201       0005 C        		CLK1	==  0X05 ;
   202       0004 C        		CLK0	==  0X04 ; Main Clock Select Bit for PLL Mode
   203            C        				 ; |------|------|------|------------|---------------|
   204            C        				 ; | CLK2 | CLK1 | CLK0 | Main Clock | Ex:Fs=32.768k |
   205            C        				 ; |------|------|------|------------|---------------|
   206            C        				 ; |  0   |  0   |  0   |   Fs*122   |   3.997 MHz   |
   207            C        				 ; |------|------|------|------------|---------------|
   208            C        				 ; |  0   |  0   |  1   |    Fs*61   |   1.998 MHz   |
   209            C        				 ; |------|------|------|------------|---------------|
   210            C        				 ; |  0   |  1   |  0   |   Fs*61/2  |   0.999 MHz   |
   211            C        				 ; |------|------|------|------------|---------------|
   212            C        				 ; |  0   |  1   |  1   |   Fs*61/4  |   499.7 kHz   |
   213            C        				 ; |------|------|------|------------|---------------|
   214            C        				 ; |  1   |  0   |  0   |   Fs*244   |   7.995 MHz   |
   215            C        				 ; |------|------|------|------------|---------------|
   216            C        				 ; |  1   |  0   |  1   |   Fs*366   |   11.99 MHz   |
   217            C        				 ; |------|------|------|------------|---------------|
   218            C        				 ; |  1   |  1   |  X   |   Fs*488   |   15.99 MHz   |
   219            C        				 ; |------|------|------|------------|---------------|
   220       0003 C        		IDLE	==  0X03 ; Idle Mode Enable Bit.
   221            C        		 		 ; IDLE="0"+SLEP instruction=>sleep mode
   222            C        		 		 ; IDLE="1"+SLEP instruction=>idle mode
   223       0002 C        		BF1	==  0x02 ;
   224       0001 C        		BF0	==  0x01 ; LCD Booster Frequency Select Bit.
   225            C        				 ; |-----|-----|-------------------|
   226            C        				 ; | BF1 | BF0 | Booster frequency |
   227            C        				 ; |-----|-----|-------------------|
   228            C        				 ; |  0  |  0  |        Fs         |
   229            C        				 ; |-----|-----|-------------------|
   230            C        				 ; |  0  |  1  |       Fs/4        |
   231            C        				 ; |-----|-----|-------------------|
   232            C        				 ; |  1  |  0  |       Fs/8        |
   233            C        				 ; |-----|-----|-------------------|
   234            C        				 ; |  1  |  1  |       Fs/16       |
   235            C        				 ; |-----|-----|-------------------|
   236       0000 C        		CPUS	==  0x00 ; CPU Oscillator Source Select.
   237            C        				 ; 0/1=>sub-oscillator(fs)/main oscillator(fm)
   238            C        	;}
   239            C        ;
   240            C        ; Bank0 RD(TCC and WDT Timer control register)
   241            C        ;
   242       000D C         B0_RD	==	0X0D
   243       000D C         TWTCR	==	0X0D
   244            C        ;
   245            C        	;{
   246       0007 C        		WDTE	==  0X07 ; Watchdog Timer Enable.0/1=>disable/enable
   247       0006 C        		WPSR2	==  0X06
   248       0005 C        		WPSR1	==  0X05
   249       0004 C        		WPSR0	==  0X04 ; WDT Prescaler Bits
   250            C        				 ; |-----|-----|-----|-----------|
   251            C        				 ; |WPSR2|WPSR1|WPSR0| Prescaler |
   252            C        				 ; |-----|-----|-----|-----------|
   253            C        				 ; |  0  |  0  |  0  |    1:1    |
   254            C        				 ; |-----|-----|-----|-----------|
   255            C        				 ; |  0  |  0  |  1  |    1:2    |
   256            C        				 ; |-----|-----|-----|-----------|
   257            C        				 ; |  0  |  1  |  0  |    1:4    |
   258            C        				 ; |-----|-----|-----|-----------|
   259            C        				 ; |  0  |  1  |  1  |    1:8    |
   260            C        				 ; |-----|-----|-----|-----------|
   261            C        				 ; |  1  |  0  |  0  |   1:16    |
   262            C        				 ; |-----|-----|-----|-----------|
   263            C        				 ; |  1  |  0  |  1  |   1:32    |
   264            C        				 ; |-----|-----|-----|-----------|
   265            C        				 ; |  1  |  1  |  0  |   1:64    |
   266            C        				 ; |-----|-----|-----|-----------|
   267            C        				 ; |  1  |  1  |  1  |   1:128   |
   268            C        				 ; |-----|-----|-----|-----------|
   269       0003 C        		TCCS	==  0x03 ; TCC Clock Source Select Bit.0/1=>Fm/Fs
   270       0002 C        		TPSR2	==  0x02
   271       0001 C        		TPSR1	==  0X01
   272       0000 C        		TPSR0	==  0X00 ; TCC Prescaler Bits
   273            C        				 ; |-----|-----|-----|-----------|
   274            C        				 ; |TPSR2|TPSR1|TPSR0| Prescaler |
   275            C        				 ; |-----|-----|-----|-----------|
   276            C        				 ; |  0  |  0  |  0  |    1:2    |
   277            C        				 ; |-----|-----|-----|-----------|
   278            C        				 ; |  0  |  0  |  1  |    1:4    |
   279            C        				 ; |-----|-----|-----|-----------|
   280            C        				 ; |  0  |  1  |  0  |    1:8    |
   281            C        				 ; |-----|-----|-----|-----------|
   282            C        				 ; |  0  |  1  |  1  |   1:16    |
   283            C        				 ; |-----|-----|-----|-----------|
   284            C        				 ; |  1  |  0  |  0  |   1:32    |
   285            C        				 ; |-----|-----|-----|-----------|
   286            C        				 ; |  1  |  0  |  1  |   1:64    |
   287            C        				 ; |-----|-----|-----|-----------|
   288            C        				 ; |  1  |  1  |  0  |   1:128   |
   289            C        				 ; |-----|-----|-----|-----------|
   290            C        				 ; |  1  |  1  |  1  |   1:256   |
   291            C        				 ; |-----|-----|-----|-----------|
   292            C        	;}
   293            C        ;
   294            C        ; Bank0 RE (Interrupt Mask Register)
   295            C        ;
   296       000E C         B0_RE	==	0X0E
   297       000E C         RE	==	0X0E							;ADD
   298       000E C         IMR	==	0X0E
   299            C        ;
   300            C        	;{
   301       0007 C        		T1IE	==  0X07 ; Timer1 Interrupt Enable Bit
   302       0006 C        		LVDIE   ==  0X06 ; low Voltage Detect Interrupt Enable Bit
   303       0005 C        		ADIE	==  0X05 ; A/D convert Interrupt Enable Bit
   304       0004 C        		SPIE    ==  0X04 ; SPI transfer Interrupt Enable Bit
   305       0003 C        		URTIE	==  0X03 ; UART transmit Interrupt Enable Bit
   306       0002 C        		EXIE9	==  0X02 ; External interrupt 9 Enable Bit
   307       0001 C        		EXIE8	==  0X01 ; External interrupt 8 Enable Bit
   308       0000 C        		TCIE	==  0X00 ; TCC Overflow Interrupt Enable Bit
   309            C        	;}
   310            C        ;
   311            C        ;  Bank0 RF (Interrupt Status Register)
   312            C        ;
   313       000F C         B0_RF	==	0X0F
   314       000F C         RF     ==  0x0F
   315       000F C         ISR	==	0X0F
   316            C        ;
   317            C        	;{
   318       0007 C        		T1IF	==  0X07 ; interrupt flag of timer1 interrupt
   319       0006 C        		LVDIF	==  0X06 ; interrupt flag of low voltage detector interrupt
   320       0005 C        		ADIF	==  0X05 ; interrupt flag of A/D convert Complete
   321       0004 C        		SPIF	==  0X04 ; interrupt flag of SPI transfer complete
   322       0003 C        		URTIF	==  0X03 ; interrupt flag of UART transfer complete
   323       0002 C        		EXIF9	==  0X02 ; interrupt flag of external interrupt 9 Occur.
   324       0001 C        		EXIF8	==  0X01 ; interrupt flag of external interrupt 8 Occur.
   325       0000 C        		TCIF	==  0X00 ; interrupt flag of TCC Overflow
   326            C        	;}
   327            C        ;
   328            C        ;  Bank1 R5 (LCD Control Register)
   329            C        ;
   330       0005 C         B1_R5	==	0X05
   331       0005 C         LCDCR	==	0X05
   332            C        ;
   333            C        	;{
   334       0007 C        		LCDEN	==  0X07 ; lCD Enable Select Bit.0/1=>disable/enable
   335       0006 C        		LCDTYPE	==  0X06 ; LCD Drive Waveform Type Select Bit
   336       0005 C        		LBS1	==  0x05
   337       0004 C        		LBS0	==  0x04 ; LCD Bias Select Bits
   338            C        				 ; |---|---|---------------|
   339            C        				 ; |BS1|BS0|LCD Bias Select|
   340            C        				 ; |---|---|---------------|
   341            C        				 ; | 0 | 0 |   1/2 Bias    |
   342            C        				 ; |---|---|---------------|
   343            C        				 ; | 0 | 1 |   1/3 Bias    |
   344            C        				 ; |---|---|---------------|
   345            C        				 ; | 1 | X |   1/4 Bias    |
   346            C        				 ; |---|---|---------------|
   347       0003 C        		DS1	==  0x03
   348       0002 C        		DS0	==  0x02 ; LCD Duty Select Bits
   349            C        				 ; |---|---|---------------|
   350            C        				 ; |DS1|DS0|LCD Duty Select|
   351            C        				 ; |---|---|---------------|
   352            C        				 ; | 0 | 0 |    Static     |
   353            C        				 ; |---|---|---------------|
   354            C        				 ; | 0 | 1 |   1/3 Duty    |
   355            C        				 ; |---|---|---------------|
   356            C        				 ; | 1 | 0 |   1/4 Duty    |
   357            C        				 ; |---|---|---------------|
   358            C        				 ; | 1 | 1 |   1/8 Duty    |
   359            C        				 ; |---|---|---------------|
   360       0001 C        		LCDF1	==  0x01 ;
   361       0000 C        		LCDF0	==  0x00 ; LCD Frame Frequency Control Bits
   362            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   363            C        				 ; |LCDF1|LCDF0|     Static    |    1/3 Duty   |    1/4 Duty   |   1/8 Duty   |
   364            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   365            C        				 ; |  0  |  0  |Fs/(512*1)=64.0|Fs/(172*3)=63.5|Fs/(128*4)=64.0|Fs/(64*8)=64.0|
   366            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   367            C        				 ; |  0  |  1  |Fs/(560*1)=58.5|Fs/(188*3)=58.0|Fs/(140*4)=58.5|Fs/(70*8)=58.5|
   368            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   369            C        				 ; |  1  |  0  |Fs/(608*1)=53.9|Fs/(204*3)=53.5|Fs/(152*4)=53.9|Fs/(76*8)=53.9|
   370            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   371            C        				 ; |  1  |  1  |Fs/(464*1)=70.6|Fs/(156*3)=70.0|Fs/(116*4)=70.6|Fs/(58*8)=70.6|
   372            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   373            C        	;}
   374            C        ;
   375            C        ;  Bank1 R6 (LCD Address Register)
   376            C        ;
   377       0006 C         B1_R6	==    0X06
   378       0006 C         LCDAR	==    0X06
   379            C        ;
   380            C        	;{
   381            C        				 ; Bit5~7 is "0"
   382       0004 C        		LCD_A4	==  0x04 ; LCD RAM Address:00H~16H
   383       0003 C        		LCD_A3	==  0x03
   384       0002 C        		LCD_A2  ==  0x02
   385       0001 C        		LCD_A1	==  0x01
   386       0000 C        		LCD_A0	==  0x00
   387            C        	;}
   388            C        ;
   389            C        ; Bank1 R7 (LCD Data Buffer)
   390            C        ;
   391       0007 C         B1_R7	==    0X07
   392       0007 C         LCDBR	==    0X07
   393            C        ;
   394            C        	;{
   395       0007 C        		LCD_D7	==  0x07
   396       0006 C        		LCD_D6	==  0x06
   397       0005 C        		LCD_D5	==  0x05
   398       0004 C        		LCD_D4	==  0x04
   399       0003 C        		LCD_D3	==  0x03
   400       0002 C        		LCD_D2	==  0x02
   401       0001 C        		LCD_D1	==  0x01
   402       0000 C        		LCD_D0	==  0x00
   403            C        	;}
   404            C        ;
   405            C        ;  Bank1 R8 (LCD Voltage Control Register)
   406            C        ;
   407       0008 C         B1_R8	==	0x08
   408       0008 C         LCDVCR	==	0x08
   409            C        ;
   410            C        	;{
   411            C        				 ; Bit5~6 is "0"
   412       0004 C        		LCDC1	==  0x04
   413       0003 C        		LCDC0	==  0x03 ; LCD Clock
   414            C        				 ; |-----|-----|------|--------|
   415            C        				 ; |LCDC1|LCDC0|  Fm  |  Flcd  |
   416            C        				 ; |-----|-----|------|--------|
   417            C        				 ; |  0  |  0  | 16M  | Fc/2^9 |
   418            C        				 ; |-----|-----|------|--------|
   419            C        				 ; |  0  |  1  |  8M  | Fc/2^8 |
   420            C        				 ; |-----|-----|------|--------|
   421            C        				 ; |  1  |  0  |  4M  | Fc/2^7 |
   422            C        				 ; |-----|-----|------|--------|
   423            C        				 ; |  1  |  1  |  2M  | Fc/2^6 |
   424            C        				 ; |-----|-----|------|--------|
   425       0002 C        		LCDVC2	==  0x02
   426       0001 C        		LCDVC1	==  0x01
   427       0000 C        		LCDVC0	==  0x00 ; LCD Voltage Control Bits
   428            C        				 ; |------|------|------|--------------|
   429            C        				 ; |LCDVC2|LCDVC1|LCDVC0|    Output    |
   430            C        				 ; |------|------|------|--------------|
   431            C        				 ; |   0  |   0  |   0  |  0.4VDD~VDD  |
   432            C        				 ; |------|------|------|--------------|
   433            C        				 ; |   0  |   0  |   1  | 0.34VDD~VDD  |
   434            C        				 ; |------|------|------|--------------|
   435            C        				 ; |   0  |   1  |   0  | 0.26VDD~VDD  |
   436            C        				 ; |------|------|------|--------------|
   437            C        				 ; |   0  |   1  |   1  | 0.18VDD~VDD  |
   438            C        				 ; |------|------|------|--------------|
   439            C        				 ; |   1  |   0  |   0  | 0.13VDD~VDD  |
   440            C        				 ; |------|------|------|--------------|
   441            C        				 ; |   1  |   0  |   1  | 0.07VDD~VDD  |
   442            C        				 ; |------|------|------|--------------|
   443            C        				 ; |   1  |   1  |   0  | 0.04VDD~VDD  |
   444            C        				 ; |------|------|------|--------------|
   445            C        				 ; |   1  |   1  |   1  |    0V~VDD    |
   446            C        				 ; |------|------|------|--------------|
   447            C        	;}
   448            C        ;
   449            C        ;  Bank1 R9 (LCD Com Control Register)
   450            C        ;
   451       0009 C         B1_R9	==	0x09
   452       0009 C         LCDCCR	==	0x09
   453            C        ;
   454            C        	;{
   455       0007 C        		COM7	==  0x07 ; 0:I/O Function,1:LCD common driver pin.
   456       0006 C        		COM6	==  0x06
   457       0005 C        		COM5	==  0x05
   458       0004 C        		COM4	==  0x04
   459       0003 C        		COM3	==  0x03
   460       0002 C        		COM2	==  0x02
   461       0001 C        		COM1	==  0x01
   462       0000 C        		COM0	==  0x00
   463            C        	;}
   464            C        ;
   465            C        ;  Bank1 RA (LCD Segment Control Register0)
   466            C        ;
   467       000A C         B1_RA		==	0X0A
   468       000A C         LCDSCR0	==	0X0A
   469            C        ;
   470            C        	;{
   471       0007 C        		SEG7	==  0X07 ; LCD Segment7 Control Bit.0:I/O,1:LCD Driver pin.
   472       0006 C        		SEG6	==  0X06 ; LCD Segment6 Control Bit.0:I/O,1:LCD Driver pin.
   473       0005 C        		SEG5	==  0X05 ; LCD Segment5 Control Bit.0:I/O,1:LCD Driver pin.
   474       0004 C        		SEG4	==  0X04 ; LCD Segment4 Control Bit.0:I/O,1:LCD Driver pin.
   475       0003 C        		SEG3	==  0X03 ; LCD Segment3 Control Bit.0:I/O,1:LCD Driver pin.
   476       0002 C        		SEG2	==  0X02 ; LCD Segment2 Control Bit.0:I/O,1:LCD Driver pin.
   477       0001 C        		SEG1	==  0X01 ; LCD Segment1 Control Bit.0:I/O,1:LCD Driver pin.
   478       0000 C        		SEG0	==  0X00 ; LCD Segment0 Control Bit.0:I/O,1:LCD Driver pin.
   479            C        	;}
   480            C        ;
   481            C        ;  Bank1 RB (LCD Segment Control Register1)
   482            C        ;
   483       000B C         B1_RB		==	0X0B
   484       000B C         LCDSCR1	==	0X0B
   485            C        ;
   486            C        	;{
   487       0007 C        		SEG15	==  0X07 ; LCD Segment15 Control Bit.0:I/O,1:LCD Driver pin.
   488       0006 C        		SEG14	==  0X06 ; LCD Segment14 Control Bit.0:I/O,1:LCD Driver pin.
   489       0005 C        		SEG13	==  0X05 ; LCD Segment13 Control Bit.0:I/O,1:LCD Driver pin.
   490       0004 C        		SEG12	==  0X04 ; LCD Segment12 Control Bit.0:I/O,1:LCD Driver pin.
   491       0003 C        		SEG11	==  0X03 ; LCD Segment11 Control Bit.0:I/O,1:LCD Driver pin.
   492       0002 C        		SEG10	==  0X02 ; LCD Segment10 Control Bit.0:I/O,1:LCD Driver pin.
   493       0001 C        		SEG9	==  0X01 ; LCD Segment9 Control Bit.0:I/O,1:LCD Driver pin.
   494       0000 C        		SEG8	==  0X00 ; LCD Segment8 Control Bit.0:I/O,1:LCD Driver pin.
   495            C        	;}
   496            C        ;
   497            C        ;  Bank1 RC (LCD Segment Control Register2)
   498            C        ;
   499       000C C         B1_RC		==	0X0C
   500       000C C         LCDSCR2	==	0X0C
   501            C        ;
   502            C        	;{
   503            C        				 ; Bit7 not used
   504       0006 C        		SEG22	==  0X06 ; LCD Segment22 Control Bit.0:I/O,1:LCD Driver pin.
   505       0005 C        		SEG21	==  0X05 ; LCD Segment21 Control Bit.0:I/O,1:LCD Driver pin.
   506       0004 C        		SEG20	==  0X04 ; LCD Segment20 Control Bit.0:I/O,1:LCD Driver pin.
   507       0003 C        		SEG19	==  0X03 ; LCD Segment19 Control Bit.0:I/O,1:LCD Driver pin.
   508       0002 C        		SEG18	==  0X02 ; LCD Segment18 Control Bit.0:I/O,1:LCD Driver pin.
   509       0001 C        		SEG17	==  0X01 ; LCD Segment17 Control Bit.0:I/O,1:LCD Driver pin.
   510       0000 C        		SEG16	==  0X00 ; LCD Segment16 Control Bit.0:I/O,1:LCD Driver pin.
   511            C        	;}
   512            C        ;
   513            C        ;  Bank1 RE (External Interrupt Mask Register)
   514            C        ;
   515       000E C         B1_RE	==	0X0E
   516       000E C         EIMR	==	0X0E
   517            C        ;
   518            C        	;{
   519       0007 C        		EXIE7	==  0x07 ; /INT7 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   520       0006 C        		EXIE6	==  0x06 ; /INT6 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   521       0005 C        		EXIE5	==  0x05 ; /INT5 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   522       0004 C        		EXIE4	==  0x04 ; /INT4 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   523       0003 C        		EXIE3	==  0x03 ; /INT3 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   524       0002 C        		EXIE2	==  0x02 ; /INT2 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   525       0001 C        		EXIE1	==  0x01 ; /INT1 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   526       0000 C        		EXIE0	==  0x00 ; /INT0 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   527            C        	;}
   528            C        ;
   529            C        ;  Bank1 RF (External Interrupt Status Register)
   530            C        ;
   531       000F C         B1_RF	==	0X0F
   532       000F C         EISR	==	0X0F
   533            C        ;
   534            C        	;{
   535       0007 C        		EXIF7	==  0x07 ; /INT7 Interrupt Flag Bit.
   536       0006 C        		EXIF6	==  0x06 ; /INT6 Interrupt Flag Bit.
   537       0005 C        		EXIF5	==  0x05 ; /INT5 Interrupt Flag Bit.
   538       0004 C        		EXIF4	==  0x04 ; /INT4 Interrupt Flag Bit.
   539       0003 C        		EXIF3	==  0x03 ; /INT3 Interrupt Flag Bit.
   540       0002 C        		EXIF2	==  0x02 ; /INT2 Interrupt Flag Bit.
   541       0001 C        		EXIF1	==  0x01 ; /INT1 Interrupt Flag Bit.
   542       0000 C        		EXIF0	==  0x00 ; /INT0 Interrupt Flag Bit.
   543            C        	;}
   544            C        ;
   545            C        ;  Bank2 R5 (Timer1 Control Register)
   546            C        ;
   547       0005 C         B2_R5	==	0X05
   548       0005 C         T1CR	==	0X05
   549            C        ;
   550            C        	;{
   551       0007 C        		T1S1	==  0x07
   552       0006 C        		T1S0	==  0x06 ; Timer1 and Timer2 Interrupt Type Select Bits.
   553            C        				 ; |----|----|---------------------------------------|
   554            C        				 ; |T1S1|T1S0|Timer1 and Timer2 Interrupt Type Select|
   555            C        				 ; |----|----|---------------------------------------|
   556            C        				 ; |  0 |  0 |           T1PD underflow              |
   557            C        				 ; |----|----|---------------------------------------|
   558            C        				 ; |  0 |  1 |           T1TD underflow              |
   559            C        				 ; |----|----|---------------------------------------|
   560            C        				 ; |  1 |  X |      T1PD and T1TD underflow          |
   561            C        				 ; |----|----|---------------------------------------|
   562       0005 C        		T1MS2	==  0x05
   563       0004 C        		T1MS1	==  0x04
   564       0003 C        		T1MS0	==  0x03 ; Timer1 Operation Mode Select Bits
   565            C        				 ; |-----|-----|-----|-------------------------|
   566            C        				 ; |T1MS2|T1MS1|T1MS0|   Timer1 Mode Select    |
   567            C        				 ; |-----|-----|-----|-------------------------|
   568            C        				 ; |  0  |  0  |  0  |         Timer1          |
   569            C        				 ; |-----|-----|-----|-------------------------|
   570            C        				 ; |  0  |  0  |  1  |        T1OUT Mode       |
   571            C        				 ; |-----|-----|-----|-------------------------|
   572            C        				 ; |  0  |  1  |  0  |Capture Mode Rising Edge |
   573            C        				 ; |-----|-----|-----|-------------------------|
   574            C        				 ; |  0  |  1  |  1  |Capture Mode Falling Edge|
   575            C        				 ; |-----|-----|-----|-------------------------|
   576            C        				 ; |  1  |  0  |  0  |UART Baud Rate Generator |
   577            C        				 ; |-----|-----|-----|-------------------------|
   578            C        				 ; |  1  |  0  |  1  |                         |
   579            C        				 ; |-----|-----|-----|                         |
   580            C        				 ; |  1  |  1  |  0  |          PWM1           |
   581            C        				 ; |-----|-----|-----|                         |
   582            C        				 ; |  1  |  1  |  1  |                         |
   583            C        				 ; |-----|-----|-----|-------------------------|
   584       0002 C        		T1P2	==  0x02
   585       0001 C        		T1P1	==  0x01
   586       0000 C        		T1P0	==  0x00 ; Timer1 Prescaler Bits
   587            C        				 ; |-----|-----|-----|-----------------|
   588            C        				 ; | T1P2| T1P1| T1P0|   Prescalaer    |
   589            C        				 ; |-----|-----|-----|-----------------|
   590            C        				 ; |  0  |  0  |  0  |      1:2        |
   591            C        				 ; |-----|-----|-----|-----------------|
   592            C        				 ; |  0  |  0  |  1  |      1:4        |
   593            C        				 ; |-----|-----|-----|-----------------|
   594            C        				 ; |  0  |  1  |  0  |	    1:8        |
   595            C        				 ; |-----|-----|-----|-----------------|
   596            C        				 ; |  0  |  1  |  1  |      1:16       |
   597            C        				 ; |-----|-----|-----|-----------------|
   598            C        				 ; |  1  |  0  |  0  |      1:32       |
   599            C        				 ; |-----|-----|-----|-----------------|
   600            C        				 ; |  1  |  0  |  1  |      1:64       |
   601            C        				 ; |-----|-----|-----|-----------------|                         |
   602            C        				 ; |  1  |  1  |  0  |      1:128      |
   603            C        				 ; |-----|-----|-----|-----------------|
   604            C        				 ; |  1  |  1  |  1  |      1:256      |
   605            C        				 ; |-----|-----|-----|-----------------|
   606            C        	;}
   607            C        ;
   608            C        ;  Bank2 R6 (Timer Status Register)
   609            C        ;
   610       0006 C         B2_R6	==	0X06
   611       0006 C         TSR	==	0X06
   612            C        ;
   613            C        	;{
   614       0007 C        		T1MOD	==  0X07 ; Timer Operates Mode Select Bit.
   615       0006 C        		TRCB	==  0x06 ; Timer1,2 Read Control Bit.
   616       0005 C        		T1CSS1	==  0x05 ;
   617       0004 C        		T1CSS0	==  0x04 ; Timer1 Clock Source Select Bits
   618            C        				 ; |------|------|--------------------------|
   619            C        				 ; |T1CSS1|T1CSS0|Timer1 Clock Source select|
   620            C        				 ; |------|------|--------------------------|
   621            C        				 ; |  0   |  0   |            Fm            |
   622            C        				 ; |------|------|--------------------------|
   623            C        				 ; |  0   |  1   |            Fs            |
   624            C        				 ; |------|------|--------------------------|
   625            C        				 ; |  1   |  X   |           T1CK           |
   626            C        				 ; |------|------|--------------------------|
   627       0003 C        		T2CSS	==  0x03 ; Timer2 Clock Source Select Bit.0/1=>Fm/Fs.
   628       0002 C        		T1EN	==  0x02 ; Timer1 Start Bit.
   629       0001 C        		T1OMS	==  0x01 ; Timer1 Output Mode Select Bit.0/1=>repeating/on-shot.
   630       0000 C        		T1OC	==  0x00 ; Timer1 Output Flip-Flop Control Bit.
   631            C        	;}
   632            C        ;
   633            C        ;  Bank2 R7 (Timer1 Period Buffer)
   634            C        ;
   635       0007 C         B2_R7	==	0X07
   636       0007 C         T1PD	==	0X07
   637            C        ;
   638            C        ;  Bank2 R8 (Timer1 Duty Buffer)
   639            C        ;
   640       0008 C         B2_R8	==	0X08
   641       0008 C         T1TD	==	0X08
   642            C        ;
   643            C        ;  Bank2 R9 (Timer2 Control Register)
   644            C        ;
   645       0009 C         B2_R9	==	0X09
   646       0009 C         T2CR	==	0X09
   647            C        ;
   648            C        	;{
   649       0007 C        		T2IF	==  0X07 ; Interrupt Flag of Timer2 Interrupt
   650       0006 C        		T2IE	==  0X06 ; Timer2 Interrupt Mask Bit
   651       0005 C        		T2EN	==  0X05 ; Timer2 Start Bit
   652       0005 C        		T2S     ==  0x05 ;
   653       0004 C        		T2MS1	==  0X04 ;
   654       0003 C        		T2MS0	==  0X03 ; Timer2 Operation Mode Select Bits.
   655            C        				 ; |-----|-----|-----------------------|
   656            C        				 ; |T2MS1|T2MS0|   Timer2 Mode Select  |
   657            C        				 ; |-----|-----|-----------------------|
   658            C        				 ; |  0  |  0  |        Timer2         |
   659            C        				 ; |-----|-----|-----------------------|
   660            C        				 ; |  0  |  1  |SPI Baud Rate Generator|
   661            C        				 ; |-----|-----|-----------------------|
   662            C        				 ; |  1  |  0  |                       |
   663            C        				 ; |-----|-----|         PWM2          |
   664            C        				 ; |  1  |  0  |                       |
   665            C        				 ; |-----|-----|-----------------------|
   666       0002 C        		T2P2	==  0x02
   667       0001 C        		T2P1	==  0x01
   668       0000 C        		T2P0	==  0x00 ; Timer2 Prescaler Bits
   669            C        				 ; |-----|-----|-----|-----------------|
   670            C        				 ; | T2P2| T2P1| T2P0|   Prescalaer    |
   671            C        				 ; |-----|-----|-----|-----------------|
   672            C        				 ; |  0  |  0  |  0  |      1:2        |
   673            C        				 ; |-----|-----|-----|-----------------|
   674            C        				 ; |  0  |  0  |  1  |      1:4        |
   675            C        				 ; |-----|-----|-----|-----------------|
   676            C        				 ; |  0  |  1  |  0  |	    1:8        |
   677            C        				 ; |-----|-----|-----|-----------------|
   678            C        				 ; |  0  |  1  |  1  |      1:16       |
   679            C        				 ; |-----|-----|-----|-----------------|
   680            C        				 ; |  1  |  0  |  0  |      1:32       |
   681            C        				 ; |-----|-----|-----|-----------------|
   682            C        				 ; |  1  |  0  |  1  |      1:64       |
   683            C        				 ; |-----|-----|-----|-----------------|                         |
   684            C        				 ; |  1  |  1  |  0  |      1:128      |
   685            C        				 ; |-----|-----|-----|-----------------|
   686            C        				 ; |  1  |  1  |  1  |      1:256      |
   687            C        				 ; |-----|-----|-----|-----------------|
   688            C        	;}
   689            C        ;
   690            C        ;  Bank2 RA (Timer2 Period Buffer)
   691            C        ;
   692       000A C         B2_RA	==	0X0A
   693       000A C         T2PD	==	0X0A
   694            C        ;
   695            C        ; Bank2 RB (Timer Duty Buffer)
   696            C        ;
   697       000B C         B2_RB	==	0X0B
   698       000B C         T2TD	==	0X0B
   699            C        ;
   700            C        ;  Bank2 RC (SPI Status Register)
   701            C        ;
   702       000C C         B2_RC	==	0X0C
   703       000C C         SPIS	==	0X0C
   704            C        ;
   705            C        	;{
   706       0007 C        		DORD	==  0X07 ; Data Shift Control Bit.0/1=>left/right
   707       0006 C        		TD1	==  0X06 ;
   708       0005 C        		TD0	==  0X05 ; SDO Status Output Delay Times Options
   709            C        				 ; |---|---|----------|
   710            C        				 ; |TD1|TD0|Delay Time|
   711            C        				 ; |---|---|----------|
   712            C        				 ; | 0 | 0 |   8 CLK  |
   713            C        				 ; |---|---|----------|
   714            C        				 ; | 0 | 1 |  16 CLK  |
   715            C        				 ; |---|---|----------|
   716            C        				 ; | 1 | 0 |  24 CLK  |
   717            C        				 ; |---|---|----------|
   718            C        				 ; | 1 | 1 |  32 CLK  |
   719            C        				 ; |---|---|----------|
   720            C        				 ; Bit4 Reserved
   721       0003 C        		OD3	==  0X03 ; Open-Drain Control Bit
   722       0002 C        		OD4	==  0X02 ;
   723            C        				 ; Bi1 Reserved
   724       0000 C        		RIBF	==  0X00 ; Read Buffer Full Flag
   725            C        	;}
   726            C        ;
   727            C        ;  Bank2 RD (SPI Control Register)
   728            C        ;
   729       000D C         B2_RD	==	0X0D
   730       000D C         SPIC	==	0X0D
   731            C        ;
   732            C        	;{
   733       0007 C        		CES	==  0X07 ; Clock Edge Select Bit
   734       0006 C        		SPIEB	==  0X06 ; SPI Enable Bit
   735       0005 C        		SRO	==  0X05 ; SPI Read Overflow Bit
   736       0004 C        		SSE	==  0X04 ; SPI Shift Enable Bit
   737       0003 C        		SDOC	==  0X03 ; SDO Output Status Control Bit
   738       0002 C        		SBRS2	==  0X02
   739       0001 C        		SBRS1	==  0X01
   740       0000 C        		SBRS0	==  0X00 ; SPI Baud Rate Select Bits
   741            C        				 ; |-----|-----------|--------|-------------------|
   742            C        				 ; |SBRS2|SBRS1|SBRS0|  Mode  |   SPI Baud Rate   |
   743            C        				 ; |-----|-----------|--------|-------------------|
   744            C        				 ; |  0  |  0  |  0  | Master |       Fcsc/2      |
   745            C        				 ; |-----|-----------|--------|-------------------|
   746            C        				 ; |  0  |  0  |  1  | Master |       Fcsc/4      |
   747            C        				 ; |-----|-----------|--------|-------------------|
   748            C        				 ; |  0  |  1  |  0  | Master |       Fcsc/8      |
   749            C        				 ; |-----|-----------|--------|-------------------|
   750            C        				 ; |  0  |  1  |  1  | Master |      Fcsc/16      |
   751            C        				 ; |-----|-----------|--------|-------------------|
   752            C        				 ; |  1  |  0  |  0  | Master |      Fcsc/32      |
   753            C        				 ; |-----|-----------|--------|-------------------|
   754            C        				 ; |  1  |  0  |  1  | Master |       Timer2      |
   755            C        				 ; |-----|-----------|--------|-------------------|
   756            C        				 ; |  1  |  1  |  0  | Slave  |     /SS enable    |
   757            C        				 ; |-----|-----------|--------|-------------------|
   758            C        				 ; |  1  |  1  |  1  | Slave  |     /SS enable    |
   759            C        				 ; |-----|-----------|--------|-------------------|
   760            C        	;}
   761            C        ;
   762            C        ;  Bank2 RE (SPI Read Buffer)
   763            C        ;
   764       000E C         B2_RE	==	0X0E
   765       000E C         SPIR	==	0X0E
   766            C        ;
   767            C        ;  Bank2 RF (SPI Write Buffer)
   768            C        ;
   769       000F C         B2_RF	==	0X0F
   770       000F C         SPIW	==	0X0F
   771            C        ;
   772            C        ;  Bank3 R5 (UART Control Register)
   773            C        ;
   774       0005 C         B3_R5	==	0X05
   775       0005 C         URC	==	0X05
   776            C        ;
   777            C        	;{
   778       0007 C        		URTD8	==  0X07 ; Transmission Data Bit8
   779       0006 C        		UMODE1	==  0X06
   780       0005 C        		UM0DE0	==  0X05 ; UART Transmission Mode Select Bit
   781            C        				 ; |------|------|-----------|
   782            C        				 ; |UMODE1|UMODE0| UART Mode |
   783            C        				 ; |  0   |   0  |Mode1:7-Bit|
   784            C        				 ; |------|------|-----------|
   785            C        				 ; |  0   |   1  |Mode1:8-Bit|
   786            C        				 ; |------|------|-----------|
   787            C        				 ; |  1   |   0  |Mode1:9-Bit|
   788            C        				 ; |------|------|-----------|
   789            C        				 ; |  1   |   1  | Reserved  |
   790            C        				 ; |------|------|-----------|
   791       0004 C        		BRATE2	==  0X04
   792       0003 C        		BRATE1	==  0X03
   793       0002 C        		BRATE0	==  0X02 ; Transmit Baud Rate Select(Tuart=Fc/16)
   794            C        				 ; |------|------|------|-------------|-------------|
   795            C        				 ; |BRATE2|BRATE1|BRATE0|  Baud Rate  | e.g.FC=8Mhz |
   796            C        				 ; |------|------|------|-------------|-------------|
   797            C        				 ; |  0   |  0   |  0   |   Tuart/13  |    38400    |
   798            C        				 ; |------|------|------|-------------|-------------|
   799            C        				 ; |  0   |  0   |  1   |   Tuart/26  |    19200    |
   800            C        				 ; |------|------|------|-------------|-------------|
   801            C        				 ; |  0   |  1   |  0   |   Tuart/52  |     9600    |
   802            C        				 ; |------|------|------|-------------|-------------|
   803            C        				 ; |  0   |  1   |  1   |  Tuart/104  |     4800    |
   804            C        				 ; |------|------|------|-------------|-------------|
   805            C        				 ; |  1   |  0   |  0   |  Tuart/208  |     2400    |
   806            C        				 ; |------|------|------|-------------|-------------|
   807            C        				 ; |  1   |  0   |  1   |  Tuart/416  |     1200    |
   808            C        				 ; |------|------|------|---------------------------|
   809            C        				 ; |  1   |  1   |  0   |            Timer1         |
   810            C        				 ; |------|------|------|---------------------------|
   811            C        				 ; |  1   |  1   |  1   |           Reserved        |
   812            C        				 ; |------|------|------|---------------------------|
   813       0001 C        		UTBE ==  0X01
   814       0000 C        		TXE	 ==  0X00 ; Enable transmission
   815            C        	;}
   816            C        ;
   817            C        ;  Bank 3 R6 (UART Status)
   818            C        ;
   819       0006 C         B3_R6	==  0X06
   820       0006 C         URS	==  0X06
   821            C        ;
   822            C        	;{
   823       0007 C        		URRD8	==  0X07 	; Receiving Data Bit8
   824       0006 C        		EVEN	==  0X06 	; Select Parity Check
   825       0005 C        		PRE		==  0X05	; Enable Parity Check
   826       0004 C        		PRERR	==  0X04 	; Parity Error Flag
   827       0003 C        		OVERR	==  0X03 	; Over Running Error Flag
   828       0002 C        		FMERR	==  0X02 	; Framing Error Flag
   829       0001 C        		URBF	==  0X01 	; UART Read Buffer Full Flag
   830       0000 C        		RXE	==  0X00 		; Enable Receiving
   831            C        	;}
   832            C        ;
   833            C        ;  Bank3 R7 (UART_RD Data Buffer)
   834            C        ;
   835       0007 C         B3_R7	==	0X07
   836       0007 C         URRD	==	0X07
   837            C        ;
   838            C        ;  Bank3 R8 (UART_TD Data Buffer)
   839            C        ;
   840       0008 C         B3_R8	==	0X08
   841       0008 C         URTD	==	0X08
   842            C        ;
   843            C        ;  Bank3 R9 (A/D Control Register)
   844            C        ;
   845       0009 C         B3_R9	==	0X09
   846       0009 C         ADCR	==	0X09
   847            C        ;
   848            C        	;{
   849       0007 C        		ADRUN	==  0X07 ; AD Conversion Start
   850       0006 C        		ADP	==  0X06 ; A/D Power Control
   851       0005 C        		ADCK1	==  0X05
   852       0004 C        		ADCK0	==  0X04 ; A/D Input Select Bits
   853            C        				 ; |-----|-----|------------|---------------------------|
   854            C        				 ; |ADCK1|ADCK0|Clock Source|Max.Operating Frequency(Fc)|
   855            C        				 ; |-----|-----|------------|---------------------------|
   856            C        				 ; |  0	 |  0  |    Fc/4    |           1MHz            |
   857            C        				 ; |-----|-----|------------|---------------------------|
   858            C        				 ; |  0	 |  1  |   Fc/16    |           4MHz            |
   859            C        				 ; |-----|-----|------------|---------------------------|
   860            C        				 ; |  1	 |  0  |   Fc/32    |           8MHz            |
   861            C        				 ; |-----|-----|------------|---------------------------|
   862            C        				 ; |  1	 |  1  |   Fc/64    |          16MHz            |
   863            C        				 ; |-----|-----|------------|---------------------------|
   864       0003 C        		ADIS3	==  0X03
   865       0002 C        		ADIS2	==  0X02
   866       0001 C        		ADIS1	==  0X01
   867       0000 C        		ADIS0	==  0X00 ; A/D Input Select Bits
   868            C        				 ; |-----|-----|-----|----------------------|
   869            C        				 ; |ADIS3|ADIS2|ADIS1|ADIS0|Analog Input Pin|
   870            C        				 ; |-----|-----|-----|----------------------|
   871            C        				 ; |  0  |  0  |  0  |  0  |      AD0       |
   872            C        				 ; |-----|-----|-----|----------------------|
   873            C        				 ; |  0  |  0  |  0  |  1  |      AD1       |
   874            C        				 ; |-----|-----|-----|----------------------|
   875            C        				 ; |  0  |  0  |  1  |  0  |      AD2       |
   876            C        				 ; |-----|-----|-----|----------------------|
   877            C        				 ; |  0  |  0  |  1  |  1  |      AD3       |
   878            C        				 ; |-----|-----|-----|----------------------|
   879            C        				 ; |  0  |  1  |  0  |  0  |      AD4       |
   880            C        				 ; |-----|-----|-----|----------------------|
   881            C        				 ; |  0  |  1  |  0  |  1  |      AD5       |
   882            C        				 ; |-----|-----|-----|----------------------|
   883            C        				 ; |  0  |  1  |  1  |  0  |      AD6       |
   884            C        				 ; |-----|-----|-----|----------------------|
   885            C        				 ; |  0  |  1  |  1  |  1  |      AD7       |
   886            C        				 ; |-----|-----|-----|----------------------|
   887            C        				 ; |  1  |  0  |  0  |  0  |      AD8       |
   888            C        				 ; |-----|-----|-----|----------------------|
   889            C        				 ; |  1  |  0  |  0  |  1  |      AD9       |
   890            C        				 ; |-----|-----|-----|----------------------|
   891            C        				 ; |  1  |  0  |  1  |  0  |      AD10      |
   892            C        				 ; |-----|-----|-----|----------------------|
   893            C        				 ; |  1  |  0  |  1  |  1  |      AD11      |
   894            C        				 ; |-----|-----|-----|----------------------|
   895            C        	;}
   896            C        ;
   897            C        ;  Bank3 RA (A/D Input Control Register)
   898            C        ;
   899       000A C         B3_RA	==	0X0A
   900       000A C         ADICH	==	0X0A
   901            C        ;
   902            C        	;{
   903       0007 C        		CALI	==  0X07 ; Calibration Enable Bit for A/D Offset
   904       0006 C        		ADREF	==  0X06 ; AD Reference Voltage Input Select
   905            C        				 ; Bit4~5:Reserved
   906       0003 C        		ADE11	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   907       0002 C        		ADE10	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   908       0001 C        		ADE9	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   909       0000 C        		ADE8	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   910            C        	;}
   911            C        ;
   912            C        ;  Bank3 RB (A/D Input Control Register)
   913            C        ;
   914       000B C         B3_RB	==	0X0B
   915       000B C         ADICL	==	0X0B
   916            C        ;
   917            C        	;{
   918       0007 C        		ADE7	==  0X07 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   919       0006 C        		ADE6	==  0X06 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   920       0005 C        		ADE5	==  0x05 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   921       0004 C        		ADE4	==  0X04 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   922       0003 C        		ADE3	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   923       0002 C        		ADE2	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   924       0001 C        		ADE1	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   925       0000 C        		ADE0	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   926            C        	;}
   927            C        ;
   928            C        ;  Bank3 RC (A/D High 8-bits Data Buffer)
   929            C        ;
   930       000C C         B3_RC	==	0X0C
   931       000C C         ADDH	==	0X0C
   932            C        ;
   933            C        ;  Bank3 RD (A/D Low 4-bits Data Buffer)
   934            C        ;
   935       000D C         B3_RD	==	0X0D
   936       000D C         ADDL	==	0X0D
   937            C        ;
   938            C        	;{
   939       0007 C        		SIGN	==  0X07 ; Polarity Bit of Offset Voltage.0/1=>Negative/Positive
   940       0006 C        		VOF2	==  0X06
   941       0005 C        		VOF1	==  0X05
   942       0004 C        		VOF0	==  0X04 ; Offset Voltage Bits.
   943            C        				 ; |----|----|----|---------|
   944            C        				 ; |VOF2|VOF1|VOF0|EM78P510N|
   945            C        				 ; |----|----|----|---------|
   946            C        				 ; |  0 |  0 |  0 |   0LSB  |
   947            C        				 ; |----|----|----|---------|
   948            C        				 ; |  0 |  0 |  1 |   2LSB  |
   949            C        				 ; |----|----|----|---------|
   950            C        				 ; |  0 |  1 |  0 |   4LSB  |
   951            C        				 ; |----|----|----|---------|
   952            C        				 ; |  0 |  1 |  1 |   6LSB  |
   953            C        				 ; |----|----|----|---------|
   954            C        				 ; |  1 |  0 |  0 |   8LSB  |
   955            C        				 ; |----|----|----|---------|
   956            C        				 ; |  1 |  0 |  1 |  10LSB  |
   957            C        				 ; |----|----|----|---------|
   958            C        				 ; |  1 |  1 |  0 |  12LSB  |
   959            C        				 ; |----|----|----|---------|
   960            C        				 ; |  1 |  1 |  1 |  14LSB  |
   961            C        				 ; |----|----|----|---------|
   962       0003 C        		ADD3	==  0X03
   963       0002 C        		ADD2	==  0X02
   964       0001 C        		ADD1	==  0X01
   965       0000 C        		ADD0	==  0X00
   966            C        	;}
   967            C        ;
   968            C        ;  Bank3 RE (External Interrupt Edge Select Control Register High Byte)
   969            C        ;
   970       000E C         B3_RE	==	0X0E
   971       000E C         EIESH	==	0X0E
   972            C        ;
   973            C        	;{
   974       0007 C        		EIES7	==  0X07 ; External Interrupt 7 Edge Select Bit.0/1=>Falling/Rising
   975       0006 C        		EIES6	==  0X06 ; External Interrupt 6 Edge Select Bit.0/1=>Falling/Rising
   976       0005 C        		EIES5	==  0X05 ; External Interrupt 5 Edge Select Bit.0/1=>Falling/Rising
   977       0004 C        		EIES4	==  0X04 ; External Interrupt 4 Edge Select Bit.0/1=>Falling/Rising
   978       0003 C        		EIES3	==  0X03 ; External Interrupt 3 Edge Select Bit.0/1=>Falling/Rising
   979       0002 C        		EIES2	==  0X02 ; External Interrupt 2 Edge Select Bit.0/1=>Falling/Rising
   980       0001 C        		EIES1	==  0X01 ; External Interrupt 1 Edge Select Bit.0/1=>Falling/Rising
   981       0000 C        		EIES0	==  0X00 ; External Interrupt 0 Edge Select Bit.0/1=>Falling/Rising
   982            C        	;}
   983            C        ;
   984            C        ;  Bank3 RF (External Interrupt Edge Select Control Register Low Byte)
   985            C        ;
   986       000F C         B3_RF	==	0X0F
   987       000F C         EIESL	==	0X0F
   988            C        ;
   989            C        	;{
   990            C        				 ;Bit4~7 is "0"
   991       0004 C        		ADWK	==  0X04 ; A/D Converter Wake Up Function Enable Bit
   992       0003 C        		INTWK9	==  0X03 ; External Interrupt 9 Wake Up Function Enable Bit
   993       0002 C        		INTWK8	==  0X02 ; External Interrupt 8 Wake Up Function Enable Bit
   994       0001 C        		EIES9	==  0X01 ; External Interrupt 9 Edge Select Bit
   995       0000 C        		EIES8	==  0x00 ; External Interrupt 8 Edge Select Bit
   996            C        	;}
   997            C        ;
   998            C        ;  Bank4 R5 (LED Drive Control Register)
   999            C        ;
  1000       0005 C         B4_R5	==	0X05
  1001       0005 C         LEDDCR	==	0X05
  1002            C        ;
  1003            C        	;{
  1004       0007 C        		LEDD7	==  0X07 ; 0:P9.7 as normal I/O,1:P9.7 as LED direct drive I/O.
  1005       0006 C        		LEDD6	==  0X06 ; 0:P9.6 as normal I/O,1:P9.6 as LED direct drive I/O.
  1006       0005 C        		LEDD5	==  0X05 ; 0:P9.5 as normal I/O,1:P9.5 as LED direct drive I/O.
  1007       0004 C        		LEDD4	==  0X04 ; 0:P9.4 as normal I/O,1:P9.4 as LED direct drive I/O.
  1008       0003 C        		LEDD3	==  0X03 ; 0:P9.3 as normal I/O,1:P9.3 as LED direct drive I/O.
  1009       0002 C        		LEDD2	==  0X02 ; 0:P9.2 as normal I/O,1:P9.2 as LED direct drive I/O.
  1010       0001 C        		LEDD1	==  0X01 ; 0:P9.1 as normal I/O,1:P9.1 as LED direct drive I/O.
  1011       0000 C        		LEDD0	==  0X00 ; 0:P9.0 as normal I/O,1:P9.0 as LED direct drive I/O.
  1012            C        	;}
  1013            C        ;
  1014            C        ;  Bank4 R6 (Watch Timer and Buzzer Control Register)
  1015            C        ;
  1016       0006 C         B4_R6	==	0X06
  1017       0006 C         WBCR	==	0X06
  1018            C        ;
  1019            C        	;{
  1020       0007 C        		WTCS	==  0X07 ; Watch Timer and Buzzer Clock Source Select Bit.
  1021       0006 C        		WTIE	==  0X06 ; Watch Timer Enable Bit and Interrupt Mask
  1022       0005 C        		WTIF	==  0X05 ; Watch Timer Interrupt Flag
  1023       0004 C        		WTSSB1	==  0X04 ;
  1024       0003 C        		WTSSB0  ==  0X03 ; Watch Timer Interval Select Bits
  1025            C        				 ; |------|------|-----------------------------------|
  1026            C        				 ; |WTSSB1|WTSSB0|Watch Timer Interval Select(WTCS=1)|
  1027            C        				 ; |  0   |   0  |                1.0S               |
  1028            C        				 ; |------|------|-----------------------------------|
  1029            C        				 ; |  0   |   1  |                0.5S               |
  1030            C        				 ; |------|------|-----------------------------------|
  1031            C        				 ; |  1   |   0  |               0.25S               |
  1032            C        				 ; |------|------|-----------------------------------|
  1033            C        				 ; |  1   |   1  |              3.91MS               |
  1034            C        				 ; |------|------|-----------------------------------|
  1035       0002 C        		BUZE	==  0X02 ; Buzzer Enable and PORT91 as Buzzer Output Pin
  1036       0001 C        		BSSB1	==  0X01
  1037       0000 C        		BSSB0	==  0X00 ; Buzzer Output Frequency Select Bits
  1038            C        				 ; |-----|-----|----------------------------|
  1039            C        				 ; |BSSB1|BSSB0|Buzzer Signal Select(WTCS=1)|
  1040            C        				 ; |-----|-----|----------------------------|
  1041            C        				 ; |  0  |  0  |           0.5KHz           |
  1042            C        				 ; |-----|-----|----------------------------|
  1043            C        				 ; |  0  |  1  |           1.0KHz           |
  1044            C        				 ; |-----|-----|----------------------------|
  1045            C        				 ; |  1  |  0  |           2.0KHz           |
  1046            C        				 ; |-----|-----|----------------------------|
  1047            C        				 ; |  1  |  1  |           4.0KHz           |
  1048            C        				 ; |-----|-----|----------------------------|
  1049            C        	;}
  1050            C        ;
  1051            C        ;  Bank4 R7 (PORT7 I/O Control Register)
  1052            C        ;
  1053       0007 C         B4_R7	==	0X07
  1054       0007 C         IOC7	==	0X07
  1055       0007 C         P7IOCR	==	0X07
  1056            C        ;
  1057            C        ;  Bank4 R8 (PORT8 I/O Control Register)
  1058            C        ;
  1059       0008 C         B4_R8	==	0X08
  1060       0008 C         IOC8	==	0X08
  1061       0008 C         P8IOCR	==	0X08
  1062            C        ;
  1063            C        ;  Bank4 R9 (PORT9 I/O Control Register)
  1064            C        ;
  1065       0009 C         B4_R9	==	0X09
  1066       0009 C         IOC9	==	0X09
  1067       0009 C         P9IOCR	==	0X09
  1068            C        ;
  1069            C        ;  Bank4 RA (PORTA I/O Control Register)
  1070            C        ;
  1071       000A C         B4_RA	==	0X0A
  1072       000A C         IOCA	==	0X0A
  1073       000A C         PAIOCR	==	0X0A
  1074            C        ;
  1075            C        ;  Bank4 RB (PORTB I/O Control Register)
  1076            C        ;
  1077       000B C         B4_RB	==	0X0B
  1078       000B C         IOCB	==	0X0B
  1079       000B C         PBIOCR	==	0X0B
  1080            C        ;
  1081            C        ;  Bank4 RC (PORTC I/O Control Register)
  1082            C        ;
  1083       000C C         B4_RC	==	0X0C
  1084       000C C         IOCC	==	0X0C
  1085       000C C         PCIOCR	==	0X0C
  1086            C        ;
  1087            C        ;  Bank4 RF (Wake Up Control Register)
  1088            C        ;
  1089       000F C         B4_RF	==	0X0F
  1090       000F C         WKCR	==	0X0F
  1091            C        ;
  1092            C        	;{
  1093       0007 C        		INTWK7	==  0X07 ; External Interrupt 7 Wake Up Function Enable Bit.
  1094       0006 C        		INTWK6	==  0X06 ; External Interrupt 6 Wake Up Function Enable Bit.
  1095       0005 C        		INTWK5	==  0X05 ; External Interrupt 5 Wake Up Function Enable Bit.
  1096       0004 C        		INTWK4	==  0X04 ; External Interrupt 4 Wake Up Function Enable Bit.
  1097       0003 C        		INTWK3	==  0X03 ; External Interrupt 3 Wake Up Function Enable Bit.
  1098       0002 C        		INTWK2	==  0X02 ; External Interrupt 2 Wake Up Function Enable Bit.
  1099       0001 C        		INTWK1	==  0X01 ; External Interrupt 1 Wake Up Function Enable Bit.
  1100       0000 C        		INTWK0	==  0X00 ; External Interrupt 0 Wake Up Function Enable Bit.
  1101            C        	;}
  1102            C        ;
  1103            C        ;  Bank4 R6 (UART Control Register 2)
  1104            C        ;
  1105       0006 C         B5_R6	==	0X06
  1106       0006 C         UARC2	==	0X06
  1107            C        ;
  1108            C        	;{
  1109       0005 C        		UARTE	==  0X05  ; UART Function Enable
  1110       0003 C        		UINVEN	==  0X03  ; Enable UART TX and RX Port Inverse Ouput
  1111            C        				  ; other Bits is "0"
  1112            C        	;}
  1113            C        ;
  1114            C        ; Bank5 R7 (PORT7 Pull High Control Register)
  1115            C        ;
  1116       0007 C         B5_R7	==	0X07
  1117       0007 C         P7PHCR	==	0X07
  1118            C        ;
  1119            C        	;{
  1120       0007 C        		PH77	==  0X07 ;
  1121       0006 C        		PH76	==  0X06 ;
  1122       0005 C        		PH75	==  0X05 ;
  1123       0004 C        		PH74	==  0X04 ;
  1124       0003 C        		PH73	==  0X03 ;
  1125       0002 C        		PH72	==  0X02 ;
  1126       0001 C        		PH71	==  0X01 ;
  1127       0000 C        		PH70	==  0X00 ;
  1128            C        	;}
  1129            C        ;
  1130            C        ; Bank5 R8 (PORT8 Pull High Control Register)
  1131            C        ;
  1132       0008 C         B5_R8	==	0X08
  1133       0008 C         P8PHCR	==	0X08
  1134            C        ;
  1135            C        	;{
  1136       0007 C        		PH87	==  0X07 ;
  1137       0006 C        		PH86	==  0X06 ;
  1138       0005 C        		PH85	==  0X05 ;
  1139       0004 C        		PH84	==  0X04 ;
  1140       0003 C        		PH83	==  0X03 ;
  1141       0002 C        		PH82	==  0X02 ;
  1142       0001 C        		PH81	==  0X01 ;
  1143       0000 C        		PH80	==  0X00 ;
  1144            C        	;}
  1145            C        ;
  1146            C        ; Bank5 R9 (PORT9 Pull High Control Register)
  1147            C        ;
  1148       0009 C         B5_R9	==	0X09
  1149       0009 C         P9PHCR	==	0X09
  1150            C        ;
  1151            C        	;{
  1152       0007 C        		PH97	==  0X07 ;
  1153       0006 C        		PH96	==  0X06 ;
  1154       0005 C        		PH95	==  0X05 ;
  1155       0004 C        		PH94	==  0X04 ;
  1156       0003 C        		PH93	==  0X03 ;
  1157       0002 C        		PH92	==  0X02 ;
  1158       0001 C        		PH91	==  0X01 ;
  1159       0000 C        		PH90	==  0X00 ;
  1160            C        	;}
  1161            C        ;
  1162            C        ; Bank5 RA (PORTA Pull High Control Register)
  1163            C        ;
  1164       000A C         B5_RA	==	0X0A
  1165       000A C         PAPHCR	==	0X0A
  1166            C        ;
  1167            C        	;{
  1168       0007 C        		PHA7	==  0X07 ;
  1169       0006 C        		PHA6	==  0X06 ;
  1170       0005 C        		PHA5	==  0X05 ;
  1171       0004 C        		PHA4	==  0X04 ;
  1172       0003 C        		PHA3	==  0X03 ;
  1173       0002 C        		PHA2	==  0X02 ;
  1174       0001 C        		PHA1	==  0X01 ;
  1175       0000 C        		PHA0	==  0X00 ;
  1176            C        	;}
  1177            C        ;
  1178            C        ; Bank5 RB (PORTB Pull High Control Register)
  1179            C        ;
  1180       000B C         B5_RB	==	0X0B
  1181       000B C         PBPHCR	==	0X0B
  1182            C        ;
  1183            C        	;{
  1184       0007 C        		PHB7	==  0X07 ;
  1185       0006 C        		PHB6	==  0X06 ;
  1186       0005 C        		PHB5	==  0X05 ;
  1187       0004 C        		PHB4	==  0X04 ;
  1188       0003 C        		PHB3	==  0X03 ;
  1189       0002 C        		PHB2	==  0X02 ;
  1190       0001 C        		PHB1	==  0X01 ;
  1191       0000 C        		PHB0	==  0X00 ;
  1192            C        	;}
  1193            C        ;
  1194            C        ; Bank5 RC (PORTC Pull High Control Register)
  1195            C        ;
  1196       000C C         B5_RC	==	0X0C
  1197       000C C         PCPHCR	==	0X0C
  1198            C        ;
  1199            C        	;{
  1200       0003 C        		PHC3	==  0X03 ;
  1201       0002 C        		PHC2	==  0X02 ;
  1202       0001 C        		PHC1	==  0X01 ;
  1203       0000 C        		PHC0	==  0X00 ;
  1204            C        				 ; Other Bits is "0"
  1205            C        	;}
  1206            C        ;
  1207            C        ;  Bank6 R6 (Low Voltage Reset Control Register)
  1208            C        ;
  1209       0006 C         B6_R6  ==  0x06
  1210       0006 C         LVRCR  ==  0x06
  1211            C        ;
  1212            C            ;{
  1213       0002 C                LVREN   ==  0x02 ;
  1214       0001 C                LVRS1   ==  0x01 ;
  1215       0000 C                LVRS0   ==  0x00 ;
  1216            C            ;}
  1217            C        
  1218            C        ;  Bank6 R7 (PORT7 Open Drain Control Reister)
  1219            C        ;
  1220       0007 C         B6_R7	==	0X07
  1221       0007 C         P7ODCR	==	0X07
  1222            C        ;
  1223            C        	;{
  1224       0007 C        		P7OD7	==  0X07 ;
  1225       0006 C        		P7OD6	==  0X06 ;
  1226       0005 C        		P7OD5	==  0X05 ;
  1227       0004 C        		P7OD4	==  0X04 ;
  1228       0003 C        		P7OD3	==  0X03 ;
  1229       0002 C        		P7OD2	==  0X02 ;
  1230       0001 C        		P7OD1	==  0X01 ;
  1231       0000 C        		P7OD0	==  0X00 ;
  1232            C        	;}
  1233            C        ;
  1234            C        ;  Bank6 R8 (PORT8 Open Drain Control Reister)
  1235            C        ;
  1236       0008 C         B6_R8	==	0X08
  1237       0008 C         P8ODCR	==	0X08
  1238            C        ;
  1239            C        	;{
  1240       0007 C        		P8OD7	==  0X07 ;
  1241       0006 C        		P8OD6	==  0X06 ;
  1242       0005 C        		P8OD5	==  0X05 ;
  1243       0004 C        		P8OD4	==  0X04 ;
  1244       0003 C        		P8OD3	==  0X03 ;
  1245       0002 C        		P8OD2	==  0X02 ;
  1246       0001 C        		P8OD1	==  0X01 ;
  1247       0000 C        		P8OD0	==  0X00 ;
  1248            C        	;}
  1249            C        ;
  1250            C        ;  Bank6 R9 (PORT9 Open Drain Control Reister)
  1251            C        ;
  1252       0009 C         B6_R9	==	0X09
  1253       0009 C         P9ODCR	==	0X09
  1254            C        ;
  1255            C        	;{
  1256       0007 C        		P9OD7	==  0X07 ;
  1257       0006 C        		P9OD6	==  0X06 ;
  1258       0005 C        		P9OD5	==  0X05 ;
  1259       0004 C        		P9OD4	==  0X04 ;
  1260       0003 C        		P9OD3	==  0X03 ;
  1261       0002 C        		P9OD2	==  0X02 ;
  1262       0001 C        		P9OD1	==  0X01 ;
  1263       0000 C        		P9OD0	==  0X00 ;
  1264            C        	;}
  1265            C        ;
  1266            C        ;  Bank6 RA (PORTA Open Drain Control Reister)
  1267            C        ;
  1268       000A C         B6_RA	==	0X0A
  1269       000A C         PAODCR	==	0X0A
  1270            C        ;
  1271            C        	;{
  1272       0007 C        		PAOD7	==  0X07 ;
  1273       0006 C        		PAOD6	==  0X06 ;
  1274       0005 C        		PAOD5	==  0X05 ;
  1275       0004 C        		PAOD4	==  0X04 ;
  1276       0003 C        		PAOD3	==  0X03 ;
  1277       0002 C        		PAOD2	==  0X02 ;
  1278       0001 C        		PAOD1	==  0X01 ;
  1279       0000 C        		PAOD0	==  0X00 ;
  1280            C        	;}
  1281            C        ;
  1282            C        ;  Bank6 RB (PORTB Open Drain Control Reister)
  1283            C        ;
  1284       000B C         B6_RB	==	0X0B
  1285       000B C         PBODCR	==	0X0B
  1286            C        ;
  1287            C        	;{
  1288       0007 C        		PBOD7	==  0X07 ;
  1289       0006 C        		PBOD6	==  0X06 ;
  1290       0005 C        		PBOD5	==  0X05 ;
  1291       0004 C        		PBOD4	==  0X04 ;
  1292       0003 C        		PBOD3	==  0X03 ;
  1293       0002 C        		PBOD2	==  0X02 ;
  1294       0001 C        		PBOD1	==  0X01 ;
  1295       0000 C        		PBOD0	==  0X00 ;
  1296            C        	;}
  1297            C        ;
  1298            C        ;  Bank6 RC (PORTC Open Drain Control Reister)
  1299            C        ;
  1300       000C C         B6_RC	==	0X0C
  1301       000C C         PORTC	==	0X0C
  1302            C        ;
  1303            C        	;{
  1304            C        				 ; Other
  1305       0003 C        		PCOD3	==  0X03 ;
  1306       0002 C        		PCOD2	==  0X02 ;
  1307       0001 C        		PCOD1	==  0X01 ;
  1308       0000 C        		PCOD0	==  0X00 ;
  1309            C        	;}
  1310            C        ;
  1311            C        ;======================================================;
  1312            C        ; Register R10~R3F                                     ;
  1313            C        ;======================================================;
  1314            C        ;
  1315            C        ; (R10 ~ R3F): General Purpose Register
  1316            C        ;
  1317       0010 C         R10    ==    0x10
  1318       0011 C         R11    ==    0x11
  1319       0012 C         R12    ==    0x12
  1320       0013 C         R13    ==    0x13
  1321       0014 C         R14    ==    0x14
  1322       0015 C         R15    ==    0x15
  1323       0016 C         R16    ==    0x16
  1324       0017 C         R17    ==    0x17
  1325       0018 C         R18    ==    0x18
  1326       0019 C         R19    ==    0x19
  1327       001A C         R1A    ==    0x1A
  1328       001B C         R1B    ==    0x1B
  1329       001C C         R1C    ==    0x1C
  1330       001D C         R1D    ==    0x1D
  1331       001E C         R1E    ==    0x1E
  1332       001F C         R1F    ==    0x1F
  1333            C        ;
  1334       0020 C         R20    ==    0x20
  1335       0021 C         R21    ==    0x21
  1336       0022 C         R22    ==    0x22
  1337       0023 C         R23    ==    0x23
  1338       0024 C         R24    ==    0x24
  1339       0025 C         R25    ==    0x25
  1340       0026 C         R26    ==    0x26
  1341       0027 C         R27    ==    0x27
  1342       0028 C         R28    ==    0x28
  1343       0029 C         R29    ==    0x29
  1344       002A C         R2A    ==    0x2A
  1345       002B C         R2B    ==    0x2B
  1346       002C C         R2C    ==    0x2C
  1347       002D C         R2D    ==    0x2D
  1348       002E C         R2E    ==    0x2E
  1349       002F C         R2F    ==    0x2F
  1350            C        ;
  1351       0030 C         R30    ==    0x30
  1352       0031 C         R31    ==    0x31
  1353       0032 C         R32    ==    0x32
  1354       0033 C         R33    ==    0x33
  1355       0034 C         R34    ==    0x34
  1356       0035 C         R35    ==    0x35
  1357       0036 C         R36    ==    0x36
  1358       0037 C         R37    ==    0x37
  1359       0038 C         R38    ==    0x38
  1360       0039 C         R39    ==    0x39
  1361       003A C         R3A    ==    0x3A
  1362       003B C         R3B    ==    0x3B
  1363       003C C         R3C    ==    0x3C
  1364       003D C         R3D    ==    0x3D
  1365       003E C         R3E    ==    0x3E
  1366       003F C         R3F    ==    0x3F
  1367            C        
    13                     include "..\..\..\..\include\EM78xx\inc\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        
    18            C        ;**********************************************************************;
    19            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    20            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    21            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    22            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    23            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    24            C        ; Input:       reg_acc1                                                ;
    25            C        ; Output:      reg_acc3, reg_acc2                                      ;
    26            C        ; Variable Register:None                                               ;
    27            C        ; Register Changed: R3, 0 ;ACC                                         ;
    28            C        ;**********************************************************************;
    29            C        ;-----------------------------------------------------------------
    30            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    31            C        ;
    32            C                CLR     reg_acc2        ;clear BCD data register
    33            C                CLR     reg_acc3
    34            C                MOV     A, reg_acc1
    35            C        $Bin_Bcd1:
    36            C                ADD     A, @156         ;subtract 100 from binary that is transform
    37            C                JBS     STATUS, C       ;borrow bigit?
    38            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    39            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    40            C                JMP     $Bin_Bcd1       ;backing out
    41            C        $Bin_Bcd2:
    42            C                ADD     A, @100         ;100
    43            C                MOV     reg_acc1, A
    44            C        $Bin_Bcd3:
    45            C                ADD     A, @246         ;10
    46            C                JBS     STATUS, C       ;
    47            C                JMP     $Bin_Bcd4       ;
    48            C                INC     reg_acc2        ;BCD1
    49            C                JMP     $Bin_Bcd3
    50            C        $Bin_Bcd4:
    51            C                ADD     A, @10          ;10
    52            C                SWAP    reg_acc2        ;BCDreg_acc2
    53            C                ADD     reg_acc2, A     ;BCDreg_acc2
    54            C                ENDM
    55            C        ;
    56            C        ;**********************************************************************;
    57            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    58            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    59            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    60            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    61            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    62            C        ; Input:       reg_acc1, reg_acc2                                      ;
    63            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    64            C        ; Variable Register:reg_acc, reg_accd                                  ;
    65            C        ; Register Changed: R3, 0; ACC                                         ;
    66            C        ; Status:      1                                                       ;
    67            C        ;**********************************************************************;
    68            C        ;
    69            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    70            C        ;
    71            C                MOV     A, @16          ;(=byte*8)
    72            C                MOV     reg_acc, A
    73            C                CLR     reg_acc5        ;BCD
    74            C                CLR     reg_acc4
    75            C                CLR     reg_acc3
    76            C                BC      STATUS, C       ;R3C
    77            C        $Bin_Bcd1:
    78            C                RLC     reg_acc1        ;
    79            C                RLC     reg_acc2        ;
    80            C                RLC     reg_acc3        ;BCD
    81            C                RLC     reg_acc4
    82            C                RLC     reg_acc5        ;BCD
    83            C                DJZ     reg_acc         ;
    84            C                JMP     $Bin_Bcd2       ;BCD
    85            C                JMP     $Bin_Bcd3       ;
    86            C        $Bin_Bcd2:
    87            C                MOV     A, reg_acc3     ;reg_acc3BCD
    88            C                CALL    $bcdadj         ;BCD
    89            C                MOV     reg_acc3, A     ;
    90            C                MOV     A, reg_acc4     ;reg_acc4BCD
    91            C                CALL    $BCDADJ
    92            C                MOV     reg_acc4, A
    93            C                MOV     A, reg_acc5     ;reg_acc5BCD
    94            C                CALL    $BCDADJ
    95            C                MOV     reg_acc5, A
    96            C                JMP     $Bin_Bcd1       ;
    97            C        ;-------BCD Code Adjust Subprogram---------------
    98            C        $BCDADJ:
    99            C                ADD     A, @51
   100            C                MOV     reg_accd, A
   101            C                JBS     reg_accd, 3
   102            C                ADD     A, @253
   103            C                JBS     reg_accd, 7
   104            C                ADD     A, @208
   105            C                RET
   106            C        $Bin_Bcd3:
   107            C                ENDM
   108            C        ;
   109            C        ;**********************************************************************;
   110            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   111            C        ; Description:reg_acc7BCD                    ;
   112            C        ;             reg_acc4BCD,                     ;
   113            C        ;             reg_acc3                         ;
   114            C        ;             reg_acc1                         ;
   115            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   116            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   117            C        ; Variable Register:reg_acc, reg_accd                                  ;
   118            C        ; Register Changed: R3, 0;ACC                                          ;
   119            C        ; stack:      1                                                        ;
   120            C        ;**********************************************************************;
   121            C        ;
   122            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   123            C        ;
   124            C                MOV     A, @24          ;=byte*8)
   125            C                MOV     reg_acc, A
   126            C                CLR     reg_acc4
   127            C                CLR     reg_acc5
   128            C                CLR     reg_acc6
   129            C                CLR     reg_acc7
   130            C                BC      STATUS, C       ;R3C
   131            C        $Bin_Bcd1:
   132            C                RLC     reg_acc1        ;
   133            C                RLC     reg_acc2
   134            C                RLC     reg_acc3        ;
   135            C                RLC     reg_acc4        ;BCD
   136            C                RLC     reg_acc5
   137            C                RLC     reg_acc6
   138            C                RLC     reg_acc7        ;BCD
   139            C                DJZ     reg_acc         ;
   140            C                JMP     $Bin_Bcd2       ;BCD
   141            C                JMP     $Bin_Bcd3       ;
   142            C        $Bin_Bcd2:
   143            C                MOV     A, reg_acc4     ;reg_acc4BCD
   144            C                CALL    $BCDADJ         ;BCD
   145            C                MOV     reg_acc4, A
   146            C                MOV     A, reg_acc5     ;reg_acc5BCD
   147            C                CALL    $BCDADJ
   148            C                MOV     reg_acc5, A
   149            C                MOV     A, reg_acc6     ;reg_acc6BCD
   150            C                CALL    $BCDADJ
   151            C                MOV     reg_acc6, A
   152            C                MOV     A, reg_acc7     ;reg_acc7BCD
   153            C                CALL    $BCDADJ
   154            C                MOV     reg_acc7, A
   155            C                JMP     $Bin_Bcd1       ;
   156            C        ;-------BCD Code Adjust Subprogram---------------
   157            C        $BCDADJ:
   158            C                ADD     A, @51
   159            C                MOV     reg_accd, A
   160            C                JBS     reg_accd, 3
   161            C                ADD     A, @253
   162            C                JBS     reg_accd, 7
   163            C                ADD     A, @208
   164            C                RET
   165            C        $Bin_Bcd3:
   166            C                ENDM
   167            C        ;
   168            C        ;**********************************************************************;
   169            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   170            C        ; Description:reg_acc9BCD                    ;
   171            C        ;             reg_acc5BCD                    ;
   172            C        ;             reg_acc4                         ;
   173            C        ;             reg_acc1?                          ;
   174            C        ; Arithmetic:                                                          ;
   175            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   176            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   177            C        ; Variable Register:reg_acc, reg_accd                                  ;
   178            C        ; Register Changed: R3, 0; ACC                                         ;
   179            C        ; stack:      1                                                        ;
   180            C        ;**********************************************************************;
   181            C        ;
   182            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   183            C        ;
   184            C                MOV     A,  @32         ;(=byte*8)
   185            C                MOV     reg_acc, A
   186            C                CLR     reg_acc5        ;BCD
   187            C                CLR     reg_acc6
   188            C                CLR     reg_acc7
   189            C                CLR     reg_acc8
   190            C                CLR     reg_acc9
   191            C                BC      STATUS, C       ;R3C
   192            C        $Bin_Bcd1:
   193            C                RLC     reg_acc1        ;
   194            C                RLC     reg_acc2
   195            C                RLC     reg_acc3
   196            C                RLC     reg_acc4        ;
   197            C                RLC     reg_acc5
   198            C                RLC     reg_acc6        ;BCD
   199            C                RLC     reg_acc7
   200            C                RLC     reg_acc8
   201            C                RLC     reg_acc9        ;BCD
   202            C                DJZ     reg_acc         ;
   203            C                JMP     $Bin_Bcd2       ;BCD
   204            C                JMP     $Bin_Bcd3       ;
   205            C        $Bin_Bcd2:
   206            C                MOV     A, reg_acc5     ;reg_acc5BCD
   207            C                CALL    $BCDADJ         ;BCD
   208            C                MOV     reg_acc5, A
   209            C                MOV     A, reg_acc6     ;reg_acc6BCD
   210            C                CALL    $BCDADJ
   211            C                MOV     reg_acc6, A
   212            C                MOV     A, reg_acc7     ;reg_acc7BCD
   213            C                CALL    $BCDADJ
   214            C                MOV     reg_acc7, A
   215            C                MOV     A, reg_acc8     ;reg_acc8BCD
   216            C                CALL    $BCDADJ
   217            C                MOV     reg_acc8, A
   218            C                MOV     A, reg_acc9     ;reg_acc9BCD
   219            C                CALL    $BCDADJ
   220            C                MOV     reg_acc9, A
   221            C                JMP     $Bin_Bcd1       ;
   222            C        ;-------BCD Code Adjust Subprogram---------------
   223            C        $BCDADJ:
   224            C                ADD     A, @51
   225            C                MOV     reg_accd, A
   226            C                JBS     reg_accd, 3
   227            C                ADD     A, @253
   228            C                JBS     reg_accd, 7
   229            C                ADD     A, @208
   230            C                RET
   231            C        $Bin_Bcd3:
   232            C                ENDM
   233            C        ;**********************************************************************;
   234            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   235            C        ; Description:reg_acccBCD                      ;
   236            C        ;             reg_acc6BCD                      ;
   237            C        ;             reg_acc5                         ;
   238            C        ;             reg_acc1                         ;
   239            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   240            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   241            C        ;             reg_accb, reg_accc                                       ;
   242            C        ; Variable Register:reg_acc, reg_accd                                  ;
   243            C        ; Register Changed: R3, 0;ACC                                          ;
   244            C        ; Stack:      1                                                        ;
   245            C        ;**********************************************************************;
   246            C        ;
   247            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   248            C        ;
   249            C                MOV     A,  @40         ;(=byte*8)
   250            C                MOV     reg_acc, A
   251            C                CLR     reg_acc6        ;BCD
   252            C                CLR     reg_acc7
   253            C                CLR     reg_acc8
   254            C                CLR     reg_acc9
   255            C                CLR     reg_acca
   256            C                CLR     reg_accb
   257            C                CLR     reg_accc
   258            C                BC      STATUS, C       ;R3C
   259            C        $Bin_Bcd1:
   260            C                RLC     reg_acc1
   261            C                RLC     reg_acc2
   262            C                RLC     reg_acc3        ;
   263            C                RLC     reg_acc4        ;
   264            C                RLC     reg_acc5        ;
   265            C        ;
   266            C                RLC     reg_acc6        ;BCD
   267            C                RLC     reg_acc7
   268            C                RLC     reg_acc8
   269            C                RLC     reg_acc9
   270            C                RLC     reg_acca
   271            C                RLC     reg_accb
   272            C                RLC     reg_accc        ;BCD
   273            C                DJZ     reg_acc         ;
   274            C                JMP     $Bin_Bcd2       ;BCD
   275            C                JMP     $Bin_Bcd3       ;
   276            C        $Bin_Bcd2:
   277            C                MOV     A, reg_acc6     ;reg_acc6BCD
   278            C                CALL    $BCDADJ         ;BCD
   279            C                MOV     reg_acc6, A
   280            C                MOV     A, reg_acc7     ;reg_acc7BCD
   281            C                CALL    $BCDADJ
   282            C                MOV     reg_acc7, A
   283            C                MOV     A, reg_acc8     ;reg_acc8BCD
   284            C                CALL    $BCDADJ
   285            C                MOV     reg_acc8, A
   286            C                MOV     A, reg_acc9     ;reg_acc9BCD
   287            C                CALL    $BCDADJ
   288            C                MOV     reg_acc9, A
   289            C                MOV     A, reg_acca     ;reg_accaBCD
   290            C                CALL    $BCDADJ
   291            C                MOV     reg_acca, A
   292            C                MOV     A, reg_accb     ;reg_accbBCD
   293            C                CALL    $BCDADJ
   294            C                MOV     reg_accb, A
   295            C                MOV     A, reg_accc     ;reg_acccBCD
   296            C                CALL    $BCDADJ
   297            C                MOV     reg_accc, A
   298            C                JMP     $Bin_Bcd1       ;
   299            C        ;
   300            C        ;-------BCD Code Adjust Subprogram---------------
   301            C        $BCDADJ:
   302            C                ADD     A, @51
   303            C                MOV     reg_accd, A
   304            C                JBS     reg_accd, 3
   305            C                ADD     A, @253
   306            C                JBS     reg_accd, 7
   307            C                ADD     A, @208
   308            C                RET
   309            C        $Bin_Bcd3:
   310            C                ENDM
   311            C        ;
   312            C        ;**********************************************************************;
   313            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   314            C        ; Input:      reg_acc1(BCD code)                                       ;
   315            C        ; Output:     reg_acc2(Binary Code)                                    ;
   316            C        ; Register Changed: STATUS, C;ACC                                      ;
   317            C        ;**********************************************************************;
   318            C        ;
   319            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   320            C        ;
   321            C                CLR     reg_acc2
   322            C                SWAPA   reg_acc1        ;reg_acc1A
   323            C                AND     A, @0X0F        ;reg_acc1, 0-3bit.
   324            C                MOV     reg_acc2, A
   325            C                BC      STATUS, C
   326            C                RLC     reg_acc2        ;reg_acc2*10
   327            C                RLC     reg_acc2
   328            C                ADD     reg_acc2, A
   329            C                RLC     reg_acc2
   330            C                MOV     A, reg_acc1
   331            C                AND     A, @0X0F        ;reg_acc1, 4-7bit
   332            C                ADD     reg_acc2, A     ;bcd code10bcd code
   333            C                ENDM
   334            C        ;
   335            C        ;**********************************************************************;
   336            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   337            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   338            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   339            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   340            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   341            C        ; Register Changed: STATUS, C; ACC                                     ;
   342            C        ; Stack:     1                                                         ;
   343            C        ;**********************************************************************;
   344            C        ;
   345            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   346            C        ;
   347            C                CLR     reg_acc3        ;clear binary code register
   348            C                CLR     reg_acc4
   349            C                MOV     A, @16          ;reg_acc==byte*8)
   350            C                Mov     reg_acc, A
   351            C        $Bcd_Bin1:
   352            C                BC      STATUS, C
   353            C                RRC     reg_acc2        ;BCDBINARY
   354            C                RRC     reg_acc1
   355            C                RRC     reg_acc4
   356            C                RRC     reg_acc3
   357            C                MOV     A, reg_acc1     ;BCDBCD
   358            C                CALL    $Binadj
   359            C                MOV     reg_acc1, A
   360            C                MOV     A, reg_acc2
   361            C                CALL    $Binadj
   362            C                MOV     reg_acc2, A
   363            C                DJZ     reg_acc
   364            C                JMP     $Bcd_Bin1
   365            C                JMP     $Bcd_Bin2
   366            C        $Binadj:
   367            C                MOV     reg_accd, A
   368            C                JBC     reg_accd, 3
   369            C                ADD     A, @253
   370            C                JBC     reg_accd, 7
   371            C                ADD     A, @208
   372            C                RET
   373            C        $Bcd_Bin2:
   374            C                ENDM
   375            C        ;
   376            C        ;**********************************************************************;
   377            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   378            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   379            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   380            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   381            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   382            C        ; Register Changed: STATUS, C; ACC                                     ;
   383            C        ; Stack:     1                                                         ;
   384            C        ;**********************************************************************;
   385            C        ;
   386            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   387            C        ;
   388            C                CLR     reg_acc4
   389            C                CLR     reg_acc5
   390            C                CLR     reg_acc6
   391            C                MOV     A, @24          ;reg_acc==BYTE*8)
   392            C                MOV     reg_acc, A
   393            C        $Bcd_Bin1:
   394            C                BC      STATUS, C
   395            C                RRC     reg_acc3
   396            C                RRC     reg_acc2
   397            C                RRC     reg_acc1
   398            C                RRC     reg_acc6
   399            C                RRC     reg_acc5
   400            C                RRC     reg_acc4
   401            C                MOV     A, reg_acc1
   402            C                CALL    $Binadj
   403            C                MOV     reg_acc1, A
   404            C                MOV     A, reg_acc2
   405            C                CALL    $Binadj
   406            C                MOV     reg_acc2, A
   407            C                MOV     A, reg_acc3
   408            C                CALL    $Binadj
   409            C                MOV     reg_acc3, A
   410            C                DJZ     reg_acc
   411            C                JMP     $Bcd_Bin1
   412            C                JMP     $Bcd_Bin2
   413            C        $Binadj:
   414            C                MOV     reg_accd, A
   415            C                JBC     reg_accd, 3
   416            C                ADD     A, @253
   417            C                JBC     reg_accd, 7
   418            C                ADD     A, @208
   419            C                RET
   420            C        $Bcd_Bin2:
   421            C                ENDM
   422            C        ;
   423            C        ;**********************************************************************;
   424            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   425            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   426            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   427            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   428            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   429            C        ; Register Changed: STATUS, C;ACC                                      ;
   430            C        ; Stack:     1                                                         ;
   431            C        ;**********************************************************************;
   432            C        ;
   433            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   434            C        ;
   435            C                CLR     reg_acc5
   436            C                CLR     reg_acc6
   437            C                CLR     reg_acc7
   438            C                CLR     reg_acc8
   439            C                MOV     A, @32          ;reg_acc==BYTE*8)
   440            C                MOV     reg_acc, A
   441            C        $Bcd_Bin1:
   442            C                BC      STATUS, C
   443            C                RRC     reg_acc4
   444            C                RRC     reg_acc3
   445            C                RRC     reg_acc2
   446            C                RRC     reg_acc1
   447            C                RRC     reg_acc8
   448            C                RRC     reg_acc7
   449            C                RRC     reg_acc6
   450            C                RRC     reg_acc5
   451            C                MOV     A, reg_acc1
   452            C                CALL    $Binadj
   453            C                MOV     reg_acc1, A
   454            C                MOV     A, reg_acc2
   455            C                CALL    $Binadj
   456            C                MOV     reg_acc2, A
   457            C                MOV     A, reg_acc3
   458            C                CALL    $Binadj
   459            C                MOV     reg_acc3, A
   460            C                MOV     A, reg_acc4
   461            C                CALL    $Binadj
   462            C                MOV     reg_acc4, A
   463            C                DJZ     reg_acc
   464            C                JMP     $Bcd_Bin1
   465            C                JMP     $Bcd_Bin2
   466            C        $Binadj:
   467            C                MOV     reg_accd, A
   468            C                JBC     reg_accd, 3
   469            C                ADD     A, @253
   470            C                JBC     reg_accd, 7
   471            C                ADD     A, @208
   472            C                RET
   473            C        $Bcd_Bin2:
   474            C                ENDM
   475            C        ;
   476            C        ;**********************************************************************;
   477            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   478            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   479            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   480            C        ;            Bcd Code.                                                 ;
   481            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   482            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   483            C        ;            Of Binary Code.                                           ;
   484            C        ; Register Changed: STATUS, C; ACC                                     ;
   485            C        ; Stack:     1                                                         ;
   486            C        ;**********************************************************************;
   487            C        ;
   488            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   489            C        ;
   490            C                CLR     reg_acc6
   491            C                CLR     reg_acc7
   492            C                CLR     reg_acc8
   493            C                CLR     reg_acc9
   494            C                CLR     reg_acca
   495            C                MOV     A, @40          ;reg_acc==BYTE*8)
   496            C                MOV     reg_acc, A
   497            C        $Bcd_Bin1:
   498            C                BC      STATUS, C
   499            C                RRC     reg_acc5
   500            C                RRC     reg_acc4
   501            C                RRC     reg_acc3
   502            C                RRC     reg_acc2
   503            C                RRC     reg_acc1
   504            C                RRC     reg_acca
   505            C                RRC     reg_acc9
   506            C                RRC     reg_acc8
   507            C                RRC     reg_acc7
   508            C                RRC     reg_acc6
   509            C                MOV     A, reg_acc1
   510            C                CALL    $Binadj
   511            C                MOV     reg_acc1, A
   512            C                MOV     A, reg_acc2
   513            C                CALL    $Binadj
   514            C                MOV     reg_acc2, A
   515            C                MOV     A, reg_acc3
   516            C                CALL    $Binadj
   517            C                MOV     reg_acc3, A
   518            C                MOV     A, reg_acc4
   519            C                CALL    $Binadj
   520            C                MOV     reg_acc4, A
   521            C                MOV     A, reg_acc5
   522            C                CALL    $Binadj
   523            C                MOV     reg_acc5, A
   524            C                DJZ     reg_acc
   525            C                JMP     $Bcd_Bin1
   526            C                JMP     $Bcd_Bin2
   527            C        $Binadj:
   528            C                MOV     reg_accd, A
   529            C                JBC     reg_accd, 3
   530            C                ADD     A, @253
   531            C                JBC     reg_accd, 7
   532            C                ADD     A, @208
   533            C                RET
   534            C        $Bcd_Bin2:
   535            C                ENDM
   536            C        
   537            C        
   538            C        ;*****************************************************************
   539            C        ;Function:    Subtration
   540            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   541            C        ;Output:      reg_acc2, reg_acc1
   542            C        ;description: reg_acc2/reg_acc1 is the reslut;
   543            C        ;             reg_acc3 is a symbol:
   544            C        ;             0X00 Mean reslut is plus
   545            C        ;             0X01 Mean reslut is negative
   546            C        ;*****************************************************************
   547            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   548            C                BC      STATUS,C
   549            C                MOV     A,reg_acc3
   550            C                SUB     reg_acc1,A
   551            C                JBC     STATUS,C
   552            C                JMP     Subtration_End
   553            C                CLR     reg_acc3
   554            C                MOV     A,@0X01
   555            C                SUB     A,reg_acc2
   556            C                JBC     STATUS,C
   557            C                DEC     reg_acc2
   558            C                JBC     STATUS,C
   559            C                INC     reg_acc3
   560            C          Subtration_End:
   561            C                ENDM
   562            C        
   563            C        ;**********************************************************************;
   564            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   565            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   566            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   567            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   568            C        ; Variable Register:None                                               ;
   569            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   570            C        ;**********************************************************************;
   571            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   572            C        ;
   573            C                MOV     A, @8           ;Recurrence Cortrol Data
   574            C                MOV     reg_acc, A
   575            C                CLRA                    ;Check Divisor Is Zero
   576            C                OR      A, reg_acc2     ;Divisor load into A register
   577            C                JBC     STATUS, 2
   578            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   579            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin PerationThen A=1
   580            C        $_Div_Sub:
   581            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   582            C                RLC     reg_acc2
   583            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   584            C                SUB     reg_acc2, a
   585            C                JBC     STATUS, C
   586            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   587            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   588            C                ADD     reg_acc2, A     ;Revert Dividend
   589            C        $_Div_Cnt:
   590            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   591            C                JMP     $_Div_Sub
   592            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   593            C        $_Div_Out:
   594            C                ENDM
   595            C        ;
   596            C        ;**********************************************************************;
   597            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   598            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   599            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   600            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   601            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   602            C        ; Variable Register:None                                               ;
   603            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   604            C        ;**********************************************************************;
   605            C        ;
   606            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   607            C        ;
   608            C                MOV     A, @16          ;Recurrence Cortrol Data
   609            C                MOV     reg_acc, A
   610            C                CLRA                    ;Check Divisor Is Zero
   611            C                OR      A, reg_acc3     ;Divisor load into A register
   612            C                JBC     STATUS, Z
   613            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   614            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin PerationThen A=1
   615            C        $_Div_Sub:
   616            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   617            C                RLC     reg_acc2
   618            C                RLC     reg_acc3
   619            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   620            C                JBS     STATUS, C
   621            C                JMP     $_Div_S_0
   622            C                SUB     reg_acc3, A
   623            C                JMP     $_Div_Cnt
   624            C        $_Div_S_0:
   625            C                SUB     reg_acc3, A
   626            C                JBC     STATUS, C
   627            C                JMP     $_Div_Cnt
   628            C                BC      reg_acc1, 0
   629            C                ADD     reg_acc3, A
   630            C        $_Div_Cnt:
   631            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   632            C                JMP     $_Div_Sub
   633            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   634            C        $_Div_Out:
   635            C                ENDM
   636            C        ;
   637            C        ;**********************************************************************;
   638            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   639            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   640            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   641            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   642            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   643            C        ; Variable Register:None                                               ;
   644            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   645            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   646            C        ;**********************************************************************;
   647            C        ;
   648            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   649            C        ;
   650            C                CLRA
   651            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   652            C                OR      A, reg_acc4
   653            C                JBC     STATUS, Z
   654            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   655            C                MOV     A, @16          ;Recurrence Cortrol Data
   656            C                MOV     reg_acc, A
   657            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1
   658            C                CLR     reg_acc6
   659            C        $_Div_Sub:
   660            C                BC      STATUS, C       ;Clear c Flag
   661            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   662            C                RLC     reg_acc2
   663            C                RLC     reg_acc5
   664            C                RLC     reg_acc6
   665            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   666            C                SUB     A, reg_acc6     ;Check High Word  Equal
   667            C                JBS     STATUS, Z
   668            C                JMP     $_Div_Set
   669            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   670            C                SUB     A, reg_acc5
   671            C        $_Div_Set:
   672            C                JBS     STATUS, C
   673            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   674            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   675            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   676            C                SUB     reg_acc5, A     ;Save Diviso
   677            C                JBS     STATUS, C
   678            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   679            C                MOV     A, reg_acc4
   680            C                SUB     reg_acc6, A
   681            C        $_Div_S_0:
   682            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   683            C                JMP     $_Div_Sub
   684            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   685            C                MOV     reg_acc4, A
   686            C                MOV     A, reg_acc5
   687            C                MOV     reg_acc3, A
   688            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   689            C        $_Div_Out:
   690            C                ENDM
   691            C        ;
   692            C        ;**********************************************************************;
   693            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   694            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   695            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   696            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   697            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   698            C        ; Variable Register:None                                               ;
   699            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   700            C        ;**********************************************************************;
   701            C        ;
   702            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   703            C        ;
   704            C                MOV     A, @24          ;Recurrence Cortrol Data
   705            C                MOV     reg_acc, A
   706            C                CLRA                    ;Check Divisor Is Zero
   707            C                OR      A, reg_acc4     ;Divisor load into A register
   708            C                JBC     STATUS, Z
   709            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   710            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin PerationThen A=1
   711            C        $_Div_Sub:
   712            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   713            C                RLC     reg_acc2
   714            C                RLC     reg_acc3
   715            C                RLC     reg_acc4
   716            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   717            C                JBS     STATUS, C
   718            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   719            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   720            C                JMP     $_Div_Cnt
   721            C        $_Div_S_0:
   722            C                SUB     reg_acc4, A
   723            C                JBC     STATUS, C
   724            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   725            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   726            C                ADD     reg_acc4, A     ;Revert Dividend
   727            C        $_Div_Cnt:
   728            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   729            C                JMP     $_Div_Sub
   730            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   731            C        $_Div_Out:
   732            C                ENDM
   733            C        ;
   734            C        ;**********************************************************************;
   735            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   736            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   737            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   738            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   739            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   740            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   741            C        ;               Remainder reg_acc5, reg_acc4                           ;
   742            C        ; Variable Register: None                                              ;
   743            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   744            C        ;                   , reg_acc7(0x27)                                   ;
   745            C        ;**********************************************************************;
   746            C        ;
   747            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   748            C        ;
   749            C                CLRA
   750            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   751            C                OR      A, reg_acc5
   752            C                JBC     STATUS, Z
   753            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   754            C                MOV     A, @24          ;Recurrence Cortrol Data
   755            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   756            C                CLR     reg_acc6        ;clear Remainder register
   757            C                CLR     reg_acc7
   758            C        $_Div_Sub:
   759            C                BC      STATUS, C       ;Clear c Flag
   760            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   761            C                RLC     reg_acc2
   762            C                RLC     reg_acc3
   763            C                RLC     reg_acc6
   764            C                RLC     reg_acc7
   765            C                JBC     STATUS, C
   766            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   767            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   768            C                SUB     A, reg_acc7     ;Check High Word  Equal
   769            C                JBS     STATUS, Z
   770            C                JMP     $_Div_Set
   771            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   772            C                SUB     A, reg_acc6
   773            C        $_Div_Set:
   774            C                JBS     STATUS, C
   775            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   776            C        $_Div_Set_1:
   777            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   778            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   779            C                SUB     reg_acc6, A     ;Save Diviso
   780            C                JBS     STATUS, C
   781            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   782            C                MOV     A, reg_acc5
   783            C                SUB     reg_acc7, A
   784            C        $_Div_S_0:
   785            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   786            C                JMP     $_Div_Sub
   787            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   788            C                MOV     reg_acc5, A
   789            C                MOV     A, reg_acc6
   790            C                MOV     reg_acc4, A
   791            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   792            C        $_Div_Out:
   793            C                ENDM
   794            C        ;
   795            C        ;**********************************************************************;
   796            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   797            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   798            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   799            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   800            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   801            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   802            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   803            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   804            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   805            C        ; Variable Register:None                                               ;
   806            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   807            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   808            C        ;**********************************************************************;
   809            C        ;
   810            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   811            C        ;
   812            C                CLRA
   813            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   814            C                OR      A, reg_acc5
   815            C                OR      A, reg_acc6
   816            C                JBC     STATUS, Z
   817            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   818            C                MOV     A, @24          ;Recurrence Cortrol Data
   819            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   820            C                CLR     reg_acc7        ;clear Remainder register
   821            C                CLR     reg_acc8
   822            C                CLR     reg_acc9
   823            C        $_Div_Sub:
   824            C                BC      STATUS, C       ;Clear c Flag
   825            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   826            C                RLC     reg_acc2
   827            C                RLC     reg_acc3
   828            C                RLC     reg_acc7
   829            C                RLC     reg_acc8
   830            C                RLC     reg_acc9
   831            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   832            C                SUB     A, reg_acc9     ;Check High Word  Equal
   833            C                JBS     STATUS, Z
   834            C                JMP     $_Div_Set
   835            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   836            C                SUB     A, reg_acc8
   837            C                JBS     STATUS, Z
   838            C                JMP     $_Div_Set
   839            C                MOV     A, reg_acc4
   840            C                SUB     A, reg_acc7
   841            C        $_Div_Set:
   842            C                JBS     STATUS, C
   843            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   844            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   845            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   846            C                SUB     reg_acc7, A     ;Save Diviso
   847            C                JBS     STATUS, C
   848            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   849            C                MOV     A, reg_acc5
   850            C                SUB     reg_acc8, A
   851            C                JBS     STATUS, C
   852            C                DEC     reg_acc9
   853            C                MOV     A, reg_acc6
   854            C                SUB     reg_acc9, A
   855            C        $_Div_S_0:
   856            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   857            C                JMP     $_Div_Sub
   858            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   859            C                MOV     reg_acc6, A
   860            C                MOV     A, reg_acc8
   861            C                MOV     reg_acc5, A
   862            C                MOV     A, reg_acc7
   863            C                MOV     reg_acc4, A
   864            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   865            C        $_Div_Out:
   866            C                ENDM
   867            C        ;
   868            C        ;**********************************************************************;
   869            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   870            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   871            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   872            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   873            C        ;               Divisor   reg_acc5                                     ;
   874            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   875            C        ;               Remainder reg_acc5                                     ;
   876            C        ; Variable Register:None                                               ;
   877            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   878            C        ;**********************************************************************;
   879            C        ;
   880            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   881            C        ;
   882            C                MOV     A, @32          ;Recurrence Cortrol Data
   883            C                MOV     reg_acc, A
   884            C                CLRA                    ;Check Divisor Is Zero
   885            C                OR      A, reg_acc5     ;Divisor load into A register
   886            C                JBC     STATUS, Z
   887            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   888            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1.
   889            C        $_Div_Sub:
   890            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   891            C                RLC     reg_acc2
   892            C                RLC     reg_acc3
   893            C                RLC     reg_acc4
   894            C                RLC     reg_acc5
   895            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   896            C                JBS     STATUS, C
   897            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   898            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   899            C                JMP     $_Div_Cnt
   900            C        $_Div_S_0:
   901            C                SUB     reg_acc5, A
   902            C                JBC     STATUS, C
   903            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   904            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   905            C                ADD     reg_acc5, A     ;Revert Dividend
   906            C        $_Div_Cnt:
   907            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   908            C                JMP     $_Div_Sub
   909            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   910            C        $_Div_Out:
   911            C                ENDM
   912            C        ;
   913            C        ;**********************************************************************;
   914            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   915            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   916            C        ;               (reg_acc6, reg_acc5)                                   ;
   917            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   918            C        ;               --(reg_acc6, reg_acc5)                                 ;
   919            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   920            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   921            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   922            C        ;               Remainder reg_acc6, reg_acc5                           ;
   923            C        ; Variable Register:None                                               ;
   924            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   925            C        ;                   , reg_acc8(0x28)                                   ;
   926            C        ;**********************************************************************;
   927            C        ;
   928            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   929            C        ;
   930            C                CLRA
   931            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   932            C                OR      A, reg_acc5
   933            C                JBC     STATUS, Z
   934            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   935            C                MOV     A, @32          ;Recurrence Cortrol Data
   936            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   937            C                CLR     reg_acc7        ;clear Remainder register
   938            C                CLR     reg_acc8
   939            C        $_Div_Sub:
   940            C                BC      STATUS, C       ;Clear c Flag
   941            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   942            C                RLC     reg_acc2
   943            C                RLC     reg_acc3
   944            C                RLC     reg_acc4
   945            C                RLC     reg_acc7
   946            C                RLC     reg_acc8
   947            C                JBC     STATUS, C
   948            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   949            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   950            C                SUB     A, reg_acc8     ;Check High Word  Equal
   951            C                JBS     STATUS, Z
   952            C                JMP     $_Div_Set
   953            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   954            C                SUB     A, reg_acc7
   955            C        $_Div_Set:
   956            C                JBS     STATUS, C
   957            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   958            C        $_Div_Set_1:
   959            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   960            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   961            C                SUB     reg_acc7, A     ;Save Divisor
   962            C                JBS     STATUS, C
   963            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   964            C                MOV     A, reg_acc6
   965            C                SUB     reg_acc8, A
   966            C        $_Div_S_0:
   967            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   968            C                JMP     $_Div_Sub
   969            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   970            C                MOV     reg_acc6, A
   971            C                MOV     A, reg_acc7
   972            C                MOV     reg_acc5, A
   973            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   974            C        $_Div_Out:
   975            C                ENDM
   976            C        ;
   977            C        ;**********************************************************************;
   978            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   979            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   980            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   981            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   982            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   983            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   984            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   985            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   986            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   987            C        ; Variable Register:None                                               ;
   988            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   989            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   990            C        ;**********************************************************************;
   991            C        ;
   992            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   993            C        ;
   994            C                CLRA
   995            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   996            C                OR      A, reg_acc6
   997            C                OR      A, reg_acc5
   998            C                JBC     STATUS, Z
   999            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1000            C                MOV     A, @32          ;Recurrence Cortrol Data
  1001            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1002            C                CLR     reg_acc8        ;clear Remainder register
  1003            C                CLR     reg_acc9
  1004            C                CLR     reg_acca
  1005            C        $_Div_Sub:
  1006            C                BC      STATUS, 0       ;Clear c Flag
  1007            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1008            C                RLC     reg_acc2
  1009            C                RLC     reg_acc3
  1010            C                RLC     reg_acc4
  1011            C                RLC     reg_acc8
  1012            C                RLC     reg_acc9
  1013            C                RLC     reg_acca
  1014            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1015            C                JMP     $_Div_Set_1
  1016            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1017            C                SUB     A, reg_acca     ;Check High Word  Equal
  1018            C                JBS     STATUS, Z
  1019            C                JMP     $_Div_Set
  1020            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1021            C                SUB     A, reg_acc9
  1022            C                JBS     STATUS, Z
  1023            C                JMP     $_Div_Set
  1024            C                MOV     A, reg_acc5
  1025            C                SUB     A, reg_acc8
  1026            C        $_Div_Set:
  1027            C                JBS     STATUS, C
  1028            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1029            C        $_Div_Set_1:
  1030            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1031            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1032            C                SUB     reg_acc8, A     ;Save Divisor
  1033            C                JBS     STATUS, C
  1034            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1035            C                MOV     A, reg_acc6
  1036            C                SUB     reg_acc9, A
  1037            C                JBS     STATUS, C
  1038            C                DEC     reg_acca
  1039            C                MOV     A, reg_acc7
  1040            C                SUB     reg_acca, A
  1041            C        $_Div_S_0:
  1042            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1043            C                JMP     $_Div_Sub
  1044            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1045            C                MOV     reg_acc7, A
  1046            C                MOV     A, reg_acc9
  1047            C                MOV     reg_acc6, A
  1048            C                MOV     A, reg_acc8
  1049            C                MOV     reg_acc5, A
  1050            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1051            C        $_Div_Out:
  1052            C                ENDM
  1053            C        ;
  1054            C        ;**********************************************************************;
  1055            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1056            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1057            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1058            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1059            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1060            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1061            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1062            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1063            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1064            C        ; Variable Register:None                                               ;
  1065            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1066            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1067            C        ;**********************************************************************;
  1068            C        ;
  1069            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1070            C        ;
  1071            C                CLRA
  1072            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1073            C                OR      A, reg_acc7
  1074            C                OR      A, reg_acc6
  1075            C                OR      A, reg_acc5
  1076            C                JBC     STATUS, Z
  1077            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1078            C                MOV     A, @32          ;Recurrence Cortrol Data
  1079            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1080            C                CLR     reg_acc9        ;clear Remainder register
  1081            C                CLR     reg_acca
  1082            C                CLR     reg_accb
  1083            C                CLR     reg_accc
  1084            C        $_Div_Sub:
  1085            C                BC      STATUS, C       ;Clear c Flag
  1086            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1087            C                RLC     reg_acc2
  1088            C                RLC     reg_acc3
  1089            C                RLC     reg_acc4
  1090            C                RLC     reg_acc9
  1091            C                RLC     reg_acca
  1092            C                RLC     reg_accb
  1093            C                RLC     reg_accc
  1094            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1095            C                SUB     A, reg_accc     ;Check High Word  Equal
  1096            C                JBS     STATUS, Z
  1097            C                JMP     $_Div_Set
  1098            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1099            C                SUB     A, reg_accb
  1100            C                JBS     STATUS, Z
  1101            C                JMP     $_Div_Set
  1102            C                MOV     A, reg_acc6
  1103            C                SUB     A, reg_acca
  1104            C                JBS     STATUS, Z
  1105            C                JMP     $_Div_Set
  1106            C                MOV     A, reg_acc5
  1107            C                SUB     A, reg_acc9
  1108            C        $_Div_Set:
  1109            C                JBS     STATUS, C
  1110            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1111            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1112            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1113            C                SUB     reg_acc9, A     ;Save Divisor
  1114            C                JBS     STATUS, C
  1115            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1116            C                MOV     A, reg_acc6
  1117            C                SUB     reg_acca, A
  1118            C                JBS     STATUS, C
  1119            C                DEC     reg_accb
  1120            C                MOV     A, reg_acc7
  1121            C                SUB     reg_accb, A
  1122            C                JBS     STATUS, C
  1123            C                DEC     reg_accc
  1124            C                MOV     A, reg_acc8
  1125            C                SUB     reg_accc, A
  1126            C        $_Div_S_0:
  1127            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1128            C                JMP     $_Div_Sub
  1129            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1130            C                MOV     reg_acc8, A
  1131            C                MOV     A, reg_accb
  1132            C                MOV     reg_acc7, A
  1133            C                MOV     A, reg_acca
  1134            C                MOV     reg_acc6, A
  1135            C                MOV     A, reg_acc9
  1136            C                MOV     reg_acc5, A
  1137            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1138            C        $_Div_Out:
  1139            C                ENDM
  1140            C        ;
  1141            C        ;**********************************************************************;
  1142            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1143            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1144            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1145            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1146            C        ; Register change:reg_acc                                              ;
  1147            C        ;**********************************************************************;
  1148            C        ;
  1149            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1150            C        ;
  1151            C                MOV     A, @8
  1152            C                MOV     reg_acc, A
  1153            C                MOV     A, reg_acc2
  1154            C                CLR     reg_acc2
  1155            C        $Mul11_Loop:
  1156            C                BC      STATUS, C
  1157            C                JBC     reg_acc1, 0
  1158            C                ADD     reg_acc2, A
  1159            C                RRC     reg_acc2
  1160            C                RRC     reg_acc1
  1161            C        ;
  1162            C                DJZ     reg_acc
  1163            C                JMP     $Mul11_Loop
  1164            C                ENDM
  1165            C        ;
  1166            C        ;**********************************************************************;
  1167            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1168            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1169            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1170            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1172            C        ; Register change:reg_acc                                              ;
  1173            C        ;**********************************************************************;
  1174            C        ;
  1175            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1176            C        ;
  1177            C                MOV     A, @16
  1178            C                MOV     reg_acc, A
  1179            C                MOV     A, reg_acc3
  1180            C                CLR     reg_acc3
  1181            C        $Mul12_Loop:
  1182            C                BC      STATUS, C
  1183            C                JBC     reg_acc1, 0
  1184            C                ADD     reg_acc3, A
  1185            C                RRC     reg_acc3
  1186            C                RRC     reg_acc2
  1187            C                RRC     reg_acc1
  1188            C        ;
  1189            C                DJZ     reg_acc
  1190            C                JMP     $Mul12_Loop
  1191            C                ENDM
  1192            C        ;
  1193            C        ;**********************************************************************;
  1194            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1195            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1196            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1197            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1199            C        ; Register change:reg_acc                                              ;
  1200            C        ;**********************************************************************;
  1201            C        ;
  1202            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1203            C        ;
  1204            C                MOV     A, @24
  1205            C                MOV     reg_acc, A
  1206            C                MOV     A, reg_acc4
  1207            C                CLR     reg_acc4
  1208            C        $Mul13_Loop:
  1209            C                BC      STATUS, C
  1210            C                JBC     reg_acc1, 0
  1211            C                ADD     reg_acc4, A
  1212            C                RRC     reg_acc4
  1213            C                RRC     reg_acc3
  1214            C                RRC     reg_acc2
  1215            C                RRC     reg_acc1
  1216            C        ;
  1217            C                DJZ     reg_acc
  1218            C                JMP     $Mul13_Loop
  1219            C                ENDM
  1220            C        ;
  1221            C        ;**********************************************************************;
  1222            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1223            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1224            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1225            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1227            C        ; Register change:reg_acc                                              ;
  1228            C        ;**********************************************************************;
  1229            C        ;
  1230            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1231            C        ;
  1232            C                MOV     A, @32
  1233            C                MOV     reg_acc, A
  1234            C                MOV     A, reg_acc5
  1235            C                CLR     reg_acc5
  1236            C        $Mul14_Loop:
  1237            C                BC      STATUS, C
  1238            C                JBC     reg_acc1, 0
  1239            C                ADD     reg_acc5, A
  1240            C                RRC     reg_acc5
  1241            C                RRC     reg_acc4
  1242            C                RRC     reg_acc3
  1243            C                RRC     reg_acc2
  1244            C                RRC     reg_acc1
  1245            C        ;
  1246            C                DJZ     reg_acc
  1247            C                JMP     $Mul14_Loop
  1248            C                ENDM
  1249            C        ;
  1250            C        ;**********************************************************************;
  1251            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1252            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1253            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1254            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1256            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1257            C        ;**********************************************************************;
  1258            C        ;
  1259            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1260            C        ;
  1261            C                MOV     A, @16
  1262            C                MOV     reg_acc, A
  1263            C                MOV     A, reg_acc4
  1264            C                MOV     reg_acc6, A
  1265            C                MOV     A, reg_acc3
  1266            C                MOV     reg_acc5, A
  1267            C                CLR     reg_acc3
  1268            C                CLR     reg_acc4
  1269            C        $Mul22_Loop:
  1270            C                BC      STATUS, C
  1271            C                JBS     reg_acc1, 0
  1272            C                JMP     $Mul22_Rs
  1273            C                MOV     A, reg_acc5
  1274            C                ADD     reg_acc3, A
  1275            C        ;--------------------------------------
  1276            C                MOV     A, reg_acc4
  1277            C                JBC     STATUS, C
  1278            C                ADD     A, @1
  1279            C                RLC     reg_acc
  1280            C                ADD     A, reg_acc6
  1281            C                MOV     reg_acc4, A
  1282            C                JBC     STATUS, C
  1283            C                BS      reg_acc, 0
  1284            C                RRC     reg_acc
  1285            C        $Mul22_Rs:
  1286            C                RRC     reg_acc4
  1287            C                RRC     reg_acc3
  1288            C                RRC     reg_acc2
  1289            C                RRC     reg_acc1
  1290            C        ;
  1291            C                BC      reg_acc, 7
  1292            C                DJZ     reg_acc
  1293            C                JMP     $Mul22_Loop
  1294            C                ENDM
  1295            C        ;
  1296            C        ;**********************************************************************;
  1297            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1298            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1299            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1300            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1302            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1303            C        ;**********************************************************************;
  1304            C        ;
  1305            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1306            C        ;
  1307            C                MOV     A, @24
  1308            C                MOV     reg_acc, A
  1309            C                MOV     A, reg_acc5
  1310            C                MOV     reg_acc7, A
  1311            C                MOV     A, reg_acc4
  1312            C                MOV     reg_acc6, A
  1313            C                CLR     reg_acc4
  1314            C                CLR     reg_acc5
  1315            C        $Mul23_Loop:
  1316            C                BC      STATUS, C
  1317            C                JBS     reg_acc1, 0
  1318            C                JMP     $Mul23_Rs
  1319            C                MOV     A, reg_acc6
  1320            C                ADD     reg_acc4, A
  1321            C        ;--------------------------------------
  1322            C                MOV     A, reg_acc5
  1323            C                JBC     STATUS, C
  1324            C                ADD     A, @1
  1325            C                RLC     reg_acc
  1326            C                ADD     A, reg_acc7
  1327            C                MOV     reg_acc5, A
  1328            C                JBC     STATUS, C
  1329            C                BS      reg_acc, 0
  1330            C                RRC     reg_acc
  1331            C        $Mul23_Rs:
  1332            C                RRC     reg_acc5
  1333            C                RRC     reg_acc4
  1334            C                RRC     reg_acc3
  1335            C                RRC     reg_acc2
  1336            C                RRC     reg_acc1
  1337            C        ;
  1338            C                BC      reg_acc, 7
  1339            C                DJZ     reg_acc
  1340            C                JMP     $Mul23_Loop
  1341            C                ENDM
  1342            C        ;
  1343            C        ;**********************************************************************;
  1344            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1345            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1346            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1347            C        ;                 , reg_acc2, reg_acc1)                                ;
  1348            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1349            C        ;                 reg_acc6                                             ;
  1350            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1351            C        ;                 reg_acc6                                             ;
  1352            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1353            C        ;**********************************************************************;
  1354            C        ;
  1355            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1356            C        ;
  1357            C                MOV     A, @32
  1358            C                MOV     reg_acc, A
  1359            C                MOV     A, reg_acc6
  1360            C                MOV     reg_acc8, A
  1361            C                MOV     A, reg_acc5
  1362            C                MOV     reg_acc7, A
  1363            C                CLR     reg_acc5
  1364            C                CLR     reg_acc6
  1365            C        $Mul24_Loop:
  1366            C                BC      STATUS, C
  1367            C                JBS     reg_acc1, 0
  1368            C                JMP     $Mul24_Rs
  1369            C                MOV     A, reg_acc7
  1370            C                ADD     reg_acc5, A
  1371            C        ;--------------------------------------
  1372            C                MOV     A, reg_acc6
  1373            C                JBC     STATUS, C
  1374            C                ADD     A, @1
  1375            C                RLC     reg_acc
  1376            C                ADD     A, reg_acc8
  1377            C                MOV     reg_acc6, A
  1378            C                JBC     STATUS, C
  1379            C                BS      reg_acc, 0
  1380            C                RRC     reg_acc
  1381            C        $Mul24_Rs:
  1382            C                RRC     reg_acc6
  1383            C                RRC     reg_acc5
  1384            C                RRC     reg_acc4
  1385            C                RRC     reg_acc3
  1386            C                RRC     reg_acc2
  1387            C                RRC     reg_acc1
  1388            C        ;
  1389            C                BC      reg_acc, 7
  1390            C                DJZ     reg_acc
  1391            C                JMP     $Mul24_Loop
  1392            C                ENDM
  1393            C        ;
  1394            C        ;**********************************************************************;
  1395            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1396            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1397            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1398            C        ;                 , reg_acc2, reg_acc1)                                ;
  1399            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1400            C        ;                 , reg_acc6                                           ;
  1401            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1402            C        ;                 , reg_acc6                                           ;
  1403            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1404            C        ;**********************************************************************;
  1405            C        ;
  1406            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1407            C        ;
  1408            C                MOV     A, @24
  1409            C                MOV     reg_acc, A
  1410            C                MOV     A, reg_acc4
  1411            C                MOV     reg_acc7, A
  1412            C                MOV     A, reg_acc5
  1413            C                MOV     reg_acc8, A
  1414            C                MOV     A, reg_acc6
  1415            C                MOV     reg_acc9, A
  1416            C                CLR     reg_acc4
  1417            C                CLR     reg_acc5
  1418            C                CLR     reg_acc6
  1419            C        $Mul33_Loop:
  1420            C                BC      STATUS, C
  1421            C                JBS     reg_acc1, 0
  1422            C                JMP     $Mul33_Rs
  1423            C                MOV     A, reg_acc7
  1424            C                ADD     reg_acc4, A
  1425            C        ;--------------------------------------
  1426            C                MOV     A, reg_acc5
  1427            C                JBC     STATUS, C
  1428            C                ADD     A, @1
  1429            C                RLC     reg_acc
  1430            C                ADD     A, reg_acc8
  1431            C                MOV     reg_acc5, A
  1432            C                JBC     STATUS, C
  1433            C                BS      reg_acc, 0
  1434            C                RRC     reg_acc
  1435            C        ;--------------------------------------
  1436            C                MOV     A, reg_acc6
  1437            C                JBC     STATUS, C
  1438            C                ADD     A, @1
  1439            C                RLC     reg_acc
  1440            C                ADD     A, reg_acc9
  1441            C                MOV     reg_acc6, A
  1442            C                JBC     STATUS, C
  1443            C                BS      reg_acc, 0
  1444            C                RRC     reg_acc
  1445            C        $Mul33_Rs:
  1446            C                RRC     reg_acc6
  1447            C                RRC     reg_acc5
  1448            C                RRC     reg_acc4
  1449            C                RRC     reg_acc3
  1450            C                RRC     reg_acc2
  1451            C                RRC     reg_acc1
  1452            C        ;
  1453            C                BC      reg_acc, 7
  1454            C                DJZ     reg_acc
  1455            C                JMP     $Mul33_Loop
  1456            C                ENDM
  1457            C        ;
  1458            C        ;**********************************************************************;
  1459            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1460            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1461            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1462            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1463            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1464            C        ;                 , reg_acc6, reg_acc7                                 ;
  1465            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1466            C        ;                 , reg_acc6, reg_acc7                                 ;
  1467            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1468            C        ;**********************************************************************;
  1469            C        ;
  1470            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1471            C        ;
  1472            C                MOV     A, @32
  1473            C                MOV     reg_acc, A
  1474            C                MOV     A, reg_acc5
  1475            C                MOV     reg_acc8, A
  1476            C                MOV     A, reg_acc6
  1477            C                MOV     reg_acc9, A
  1478            C                MOV     A, reg_acc7
  1479            C                MOV     reg_acca, A
  1480            C                CLR     reg_acc5
  1481            C                CLR     reg_acc6
  1482            C                CLR     reg_acc7
  1483            C        $Mul34_Loop:
  1484            C                BC      STATUS, C
  1485            C                JBS     reg_acc1, 0
  1486            C                JMP     $Mul34_Rs
  1487            C                MOV     A, reg_acc8
  1488            C                ADD     reg_acc5, A
  1489            C        ;--------------------------------------
  1490            C                MOV     A, reg_acc6
  1491            C                JBC     STATUS, C
  1492            C                ADD     A, @1
  1493            C                RLC     reg_acc
  1494            C                ADD     A, reg_acc9
  1495            C                MOV     reg_acc6, A
  1496            C                JBC     STATUS, C
  1497            C                BS      reg_acc, 0
  1498            C                RRC     reg_acc
  1499            C        ;--------------------------------------
  1500            C                MOV     A, reg_acc7
  1501            C                JBC     STATUS, C
  1502            C                ADD     A, @1
  1503            C                RLC     reg_acc
  1504            C                ADD     A, reg_acca
  1505            C                MOV     reg_acc7, A
  1506            C                JBC     STATUS, C
  1507            C                BS      reg_acc, 0
  1508            C                RRC     reg_acc
  1509            C        $Mul34_Rs:
  1510            C                RRC     reg_acc7
  1511            C                RRC     reg_acc6
  1512            C                RRC     reg_acc5
  1513            C                RRC     reg_acc4
  1514            C                RRC     reg_acc3
  1515            C                RRC     reg_acc2
  1516            C                RRC     reg_acc1
  1517            C        ;
  1518            C                BC      reg_acc, 7
  1519            C                DJZ     reg_acc
  1520            C                JMP     $Mul34_Loop
  1521            C                ENDM
  1522            C        ;
  1523            C        ;**********************************************************************;
  1524            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1525            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1526            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1527            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1528            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1529            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1530            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1531            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1532            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1533            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1534            C        ;**********************************************************************;
  1535            C        ;
  1536            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1537            C        ;
  1538            C                MOV     A, @32
  1539            C                MOV     reg_acc, A
  1540            C                MOV     A, reg_acc5
  1541            C                MOV     reg_acc9, A
  1542            C                MOV     A, reg_acc6
  1543            C                MOV     reg_acca, A
  1544            C                MOV     A, reg_acc7
  1545            C                MOV     reg_accb, A
  1546            C                MOV     A, reg_acc8
  1547            C                MOV     reg_accc, A
  1548            C                CLR     reg_acc5
  1549            C                CLR     reg_acc6
  1550            C                CLR     reg_acc7
  1551            C                CLR     reg_acc8
  1552            C        $Mul44_Loop:
  1553            C                BC      STATUS, C
  1554            C                JBS     reg_acc1, 0
  1555            C                JMP     $Mul44_Rs
  1556            C                MOV     A, reg_acc9
  1557            C                ADD     reg_acc5, A
  1558            C        ;--------------------------------------
  1559            C                MOV     A, reg_acc6
  1560            C                JBC     STATUS, C
  1561            C                ADD     A, @1
  1562            C                RLC     reg_acc
  1563            C                ADD     A, reg_acca
  1564            C                MOV     reg_acc6, A
  1565            C                JBC     STATUS, C
  1566            C                BS      reg_acc, 0
  1567            C                RRC     reg_acc
  1568            C        ;--------------------------------------
  1569            C                MOV     A, reg_acc7
  1570            C                JBC     STATUS, C
  1571            C                ADD     A, @1
  1572            C                RLC     reg_acc
  1573            C                ADD     A, reg_accb
  1574            C                MOV     reg_acc7, A
  1575            C                JBC     STATUS, C
  1576            C                BS      reg_acc, 0
  1577            C                RRC     reg_acc
  1578            C        ;--------------------------------------
  1579            C                MOV     A, reg_acc8
  1580            C                JBC     STATUS, C
  1581            C                ADD     A, @1
  1582            C                RLC     reg_acc
  1583            C                ADD     A, reg_accc
  1584            C                MOV     reg_acc8, A
  1585            C                JBC     STATUS, C
  1586            C                BS      reg_acc, 0
  1587            C                RRC     reg_acc
  1588            C        $Mul44_Rs:
  1589            C                RRC     reg_acc8
  1590            C                RRC     reg_acc7
  1591            C                RRC     reg_acc6
  1592            C                RRC     reg_acc5
  1593            C                RRC     reg_acc4
  1594            C                RRC     reg_acc3
  1595            C                RRC     reg_acc2
  1596            C                RRC     reg_acc1
  1597            C        ;
  1598            C                BC      reg_acc, 7
  1599            C                DJZ     reg_acc
  1600            C                JMP     $Mul44_Loop
  1601            C                ENDM
  1602            C        
  1603            C        
  1604            C        
  1605            C        ;*****************************************************************
  1606            C        ;Function:    generat random data
  1607            C        ;Input:       @banksel,@address,@length
  1608            C        ;Output:      rang by address which is the lowest address
  1609            C        ;description: used common register temp,temp1,temp2 for operation
  1610            C        ;             rand address must be in the same bank
  1611            C        ;             TEMP:  Operate Data TEMP
  1612            C        ;             TEMP1:
  1613            C        ;             TEMP2:
  1614            C        ;*****************************************************************
  1615            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1616            C        	MOV         TEMP,A
  1617            C        	BANK        @BankSel
  1618            C        	MOV         A,Address
  1619            C        	ADD         TEMP,A        ; save latest data as current seed
  1620            C        
  1621            C        	CLR         RSR
  1622            C          $_RAND_SEED_LOOP1:
  1623            C        	MOV         A,R0
  1624            C        	ADD         TEMP,A        ; seed
  1625            C        
  1626            C        	RLC         TEMP          ; x*y+1 MOD z
  1627            C        	RLC         TEMP
  1628            C        	RLC         TEMP
  1629            C        	INC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	RRC         TEMP
  1633            C        	JBS         STATUS,C
  1634            C        	BC          TEMP,0
  1635            C        	JBC         STATUS,C
  1636            C        	BS          TEMP,0
  1637            C        
  1638            C        	INC         RSR
  1639            C        	MOV         A,RSR
  1640            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1641            C        	XOR         A,@0X40
  1642            C        	JBS         STATUS,Z
  1643            C        	JMP         $_RAND_SEED_LOOP1
  1644            C        	MOV         A,R0
  1645            C        	ADD         TEMP,A          ;next seed
  1646            C        
  1647            C        	MOV         A,@length
  1648            C        	MOV         TEMP1,A
  1649            C        	MOV         A,@Address
  1650            C        	MOV         TEMP2,A
  1651            C        	MOV         RSR,A
  1652            C        	BANK        @BankSel
  1653            C        	MOV         A,RSR
  1654            C        	MOV         TEMP2,A       ; save address base
  1655            C        	MESSAGE     "adding form 0x00 to bank 0"
  1656            C        
  1657            C          $_RAND_DATA_LOOP1:
  1658            C        	MOV         A,TEMP2
  1659            C        	MOV         RSR,A
  1660            C        	MOV         A,TEMP
  1661            C        	MOV         R0,A
  1662            C        
  1663            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1664            C        	RLC         TEMP
  1665            C        	RLC         TEMP
  1666            C        	INC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	RRC         TEMP
  1670            C        	JBS         STATUS,C
  1671            C        	BC          TEMP,0
  1672            C        	JBC         STATUS,C
  1673            C        	BS          TEMP,0
  1674            C        
  1675            C        	INC         TEMP2
  1676            C        	DJZ         TEMP1
  1677            C        	JMP         $_RAND_DATA_LOOP1:
  1678            C        	NOP
  1679            C        
  1680            C          ENDM
  1681            C        
    14                     include "..\..\..\..\include\EM78xx\inc\EM78CtrlIns.H" 
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;sbit operator
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 
   284            C        ; :,ACC,R3
   285            C        ; A      -> A_TEMP
   286            C        ; R4    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;R5              ;SAVE R5(R5)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;R4              ;SAVE R4(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;R4,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;R4,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;========================== EM78P520 =================================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;R4,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ;long jmp/long call
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; select page
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; roboticized call
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; roboticized call
   426            C        ; input:NUM = page number,  ADDRESS =  code address
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; roboticized jmp
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ; roboticized jmp
   460            C        ; input:NUM = page number,  ADDRESS =  code address
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; select bank
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611E.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C        	MOV                 A,@0XD0
   513            C        	MOV                 RSR,A
   514            C          ;$_CLRLOOP:  
   515            C        	CLR                 R0
   516            C        	INC                 RSR
   517            C        	MOV                 A,RSR
   518            C        	AND                 A,@0X3F
   519            C        	JBS                 STATUS,Z
   520            C        	JMP                 $-5             ;$_CLRLOOP
   521            C        	INC                 BSR
   522            C        	BS                  RSR,5
   523            C        	MOV                 A,@0X07
   524            C        	AND                 BSR,A
   525            C        	BS                  RSR,6
   526            C        	JBS                 STATUS,Z
   527            C        	JMP                 $-12            ;$_CLRLOOP
   528            C        
   529            C        ELSEIFDEF EM78M611E.H
   530            C         	MOV     A,@0x10
   531            C        	MOV     R4,A
   532            C        
   533            C        	CLR     R0
   534            C        	INC     R4
   535            C        	JBC     R4,6
   536            C        	BS      R4,5
   537            C        	JBC     R4,7
   538            C        	BS      R4,5
   539            C        	JBS     R3,Z
   540            C        	JMP     $-7
   541            C        	CLR     R4
   542            C        
   543            C        	MOV     A,@0X11
   544            C        	MOV     RD,A
   545            C        	CLR     RE
   546            C        	MOV     A,@1
   547            C        	MOV     RD,A
   548            C        	MOV     A,@0X00
   549            C        	MOV     RE,A
   550            C        	MOV     RE,A
   551            C        	MOV     RE,A
   552            C        	MOV     RE,A
   553            C        	MOV     RE,A
   554            C        	MOV     RE,A
   555            C        	MOV     RE,A
   556            C        	MOV     RE,A
   557            C        	BS      RC,5
   558            C        
   559            C        ELSEIFDEF EM78P447.H
   560            C         	MOV     A,@0x10
   561            C        	MOV     R4,A
   562            C        
   563            C        	CLR     R0
   564            C        	INC     R4
   565            C        	JBC     R4,6
   566            C        	BS      R4,5
   567            C        	JBC     R4,7
   568            C        	BS      R4,5
   569            C        	JBS     R3,Z
   570            C        	JMP     $-7
   571            C        	CLR     R4
   572            C        
   573            C        ELSEIFDEF EM78P468.H
   574            C        	MOV     A,@0X10
   575            C        	MOV     0X04,A
   576            C        
   577            C        	CLR     0X00
   578            C        	INC     0X04
   579            C        	JBC     0X04,6
   580            C        	BS      0X04,5
   581            C        	JBC     0X04,7
   582            C        	BS      0X04,5
   583            C        	JBS     0X03,2
   584            C        	JMP     $-7
   585            C        
   586            C        ELSEIFDEF EM78P458.H
   587            C        	MOV     A,@0X10
   588            C        	MOV     R4,A
   589            C        
   590            C        	CLR     R0
   591            C        	INC     R4
   592            C        	JBC     R4,6
   593            C        	BS      R4,5
   594            C        	JBS     R4,7
   595            C        	JMP     $-5
   596            C        	CLR     R4
   597            C        
   598            C        ELSEIFDEF EM78P451.H
   599            C        	MOV     A,@0X10
   600            C        	MOV     R4,A
   601            C        
   602            C        	CLR     R0
   603            C        	INC     R4
   604            C        	JBC     R4,6
   605            C        	BS      R4,5
   606            C        	JBC     R4,7
   607            C        	BS      R4,5
   608            C        	JBS     STATUS,Z
   609            C        	JMP     $-7
   610            C        	CLR		RSR
   611            C        
   612            C        ELSEIFDEF EM78F651.H
   613            C        	MOV		A,@0X10
   614            C        	MOV		RSR,A
   615            C        
   616            C        	CLR		R0
   617            C        	INC		RSR
   618            C        	JBC	 	RSR,6
   619            C        	BS		RSR,5
   620            C        	JBC		RSR,7
   621            C        	BS		RSR,5
   622            C        	JBS		Z
   623            C        	JMP             $-7
   624            C        	CLR		RSR
   625            C        
   626            C        ELSEIFDEF EM78P153N.H
   627            C                MOV     A,@0X10
   628            C                MOV     RSR,A
   629            C        
   630            C                CLR     R0
   631            C                INC     RSR
   632            C                JBC     RSR,5
   633            C                JBS     RSR,4
   634            C                JMP     $-4
   635            C         
   636            C        
   637            C        ELSE
   638            C        	MOV     A,@0x10        ; clear all ram bank
   639            C        	MOV     R4,A
   640            C        
   641            C        	CLR     R0
   642            C        	INC     R4
   643            C        	JBC     R4,6
   644            C        	BS      R4,5
   645            C        	JBC     R4,7
   646            C        	BS      R4,5
   647            C        	JBS     R3,Z
   648            C        	JMP     $-7
   649            C        	CLR     R4
   650            C        	MESSAGE "Clear all RAM bank"
   651            C        ENDIF
   652            C        ENDM
   653            C        
   654            C        ;*******************************************
   655            C        ; RAM clear function
   656            C        ; [ELSE]: default the MCU have four bank
   657            C        ; others: xx.h must be define in "xx.h"
   658            C        ;*******************************************
   659            C        ClrCommRamBank MACRO
   660            C        	MOV                 A, @0X10        ; RAM 
   661            C        	MOV                 R4, A
   662            C        
   663            C        	WDTC
   664            C        	CLR                 R0
   665            C        	INC                 R4
   666            C        	MOV                 A,@0B00111111
   667            C        	AND                 A,R4
   668            C        	SUB                 A,@0X1F
   669            C        	JBC                 R3,C
   670            C        	JMP                 $-7
   671            C        	CLR                 R4
   672            C        ENDM
   673            C        
   674            C        ;********************************************************************
   675            C        ;********************************************************************
   676            C        Clearbuffer MACRO
   677            C          ifdef EM78P520.H
   678            C        	MOV                 A,@0B11100000   ; clear bank0 ram
   679            C        	MOV                 R4,A
   680            C        	BANK                0               ; R5=0
   681            C        
   682            C        	WDTC
   683            C        	CLR                 R0
   684            C        	INC                 R4
   685            C        	MOV                 A,@0B00111111
   686            C        	AND                 A,R4
   687            C        	XOR                 A,@0X3F
   688            C        	JBS                 R3,Z
   689            C        	JMP                 $-7
   690            C        	CLR                 R0
   691            C        	MOV                 A,@0B11000000
   692            C        	MOV                 R4,A
   693            C        
   694            C          elseifdef EM78M611E.H
   695            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   696            C        	MOV                 R4,A
   697            C        
   698            C        	WDTC
   699            C        	CLR                 R0
   700            C        	INC                 R4
   701            C        	MOV                 A,@0B00111111
   702            C        	AND                 A,R4
   703            C        	XOR                 A,@0X3F
   704            C        	JBS                 R3,Z
   705            C        	JMP                 $-7
   706            C        	CLR                 R0
   707            C        	CLR                 R4
   708            C        
   709            C          else
   710            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   711            C        	MOV                 R4,A
   712            C        
   713            C        	WDTC
   714            C        	CLR                 R0
   715            C        	INC                 R4
   716            C        	MOV                 A,@0B00111111
   717            C        	AND                 A,R4
   718            C        	XOR                 A,@0X3F
   719            C        	JBS                 R3,Z
   720            C        	JMP                 $-7
   721            C        	CLR                 R4
   722            C          endif
   723            C        ENDM
   724            C        
   725            C        
    15                     include "config.h"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        
    11            C        * ---------------------- note ------------------------------
    12            C        2010-6-25 15:01:47    creat project file 1.1.1.100625_Alpha
    13            C        
    14            C        
    15            C        **********************************************************************/
    16            C        ;-------------------------------------------------------------------------
    17            C        config.h   EQU    config.h
    18            C        
    19            C        ;-------------------------------------------------------------------------
    20       0001 C        DebugDisplay                    EQU     1     ; debug switch
    21       0000 C        MassageDisplay                  EQU     0     ; massage display switch
    22       0020 C        DataBufferBase                  EQU     0x20  ; address:0x20 ,bit6:select all bank
    23       0004 C        SetComuSyncTime                 EQU     4     ; 2ms sync header time
    24       0004 C        SetComuTime                     EQU     4     ; 4ms Communicte System
    25       00FA C        SetSleepTime                    EQU     250   ; Into sleep Time=(SetSleepTime+1)*2s, default=250
    26       009D C        RX_IDH_DEFAULT                  EQU     0X9D  ; 0XD6  ; 0X9D
    27       00CB C        RX_IDL_DEFAULT                  EQU     0XCB  ; 0XAC  ; 0XCB  ; Adress_default = [RX_IDH_DEFAULT,RX_IDL_DEFAULT&0x0f]
    28       0032 C        LEDTwinklingFreq                EQU     50    ; T=LEDTwinklingFreq*(ComuSyncTime+n*SetComuTime), default=50(400ms)
    29       0012 C        SetChecksumH                    EQU     0X12  ; transmitter cheaksum high byte
    30       0034 C        SetChecksumL                    EQU     0X34  ; transmitter cheaksum low byte
    31            C        
    32            C        
    33            C        
    34            C        
    16                     include "P520txP44.H"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        ;  Description: PAGE0(0X0000-0X03FF): MCU initial
    12            C        ;               PAGE1(0X0400-0X07FF): searchmode
    13            C        ;               PAGE2(0X0800-0X0BFF): normalmode
    14            C        ;               PAGE3(0X0C00-0X0FFF): RF driver
    15            C        ;               PAGE4(0X1000-0X13FF): key scan driver
    16            C        ;               PAGE5(0X1400-0X17FF): CMOS driver
    17            C        ;               PAGE6(0X1800-0X1BFF): CMOS/GS driver
    18            C        ;               PAGE7(0X1C00-0X1FFF): Kalman Filter arithmetic
    19            C        
    20            C        ;========================================================================
    21            C        P520txP44.H                     EQU     P520txP44.H
    22            C        
    23            C        
    24            C        ;--------------------------- function config ----------------------------
    25       0001 C        TCC_T_DEBUG                     EQU     1
    26       0001 C        TIME1_T_DEBUG                   EQU     1
    27       0000 C        TIME2_T_DEBUG                   EQU     0
    28            C        
    29       0001 C        UART_FUNCTION                   EQU     1 ; disable uart function
    30       0001 C        SPI_FUNCTION                    EQU     1 ; enable spi function
    31            C        
    32            C        ;===========================================================================
    33            C        ;============================ register config ==============================
    34            C        ;===========================================================================
    35       0010 C        TEMP                            EQU     0X10
    36       0011 C        TEMP1                           EQU     0X11
    37       0012 C        TEMP2                           EQU     0X12
    38       0013 C        TEMP3                           EQU     0X13
    39       0014 C        TEMP4                           EQU     0X14
    40       0015 C        TEMP5                           EQU     0X15
    41       0016 C        TEMP6                           EQU     0X16
    42            C        
    43       0017 C        ComuClock                       EQU     0X17  ;communicateion clock
    44       0018 C        ComuCycleNum                    EQU     0X18  ;communicateion time
    45       0019 C        ComuEndNum                      EQU     0X19  ;communicateion end time
    46       001A C        Databytelength                  EQU     0X1A  ;FIFO READ/WRITE DATA LENGTH
    47       001B C        DataShiftCNT                    EQU     0X1B  ;data counter
    48       001C C        SleepCNT                        EQU     0X1C  ;data conunter
    49            C        
    50       001D C        GeneralStatusFlag1              EQU     0X1D
    51       00EF C        	RFInitialFailFlag           ==      GeneralStatusFlag1*8+7 ;
    52       00EE C        	RFInitialOKFlag             ==      GeneralStatusFlag1*8+6
    53       00ED C        	RFTestFailFlag              ==      GeneralStatusFlag1*8+5
    54       00EC C        	ReadLengthError             ==      GeneralStatusFlag1*8+4
    55       00EB C        	CmosInitFinishFlag          ==      GeneralStatusFlag1*8+3   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    56       00EA C        	IOtoADCcheckFlag            ==      GeneralStatusFlag1*8+2
    57       00E9 C        	IntoSleepFlag               ==      GeneralStatusFlag1*8+1
    58       00E8 C        	ToWakeupFlag                ==      GeneralStatusFlag1*8+0
    59            C        
    60       001E C        GeneralStatusFlag2              EQU     0X1E
    61            C        	;System2sFlag                ==      GeneralStatusFlag2*8+7
    62       00F6 C        	System16msFlag              ==      GeneralStatusFlag2*8+6
    63       00F5 C        	System8msFlag               ==      GeneralStatusFlag2*8+5
    64       00F3 C        	KeyScanFinishFlag           ==      GeneralStatusFlag2*8+3
    65       00F2 C        	KeyStatusFlag               ==      GeneralStatusFlag2*8+2
    66       00F1 C        	KeyScanStatusFlag           ==      GeneralStatusFlag2*8+1
    67       00F0 C        	KeyScanInitFlag             ==      GeneralStatusFlag2*8+0
    68            C        
    69       001F C        CommuStatusFlag                 EQU     0X1F
    70       00FF C        	MotorStatusFlag             ==      CommuStatusFlag*8+7
    71       00FE C        	FccTestModeFlag             ==      CommuStatusFlag*8+6
    72       00FD C        	ForceLinkModeFlag           ==      CommuStatusFlag*8+5   ; force link flag
    73       00FC C        	LinkModeFlag                ==      CommuStatusFlag*8+4   ; link flag
    74       00FB C        	EEpromWRStatusFlag          ==      CommuStatusFlag*8+3
    75       00FA C        	LoseFrameStatusFlag         ==      CommuStatusFlag*8+2   ; lose frequency and search mode flag
    76       00F9 C        	NormalStatusFlag            ==      CommuStatusFlag*8+1   ; Normal mode Flag
    77       00F8 C        	SearchStatusFlag            ==      CommuStatusFlag*8+0   ; Search mode flag
    78            C        
    79            C        ;------------------------------------------------------------------
    80       0011 C        r_acc1                          EQU     TEMP1
    81       0012 C        r_acc2                          EQU     TEMP2
    82       0013 C        r_acc3                          EQU     TEMP3
    83       0014 C        DataAddressInMCU                EQU     TEMP4         ;93C46
    84       0015 C        DataAddressInEEPROM             EQU     TEMP5
    85            C        
    86       0014 C        A_TEMP                          EQU     TEMP4  ;used for PUSH1 and POP1
    87       0015 C        RSR_TEMP                        EQU     TEMP5
    88       0016 C        STATUS_TEMP                     EQU     TEMP6
    89            C        
    90            C        ;------------------------------------------------------------------
    91       0019 C        FccFreqIndex                    EQU     ComuEndNum    ;FCC TEST
    92            C        
    93            C        
    94            C        ;========================= I/O Port Define ==============================
    95       0057 C        SPI_SS                          ==      PortA*8+7 ;PA7    EM198810/EM198850 enable select
    96       0056 C        SPI_CLK                         ==      PortA*8+6 ;PA6
    97       0055 C        SPI_MOSI                        ==      PortA*8+5 ;PA5
    98       0054 C        SPI_MISO                        ==      PortA*8+4 ;PA4
    99       0053 C        RESET_N                         ==      PortA*8+3 ;PA3
   100       0052 C        FIFO_FLAG                       ==      PortA*8+2 ;PB1
   101       0058 C        PKT_FLAG                        ==      PortB*8+0 ;PB0
   102            C        
   103       0051 C        CMOS_RST                        ==      PortA*8+1 ;PA1
   104       0050 C        CMOS_SS                         ==      PortA*8+0 ;PA0
   105            C        
   106       003B C        AT93C46_CS                      ==      Port7*8+3 ;4  93c46 enable select
   107            C        
   108       0044 C        MOTOR_STATUS                    ==      PORT8*8+4 ;MOTOR CONTROL
   109       0042 C        LED2_STATUS                     ==      PORT8*8+2 ;LED initial status view
   110       0041 C        LED1_STATUS                     ==      PORT8*8+1 ;LED running Status view
   111            C        
   112            C        
   113            C        ;======================= BANK 0 (Data Buffer)============================
   114            C        ; bank0 20-3f used for data exchange section
   115            C        ; such as read or write EEPROM and RF,it used for data buffer
   116            C        
   117            C        ;------------------------- header code --------------------------------
   118       0020 C        PID_DATA_Buffer                 EQU     0X20 ; PID DATA, not used
   119       0021 C        RX_IDH_Buffer                   EQU     0X21 ; Master IDH
   120       0022 C        RX_IDL_Buffer                   EQU     0X22 ; Master IDL
   121       0023 C        CHN_FLAG_Buffer                 EQU     0X23 ; Channel flag, gamepad status
   122       0024 C        GamePadsSum_Buffer              EQU     0X24 ; Communication trsmitter direction
   123       0025 C        CommuStatusFlag_Buffer          EQU     0X25
   124       0026 C        CH_NO_Buffer                    EQU     0X26 ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   125            C        
   126            C        ;----------------------- search and connect ---------------------------
   127       0027 C        TX1_ID_Buffer                   EQU     0X27 ;
   128       0028 C        TX2_ID_Buffer                   EQU     0X28 ;
   129       0029 C        TX3_ID_Buffer                   EQU     0X29 ;
   130       002A C        TX4_ID_Buffer                   EQU     0X2A ;
   131       002B C        TX5_ID_Buffer                   EQU     0X2B ;
   132       002C C        TX6_ID_Buffer                   EQU     0X2C ;
   133            C        ;------------------------ Transmitter data ----------------------------
   134       0027 C        TX_ID_Buffer                    EQU     0X27 ; repeat package data
   135       0028 C        DataA_Buffer                    EQU     0X28 ;rocker, left-x(left-right) data
   136       0029 C        DataB_Buffer                    EQU     0X29 ;rocker, left-y(up-down) data
   137       002A C        DataC_Buffer                    EQU     0X2A ;rocker, right-x(left-right) data
   138       002B C        DataD_Buffer                    EQU     0X2B ;rocker, right-y(up-down) data
   139       002C C        DataE_Buffer                    EQU     0X2C ;A,B,C,D,L1,R1,L2,R2
   140       002D C        DataF_Buffer                    EQU     0X2D ;Select,start,LSW,RSW,MODE,MACRO,TEST1,TEST2
   141       002E C        DataG_Buffer                    EQU     0X2E ;000:00001:45010:90011:135100:180101:225110:270111:315
   142            C        
   143       002F C        CMOS_xAxisL_Buffer              EQU     0X2F
   144       0030 C        CMOS_yAxisL_Buffer              EQU     0X30
   145       0031 C        CMOS_yxsAxisH_Buffer            EQU     0X31
   146            C        
   147       0032 C        GS_xAxisL_Buffer                EQU     0X32
   148       0033 C        GS_yAxisL_Buffer                EQU     0X33
   149       0034 C        GS_zAxisL_Buffer                EQU     0X34
   150       0035 C        GS_xyzAxisH_Buffer              EQU     0X35
   151            C        ;------------------------- receive data --------------------------------
   152       0027 C        MOTOR_ID_Buffer                 EQU     0X27
   153       013D C        	Motor6CtrlFlag              ==      MOTOR_ID_Buffer*8+5
   154       013C C        	Motor5CtrlFlag              ==      MOTOR_ID_Buffer*8+4
   155       013B C        	Motor4CtrlFlag              ==      MOTOR_ID_Buffer*8+3
   156       013A C        	Motor3CtrlFlag              ==      MOTOR_ID_Buffer*8+2
   157       0139 C        	Motor2CtrlFlag              ==      MOTOR_ID_Buffer*8+1
   158       0138 C        	Motor1CtrlFlag              ==      MOTOR_ID_Buffer*8+0
   159       0028 C        MOTOR1_VibrInten_Buffer         EQU     0X28    ; Motor1 vibration Intensity byte
   160       0029 C        MOTOR2_VibrInten_Buffer         EQU     0X29    ; Motor2 vibration Intensity byte
   161       002A C        MOTOR3_VibrInten_Buffer         EQU     0X2A    ; Motor3 vibration Intensity byte
   162       002B C        MOTOR4_VibrInten_Buffer         EQU     0X2B    ; Motor4 vibration Intensity byte
   163       002C C        MOTOR5_VibrInten_Buffer         EQU     0X2C    ; Motor5 vibration Intensity byte
   164       002D C        MOTOR6_VibrInten_Buffer         EQU     0X2D    ; Motor6 vibration Intensity byte
   165            C        ;--------------------------- CMOS data --------------------------------
   166       0020 C        CMOS1_xAxisL_Buffer             EQU     0X20    ; Point1 x axis[7..0]
   167       0021 C        CMOS1_yAxisL_Buffer             EQU     0X21    ; Point1 y axis[7..0]
   168       0022 C        CMOS1_yxsAxisH_Buffer           EQU     0X22    ; Point1 yAxis[9..8],xAxis[9..8],size[3..0]
   169       0023 C        CMOS2_xAxisL_Buffer             EQU     0X23    ; Point2 x axis[7..0]
   170       0024 C        CMOS2_yAxisL_Buffer             EQU     0X24    ; Point2 y axis[7..0]
   171       0025 C        CMOS2_yxsAxisH_Buffer           EQU     0X25    ; Point2 yAxis[9..8],xAxis[9..8],size[3..0]
   172       0026 C        CMOS3_xAxisL_Buffer             EQU     0X26    ; Point3 x axis[7..0]
   173       0027 C        CMOS3_yAxisL_Buffer             EQU     0X27    ; Point3 y axis[7..0]
   174       0028 C        CMOS3_yxsAxisH_Buffer           EQU     0X28    ; Point3 yAxis[9..8],xAxis[9..8],size[3..0]
   175       0029 C        CMOS4_xAxisL_Buffer             EQU     0X29    ; Point4 x axis[7..0]
   176       002A C        CMOS4_yAxisL_Buffer             EQU     0X2A    ; Point4 y axis[7..0]
   177       002B C        CMOS4_yxsAxisH_Buffer           EQU     0X2B    ; Point4 yAxis[9..8],xAxis[9..8],size[3..0]
   178            C        ;--------------------------- GS data ----------------------------------
   179       0020 C        GS1_xAxisL_Buffer               EQU     0X20    ; x axis low byte
   180       0021 C        GS1_yAxisL_Buffer               EQU     0X21    ; y axis low byte
   181       0022 C        GS1_zAxisL_Buffer               EQU     0X22    ; z axis low byte
   182       0023 C        GS1_xyzAxisH_Buffer             EQU     0X23    ; xAxis[9..8],yAxis[9..8],zAxis[3..0]
   183            C        
   184            C        ;---------------------------- checksum --------------------------------
   185       003E C        ChecksumH                       EQU     0X3E
   186       003F C        ChecksumL                       EQU     0X3F
   187            C        
   188            C        
   189            C        ;======================= BANK 1 (RF variable)============================
   190       0020 C        PID_DATA                EQU     0X20
   191       0021 C        RX_IDH                  EQU     0X21    ; master ID
   192       0022 C        RX_IDL                  EQU     0X22
   193       0023 C        CHN_FLAG                EQU     0X23    ; Channel flag, gamepad status
   194       0024 C        GamepadsSum             EQU     0X24    ; gamepads sum
   195       0025 C        CH_NO                   EQU     0X25    ; Current frequency table index
   196       0026 C        TX_ID                   EQU     0X26    ;
   197            C        
   198            C        ;-----------------------------------------------------------------------
   199       0030 C        ADDR                    EQU     0X30 ;in/out Data Address
   200       0031 C        VALUE                   EQU     0X31 ;in/out Data
   201       0032 C        LossframeCNT            EQU     0X32
   202       0033 C        TABLE_INDEX             EQU     0x33  ;descriptor table's start position
   203       0034 C        RF_RSSI                 EQU     0X34
   204            C        
   205            C        
   206            C        ;======================= BANK 2 (key data)==============================
   207       0020 C        DataA                   EQU     0X20 ;rocker left-x(left-right)  RF transmitter data
   208       0021 C        DataB                   EQU     0X21 ;rocker left-y(up-down)     RF transmitter data
   209       0022 C        DataC                   EQU     0X22 ;rocker right-x(left-right) RF transmitter data
   210       0023 C        DataD                   EQU     0X23 ;rocker right-y(up-down)    RF transmitter data
   211       0024 C        DataE                   EQU     0x24 ;DataA(s10-s5):
   212            C                                ;bit7  bit6  Bit5  Bit4  Bit3  bit2  bit1  bit0
   213            C                                ;A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   214       0025 C        DataF                   EQU     0x25 ;DataB(s4-s1):
   215            C                                ;bit7      bit6      Bit5      Bit4   Bit3  bit2    bit1    bit0
   216            C                                ;SELECT_9  START_10  TEST2_14  MACRO  MODE  RSW_12  LSW_11  TEST1_13
   217            C                                ;MODE: 1:DealWithDigital  0:DealWithAnalog (default:1)
   218       0026 C        DataG                   EQU     0X26 ;bit[7..4]Hat Switch, bit[3..0]reserve.
   219            C                                ;000:00001:45010:90011:135100:180101:225110:270111:315
   220            C        
   221       002A C        IOcheckRefValue         EQU     0X2A    ; used for Store refrence value
   222       002B C        KeyCheckBakup           EQU     0X2B
   223       002C C        ComSystemTimeCNT        EQU     0X2C
   224       002D C        IOcheckTimeCNT          EQU     0X2D    ; used for count check time
   225       002E C        KeySystemTimeCNT        EQU     0x2E    ; key scan time
   226       002F C        LEDSystemTimeCNT        EQU     0X2F
   227            C        
   228       0030 C        KEY_LEFT_X              EQU     0X30 ;rocker,AD convert result left-x(left-right) data
   229       0031 C        KEY_LEFT_Y              EQU     0X31 ;rocker,AD convert result left-y(up-down) data
   230       0032 C        KEY_RIGHT_X             EQU     0X32 ;rocker,AD convert result right-x(left-right) data
   231       0033 C        KEY_RIGHT_Y             EQU     0X33 ;rocker,AD convert result right-y(up-down) data
   232            C        
   233            C        
   234            C        ;       Click                     Dblclick                    Lasting_Press
   235            C        ;________    _______.__________    ______    _______.___________         ____________
   236            C        ;        |__|                  |__|      |__|                   |_______|
   237            C        ;___________                       _________                             ____________
   238            C        ;           |_______._____________|         |________.__________________|
   239            C        
   240       0036 C        KeystokeFlag_Befor      EQU     0X36
   241       0037 C        KeystokeTimeCNT         EQU     0X37
   242       0038 C        KEY_NUM                 EQU     0X38
   243            C        ;F_MODE                  EQU     0X32 ;Analog jugde falg
   244            C        ;F_MODE_BEFOR            EQU     0X33 ;Store keyboard select
   245       0039 C        KeyTempFlag             EQU     0X39 ;Store LINE4_KEY_INPUT TEMP
   246       01CC C        	ModeSelFlag         ==      KeyTempFlag*8+4 ;1:analog  0:digital(default 0)
   247       01CD C        	MacroFlag           ==      KeyTempFlag*8+5
   248       01CE C        	Test1Flag           ==      KeyTempFlag*8+6
   249       01CF C        	Test2Flag           ==      KeyTempFlag*8+7
   250            C        
   251       003A C        KeyTempBakupFlag        EQU     0X3A
   252       01D4 C        	ModeSelBakupFlag    ==      KeyTempBakupFlag*8+4 ;1:analog  0:digital(default 0)
   253       01D5 C        	MacroBakupFlag      ==      KeyTempBakupFlag*8+5
   254       01D6 C        	Test1BakupFlag      ==      KeyTempBakupFlag*8+6
   255       01D7 C        	Test2BakupFlag      ==      KeyTempBakupFlag*8+7
   256            C        
   257       003B C        LINE1_KEY_INPUT_CACHE   EQU     0X3B ;line 1,direction data
   258       003C C        LINE2_KEY_INPUT_CACHE   EQU     0X3C ;line 2,X_LINE2 output
   259       003D C        LINE3_KEY_INPUT_CACHE   EQU     0X3D ;line 3,X_LINE3 output
   260       003E C        LINE4_KEY_INPUT_CACHE   EQU     0X3E ;line 4,X_LINE4 output
   261       003F C        LINE5_KEY_INPUT_CACHE   EQU     0X3F ;line 5,X_LINE5 output
   262            C        
   263            C        ;======================= BANK 3 (motor)===============================
   264       0020 C        MotorVibrInten          EQU     0X20    ; vibration Intensity byte
   265            C        ;MotorVibrDura           EQU     0X21    ; vibration duration byte
   266            C        
   267            C        
   268            C        ;======================= BANK 4 (Push data)=============================
   269       0020 C        ATcc_TEMP               EQU     0X20  ;used for TCC and POP3
   270       0021 C        RSRTcc_TEMP             EQU     0X21
   271       0022 C        StatusTcc_TEMP          EQU     0X22
   272            C        
   273       0023 C        AExt_TEMP               EQU     0X23  ;used for External and POP3
   274       0024 C        RSRExt_TEMP             EQU     0X24
   275       0025 C        StatusExt_TEMP          EQU     0X25
   276            C        
   277       0026 C        A1_TEMP                 EQU     0X26  ;used for time1 and POP1
   278       0027 C        RSR1_TEMP               EQU     0X27
   279       0028 C        STATUS1_TEMP            EQU     0X28
   280            C        
   281       0029 C        A2_TEMP                 EQU     0X29  ;used for time2 and POP2
   282       002A C        RSR2_TEMP               EQU     0X2A
   283       002B C        STATUS2_TEMP            EQU     0X2B
   284            C        
   285            C        ;-----------------------------------------------------------
   286       0030 C        SPIS_TEMP               EQU     0X30
   287       0031 C        SPIC_TEMP               EQU     0X31
   288            C        
   289            C        ;======================= BANK 5 (CMOS status reg)============================
   290       0020 C        CMOS_PARAMETER          EQU     0X20
   291       0021 C        CMOS_STATUS             EQU     0X21
   292       0108 C        	CMOSInitFlag        ==      CMOS_STATUS*8+0
   293       0109 C        	CMOSSleepFlag       ==      CMOS_STATUS*8+1
   294       010A C        	CMOSGetDataFlag     ==      CMOS_STATUS*8+2
   295            C        
   296            C        ;CMOS1_Covariance        EQU     0X30
   297            C        ;CMOS2_Covariance        EQU     0X31
   298            C        ;CMOS3_Covariance        EQU     0X32
   299            C        ;CMOS4_Covariance        EQU     0X33
   300            C        
   301       002D C        CMOS_xAxisH             EQU     0X2D    ; x axis[9..8] high byte,[1..0]
   302       002E C        CMOS_yAxisH             EQU     0X2E    ; y axis[9..8] high byte,[1..0]
   303       002F C        CMOS_yxsAxisH           EQU     0X2F    ; yAxis[9..8],xAxis[9..8],size[3..0]
   304       003D C        CMOS_xAxisL             EQU     0X3D    ; x axis[7..0]
   305       003E C        CMOS_yAxisL             EQU     0X3E    ; y axis[7..0]
   306       003F C        CMOS_Size               EQU     0X3F    ; size[3..0] high byte,[3..0]
   307            C        
   308            C        ;======================= BANK 6 (CMOS Data)============================
   309       0020 C        CMOS1_xAxisH            EQU     0X20    ; x axis[9..8] high byte,[1..0]
   310       0021 C        CMOS1_yAxisH            EQU     0X21    ; y axis[9..8] high byte,[1..0]
   311       0022 C        CMOS1_yxsAxisH          EQU     0X22    ; yAxis[9..8],xAxis[9..8],size[3..0]
   312       0030 C        CMOS1_xAxisL            EQU     0X30    ; x axis[7..0]
   313       0031 C        CMOS1_yAxisL            EQU     0X31    ; y axis[7..0]
   314       0032 C        CMOS1_Size              EQU     0X32    ; size[3..0] high byte,[3..0]
   315            C        
   316       0023 C        CMOS2_xAxisH            EQU     0X23    ; x axis[9..8] high byte,[1..0]
   317       0024 C        CMOS2_yAxisH            EQU     0X24    ; y axis[9..8] high byte,[1..0]
   318       0025 C        CMOS2_yxsAxisH          EQU     0X25    ; yAxis[9..8],xAxis[9..8],size[3..0]
   319       0033 C        CMOS2_xAxisL            EQU     0X33    ; x axis[7..0]
   320       0034 C        CMOS2_yAxisL            EQU     0X34    ; y axis[7..0]
   321       0035 C        CMOS2_Size              EQU     0X35    ; size[3..0] high byte,[3..0]
   322            C        
   323       0026 C        CMOS3_xAxisH            EQU     0X26    ; x axis[9..8] high byte,[1..0]
   324       0027 C        CMOS3_yAxisH            EQU     0X27    ; y axis[9..8] high byte,[1..0]
   325       0028 C        CMOS3_yxsAxisH          EQU     0X28    ; yAxis[9..8],xAxis[9..8],size[3..0]
   326       0036 C        CMOS3_xAxisL            EQU     0X36    ; x axis[7..0]
   327       0037 C        CMOS3_yAxisL            EQU     0X37    ; y axis[7..0]
   328       0038 C        CMOS3_Size              EQU     0X38    ; size[3..0] high byte,[3..0]
   329            C        
   330       0029 C        CMOS4_xAxisH            EQU     0X29    ; x axis[9..8] high byte,[1..0]
   331       002A C        CMOS4_yAxisH            EQU     0X2A    ; y axis[9..8] high byte,[1..0]
   332       002B C        CMOS4_yxsAxisH          EQU     0X2B    ; yAxis[9..8],xAxis[9..8],size[3..0]
   333       0039 C        CMOS4_xAxisL            EQU     0X39    ; x axis[7..0]
   334       003A C        CMOS4_yAxisL            EQU     0X3A    ; y axis[7..0]
   335       003B C        CMOS4_Size              EQU     0X3B    ; size[3..0] high byte,[3..0]
   336            C        
   337            C        ;======================= BANK 7 (GS Data)============================
   338       0020 C        GS_PARAMETER            EQU     0X20
   339       0021 C        GS_STATUS               EQU     0X21
   340       0108 C        	GSInitFlag          ==      GS_STATUS*8+0
   341       0109 C        	GSSleepFlag         ==      GS_STATUS*8+1
   342       010A C        	GSGetDataFlag       ==      GS_STATUS*8+2
   343            C        
   344            C        
   345       0030 C        GS_xAxisL               EQU     0X30    ; x axis low byte
   346       0031 C        GS_yAxisL               EQU     0X31    ; y axis low byte
   347       0032 C        GS_zAxisL               EQU     0X32    ; z axis low byte
   348       0033 C        GS_xyzAxisH             EQU     0X33    ; xAxis[9..8],yAxis[9..8],zAxis[3..0]
   349            C        
   350       0034 C        GS_xAxisH               EQU     0X34    ; x axis[9..8] high byte,[1..0]
   351       0035 C        GS_yAxisH               EQU     0X35    ; y axis[9..8] high byte,[1..0]
   352       0036 C        GS_zAxisH               EQU     0X36    ; z axis[9..8] high byte,[1..0]
   353            C        
   354            C        
    17                     include "EM198850_For_EM78P520.ASM"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        
    12            C        ;-------------------------------------------------------------
    13            C        EM198850_FOR_EM78P520.ASM    EQU    EM198850_FOR_EM78P520.ASM
    14            C        
    15            C        ifndef EM198850_For_EM78P520.H
    16            C        include "EM198850_For_EM78P520.H"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        
    12            C        ;--------------------------------------------------------------------------
    13       0052 C        FIFO_PTR                EQU     82              ; FIFO POINTER CONTROL=REG 82
    14       0080 C        CLR_W_PTR               EQU     0X80            ; CLR POINTER MARK VALUE
    15       0050 C        FIFO_REG                EQU     80              ; FIFO POINTER=REG 80
    16       0080 C        READ_MASK               EQU     0X80            ; READ REG,MSB SET TO 1
    17       0080 C        RX_MASK                 EQU     0X80            ; ENABLE RX
    18            C        
    19       0020 C        PKT_LEN                 EQU     0X20            ; DataByteLength = 32
    20       0000 C        TXADDRL                 EQU     0X00
    21       0011 C        TXADDRH                 EQU     0X11
    22       00E0 C        RX_BUF                  EQU     0B11100000
    23       00E0 C        TX_BUF                  EQU     0B11100000
    24       0025 C        NoiseStrobe             EQU     0X25
    25       004B C        ChannelSum              EQU     75              ; (CH_TABLE_END-CH_TABLE_START)
    26       0000 C        USED_PID_FUNCTION       EQU     0               ; 1:used this function; 0:not used
    27            C        
    28            C        ;==================================================================
    29            C        
    17            C        endif
    18            C        
    19            C        
    20            C        ;-------------------------------------------------------------
    21            C        
    22            C        	ORG     0X0C00    ;PAGE 3
    23            C          if MassageDisplay == 1
    24            C        	MESSAGE "define 'EM198850_FOR_EM78P520.ASM' ROM address"
    25            C          endif
    26            C        ;**************************************************
    27            C        ;LOOKUP TABLE
    28            C        ;Famer Register initial value(Reg48~57)
    29            C        ;**************************************************
    30 00C00      C        FRAME_TABLE:
    31 00C00 03C2 C        	ADD                 PC,A
    32 00C01 1C4E C        	RETL                @0X4E		;1		01---16M
    33 00C02 1C02 C        	RETL                @0X02		;2		10---24M
    34            C        
    35 00C03 1C4D C        	RETL                @0X4D		;3		RESET FIFO
    36 00C04 1C01 C        	RETL                @0X01		;4
    37            C        
    38 00C05 1C42 C        	RETL                @0X42		;5		24M/1MBPS
    39 00C06 1C98 C        	RETL                @0X98		;6
    40            C        
    41 00C07 1C43 C        	RETL                @0X43		;7
    42 00C08 1CC8 C        	RETL                @0XC8 		;8		;default:C4  Set sync word lengthCRC count
    43            C        
    44 00C09 1C44 C        	RETL                @0X44		;9		PKT_LEN
    45 00C0A 1C20 C        	RETL                @PKT_LEN	;10		24 DATA
    46            C        
    47 00C0B 1C45 C        	RETL                @0X45		;11		PKTCNT
    48 00C0C 1C10 C        	RETL                @0X10		;12		1 packet
    49            C        
    50 00C0D 1C46 C        	RETL                @0X46		;13		BIT3~5	TX AMPLIFIER DELAY 10+5X
    51 00C0E 1C09 C        	RETL                @0X09		;14		BIT0~2	PLL DELAY 120+20X
    52            C        
    53 00C0F 1C47 C        	RETL                @0X47		;15		BIT4~7  RETRY CNT
    54 00C10 1C01 C        	RETL                @0X01		;16		BIT0~3	SLOT TIME UNIT 10US
    55            C        
    56 00C11 1C48 C        	RETL                @0X48		;17		SLOT
    57 00C12 1C01 C        	RETL                @0X01		;18
    58            C        
    59 00C13 1C49 C        	RETL                @0X49		;19		ACKTOSLOT
    60 00C14 1C14 C        	RETL                @0X14 		;20     default: 0X8A
    61            C        
    62 00C15 1C4A C        	RETL                @0X4A		;21		RSSITH
    63 00C16 1C27 C        	RETL                @0X27		;22
    64            C        
    65 00C17 1C4B C        	RETL                @0X4B		;23		RF_RSSI
    66 00C18 1C00 C        	RETL                @0X00		;24
    67            C        
    68 00C19 1C4C C        	RETL                @0X4C		;25		TD_PLL	IN UNIT 10US
    69 00C1A 1C06 C        	RETL                @0X06		;26
    70            C        
    71 00C1B 1C50 C        	RETL                @0X50		;27		TXADDR
    72 00C1C 1C00 C        	RETL                @TXADDRL	;28
    73            C        
    74 00C1D 1C51 C        	RETL                @0X51		;29		TX ADDR
    75 00C1E 1C11 C        	RETL                @TXADDRH	;30
    76            C        
    77 00C1F 1C52 C        	RETL                @0X52		;31		RX	ADDR1
    78 00C20 1C22 C        	RETL                @0X22		;32
    79            C        
    80 00C21 1C53 C        	RETL                @0X53		;33		RX	ADDR2
    81 00C22 1C33 C        	RETL                @0X33		;34
    82            C        
    83 00C23 1C54 C        	RETL                @0X54		;35		RX	ADDR3
    84 00C24 1C44 C        	RETL                @0X44		;36
    85            C        
    86 00C25 1C55 C        	RETL                @0X55		;37		RX	ADDR4
    87 00C26 1C55 C        	RETL                @0X55		;38
    88            C        
    89 00C27 1C56 C        	RETL                @0X56		;39		RX	ADDR5
    90 00C28 1C66 C        	RETL                @0X66		;40
    91            C        
    92 00C29 1C57 C        	RETL                @0X57		;41		RX	ADDR6
    93 00C2A 1C77 C        	RETL                @0X77		;42
    94            C        
    95 00C2B 1C58 C        	RETL                @0X58		;43
    96 00C2C 1C08 C        	RETL                @0X08		;44
    97            C        
    98            C        ;-----------------------------------------------------------
    99 00C2D 1C00 C        	RETL                @0X00		;45
   100 00C2E 1CE5 C        	RETL                @0XE5		;46
   101            C        
   102 00C2F 1C01 C        	RETL                @0X01		;47
   103 00C30 1C84 C        	RETL                @0X84		;48
   104            C        
   105 00C31 1C02 C        	RETL                @0X02		;49
   106 00C32 1C00 C        	RETL                @0X00		;50		CHANNEL
   107            C        
   108 00C33 1C03 C        	RETL                @0X03		;51
   109 00C34 1CC6 C        	RETL                @0XC6		;52
   110            C        
   111 00C35 1C04 C        	RETL                @0X04		;53
   112 00C36 1C00 C        	RETL                @0X00		;54
   113            C        
   114 00C37 1C05 C        	RETL                @0X05		;55
   115 00C38 1C40 C        	RETL                @0X40		;56
   116            C        
   117 00C39 1C06 C        	RETL                @0X06		;57
   118 00C3A 1C5D C        	RETL                @0X5D		;58
   119            C        
   120 00C3B 1C07 C        	RETL                @0X07		;59
   121 00C3C 1C18 C        	RETL                @0X18		;60
   122            C        
   123 00C3D 1C08 C        	RETL                @0X08		;61
   124 00C3E 1C40 C        	RETL                @0X40		;62
   125            C        
   126 00C3F 1C09 C        	RETL                @0X09		;63
   127 00C40 1C18 C        	RETL                @0X18		;64
   128            C        
   129 00C41 1C0A C        	RETL                @0X0A		;65
   130 00C42 1C47 C        	RETL                @0X47		;66
   131            C        
   132 00C43 1C0B C        	RETL                @0X0B		;67
   133 00C44 1C0B C        	RETL                @0X0B		;68
   134            C        
   135 00C45 1C0C C        	RETL                @0X0C		;69
   136 00C46 1CE0 C        	RETL                @0XE0		;70
   137            C        
   138 00C47 1C0D C        	RETL                @0X0D		;71
   139 00C48 1C4F C        	RETL                @0X4F		;72
   140            C        
   141 00C49 1C0E C        	RETL                @0X0E		;73
   142 00C4A 1C11 C        	RETL                @0X11		;74
   143            C        
   144 00C4B 1C0F C        	RETL                @0X0F		;75
   145 00C4C 1C1C C        	RETL                @0X1C		;76
   146            C        
   147 00C4D 1C20 C        	RETL                @0X20		;77
   148 00C4E 1CAD C        	RETL                @0XAD		;78
   149            C        
   150 00C4F 1C21 C        	RETL                @0X21		;79
   151 00C50 1C64 C        	RETL                @0X64		;80
   152            C        
   153 00C51 1C22 C        	RETL                @0X22		;81
   154 00C52 1C00 C        	RETL                @0X00		;82
   155            C        
   156 00C53 1C23 C        	RETL                @0X23		;83
   157 00C54 1CC3 C        	RETL                @0XC3		;84
   158            C        
   159 00C55 1C24 C        	RETL                @0X24		;85
   160 00C56 1CBD C        	RETL                @0XBD		;86
   161            C        
   162 00C57 1C25 C        	RETL                @0X25		;87
   163 00C58 1CA2 C        	RETL                @0XA2		;88
   164            C        
   165 00C59 1C26 C        	RETL                @0X26		;89
   166 00C5A 1C1A C        	RETL                @0X1A		;90
   167            C        
   168 00C5B 1C27 C        	RETL                @0X27		;91
   169 00C5C 1C09 C        	RETL                @0X09		;92
   170            C        
   171 00C5D 1C28 C        	RETL                @0X28		;93
   172 00C5E 1C00 C        	RETL                @0X00		;94
   173            C        
   174 00C5F 1C29 C        	RETL                @0X29		;95
   175 00C60 1CB8 C        	RETL                @0XB8		;96
   176            C        
   177 00C61 1C2A C        	RETL                @0X2A		;97
   178 00C62 1C71 C        	RETL                @0X71		;98
   179            C        
   180 00C63 1C2B C        	RETL                @0X2B		;99
   181 00C64 1C06 C        	RETL                @0X06		;100
   182            C        
   183 00C65 1C2C C        	RETL                @0X2C		;101
   184 00C66 1C80 C        	RETL                @0X80		;102
   185            C        
   186 00C67 1C2D C        	RETL                @0X2D		;103
   187 00C68 1C1A C        	RETL                @0X1A		;104
   188            C        
   189 00C69 1C2E C        	RETL                @0X2E		;105
   190 00C6A 1C09 C        	RETL                @0X09;03		;106
   191            C        
   192 00C6B 1C2F C        	RETL                @0X2F		;107
   193 00C6C 1C64 C        	RETL                @0X64		;108
   194            C        
   195 00C6D 1C30 C        	RETL                @0X30		;109
   196 00C6E 1CC0 C        	RETL                @0XC0		;110
   197            C        
   198 00C6F 1C31 C        	RETL                @0X31		;111
   199 00C70 1C00 C        	RETL                @0X00		;112
   200            C        
   201 00C71 1C32 C        	RETL                @0X32		;113
   202 00C72 1C40 C        	RETL                @0X40		;114
   203            C        
   204 00C73 1C33 C        	RETL                @0X33		;115
   205 00C74 1C3B C        	RETL                @0X3B		;116
   206            C        
   207 00C75 1C00 C        	RETL                @0X00		;117
   208 00C76 1CA7 C        	RETL                @0XA7		;118
   209            C        
   210 00C77 1C32 C        	RETL                @0X32		;119
   211 00C78 1C4A C        	RETL                @0X4A		;120
   212            C        
   213 00C79 1C00 C        	RETL                @0X00		;121
   214 00C7A 1CE5 C        	RETL                @0XE5		;122
   215            C        
   216 00C7B 1C0E C        	RETL                @0X0E		;123
   217 00C7C 1C91 C        	RETL                @0X91		;124
   218            C        
   219 00C7D 1C40 C        	RETL                @0X40		;125
   220 00C7E 1C51 C        	RETL                @0X51		;126
   221            C        
   222 00C7F 1C41 C        	RETL                @0X41		;127
   223 00C80 1CBF C        	RETL                @0XBF		;128
   224            C        
   225 00C81 1C0C C        	RETL                @0X0C		;129
   226 00C82 1CC0 C        	RETL                @0XC0		;130
   227            C        
   228 00C83 1C02 C        	RETL                @0X02		;131
   229 00C84 1C80 C        	RETL                @0X80		;132
   230            C        
   231 00C85 1C04 C        	RETL                @0X04		;133
   232 00C86 1C4A C        	RETL                @0X4A		;134
   233            C        
   234 00C87 1C05 C        	RETL                @0X05		;135
   235 00C88 1CDA C        	RETL                @0XDA		;136
   236            C        
   237 00C89 1C06 C        	RETL                @0X06		;137
   238 00C8A 1CFA C        	RETL                @0XFA		;138
   239            C        
   240 00C8B 1CFF C        	RETL                @0XFF
   241            C        
   242            C        ;===========================================================
   243 00C8C      C        RF_TABLE:			;LENGTH 30
   244 00C8C 03C2 C        	ADD                 PC,A
   245 00C8D 1C4E C        	RETL                @0X4E
   246 00C8E 1C02 C        	RETL                @0X02
   247            C        
   248 00C8F 1C43 C        	RETL                @0X43
   249 00C90 1CC8 C        	RETL                @0XC8
   250            C        
   251 00C91 1C44 C        	RETL                @0X44
   252 00C92 1C20 C        	RETL                @PKT_LEN
   253            C        
   254 00C93 1C45 C        	RETL                @0X45
   255 00C94 1C10 C        	RETL                @0X10
   256            C        
   257 00C95 1C48 C        	RETL                @0X48
   258 00C96 1C01 C        	RETL                @0X01
   259            C        
   260 00C97 1C4C C        	RETL                @0X4C
   261 00C98 1C06 C         	RETL                @0X06
   262            C        
   263 00C99 1C50 C        	RETL                @0X50
   264 00C9A 1C00 C        	RETL                @TXADDRL
   265            C        
   266 00C9B 1C51 C        	RETL                @0X51
   267 00C9C 1C11 C        	RETL                @TXADDRH
   268            C        
   269 00C9D 1C52 C        	RETL                @0X52
   270 00C9E 1C22 C        	RETL                @0X22
   271            C        
   272 00C9F 1C53 C        	RETL                @0X53
   273 00CA0 1C33 C        	RETL                @0X33
   274            C        
   275 00CA1 1C54 C        	RETL                @0X54
   276 00CA2 1C44 C        	RETL                @0X44
   277            C        
   278 00CA3 1C55 C        	RETL                @0X55
   279 00CA4 1C55 C        	RETL                @0X55
   280            C        
   281 00CA5 1C56 C        	RETL                @0X56
   282 00CA6 1C66 C        	RETL                @0X66
   283            C        
   284 00CA7 1C57 C        	RETL                @0X57
   285 00CA8 1C77 C        	RETL                @0X77
   286            C        
   287 00CA9 1C58 C        	RETL                @0X58
   288 00CAA 1C08 C        	RETL                @0X08
   289            C        
   290 00CAB 1CFF C        	RETL                @0XFF
   291            C        
   292            C        ;===========================================================
   293 00CAC      C        CH_TABLE:
   294 00CAC 03C2 C        	ADD                 PC,A
   295 00CAD      C          CH_TABLE_START:
   296            C        	;1
   297 00CAD 1C14 C        	RETL                @20        ;00,Freq:0x14
   298 00CAE 1C26 C        	RETL                @38        ;01,Freq:0x26
   299 00CAF 1C38 C        	RETL                @56        ;02,Freq:0x38
   300 00CB0 1C4F C        	RETL                @79        ;03,Freq:0x4F
   301            C        
   302            C        	;2
   303 00CB1 1C04 C        	RETL                @4         ;04,Freq:0x04
   304 00CB2 1C17 C        	RETL                @23        ;05,Freq:0x17
   305 00CB3 1C2A C        	RETL                @42        ;06,Freq:0x2A
   306 00CB4 1C3D C        	RETL                @61        ;07,Freq:0x3D
   307            C        
   308            C        	;3
   309 00CB5 1C07 C        	RETL                @7         ;08,Freq:0x07
   310 00CB6 1C1B C        	RETL                @27        ;09,Freq:0x1B
   311 00CB7 1C2F C        	RETL                @47        ;10,Freq:0x2F
   312 00CB8 1C3E C        	RETL                @62        ;11,Freq:0x3E
   313            C        
   314            C        	;4
   315 00CB9 1C0A C        	RETL                @10        ;12,Freq:0x02
   316 00CBA 1C1F C        	RETL                @31        ;13,Freq:0x1F
   317 00CBB 1C34 C        	RETL                @52        ;14,Freq:0x34
   318 00CBC 1C3F C        	RETL                @63        ;15,Freq:0x3F
   319            C        
   320            C        	;5
   321 00CBD 1C0D C        	RETL                @13        ;16,Freq:0x0D
   322 00CBE 1C23 C        	RETL                @35        ;17,Freq:0x23
   323 00CBF 1C39 C        	RETL                @57        ;18,Freq:0x39
   324 00CC0 1C40 C        	RETL                @64        ;19,Freq:0x40
   325            C        
   326            C        	;6
   327 00CC1 1C10 C        	RETL                @16        ;20,Freq:0x10
   328 00CC2 1C27 C        	RETL                @39        ;21,Freq:0x27
   329 00CC3 1C2B C        	RETL                @43        ;22,Freq:0x2B
   330 00CC4 1C41 C        	RETL                @65        ;23,Freq:0x41
   331            C        
   332            C        	;7
   333 00CC5 1C13 C        	RETL                @19        ;24,Freq:0x13
   334 00CC6 1C18 C        	RETL                @24        ;25,Freq:0x18
   335 00CC7 1C30 C        	RETL                @48        ;26,Freq:0x30
   336 00CC8 1C42 C        	RETL                @66        ;27,Freq:0x42
   337            C        
   338            C        	;8
   339 00CC9 1C16 C        	RETL                @22        ;28,Freq:0x16
   340 00CCA 1C1C C        	RETL                @28        ;29,Freq:0x1C
   341 00CCB 1C35 C        	RETL                @53        ;30,Freq:0x35
   342 00CCC 1C43 C        	RETL                @67        ;31,Freq:0x43
   343            C        
   344            C        	;9
   345 00CCD 1C06 C        	RETL                @6         ;32,Freq:0x06
   346 00CCE 1C20 C        	RETL                @32        ;33,Freq:0x20
   347 00CCF 1C3A C        	RETL                @58        ;34,Freq:0x3A
   348 00CD0 1C44 C        	RETL                @68        ;35,Freq:0x44
   349            C        
   350            C        	;10
   351 00CD1 1C09 C        	RETL                @9         ;36,Freq:0x09
   352 00CD2 1C24 C        	RETL                @36        ;37,Freq:0x24
   353 00CD3 1C2C C        	RETL                @44        ;38,Freq:0x2C
   354 00CD4 1C45 C        	RETL                @69        ;39,Freq:0x45
   355            C        
   356            C        	;11
   357 00CD5 1C0C C        	RETL                @12        ;40,Freq:0x0C
   358 00CD6 1C28 C        	RETL                @40        ;41,Freq:0x28
   359 00CD7 1C31 C        	RETL                @49        ;42,Freq:0x31
   360 00CD8 1C46 C        	RETL                @70        ;43,Freq:0x46
   361            C        
   362            C        	;12
   363 00CD9 1C0F C        	RETL                @15        ;44,Freq:0x0F
   364 00CDA 1C19 C        	RETL                @25        ;45,Freq:0x19
   365 00CDB 1C36 C        	RETL                @54        ;46,Freq:0x36
   366 00CDC 1C47 C        	RETL                @71        ;47,Freq:0x36
   367            C        
   368            C        	;13
   369 00CDD 1C12 C        	RETL                @18        ;48,Freq:0x12
   370 00CDE 1C1D C        	RETL                @29        ;49,Freq:0x1D
   371 00CDF 1C3B C        	RETL                @59        ;50,Freq:0x3B
   372 00CE0 1C48 C        	RETL                @72        ;51,Freq:0x48
   373            C        
   374            C        	;14
   375 00CE1 1C15 C        	RETL                @21        ;52,Freq:0x15
   376 00CE2 1C21 C        	RETL                @33        ;53,Freq:0x21
   377 00CE3 1C2D C        	RETL                @45        ;54,Freq:0x2D
   378 00CE4 1C49 C        	RETL                @73        ;55,Freq:0x49
   379            C        
   380            C        	;15
   381 00CE5 1C05 C        	RETL                @5         ;56,Freq:0x05
   382 00CE6 1C25 C        	RETL                @37        ;57,Freq:0x25
   383 00CE7 1C32 C        	RETL                @50        ;58,Freq:0x32
   384 00CE8 1C4A C        	RETL                @74        ;59,Freq:0x4A
   385            C        
   386            C        	;16
   387 00CE9 1C08 C        	RETL                @8         ;60,Freq:0x08
   388 00CEA 1C29 C        	RETL                @41        ;61,Freq:0x29
   389 00CEB 1C37 C        	RETL                @55        ;62,Freq:0x37
   390 00CEC 1C4B C        	RETL                @75        ;63,Freq:0x4B
   391            C        
   392            C        	;17
   393 00CED 1C0B C        	RETL                @11        ;64,Freq:0x03
   394 00CEE 1C1A C        	RETL                @26        ;65,Freq:0x1A
   395 00CEF 1C3C C        	RETL                @60        ;66,Freq:0x3C
   396 00CF0 1C4C C        	RETL                @76        ;67,Freq:0x4C
   397            C        
   398            C        	;18
   399 00CF1 1C0E C        	RETL                @14        ;68,Freq:0x0E
   400 00CF2 1C1E C        	RETL                @30        ;69,Freq:0x1E
   401 00CF3 1C2E C        	RETL                @46        ;70,Freq:0x2E
   402 00CF4 1C4D C        	RETL                @77        ;71,Freq:0x4D
   403            C        
   404            C        	;19
   405 00CF5 1C11 C        	RETL                @17        ;72,Freq:0x11
   406 00CF6 1C22 C        	RETL                @34        ;73,Freq:0x22
   407 00CF7 1C33 C        	RETL                @51        ;74,Freq:0x33
   408 00CF8 1C4E C        	RETL                @78        ;75,Freq:0x4E
   409 00CF9      C          CH_TABLE_END:
   410            C        
   411            C        
   412            C        
   413            C        ;===========================================================
   414            C        ; RF Initialize SubRoutine
   415            C        ;===========================================================
   416 00CF9      C        EM198850_RESET:
   417 00CF9 0557 C        	INC                 ComuClock
   418 00CFA 0004 C        	WDTC
   419 00CFB 1E00 C        	BANK                0
   420 00CFC 08CA C        	BC                  RESET_N/8,RESET_N%8
   421 00CFD 181E C        	MOV                 A,@30                         ; wating 3ms
   422 00CFE 1EA0 C        	LCALL               DELAY_8MHz_X100US
   422 00CFF 0333 C        	LCALL               DELAY_8MHz_X100US
   423 00D00 0ACA C        	BS                  RESET_N/8,RESET_N%8          ; RESET=1
   424 00D01 1864 C        	MOV                 A,@100                          ; wating 10ms
   425 00D02 1EA0 C        	LCALL                DELAY_8MHz_X100US
   425 00D03 0333 C        	LCALL                DELAY_8MHz_X100US
   426 00D04 0000 C        	NOP
   427            C        
   428 00D05 095D C        	BC                  RFTestfailFlag/8,RFTestfailFlag%8
   429 00D06 1112 C        	CALL                INIT_FRAMEREG                  ; load	FRAMER TABLE send
   430 00D07 1805 C        	MOV                 A,@5
   431 00D08 1EA0 C        	LCALL                DELAY_8MHz_X100US
   431 00D09 0333 C        	LCALL                DELAY_8MHz_X100US
   432 00D0A 1125 C        	CALL                INIT_RSSI_CALIBRATION
   433 00D0B 0000 C        	NOP
   434 00D0C 133B C        	CALL                TEST_INITIAL_RF
   435 00D0D 0D5D C        	JBC                 RFTestfailFlag/8,RFTestfailFlag%8
   436 00D0E 14F9 C        	JMP                 EM198850_RESET
   437            C        
   438 00D0F 12B3 C        	CALL                Enter_StandbyII_Mode
   439 00D10 0B9D C        	BS                  RFInitialOKflag/8,RFInitialOKflag%8
   440            C        
   441 00D11 0012 C        	RET
   442            C        
   443            C        ;===============================================
   444 00D12      C        INIT_FRAMEREG:
   445 00D12 1E01 C        	BANK                1
   446 00D13 00F3 C        	CLR                 TABLE_INDEX
   447 00D14      C          Set_FrameReg:
   448 00D14 0433 C        	MOV                 A,TABLE_INDEX
   449 00D15 1000 C        	CALL                FRAME_TABLE
   450 00D16 0070 C        	MOV                 ADDR,A
   451 00D17 1BFF C        	XOR                 A,@0XFF
   452 00D18 0C83 C        	JBC                 STATUS,Z
   453 00D19 1523 C        	JMP                 Set_Framereg_End
   454 00D1A 0573 C        	INC                 TABLE_INDEX
   455 00D1B 0433 C        	MOV                 A,TABLE_INDEX
   456 00D1C 1000 C        	CALL                FRAME_TABLE
   457 00D1D 0000 C        	NOP
   458 00D1E 0071 C        	MOV                 VALUE,A
   459 00D1F 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   460 00D20 0000 C        	NOP
   461 00D21 0573 C        	INC                 TABLE_INDEX
   462 00D22 1514 C        	JMP                 Set_FrameReg
   463 00D23      C          Set_Framereg_End:
   464 00D23 0000 C        	NOP
   465 00D24 0012 C        	RET
   466            C        
   467            C        ;=================================================
   468 00D25      C        INIT_RSSI_CALIBRATION:
   469 00D25 1E01 C        	BANK                1
   470 00D26 1805 C        	MOV                 A,@0X05
   471 00D27 005A C        	MOV                 DataByteLength,A
   472 00D28 00F4 C        	CLR                 RF_RSSI
   473 00D29      C          Repeat_Read_RSSI:
   474 00D29 184B C        	MOV                 A,@0X4B
   475 00D2A 0070 C        	MOV                 ADDR,A
   476 00D2B 1160 C        	CALL                READ_SPI_REG
   477 00D2C 0000 C        	NOP
   478 00D2D 0434 C        	MOV                 A,RF_RSSI
   479 00D2E 0131 C        	SUB                 A,VALUE
   480 00D2F 0E03 C        	JBS                 STATUS,C
   481 00D30 1533 C        	JMP                 $+3
   482 00D31 0431 C        	MOV                 A,VALUE
   483 00D32 0074 C        	MOV                 RF_RSSI,A
   484 00D33 05DA C        	DJZ                 DataByteLength
   485 00D34 1529 C        	JMP                 Repeat_Read_RSSI
   486            C        
   487 00D35 1804 C        	MOV                 A,@0X04
   488 00D36 0174 C        	SUB                 RF_RSSI,A
   489 00D37 0434 C        	MOV                 A,RF_RSSI
   490 00D38 0071 C        	MOV                 VALUE,A
   491 00D39 184A C        	MOV                 A,@0X4A
   492 00D3A 0070 C        	MOV                 ADDR,A
   493 00D3B 1150 C        	CALL                WRITE_SPI_REG
   494 00D3C 0000 C        	NOP
   495 00D3D 1805 C        	MOV                 A,@0X05
   496 00D3E 0070 C        	MOV                 ADDR,A
   497 00D3F 1840 C        	MOV                 A,@0X40
   498 00D40 0071 C        	MOV                 VALUE,A
   499 00D41 1150 C        	CALL                WRITE_SPI_REG
   500 00D42 0000 C        	NOP
   501 00D43 1802 C        	MOV                 A,@0X02
   502 00D44 0070 C        	MOV                 ADDR,A
   503 00D45 1800 C        	MOV                 A,@0X00
   504 00D46 0071 C        	MOV                 VALUE,A
   505 00D47 1150 C        	CALL                WRITE_SPI_REG
   506 00D48 0000 C        	NOP
   507 00D49 180C C        	MOV                 A,@0X0C
   508 00D4A 0070 C        	MOV                 ADDR,A
   509 00D4B 18E0 C        	MOV                 A,@0XE0
   510 00D4C 0071 C        	MOV                 VALUE,A
   511 00D4D 1150 C        	CALL                WRITE_SPI_REG
   512 00D4E 0000 C        	NOP
   513 00D4F 0012 C        	RET
   514            C        
   515            C        ;===========================================================
   516            C        ; RF Initialize End
   517            C        ;===========================================================
   518            C        ;===============================================
   519            C        ; Function: Write SPI Register
   520            C        ; Input:    ADDR,VALUE
   521            C        ; Output:   None
   522            C        ;===============================================
   523 00D50      C        WRITE_SPI_REG:
   524 00D50 1E00 C        	BANK                0
   525 00D51 09CA C        	BC                  SPI_SS/8,SPI_SS%8				;	/SS	=0
   526 00D52 1E01 C        	BANK                1
   527 00D53 0430 C        	MOV                 A,ADDR
   528 00D54 1174 C        	CALL                SIM_SPI_WRITE
   529 00D55 0431 C        	MOV                 A,VALUE
   530 00D56 1174 C        	CALL                SIM_SPI_WRITE
   531            C        
   532 00D57 1E02 C        	BANK                2
   533 00D58 098D C        	BC                  SPIC,SPIEB
   534 00D59 1E00 C        	BANK                0
   535 00D5A 098A C        	BC                  SPI_CLK/8,SPI_CLK%8
   536 00D5B 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;	/SS	=0
   537 00D5C 1E02 C        	BANK                2
   538 00D5D 0B8D C        	BS                  SPIC,SPIEB
   539 00D5E 1E01 C        	BANK                1
   540            C        
   541 00D5F 0012 C        	RET
   542            C        
   543            C        ;===============================================
   544            C        ; Function: Read SPI Register
   545            C        ; Input:   SPIWB
   546            C        ; Output:  SPIRB
   547            C        ;===============================================
   548 00D60      C        READ_SPI_REG:
   549 00D60 1E00 C        	BANK                0
   550 00D61 09CA C        	BC                  SPI_SS/8,SPI_SS%8			;	/SS	=0
   551 00D62 1E01 C        	BANK                1
   552 00D63 0430 C        	MOV                 A,ADDR
   553 00D64 1980 C        	OR                  A,@0X80
   554 00D65 1174 C        	CALL                SIM_SPI_WRITE
   555 00D66 0000 C        	NOP
   556 00D67 1180 C        	CALL                SIM_SPI_READ
   557 00D68 0071 C        	MOV                 VALUE,A
   558            C        
   559 00D69 1E02 C        	BANK                2
   560 00D6A 098D C        	BC                  SPIC,SPIEB
   561 00D6B 1E00 C        	BANK                0
   562 00D6C 098A C        	BC                  SPI_CLK/8,SPI_CLK%8
   563 00D6D 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;	/SS	=0
   564 00D6E 1E02 C        	BANK                2
   565 00D6F 0B8D C        	BS                  SPIC,SPIEB
   566 00D70 1E01 C        	BANK                1
   567            C        
   568 00D71 0000 C        	NOP
   569 00D72 0000 C        	NOP
   570 00D73 0012 C        	RET
   571            C        
   572            C        ;===============================================
   573            C        ; Function: Write SPI communication subroutine rising edge
   574            C        ; Input:    ACC
   575            C        ; Output:   None
   576            C        ;===============================================
   577 00D74      C        SIM_SPI_WRITE:
   578 00D74 1E02 C        	BANK                2
   579 00D75 00CC C        	CLR                 SPIS
   580 00D76 00CE C        	CLR                 SPIR
   581 00D77 004F C        	MOV                 SPIW,A         ; Write data to buffer
   582 00D78 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   583 00D79 0000 C        	NOP
   584 00D7A 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   585 00D7B 1579 C        	JMP                 $-2
   586 00D7C 1E01 C        	BANK                1
   587 00D7D 0000 C        	NOP
   588 00D7E 0012 C        	RET
   589 00D7F 0000 C        	NOP
   590            C        
   591            C        ;===============================================
   592            C        ; Function: Read SPI communication subroutine rising edge
   593            C        ; Input:    None
   594            C        ; Output:   SPI Data
   595            C        ;===============================================
   596 00D80      C        SIM_SPI_READ:
   597 00D80 1E02 C        	BANK                2
   598 00D81 00CC C        	CLR                 SPIS
   599 00D82 00CE C        	CLR                 SPIR
   600 00D83 00CF C        	CLR                 SPIW            ; Write data to buffer
   601 00D84 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   602 00D85 0000 C        	NOP
   603 00D86 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   604 00D87 1585 C        	JMP                 $-2
   605 00D88 040E C        	MOV                 A,SPIR
   606 00D89 1E01 C        	BANK                1
   607 00D8A 0000 C        	NOP
   608 00D8B 0012 C           	RET
   609 00D8C 0000 C           	NOP
   610            C        
   611            C        ;==========================================================
   612            C        ; Read/Write subroutine
   613            C        ;==========================================================
   614 00D8D      C        SIM_SPI_READ_WRITE:
   615 00D8D 1E02 C        	BANK                2
   616 00D8E 00CC C        	CLR                 SPIS
   617 00D8F 00CE C        	CLR                 SPIR
   618 00D90 004F C        	MOV                 SPIW,A            ; Write data to buffer
   619 00D91 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   620 00D92 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   621 00D93 1592 C        	JMP                 $-1
   622 00D94 040E C        	MOV                 A,SPIR
   623 00D95 1E01 C        	BANK                1
   624 00D96 0000 C        	NOP
   625 00D97 0012 C           	RET
   626 00D98 0000 C           	NOP
   627            C        
   628            C        
   629            C        ;===============================================
   630            C        ; Function: Read FIFO RAM
   631            C        ; Input:    None
   632            C        ; Output:   RX_BUF	,Receive_Error
   633            C        ;===============================================
   634 00D99      C        READ_FIFO_RAM:
   635 00D99 1E00 C        	BANK                0
   636 00D9A 18E0 C        	MOV                 A,@RX_BUF					;READ DATA START Address
   637 00D9B 0044 C        	MOV                 RSR,A
   638 00D9C 0000 C        	NOP
   639 00D9D 0000 C        	NOP
   640 00D9E 09CA C        	BC                  SPI_SS/8,SPI_SS%8				;/SS=0
   641 00D9F 18FF C        	MOV                 A,@0XFF						;0X7F||0X80 FIFO ADDRESS
   642 00DA0 1174 C        	CALL                SIM_SPI_WRITE
   643 00DA1 0000 C        	NOP
   644 00DA2 1820 C        	MOV                 A,@PKT_LEN
   645 00DA3 005A C        	MOV                 DataByteLength,A
   646 00DA4      C          Read_FIFO_Loop:
   647 00DA4 1180 C        	CALL                SIM_SPI_READ	 					;Packet & Device	ID
   648 00DA5 1E00 C        	BANK                0
   649 00DA6 0040 C        	MOV                 R0,A
   650 00DA7 0544 C        	INC                 RSR
   651 00DA8 05DA C        	DJZ                 DataByteLength
   652 00DA9 15A4 C        	JMP                 Read_FIFO_Loop
   653 00DAA 0B84 C        	BS                  RSR,BNC                      ; include EM78P520.H
   654 00DAB 0BCA C        	BS                  SPI_SS/8,SPI_SS%8				;/SS=1
   655 00DAC 1E01 C        	BANK                1
   656 00DAD 0000 C        	NOP
   657 00DAE 0012 C        	RET
   658 00DAF 0000 C        	NOP
   659            C        
   660            C        
   661            C        ;===============================================
   662            C        ; Function: Write FIFO RAM
   663            C        ; Input:    None
   664            C        ; Output:   RX_Buf	,Receive_Error%8
   665            C        ;===============================================
   666 00DB0      C        WRITE_FIFO_RAM:
   667 00DB0 1E00 C        	BANK                0
   668 00DB1 09CA C        	BC                  SPI_SS/8,SPI_SS%8				;/SS=1
   669 00DB2 187F C        	MOV                 A,@0X7F						;reg0X7F	SET
   670 00DB3 1174 C        	CALL                SIM_SPI_WRITE
   671 00DB4 1E00 C        	BANK                0
   672 00DB5 1820 C        	MOV                 A,@PKT_LEN
   673 00DB6 005A C        	MOV                 DataByteLength,A
   674 00DB7 18E0 C        	MOV                 A,@TX_BUF					;Write DATA START Address
   675 00DB8 0044 C        	MOV                 RSR, A
   676            C        
   677 00DB9      C          Write_FIFO_Loop:
   678 00DB9 0400 C        	MOV                 A,R0
   679 00DBA 1174 C        	CALL                SIM_SPI_WRITE
   680 00DBB 0000 C        	NOP
   681 00DBC 1E00 C        	BANK                0
   682 00DBD 0544 C        	INC                 RSR
   683 00DBE 05DA C        	DJZ                 DataByteLength
   684 00DBF 15B9 C        	JMP                 Write_FIFO_Loop
   685 00DC0 0BCA C        	BS                  SPI_SS/8,SPI_SS%8				;/SS=1
   686 00DC1 0E0B C        	JBS                 PKT_FLAG/8,PKT_FLAG%8
   687 00DC2 15C1 C        	JMP                 $-1
   688 00DC3 0B84 C        	BS                  RSR,BNC                      ; include EM78P520.H
   689 00DC4 1E01 C        	BANK                1
   690 00DC5 0000 C        	NOP
   691 00DC6 0012 C        	RET
   692 00DC7 0000 C        	NOP
   693            C        
   694            C        
   695            C        ;===============================================
   696            C        ; Function: Reset RF FIFO
   697            C        ; Input:    None
   698            C        ; Output:   None
   699            C        ;===============================================
   700 00DC8      C        RESET_RF_FIFO:
   701 00DC8 1E00 C        	BANK                0
   702 00DC9 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=0
   703 00DCA 1E01 C        	BANK                1
   704 00DCB 184D C        	MOV                 A,@0X4D
   705 00DCC 0070 C        	MOV                 ADDR,A					;ADDR=0X4D
   706 00DCD 1801 C        	MOV                 A,@0X01
   707 00DCE 0071 C        	MOV                 VALUE,A
   708 00DCF 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   709            C        	;MOV                 A,@12
   710            C        	;CALL                DELAY_X10US
   711            C          if MassageDisplay == 1
   712            C        	MESSAGE "Make sure that anything take-over or send out in 120us "
   713            C          endif
   714 00DD0 0012 C        	RET
   715            C        
   716            C        
   717            C        ;***********************************************************
   718            C        ; Function: Enter TX Buffered ACK
   719            C        ; Input:    None
   720            C        ; Output:   None
   721            C        ;***********************************************************
   722 00DD1      C        ENTER_TX_BUFFER_ACK:
   723 00DD1 1E00 C        	BANK                0
   724 00DD2 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   725 00DD3 1E01 C        	BANK                1
   726 00DD4 1800 C        	MOV                 A,@0X00
   727 00DD5 0070 C        	MOV                 ADDR,A
   728 00DD6 18E5 C        	MOV                 A,@0XE5
   729 00DD7 0071 C        	MOV                 VALUE,A
   730 00DD8 1150 C        	CALL                WRITE_SPI_REG
   731 00DD9 1801 C        	MOV                 A,@0X01
   732 00DDA 0070 C        	MOV                 ADDR,A
   733 00DDB 1884 C        	MOV                 A,@0X84
   734 00DDC 0071 C        	MOV                 VALUE,A
   735 00DDD 1150 C        	CALL                WRITE_SPI_REG
   736 00DDE 1841 C        	MOV                 A,@0X41
   737 00DDF 0070 C        	MOV                 ADDR,A
   738 00DE0 18BF C        	MOV                 A,@0XBF
   739 00DE1 0071 C        	MOV                 VALUE,A
   740 00DE2 1150 C        	CALL                WRITE_SPI_REG
   741 00DE3 1840 C        	MOV                 A,@0X40
   742 00DE4 0070 C        	MOV                 ADDR,A
   743 00DE5 1856 C        	MOV                 A,@0X56
   744            C        	if                  USED_PID_FUNCTION
   745            C        		OR              A,@0X80
   746            C        	endif
   747 00DE6 0071 C        	MOV                 VALUE,A
   748 00DE7 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   749 00DE8 0000 C        	NOP
   750 00DE9 0012 C        	RET
   751 00DEA 0000 C        	NOP
   752            C        
   753            C        
   754            C        ;***********************************************************
   755            C        ; Function: Enter TX Buffered NACK
   756            C        ; Input:    None
   757            C        ; Output:   None
   758            C        ;***********************************************************
   759 00DEB      C        Enter_TX_Buffer_NACK:
   760 00DEB 1E00 C        	BANK                0
   761 00DEC 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   762 00DED 1E01 C        	BANK                1
   763 00DEE 1800 C        	MOV                 A,@0X00
   764 00DEF 0070 C        	MOV                 ADDR,A
   765 00DF0 18E5 C        	MOV                 A,@0XE5
   766 00DF1 0071 C        	MOV                 VALUE,A
   767 00DF2 1150 C        	CALL                WRITE_SPI_REG
   768 00DF3 1801 C        	MOV                 A,@0X01
   769 00DF4 0070 C        	MOV                 ADDR,A
   770 00DF5 1884 C        	MOV                 A,@0X84
   771 00DF6 0071 C        	MOV                 VALUE,A
   772 00DF7 1150 C        	CALL                WRITE_SPI_REG
   773 00DF8 1841 C        	MOV                 A,@0X41
   774 00DF9 0070 C        	MOV                 ADDR,A
   775 00DFA 18BF C        	MOV                 A,@0XBF
   776 00DFB 0071 C        	MOV                 VALUE,A
   777 00DFC 1150 C        	CALL                WRITE_SPI_REG
   778 00DFD 1840 C        	MOV                 A,@0X40
   779 00DFE 0070 C        	MOV                 ADDR,A
   780 00DFF 1852 C        	MOV                 A,@0X52
   781            C        	if                  USED_PID_FUNCTION
   782            C        		OR              A,@0X80
   783            C        	endif
   784 00E00 0071 C        	MOV                 VALUE,A
   785 00E01 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   786 00E02 0000 C        	NOP
   787 00E03 0012 C        	RET
   788 00E04 0000 C        	NOP
   789            C        
   790            C        ;***********************************************************
   791            C        ; Function: Enter TX Direct ACK
   792            C        ; Input:    None
   793            C        ; Output:   None
   794            C        ;***********************************************************
   795 00E05      C        Enter_TX_Direct_ACK:
   796 00E05 1E00 C        	BANK                0
   797 00E06 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   798 00E07 1E01 C        	BANK                1
   799 00E08 1800 C        	MOV                 A,@0X00
   800 00E09 0070 C        	MOV                 ADDR,A
   801 00E0A 1885 C        	MOV                 A,@0X85
   802 00E0B 0071 C        	MOV                 VALUE,A
   803 00E0C 1150 C        	CALL                WRITE_SPI_REG
   804 00E0D 1801 C        	MOV                 A,@0X01
   805 00E0E 0070 C        	MOV                 ADDR,A
   806 00E0F 1884 C        	MOV                 A,@0X84
   807 00E10 0071 C        	MOV                 VALUE,A
   808 00E11 1150 C        	CALL                WRITE_SPI_REG
   809 00E12 1841 C        	MOV                 A,@0X41
   810 00E13 0070 C        	MOV                 ADDR,A
   811 00E14 18BF C        	MOV                 A,@0XBF
   812 00E15 0071 C        	MOV                 VALUE,A
   813 00E16 1150 C        	CALL                WRITE_SPI_REG
   814 00E17 1840 C        	MOV                 A,@0X40
   815 00E18 0070 C        	MOV                 ADDR,A
   816 00E19 1856 C        	MOV                 A,@0X56
   817            C        	if                  USED_PID_FUNCTION
   818            C        		OR              A,@0X80
   819            C        	endif
   820 00E1A 0071 C        	MOV                 VALUE,A
   821 00E1B 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   822 00E1C 0000 C        	NOP
   823 00E1D 0012 C        	RET
   824            C        
   825            C        
   826            C        ;***********************************************************
   827            C        ; Function: Enter TX Direct NACK
   828            C        ; Input:    None
   829            C        ; Output:   None
   830            C        ;***********************************************************
   831 00E1E      C        Enter_TX_Direct_NACK:
   832 00E1E 1E00 C        	BANK                0
   833 00E1F 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   834 00E20 1E01 C        	BANK                1
   835 00E21 1800 C        	MOV                 A,@0X00
   836 00E22 0070 C        	MOV                 ADDR,A
   837 00E23 1885 C        	MOV                 A,@0X85
   838 00E24 0071 C        	MOV                 VALUE,A
   839 00E25 1150 C        	CALL                WRITE_SPI_REG
   840 00E26 1801 C        	MOV                 A,@0X01
   841 00E27 0070 C        	MOV                 ADDR,A
   842 00E28 1884 C        	MOV                 A,@0X84
   843 00E29 0071 C        	MOV                 VALUE,A
   844 00E2A 1150 C        	CALL                WRITE_SPI_REG
   845 00E2B 1841 C        	MOV                 A,@0X41
   846 00E2C 0070 C        	MOV                 ADDR,A
   847 00E2D 18BF C        	MOV                 A,@0XBF
   848 00E2E 0071 C        	MOV                 VALUE,A
   849 00E2F 1150 C        	CALL                WRITE_SPI_REG
   850 00E30 1840 C        	MOV                 A,@0X40
   851 00E31 0070 C        	MOV                 ADDR,A
   852 00E32 1852 C        	MOV                 A,@0X52
   853            C        	if                  USED_PID_FUNCTION
   854            C        		OR              A,@0X80
   855            C        	endif
   856 00E33 0071 C        	MOV                 VALUE,A
   857 00E34 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   858 00E35 0000 C        	NOP
   859 00E36 0012 C        	RET
   860 00E37 0000 C        	NOP
   861            C        
   862            C        ;***********************************************************
   863            C        ; Function: Enter RX Buffered ACK
   864            C        ; Input:    None
   865            C        ; Output:   None
   866            C        ;***********************************************************
   867 00E38      C        Enter_RX_Buffer_ACK:
   868 00E38 1E00 C        	BANK                0
   869 00E39 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   870 00E3A 1E01 C        	BANK                1
   871 00E3B 1800 C        	MOV                 A,@0X00
   872 00E3C 0070 C        	MOV                 ADDR,A
   873 00E3D 18E5 C        	MOV                 A,@0XE5
   874 00E3E 0071 C        	MOV                 VALUE,A
   875 00E3F 1150 C        	CALL                WRITE_SPI_REG
   876 00E40 1801 C        	MOV                 A,@0X01
   877 00E41 0070 C        	MOV                 ADDR,A
   878 00E42 1884 C        	MOV                 A,@0X84
   879 00E43 0071 C        	MOV                 VALUE,A
   880 00E44 1150 C        	CALL                WRITE_SPI_REG
   881 00E45 1841 C        	MOV                 A,@0X41
   882 00E46 0070 C        	MOV                 ADDR,A
   883 00E47 18BF C        	MOV                 A,@0XBF
   884 00E48 0071 C        	MOV                 VALUE,A
   885 00E49 1150 C        	CALL                WRITE_SPI_REG
   886 00E4A 1840 C        	MOV                 A,@0X40
   887 00E4B 0070 C        	MOV                 ADDR,A
   888 00E4C 1859 C        	MOV                 A,@0X59
   889            C        	if                  USED_PID_FUNCTION
   890            C        		OR              A,@0X80
   891            C        	endif
   892 00E4D 0071 C        	MOV                 VALUE,A
   893 00E4E 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   894 00E4F 0000 C        	NOP
   895 00E50 0012 C        	RET
   896 00E51 0000 C        	NOP
   897            C        
   898            C        ;**********************************************************
   899            C        ; Function: Enter RX Buffered NACK
   900            C        ; Input:    None
   901            C        ; Output:   None
   902            C        ;***********************************************************
   903 00E52      C        Enter_RX_Buffer_NACK:
   904 00E52 1E00 C        	BANK                0
   905 00E53 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   906 00E54 1E01 C        	BANK                1
   907 00E55 1800 C        	MOV                 A,@0X00
   908 00E56 0070 C        	MOV                 ADDR,A
   909 00E57 18E5 C        	MOV                 A,@0XE5
   910 00E58 0071 C        	MOV                 VALUE,A
   911 00E59 1150 C        	CALL                WRITE_SPI_REG
   912 00E5A 1801 C        	MOV                 A,@0X01
   913 00E5B 0070 C        	MOV                 ADDR,A
   914 00E5C 1884 C        	MOV                 A,@0X84
   915 00E5D 0071 C        	MOV                 VALUE,A
   916 00E5E 1150 C        	CALL                WRITE_SPI_REG
   917 00E5F 1841 C        	MOV                 A,@0X41
   918 00E60 0070 C        	MOV                 ADDR,A
   919 00E61 18BF C        	MOV                 A,@0XBF
   920 00E62 0071 C        	MOV                 VALUE,A
   921 00E63 1150 C        	CALL                WRITE_SPI_REG
   922 00E64 1840 C        	MOV                 A,@0X40
   923 00E65 0070 C        	MOV                 ADDR,A
   924 00E66 1851 C        	MOV                 A,@0X51
   925            C        	if                  USED_PID_FUNCTION
   926            C        		OR              A,@0X80
   927            C        	endif
   928 00E67 0071 C        	MOV                 VALUE,A
   929 00E68 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   930 00E69 0000 C        	NOP
   931 00E6A 0012 C        	RET
   932 00E6B 0000 C        	NOP
   933            C        
   934            C        ;***********************************************************
   935            C        ; Function: Enter RX Direct ACK
   936            C        ; Input:    None
   937            C        ; Output:   None
   938            C        ;***********************************************************
   939 00E6C      C        Enter_RX_Direct_ACK:
   940 00E6C 1E00 C        	BANK                0
   941 00E6D 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   942 00E6E 1E01 C        	BANK                1
   943 00E6F 1800 C        	MOV                 A,@0X00
   944 00E70 0070 C        	MOV                 ADDR,A
   945 00E71 1885 C        	MOV                 A,@0X85
   946 00E72 0071 C        	MOV                 VALUE,A
   947 00E73 1150 C        	CALL                WRITE_SPI_REG
   948 00E74 1801 C        	MOV                 A,@0X01
   949 00E75 0070 C        	MOV                 ADDR,A
   950 00E76 1884 C        	MOV                 A,@0X84
   951 00E77 0071 C        	MOV                 VALUE,A
   952 00E78 1150 C        	CALL                WRITE_SPI_REG
   953 00E79 1841 C        	MOV                 A,@0X41
   954 00E7A 0070 C        	MOV                 ADDR,A
   955 00E7B 18BF C        	MOV                 A,@0XBF
   956 00E7C 0071 C        	MOV                 VALUE,A
   957 00E7D 1150 C        	CALL                WRITE_SPI_REG
   958 00E7E 1840 C        	MOV                 A,@0X40
   959 00E7F 0070 C        	MOV                 ADDR,A
   960 00E80 1859 C        	MOV                 A,@0X59
   961            C        	if                  USED_PID_FUNCTION
   962            C        		OR              A,@0X80
   963            C        	endif
   964 00E81 0071 C        	MOV                 VALUE,A
   965 00E82 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   966 00E83 0012 C        	RET
   967            C        
   968            C        
   969            C        ;**********************************************************
   970            C        ; Function: Enter RX Direct NACK
   971            C        ; Input:    None
   972            C        ; Output:   None
   973            C        ;***********************************************************
   974 00E84      C        Enter_RX_Direct_NACK:
   975 00E84 1E00 C        	BANK                0
   976 00E85 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
   977 00E86 1E01 C        	BANK                1
   978 00E87 1800 C        	MOV                 A,@0X00
   979 00E88 0070 C        	MOV                 ADDR,A
   980 00E89 1885 C        	MOV                 A,@0X85
   981 00E8A 0071 C        	MOV                 VALUE,A
   982 00E8B 1150 C        	CALL                WRITE_SPI_REG
   983 00E8C 1801 C        	MOV                 A,@0X01
   984 00E8D 0070 C        	MOV                 ADDR,A
   985 00E8E 1884 C        	MOV                 A,@0X84
   986 00E8F 0071 C        	MOV                 VALUE,A
   987 00E90 1150 C        	CALL                WRITE_SPI_REG
   988 00E91 1841 C        	MOV                 A,@0X41
   989 00E92 0070 C        	MOV                 ADDR,A
   990 00E93 18BF C        	MOV                 A,@0XBF
   991 00E94 0071 C        	MOV                 VALUE,A
   992 00E95 1150 C        	CALL                WRITE_SPI_REG
   993 00E96 1840 C        	MOV                 A,@0X40
   994 00E97 0070 C        	MOV                 ADDR,A
   995 00E98 1851 C        	MOV                 A,@0X51
   996            C        	if                  USED_PID_FUNCTION
   997            C        		OR              A,@0X80
   998            C        	endif
   999 00E99 0071 C        	MOV                 VALUE,A
  1000 00E9A 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1001 00E9B 0000 C        	NOP
  1002 00E9C 0012 C        	RET
  1003 00E9D 0000 C        	NOP
  1004            C        
  1005            C        ;***********************************************************
  1006            C        ; Function: Enter StandbyI Mode
  1007            C        ; Input:    None
  1008            C        ; Output:   None
  1009            C        ; description:
  1010            C        ;***********************************************************
  1011 00E9E      C        Enter_StandbyI_Mode:
  1012 00E9E 1E00 C        	BANK                0
  1013 00E9F 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
  1014 00EA0 1E01 C        	BANK                1
  1015 00EA1 1800 C        	MOV                 A,@0X00
  1016 00EA2 0070 C        	MOV                 ADDR,A
  1017 00EA3 1865 C        	MOV                 A,@0X65
  1018 00EA4 0071 C        	MOV                 VALUE,A
  1019 00EA5 1150 C        	CALL                WRITE_SPI_REG
  1020 00EA6 1801 C        	MOV                 A,@0X01
  1021 00EA7 0070 C        	MOV                 ADDR,A
  1022 00EA8 188C C        	MOV                 A,@0X8C
  1023 00EA9 0071 C        	MOV                 VALUE,A
  1024 00EAA 1150 C        	CALL                WRITE_SPI_REG
  1025 00EAB 1840 C        	MOV                 A,@0X40
  1026 00EAC 0070 C        	MOV                 ADDR,A
  1027 00EAD 1850 C        	MOV                 A,@0X50
  1028            C        	if                  USED_PID_FUNCTION
  1029            C        		OR              A,@0X80
  1030            C        	endif
  1031 00EAE 0071 C        	MOV                 VALUE,A
  1032 00EAF 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1033 00EB0 0000 C        	NOP
  1034 00EB1 0012 C        	RET
  1035 00EB2 0000 C        	NOP
  1036            C        
  1037            C        ;***********************************************************
  1038            C        ; Function: Enter StandbyII Mode
  1039            C        ; Input:    None
  1040            C        ; Output:   None
  1041            C        ; description: auto enter
  1042            C        ;***********************************************************
  1043 00EB3      C        Enter_StandbyII_Mode:
  1044 00EB3 1E00 C        	BANK                0
  1045 00EB4 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=0
  1046 00EB5 1E01 C        	BANK                1
  1047 00EB6 1800 C        	MOV                 A,@0X00
  1048 00EB7 0070 C        	MOV                 ADDR,A
  1049 00EB8 18E5 C        	MOV                 A,@0XE5
  1050 00EB9 0071 C        	MOV                 VALUE,A
  1051 00EBA 1150 C        	CALL                WRITE_SPI_REG
  1052 00EBB 1801 C        	MOV                 A,@0X01
  1053 00EBC 0070 C        	MOV                 ADDR,A
  1054 00EBD 1884 C        	MOV                 A,@0X84
  1055 00EBE 0071 C        	MOV                 VALUE,A
  1056 00EBF 1150 C        	CALL                WRITE_SPI_REG
  1057 00EC0 1841 C        	MOV                 A,@0X41
  1058 00EC1 0070 C        	MOV                 ADDR,A
  1059 00EC2 1880 C        	MOV                 A,@0X80
  1060 00EC3 0071 C        	MOV                 VALUE,A
  1061 00EC4 1150 C        	CALL                WRITE_SPI_REG
  1062 00EC5 1840 C        	MOV                 A,@0X40
  1063 00EC6 0070 C        	MOV                 ADDR,A
  1064 00EC7 1852 C        	MOV                 A,@0X52
  1065            C        	if                  USED_PID_FUNCTION
  1066            C        		OR              A,@0X80
  1067            C        	endif
  1068 00EC8 0071 C        	MOV                 VALUE,A
  1069 00EC9 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1070 00ECA 0000 C        	NOP
  1071 00ECB 0012 C        	RET
  1072 00ECC 0000 C        	NOP
  1073            C        
  1074            C        ;===============================================
  1075            C        ; Function: Enter Idle Mode
  1076            C        ; Input:    None
  1077            C        ; Output:   None
  1078            C        ;===============================================
  1079 00ECD      C        ENTER_IDLE_MODE:
  1080 00ECD 1E00 C        	BANK                0
  1081 00ECE 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
  1082 00ECF 1E01 C        	BANK                1
  1083 00ED0 1800 C        	MOV                 A,@0X00
  1084 00ED1 0070 C        	MOV                 ADDR,A
  1085 00ED2 18C0 C        	MOV                 A,@0XC0
  1086 00ED3 0071 C        	MOV                 VALUE,A
  1087 00ED4 1150 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
  1088 00ED5 1801 C        	MOV                 A,@0X01
  1089 00ED6 0070 C        	MOV                 ADDR,A
  1090 00ED7 188A C        	MOV                 A,@0X8A
  1091 00ED8 0071 C        	MOV                 VALUE,A
  1092 00ED9 1150 C        	CALL                WRITE_SPI_REG
  1093 00EDA 1E00 C        	BANK                0
  1094 00EDB 08CA C        	BC                  RESET_N/8,RESET_N%8
  1095 00EDC 1E01 C        	BANK                1
  1096 00EDD 0000 C        	NOP
  1097 00EDE 0012 C        	RET
  1098 00EDF 0000 C        	NOP
  1099            C        
  1100            C        ;===============================================
  1101            C        ; Function: EXIT Idle Mode
  1102            C        ; Input:    None
  1103            C        ; Output:   None
  1104            C        ;===============================================
  1105 00EE0      C        EXIT_IDLE_MODE:
  1106 00EE0 1E00 C        	BANK                0
  1107 00EE1 0ACA C        	BS		            RESET_N/8,RESET_N%8
  1108 00EE2 1E01 C        	BANK                1
  1109 00EE3 1832 C        	MOV                 A,@50                          ; wating 10ms
  1110 00EE4 1EA0 C        	LCALL                DELAY_8MHz_X100US
  1110 00EE5 0333 C        	LCALL                DELAY_8MHz_X100US
  1111 00EE6 12B3 C        	CALL                Enter_StandbyII_Mode
  1112 00EE7 0000 C        	NOP
  1113 00EE8 0012 C        	RET
  1114 00EE9 0000 C        	NOP
  1115            C        
  1116            C        ;===============================================
  1117            C        ; Function: RF Wake Up
  1118            C        ; Input:    None
  1119            C        ; Output:   None
  1120            C        ;===============================================
  1121 00EEA      C        RF_WAKEUP:
  1122 00EEA 1E00 C        	BANK                0
  1123 00EEB 0ACA C        	BS                  RESET_N/8,RESET_N%8
  1124 00EEC 1819 C        	MOV                 A,@25
  1125 00EED 1EA0 C        	LCALL                DELAY_8MHz_X100US
  1125 00EEE 0333 C        	LCALL                DELAY_8MHz_X100US
  1126 00EEF 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
  1127 00EF0 1E01 C        	BANK                1
  1128 00EF1 1800 C        	MOV                 A,@0X00
  1129 00EF2 0070 C        	MOV                 ADDR,A
  1130 00EF3 18E5 C        	MOV                 A,@0XE5
  1131 00EF4 0071 C        	MOV                 VALUE,A
  1132 00EF5 1150 C        	CALL                WRITE_SPI_REG
  1133 00EF6 0000 C        	NOP
  1134 00EF7 0012 C        	RET
  1135 00EF8 0000 C        	NOP
  1136            C        
  1137            C        ;===============================================
  1138            C        ; Function: RF Channel Frequency Set
  1139            C        ; Input:    TABLE_INDEX
  1140            C        ; Output:   None
  1141            C        ;===============================================
  1142 00EF9      C        RF_FREQ_SET:
  1143 00EF9 1E00 C        	BANK                0
  1144 00EFA 0BCA C        	BS                  SPI_SS/8,SPI_SS%8			;/SS=1
  1145 00EFB 1E01 C        	BANK                1
  1146 00EFC 1802 C        	MOV                 A,@0X02
  1147 00EFD 0070 C        	MOV                 ADDR,A
  1148 00EFE 0425 C        	MOV                 A,CH_NO
  1149 00EFF 10AC C        	CALL                CH_TABLE
  1150 00F00 0071 C        	MOV                 VALUE,A
  1151 00F01 1150 C        	CALL                WRITE_SPI_REG
  1152 00F02 0000 C        	NOP
  1153 00F03 0012 C        	RET
  1154 00F04 0000 C        	NOP
  1155            C        
  1156            C        ;===============================================
  1157            C        ; Function: Read PKT Lost Count
  1158            C        ; Input:    None
  1159            C        ; Output:   PKT_Lost_Count
  1160            C        ;===============================================
  1161 00F05      C        READ_PKTLOSTCNT:
  1162 00F05 184F C        	MOV                 A,@0X4F
  1163 00F06 0070 C        	MOV                 ADDR,A
  1164 00F07 1160 C        	CALL                READ_SPI_REG
  1165 00F08 0000 C        	NOP
  1166 00F09 0012 C        	RET
  1167 00F0A 0000 C        	NOP
  1168            C        
  1169            C        ;===============================================
  1170            C        ; Function: Clr PKT Lost Count
  1171            C        ; Input:    Zero
  1172            C        ; Output:   None
  1173            C        ;===============================================
  1174 00F0B      C        CLR_PKTLOSTCNT:
  1175 00F0B 184F C        	MOV                 A,@0X4F
  1176 00F0C 0070 C        	MOV                 ADDR,A
  1177 00F0D 1800 C        	MOV                 A,@0X00
  1178 00F0E 0071 C        	MOV                 VALUE,A
  1179 00F0F 1150 C        	CALL                WRITE_SPI_REG
  1180 00F10 0012 C        	RET
  1181            C        
  1182            C        ;===============================================
  1183            C        ; Function: Address change function
  1184            C        ; Input:    RX_IDH,RX_IDL
  1185            C        ; Output:   None
  1186            C        ;===============================================
  1187 00F11      C        CHANGE_ADDRESS_VALUE:
  1188 00F11 1E01 C        	BANK                1
  1189 00F12 1851 C        	MOV                 A,@0X51
  1190 00F13 0070 C        	MOV                 ADDR,A
  1191 00F14 0421 C        	MOV                 A,RX_IDH
  1192 00F15 0071 C        	MOV                 VALUE,A
  1193 00F16 1150 C        	CALL                WRITE_SPI_REG
  1194            C        
  1195 00F17 1853 C        	MOV                 A,@0X53
  1196 00F18 0070 C        	MOV                 ADDR,A
  1197 00F19 0421 C        	MOV                 A,RX_IDH
  1198 00F1A 0071 C        	MOV                 VALUE,A
  1199 00F1B 1150 C        	CALL                WRITE_SPI_REG
  1200            C        
  1201 00F1C 1850 C        	MOV                 A,@0X50
  1202 00F1D 0070 C        	MOV                 ADDR,A
  1203 00F1E 0422 C        	MOV                 A,RX_IDL
  1204 00F1F 0071 C        	MOV                 VALUE,A
  1205 00F20 1150 C        	CALL                WRITE_SPI_REG
  1206            C        /*
  1207            C        	MOV                 A,@0X52
  1208            C        	MOV                 ADDR,A
  1209            C        	MOV                 A,RX_IDL
  1210            C        	AND                 A,@0B11110000
  1211            C        	MOV                 VALUE,A
  1212            C        	INC                 VALUE         ; TX_ID1=(RX_IDL&0XF0)|0X01
  1213            C        	INC                 VALUE         ; TX_ID2=(RX_IDL&0XF0)|0X02
  1214            C        	CALL                WRITE_SPI_REG
  1215            C        
  1216            C        	MOV                 A,@0X54
  1217            C        	MOV                 ADDR,A
  1218            C        	INC                 VALUE         ; TX_ID3=(RX_IDL&0XF0)|0X03
  1219            C        	CALL                WRITE_SPI_REG
  1220            C        
  1221            C        	MOV                 A,@0X55
  1222            C        	MOV                 ADDR,A
  1223            C        	INC                 VALUE         ; TX_ID4=(RX_IDL&0XF0)|0X04
  1224            C        	CALL                WRITE_SPI_REG
  1225            C        
  1226            C        	MOV                 A,@0X56
  1227            C        	MOV                 ADDR,A
  1228            C        	INC                 VALUE         ; TX_ID5=(RX_IDL&0XF0)|0X05
  1229            C        	CALL                WRITE_SPI_REG
  1230            C        
  1231            C        	MOV                 A,@0X57
  1232            C        	MOV                 ADDR,A
  1233            C        	INC                 VALUE         ; TX_ID6=(RX_IDL&0XF0)|0X06
  1234            C        	CALL                WRITE_SPI_REG
  1235            C        */
  1236 00F21 0000 C        	NOP
  1237 00F22 0012 C        	RET
  1238 00F23 0000 C        	NOP
  1239            C        
  1240            C        ;***********************************************************
  1241            C        ; Function: RF RSSI Check the channel if is clean
  1242            C        ; Input:    None
  1243            C        ; Output:   None
  1244            C        ;***********************************************************
  1245 00F24      C        RF_RSSI_CHECK:
  1246 00F24 1252 C        	CALL                Enter_RX_Buffer_NACK
  1247 00F25      C          Scan_Clean_Channel:
  1248 00F25 1001 C        	CALL                1
  1249 00F26 184B C        	MOV                 A,@0X4B
  1250 00F27 0070 C        	MOV                 ADDR,A
  1251 00F28 1160 C        	CALL                READ_SPI_REG
  1252 00F29 0431 C        	MOV                 A,VALUE
  1253 00F2A 1D25 C        	SUB                 A,@NoiseStrobe
  1254 00F2B 0E03 C        	JBS                 STATUS,C
  1255 00F2C 1738 C        	JMP                 Exit_RSSI_Check
  1256            C        
  1257 00F2D 1001 C        	CALL                1
  1258 00F2E 0565 C        	INC                 CH_NO
  1259 00F2F 0425 C        	MOV                 A,CH_NO
  1260 00F30 1D4B C        	SUB                 A,@ChannelSum
  1261 00F31 0E03 C        	JBS                 STATUS,C
  1262 00F32 00E5 C        	CLR                 CH_NO
  1263 00F33 12F9 C        	CALL                RF_FREQ_SET
  1264 00F34 1805 C        	MOV                 A,@5
  1265 00F35 1EA0 C        	LCALL                DELAY_8MHz_X100US
  1265 00F36 0333 C        	LCALL                DELAY_8MHz_X100US
  1266            C        
  1267            C        	;MOV                 A,@0X80      ; (test)P57 exchange when intrrupt
  1268            C        	;XOR                 PORT5,A
  1269            C        
  1270 00F37 1725 C        	JMP                 Scan_Clean_Channel
  1271 00F38      C          Exit_RSSI_Check:
  1272 00F38 0000 C        	NOP
  1273 00F39 0012 C        	RET
  1274 00F3A 0000 C        	NOP
  1275            C        
  1276            C        ;===============================================
  1277            C        ;test RF Register, if read==write test pass
  1278            C        ;===============================================
  1279 00F3B      C        TEST_INITIAL_RF:
  1280 00F3B      C          Analog_Reg_Test:
  1281 00F3B 1807 C        	MOV                 A,@0X07
  1282 00F3C 0070 C        	MOV                 ADDR,A
  1283 00F3D 1858 C        	MOV                 A,@0X58						;R7[6]=1
  1284 00F3E 0071 C        	MOV                 VALUE,A
  1285 00F3F 1150 C        	CALL                WRITE_SPI_REG
  1286 00F40 0000 C        	NOP
  1287 00F41 180E C        	MOV                 A,@0X0E
  1288 00F42 0070 C        	MOV                 ADDR,A
  1289 00F43 1811 C        	MOV                 A,@0X11						;RE[7]=0
  1290 00F44 0071 C        	MOV                 VALUE,A
  1291 00F45 1150 C        	CALL                WRITE_SPI_REG
  1292 00F46 0000 C        	NOP
  1293 00F47 182E C        	MOV                 A,@0X2E
  1294 00F48 0070 C        	MOV                 ADDR,A
  1295 00F49 1823 C        	MOV                 A,@0X23						;R2E[5]=1
  1296 00F4A 0071 C        	MOV                 VALUE,A
  1297 00F4B 1150 C        	CALL                WRITE_SPI_REG
  1298 00F4C 0000 C        	NOP
  1299 00F4D 180E C        	MOV                 A,@0X0E
  1300 00F4E 0070 C        	MOV                 ADDR,A
  1301 00F4F 1891 C        	MOV                 A,@0X91						;RE[7]=1
  1302 00F50 0071 C        	MOV                 VALUE,A
  1303 00F51 1150 C        	CALL                WRITE_SPI_REG
  1304 00F52 0000 C        	NOP
  1305 00F53 1238 C        	CALL                Enter_RX_Buffer_ACK
  1306 00F54 0000 C        	NOP
  1307 00F55 1808 C        	MOV                 A,@8
  1308 00F56 1EA0 C        	LCALL                DELAY_8MHz_X100US
  1308 00F57 0333 C        	LCALL                DELAY_8MHz_X100US
  1309 00F58 0000 C        	NOP
  1310 00F59 184B C        	MOV                 A,@0X4B
  1311 00F5A 0070 C        	MOV                 ADDR,A
  1312 00F5B 1160 C        	CALL                READ_SPI_REG
  1313 00F5C 0000 C        	NOP
  1314 00F5D 0C31 C        	JBC                 VALUE,0					;R4B[0]:LD=1,Analog Reg Initial is OK
  1315 00F5E 1761 C        	JMP                 Digit_Reg_Test
  1316 00F5F 0B5D C        	BS                  RFTestfailFlag/8,RFTestfailFlag%8
  1317 00F60 1776 C        	JMP                 RF_TEST_RET
  1318 00F61      C          Digit_Reg_Test:
  1319 00F61 00F3 C        	CLR                 TABLE_INDEX
  1320 00F62      C          Check_Digit_Reg:
  1321 00F62 0433 C        	MOV                 A,TABLE_INDEX
  1322 00F63 108C C        	CALL                RF_TABLE
  1323 00F64 0000 C        	NOP
  1324 00F65 0070 C        	MOV                 ADDR,A
  1325 00F66 1BFF C        	XOR                 A, @0XFF
  1326 00F67 0C83 C        	JBC                 STATUS,Z
  1327 00F68 1776 C        	JMP                 RF_TEST_RET
  1328 00F69 1160 C        	CALL                READ_SPI_REG
  1329 00F6A 0000 C        	NOP
  1330 00F6B 0573 C        	INC                 TABLE_INDEX
  1331 00F6C 0433 C        	MOV                 A,TABLE_INDEX
  1332 00F6D 108C C        	CALL                RF_TABLE
  1333 00F6E 0000 C        	NOP
  1334 00F6F 0331 C        	XOR                 A,VALUE
  1335 00F70 0C83 C        	JBC                 STATUS,Z
  1336 00F71 1774 C        	JMP                 RF_TABLE_INC
  1337 00F72 0B5D C        	BS                  RFTestfailFlag/8,RFTestfailFlag%8
  1338 00F73 1776 C        	JMP                 RF_TEST_RET
  1339 00F74      C          RF_TABLE_INC:
  1340 00F74 0573 C        	INC                 TABLE_INDEX
  1341 00F75 1762 C        	JMP                 Check_Digit_Reg
  1342 00F76      C          RF_TEST_RET:
  1343 00F76 0012 C        	RET
  1344            C        
    18                     include "P520SkipFreqFunc.ASM"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home
    10            C        **********************************************************************/
    11            C        P520SkipFreqFunc.asm    EQU    P520SkipFreqFunc.asm
    12            C        
    13            C        include "P520SkipFreqFunc.h"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        ;------------------------------------------------------------
    12            C        P520SkipFreqFunc.h      EQU     P520SkipFreqFunc.h
    13            C        
    14            C        ;------------------------------------------------------------
    15       0001 C        COMMU_DEBUG             EQU     1     ; enable Communication debug
    16       0001 C        COMMU_T_DEBUG           EQU     1
    17            C        
    18       0000 C        SLEEP_DEBUG             EQU     0     ; sleep function debug
    19       0000 C        SLEEP_T_DEBUG           EQU     0     ; slepp time test debug
    20            C        
    21       0000 C        EEPROM_DEBUG            EQU     0     ; enable eeprom debug
    22       0000 C        EEPROM_T_DEBUG          EQU     0     ; Dispaley write eeprom debug
    23       0000 C        REEPROM_T_DEBUG         EQU     0     ; Dispaley read eeprom debug
    24            C        
    25       0003 C        LossframeSum            EQU     3
    26       0000 C        RetryCNT                EQU     0     ; transmit 0 Times
    27       0002 C        DelayTime               EQU     2     ; Delay Time
    28            C        
    14            C        
    15            C        ifndef EM78CtrlIns.H
    16            C        include "..\..\..\..\include\EM78xx\inc\EM78CtrlIns.H"
    17            C        endif
    18            C        
    19            C        ifndef keyscan.asm
    20            C        include "keyscan.asm"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        ;=============================================================================
    12            C        
    13            C        ;---------------------------------------------------
    14            C        keyscan.asm             EQU       keyscan.asm
    15            C        include "keyscan.H"
     1            C        /*********************************************************************
     2            C        * Filename     :  EM78P520P44TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  KEN YEAR
     5            C        * VERSION      :  4.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2010.06.25
     8            C        * tool Ver.    :  eUIDE 1.02.11
     9            C        * Description  :  modify for 2.4G remote control in Intelligen Home 
    10            C        **********************************************************************/
    11            C        
    12            C        ;======================================================================
    13            C        keyscan.h           EQU        keyscan.h
    14            C        
    15            C        
    16            C        ;----------------------------------------------------------------
    17       0001 C        ADC_FUNCTION        EQU        1                  ; 0 -> IO_FUNCTION(default:0)
    18            C                                                          ; 1 -> ADC_FUNCTION
    19       0000 C        IOtoADC_T_DEBUG     EQU        0                                                  
    20       0005 C        Kr                  EQU        5                  ; Kr=5k/10k
    21       000A C        LeakresisTimeCNT    EQU        10                 ; Leakresis time(default:4).T = LeakresisTimeCNT*[interrupt Time]
    22       0003 C        IOCheckRate         EQU        3                  ; timer2 counter. Check IO when Time arrive (default:3)
    23       001B C        reg_acc             EQU        DataShiftCNT
    24            C        
    25            C        
    26            C        
    27            C        
    28            C        
    29            C        ;======================= key scan port define =========================
    30       0007 C        X_KeyLine           EQU        PORT7
    31       0074 C        X_LINE1             ==         X_KeyLine*16+4		;R74
    32       0075 C        X_LINE2             ==         X_KeyLine*16+5		;R73
    33       0076 C        X_LINE3             ==         X_KeyLine*16+6		;R72
    34       0077 C        X_LINE4             ==         X_KeyLine*16+7		;R71
    35            C        
    36       0009 C        X_Keyrow            EQU        PORT9
    37       0097 C        X_ROW1              ==         X_Keyrow*16+7		;R97
    38       0096 C        X_ROW2              ==         X_Keyrow*16+6		;R96
    39       0095 C        X_ROW3              ==         X_Keyrow*16+5		;R95
    40       0094 C        X_ROW4              ==         X_Keyrow*16+4		;R94
    41            C        
    42            C        ;
    43       0007 C        Reference           ==         7          ;port87
    44       0006 C        Leakresis           ==         6          ;port86
    45       0000 C        LeftYAxis           ==         0          ;port90  LY
    46       0001 C        LeftXAxis           ==         1          ;port91  LX
    47       0002 C        RightYAxis          ==         2          ;port92  RY
    48       0003 C        RightXAxis          ==         3          ;port93  RX
    49            C        
    50            C        ;------------------------ Define form SCH ----------------------------
    51       0037 C        _DireInput          EQU        0B00110111 ;PB5/PB4/PB2/P81/PB0 as input
    52            C        
    53       0005 C        _UP                 ==         5    ;PortB5
    54       0004 C        _RIGHT              ==         4    ;PortB4
    55       0002 C        _DOWN               ==         2    ;PortB2
    56       0001 C        _LEFT               ==         1    ;PortB1
    57            C        
    58            C        
    59            C        ;--------------------------------------------------
    60       0007 C        _A                  ==         7    ;Port97
    61       0006 C        _B                  ==         6    ;Port96
    62       0005 C        _C                  ==         5    ;Port95
    63       0004 C        _D                  ==         4    ;Port94
    64            C        
    65       0007 C        _L1                 ==         7    ;Port97
    66       0006 C        _R1                 ==         6    ;Port96
    67       0005 C        _L2                 ==         5    ;Port95
    68       0004 C        _R2                 ==         4    ;Port94
    69            C        
    70       0007 C        _SELECT             ==         7    ;Port97
    71       0006 C        _START              ==         6    ;Port96
    72       0007 C        _LSW                ==         7    ;Port97
    73       0004 C        _RSW                ==         4    ;Port94
    74            C        
    75       0005 C        _MODE               ==         5    ;Port95
    76       0004 C        _MACRO              ==         4    ;Port94
    77       0006 C        _TEST1              ==         6    ;Port96
    78       0005 C        _TEST2              ==         5    ;Port95
    79            C        
    80            C        ;----------------- Define by data -------------------
    81       0000 C        A_1                 ==         0    ;DataE
    82       0001 C        B_2                 ==         1
    83       0002 C        C_3                 ==         2
    84       0003 C        D_4                 ==         3
    85       0004 C        L1_5                ==         4
    86       0005 C        R1_6                ==         5
    87       0006 C        L2_7                ==         6
    88       0007 C        R2_8                ==         7
    89            C        
    90       0000 C        SELECT_9            ==         0    ;DataF
    91       0001 C        START_10            ==         1
    92       0002 C        LSW_11              ==         2
    93       0003 C        RSW_12              ==         3
    94       0004 C        MODE_13             ==         4
    95       0005 C        MACRO_14            ==         5
    96       0006 C        TEST1_15            ==         6
    97       0007 C        TEST2_16            ==         7
    98            C        
    99            C        
   100            C        ;=============== Connect key scan ======================
   101       00B4 C        KeyPressTime                EQU    180
   102       003C C        KeyScanTime                 EQU    60
   103       001E C        CrossingTime                EQU    30
   104       0002 C        KeyScanTimeCNT_default      EQU    2     
   105            C        
   106            C        
   107            C        
   108            C        
   109            C        
    16            C        
    17            C        ifndef EM78CtrlIns.H
    18            C        include "..\..\..\..\include\EM78xx\EM78CtrlIns.H"
    19            C        endif
    20            C        
    21            C        ifndef EM78Math.H
    22            C        include "..\..\..\..\include\EM78xx\EM78Math.H"
    23            C        endif
    24            C        
    25            C        
    26            C        ;----------------------------------------------------
    27            C        
    28            C        	ORG                 0x10B0    ;PAGE 4
    29            C          if MassageDisplay == 1
    30            C        	MESSAGE "define 'keyscan.asm' ROM address"
    31            C          endif
    32 010B0      C        Key_Scan:
    33 010B0 0000 C        	NOP
    34 010B1 0000 C        	NOP
    35 010B2 0C1E C        	JBC                 KeyScanInitFlag/8,KeyScanInitFlag%8
    36 010B3 14C5 C        	JMP                 Key_Scan_startup
    37 010B4 0A1E C        	BS                  KeyScanInitFlag/8,KeyScanInitFlag%8
    38            C        ;========================== Iinitial config ================================
    39            C          if ADC_FUNCTION == 1
    40 010B5 1E04 C        	BANK                4
    41 010B6 1800 C        	MOV                 A,@00000000B
    42 010B7 0047 C        	MOV                 IOC7,A        ; Set Output
    43 010B8 18FF C        	MOV                 A,@11111111B
    44 010B9 0049 C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Input(Default IO)
    45 010BA 1837 C        	MOV                 A,@_DireInput ; 00110110
    46 010BB 004B C        	MOV                 PBIOCR,A      ; PB5 PB4 PB2 PB1 As Input
    47 010BC 1E05 C        	BANK                5
    48 010BD 18F0 C        	MOV                 A,@11110000B
    49 010BE 0049 C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    50 010BF 1837 C        	MOV                 A,@_DireInput
    51 010C0 004B C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    52 010C1 0000 C        	NOP
    53            C        
    54 010C2 12B3 C        	CALL                SUB_RINIT
    55 010C3 12A1 C        	CALL                SUB_ADJ
    56            C        
    57            C          else
    58            C        	BANK                5
    59            C        	MOV                 A,@11110000B
    60            C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    61            C        	MOV                 A,@_DireInput
    62            C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    63            C        	BANK                4
    64            C        	MOV                 A,@00000000B
    65            C        	MOV                 IOC7,A        ; Set Output
    66            C        	MOV                 A,@11110000B
    67            C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Output(Default IO)
    68            C        	MOV                 A,@_DireInput   
    69            C        	MOV                 PBIOCR,A      ; PB5 PB4 PB2 PB1 As Input
    70            C        	CALL               Pre_Discharge
    71            C        	CALL               SampingRefTiming
    72            C        	NOP
    73            C        
    74            C          endif
    75 010C4 0000 C        	NOP
    76            C        
    77 010C5      C        Key_Scan_startup:
    78            C         ;===========================================================================
    79            C         ;Setting LED Status
    80            C         ;===========================================================================
    81 010C5 1E02 C        	BANK                2
    82 010C6 0F25 C        	JBS                 DataF,MODE_13    ; 1:analog  0:digital(default 0),LED light
    83 010C7 14C9 C        	JMP                 SET_VR_STATUS_0
    84 010C8 14CD C        	JMP                 SET_VR_STATUS_1
    85 010C9      C          SET_VR_STATUS_0:
    86 010C9 0000 C        	NOP
    87 010CA 1E00 C        	BANK                0
    88 010CB 0848 C        	BC                  LED1_STATUS/8,LED1_STATUS%8		;PORT81
    89 010CC 14D1 C        	JMP                 SET_VR_STATUS_END
    90 010CD      C          SET_VR_STATUS_1:
    91 010CD 0000 C        	NOP
    92 010CE 1E00 C        	BANK                0
    93 010CF 0A48 C        	BS                  LED1_STATUS/8,LED1_STATUS%8		;PORT81
    94 010D0 14D1 C        	JMP                 SET_VR_STATUS_END
    95 010D1      C          SET_VR_STATUS_END:
    96 010D1 1E02 C        	BANK                2
    97 010D2 0000 C         	NOP
    98            C        
    99            C        ;================================================================================
   100            C        ;Keyscan Main
   101            C        ;================================================================================
   102 010D3 112B C        	CALL                KeyPort_Check
   103 010D4 0000 C        	NOP
   104            C        ;--------------------- Judge mode status ------------------------
   105 010D5 0D39 C        	JBC                 ModeSelFlag/8,ModeSelFlag%8
   106 010D6 14DD C        	JMP                 MODE_NOCHANGE
   107 010D7 0F3A C        	JBS                 ModeSelBakupFlag/8,ModeSelBakupFlag%8
   108 010D8 14DD C        	JMP                 MODE_NOCHANGE
   109 010D9 0000 C        	NOP
   110            C      M 	COM                 DataF,MODE_13
       010DA 1810     1     MOV A,@( 16 )
       010DB 0365     1     XOR  DATAF ,A
   111 010DC 0000 C        	NOP
   112 010DD      C          MODE_NOCHANGE:
   113            C      M 	MOVB                KeyTempBakupFlag,MODE_13,KeyTempFlag,MODE_13
       010DD 0F39     1     JBS  KEYTEMPFLAG , MODE_13 
       010DE 093A     1     BC  KEYTEMPBAKUPFLAG , MODE_13 
       010DF 0D39     1     JBC  KEYTEMPFLAG , MODE_13 
       010E0 0B3A     1     BS  KEYTEMPBAKUPFLAG , MODE_13 
   114 010E1 0939 C        	BC                  ModeSelFlag/8,ModeSelFlag%8
   115            C        
   116            C        ;---------------- Deal with DataA/DataB/DataC/DataD/DataG-----------------
   117            C          if ADC_FUNCTION == 1
   118 010E2 0000 C        	NOP
   119 010E3 11F6 C        	CALL                ADC_Rocker_KeyScan
   120 010E4 0000 C        	NOP
   121            C          else
   122            C        	NOP
   123            C        	CALL                IO_Rocker_KeyScan
   124            C        	NOP
   125            C          endif
   126            C        
   127 010E5 0000 C        	NOP
   128 010E6 1230 C        	CALL                Rocker_KeyScan
   129 010E7 0000 C        	NOP
   130 010E8 1167 C        	CALL                Direction_KeyCheck
   131            C        
   132            C        ;-----------------------deal with DataE------------------------------------------
   133            C        ; bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0
   134            C        ; A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   135            C        ;--------------------------------------------------------------------------------
   136 010E9 00D0 C        	CLR                 TEMP
   137            C      M 	MOVB                TEMP,A_1,LINE2_KEY_INPUT_CACHE,_A
       010EA 0FFC     1     JBS  LINE2_KEY_INPUT_CACHE , _A 
       010EB 0810     1     BC  TEMP , A_1 
       010EC 0DFC     1     JBC  LINE2_KEY_INPUT_CACHE , _A 
       010ED 0A10     1     BS  TEMP , A_1 
   138            C      M 	MOVB                TEMP,B_2,LINE3_KEY_INPUT_CACHE,_B
       010EE 0FBD     1     JBS  LINE3_KEY_INPUT_CACHE , _B 
       010EF 0850     1     BC  TEMP , B_2 
       010F0 0DBD     1     JBC  LINE3_KEY_INPUT_CACHE , _B 
       010F1 0A50     1     BS  TEMP , B_2 
   139            C      M 	MOVB                TEMP,C_3,LINE4_KEY_INPUT_CACHE,_C
       010F2 0F7E     1     JBS  LINE4_KEY_INPUT_CACHE , _C 
       010F3 0890     1     BC  TEMP , C_3 
       010F4 0D7E     1     JBC  LINE4_KEY_INPUT_CACHE , _C 
       010F5 0A90     1     BS  TEMP , C_3 
   140            C      M 	MOVB                TEMP,D_4,LINE5_KEY_INPUT_CACHE,_D
       010F6 0F3F     1     JBS  LINE5_KEY_INPUT_CACHE , _D 
       010F7 08D0     1     BC  TEMP , D_4 
       010F8 0D3F     1     JBC  LINE5_KEY_INPUT_CACHE , _D 
       010F9 0AD0     1     BS  TEMP , D_4 
   141            C      M 	MOVB                TEMP,L1_5,LINE3_KEY_INPUT_CACHE,_L1
       010FA 0FFD     1     JBS  LINE3_KEY_INPUT_CACHE , _L1 
       010FB 0910     1     BC  TEMP , L1_5 
       010FC 0DFD     1     JBC  LINE3_KEY_INPUT_CACHE , _L1 
       010FD 0B10     1     BS  TEMP , L1_5 
   142            C      M 	MOVB                TEMP,R1_6,LINE4_KEY_INPUT_CACHE,_R1
       010FE 0FBE     1     JBS  LINE4_KEY_INPUT_CACHE , _R1 
       010FF 0950     1     BC  TEMP , R1_6 
       01100 0DBE     1     JBC  LINE4_KEY_INPUT_CACHE , _R1 
       01101 0B50     1     BS  TEMP , R1_6 
   143            C      M 	MOVB                TEMP,L2_7,LINE2_KEY_INPUT_CACHE,_L2
       01102 0F7C     1     JBS  LINE2_KEY_INPUT_CACHE , _L2 
       01103 0990     1     BC  TEMP , L2_7 
       01104 0D7C     1     JBC  LINE2_KEY_INPUT_CACHE , _L2 
       01105 0B90     1     BS  TEMP , L2_7 
   144            C      M 	MOVB                TEMP,R2_8,LINE3_KEY_INPUT_CACHE,_R2
       01106 0F3D     1     JBS  LINE3_KEY_INPUT_CACHE , _R2 
       01107 09D0     1     BC  TEMP , R2_8 
       01108 0D3D     1     JBC  LINE3_KEY_INPUT_CACHE , _R2 
       01109 0BD0     1     BS  TEMP , R2_8 
   145 0110A 0410 C        	MOV                 A,TEMP
   146 0110B 0264 C        	OR                  DataE,A
   147            C        
   148            C        ;-----------------------deal with DataF------------------------------------------
   149            C        ; bit0      bit1      bit2     bit3     bit4     bit5      bit6      bit7
   150            C        ; Select_9  Start_10  LSW_11   RSW_12   MODE_13  MACRO_14  TEST1_15  TEST2_16
   151            C        ;--------------------------------------------------------------------------------
   152            C        	;CLR                 DataF
   153            C      M 	MOVB                DataF,SELECT_9,LINE4_KEY_INPUT_CACHE,_Select
       0110C 0FFE     1     JBS  LINE4_KEY_INPUT_CACHE , _SELECT 
       0110D 0825     1     BC  DATAF , SELECT_9 
       0110E 0DFE     1     JBC  LINE4_KEY_INPUT_CACHE , _SELECT 
       0110F 0A25     1     BS  DATAF , SELECT_9 
   154            C      M 	MOVB                DataF,Start_10,LINE5_KEY_INPUT_CACHE,_Start
       01110 0FBF     1     JBS  LINE5_KEY_INPUT_CACHE , _START 
       01111 0865     1     BC  DATAF , START_10 
       01112 0DBF     1     JBC  LINE5_KEY_INPUT_CACHE , _START 
       01113 0A65     1     BS  DATAF , START_10 
   155            C      M 	MOVB                DataF,LSW_11,LINE5_KEY_INPUT_CACHE,_LSW
       01114 0FFF     1     JBS  LINE5_KEY_INPUT_CACHE , _LSW 
       01115 08A5     1     BC  DATAF , LSW_11 
       01116 0DFF     1     JBC  LINE5_KEY_INPUT_CACHE , _LSW 
       01117 0AA5     1     BS  DATAF , LSW_11 
   156            C      M 	MOVB                DataF,RSW_12,LINE2_KEY_INPUT_CACHE,_RSW
       01118 0F3C     1     JBS  LINE2_KEY_INPUT_CACHE , _RSW 
       01119 08E5     1     BC  DATAF , RSW_12 
       0111A 0D3C     1     JBC  LINE2_KEY_INPUT_CACHE , _RSW 
       0111B 0AE5     1     BS  DATAF , RSW_12 
   157            C        	;MOVB                DataF,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE
   158            C      M 	MOVB                DataF,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO
       0111C 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       0111D 0965     1     BC  DATAF , MACRO_14 
       0111E 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       0111F 0B65     1     BS  DATAF , MACRO_14 
   159            C      M 	MOVB                DataF,TEST1_15,LINE2_KEY_INPUT_CACHE,_TEST1
       01120 0FBC     1     JBS  LINE2_KEY_INPUT_CACHE , _TEST1 
       01121 09A5     1     BC  DATAF , TEST1_15 
       01122 0DBC     1     JBC  LINE2_KEY_INPUT_CACHE , _TEST1 
       01123 0BA5     1     BS  DATAF , TEST1_15 
   160            C      M 	MOVB                DataF,TEST2_16,LINE5_KEY_INPUT_CACHE,_TEST2
       01124 0F7F     1     JBS  LINE5_KEY_INPUT_CACHE , _TEST2 
       01125 09E5     1     BC  DATAF , TEST2_16 
       01126 0D7F     1     JBC  LINE5_KEY_INPUT_CACHE , _TEST2 
       01127 0BE5     1     BS  DATAF , TEST2_16 
   161            C        
   162 01128 0000 C        	NOP
   163 01129 0012 C        	RET
   164 0112A 0000 C        	NOP
   165            C        
   166            C        ;===========================================================================
   167            C        ;Scan data form keyboard port
   168            C        ;===========================================================================
   169 0112B      C        KeyPort_Check:
   170            C        ;LINE1:	read direct data from PortB to LINE1_KEY_INPUT
   171 0112B 1E00 C        	BANK                0
   172 0112C 040B C        	MOV                 A,PORTB		;PortB = 00110110
   173 0112D 1E02 C        	BANK                2
   174 0112E 007B C        	MOV                 LINE1_KEY_INPUT_CACHE,A
   175 0112F 04FB C        	COM                 LINE1_KEY_INPUT_CACHE
   176 01130 1837 C        	MOV                 A,@_DireInput
   177 01131 02FB C        	AND                 LINE1_KEY_INPUT_CACHE,A
   178            C        
   179            C        ;LINE2:	;SET P77=1 P76=1 P75=1 P74=0
   180 01132 1E00 C        	BANK                0
   181 01133 18E8 C        	MOV                 A,@11101000B
   182 01134 0047 C        	MOV                 PORT7,A
   183 01135 11ED C        	CALL                KEY_DELAY
   184 01136 0409 C        	MOV                 A,PORT9
   185 01137 1E02 C        	BANK                2
   186 01138 007C C        	MOV                 LINE2_KEY_INPUT_CACHE,A
   187 01139 04FC C        	COM                 LINE2_KEY_INPUT_CACHE
   188 0113A 18F0 C        	MOV                 A,@0XF0
   189 0113B 02FC C        	AND                 LINE2_KEY_INPUT_CACHE,A
   190            C        
   191            C        ;LINE3:	;SET P77=1 P76=1 P75=0 P74=1
   192 0113C 1E00 C        	BANK                0
   193 0113D 18D8 C        	MOV                 A,@11011000B
   194 0113E 0047 C        	MOV                 PORT7,A
   195 0113F 11ED C        	CALL                KEY_DELAY
   196 01140 0409 C        	MOV                 A,PORT9
   197 01141 1E02 C        	BANK                2
   198 01142 007D C        	MOV                 LINE3_KEY_INPUT_CACHE,A
   199 01143 04FD C        	COM                 LINE3_KEY_INPUT_CACHE
   200 01144 18F0 C        	MOV                 A,@0XF0
   201 01145 02FD C        	AND                 LINE3_KEY_INPUT_CACHE,A
   202            C        
   203            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   204 01146 1E00 C        	BANK                0
   205 01147 18B8 C        	MOV                 A,@10111000B
   206 01148 0047 C        	MOV                 PORT7,A
   207 01149 11ED C        	CALL                KEY_DELAY
   208 0114A 0409 C        	MOV                 A,PORT9
   209 0114B 1E02 C        	BANK                2
   210 0114C 007E C        	MOV                 LINE4_KEY_INPUT_CACHE,A
   211 0114D 04FE C        	COM                 LINE4_KEY_INPUT_CACHE
   212 0114E 18F0 C        	MOV                 A,@0XF0
   213 0114F 02FE C        	AND                 LINE4_KEY_INPUT_CACHE,A
   214            C        
   215            C        ;LINE5:	;SET P77=0 P76=1 P75=1 P74=1
   216 01150 1E00 C        	BANK                0
   217 01151 1878 C        	MOV                 A,@01111000B
   218 01152 0047 C        	MOV                 PORT7,A
   219 01153 11ED C        	CALL                KEY_DELAY
   220 01154 0409 C        	MOV                 A,PORT9
   221 01155 1E02 C        	BANK                2
   222 01156 007F C        	MOV                 LINE5_KEY_INPUT_CACHE,A
   223 01157 04FF C        	COM                 LINE5_KEY_INPUT_CACHE
   224 01158 18F0 C        	MOV                 A,@0XF0
   225 01159 02FF C        	AND                 LINE5_KEY_INPUT_CACHE,A
   226 0115A 0000 C        	NOP
   227            C        
   228            C        ;----------------------------------------------------------------
   229            C      M 	MOVB                KeyTempFlag,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE  ;save MODE FLAG
       0115B 0F7D     1     JBS  LINE3_KEY_INPUT_CACHE , _MODE 
       0115C 0939     1     BC  KEYTEMPFLAG , MODE_13 
       0115D 0D7D     1     JBC  LINE3_KEY_INPUT_CACHE , _MODE 
       0115E 0B39     1     BS  KEYTEMPFLAG , MODE_13 
   230            C      M 	MOVB                KeyTempFlag,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO ;save MACRO FLAG
       0115F 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       01160 0979     1     BC  KEYTEMPFLAG , MACRO_14 
       01161 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       01162 0B79     1     BS  KEYTEMPFLAG , MACRO_14 
   231 01163 0000 C        	NOP
   232 01164 0000 C        	NOP
   233 01165 0012 C        	RET
   234 01166 0000 C        	NOP
   235            C        
   236            C        ;==============================================================================
   237            C        ;=======================Direction key board scan===============================
   238            C        ;==============================================================================
   239            C        ;------------------------deal with DataA/DataB---------------------------------
   240            C        ;DataA	left-right: left=0x00, right=0xff, no-left-right=0x7f
   241            C        ;DataB	up-down:    down=0x00, up=0xff,    no-left-right=0x7f
   242            C        ;DataG  000:00 001:45 010:90 011:135 100:180 101:225 110:270 111:315
   243            C        ;------------------------------------------------------------------------------
   244 01167      C        Direction_KeyCheck:
   245 01167 0000 C        	NOP
   246 01168 0F25 C        	JBS                 DataF,MODE_13
   247 01169 156B C        	JMP                 DealWith_Direction_Digital
   248 0116A 15AA C        	JMP                 DealWith_HatSwitch_Analog
   249            C        
   250 0116B      C        DealWith_Direction_Digital:
   251 0116B      C        LEFT_RIGHT_KEY:
   252 0116B 0D3B C        	JBC                 LINE1_KEY_INPUT_CACHE,_RIGHT   ;judge right
   253 0116C 1570 C        	JMP                 JudgeRight
   254 0116D 0C7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_LEFT    ;judeg left
   255 0116E 157B C        	JMP                 JudgeLeft
   256 0116F 1585 C        	JMP                 Left_Right_Finsh
   257 01170      C          JudgeRight:
   258 01170 1800 C        	MOV                 A,@0X00
   259 01171 0320 C        	XOR                 A,DataA
   260 01172 0E83 C        	JBS                 STATUS,Z
   261 01173 1575 C        	JMP                 JudgeRight_1
   262 01174 1577 C        	JMP                 JudgeRight_2
   263 01175      C          JudgeRight_1:
   264 01175 18FF C        	MOV                 A,@0XFF
   265 01176 1579 C        	JMP                 JudgeRight_End
   266 01177      C          JudgeRight_2:
   267 01177 187F C        	MOV                 A,@0X7F
   268 01178 1579 C        	JMP                 JudgeRight_End
   269 01179      C          JudgeRight_End:
   270 01179 0060 C        	MOV                 DataA,A
   271 0117A 1585 C        	JMP                 Left_Right_Finsh
   272            C        
   273 0117B      C          JudgeLeft:
   274 0117B 18FF C        	MOV                 A,@0XFF
   275 0117C 0320 C        	XOR                 A,DataA
   276 0117D 0E83 C        	JBS                 STATUS,Z
   277 0117E 1580 C        	JMP                 JudgeLeft_1  ;Z=0,sameness
   278 0117F 1582 C        	JMP                 JudgeLeft_2  ;Z=1,reverse
   279 01180      C          JudgeLeft_1:
   280 01180 1800 C        	MOV                 A,@0X00
   281 01181 1584 C        	JMP                 JudgeLeft_End
   282 01182      C          JudgeLeft_2:
   283 01182 187F C        	MOV                 A,@0X7F
   284 01183 1584 C        	JMP                 JudgeLeft_End
   285 01184      C          JudgeLeft_End:
   286 01184 0060 C        	MOV                 DataA,A
   287 01185      C          Left_Right_Finsh:
   288 01185 0000 C        	NOP
   289            C        ;--------------------------------------------------------------
   290 01186      C        UP_DOWN_KEY:
   291 01186 0D7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_UP     ;judge up(0X00)
   292 01187 1596 C        	JMP                 JudgeDown
   293 01188 0CBB C        	JBC                 LINE1_KEY_INPUT_CACHE,_DOWN   ;judeg down(0XFF)
   294 01189 158B C        	JMP                 JudgeUp
   295 0118A 15A1 C        	JMP                 UP_DOWN_Finsh
   296 0118B      C          JudgeUp:
   297 0118B 1800 C        	MOV                 A,@0X00
   298 0118C 0321 C        	XOR                 A,DataB
   299 0118D 0E83 C        	JBS                 STATUS,Z
   300 0118E 1590 C        	JMP                 JudgeUp_1
   301 0118F 1592 C        	JMP                 JudgeUp_2
   302 01190      C          JudgeUp_1:
   303 01190 18FF C        	MOV                 A,@0XFF
   304 01191 1594 C        	JMP                 JudgeUp_End
   305 01192      C          JudgeUp_2:
   306 01192 187F C        	MOV                 A,@0X7F
   307 01193 1594 C        	JMP                 JudgeUp_End
   308 01194      C          JudgeUp_End:
   309 01194 0061 C        	MOV                 DataB,A
   310 01195 15A1 C        	JMP                 UP_DOWN_Finsh
   311            C        
   312 01196      C          JudgeDown:
   313 01196 18FF C        	MOV                 A,@0XFF
   314 01197 0321 C        	XOR                 A,DataB
   315 01198 0E83 C        	JBS                 STATUS,Z
   316 01199 159B C        	JMP                 JudgeDown_1
   317 0119A 159D C        	JMP                 JudgeDown_2
   318 0119B      C          JudgeDown_1:
   319 0119B 1800 C        	MOV                 A,@0X00
   320 0119C 159F C        	JMP                 JudgeDown_End
   321 0119D      C          JudgeDown_2:
   322 0119D 187F C        	MOV                 A,@0X7F
   323 0119E 159F C        	JMP                 JudgeDown_End
   324 0119F      C          JudgeDown_End:
   325 0119F 0061 C        	MOV                 DataB,A
   326 011A0 15A1 C        	JMP                 UP_DOWN_Finsh
   327 011A1      C          UP_DOWN_Finsh:
   328 011A1 0000 C        	NOP
   329 011A2 187F C        	MOV                 A,@0X7F
   330 011A3 0062 C        	MOV                 DataC,A
   331 011A4 0063 C        	MOV                 DataD,A
   332 011A5 180F C          	MOV                 A,@0X0F
   333 011A6 0066 C          	MOV                 DataG,A
   334 011A7 0000 C        	NOP
   335 011A8 0012 C        	RET
   336 011A9 0000 C        	NOP
   337            C        
   338            C        ;----------------------------------------------------
   339 011AA      C        DealWith_HatSwitch_Analog:
   340 011AA 00E4 C        	CLR                 DataE
   341 011AB 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   342 011AC 1B00 C        	XOR                 A,@0B00000000
   343 011AD 0E83 C        	JBS                 STATUS,Z
   344 011AE 15B2 C        	JMP                 DATAG_0
   345            C      M 	MOV                 DataG,@0X0F          ;none
       011AF 180F     1     MOV A,@( 15 )
       011B0 0066     1     MOV  DATAG ,A
   346 011B1 15EA C        	JMP                 HAT_SWITCH_END
   347 011B2      C          DataG_0:
   348 011B2 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   349 011B3 1B20 C        	XOR                 A,@0B00100000
   350 011B4 0E83 C        	JBS                 STATUS,Z
   351 011B5 15B9 C        	JMP                 DataG_45
   352            C      M 	MOV                 DataG,@0X00          ;0
       011B6 1800     1     MOV A,@( 0 )
       011B7 0066     1     MOV  DATAG ,A
   353 011B8 15EA C        	JMP                 HAT_SWITCH_END
   354 011B9      C          DataG_45:
   355 011B9 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   356 011BA 1B30 C        	XOR                 A,@0B00110000
   357 011BB 0E83 C        	JBS                 STATUS,Z
   358 011BC 15C0 C        	JMP                 DataG_90
   359            C      M 	MOV                 DataG,@0X01          ;45
       011BD 1801     1     MOV A,@( 1 )
       011BE 0066     1     MOV  DATAG ,A
   360 011BF 15EA C        	JMP                 HAT_SWITCH_END
   361 011C0      C          DataG_90:
   362 011C0 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   363 011C1 1B10 C        	XOR                 A,@0B00010000
   364 011C2 0E83 C        	JBS                 STATUS,Z
   365 011C3 15C7 C        	JMP                 DataG_135
   366            C      M 	MOV                 DataG,@0X02          ;90
       011C4 1802     1     MOV A,@( 2 )
       011C5 0066     1     MOV  DATAG ,A
   367 011C6 15EA C        	JMP                 HAT_SWITCH_END
   368 011C7      C          DataG_135:
   369 011C7 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   370 011C8 1B14 C        	XOR                 A,@0B00010100
   371 011C9 0E83 C        	JBS                 STATUS,Z
   372 011CA 15CE C        	JMP                 DataG_180
   373            C      M 	MOV                 DataG,@0X03          ;135
       011CB 1803     1     MOV A,@( 3 )
       011CC 0066     1     MOV  DATAG ,A
   374 011CD 15EA C        	JMP                 HAT_SWITCH_END
   375 011CE      C          DataG_180:
   376 011CE 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   377 011CF 1B04 C        	XOR                 A,@0B00000100
   378 011D0 0E83 C        	JBS                 STATUS,Z
   379 011D1 15D5 C        	JMP                 DataG_225
   380            C      M 	MOV                 DataG,@0X04          ;180
       011D2 1804     1     MOV A,@( 4 )
       011D3 0066     1     MOV  DATAG ,A
   381 011D4 15EA C        	JMP                 HAT_SWITCH_END
   382 011D5      C          DataG_225:
   383 011D5 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   384 011D6 1B06 C        	XOR                 A,@0B00000110
   385 011D7 0E83 C        	JBS                 STATUS,Z
   386 011D8 15DC C        	JMP                 DataG_270
   387            C      M 	MOV                 DataG,@0X05          ;225
       011D9 1805     1     MOV A,@( 5 )
       011DA 0066     1     MOV  DATAG ,A
   388 011DB 15EA C        	JMP                 HAT_SWITCH_END
   389 011DC      C          DataG_270:
   390 011DC 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   391 011DD 1B02 C        	XOR                 A,@0B00000010
   392 011DE 0E83 C        	JBS                 STATUS,Z
   393 011DF 15E3 C        	JMP                 DataG_315
   394            C      M 	MOV                 DataG,@0X06          ;270
       011E0 1806     1     MOV A,@( 6 )
       011E1 0066     1     MOV  DATAG ,A
   395 011E2 15EA C        	JMP                 HAT_SWITCH_END
   396 011E3      C          DataG_315:
   397 011E3 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   398 011E4 1B22 C        	XOR                 A,@0B00100010
   399 011E5 0E83 C        	JBS                 STATUS,Z
   400 011E6 15EA C        	JMP                 HAT_SWITCH_END
   401            C      M 	MOV                 DataG,@0X07          ;315
       011E7 1807     1     MOV A,@( 7 )
       011E8 0066     1     MOV  DATAG ,A
   402 011E9 15EA C        	JMP                 HAT_SWITCH_END
   403            C        
   404 011EA      C          HAT_SWITCH_END:
   405 011EA 0000 C        	NOP
   406 011EB 0012 C        	RET
   407 011EC 0000 C        	NOP
   408            C        
   409            C        ;===================================================================
   410            C        ; Delay function
   411            C        ;===================================================================
   412 011ED      C        KEY_DELAY:
   413 011ED 0000 C        	NOP
   414 011EE 0000 C        	NOP
   415 011EF 0000 C        	NOP
   416 011F0 0000 C        	NOP
   417 011F1 0000 C        	NOP
   418 011F2 0000 C        	NOP
   419 011F3 0000 C        	NOP
   420 011F4 0012 C        	RET
   421 011F5 0000 C        	NOP
   422            C        
   423            C        
   424            C        ;============================================================================
   425            C        ;file name:     ADC 3D Rocker KeyScan
   426            C        ;INPUT PORT:
   427            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   428            C        ;TIME:          1050uS
   429            C        ;Descrition:    Use for check AD rocker data
   430            C        ;============================================================================
   431 011F6      C        ADC_Rocker_KeyScan:
   432            C        
   433 011F6 0000 C        	NOP
   434 011F7 1E03 C        	BANK                 3
   435 011F8 0B89 C        	BS                   ADCR,ADP
   436 011F9 00CC C        	CLR                  ADDH
   437 011FA 0409 C        	MOV                  A,ADCR
   438 011FB 1AF0 C        	AND                  A,@0B11110000
   439 011FC 1980 C        	OR                   A,@0B10000000
   440 011FD 0049 C        	MOV                  ADCR,A              ;Select ADE0/P93.Rx
   441 011FE 12BB C        	CALL                 SUB_ADC
   442 011FF 040C C        	MOV                  A,ADDH
   443 01200 1E02 C        	BANK                 2
   444 01201 0072 C        	MOV                  KEY_RIGHT_X,A
   445            C        
   446 01202 1E03 C        	BANK                 3
   447 01203 00CC C        	CLR                  ADDH
   448 01204 0409 C        	MOV                  A,ADCR
   449 01205 1AF0 C        	AND                  A,@0B11110000
   450 01206 1901 C        	OR                   A,@0B00000001
   451 01207 0049 C        	MOV                  ADCR,A              ;Select ADE1/P92.Ry
   452 01208 1805 C        	MOV                  A,@5
   453 01209 1EA0 C        	LCALL                DELAY_8MHz_X10US
   453 0120A 032B C        	LCALL                DELAY_8MHz_X10US
   454 0120B 12BB C        	CALL                 SUB_ADC
   455 0120C 040C C        	MOV                  A,ADDH
   456 0120D 1E02 C        	BANK                 2
   457 0120E 0073 C        	MOV                  KEY_RIGHT_Y,A
   458 0120F 04F3 C        	COM                  KEY_RIGHT_Y
   459            C        
   460 01210 1E03 C        	BANK                 3
   461 01211 00CC C        	CLR                  ADDH
   462 01212 0409 C        	MOV                  A,ADCR
   463 01213 1AF0 C        	AND                  A,@0B11110000
   464 01214 1902 C        	OR                   A,@0B00000010
   465 01215 0049 C        	MOV                  ADCR,A              ;Select ADE2/P91.Lx
   466 01216 1805 C        	MOV                  A,@5
   467 01217 1EA0 C        	LCALL                DELAY_8MHz_X10US
   467 01218 032B C        	LCALL                DELAY_8MHz_X10US
   468 01219 12BB C        	CALL                 SUB_ADC
   469 0121A 040C C        	MOV                  A,ADDH
   470 0121B 1E02 C        	BANK                 2
   471 0121C 0070 C        	MOV                  KEY_LEFT_X,A
   472            C        
   473 0121D 1E03 C        	BANK                 3
   474 0121E 00CC C        	CLR                  ADDH
   475 0121F 0409 C        	MOV                  A,ADCR
   476 01220 1AF0 C        	AND                  A,@0B11110000
   477 01221 1903 C        	OR                   A,@0B00000011
   478 01222 0049 C        	MOV                  ADCR,A              ;Select ADE3/P90.Ly
   479 01223 1805 C        	MOV                  A,@5
   480 01224 1EA0 C        	LCALL                DELAY_8MHz_X10US
   480 01225 032B C        	LCALL                DELAY_8MHz_X10US
   481 01226 12BB C        	CALL                 SUB_ADC
   482 01227 040C C        	MOV                  A,ADDH
   483 01228 1E02 C        	BANK                 2
   484 01229 0071 C        	MOV                  KEY_LEFT_Y,A
   485 0122A 04F1 C        	COM                  KEY_LEFT_Y
   486 0122B 1E03 C        	BANK                 3
   487 0122C 0989 C        	BC                   ADCR,ADP
   488            C        
   489            C        	;bank                 2
   490            C        	;mov                  a,@0x7f
   491            C        	;mov                  key_right_x,a
   492            C        	;mov                  key_right_y,a
   493            C        	;mov                  key_left_x,a
   494            C        	;mov                  key_left_y,a
   495            C        
   496 0122D 0000 C        	NOP
   497 0122E 0012 C        	RET
   498 0122F 0000 C        	NOP
   499            C        
   500 01230      C        Rocker_KeyScan:
   501            C        ;======================== jugde rocker signal select ==========================
   502 01230 1E02 C        	BANK                2
   503 01231 0F25 C        	JBS                 DataF,MODE_13       ;select digital or analog
   504 01232 1634 C        	JMP                 DealWith_ADC_Digital
   505 01233 164A C        	JMP                 DealWith_ADC_Analog
   506            C        
   507 01234      C          DealWith_ADC_Digital:
   508 01234 00E0 C        	CLR                 DataA
   509 01235 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   510 01236 0051 C        	MOV                 TEMP1,A
   511 01237 1256 C        	CALL                AreaJudge_direction
   512 01238 0060 C        	MOV                 DataA,A
   513            C        
   514 01239 00E1 C        	CLR                 DataB
   515 0123A 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   516 0123B 0051 C        	MOV                 TEMP1,A
   517 0123C 1256 C        	CALL                AreaJudge_direction
   518 0123D 0061 C        	MOV                 DataB,A
   519            C        
   520 0123E 187F C        	MOV                 A,@0X7F
   521 0123F 0062 C        	MOV                 DataC,A
   522 01240 0063 C        	MOV                 DataD,A
   523            C        
   524 01241 00E4 C        	CLR                 DataE
   525 01242 0432 C        	MOV                 A,KEY_RIGHT_X		;A,B,C,D,
   526 01243 0052 C        	MOV                 TEMP2,A
   527 01244 0433 C        	MOV                 A,KEY_RIGHT_Y
   528 01245 0053 C        	MOV                 TEMP3,A
   529 01246 126A C        	CALL                AreaJudge_Button
   530 01247 0410 C        	MOV                 A,TEMP
   531 01248 0064 C        	MOV                 DataE,A
   532 01249 1653 C        	JMP                 RockerCheakFinish
   533            C        
   534 0124A      C          DealWith_ADC_Analog:
   535 0124A 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   536 0124B 0060 C        	MOV                 DataA,A
   537 0124C 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   538 0124D 0061 C        	MOV                 DataB,A
   539 0124E 0432 C        	MOV                 A,KEY_RIGHT_X		;R-left_right
   540 0124F 0062 C        	MOV                 DataC,A
   541 01250 0433 C        	MOV                 A,KEY_RIGHT_Y		;R-up_down
   542 01251 0063 C        	MOV                 DataD,A
   543 01252 1653 C        	JMP                 RockerCheakFinish
   544            C        
   545 01253      C          RockerCheakFinish:
   546 01253 0000 C        	NOP
   547 01254 0012 C        	RET
   548 01255 0000 C        	NOP
   549            C        
   550            C        ;=============================jugde the direction=====================================
   551            C        ;Input:      TEMP1
   552            C        ;output:     A
   553            C        ;=====================================================================================
   554 01256      C        AreaJudge_direction:
   555 01256 1E02 C        	BANK                2
   556 01257 0411 C        	MOV                 A,TEMP1     ;Store
   557 01258 1DBF C        	SUB                 A,@0XBF
   558 01259 0E03 C        	JBS                 R3,0        ;R3,bit0(C)
   559 0125A 165C C        	JMP                 CheakTop_Left
   560 0125B 165E C        	JMP                 CheakMiddle_Left
   561 0125C      C          CheakTop_Left:
   562 0125C 18FF C        	MOV                 A,@0XFF   ;up
   563 0125D 1666 C        	JMP                 CheakAreaFinish_Left
   564 0125E      C          CheakMiddle_Left:
   565 0125E 0411 C        	MOV                 A,TEMP1
   566 0125F 1D40 C        	SUB                 A,@0X40
   567 01260 0C03 C        	JBC                 R3,0
   568 01261 1664 C        	JMP                 CheakBottom_Left
   569 01262 187F C        	MOV                 A,@0X7F
   570 01263 1666 C        	JMP                 CheakAreaFinish_Left
   571 01264      C          CheakBottom_Left:
   572 01264 1800 C        	MOV                 A,@0X00   ;down
   573 01265 1666 C        	JMP                 CheakAreaFinish_Left
   574 01266      C          CheakAreaFinish_Left:
   575 01266 0000 C        	NOP
   576 01267 0000 C        	NOP
   577 01268 0012 C        	RET
   578 01269 0000 C        	NOP
   579            C        
   580            C        ;============================jugde what button press============================
   581            C        ;input:     TEMP2,TEMP3
   582            C        ;output:    TEMP
   583            C        ;===============================================================================
   584 0126A      C        AreaJudge_Button:
   585 0126A 1E02 C        	BANK                2
   586 0126B 0412 C        	MOV                 A,TEMP2    ;KEY_RIGHT_Y
   587 0126C 1DD0 C        	SUB                 A,@0XD0
   588 0126D 0E03 C        	JBS                 R3,C	     ;R3,bit0(C)
   589 0126E 1670 C        	JMP                 CheakTop_Right_y
   590 0126F 1672 C        	JMP                 CheakMiddle_Right_y
   591            C        
   592 01270      C          CheakTop_Right_y:
   593 01270 18FF C        	MOV                 A,@0XFF  ;up
   594 01271 167A C        	JMP                 CheakAreaFinish_Right_y
   595 01272      C          CheakMiddle_Right_y:
   596 01272 0412 C        	MOV                 A,TEMP2
   597 01273 1D25 C        	SUB                 A,@0X25
   598 01274 0E03 C        	JBS                 R3,C
   599 01275 1678 C        	JMP                 CheakBottom_Right_y
   600 01276 1800 C        	MOV                 A,@0X00  ;dwon
   601 01277 167A C        	JMP                 CheakAreaFinish_Right_y
   602 01278      C          CheakBottom_Right_y:
   603 01278 187F C        	MOV                 A,@0X7F
   604 01279 167A C        	JMP                 CheakAreaFinish_Right_y
   605 0127A      C          CheakAreaFinish_Right_y:
   606 0127A 0052 C        	MOV                 TEMP2,A
   607 0127B 0000 C        	NOP
   608            C        ;---------------------------------------------------
   609 0127C 1E02 C        	BANK                2
   610 0127D 0413 C        	MOV                 A,TEMP3    ;KEY_RIGHT_Y
   611 0127E 1DD0 C        	SUB                 A,@0XD0
   612 0127F 0E03 C        	JBS                 R3,C       ;R3,bit0(C)
   613 01280 1682 C        	JMP                 CheakTop_Right_x
   614 01281 1684 C        	JMP                 CheakMiddle_Right_x
   615 01282      C          CheakTop_Right_x:
   616 01282 18FF C        	MOV                 A,@0XFF   ;right
   617 01283 168C C        	JMP                 CheakAreaFinish_Right_x
   618 01284      C          CheakMiddle_Right_x:
   619 01284 0413 C        	MOV                 A,TEMP3
   620 01285 1D25 C        	SUB                 A,@0X25
   621 01286 0E03 C        	JBS                 R3,0
   622 01287 168A C        	JMP                 CheakBottom_Right_x
   623 01288 1800 C        	MOV                 A,@0X00   ;left
   624 01289 168C C        	JMP                 CheakAreaFinish_Right_x
   625 0128A      C          CheakBottom_Right_x:
   626 0128A 187F C        	MOV                 A,@0X7F
   627 0128B 168C C        	JMP                 CheakAreaFinish_Right_x
   628 0128C      C          CheakAreaFinish_Right_x:
   629 0128C 0053 C        	MOV                 TEMP3,A
   630 0128D 0000 C        	NOP
   631            C        
   632            C        ;-----------------------------------------------------
   633 0128E 00D0 C        	CLR                 TEMP
   634 0128F 0412 C        	MOV                 A,TEMP2      ;left
   635 01290 1B00 C        	XOR                 A,@0X00
   636 01291 0C83 C        	JBC                 STATUS,Z
   637 01292 0A10 C        	BS                  TEMP,A_1
   638            C        
   639 01293 0412 C        	MOV                 A,TEMP2      ;right
   640 01294 1BFF C        	XOR                 A,@0XFF
   641 01295 0C83 C        	JBC                 STATUS,Z
   642 01296 0A90 C        	BS                  TEMP,C_3
   643            C        
   644 01297 0413 C        	MOV                 A,TEMP3      ;down
   645 01298 1BFF C        	XOR                 A,@0XFF
   646 01299 0C83 C        	JBC                 STATUS,Z
   647 0129A 0AD0 C        	BS                  TEMP,D_4
   648            C        
   649 0129B 0413 C        	MOV                 A,TEMP3      ;up
   650 0129C 1B00 C        	XOR                 A,@0X00
   651 0129D 0C83 C        	JBC                 STATUS,Z
   652 0129E 0A50 C        	BS                  TEMP,B_2
   653 0129F 0012 C        	RET
   654 012A0 0000 C        	NOP
   655            C        
   656            C        ;===================================================================
   657 012A1      C        SUB_ADJ:
   658 012A1 1E03 C        	BANK                3
   659 012A2 0BCA C        	BS                  ADICH,CALI    ;ENABLE CALIBRATION
   660 012A3      C          ADCJUDGE_LOOP:
   661 012A3 0BC9 C        	BS                  ADCR,ADRUN
   662 012A4 0DC9 C        	JBC                 ADCR,ADRUN
   663 012A5 16A4 C        	JMP                 $-1
   664            C        
   665 012A6 040D C        	MOV                 A,ADDL
   666 012A7 1A0F C        	AND                 A,@0X0F
   667 012A8 0E83 C        	JBS                 R3,Z
   668 012A9 16B0 C        	JMP                 ADCJUDGE_DONE
   669 012AA 040C C        	MOV                 A,ADDH
   670 012AB 0E83 C        	JBS                 R3,Z
   671 012AC 16B0 C        	JMP                 ADCJUDGE_DONE
   672 012AD 1810 C        	MOV                 A,@0X10
   673 012AE 03CD C        	ADD                 ADDL,A
   674 012AF 16A3 C        	JMP                 ADCJUDGE_LOOP
   675 012B0      C          ADCJUDGE_DONE:
   676 012B0 09CA C        	BC                  ADICH,CALI
   677 012B1 0012 C        	RET
   678 012B2 0000 C        	NOP
   679            C        
   680            C        ;===================================================================
   681 012B3      C        SUB_RINIT:
   682 012B3 1E03 C        	BANK                3
   683 012B4 180F C        	MOV                 A,@0X0F
   684 012B5 004B C        	MOV                 ADICL,A      ;SELECT ADE0~ ADE3 AS ANALOG INPUT
   685 012B6 00CA C        	CLR                 ADICH         ;VREFS==VDD
   686 012B7 1860 C        	MOV                 A,@0B01100000
   687 012B8 0049 C        	MOV                 ADCR,A       ;SELECT  AD0,SELECT ADCKR1/ADCKR0=1:0,ADP=1
   688 012B9 0012 C        	RET
   689 012BA 0000 C        	NOP
   690            C        
   691            C        ;===================================================================
   692 012BB      C        SUB_ADC:
   693 012BB 1E03 C        	BANK                3
   694 012BC 0BC9 C        	BS                  ADCR,ADRUN
   695 012BD 0DC9 C        	JBC                 ADCR,ADRUN
   696 012BE 16BD C        	JMP                 $-1
   697 012BF 0000 C        	NOP
   698 012C0 0012 C        	RET
   699 012C1 0000 C        	NOP
   700            C        
   701            C        
   702            C        
   703            C        ;============================================================================
   704            C        ;file name:     IO 3D Rocker KeyScan
   705            C        ;INPUT PORT:
   706            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   707            C        ;TIME:
   708            C        ;Descrition:    Use for check AD rocker data
   709            C        ;============================================================================
   710 012C2      C        IO_Rocker_KeyScan:
   711 012C2 0000 C        	NOP
   712 012C3 0000 C        	NOP
   713 012C4 12E1 C        	CALL                Pre_Discharge
   714 012C5 130F C        	CALL                SampingRefTiming   ; Ref
   715 012C6 12E1 C        	CALL                Pre_Discharge
   716 012C7 1326 C        	CALL                SampingLxTiming    ; Lx
   717 012C8 12E1 C        	CALL                Pre_Discharge
   718 012C9 133D C        	CALL                SampingLyTiming    ; Ly
   719 012CA 12E1 C        	CALL                Pre_Discharge
   720 012CB 1354 C        	CALL                SampingRxTiming    ; Rx
   721 012CC 12E1 C        	CALL                Pre_Discharge
   722 012CD 136B C        	CALL                SampingRyTiming    ; Ry
   723 012CE 12FE C        	CALL                Back_Discharge
   724 012CF 0000 C        	NOP
   725            C        
   726 012D0 1E02 C        	BANK                2
   727 012D1 0430 C        	MOV                 A,KEY_LEFT_X
   728 012D2 1383 C        	CALL                Conversion_Data
   729 012D3 0070 C        	MOV                 KEY_LEFT_X,A        ; Left x Axis
   730 012D4 0431 C        	MOV                 A,KEY_LEFT_Y
   731 012D5 1383 C        	CALL                Conversion_Data
   732 012D6 0071 C        	MOV                 KEY_LEFT_Y,A        ; Left y Axis
   733 012D7 0432 C        	MOV                 A,KEY_RIGHT_X
   734 012D8 1383 C        	CALL                Conversion_Data
   735 012D9 0072 C        	MOV                 KEY_RIGHT_X,A       ; right x Axis
   736 012DA 0433 C        	MOV                 A,KEY_RIGHT_Y
   737 012DB 1383 C        	CALL                Conversion_Data
   738 012DC 0073 C        	MOV                 KEY_RIGHT_Y,A       ; right y Axis
   739            C        
   740 012DD 0000 C        	NOP
   741 012DE 0000 C        	NOP
   742 012DF 0012 C        	RET
   743 012E0 0000 C        	NOP
   744            C        
   745            C        ;---------------------------------------------------------------
   746 012E1      C        Pre_Discharge:
   747 012E1 1E04 C        	BANK                4
   748 012E2 18FF C        	MOV                 A,@0B11111111
   749 012E3 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   750            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   751            C        	;BS                  P8IOCR,Reference     ; Input P87
   752 012E4 0408 C        	MOV                 A,P8IOCR
   753 012E5 1A3F C        	AND                 A,@0B00111111
   754 012E6 19C0 C        	OR                  A,@0B11000000
   755 012E7 0048 C        	MOV                 P8IOCR,A             ; Set P87->Input,P86->Input
   756            C        
   757 012E8 18F0 C        	MOV                 A,@0B11110000
   758 012E9 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   759 012EA 0988 C        	BC                  P8IOCR,Leakresis     ; Output P86
   760 012EB 09C8 C        	BC                  P8IOCR,Reference     ; Output P87
   761            C        	;MOV                 A,P8IOCR
   762            C        	;AND                 A,@0B00111111
   763            C        	;OR                  A,@0B00000000
   764            C        	;MOV                 P8IOCR,A            ; Set P87->Output,P86->Output
   765 012EC 1E00 C        	BANK                0
   766 012ED 00C9 C        	CLR                 PORT9
   767            C        	;BC                  PORT9,LeftYAxis
   768            C        	;BC                  PORT9,LeftXAxis
   769            C        	;BC                  PORT9,RightYAxis
   770            C        	;BC                  PORT9,RightXAxis
   771 012EE 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   772 012EF 09C8 C        	BC                  PORT8,Reference     ; Set P87 Low
   773            C        
   774 012F0 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   775            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   776            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   777            C        	XOR                 PORT8,A
   778            C          endif
   779 012F1 1E02 C        	BANK                2
   780 012F2 0B49 C        	BS                  T2CR,T2EN          ; START
   781 012F3 00ED C        	CLR                 IOcheckTimeCNT
   782 012F4 042D C        	MOV                 A,IOcheckTimeCNT
   783 012F5 1D0A C        	SUB                 A,@LeakresisTimeCNT
   784 012F6 0C03 C        	JBC                 STATUS,C
   785 012F7 16F4 C        	JMP                 $-3
   786 012F8 0949 C        	BC                  T2CR,T2EN          ; Disable
   787 012F9 1E00 C        	BANK                0
   788            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   789            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   790            C        	XOR                 PORT8,A
   791            C          endif
   792 012FA 1881 C        	MOV                 A,@0B10000001
   793 012FB 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   794 012FC 0012 C        	RET
   795 012FD 0000 C        	NOP
   796            C        
   797 012FE      C        Back_Discharge:
   798 012FE 1E04 C        	BANK                4
   799 012FF 18FF C        	MOV                 A,@0B11111111
   800 01300 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   801            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   802            C        	;BS                  P8IOCR,Reference     ; Input P87
   803 01301 0408 C        	MOV                 A,P8IOCR
   804 01302 1A3F C        	AND                 A,@0B00111111
   805 01303 19C0 C        	OR                  A,@0B11000000
   806 01304 0048 C        	MOV                 P8IOCR,A            ; Set P87->Input,P86->Input
   807            C        
   808 01305 18F0 C        	MOV                 A,@0B11110000
   809 01306 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   810 01307 0988 C        	BC                  P8IOCR,Leakresis     ; Output P86
   811 01308 09C8 C        	BC                  P8IOCR,Reference     ; Output P87
   812            C        	;MOV                 A,P8IOCR
   813            C        	;AND                 A,@0B00111111
   814            C        	;OR                  A,@0B10000000
   815            C        	;MOV                 P8IOCR,A            ; Set P87->Input,P86->Output
   816 01309 1E00 C        	BANK                0
   817 0130A 00C9 C        	CLR                 PORT9
   818            C        	;BC                  PORT9,LeftYAxis
   819            C        	;BC                  PORT9,LeftXAxis
   820            C        	;BC                  PORT9,RightYAxis
   821            C        	;BC                  PORT9,RightXAxis
   822 0130B 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   823 0130C 09C8 C        	BC                  PORT8,Reference     ; Set P87 Low
   824 0130D 0012 C        	RET
   825 0130E 0000 C        	NOP
   826            C        
   827            C        ;---------------------------------------------------------------
   828 0130F      C        SampingRefTiming:
   829 0130F 1E04 C        	BANK                4
   830 01310 18FF C        	MOV                 A,@0B11111111
   831 01311 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   832 01312 0B88 C        	BS                  P8IOCR,Leakresis    ; Input  P86
   833 01313 09C8 C        	BC                  P8IOCR,Reference    ; Output P87
   834            C        	;MOV                 A,P8IOCR
   835            C        	;AND                 A,@0B00111111
   836            C        	;OR                  A,@0B01000000
   837            C        	;MOV                 P8IOCR,A           ; Set P87->Output,P86->Input
   838 01314 1E00 C        	BANK                0
   839            C        	;BS                  PORT9,LeftYAxis
   840            C        	;BS                  PORT9,LeftXAxis
   841            C        	;BS                  PORT9,RightYAxis
   842            C        	;BS                  PORT9,RightXAxis
   843            C        	;BS                  PORT8,Leakresis    ; Set P86
   844 01315 0BC8 C        	BS                  PORT8,Reference     ; Set P87 High
   845            C        
   846 01316 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   847            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   848            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   849            C        	XOR                 PORT8,A
   850            C          endif
   851 01317 1E02 C        	BANK                2
   852            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   853            C        	;MOV                 T2PD,A
   854 01318 0B49 C        	BS                  T2CR,T2EN          ; START
   855 01319 00ED C        	CLR                 IOcheckTimeCNT
   856 0131A 1E00 C        	BANK                0
   857 0131B 0F88 C        	JBS                 PORT8,Leakresis
   858 0131C 171B C        	JMP                 $-1
   859            C        	;MOV                 A,@0B10000001
   860            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   861            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   862            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   863            C        	XOR                 PORT8,A
   864            C          endif
   865 0131D 1E02 C        	BANK                2
   866 0131E 0949 C        	BC                  T2CR,T2EN          ; Disable
   867 0131F 042D C        	MOV                 A,IOcheckTimeCNT
   868 01320 006A C        	MOV                 IOcheckRefValue,A
   869 01321 1E00 C        	BANK                0
   870 01322 1881 C        	MOV                 A,@0B10000001
   871 01323 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   872 01324 0012 C        	RET
   873 01325 0000 C        	NOP
   874            C        
   875            C        
   876            C        
   877            C        ;---------------------------------------------------------------
   878 01326      C        SampingLxTiming:
   879 01326 1E04 C        	BANK                4
   880 01327 18FD C        	MOV                 A,@0B11111101
   881 01328 0049 C        	MOV                 P9IOCR,A            ; P97-P92:Input; P91:output; P90:Input
   882 01329 0B88 C        	BS                  P8IOCR,Leakresis    ; input
   883 0132A 0BC8 C        	BS                  P8IOCR,Reference    ; input
   884            C        	;MOV                 A,P8IOCR
   885            C        	;AND                 A,@0B00111111
   886            C        	;OR                  A,@0B11000000
   887            C        	;MOV                 P8IOCR,A
   888 0132B 1E00 C        	BANK                0
   889            C        	;BS                  PORT9,LeftYAxis
   890 0132C 0A49 C        	BS                  PORT9,LeftXAxis     ; Set P91 HIGH
   891            C        	;BS                  PORT9,RightYAxis
   892            C        	;BS                  PORT9,RightXAxis
   893            C        	;BS                  PORT8,Reference    ; Set P87
   894            C        	;BS                  PORT8,Leakresis    ; Set P86
   895            C        
   896 0132D 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   897            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   898            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   899            C        	XOR                 PORT8,A
   900            C          endif
   901 0132E 1E02 C        	BANK                2
   902            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   903            C        	;MOV                 T2PD,A
   904 0132F 0B49 C        	BS                  T2CR,T2EN          ; START
   905 01330 00ED C        	CLR                 IOcheckTimeCNT
   906 01331 1E00 C        	BANK                0
   907 01332 0F88 C        	JBS                 PORT8,Leakresis
   908 01333 1732 C        	JMP                 $-1
   909            C        	;MOV                 A,@0B10000001
   910            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   911            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   912            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   913            C        	XOR                 PORT8,A
   914            C          endif
   915 01334 1E02 C        	BANK                2
   916 01335 0949 C        	BC                  T2CR,T2EN           ; Disable
   917 01336 042D C        	MOV                 A,IOcheckTimeCNT
   918 01337 0070 C        	MOV                 KEY_LEFT_X,A
   919 01338 1E00 C        	BANK                0
   920 01339 1881 C        	MOV                 A,@0B10000001
   921 0133A 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   922 0133B 0012 C        	RET
   923 0133C 0000 C        	NOP
   924            C        
   925            C        ;---------------------------------------------------------------
   926 0133D      C        SampingLyTiming:
   927 0133D 1E04 C        	BANK                4
   928 0133E 18FE C        	MOV                 A,@0B11111110
   929 0133F 0049 C        	MOV                 P9IOCR,A            ; P97-P91:Input; P90:output
   930 01340 0B88 C        	BS                  P8IOCR,Leakresis    ; input P86
   931 01341 0BC8 C        	BS                  P8IOCR,Reference    ; input P87
   932            C        	;MOV                 A,P8IOCR
   933            C        	;AND                 A,@0B00111111
   934            C        	;OR                  A,@0B11000000
   935            C        	;MOV                 P8IOCR,A
   936 01342 1E00 C        	BANK                0
   937 01343 0A09 C        	BS                  PORT9,LeftYAxis     ; Set P90 HIGH
   938            C        	;BS                  PORT9,LeftXAxis
   939            C        	;BS                  PORT9,RightYAxis
   940            C        	;BS                  PORT9,RightXAxis
   941            C        	;BS                  PORT8,Reference    ; Set P87
   942            C        	;BS                  PORT8,Leakresis    ; Set P86
   943            C        
   944 01344 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   945            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   946            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   947            C        	XOR                 PORT8,A
   948            C          endif
   949 01345 1E02 C        	BANK                2
   950            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   951            C        	;MOV                 T2PD,A
   952 01346 0B49 C        	BS                  T2CR,T2EN          ; START
   953 01347 00ED C        	CLR                 IOcheckTimeCNT
   954 01348 1E00 C        	BANK                0
   955 01349 0F88 C        	JBS                 PORT8,Leakresis
   956 0134A 1749 C        	JMP                 $-1
   957            C        	;MOV                 A,@0B10000001
   958            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   959            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   960            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   961            C        	XOR                 PORT8,A
   962            C          endif
   963 0134B 1E02 C        	BANK                2
   964 0134C 0949 C        	BC                  T2CR,T2EN           ; Disable
   965 0134D 042D C        	MOV                 A,IOcheckTimeCNT
   966 0134E 0071 C        	MOV                 KEY_LEFT_Y,A
   967 0134F 1E00 C        	BANK                0
   968 01350 1881 C        	MOV                 A,@0B10000001
   969 01351 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   970 01352 0012 C        	RET
   971 01353 0000 C        	NOP
   972            C        
   973            C        ;---------------------------------------------------------------
   974 01354      C        SampingRxTiming:
   975 01354 1E04 C        	BANK                4
   976 01355 18F7 C        	MOV                 A,@0B11110111
   977 01356 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93:output; P92-P90:Input
   978 01357 0B88 C        	BS                  P8IOCR,Leakresis    ; input
   979 01358 0BC8 C        	BS                  P8IOCR,Reference    ; input
   980            C        	;MOV                 A,P8IOCR
   981            C        	;AND                 A,@0B00111111
   982            C        	;OR                  A,@0B11000000
   983            C        	;MOV                 P8IOCR,A
   984 01359 1E00 C        	BANK                0
   985            C        	;BS                  PORT9,LeftYAxis
   986            C        	;BS                  PORT9,LeftXAxis
   987            C        	;BS                  PORT9,RightYAxis
   988 0135A 0AC9 C        	BS                  PORT9,RightXAxis    ; Set P93 HIGH
   989            C        	;BS                  PORT8,Reference    ; Set P87
   990            C        	;BS                  PORT8,Leakresis    ; Set P86
   991            C        
   992 0135B 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   993            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
   994            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   995            C        	XOR                 PORT8,A
   996            C          endif
   997 0135C 1E02 C        	BANK                2
   998            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   999            C        	;MOV                 T2PD,A
  1000 0135D 0B49 C        	BS                  T2CR,T2EN          ; START
  1001 0135E 00ED C        	CLR                 IOcheckTimeCNT
  1002 0135F 1E00 C        	BANK                0
  1003 01360 0F88 C        	JBS                 PORT8,Leakresis
  1004 01361 1760 C        	JMP                 $-1
  1005            C        	;MOV                 A,@0B10000001
  1006            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1007            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
  1008            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1009            C        	XOR                 PORT8,A
  1010            C          endif
  1011 01362 1E02 C        	BANK                2
  1012 01363 0949 C        	BC                  T2CR,T2EN           ; Disable
  1013 01364 042D C        	MOV                 A,IOcheckTimeCNT
  1014 01365 0072 C        	MOV                 KEY_RIGHT_X,A
  1015 01366 1E00 C        	BANK                0
  1016 01367 1881 C        	MOV                 A,@0B10000001
  1017 01368 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1018 01369 0012 C        	RET
  1019 0136A 0000 C        	NOP
  1020            C        
  1021            C        ;---------------------------------------------------------------
  1022 0136B      C        SampingRyTiming:
  1023 0136B 1E04 C        	BANK                4
  1024 0136C 18FB C        	MOV                 A,@0B11111011
  1025 0136D 0049 C        	MOV                 P9IOCR,A            ; P97-P93:Input; P92:output; P91-P90:Input
  1026 0136E 0B88 C        	BS                  P8IOCR,Leakresis    ; input
  1027 0136F 0BC8 C        	BS                  P8IOCR,Reference    ; input
  1028            C        	;MOV                 A,P8IOCR
  1029            C        	;AND                 A,@0B00111111
  1030            C        	;OR                  A,@0B11000000
  1031            C        	;MOV                 P8IOCR,A
  1032 01370 1E00 C        	BANK                0
  1033            C        	;BS                  PORT9,LeftYAxis
  1034            C        	;BS                  PORT9,LeftXAxis
  1035 01371 0A89 C        	BS                  PORT9,RightYAxis    ; Set P92 HIGH
  1036            C        	;BS                  PORT9,RightXAxis
  1037            C        	;BS                  PORT8,Reference    ; Set P87
  1038            C        	;BS                  PORT8,Leakresis    ; Set P86
  1039            C        
  1040 01372 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
  1041            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
  1042            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1043            C        	XOR                 PORT8,A
  1044            C          endif
  1045 01373 1E02 C        	BANK                2
  1046            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
  1047            C        	;MOV                 T2PD,A
  1048 01374 0B49 C        	BS                  T2CR,T2EN          ; START
  1049 01375 00ED C        	CLR                 IOcheckTimeCNT
  1050 01376 1E00 C        	BANK                0
  1051 01377 0F88 C        	JBS                 PORT8,Leakresis
  1052 01378 1777 C        	JMP                 $-1
  1053            C        	;MOV                 A,@0B10000001
  1054            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1055            C          if IOtoADC_T_DEBUG & DebugDisplay ==1
  1056            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1057            C        	XOR                 PORT8,A
  1058            C          endif
  1059 01379 1E02 C        	BANK                2
  1060 0137A 0949 C        	BC                  T2CR,T2EN          ; START
  1061 0137B 042D C        	MOV                 A,IOcheckTimeCNT
  1062 0137C 0073 C        	MOV                 KEY_RIGHT_Y,A
  1063            C        	;COM                 KEY_RIGHT_Y
  1064 0137D 1E00 C        	BANK                0
  1065 0137E 1881 C        	MOV                 A,@0B10000001
  1066 0137F 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1067 01380 0000 C        	NOP
  1068 01381 0012 C        	RET
  1069 01382 0000 C        	NOP
  1070            C        
  1071            C        ;=======================================================================
  1072            C        ; input:        ACC
  1073            C        ; output:       ACC
  1074            C        ; registor:     TEMP, TEMP1, TEMP2
  1075            C        ; descripition: Operate io data change to anylize data. Kr=0x80(2^7)
  1076            C        ;=======================================================================
  1077 01383      C        Conversion_Data:
  1078 01383 00D1 C        	CLR                 TEMP1
  1079 01384 00D2 C        	CLR                 TEMP2
  1080            C          if Kr == 5
  1081 01385 0052 C        	MOV                 TEMP2,A
  1082 01386 0803 C        	BC                  STATUS,C
  1083 01387 0652 C        	RRC                 TEMP2
  1084 01388 0651 C        	RRC                 TEMP1
  1085 01389 042A C        	MOV                 A,IOcheckRefValue
  1086 0138A 0050 C        	MOV                 TEMP,A
  1087            C          elseif Kr == 10
  1088            C        	MOV                 TEMP2,A
  1089            C        	;BC                  STATUS,C
  1090            C        	;RRC                 TEMP2
  1091            C        	;RRC                 TEMP1
  1092            C        	MOV                 A,IOcheckRefValue
  1093            C        	MOV                 TEMP,A
  1094            C          endif
  1095            C        
  1096            C      M 	mDIV2_1             TEMP2,TEMP1,TEMP
       0138B 1810     1     MOV A,@( 16 )
       0138C 005B     1     MOV  REG_ACC ,A
       0138D 0080     1     CLRA 
       0138E 0210     1     OR A, TEMP 
       0138F 0C83     1     JBC  STATUS , Z 
       01390 17A2     1     JMP  ??001D$_DIV_OUT ,
       01391 00D0     1     CLR  TEMP ,
       01392          1    ??001D$_DIV_SUB:   
       01392 06D1     1     RLC  TEMP1 ,
       01393 06D2     1     RLC  TEMP2 ,
       01394 06D0     1     RLC  TEMP ,
       01395 0A11     1     BS  TEMP1 , 0 
       01396 0E03     1     JBS  STATUS , C 
       01397 179A     1     JMP  ??001D$_DIV_S_0 ,
       01398 0150     1     SUB  TEMP ,A
       01399 179F     1     JMP  ??001D$_DIV_CNT ,
       0139A          1    ??001D$_DIV_S_0:   
       0139A 0150     1     SUB  TEMP ,A
       0139B 0C03     1     JBC  STATUS , C 
       0139C 179F     1     JMP  ??001D$_DIV_CNT ,
       0139D 0811     1     BC  TEMP1 , 0 
       0139E 03D0     1     ADD  TEMP ,A
       0139F          1    ??001D$_DIV_CNT:   
       0139F 05DB     1     DJZ  REG_ACC ,
       013A0 1792     1     JMP  ??001D$_DIV_SUB ,
       013A1 1801     1     MOV A,@( 1 )
       013A2          1    ??001D$_DIV_OUT:   
  1097 013A2 0411 C        	MOV                 A,TEMP1
  1098 013A3 0000 C        	NOP
  1099 013A4 0012 C        	RET
  1100 013A5 0000 C        	NOP
  1101            C        
  1102            C        
  1103            C        ;**********************************************************************************
  1104            C        ;*********************************************************************************
  1105            C        ; Connect Key Scan
  1106            C        ; Input:
  1107            C        ; output: KEY_NUM
  1108            C        ; KeyScanStatusFlag
  1109            C        ; change: temp,KeystokeFlag_Befor(INITIAL)
  1110            C        ;*********************************************************************************
  1111 013A6      C        ConnectKey_Scan:
  1112 013A6 1E02 C        	BANK                2
  1113 013A7 042E C        	MOV                 A,KeySystemTimeCNT
  1114 013A8 1D01 C        	SUB                 A,@1                   ; Control key scan clock
  1115 013A9 0C03 C        	JBC                 STATUS,C
  1116 013AA 0012 C        	RET
  1117 013AB 00EE C        	CLR                 KeySystemTimeCNT
  1118            C        	;BANK                0
  1119            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1120            C        	;XOR                 PORT8,A
  1121            C        
  1122            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
  1123 013AC 1E00 C        	BANK                0
  1124 013AD 18B8 C        	MOV                 A,@10111000B
  1125 013AE 0047 C        	MOV                 PORT7,A
  1126 013AF 11ED C        	CALL                KEY_DELAY
  1127 013B0 0409 C        	MOV                 A,PORT9                ;(Slect,Start,MODE,MACRO(Connect),x,x,x,x)
  1128 013B1 1E02 C        	BANK                2
  1129 013B2 1A10 C        	AND                 A,@00010000B           ;
  1130 013B3 0050 C        	MOV                 TEMP,A
  1131 013B4 1810 C        	MOV                 A,@00010000B           ; Bit4
  1132 013B5 02F6 C        	AND                 KeystokeFlag_Befor,A
  1133            C        
  1134            C        ;---------------------------------------------------------------------
  1135 013B6      C          Falling_Edge_Judge:
  1136 013B6 0410 C        	MOV                 A,TEMP
  1137 013B7 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
  1138 013B8 0C83 C        	JBC                 STATUS,Z
  1139 013B9 17C4 C        	JMP                 Rising_Edge_Judge         ; no edge occur
  1140 013BA 0410 C        	MOV                 A,TEMP                    ; Falling edge will change
  1141 013BB 1B00 C        	XOR                 A,@00000000B
  1142 013BC 0E83 C        	JBS                 STATUS,Z
  1143 013BD 17C4 C        	JMP                 Rising_Edge_Judge         ; no falling edge
  1144 013BE 0E5E C        	JBS                 KeyScanStatusFlag/8,KeyScanStatusFlag%8        ; scan the first falling edge
  1145 013BF 0A38 C        	BS                  KEY_NUM,0                            ; Will into key scan, Set guide bit
  1146 013C0 00F7 C        	CLR                 KeystokeTimeCNT                      ; press times ,recalculate
  1147 013C1 089E C        	BC                  KeyStatusFlag/8,KeyStatusFlag%8    ; key status, press(0) or release(1)
  1148 013C2 0A5E C        	BS                  KeyScanStatusFlag/8,KeyScanStatusFlag%8	     ; into scan key status
  1149 013C3 17D0 C        	JMP                 Edge_Judge_End
  1150            C        
  1151            C        ;--------------------------------------------------------------------
  1152 013C4      C          Rising_Edge_Judge:
  1153 013C4 0410 C        	MOV                 A,TEMP
  1154 013C5 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
  1155 013C6 0C83 C        	JBC                 STATUS,Z
  1156 013C7 17D0 C        	JMP                 Edge_Judge_End
  1157 013C8 0410 C        	MOV                 A,TEMP                    ; rising edge will change
  1158 013C9 1B10 C        	XOR                 A,@00010000B
  1159 013CA 0E83 C        	JBS                 STATUS,Z
  1160 013CB 17D0 C        	JMP                 Edge_Judge_End
  1161 013CC 0000 C        	NOP
  1162 013CD 13E1 C        	CALL                KeyStatus_Low_Scan        ; rising edge ,check low level time
  1163 013CE 00F7 C        	CLR                 KeystokeTimeCNT           ; press times ,recalculate
  1164 013CF 0A9E C        	BS                  KeyStatusFlag/8,KeyStatusFlag%8
  1165 013D0      C          Edge_Judge_End:
  1166 013D0 0410 C        	MOV                 A,TEMP                    ; save currently press key status used for next judge
  1167 013D1 0076 C        	MOV                 KeystokeFlag_Befor,A
  1168            C        
  1169            C        ;------------------------------------------------------------------------------
  1170 013D2      C          KeystokeScan_End:                                                ; a cycle scan end
  1171 013D2 0E5E C        	JBS                 KeyScanStatusFlag/8,KeyScanStatusFlag%8
  1172 013D3 00F8 C        	CLR                 KEY_NUM
  1173 013D4 0DF8 C        	JBC                 KEY_NUM,7                                  ; Count overflow
  1174 013D5 00F8 C        	CLR                 KEY_NUM
  1175            C        
  1176 013D6 0437 C        	MOV                 A,KeystokeTimeCNT
  1177 013D7 1DB4 C        	SUB                 A,@KeyPressTime                            ; KeyPressTime*16ms=3600ms(ComuTime=56ms)
  1178 013D8 0C03 C        	JBC                 STATUS,C
  1179 013D9 0577 C        	INC                 KeystokeTimeCNT                            ; press times ,recalculate
  1180            C        
  1181 013DA 0437 C        	MOV                 A,KeystokeTimeCNT
  1182 013DB 1D3C C        	SUB                 A,@KeyScanTime                             ; 60*16ms=960ms(ComuTime=56ms)
  1183 013DC 0C03 C        	JBC                 STATUS,C                                   ; Scan finish edge
  1184 013DD 0012 C        	RET
  1185 013DE 085E C        	BC                  KeyScanStatusFlag/8,KeyScanStatusFlag%8  ; more than 60*16ms=960ms ,EXIT scan status
  1186 013DF 0ADE C        	BS                  KeyScanFinishFlag/8,KeyScanFinishFlag%8
  1187 013E0 0012 C        	RET
  1188            C        
  1189            C        ;=========================================================================
  1190 013E1      C        KeyStatus_Low_Scan:     ; rising edge ,check low level time
  1191 013E1 0437 C        	MOV                 A,KeystokeTimeCNT
  1192 013E2 1D1E C        	SUB                 A,@CrossingTime                      ;30*16ms=400ms(ComuTime=56ms)
  1193 013E3 0C03 C        	JBC                 STATUS,C                   ;
  1194 013E4 17E6 C        	JMP                 KeyScan_Short_Press	       ;less than 400ms
  1195 013E5 17E9 C        	JMP                 KeyScan_Lasting_Press      ;more than 400ms
  1196 013E6      C          KeyScan_Short_Press:
  1197 013E6 0803 C        	BC                  STATUS,C
  1198 013E7 06F8 C        	RLC                 KEY_NUM
  1199 013E8 0012 C        	RET
  1200 013E9      C          KeyScan_Lasting_Press:
  1201 013E9 0A03 C        	BS                  STATUS,C
  1202 013EA 06F8 C        	RLC                 KEY_NUM
  1203 013EB 0012 C        	RET
  1204            C        
  1205            C        
    21            C        endif
    22            C        
    23            C        
    24            C        ;---------------------------------------------------------
    25            C        
    26            C        	ORG                 0X400    ; PAGE 1
    27            C          if MassageDisplay == 1
    28            C        	MESSAGE "define 'P520SkipFreqFun.ASM' ROM address"
    29            C          endif
    30            C        ;***************************************************************
    31            C        ; Search mode
    32            C        ;***************************************************************
    33 00400      C        Search_Equipment:
    34 00400 0004 C        	WDTC
    35 00401 1E00 C        	BANK                0
    36            C        	;MOV                 A,@0x07               ; N=125,P=256,f=8MHz ==> T=4ms
    37            C        	;MOV                 TWTCR,A
    38 00402 1883 C        	MOV                 A,@(256-125)           ; load initial value
    39 00403 0041 C        	MOV                 TCC,A
    40            C        	;LCALL               RF_FREQ_SET
    41 00404 1EA0 C        	LCALL               RESET_RF_FIFO
    41 00405 0DC8 C        	LCALL               RESET_RF_FIFO
    42 00406 1EA0 C        	LCALL               Enter_StandbyII_Mode
    42 00407 0EB3 C        	LCALL               Enter_StandbyII_Mode
    43 00408 1EA0 C        	LCALL               ENTER_RX_BUFFER_ACK
    43 00409 0E38 C        	LCALL               ENTER_RX_BUFFER_ACK
    44 0040A 0000 C        	NOP
    45            C        
    46 0040B      C        Search_Start_up:
    47 0040B 1EA0 C        	LCALL               RF_FREQ_SET
    47 0040C 0EF9 C        	LCALL               RF_FREQ_SET
    48            C        
    49            C        ;------------------------------------------------------------------
    50 0040D      C        Detected_Connect_Key:
    51            C        	;LCALL               Enter_Sleep_Status
    52            C        	;BANK                0
    53            C        	;MOV                 A,@0x07                ; N=31,P=256,f=8MHz ==> T=1ms
    54            C        	;MOV                 TWTCR,A
    55            C        	;LCALL               ConnectKey_Scan
    56            C        	
    57 0040D 0EDE C        	JBS                 KeyScanFinishFlag/8,KeyScanFinishFlag%8
    58 0040E 141D C        	JMP                 Keystoke_No_Press
    59            C        
    60 0040F 1E02 C        	BANK                2
    61 00410 0438 C        	MOV                 A,KEY_NUM
    62 00411 1B02 C        	XOR                 A,@00000010B
    63 00412 0C83 C        	JBC                 STATUS,Z
    64 00413 14EE C        	JMP                 Click_Select                  ;Click Select
    65            C        
    66 00414 0438 C        	MOV                 A,KEY_NUM
    67 00415 1B03 C        	XOR                 A,@00000011B
    68 00416 0C83 C        	JBC                 STATUS,Z
    69 00417 14F9 C        	JMP                 Lasting_Press_Select          ;Lasting_Press Select
    70            C        
    71 00418 0438 C        	MOV                 A,KEY_NUM
    72 00419 1B04 C        	XOR                 A,@00000100B
    73 0041A 0C83 C        	JBC                 STATUS,Z
    74 0041B 14FF C        	JMP                 Dblclick_Select               ;Dblclick Select
    75            C        
    76 0041C 08DE C        	BC                  KeyScanFinishFlag/8,KeyScanFinishFlag%8
    77            C        
    78            C        
    79            C        ;-------------------------------------------------------------------------
    80 0041D      C        Keystoke_No_Press:
    81 0041D 1E00 C        	BANK                0
    82 0041E      C        Waiting_For_SearchData_Arrive:
    83 0041E 0417 C        	MOV                 A,ComuClock                  ; 8ms*ComuClock Interrupt ,
    84 0041F 1D03 C        	SUB                 A,@3
    85 00420 0E03 C        	JBS                 STATUS,C
    86 00421 14C8 C        	JMP                 Search_Detect_Timeout        ; RX1  ; Timeout but have not received TX data
    87 00422 0E0B C        	JBS                 PKT_FLAG/8,PKT_FLAG%8	     ; 1:TX data receive finished  0:wating PKT pull high
    88 00423 140D C        	JMP                 Detected_Connect_Key
    89            C        ;-----------------------------------------------------------------------------------
    90 00424 0000 C        	NOP
    91            C        	;LCALL               LoseFrameLinkMode_Set
    92 00425 081F C        	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
    93 00426 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
    94 00427 0A9F C        	BS                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
    95            C        
    96 00428 1E00 C        	BANK                0
    97            C        	;MOV                 A,@0x07              ; N=31,P=256,f=8MHz ==> T=1ms
    98            C        	;MOV                 TWTCR,A
    99 00429 18E0 C        	MOV                 A,@(256-32)           ; Reload TCC value
   100 0042A 0041 C        	MOV                 TCC,A
   101 0042B 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   102 0042C 0348 C        	XOR                 PORT8,A
   103            C        
   104 0042D 00D7 C        	CLR                 ComuClock
   105            C        ;-----------------------------------------------------------------------------------
   106 0042E 1EA0 C        	LCALL               READ_FIFO_RAM
   106 0042F 0D99 C        	LCALL               READ_FIFO_RAM
   107 00430 1EA0 C        	LCALL               RESET_RF_FIFO
   107 00431 0DC8 C        	LCALL               RESET_RF_FIFO
   108 00432 1EA0 C        	LCALL               Enter_StandbyI_Mode
   108 00433 0E9E C        	LCALL               Enter_StandbyI_Mode
   109 00434 0000 C        	NOP
   110            C        
   111 00435 0000 C        	NOP
   112 00436 0D1D C        	JBC                 ReadLengthError/8,ReadLengthError%8
   113 00437 14C8 C        	JMP                 Search_Detect_Timeout
   114 00438 0D5F C        	JBC                 ForceLinkModeFlag/8,ForceLinkModeFlag%8
   115 00439 14B1 C        	JMP                 ForceLink_Mode_Task
   116 0043A 00D8 C        	CLR                 ComuCycleNum
   117 0043B 00D9 C        	CLR                 ComuEndNum
   118            C        
   119            C        ;------------------- check sync imformation ---------------------
   120 0043C 1E01 C        	BANK                1
   121 0043D 0421 C        	MOV                 A,RX_IDH
   122 0043E 1E00 C        	BANK                0
   123 0043F 0361 C        	XOR                 RX_IDH_Buffer,A
   124 00440 0E83 C        	JBS                 STATUS,Z
   125 00441 140B C        	JMP                 Search_Start_up      ;RX_ID_ERROR
   126 00442 1E01 C        	BANK                1
   127 00443 0422 C        	MOV                 A,RX_IDL
   128 00444 1E00 C        	BANK                0
   129 00445 0362 C        	XOR                 RX_IDL_Buffer,A
   130 00446 0E83 C        	JBS                 STATUS,Z
   131 00447 140B C        	JMP                 Search_Start_up      ;RX_ID_ERROR
   132            C        ;---------------------------------------------------------------------------
   133 00448 00D2 C        	CLR                 TEMP2                 ;CHN_FLAG TEMP
   134 00449 1E01 C        	BANK                1
   135 0044A 0426 C        	MOV                 A,TX_ID               ;
   136 0044B 1A0F C        	AND                 A,@0X0F
   137 0044C 0050 C        	MOV                 TEMP,A
   138            C        
   139 0044D 0A03 C        	BS                  STATUS,C
   140 0044E 06D2 C        	RLC                 TEMP2
   141 0044F 05D0 C        	DJZ                 TEMP
   142 00450 144E C        	JMP                 $-2
   143 00451 0412 C        	MOV                 A,TEMP2
   144 00452 0063 C        	MOV                 CHN_FLAG,A            ;repeat used channel
   145 00453 1E00 C        	BANK                0
   146 00454 0063 C        	MOV                 CHN_FLAG_Buffer,A
   147            C        
   148            C        ;------------------------------------------------------------------
   149            C          if MassageDisplay == 1
   150            C        	MESSAGE             "TX_ID = (RX_IDL&0XF0)|N, {N=1,2,3,4...}"
   151            C          endif
   152 00455      C        SearchComu_Cycle_work:
   153 00455 1E01 C        	BANK                1
   154 00456 00D8 C        	CLR                 ComuCycleNum
   155 00457 0426 C        	MOV                 A,TX_ID
   156 00458 1A0F C        	AND                 A,@0X0F
   157 00459 005B C        	MOV                 DataShiftCNT,A        ;decode ComuCycleNum by TX_ID
   158 0045A 01DB C        	DEC                 DataShiftCNT
   159 0045B 0C83 C        	JBC                 STATUS,Z
   160 0045C 1461 C        	JMP                 ComuCycleNum_End
   161 0045D      C        ComuCycleNum_Loop:
   162 0045D 1804 C        	MOV                 A,@SetComuTime
   163 0045E 03D8 C        	ADD                 ComuCycleNum,A
   164 0045F 05DB C        	DJZ                 DataShiftCNT
   165 00460 145D C        	JMP                 ComuCycleNum_Loop
   166 00461      C        ComuCycleNum_End:
   167 00461 0000 C        	NOP
   168            C        
   169 00462 1E00 C        	BANK                0
   170 00463 0424 C        	MOV                 A,GamePadsSum_Buffer
   171 00464 1E01 C        	BANK                1
   172 00465 0064 C        	MOV                 GamePadsSum,A         ; Save GamePadsSum
   173 00466 005B C        	MOV                 DataShiftCNT,A        ; End communicate cycle
   174 00467      C        ComuEndNum_Loop:
   175 00467 1804 C        	MOV                 A,@SetComuTime
   176 00468 03D9 C        	ADD                 ComuEndNum,A
   177 00469 05DB C        	DJZ                 DataShiftCNT
   178 0046A 1467 C        	JMP                 ComuEndNum_Loop
   179 0046B 01D9 C        	DEC                 ComuEndNum
   180            C        
   181            C        ;-------------------------------------------------------------------------------
   182 0046C 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   183 0046D 0118 C        	SUB                 A,ComuCycleNum
   184 0046E 0C03 C        	JBC                 STATUS,C
   185 0046F 146C C        	JMP                 $-3
   186            C        ;-------------------------------------------------------------------------------
   187            C        	;MOV                 A,@16                ; Transmitter data ,SYNC HEAD = 7 byte
   188            C        	;MOV                 Databytelength,A
   189 00470 0000 C        	NOP
   190 00471 1E01 C        	BANK                1
   191 00472 0420 C        	MOV                 A,PID_DATA
   192 00473 1E00 C        	BANK                0
   193 00474 0060 C        	MOV                 PID_DATA_Buffer,A
   194 00475 1E01 C        	BANK                1
   195 00476 0421 C        	MOV                 A,RX_IDH
   196 00477 1E00 C        	BANK                0
   197 00478 0061 C        	MOV                 RX_IDH_Buffer,A
   198 00479 1E01 C        	BANK                1
   199 0047A 0422 C        	MOV                 A,RX_IDL
   200 0047B 1E00 C        	BANK                0
   201 0047C 0062 C        	MOV                 RX_IDL_Buffer,A
   202 0047D 1E01 C        	BANK                1
   203 0047E 0423 C        	MOV                 A,CHN_FLAG
   204 0047F 1E00 C        	BANK                0
   205 00480 0063 C        	MOV                 CHN_FLAG_Buffer,A
   206 00481 1E01 C        	BANK                1
   207 00482 0424 C        	MOV                 A,GamePadsSum
   208 00483 1E00 C        	BANK                0
   209 00484 0064 C        	MOV                 GamePadsSum_Buffer,A
   210 00485 041F C        	MOV                 A,CommuStatusFlag
   211 00486 0065 C        	MOV                 CommuStatusFlag_Buffer,A
   212 00487 1E01 C        	BANK                1
   213 00488 0425 C        	MOV                 A,CH_NO
   214 00489 1E00 C        	BANK                0
   215 0048A 0066 C        	MOV                 CH_NO_Buffer,A
   216 0048B 1E01 C        	BANK                1
   217 0048C 0426 C        	MOV                 A,TX_ID
   218 0048D 1E00 C        	BANK                0
   219 0048E 0067 C        	MOV                 TX_ID_Buffer,A
   220            C        
   221 0048F 1E00 C        	BANK                0
   222 00490 187F C        	MOV                 A,@0X7F
   223 00491 0068 C        	MOV                 DataA_Buffer,A
   224 00492 0069 C        	MOV                 DataB_Buffer,A
   225 00493 006A C        	MOV                 DataC_Buffer,A
   226 00494 006B C        	MOV                 DataD_Buffer,A
   227 00495 00EC C        	CLR                 DataE_Buffer
   228 00496 00ED C        	CLR                 DataF_Buffer
   229 00497 180F C        	MOV                 A,@0X0F
   230 00498 006E C        	MOV                 DataG_Buffer,A
   231            C        
   232 00499 1EA0 C        	LCALL               Enter_StandbyII_Mode
   232 0049A 0EB3 C        	LCALL               Enter_StandbyII_Mode
   233 0049B 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   233 0049C 0DD1 C        	LCALL               Enter_TX_Buffer_ACK
   234 0049D 1EA0 C        	LCALL               WRITE_FIFO_RAM
   234 0049E 0DB0 C        	LCALL               WRITE_FIFO_RAM
   235            C        	;LCALL               RESET_RF_FIFO
   236            C        	;LCALL               Enter_StandbyI_Mode
   237            C        
   238 0049F 0000 C        	NOP
   239 004A0 1E01 C        	BANK                1
   240 004A1 0D5F C        	JBC                 ForceLinkModeFlag/8,ForceLinkModeFlag%8
   241 004A2 1511 C        	JMP                 Write_EEprom_Task
   242 004A3 00F2 C        	CLR                 LossframeCNT
   243            C        ;-------------------------------------------------------------------------------
   244            C        
   245            C        	;LCALL               Key_Scan
   246            C        ;-------------------------------------------------
   247            C        	;LCALL               NormalLinkMode_Set
   248 004A4 081F C        	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;Clear search status
   249 004A5 0A5F C        	BS                  NormalStatusFlag/8,NormalStatusFlag%8            ;set normal mode
   250 004A6 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   251 004A7 0B1F C        	BS                  LinkModeFlag/8,LinkModeFlag%8
   252 004A8 095F C        	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   253 004A9 099F C        	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   254            C        
   255            C        ;-------------------------------------------------------------------------------
   256 004AA 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   257 004AB 0119 C        	SUB                 A,ComuEndNum
   258 004AC 0C03 C        	JBC                 STATUS,C
   259 004AD 14AA C        	JMP                 $-3
   260            C        ;-------------------------------------------------------------------------------
   261 004AE 00D7 C        	CLR                 ComuClock
   262 004AF 0000 C        	NOP
   263 004B0 0012 C        	RET
   264            C        
   265            C        
   266 004B1      C        ForceLink_Mode_Task:
   267 004B1 1E00 C        	BANK                0
   268 004B2 00D1 C        	CLR                 TEMP1                 ;TEMP COUNTER
   269 004B3 0423 C        	MOV                 A,CHN_FLAG_Buffer     ;READ CHN_FLAG From Buffer
   270 004B4 0050 C        	MOV                 TEMP,A
   271 004B5 0803 C        	BC                  STATUS,C
   272 004B6 0650 C        	RRC                 TEMP
   273 004B7 0551 C        	INC                 TEMP1
   274 004B8 0C03 C        	JBC                 STATUS,C               ;CHN_FLAG: 00,01,03,07,0F,1F,3F,7F
   275 004B9 14B6 C        	JMP                 $-3                    ;TX_ID   :  1  2  3  4  5  6  7  8
   276 004BA 0411 C        	MOV                 A,TEMP1
   277 004BB 1E01 C        	BANK                1
   278 004BC 0066 C        	MOV                 TX_ID,A
   279            C        
   280 004BD 1E00 C        	BANK                0
   281 004BE 0421 C        	MOV                 A,RX_IDH_Buffer        ;RX_IDH
   282 004BF 1E01 C        	BANK                1
   283 004C0 0061 C        	MOV                 RX_IDH,A
   284 004C1 1E00 C        	BANK                0
   285 004C2 0422 C        	MOV                 A,RX_IDL_Buffer
   286 004C3 1E01 C        	BANK                1
   287 004C4 0062 C        	MOV                 RX_IDL,A
   288 004C5 1AF0 C        	AND                 A,@0XF0
   289 004C6 0266 C        	OR                  TX_ID,A                ; TX_ID = (RX_IDL & OXF0) | (TX_ID & 0X0F)
   290 004C7 1455 C        	JMP                 SearchComu_Cycle_work
   291            C        
   292 004C8      C        Search_Detect_Timeout:
   293            C        	;LCALL               SearchLinkMode_Set
   294 004C8 0A1F C        	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   295 004C9 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   296 004CA 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   297            C        
   298 004CB 1E01 C        	BANK                1
   299 004CC 0565 C        	INC                 CH_NO
   300 004CD 0425 C        	MOV                 A,CH_NO
   301 004CE 1D4B C        	SUB                 A,@ChannelSum
   302 004CF 0E03 C        	JBS                 STATUS,C
   303 004D0 00E5 C        	CLR                 CH_NO
   304 004D1 00D7 C        	CLR                 ComuClock
   305 004D2 0000 C        	NOP
   306 004D3 1E00 C        	BANK                0
   307            C        
   308            C        ;---------------------------- LED Control --------------------------------
   309 004D4 0F5F C        	JBS                 ForceLinkModeFlag/8,ForceLinkModeFlag%8
   310 004D5 14D7 C        	JMP                 LED_NormalSearch
   311 004D6 14E1 C        	JMP                 LED_ForcelinkSearch
   312 004D7      C        LED_NormalSearch:
   313 004D7 1E02 C        	BANK                2
   314 004D8 042F C        	MOV                 A,LEDSystemTimeCNT
   315 004D9 1D32 C        	SUB                 A,@LEDTwinklingFreq   ; Control key scan clock
   316 004DA 0C03 C        	JBC                 STATUS,C
   317 004DB 14E2 C        	JMP                 LED_End_Control
   318 004DC 00EF C        	CLR                 LEDSystemTimeCNT
   319 004DD 1E00 C        	BANK                0
   320 004DE 1802 C        	MOV                 A,@0B00000010         ; P81 exchange when Timeout
   321 004DF 0348 C        	XOR                 PORT8,A
   322 004E0 14E2 C        	JMP                 LED_End_Control
   323 004E1      C        LED_ForcelinkSearch:
   324 004E1 0A48 C        	BS                  LED1_STATUS/8,LED1_STATUS%8		;PORT81
   325 004E2      C          LED_End_Control:
   326 004E2 0000 C        	NOP
   327            C        ;--------------------------------------------------------------------------
   328            C        
   329 004E3 1E00 C        	BANK                0
   330 004E4 091D C        	BC                  ReadLengthError/8,ReadLengthError%8
   331 004E5 00DA C        	CLR                 Databytelength
   332 004E6 00E1 C        	CLR                 RX_IDH_Buffer
   333 004E7 00E2 C        	CLR                 RX_IDL_Buffer
   334 004E8 00E3 C        	CLR                 CHN_FLAG_Buffer
   335 004E9 00E4 C        	CLR                 GamePadsSum_Buffer
   336 004EA 00E7 C        	CLR                 TX_ID_Buffer
   337 004EB 0000 C        	NOP
   338 004EC 0000 C        	NOP
   339 004ED 140B C        	JMP                 Search_Start_up
   340            C        
   341            C        ;**********************************************************************************
   342            C        ;*********************************************************************************
   343            C        ; FCC test mode frequency index
   344            C        ;*********************************************************************************
   345 004EE      C        Click_Select:
   346 004EE 1E02 C        	BANK                2
   347 004EF 00F8 C        	CLR                 KEY_NUM
   348 004F0 08DE C        	BC                  KeyScanFinishFlag/8,KeyScanFinishFlag%8
   349 004F1 0F9F C        	JBS                 FccTestModeFlag/8,FccTestModeFlag%8
   350 004F2 141D C        	JMP                 Keystoke_No_Press
   351 004F3 0559 C        	INC                 FccFreqIndex
   352 004F4 0419 C        	MOV                 A,FccFreqIndex
   353 004F5 1D0F C        	SUB                 A,@0X0F
   354 004F6 0E03 C        	JBS                 STATUS,C
   355 004F7 00D9 C        	CLR                 FccFreqIndex
   356 004F8 141D C        	JMP                 Keystoke_No_Press
   357            C        
   358            C        ;**********************************************************************************
   359            C        ;*********************************************************************************
   360            C        ; Into FCC mode
   361            C        ;*********************************************************************************
   362 004F9      C        Lasting_Press_Select:
   363 004F9 1E02 C        	BANK                2
   364 004FA 00F8 C        	CLR                 KEY_NUM
   365 004FB 08DE C        	BC                  KeyScanFinishFlag/8,KeyScanFinishFlag%8
   366            C        	;LCALL               FccSearchLinkMode_Set
   367            C        	;BC                  LinkModeFlag/8,LinkModeFlag%8
   368            C        	;BS                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   369 004FC 099F C        	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   370 004FD 0000 C        	NOP
   371 004FE 140B C        	JMP                 Search_Start_up
   372            C        
   373            C        ;**********************************************************************************
   374            C        ;*********************************************************************************
   375            C        ; Into force link mode
   376            C        ;*********************************************************************************
   377 004FF      C        Dblclick_Select:                                  ; Into Forcelink Mode:
   378 004FF 1E02 C        	BANK                2
   379 00500 00F8 C        	CLR                 KEY_NUM
   380 00501 08DE C        	BC                  KeyScanFinishFlag/8,KeyScanFinishFlag%8
   381 00502 1E01 C        	BANK                1
   382 00503 1EA0 C        	LCALL               SearchForceLinkMode_Set
   382 00504 0303 C        	LCALL               SearchForceLinkMode_Set
   383 00505 091F C        	BC                  LinkModeFlag/8,LinkModeFlag%8
   384 00506 0B5F C        	BS                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   385 00507 099F C        	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   386            C        
   387 00508 189D C        	MOV                 A,@RX_IDH_DEFAULT         ; Address , default value 0X0DB3
   388 00509 0061 C        	MOV                 RX_IDH,A
   389 0050A 18CB C        	MOV                 A,@RX_IDL_DEFAULT
   390 0050B 0062 C        	MOV                 RX_IDL,A
   391 0050C 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   391 0050D 0F11 C        	LCALL               CHANGE_ADDRESS_VALUE
   392 0050E 0000 C        	NOP
   393 0050F 00D7 C        	CLR                 ComuClock
   394            C        
   395            C        	;BANK                0
   396            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   397            C        	;XOR                 PORT8,A
   398            C        
   399 00510 1400 C        	JMP                 Search_Equipment
   400            C        
   401            C        ;---------------------------------------------------------------
   402 00511      C        Write_EEprom_Task:
   403 00511 0000 C        	NOP
   404 00512 0011 C        	DISI
   405 00513 0000 C        	NOP
   406 00514 1E01 C        	BANK                1
   407 00515 0421 C        	MOV                 A,RX_IDH         ; Read ID
   408 00516 1E00 C        	BANK                0
   409 00517 0061 C        	MOV                 RX_IDH_Buffer,A
   410 00518 1E01 C        	BANK                1
   411 00519 0422 C        	MOV                 A,RX_IDL
   412 0051A 1E00 C        	BANK                0
   413 0051B 0062 C        	MOV                 RX_IDL_Buffer,A
   414 0051C 1E01 C        	BANK                1
   415 0051D 0424 C        	MOV                 A,GamePadsSum
   416 0051E 1E00 C        	BANK                0
   417 0051F 0064 C        	MOV                 GamePadsSum_Buffer,A
   418 00520 1E01 C        	BANK                1
   419 00521 0426 C        	MOV                 A,TX_ID
   420 00522 1E00 C        	BANK                0
   421 00523 0067 C        	MOV                 TX_ID_Buffer,A
   422 00524 0000 C        	NOP
   423            C        
   424 00525 1EA0 C        	LCALL               IO_93C46_INITIAL
   424 00526 101F C        	LCALL               IO_93C46_INITIAL
   425 00527 0000 C        	NOP
   426            C      M 	mEWEN                                      ; Enable
       00528 1EA0     1     LCALL  START_BIT ,
       00529 1000     1     LCALL  START_BIT ,
       0052A 1830     1     MOV A,@( EWEN )
       0052B 0051     1     MOV  R_ACC1 ,A
       0052C 1809     1     MOV A,@( 9 )
       0052D 1EA0     1     LCALL  RL_COMD ,
       0052E 100E     1     LCALL  RL_COMD ,
       0052F 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       00530 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00531 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
   427 00532 1800 C        	MOV                 A,@0X00
   428 00533 0055 C        	MOV                 DataAddressInEEPROM,A
   429 00534 1860 C        	MOV                 A,@0X60
   430 00535 0054 C        	MOV                 DataAddressInMCU,A
   431            C      M  	mWRITE              DataAddressInEEPROM,@0,DataAddressInMCU,@16
       00536 1E00     1     BANK @( 0 ),
       00537 0414     1     MOV A, DATAADDRESSINMCU 
       00538 0044     1     MOV  R4 ,A
       00539 1810     1     MOV A,@( 16 )
       0053A 0053     1     MOV  R_ACC3 ,A
       0053B          1    ??0025$WRITE_DATA:   
       0053B 1EA0     1     LCALL  START_BIT ,
       0053C 1000     1     LCALL  START_BIT ,
       0053D 0803     1     BC  STATUS , C 
       0053E 0615     1     RRCA  DATAADDRESSINEEPROM ,
       0053F 1940     1     OR A,@( WRITE )
       00540 0051     1     MOV  R_ACC1 ,A
       00541 1808     1     MOV A,@( 8 )
       00542 1EA0     1     LCALL  RL_COMD ,
       00543 100E     1     LCALL  RL_COMD ,
       00544 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00545 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       00546 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       00547 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       00548 0B4A     1     BS ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       00549 154A     1     JMP ( $ + 1 ),
       0054A 0B8A     1     BS ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       0054B 0555     1     INC  DATAADDRESSINEEPROM ,
       0054C          1    ??0025$DATA_H_L:   
       0054C 0400     1     MOV A, R0 
       0054D 0051     1     MOV  R_ACC1 ,A
       0054E 0544     1     INC  R4 ,
       0054F 1808     1     MOV A,@( 8 )
       00550 1EA0     1     LCALL  RL_COMD ,
       00551 100E     1     LCALL  RL_COMD ,
       00552 1553     1     JMP ( $ + 1 ),
       00553 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       00554 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00555 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       00556 1557     1     JMP ( $ + 1 ),
       00557 0B8A     1     BS ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00558 0AC7     1     BS ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       00559 0F0A     1     JBS ( SPI_MISO / 8 ),( SPI_MISO % 8 )
       0055A 1559     1     JMP ( $ - 1 ),
       0055B 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       0055C 05D3     1     DJZ  R_ACC3 ,
       0055D 153B     1     JMP  ??0025$WRITE_DATA ,
   432            C      M  	mEWDS                                      ; disable
       0055E 1EA0     1     LCALL  START_BIT ,
       0055F 1000     1     LCALL  START_BIT ,
       00560 1800     1     MOV A,@( EWDS )
       00561 0051     1     MOV  R_ACC1 ,A
       00562 1809     1     MOV A,@( 9 )
       00563 1EA0     1     LCALL  RL_COMD ,
       00564 100E     1     LCALL  RL_COMD ,
       00565 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       00566 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00567 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
   433 00568 0000 C         	NOP
   434 00569 1EA0 C         	LCALL               IO_93C46_QUIT
   434 0056A 102A C         	LCALL               IO_93C46_QUIT
   435 0056B 1EA0 C        	LCALL               Enter_StandbyII_Mode
   435 0056C 0EB3 C        	LCALL               Enter_StandbyII_Mode
   436 0056D 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   436 0056E 0F11 C        	LCALL               CHANGE_ADDRESS_VALUE
   437            C         	;BANK                0
   438            C        	;MOV                 A,@0x07
   439            C        	;MOV                 TWTCR,A
   440 0056F 0000 C        	NOP
   441 00570 0010 C        	ENI
   442 00571 00D7 C        	CLR                 ComuClock
   443 00572 00D8 C        	CLR                 ComuCycleNum
   444 00573 00D9 C        	CLR                 ComuEndNum
   445 00574 00DF C        	CLR                 CommuStatusFlag
   446 00575 00DD C        	CLR                 GeneralStatusFlag1
   447 00576 00DE C        	CLR                 GeneralStatusFlag2
   448 00577 00E3 C        	CLR                 CHN_FLAG
   449            C        	;LCALL               SearchLinkMode_Set
   450 00578 0A1F C        	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   451 00579 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   452 0057A 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   453 0057B 0B1F C        	BS                  LinkModeFlag/8,LinkModeFlag%8
   454 0057C 095F C        	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   455 0057D 099F C        	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   456            C          if EEPROM_T_DEBUG & EEPROM_DEBUG & DebugDisplay == 1
   457            C        	BANK                0
   458            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   459            C        	XOR                 PORT8,A
   460            C          endif
   461 0057E 1E00 C        	BANK                0
   462 0057F 0BCA C        	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   463 00580 08C7 C        	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   464 00581 0A0A C        	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   465 00582 0004 C        	WDTC
   466            C        	;BANK                0
   467            C        	;MOV                 A,@0x07               ; N=250,P=256,f=8MHz ==> T=8ms
   468            C        	;MOV                 TWTCR,A
   469 00583 1883 C        	MOV                 A,@(256-125)           ; load initial value
   470 00584 0041 C        	MOV                 TCC,A
   471            C        	;LCALL               RF_FREQ_SET
   472 00585 1EA0 C        	LCALL               RESET_RF_FIFO
   472 00586 0DC8 C        	LCALL               RESET_RF_FIFO
   473 00587 1EA0 C        	LCALL               Enter_StandbyII_Mode
   473 00588 0EB3 C        	LCALL               Enter_StandbyII_Mode
   474 00589 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   474 0058A 0E52 C        	LCALL               ENTER_RX_BUFFER_NACK
   475 0058B 140B C        	JMP                 Search_Start_up
   476 0058C 0000 C        	NOP
   477            C        
   478            C        ;**********************************************************************************
   479            C        ;*************************************************************************
   480            C        ; Normal communicate
   481            C        ;*************************************************************************
   482            C        	ORG                 0X800   ; PAGE 2
   483 00800      C        Normal_Communicate:
   484 00800 0004 C        	WDTC
   485 00801 00D7 C        	CLR                 ComuClock
   486 00802 1E01 C        	BANK                1
   487 00803 0425 C        	MOV                 A,CH_NO
   488 00804 1D4B C        	SUB                 A,@ChannelSum
   489 00805 0E03 C        	JBS                 STATUS,C
   490 00806 00E5 C        	CLR                 CH_NO
   491 00807 1EA0 C        	LCALL               RF_FREQ_SET
   491 00808 0EF9 C        	LCALL               RF_FREQ_SET
   492 00809 1EA0 C        	LCALL               RESET_RF_FIFO
   492 0080A 0DC8 C        	LCALL               RESET_RF_FIFO
   493 0080B 10F9 C        	CALL                Sampling_Task
   494            C        
   495            C        ;-------------------------------------------------------------------------------
   496 0080C 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   497 0080D 1D02 C        	SUB                 A,@DelayTime
   498 0080E 0C03 C        	JBC                 STATUS,C
   499 0080F 140C C        	JMP                 $-3
   500            C        ;-------------------------------------------------------------------------------
   501            C        
   502            C        	;LCALL               Enter_StandbyII_Mode
   503 00810 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   503 00811 0E52 C        	LCALL               ENTER_RX_BUFFER_NACK
   504 00812 1E00 C        	BANK                0
   505            C        
   506 00813      C        Waiting_For_NormalData_arrive:
   507 00813 0417 C        	MOV                 A,ComuClock                    ; "T=SetComuTime" a cycle ,
   508 00814 1D03 C        	SUB                 A,@(SetComuSyncTime-1)            ; CMD time, "T=SetComuTime"
   509 00815 0E03 C        	JBS                 STATUS,C                       ; Sync Timing no recive any data
   510 00816 14D6 C        	JMP                 LoseFrameStatus_Timeout        ; RX1  ; Timeout but have not received TX data
   511 00817 0E0B C        	JBS                 PKT_FLAG/8,PKT_FLAG%8	       ; 1:TX data receive finished  0:wating PKT pull high
   512 00818 1413 C        	JMP                 Waiting_For_NormalData_arrive
   513            C        ;-----------------------------------------------------------------------------------
   514 00819 1E00 C        	BANK                0
   515            C        	;MOV                 A,@0x07                       ; N=31,P=256,f=8MHz ==> T=1ms
   516            C        	;MOV                 TWTCR,A
   517 0081A 18E1 C        	MOV                 A,@(256-31)           ;Rload TCC value
   518 0081B 0041 C        	MOV                 TCC,A                  ;adjust time by PKT sync
   519 0081C 00D7 C        	CLR                 ComuClock
   520            C          if COMMU_T_DEBUG & COMMU_DEBUG & DebugDisplay == 1
   521 0081D 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   522 0081E 0348 C        	XOR                 PORT8,A
   523            C          endif
   524 0081F 1EA0 C        	LCALL               READ_FIFO_RAM
   524 00820 0D99 C        	LCALL               READ_FIFO_RAM
   525 00821 1EA0 C        	LCALL               RESET_RF_FIFO
   525 00822 0DC8 C        	LCALL               RESET_RF_FIFO
   526 00823 1EA0 C        	LCALL               Enter_StandbyI_Mode
   526 00824 0E9E C        	LCALL               Enter_StandbyI_Mode
   527 00825 0D1D C        	JBC                 ReadLengthError/8,ReadLengthError%8
   528 00826 14D6 C        	JMP                 LoseFrameStatus_Timeout
   529            C        
   530            C        ;------------------- check sync imformation ---------------------
   531 00827 1E01 C        	BANK                1
   532 00828 0421 C        	MOV                 A,RX_IDH
   533 00829 1E00 C        	BANK                0
   534 0082A 0361 C        	XOR                 RX_IDH_Buffer,A
   535 0082B 0E83 C        	JBS                 STATUS,Z
   536 0082C 14D6 C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   537 0082D 1E01 C        	BANK                1
   538 0082E 0422 C        	MOV                 A,RX_IDL
   539 0082F 1E00 C        	BANK                0
   540 00830 0362 C        	XOR                 RX_IDL_Buffer,A
   541 00831 0E83 C        	JBS                 STATUS,Z
   542 00832 14D6 C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   543            C        ;------------------------------------------------------------------
   544 00833 1E01 C        	BANK                1
   545            C        	;LCALL               NormalLinkMode_Set
   546 00834 081F C        	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;Clear search status
   547 00835 0A5F C        	BS                  NormalStatusFlag/8,NormalStatusFlag%8            ;set normal mode
   548 00836 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   549 00837 0B1F C        	BS                  LinkModeFlag/8,LinkModeFlag%8
   550 00838 095F C        	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   551 00839 099F C        	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   552 0083A 00F2 C        	CLR                 LossframeCNT
   553            C        
   554            C        	;RRCA                ComuEndNum
   555            C        	;MOV                 TEMP,A
   556            C        	;MOV                 A,ComuCycleNum
   557            C        	;SUB                 A,TEMP
   558            C        	;JBS                 STATUS,C
   559            C        	;CALL                Sampling_Task
   560            C        ;-------------------------------------------------------------------------------
   561 0083B 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   562 0083C 0118 C        	SUB                 A,ComuCycleNum
   563 0083D 0C03 C        	JBC                 STATUS,C
   564 0083E 143B C        	JMP                 $-3
   565            C        ;-------------------------------------------------------------------------------
   566            C        	;RRCA                ComuEndNum
   567            C        	;MOV                 TEMP,A
   568            C        	;MOV                 A,ComuCycleNum
   569            C        	;SUB                 A,TEMP
   570            C        	;JBC                 STATUS,C
   571            C        	;CALL               Sampling_Task
   572            C        
   573            C        ;------------------ sleep status judge --------------------------
   574 0083F      C        NormalSleep_Status_Judge:
   575 0083F 1E02 C        	BANK                2
   576 00840 0420 C        	MOV                 A,DataA
   577 00841 0321 C        	XOR                 A,DataB
   578 00842 0322 C        	XOR                 A,DataC
   579 00843 0323 C        	XOR                 A,DataD
   580 00844 0324 C        	XOR                 A,DataE
   581 00845 0325 C        	XOR                 A,DataF
   582 00846 0326 C        	XOR                 A,DataG
   583 00847 0050 C        	MOV                 TEMP,A
   584 00848 032B C        	XOR                 A,KeyCheckBakup
   585 00849 0E83 C        	JBS                 STATUS,Z
   586 0084A 145D C        	JMP                 NormalSleep_Status_Judge_End1
   587            C        
   588 0084B 041C C        	MOV                 A,SleepCNT
   589 0084C 1DFA C        	SUB                 A,@SetSleepTime        ;
   590 0084D 0C03 C        	JBC                 STATUS,C
   591 0084E 145E C        	JMP                 NormalSleep_Status_Judge_End2
   592 0084F 0A5D C        	BS                  IntoSleepFlag/8,IntoSleepFlag%8
   593 00850 00DC C        	CLR                 SleepCNT
   594            C          if SLEEP_T_DEBUG & SLEEP_DEBUG & DebugDisplay == 1
   595            C        	BANK                0
   596            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   597            C        	XOR                 PORT8,A
   598            C          endif
   599            C        	;LCALL               SearchLinkMode_Set
   600 00851 0A1F C        	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   601 00852 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   602 00853 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8
   603 00854 00D7 C        	CLR                 ComuClock
   604 00855 00E5 C        	CLR                 CH_NO
   605 00856 1E00 C        	BANK                0
   606 00857 08C7 C        	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   607 00858 0A0A C        	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   608 00859 1EA0 C        	LCALL               Enter_StandbyII_Mode
   608 0085A 0EB3 C        	LCALL               Enter_StandbyII_Mode
   609 0085B 0000 C        	NOP
   610 0085C 0012 C        	RET
   611 0085D      C          NormalSleep_Status_Judge_End1:
   612 0085D 00DC C        	CLR                 SleepCNT
   613 0085E      C          NormalSleep_Status_Judge_End2:
   614 0085E 0410 C        	MOV                 A,TEMP
   615 0085F 006B C        	MOV                 KeyCheckBakup,A
   616            C        
   617            C        ;===================================================================
   618            C            ;MOV                 A,@14                         ;Transmitter data ,7 byte
   619            C            ;MOV                 Databytelength,A
   620            C      M     Clearbuffer
       00860 18E0     1     MOV A,@( 224 )
       00861 0044     1     MOV  R4 ,A
       00862 1E00     1     BANK  0 ,
       00863 0004     1     WDTC 
       00864 00C0     1     CLR  R0 ,
       00865 0544     1     INC  R4 ,
       00866 183F     1     MOV A,@( 63 )
       00867 0284     1     AND A, R4 
       00868 1B3F     1     XOR A,@( 63 )
       00869 0E83     1     JBS  R3 , Z 
       0086A 1463     1     JMP ( $ - 7 ),
       0086B 00C0     1     CLR  R0 ,
       0086C 18C0     1     MOV A,@( 192 )
       0086D 0044     1     MOV  R4 ,A
   621 0086E 1E01 C            BANK                1
   622 0086F 0421 C            MOV                 A,RX_IDH                     ;sync header
   623 00870 1E00 C            BANK                0
   624 00871 0061 C            MOV                 RX_IDH_Buffer,A
   625 00872 1E01 C            BANK                1
   626 00873 0422 C            MOV                 A,RX_IDL
   627 00874 1E00 C            BANK                0
   628 00875 0062 C            MOV                 RX_IDL_Buffer,A
   629 00876 1E01 C            BANK                1
   630 00877 0423 C            MOV                 A,CHN_FLAG
   631 00878 1E00 C            BANK                0
   632 00879 0063 C            MOV                 CHN_FLAG_Buffer,A
   633 0087A 1E01 C            BANK                1
   634 0087B 0424 C            MOV                 A,GamepadsSum
   635 0087C 1E00 C            BANK                0
   636 0087D 0064 C            MOV                 GamepadsSum_Buffer,A
   637 0087E 041F C            MOV                 A,CommuStatusFlag
   638 0087F 0065 C            MOV                 CommuStatusFlag_Buffer,A
   639 00880 1E01 C            BANK                1
   640 00881 0425 C            MOV                 A,CH_NO
   641 00882 1E00 C            BANK                0
   642 00883 0066 C            MOV                 CH_NO_Buffer,A
   643 00884 1E01 C            BANK                1
   644 00885 0426 C            MOV                 A,TX_ID
   645 00886 1E00 C            BANK                0
   646 00887 0067 C            MOV                 TX_ID_Buffer,A
   647            C        
   648 00888 1E02 C            BANK                2                            ;Data output
   649 00889 0420 C            MOV                 A,DataA
   650 0088A 1E00 C            BANK                0
   651 0088B 0068 C            MOV                 DataA_Buffer,A
   652 0088C 1E02 C            BANK                2
   653 0088D 0421 C            MOV                 A,DataB
   654 0088E 1E00 C            BANK                0
   655 0088F 0069 C            MOV                 DataB_Buffer,A
   656 00890 1E02 C            BANK                2
   657 00891 0422 C            MOV                 A,DataC
   658 00892 1E00 C            BANK                0
   659 00893 006A C            MOV                 DataC_Buffer,A
   660 00894 1E02 C        	BANK                2
   661 00895 0423 C            MOV                 A,DataD
   662 00896 1E00 C            BANK                0
   663 00897 006B C            MOV                 DataD_Buffer,A
   664 00898 1E02 C            BANK                2
   665 00899 0424 C            MOV                 A,DataE
   666 0089A 1E00 C            BANK                0
   667 0089B 006C C            MOV                 DataE_Buffer,A
   668 0089C 1E02 C            BANK                2
   669 0089D 0425 C            MOV                 A,DataF
   670 0089E 1E00 C            BANK                0
   671 0089F 006D C            MOV                 DataF_Buffer,A
   672 008A0 1E02 C            BANK                2
   673 008A1 0426 C            MOV                 A,DataG
   674 008A2 1E00 C            BANK                0
   675 008A3 006E C            MOV                 DataG_Buffer,A
   676            C        
   677 008A4 1E05 C            BANK                5
   678 008A5 043D C            MOV                 A,CMOS_xAxisL
   679 008A6 1E00 C            BANK                0
   680 008A7 006F C            MOV                 CMOS_xAxisL_Buffer,A
   681 008A8 1E05 C            BANK                5
   682 008A9 043E C            MOV                 A,CMOS_yAxisL
   683 008AA 1E00 C            BANK                0
   684 008AB 0070 C            MOV                 CMOS_yAxisL_Buffer,A
   685 008AC 1E05 C            BANK                5
   686 008AD 042F C            MOV                 A,CMOS_yxsAxisH
   687 008AE 1E00 C            BANK                0
   688 008AF 0071 C            MOV                 CMOS_yxsAxisH_Buffer,A
   689            C        
   690 008B0 1E07 C        	BANK                7
   691 008B1 0430 C        	MOV                 A,GS_xAxisL
   692 008B2 1E00 C        	BANK                0
   693 008B3 0072 C        	MOV                 GS_xAxisL_Buffer,A            ; GS x Axis low byte
   694 008B4 1E07 C        	BANK                7
   695 008B5 0431 C        	MOV                 A,GS_yAxisL
   696 008B6 1E00 C        	BANK                0
   697 008B7 0073 C        	MOV                 GS_yAxisL_Buffer,A            ; GS y Axis low byte
   698 008B8 1E07 C        	BANK                7
   699 008B9 0432 C        	MOV                 A,GS_zAxisL
   700 008BA 1E00 C        	BANK                0
   701 008BB 0074 C        	MOV                 GS_zAxisL_Buffer,A            ; GS z Axis low byte
   702 008BC 1E07 C        	BANK                7
   703 008BD 0433 C        	MOV                 A,GS_xyzAxisH
   704 008BE 1E00 C        	BANK                0
   705 008BF 0075 C        	MOV                 GS_xyzAxisH_Buffer,A          ; GS xyz Axis low byte
   706            C        
   707 008C0 1812 C        	MOV                 A,@SetChecksumH
   708 008C1 007E C        	MOV                 ChecksumH,A
   709 008C2 1834 C        	MOV                 A,@SetChecksumL
   710 008C3 007F C        	MOV                 ChecksumL,A
   711            C        
   712 008C4 1EA0 C        	LCALL               Enter_StandbyII_Mode
   712 008C5 0EB3 C        	LCALL               Enter_StandbyII_Mode
   713 008C6 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   713 008C7 0DD1 C        	LCALL               Enter_TX_Buffer_ACK
   714 008C8 1EA0 C        	LCALL               Write_FIFO_RAM
   714 008C9 0DB0 C        	LCALL               Write_FIFO_RAM
   715 008CA 1EA0 C        	LCALL               RESET_RF_FIFO
   715 008CB 0DC8 C        	LCALL               RESET_RF_FIFO
   716 008CC 1EA0 C        	LCALL               Enter_StandbyII_Mode
   716 008CD 0EB3 C        	LCALL               Enter_StandbyII_Mode
   717 008CE 0000 C        	NOP
   718            C        
   719            C        ;--------------------------- Wating a cycle end --------------------------------------
   720 008CF 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   721 008D0 0119 C        	SUB                 A,ComuEndNum
   722 008D1 0C03 C        	JBC                 STATUS,C
   723 008D2 14CF C        	JMP                 $-3
   724            C        ;--------------------------------------------------------------------------------------
   725 008D3 0000 C        	NOP
   726 008D4 0000 C        	NOP
   727 008D5 1400 C        	JMP                 Normal_Communicate    ; a cycle End
   728            C        
   729            C        ;============================================================================================
   730 008D6      C        LoseFrameStatus_Timeout:
   731 008D6 00D7 C        	CLR                 ComuClock
   732 008D7 0419 C        	MOV                 A,ComuEndNum
   733 008D8 0117 C        	SUB                 A,ComuClock                       ;2ms a cycle ,
   734 008D9 0C03 C        	JBC                 STATUS,C
   735 008DA 14D7 C        	JMP                 $-3
   736 008DB 0000 C        	NOP
   737 008DC      C        LoseFrameStatus_RXID_Error:
   738 008DC 1E00 C        	BANK                0
   739 008DD 091D C        	BC                  ReadLengthError/8,ReadLengthError%8
   740 008DE 00DA C        	CLR                 Databytelength
   741 008DF 00E1 C        	CLR                 RX_IDH_Buffer
   742 008E0 00E2 C        	CLR                 RX_IDL_Buffer
   743 008E1 00E3 C        	CLR                 CHN_FLAG_Buffer
   744 008E2 00E4 C        	CLR                 GamePadsSum_Buffer
   745 008E3 00E7 C        	CLR                 TX_ID_Buffer
   746 008E4 1E01 C        	BANK                1
   747            C        	;LCALL               LoseFrameLinkMode_Set
   748 008E5 081F C        	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   749 008E6 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   750 008E7 0A9F C        	BS                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8
   751 008E8 0432 C        	MOV                 A,LossframeCNT                    ;LossframeCNT>1 stand for loss frequency
   752 008E9 1D03 C        	SUB                 A,@LossframeSum
   753 008EA 0E03 C        	JBS                 STATUS,C
   754 008EB 14EE C        	JMP                 LoseFreqStatus_Timeout
   755 008EC 0572 C        	INC                 LossframeCNT
   756 008ED 1400 C        	JMP                 Normal_Communicate
   757            C        
   758 008EE      C        LoseFreqStatus_Timeout:
   759            C        	;LCALL               SearchLinkMode_Set
   760 008EE 0A1F C        	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   761 008EF 085F C        	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   762 008F0 089F C        	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8
   763 008F1 1E01 C        	BANK                1
   764 008F2 00D7 C        	CLR                 ComuClock
   765 008F3 00D8 C        	CLR                 ComuCycleNum
   766 008F4 00D9 C        	CLR                 ComuEndNum
   767 008F5 00F2 C        	CLR                 LossframeCNT
   768 008F6 00E3 C        	CLR                 CHN_FLAG
   769 008F7 0012 C        	RET                                       ; return to search status
   770 008F8 0000 C        	NOP
   771            C        
   772            C        ;==========================================================================
   773            C        ; data Sampling function
   774            C        ;==========================================================================
   775 008F9      C        Sampling_Task:
   776 008F9 1EA0 C        	LCALL               Key_Scan              ; get key data
   776 008FA 10B0 C        	LCALL               Key_Scan              ; get key data
   777            C        
   778 008FB 0000 C        	NOP
   779 008FC 0012 C        	RET
   780            C        
   781            C        
   782            C        
    19                     include "XX93C46_For_EM78P520.ASM"
     1            C        ;***********************************************************************;
     2            C        ; Tilte: Em78x510x spi FOR AT93C46 Function macro Code                  ;
     3            C        ; Description:                                  ;
     4            C        ;     1."mEWEN"  /                                    ;
     5            C        ;     2."mEWDS"  /                                    ;
     6            C        ;     3."mWRITE"    ;
     7            C        ;     4."mREAD"                         ;
     8            C        ;     5."mERASE"                    ;
     9            C        ;     6."mERAL"  "FF"             ;
    10            C        ;     7."mWRAL"                             ;
    11            C        ; Company: Elan Corp. Inc                                               ;
    12            C        ; Author:  yu.wei                                                     ;
    13            C        ; Date:    2009.3.20                                                    ;
    14            C        ; Version: v1.0                                                         ;
    15            C        ;                         ;
    16            C        ;***********************************************************************
    17            C        ;
    18            C        ;    1. 8bit;
    19            C        ;------------------------------------------------------
    20            C        ; spi          Port Used For 93C46 Control.
    21            C        ; cs           Port Pin Tied To cs On 93C46.
    22            C        ; sk           Port Pin Tied To sk On 93C46.
    23            C        ; di           Port Pin Tied To di On 93C46.
    24            C        ; DO           Port Pin Tied To DO On 93C46.
    25            C        ; r_acc1     This Register Contains The 2 Bit 93C46
    26            C        ;              Command Is The High 2 Bit Positions And
    27            C        ;              memory Address In The Lower 6.
    28            C        ;--------------------------------------------------
    29            C        ;Instruction   SB    Op Code     Address               Data
    30            C        ;                               x8       x16       x8       x16
    31            C        ;    READ       1      10 	A6 - A0  A5 - A0
    32            C        ;    EWEN       1 	   00     11XXXXX  11XXXX
    33            C        ;    ERASE      1      11     A6 - A0  A5 - A0
    34            C        ;    WRITE      1 	   01 	A6 - A0  A5 - A0   D7 - D0  D15- D0
    35            C        ;    ERAL       1 	   00 	10XXXXX  10XXXX
    36            C        ;    WRAL       1 	   00 	01XXXXX  01XXXX    D7 - D0  D15- D0
    37            C        ;    EWDS       1 	   00 	00XXXXX  00XXXX
    38            C        ;=================================================================================
    39            C        
    40            C        XX93C46_For_EM78P520.ASM       EQU        XX93C46_For_EM78P510.ASM
    41            C        include "XX93C46_For_EM78P520.H"
     1            C        ;---------------------------------------------------
     2            C        XX93C46_For_EM78P510.H       EQU        XX93C46_For_EM78P510.H
     3            C        
     4            C        ;---------------------------------------------------
     5            C        ;  93C46 INSTRUCTION  COmmAND
     6            C        ;--------------------------------------------------
     7       0080 C                READ        EQU     0X80    ;93C46 Read Command.
     8       0040 C                WRITE       EQU     0X40    ;93C46 Write Command.
     9       00C0 C                ERASE       EQU     0XC0    ;93C46 Erase Command.
    10       0030 C                EWEN        EQU     0X30    ;93C46 Erase/Write Enable Command.
    11       0000 C                EWDS        EQU     0X00    ;93C46 Erase/Write Disable Command.
    12       0020 C                ERAL        EQU     0X20    ;92C46 Erase All Command.
    13       0010 C                WRAL        EQU     0X10    ;92C46 Write All Command.
    14            C        ;--------------------------------------------------
    42            C        
    43            C        ifndef EM78CtrlIns.H
    44            C        include "EM78CtrlIns.H"
    45            C        endif
    46            C        ;--------------------------------------------------
    47            C        
    48            C                ORG     0X1000
    49            C        ;***********************************************************************;
    50            C        ;Program name: mEWEN m,spi    m 8BIT16BIT               ;
    51            C        ;Description:  /                                ;
    52            C        ;Input:         m==8m==16  m                  ;
    53            C        ;              spics,sk,di,DO                               ;
    54            C        ;Output:       /                                          ;
    55            C        ;Variable Register:None                                                 ;
    56            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    57            C        ;***********************************************************************;
    58            C        mEWEN   MACRO
    59            C                LCALL   Start_Bit       ;load start bit
    60            C                MOV     A,@ewen         ;enable erase/write
    61            C                MOV     r_acc1,A
    62            C                ;
    63            C                MOV     A,@9
    64            C                ;
    65            C                LCALL    Rl_Comd         ;finish enable erase/write
    66            C                BC      AT93C46_CS/8,AT93C46_CS%8          ;load end bit
    67            C                BC      SPI_CLK/8,SPI_CLK%8
    68            C                BC      SPI_MOSI/8,SPI_MOSI%8
    69            C                ENDM
    70            C        ;
    71            C        ;***********************************************************************;
    72            C        ;Program name:  mEWDS m,spi    m 8BIT16BIT              ;
    73            C        ;Description:   /                               ;
    74            C        ;Input:          m==8m==16  m               ;
    75            C        ;               spics,sk,di,DO                              ;
    76            C        ;Output:        /                                         ;
    77            C        ;Variable Register:None                                                 ;
    78            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    79            C        ;***********************************************************************;
    80            C        mEWDS   MACRO
    81            C                LCALL    Start_Bit       ;
    82            C                MOV      A,@ewds         ;
    83            C                MOV      r_acc1,A
    84            C                ;
    85            C                MOV      A,@9
    86            C                ;
    87            C                LCALL    Rl_Comd
    88            C                BC       AT93C46_CS/8,AT93C46_CS%8
    89            C                BC       SPI_CLK/8,SPI_CLK%8
    90            C                BC       SPI_MOSI/8,SPI_MOSI%8          ;
    91            C                ENDM
    92            C        ;
    93            C        ;***********************************************************************;
    94            C        ;Program name:  mWRITE m,DataAddressInEEPROM,k,DataAddressInMCU,spi                            ;
    95            C        ;Description:                                   ;
    96            C        ;Input:         m  m==816                                 ;
    97            C        ;               DataAddressInEEPROM  (93C46      ;
    98            C        ;               k                                   ;
    99            C        ;               DataAddressInMCU  mCU         ;
   100            C        ;               spi  PORTcs,sk,di,DO      ;
   101            C        ;Output:                                      ;
   102            C        ;Variable Register:None                                                 ;
   103            C        ;Register Changed: STATUS,ACC ,
   104            C        ;                  r_acc1(0X21) ,
   105            C        ;                  r_acc2(0X22),         ;
   106            C        ;                  r_acc3(0X23)                                       ;
   107            C        ;***********************************************************************;
   108            C        mWRITE  MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   109            C                BANK    @BankSel
   110            C                MOV     A,DataAddressInMCU    ;0X24mCU
   111            C                MOV     R4,A                   ;
   112            C                MOV     A,@k
   113            C                MOV     r_acc3,A               ;93C46
   114            C        $Write_Data:
   115            C                LCALL    Start_Bit             ;
   116            C               ;
   117            C                BC      STATUS,C
   118            C                RRCA    DataAddressInEEPROM
   119            C                ;
   120            C                OR      A,@write
   121            C                MOV     r_acc1,A               ;
   122            C                MOV     A,@8                   ;93C46
   123            C                LCALL    Rl_Comd               ;
   124            C               ;
   125            C                BC      SPI_CLK/8,SPI_CLK%8
   126            C                JBS     DataAddressInEEPROM,0        ;8BIT
   127            C                BC      SPI_MOSI/8,SPI_MOSI%8
   128            C                JBC     DataAddressInEEPROM,0
   129            C                BS      SPI_MOSI/8,SPI_MOSI%8
   130            C                JMP     $+1
   131            C                BS      SPI_CLK/8,SPI_CLK%8          ;OPADDRESS
   132            C                ;
   133            C                INC     DataAddressInEEPROM
   134            C        $Data_H_L:
   135            C                MOV     A,R0
   136            C                MOV     r_acc1,A      ;
   137            C                INC     R4
   138            C                MOV     A,@8
   139            C                LCALL    Rl_Comd         ;8BIT
   140            C               ;
   141            C                JMP     $+1
   142            C               ;
   143            C                BC      AT93C46_CS/8,AT93C46_CS%8
   144            C                BC      SPI_CLK/8,SPI_CLK%8          ;
   145            C                ;BC      AT93C46_CS/8,AT93C46_CS%8
   146            C                BC      SPI_MOSI/8,SPI_MOSI%8
   147            C                JMP     $+1
   148            C                BS      SPI_CLK/8,SPI_CLK%8
   149            C                BS      AT93C46_CS/8,AT93C46_CS%8          ;
   150            C                JBS     SPI_MISO/8,SPI_MISO%8
   151            C                JMP     $-1
   152            C                BC      AT93C46_CS/8,AT93C46_CS%8
   153            C                DJZ     r_acc3        ;
   154            C                JMP     $Write_Data
   155            C                ENDM
   156            C        ;
   157            C        ;***********************************************************************;
   158            C        ;Program name:  mREAD m,DataAddressInEEPROM,k,DataAddressInMCU,spi                             ;
   159            C        ;Description:   93C46(CPU)          ;
   160            C        ;Input:         m  m==816                                 ;
   161            C        ;               DataAddressInEEPROM  (93C46      ;
   162            C        ;               k                                   ;
   163            C        ;               DataAddressInMCU  mCU         ;
   164            C        ;               spi  PORTcs,sk,di,DO      ;
   165            C        ;Output:                                          ;
   166            C        ;Variable Register:None                                                 ;
   167            C        ;Register Changed: STATUS,ACC ,
   168            C        ;                  r_acc1(0X21) ,
   169            C        ;                  r_acc2(0X22),         ;
   170            C        ;                  r_acc3(0X23)                                       ;
   171            C        ;***********************************************************************;
   172            C        mREAD   MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   173            C                BANK    @BankSel
   174            C                MOV     A,DataAddressInMCU              ;mCU     ;
   175            C                MOV     R4,A
   176            C                MOV     A,@k
   177            C                MOV     r_acc3,A
   178            C        $Write_Data:
   179            C                LCALL    Start_Bit       ;
   180            C               ;
   181            C                RRCA    DataAddressInEEPROM
   182            C                ;
   183            C                OR      A,@READ
   184            C                MOV     r_acc1,A      ;
   185            C                MOV     A,@8            ;93C46
   186            C                LCALL    Rl_Comd         ;
   187            C               ;
   188            C                BC      SPI_CLK/8,SPI_CLK%8
   189            C                JBS     DataAddressInEEPROM,0        ;8BIT
   190            C                BC      SPI_MOSI/8,SPI_MOSI%8
   191            C                JBC     DataAddressInEEPROM,0
   192            C                BS      SPI_MOSI/8,SPI_MOSI%8
   193            C                JMP     $+1
   194            C                BS      SPI_CLK/8,SPI_CLK%8
   195            C               ;
   196            C                INC     DataAddressInEEPROM          ;1
   197            C                BC      SPI_MOSI/8,SPI_MOSI%8
   198            C                JMP     $+1
   199            C                BC      SPI_CLK/8,SPI_CLK%8
   200            C                JMP     $+1
   201            C                JMP     $+1
   202            C                BS      SPI_CLK/8,SPI_CLK%8
   203            C        
   204            C        $Read_Data1:
   205            C                MOV     A,@8
   206            C                MOV     r_acc2,A
   207            C        $Read_Data2:
   208            C                BC      SPI_CLK/8,SPI_CLK%8
   209            C                NOP
   210            C                NOP
   211            C                JBC     SPI_MISO/8,SPI_MISO%8
   212            C                BS      STATUS,C
   213            C                JBS     SPI_MISO/8,SPI_MISO%8
   214            C                BC      STATUS,C
   215            C                RLC     R0
   216            C                BS      SPI_CLK/8,SPI_CLK%8
   217            C                JMP     $+1
   218            C                DJZ     r_acc2
   219            C                JMP     $Read_Data2
   220            C                INC     R4
   221            C                ;
   222            C                NOP
   223            C                ;
   224            C                BC      AT93C46_CS/8,AT93C46_CS%8
   225            C                DJZ     r_acc3
   226            C                JMP     $Write_Data
   227            C                ENDM
   228            C        ;
   229            C        ;***********************************************************************;
   230            C        ;Program name:  mERASE m,DataAddressInEEPROM,k,spi                                   ;
   231            C        ;Description:                                       ;
   232            C        ;Input:         m  m==816                                 ;
   233            C        ;               DataAddressInEEPROM (93C46       ;
   234            C        ;               k                                   ;
   235            C        ;               spi    PORTcs,sk,di,DO    ;
   236            C        ;Output:                                          ;
   237            C        ;Variable Register:None                                                 ;
   238            C        ;Register Changed: STATUS,ACC ,
   239            C        ;                  r_acc1(0X21) ,
   240            C        ;                  r_acc2(0X22),         ;
   241            C        ;                  r_acc3(0X23)                                       ;
   242            C        ;***********************************************************************;
   243            C        mERASE  MACRO    DataAddressInEEPROM,k
   244            C                MOV     A,@k
   245            C                MOV     r_acc3,A      ;93C46
   246            C        $Write_Data:
   247            C                LCALL    Start_Bit       ;
   248            C               ;
   249            C                RRCA    DataAddressInEEPROM
   250            C               ;
   251            C                OR      A,@ERASE
   252            C                MOV     r_acc1,A      ;
   253            C                MOV     A,@8            ;93C46
   254            C                LCALL    Rl_Comd         ;
   255            C                ;
   256            C                BC      SPI_CLK/8,SPI_CLK%8
   257            C                JBS     DataAddressInEEPROM,0        ;8BIT
   258            C                BC      SPI_MOSI/8,SPI_MOSI%8
   259            C                JBC     DataAddressInEEPROM,0
   260            C                BS      SPI_MOSI/8,SPI_MOSI%8
   261            C                JMP     $+1
   262            C                BS      SPI_CLK/8,SPI_CLK%8          ;
   263            C                JMP     $+1
   264            C                JMP     $+1
   265            C               ;
   266            C                INC     DataAddressInEEPROM
   267            C                BC      AT93C46_CS/8,AT93C46_CS%8
   268            C                BC      SPI_CLK/8,SPI_CLK%8
   269            C                BC      SPI_MOSI/8,SPI_MOSI%8
   270            C                JMP     $+1
   271            C                BS      SPI_CLK/8,SPI_CLK%8
   272            C                BS      AT93C46_CS/8,AT93C46_CS%8
   273            C                JBS     SPI_MISO/8,SPI_MISO%8
   274            C                JMP     $-1
   275            C                BC      AT93C46_CS/8,AT93C46_CS%8
   276            C        ;
   277            C                DJZ     r_acc3
   278            C                JMP     $Write_Data
   279            C                ENDM
   280            C        ;
   281            C        ;***********************************************************************;
   282            C        ;Program name:  mERAL m,spi                                             ;
   283            C        ;Description:                                         ;
   284            C        ;Input:         m  m==816                                 ;
   285            C        ;               spi  PORTcs,sk,di,DO      ;
   286            C        ;Output:        FF"                         ;
   287            C        ;Variable Register:None                                                 ;
   288            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   289            C        ;***********************************************************************
   290            C        mERAL   MACRO
   291            C        $Write_Data:
   292            C                LCALL   Start_Bit       ;
   293            C                MOV     A,@ERAL
   294            C                MOV     r_acc1,A      ;
   295            C               ;
   296            C                MOV     A,@9
   297            C               ;
   298            C                LCALL    Rl_Comd
   299            C                BC      AT93C46_CS/8,AT93C46_CS%8
   300            C                BC      SPI_CLK/8,SPI_CLK%8
   301            C                BC      SPI_MOSI/8,SPI_MOSI%8
   302            C                JMP     $+1
   303            C                BS      SPI_CLK/8,SPI_CLK%8
   304            C                BS      AT93C46_CS/8,AT93C46_CS%8
   305            C                JBS     SPI_MISO/8,SPI_MISO%8
   306            C                JMP     $-1
   307            C                BC      AT93C46_CS/8,AT93C46_CS%8
   308            C                ENDM
   309            C        ;
   310            C        ;***********************************************************************;
   311            C        ;Program name:  mWRAL m,DataAddressInMCU,spi                                      ;
   312            C        ;Description:                                 ;
   313            C        ;Input:         m  m==816                                 ;
   314            C        ;               spi  PORTcs,sk,di,DO      ;
   315            C        ;               DataAddressInMCU  mCU         ;
   316            C        ;Output:                                        ;
   317            C        ;Variable Register:None                                                 ;
   318            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   319            C        ;***********************************************************************;
   320            C        mWRAL   MACRO   @DataAddressInMCU
   321            C                MOV     A,@DataAddressInMCU
   322            C                MOV     R4,A            ;
   323            C                LCALL    Start_Bit       ;
   324            C                MOV     A,@WRAL
   325            C                MOV     r_acc1,A      ;
   326            C                ;
   327            C                MOV     A,@9
   328            C                ;
   329            C                LCALL    Rl_Comd
   330            C        $Data_H_L:
   331            C                MOV     A,R0
   332            C                MOV     r_acc1,A      ;
   333            C                INC     R4
   334            C                MOV     A,@8
   335            C                LCALL    Rl_Comd         ;8BIT
   336            C                ;
   337            C                NOP
   338            C                ;
   339            C                BC      SPI_CLK/8,SPI_CLK%8          ;
   340            C                BC      AT93C46_CS/8,AT93C46_CS%8
   341            C                BC      SPI_MOSI/8,SPI_MOSI%8
   342            C                JMP     $+1
   343            C                BS      SPI_CLK/8,SPI_CLK%8
   344            C                BS      AT93C46_CS/8,AT93C46_CS%8          ;
   345            C                JBS     SPI_MISO/8,SPI_MISO%8
   346            C                JMP     $-1
   347            C                BC      AT93C46_CS/8,AT93C46_CS%8
   348            C                BC      SPI_CLK/8,SPI_CLK%8
   349            C                ENDM
   350            C        
   351            C        
   352            C        ;-------------------------------------------------------
   353 01000      C        Start_Bit:
   354 01000 1E00 C        		BANK    @0
   355 01001 08C7 C                BC      AT93C46_CS/8,AT93C46_CS%8
   356 01002 098A C                BC      SPI_CLK/8,SPI_CLK%8
   357 01003 094A C                BC      SPI_MOSI/8,SPI_MOSI%8
   358 01004 1405 C                JMP     $+1
   359 01005 1406 C                JMP     $+1
   360 01006 0AC7 C                BS      AT93C46_CS/8,AT93C46_CS%8
   361 01007 1408 C                JMP     $+1
   362 01008 1409 C                JMP     $+1
   363 01009 0B4A C                BS      SPI_MOSI/8,SPI_MOSI%8       ;PORT6,SPI_MOSI;
   364 0100A 140B C                JMP     $+1
   365 0100B 140C C                JMP     $+1
   366 0100C 0B8A C                BS      SPI_CLK/8,SPI_CLK%8
   367 0100D 0012 C                RET
   368            C        
   369            C        ;--------------------------------------------------------
   370 0100E      C        Rl_Comd:
   371 0100E 005B C        	MOV     DataShiftCNT,A
   372 0100F 1E00 C        	BANK    @0
   373 01010      C        Rl_Comd1:
   374 01010 098A C        	BC      SPI_CLK/8,SPI_CLK%8
   375 01011 1412 C        	JMP     $+1
   376 01012 0803 C        	bc      status,c
   377 01013 06D1 C        	RLC     r_acc1        ;
   378 01014 0E03 C        	JBS     STATUS,C
   379 01015 094A C        	BC      SPI_MOSI/8,SPI_MOSI%8
   380 01016 0C03 C        	JBC     STATUS,C
   381 01017 0B4A C        	BS      SPI_MOSI/8,SPI_MOSI%8
   382 01018 0000 C        	NOP
   383 01019 0000 C        	NOP
   384 0101A 0B8A C        	BS      SPI_CLK/8,SPI_CLK%8
   385 0101B 141C C        	JMP     $+1
   386 0101C 05DB C        	DJZ     DataShiftCNT
   387 0101D 1410 C        	JMP     Rl_Comd1
   388 0101E 0012 C        	RET                   ;    return
   389            C        
   390            C        ;=============== SPI Config for EM78P510====================
   391 0101F      C        IO_93C46_INITIAL:
   392 0101F 1E00 C        	BANK                0
   393 01020 0BCA C        	BS                  SPI_SS/8,SPI_SS%8          ; Disable EM198810
   394 01021 0A0A C        	BS                  CMOS_SS/8,CMOS_SS%8        ; Disable CMOS
   395 01022 0AC7 C        	BS                  AT93C46_CS/8,AT93C46_CS%8   ; Enable 93C46
   396            C        
   397 01023 1E02 C        	BANK                2
   398 01024 040D C        	MOV                 A,SPIC
   399 01025 1E04 C        	BANK                4
   400 01026 0071 C        	MOV                 SPIC_TEMP,A
   401 01027 1E02 C        	BANK                2
   402 01028 00CD C        	CLR                 SPIC
   403 01029 0012 C        	RET
   404            C        
   405 0102A      C        IO_93C46_QUIT:
   406 0102A 1E00 C        	BANK                0
   407            C        	;BS                 SPI_SS/8,SPI_SS%8           ; Disable EM198810
   408            C        	;BS                 CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   409 0102B 08C7 C        	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   410            C        
   411 0102C 1E04 C        	BANK                4
   412 0102D 0431 C        	MOV                 A,SPIC_TEMP
   413 0102E 1E02 C        	BANK                2
   414 0102F 004D C        	MOV                 SPIC,A
   415 01030 0012 C        	RET
    20                     
    21                     
    22                     ;=======================================================================
    23                     ;-------------------------- Program start ---------------------------
    24                     ;=======================================================================
    25                     	ORG                 0X0000
    26 00000 1EB0          	LJMP                INITIAL
    26 00001 012F          	LJMP                INITIAL
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    27                     	ORG                 0X0003
    28 00003 1EB0          	LJMP                TCC_INT
    28 00004 0100          	LJMP                TCC_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    29                     	ORG                 0X0006
    30 00006 1EB0          	LJMP                EXTERNAL_INT
    30 00007 0121          	LJMP                EXTERNAL_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    31                     	ORG                 0X0009
    32 00009 1EB0          	LJMP                WDT_INT
    32 0000A 0124          	LJMP                WDT_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    33                     	ORG                 0X000C
    34 0000C 1EB0          	LJMP                TIMER1_INT
    34 0000D 0126          	LJMP                TIMER1_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    35                     	ORG                 0X000F
    36 0000F 1EB0          	LJMP                TIMER2_INT
    36 00010 012B          	LJMP                TIMER2_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    37                     	ORG                 0X0012
    38 00012 1EB0          	LJMP                AD_INT
    38 00013 0125          	LJMP                AD_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    39                     	ORG                 0X0015
    40 00015 1EB0          	LJMP                UART_INT
    40 00016 012C          	LJMP                UART_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    41                     	ORG                 0X0018
    42 00018 1EB0          	LJMP                SPI_INT
    42 00019 012D          	LJMP                SPI_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    43                     	ORG                 0X001B
    44 0001B 1EB0          	LJMP                LVD_INT
    44 0001C 012E          	LJMP                LVD_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    45                     
    46                     
    47                     ;=========================================================================
    48                     ; Program code
    49                     ;=========================================================================
    50                     	ORG                 0X100
    51                     ;========================= TCC Interrupt Service =========================
    52 00100               TCC_INT:
    53 00100 1E00          	BANK                0
    54 00101 080F          	BC                  ISR,TCIF               ;clear TCC interrupt flag
    55 00102 0C1F          	JBC                 SearchStatusFlag/8,SearchStatusFlag%8
    56 00103 150E          	JMP                 Search_Status_Mode
    57 00104 0C9F          	JBC                 LoseFrameStatusFlag/8,LoseFrameStatusFlag%8
    58 00105 1517          	JMP                 LoseFrame_Status_Mode
    59 00106 0C5F          	JBC                 NormalStatusFlag/8,NormalStatusFlag%8
    60 00107 1509          	JMP                 Normal_Status_Mode
    61 00108 151C          	JMP                 TCC_INT_END
    62                     ;---------------------------------------------------------------------------
    63 00109               	Normal_Status_Mode:
    64 00109 1807          		MOV             A,@0B00000111
    65 0010A 004D          		MOV             TWTCR,A         ; N=125,P=256,f=8MHz ==> T=4ms
    66 0010B 1883          		MOV             A,@(256-125)    ; load initial value
    67 0010C 0041          		MOV             TCC,A
    68 0010D 151C          		JMP             TCC_INT_END
    69                     ;-------------------------------------------------------------------
    70 0010E               	Search_Status_Mode:
    71 0010E 180F          		MOV             A,@0B00001111
    72 0010F 004D          		MOV             TWTCR,A         ; N=128,P=256,f=32768Hz ==> T=1s
    73 00110 1880          		MOV             A,@(256-128)    ; load initial value
    74 00111 0041          		MOV             TCC,A
    75 00112 1E02          		BANK            2
    76 00113 056E          		INC             KeySystemTimeCNT
    77 00114 056F          		INC             LEDSystemTimeCNT
    78 00115 0B5E          		BS              System8msFlag/8,System8msFlag%8
    79                     /*
    80                     		;BANK            0
    81                     		;MOV             A,@0B00100000          ; (test)P85 exchange when intrrupt
    82                     		;XOR             PORT8,A
    83                     */
    84 00116 151C          		JMP             TCC_INT_END
    85                     ;-------------------------------------------------------------------
    86 00117               	LoseFrame_Status_Mode:
    87 00117 1807          		MOV             A,@0B00000111
    88 00118 004D          		MOV             TWTCR,A         ; N=125,P=256,f=8MHz ==> T=4ms
    89 00119 1883          		MOV             A,@(256-125)    ; load initial value
    90 0011A 0041          		MOV             TCC,A
    91 0011B 151C          		JMP             TCC_INT_END
    92 0011C               TCC_INT_END:
    93                       if TCC_T_DEBUG & DebugDisplay == 1
    94 0011C 1E00          	BANK                0
    95 0011D 1820          	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    96 0011E 0348          	XOR                 PORT8,A
    97                       endif
    98 0011F 0557          	INC                 ComuClock
    99 00120 0013          	RETI
   100                     
   101 00121               EXTERNAL_INT:
   102 00121 1E01          	BANK                1
   103 00122 00CF          	CLR                 EISR               ;clear the external interrupt flag
   104 00123 0013          	RETI
   105                     
   106 00124               WDT_INT:
   107 00124 0013          	RETI
   108                     
   109 00125               AD_INT:
   110 00125 0013          	RETI
   111                     
   112 00126               TIMER1_INT:
   113 00126 1E00          	BANK                0
   114 00127 09CF          	BC                  ISR,T1IF               ; clear Timer1 interrupt flag
   115                       if TIME1_T_DEBUG & DebugDisplay == 1
   116 00128 1808          	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   117 00129 0348          	XOR                 PORT8,A
   118                       endif
   119                     	;BANK                2
   120                     	;INC                 SleepCNT               ; 2s
   121 0012A 0013          	RETI
   122                     
   123 0012B               TIMER2_INT:
   124 0012B 0013          	RETI
   125 0012C               UART_INT:
   126 0012C 0013          	RETI
   127 0012D               SPI_INT:
   128 0012D 0013          	RETI
   129 0012E               LVD_INT:
   130 0012E 0013          	RETI
   131                     
   132                     ;==========================================================================
   133                     ;=========================================================================
   134 0012F               INITIAL:
   135 0012F 0000          	NOP
   136 00130 0000          	NOP
   137 00131 0000          	NOP
   138 00132 0000          	NOP
   139 00133 0000          	NOP
   140 00134 0000          	NOP
   141 00135 0000          	NOP
   142 00136 0011          	DISI
   143 00137 0000          	NOP
   144 00138 0000          	NOP
   145 00139 0000          	NOP
   146 0013A 0011          	DISI
   147 0013B 0000          	NOP
   148 0013C 0000          	NOP
   149 0013D 0000          	NOP
   150 0013E 0011          	DISI
   151 0013F 0000          	NOP
   152 00140 0000          	NOP
   153 00141 0004          	WDTC
   154 00142 0000          	NOP
   155                   M 	ClrCommRamBank
       00143 1810     1     MOV A,@( 16 )
       00144 0044     1     MOV  R4 ,A
       00145 0004     1     WDTC 
       00146 00C0     1     CLR  R0 ,
       00147 0544     1     INC  R4 ,
       00148 183F     1     MOV A,@( 63 )
       00149 0284     1     AND A, R4 
       0014A 1D1F     1     SUB A,@( 31 )
       0014B 0C03     1     JBC  R3 , C 
       0014C 1545     1     JMP ( $ - 7 ),
       0014D 00C4     1     CLR  R4 ,
   156 0014E 0000          	NOP
   157 0014F 0000          	NOP
   158                   M 	ClrRamBank
       00150 18D0     1     MOV A,@( 208 )
       00151 0044     1     MOV  RSR ,A
       00152 00C0     1     CLR  R0 ,
       00153 0544     1     INC  RSR ,
       00154 0404     1     MOV A, RSR 
       00155 1A3F     1     AND A,@( 63 )
       00156 0E83     1     JBS  STATUS , Z 
       00157 1552     1     JMP ( $ - 5 ),
       00158 0545     1     INC  BSR ,
       00159 0B44     1     BS  RSR , 5 
       0015A 1807     1     MOV A,@( 7 )
       0015B 02C5     1     AND  BSR ,A
       0015C 0B84     1     BS  RSR , 6 
       0015D 0E83     1     JBS  STATUS , Z 
       0015E 1552     1     JMP ( $ - 12 ),
   159 0015F 0000          	NOP
   160 00160 0000          	NOP
   161 00161 11FF          	CALL                IO_INITIAL
   162 00162 0000          	NOP
   163                     
   164 00163 1E00          	BANK                0
   165 00164 0BCA          	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   166 00165 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   167 00166 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   168 00167 0A88          	BS                  LED2_STATUS/8,LED2_STATUS%8
   169 00168 1EA0          	LCALL               EM198850_RESET
   169 00169 0CF9          	LCALL               EM198850_RESET
   170 0016A 0000          	NOP
   171                     
   172                     ;==============================================================================
   173 0016B                 Commu_Status_Inital:
   174 0016B 1EA0          	LCALL               IO_93C46_INITIAL    ; Set I/O
   174 0016C 101F          	LCALL               IO_93C46_INITIAL    ; Set I/O
   175 0016D 1E00          	BANK                0
   176 0016E 0BCA          	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   177 0016F 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   178 00170 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   179                     
   180 00171 1800          	MOV                 A,@0X00
   181 00172 0055          	MOV                 DataAddressInEEPROM,A
   182 00173 1860          	MOV                 A,@0X60
   183 00174 0054          	MOV                 DataAddressInMCU,A
   184                   M 	mREAD               DataAddressInEEPROM,@0,DataAddressInMCU,@16
       00175 1E00     1     BANK @( 0 ),
       00176 0414     1     MOV A, DATAADDRESSINMCU 
       00177 0044     1     MOV  R4 ,A
       00178 1810     1     MOV A,@( 16 )
       00179 0053     1     MOV  R_ACC3 ,A
       0017A          1    ??0022$WRITE_DATA:   
       0017A 1EA0     1     LCALL  START_BIT ,
       0017B 1000     1     LCALL  START_BIT ,
       0017C 0615     1     RRCA  DATAADDRESSINEEPROM ,
       0017D 1980     1     OR A,@( READ )
       0017E 0051     1     MOV  R_ACC1 ,A
       0017F 1808     1     MOV A,@( 8 )
       00180 1EA0     1     LCALL  RL_COMD ,
       00181 100E     1     LCALL  RL_COMD ,
       00182 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00183 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       00184 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       00185 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       00186 0B4A     1     BS ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       00187 1588     1     JMP ( $ + 1 ),
       00188 0B8A     1     BS ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00189 0555     1     INC  DATAADDRESSINEEPROM ,
       0018A 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
       0018B 158C     1     JMP ( $ + 1 ),
       0018C 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       0018D 158E     1     JMP ( $ + 1 ),
       0018E 158F     1     JMP ( $ + 1 ),
       0018F 0B8A     1     BS ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00190          1    ??0022$READ_DATA1:   
       00190 1808     1     MOV A,@( 8 )
       00191 0052     1     MOV  R_ACC2 ,A
       00192          1    ??0022$READ_DATA2:   
       00192 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       00193 0000     1     NOP 
       00194 0000     1     NOP 
       00195 0D0A     1     JBC ( SPI_MISO / 8 ),( SPI_MISO % 8 )
       00196 0A03     1     BS  STATUS , C 
       00197 0F0A     1     JBS ( SPI_MISO / 8 ),( SPI_MISO % 8 )
       00198 0803     1     BC  STATUS , C 
       00199 06C0     1     RLC  R0 ,
       0019A 0B8A     1     BS ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       0019B 159C     1     JMP ( $ + 1 ),
       0019C 05D2     1     DJZ  R_ACC2 ,
       0019D 1592     1     JMP  ??0022$READ_DATA2 ,
       0019E 0544     1     INC  R4 ,
       0019F 0000     1     NOP 
       001A0 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       001A1 05D3     1     DJZ  R_ACC3 ,
       001A2 157A     1     JMP  ??0022$WRITE_DATA ,
   185                   M 	mEWDS
       001A3 1EA0     1     LCALL  START_BIT ,
       001A4 1000     1     LCALL  START_BIT ,
       001A5 1800     1     MOV A,@( EWDS )
       001A6 0051     1     MOV  R_ACC1 ,A
       001A7 1809     1     MOV A,@( 9 )
       001A8 1EA0     1     LCALL  RL_COMD ,
       001A9 100E     1     LCALL  RL_COMD ,
       001AA 08C7     1     BC ( AT93C46_CS / 8 ),( AT93C46_CS % 8 )
       001AB 098A     1     BC ( SPI_CLK / 8 ),( SPI_CLK % 8 )
       001AC 094A     1     BC ( SPI_MOSI / 8 ),( SPI_MOSI % 8 )
   186 001AD 1EA0          	LCALL               IO_93C46_QUIT       ; Set I/O
   186 001AE 102A          	LCALL               IO_93C46_QUIT       ; Set I/O
   187 001AF 1E00          	BANK                0
   188 001B0 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8     ; Disable 93C46
   189 001B1 0BCA          	BS                  SPI_SS/8,SPI_SS%8             ; Disable EM198810
   190 001B2 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8           ; Disable CMOS
   191                     
   192 001B3 1E00          	BANK                0
   193 001B4 0421          	MOV                 A,RX_IDH_Buffer     ; Read ID
   194 001B5 1E01          	BANK                1
   195 001B6 0061          	MOV                 RX_IDH,A
   196 001B7 1E00          	BANK                0
   197 001B8 0422          	MOV                 A,RX_IDL_Buffer
   198 001B9 1E01          	BANK                1
   199 001BA 0062          	MOV                 RX_IDL,A
   200 001BB 1E00          	BANK                0
   201 001BC 0427          	MOV                 A,TX_ID_Buffer
   202 001BD 1E01          	BANK                1
   203 001BE 0066          	MOV                 TX_ID,A
   204                     
   205 001BF 1E01          	BANK                1
   206 001C0 18FF          	MOV                 A,@0XFF             ; judge RX_ID,TX_ID
   207 001C1 0321          	XOR                 A,RX_IDH
   208 001C2 0C83          	JBC                 STATUS,Z
   209 001C3 15C9          	JMP                 Used_Default_Sync
   210 001C4 18FF          	MOV                 A,@0XFF
   211 001C5 0322          	XOR                 A,RX_IDL
   212 001C6 0C83          	JBC                 STATUS,Z
   213 001C7 15C9          	JMP                 Used_Default_Sync
   214 001C8 15CD          	JMP                 Start_Up
   215 001C9               Used_Default_Sync:
   216 001C9 189D          	MOV                 A,@RX_IDH_DEFAULT             ; SYNC ,used default 0X0DB3
   217 001CA 0061          	MOV                 RX_IDH,A
   218 001CB 18CB          	MOV                 A,@RX_IDL_DEFAULT
   219 001CC 0062          	MOV                 RX_IDL,A
   220                     
   221                     ;==============================================================================
   222 001CD               Start_Up:
   223 001CD 0000          	NOP
   224 001CE 1EA0          	LCALL               Enter_StandbyII_Mode
   224 001CF 0EB3          	LCALL               Enter_StandbyII_Mode
   225 001D0 1EA0          	LCALL               CHANGE_ADDRESS_VALUE
   225 001D1 0F11          	LCALL               CHANGE_ADDRESS_VALUE
   226 001D2 00E5          	CLR                 CH_NO
   227 001D3 1EA0          	LCALL               RF_FREQ_SET
   227 001D4 0EF9          	LCALL               RF_FREQ_SET
   228 001D5 0000          	NOP
   229                     
   230 001D6 1E00          	BANK                0
   231 001D7 00CF          	CLR                 ISR              ; clear interrupt flag
   232 001D8 09C9          	BC                  T2CR,T2IF        ; Clear timer2 intrrupt flag
   233 001D9 0010          	ENI
   234 001DA 1E00          	BANK                0
   235 001DB 00D7          	CLR                 ComuClock
   236 001DC 00D8          	CLR                 ComuCycleNum
   237 001DD 00D9          	CLR                 ComuEndNum
   238 001DE 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8              ; Disable 93C46
   239 001DF 0BCA          	BS                  SPI_SS/8,SPI_SS%8                      ; Disable EM198810
   240                     
   241 001E0 00DC          	CLR                 SleepCNT
   242 001E1 00DF          	CLR                 CommuStatusFlag
   243 001E2 00DD          	CLR                 GeneralStatusFlag1
   244 001E3 00DE          	CLR                 GeneralStatusFlag2
   245 001E4 00E3          	CLR                 CHN_FLAG
   246 001E5 0A48          	BS                  LED1_STATUS/8,LED1_STATUS%8		       ; PORT81,LED
   247 001E6 0888          	BC                  LED2_STATUS/8,LED2_STATUS%8
   248                     
   249 001E7 1E02          	BANK                2
   250 001E8 18FF          	MOV                 A,@0XFF
   251 001E9 0076          	MOV                 KeystokeFlag_Befor,A
   252 001EA 0077          	MOV                 KeystokeTimeCNT,A
   253                     ;-----------------------------------------------------------------
   254                     	;CALL                SearchLinkMode_Set
   255 001EB 081F          	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   256 001EC 0A5F          	BS                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   257 001ED 089F          	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   258 001EE 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   259 001EF 0B1F          	BS                  LinkModeFlag/8,LinkModeFlag%8
   260 001F0 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   261 001F1 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   262                     ;-----------------------------------------------------------------
   263 001F2 0000          	NOP
   264 001F3 0000          	NOP
   265                     
   266                     ;=============================================================================
   267 001F4               MAIN:
   268 001F4 0000          	NOP
   269 001F5 0000          	NOP
   270                     
   271 001F6 1EA0          	LCALL               Search_Equipment
   271 001F7 0400          	LCALL               Search_Equipment
   272 001F8 1E00          	BANK                0
   273 001F9 0848          	BC                  LED1_STATUS/8,LED1_STATUS%8
   274 001FA 1EA0          	LCALL               Normal_Communicate
   274 001FB 0800          	LCALL               Normal_Communicate
   275                     
   276                     	;CALL                Enter_Sleep_Status
   277                     
   278 001FC 0000          	NOP
   279 001FD 0000          	NOP
   280 001FE 15F4          	JMP                 MAIN
   281                     
   282                     
   283                     ;*****************************************************************
   284                     ;Function:    IO INITIAL SET
   285                     ;Input:       None
   286                     ;Output:      None
   287                     ;*****************************************************************
   288 001FF               IO_INITIAL:
   289                     ;==========================PORT 7/8/9 INITIAL===============================
   290 001FF 1E06          	BANK                6
   291 00200 00C7          	CLR                 P7ODCR          ;Disable Open Drain
   292 00201 00C8          	CLR                 P8ODCR
   293 00202 00C9          	CLR                 P9ODCR
   294 00203 1E04          	BANK                4
   295 00204 18FF          	MOV                 A,@0B11111111
   296 00205 0047          	MOV                 IOC7,A          ;Set Input
   297 00206 18FF          	MOV                 A,@0B11111111
   298 00207 0048          	MOV                 IOC8,A          ;Set Input
   299 00208 18FF          	MOV                 A,@0B11111111
   300 00209 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Input
   301 0020A 1E05          	BANK                5
   302 0020B 1800          	MOV                 A,@0B00000000
   303 0020C 0047          	MOV                 P7PHCR,A		;Disable PULL UP
   304 0020D 1800          	MOV                 A,@0B00000000
   305 0020E 0048          	MOV                 P8PHCR,A		;Disable PULL UP
   306 0020F 18F0          	MOV                 A,@0B11110000
   307 00210 0049          	MOV                 P9PHCR,A		;SET PULL UP
   308                     
   309 00211 1E04          	BANK                4
   310 00212 1800          	MOV                 A,@0B00000000
   311 00213 0047          	MOV                 IOC7,A          ;Set Output
   312 00214 1800          	MOV                 A,@0B00000000
   313 00215 0048          	MOV                 IOC8,A          ;Set Output
   314 00216 18F0          	MOV                 A,@0B11110000
   315 00217 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Output
   316 00218 1E01          	BANK                1
   317 00219 1800          	MOV                 A,@0B00000000	;Disable LCD common dirver pin
   318 0021A 004A          	MOV                 LCDSCR0,A
   319 0021B 004B          	MOV                 LCDSCR1,A
   320 0021C 004C          	MOV                 LCDSCR2,A
   321 0021D 1E00          	BANK                0
   322 0021E 00C7          	CLR                 PORT7           ; Port7 output logic "0"
   323 0021F 00C8          	CLR                 PORT8           ; Port8 output logic "0"
   324 00220 00C9          	CLR                 PORT9
   325                     
   326                     ;==============================PORT A/B======================================
   327 00221 1E04          	BANK                4
   328 00222 18FF          	MOV                 A,@0B11111111
   329 00223 004A          	MOV                 PAIOCR,A        ; PA As Input
   330 00224 18FF          	MOV                 A,@0B11111111
   331 00225 004B          	MOV                 PBIOCR,A       	; PB As Input
   332 00226 1E05          	BANK                5
   333 00227 1800          	MOV                 A,@0B00000000
   334 00228 004A          	MOV                 PAPHCR,A        ; PA4(MISO) PULL HIGH
   335 00229 1837          	MOV                 A,@0B00110111
   336 0022A 004B          	MOV                 PBPHCR,A	    ; PB0 PB1 PB2 PB4 PB5 Enable Pull High
   337 0022B 1E04          	BANK                4
   338 0022C 1810          	MOV                 A,@0B00010000	; Set PA4 (MISO) as input pin
   339 0022D 004A          	MOV                 PAIOCR,A        ; SO,SCK output pin
   340 0022E 1837          	MOV                 A,@0B00110111	; PB0 PB1 PB2 PB4 PB5 PB1AS INPUT
   341 0022F 004B          	MOV                 PBIOCR,A       	; PKT FIFO input Pin
   342 00230 1E00          	BANK                0
   343 00231 00CA          	CLR                 PORTA           ; PortA output logic "0"
   344 00232 00CB          	CLR                 PORTB           ; PortB output logic "0"
   345                     ;------------------------------------------------------------------
   346                       if SPI_FUNCTION == 1
   347 00233 1E02          	BANK                2
   348 00234 1800          	MOV                 A,@00000000B   ; Shift left, SDO delay time: 16clk,
   349 00235 004C          	MOV                 SPIS, A        ; disable open-drain
   350 00236 18C9          	MOV                 A,@11001001B   ; Data shift out rising edge, is on hold during low
   351 00237 004D          	MOV                 SPIC,A         ; Enable SPI mode, after data output SDO remain low
   352                       endif                                ; SPI Baud Rate: 001->Fosc/4
   353                     ;--------------------------------------------------------------------
   354                       if UART_FUNCTION == 1
   355 00238 1E04          	BANK                4
   356 00239 0B0B          	BS                  PBIOCR,4       	; PB4(RX) as Input
   357 0023A 094B          	BC                  PBIOCR,5        ; PB5(TX) as output
   358 0023B 1E05          	BANK                5
   359 0023C 0B0B          	BS                  PBPHCR,4        ; PA4(MISO) PULL HIGH
   360                     
   361 0023D 1E03          	BANK                3
   362 0023E 1820          	MOV                 A,@0B00100000   ; 8-Bit Mode,Fc=8MHz,Baud=38400
   363 0023F 0045          	MOV                 URC,A           ; Disable TXE
   364 00240 1800          	MOV                 A,@0B00000000
   365 00241 0046          	MOV                 URS,A           ; disable parity, Odd parity
   366 00242 1E05          	BANK                5
   367 00243 1820          	MOV                 A,@0B00100000   ; Enable uart function
   368 00244 0046          	MOV                 UARC2,A
   369                       endif
   370                     
   371                     ;============================ TCC config ====================================
   372 00245 1E00          	BANK                0
   373 00246 1807          	MOV                 A,@0B00000111
   374 00247 004D          	MOV                 TWTCR,A         ; N=125,P=256,f=8MHz ==> T=4ms
   375 00248 1883          	MOV                 A,@(256-125)    ; load initial value
   376 00249 0041          	MOV                 TCC,A
   377 0024A 0A0E          	BS                  IMR,TCIE        ; set   TCIE=1  tcc enable interrupt
   378 0024B 00CF          	CLR                 ISR             ; clear interrupt flag
   379 0024C 1E01          	BANK                1
   380 0024D 00CF          	CLR                 EISR            ; Clear External Interrupt Status Register
   381 0024E 00CE          	CLR                 EIMR            ; Clear External Interrupt Mask  Register
   382                     
   383                     ;============================ Timer 1 config ===================================
   384 0024F 1E00          	BANK                0
   385 00250 09CE          	BC                  IMR,T1IE         ; Disable Timier1
   386 00251 09CF          	BC                  ISR,T1IF         ; Clear timer1 intrrupt flag
   387 00252 1E02          	BANK                2
   388 00253 1807          	MOV                 A,@0B00000111
   389 00254 0045          	MOV                 T1CR,A           ; N=128, P=256, T=1s
   390 00255 1880          	MOV                 A,@128
   391 00256 0047          	MOV                 T1PD,A           ; N=128, Auto reload
   392 00257 1810          	MOV                 A,@0B00010000
   393 00258 0046          	MOV                 TSR,A            ; 8 bit counter ,f=32.768KHz
   394 00259 0886          	BC                  TSR,T1EN         ; Start/stop timer1
   395                     
   396 0025A 0012          	RET
   397                     
   398                     ;*****************************************************************
   399                     ;Function:    MCU SLEEP SET
   400                     ;Input:       None
   401                     ;Output:      None
   402                     ;*****************************************************************
   403 0025B               MCU_EnterIdle_Set:
   404                     ;======================== Save power ==============================
   405 0025B 1E03          	BANK                3
   406 0025C 0989          	BC                  ADCR,ADP                    ; Disable ADC Function
   407 0025D 1E01          	BANK                1
   408 0025E 0ACC          	BS                  SCCR,IDLE                   ; Set IDLE=1(IDLE MODE)
   409 0025F 1E00          	BANK                0
   410 00260 0BCA          	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   411 00261 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   412 00262 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   413                     	
   414                     ;========================== Set Timers ==================================
   415 00263 0004          	WDTC
   416 00264 187F          	MOV                 A,@0B01111111               ; Disable WDTC /Set Prescale max.
   417 00265 004D          	MOV                 TWTCR,A                     ; N=128,P=256,f=32768Hz ==> T=1s
   418 00266 1880          	MOV                 A,@(256-128)                ; load initial value
   419 00267 0041          	MOV                 TCC,A
   420 00268 0A0E          	BS                  IMR,TCIE                    ; set   TCIE=1  tcc enable interrupt	
   421 00269 00CF          	CLR                 ISR
   422 0026A 0012          	RET
   423                     
   424                     ;*****************************************************************
   425                     ;Function:    MCU wakeup SET
   426                     ;Input:       None
   427                     ;Output:      None
   428                     ;*****************************************************************
   429 0026B               MCU_WakeUp_Set:
   430 0026B 1E00          	BANK                0
   431 0026C 00CF          	CLR                 ISR
   432 0026D 0004          	WDTC
   433 0026E 08CD          	BC                  TWTCR,TCCS	
   434 0026F 1877          	MOV                 A,@0B01110111               ; Disable WDTC /Set Prescale max.
   435 00270 004D          	MOV                 TWTCR,A                     ; N=256,P=256,f=8MHz ==> T=4ms
   436 00271 1883          	MOV                 A,@(256-125)                ; load initial value
   437 00272 0041          	MOV                 TCC,A
   438                     
   439 00273 0BCA          	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   440 00274 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   441 00275 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   442 00276 0012          	RET
   443                     
   444                     
   445                     ;*****************************************************************
   446                     ;Function:    sleep function
   447                     ;Input:       None
   448                     ;Output:      None
   449                     ;description: all device into save power status
   450                     ;*****************************************************************
   451 00277               Enter_Sleep_Status:
   452 00277 0A5D          	BS                  IntoSleepFlag/8,IntoSleepFlag%8
   453                     
   454 00278 0E5D          	JBS                 IntoSleepFlag/8,IntoSleepFlag%8
   455 00279 16F2          	JMP                 SearchSleep_Status_Judge_End
   456 0027A 085D          	BC                  IntoSleepFlag/8,IntoSleepFlag%8
   457 0027B 0000          	NOP
   458 0027C 1805          	MOV                 A,@5
   459 0027D 133B          	CALL                DELAY_8MHz_X20MS
   460                     
   461                     	;LCALL               ENTER_IDLE_MODE
   462 0027E 125B          	CALL                MCU_EnterIdle_Set
   463 0027F 1E00          	BANK                0
   464 00280 0848          	BC                  LED1_STATUS/8,LED1_STATUS%8
   465                     
   466 00281 0000          	NOP
   467 00282 0000          	NOP
   468 00283 0000          	NOP
   469 00284 0003          	SLEP                                               ; Enter Sleep mode
   470 00285 0000          	NOP
   471 00286 0000          	NOP
   472 00287 0000          	NOP
   473 00288 0000          	NOP
   474 00289 0000          	NOP
   475 0028A 0000          	NOP
   476 0028B 0000          	NOP
   477 0028C 0000          	NOP
   478 0028D 0000          	NOP
   479 0028E 0000          	NOP
   480 0028F 0000          	NOP
   481 00290 0000          	NOP
   482 00291 0000          	NOP
   483 00292 0000          	NOP
   484 00293 0000          	NOP
   485 00294 0000          	NOP
   486 00295 0000          	NOP
   487 00296 0000          	NOP
   488 00297 0000          	NOP
   489 00298 0000          	NOP
   490 00299 0000          	NOP
   491 0029A 0000          	NOP
   492 0029B 0000          	NOP
   493 0029C 0000          	NOP
   494 0029D 0000          	NOP
   495 0029E 0000          	NOP
   496 0029F 0000          	NOP
   497 002A0 0000          	NOP
   498 002A1 0000          	NOP
   499 002A2 0000          	NOP
   500 002A3 0000          	NOP
   501 002A4 0000          	NOP
   502 002A5 0000          	NOP	
   503 002A6 0000          	NOP
   504 002A7 0000          	NOP
   505 002A8 0000          	NOP
   506 002A9 0000          	NOP
   507 002AA 0000          	NOP
   508 002AB 0000          	NOP
   509 002AC 0000          	NOP
   510 002AD 0000          	NOP
   511 002AE 0000          	NOP
   512 002AF 0000          	NOP
   513 002B0 0000          	NOP
   514 002B1 0000          	NOP
   515 002B2 0000          	NOP
   516 002B3 0000          	NOP
   517 002B4 0000          	NOP
   518 002B5 0000          	NOP
   519 002B6 0000          	NOP
   520 002B7 0000          	NOP
   521 002B8 0000          	NOP
   522 002B9 0000          	NOP
   523 002BA 0000          	NOP
   524 002BB 0000          	NOP
   525 002BC 0000          	NOP
   526 002BD 0000          	NOP
   527 002BE 0000          	NOP
   528 002BF 0000          	NOP
   529 002C0 0000          	NOP
   530 002C1 0000          	NOP
   531 002C2 0000          	NOP
   532 002C3 0000          	NOP
   533 002C4 0000          	NOP
   534 002C5 0000          	NOP
   535 002C6 0000          	NOP
   536 002C7 0000          	NOP
   537 002C8 0000          	NOP
   538 002C9 0000          	NOP
   539 002CA 0000          	NOP
   540 002CB 0000          	NOP
   541 002CC 0000          	NOP
   542 002CD 0000          	NOP
   543 002CE 0000          	NOP
   544 002CF 0000          	NOP
   545 002D0 0000          	NOP
   546 002D1 0000          	NOP
   547 002D2 0000          	NOP
   548 002D3 0000          	NOP
   549 002D4 0000          	NOP
   550 002D5 0000          	NOP
   551 002D6 0000          	NOP
   552 002D7 0000          	NOP
   553 002D8 0000          	NOP
   554 002D9 0000          	NOP
   555 002DA 0000          	NOP
   556 002DB 0000          	NOP
   557 002DC 0000          	NOP
   558 002DD 0000          	NOP
   559 002DE 0000          	NOP
   560 002DF 0000          	NOP
   561 002E0 0000          	NOP
   562 002E1 0000          	NOP
   563 002E2 0000          	NOP
   564 002E3 0000          	NOP
   565 002E4 0000          	NOP
   566 002E5 0000          	NOP		
   567                     		
   568 002E6 126B          	CALL                MCU_WakeUp_Set
   569                     
   570                     ;------------------------ initial -------------------------------------
   571 002E7 1E00          	BANK                0
   572 002E8 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8      ; Disable 93C46
   573 002E9 0BCA          	BS                  SPI_SS/8,SPI_SS%8              ; Disable EM198810
   574 002EA 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8            ; Disable CMOS
   575                     ;-------------------------------------------------------------
   576 002EB 0A1F          	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   577 002EC 085F          	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   578 002ED 089F          	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   579 002EE 0B1F          	BS                  LinkModeFlag/8,LinkModeFlag%8
   580 002EF 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   581 002F0 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   582                     ;-------------------------------------------------------------
   583                     	;LCALL               ENTER_RX_BUFFER_NACK
   584 002F1 0000          	NOP
   585 002F2                 SearchSleep_Status_Judge_End:
   586 002F2 085D          	BC                  IntoSleepFlag/8,IntoSleepFlag%8
   587 002F3 0000          	NOP
   588 002F4 0012          	RET
   589 002F5 0000          	NOP
   590                     
   591                     ;=======================================================================================
   592 002F6               Disable_ALLdevice:
   593 002F6 1E00          	BANK                0
   594 002F7 0BCA          	BS                  SPI_SS/8,SPI_SS%8           ; Disable EM198810
   595 002F8 08C7          	BC                  AT93C46_CS/8,AT93C46_CS%8   ; Disable 93C46
   596 002F9 0A0A          	BS                  CMOS_SS/8,CMOS_SS%8         ; Disable CMOS
   597 002FA 0012          	RET
   598                     
   599                     
   600                     ;*****************************************************************
   601                     ;Function:    mode select
   602                     ;Input:
   603                     ;Output:      None
   604                     ;desciption:  set timing and select mode
   605                     ;*****************************************************************
   606 002FB               SearchLinkMode_Set:         ;0X11
   607 002FB 0A1F          	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   608 002FC 085F          	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   609 002FD 089F          	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   610 002FE 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   611 002FF 0B1F          	BS                  LinkModeFlag/8,LinkModeFlag%8
   612 00300 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   613 00301 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   614 00302 0012          	RET
   615                     
   616 00303               SearchForceLinkMode_Set:    ;0X24
   617 00303 081F          	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   618 00304 085F          	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   619 00305 0A9F          	BS                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   620 00306 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   621 00307 091F          	BC                  LinkModeFlag/8,LinkModeFlag%8
   622 00308 0B5F          	BS                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   623 00309 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   624 0030A 0012          	RET
   625                     
   626 0030B               NormalLinkMode_Set:         ;0X12
   627 0030B 081F          	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;Clear search status
   628 0030C 0A5F          	BS                  NormalStatusFlag/8,NormalStatusFlag%8            ;set normal mode
   629 0030D 089F          	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   630 0030E 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   631 0030F 0B1F          	BS                  LinkModeFlag/8,LinkModeFlag%8
   632 00310 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   633 00311 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   634 00312 0012          	RET
   635                     
   636 00313               LoseFrameLinkMode_Set:      ;0X16
   637 00313 081F          	BC                  SearchStatusFlag/8,SearchStatusFlag%8            ;Clear search status
   638 00314 0A5F          	BS                  NormalStatusFlag/8,NormalStatusFlag%8            ;set normal mode
   639 00315 0A9F          	BS                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   640 00316 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   641 00317 0B1F          	BS                  LinkModeFlag/8,LinkModeFlag%8
   642 00318 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   643 00319 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   644 0031A 0012          	RET
   645                     
   646 0031B               LoseFrameForceLinkMode_Set: ;0X25
   647 0031B 0A1F          	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;Clear search status
   648 0031C 085F          	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;set normal mode
   649 0031D 0A9F          	BS                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   650 0031E 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   651 0031F 091F          	BC                  LinkModeFlag/8,LinkModeFlag%8
   652 00320 0B5F          	BS                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   653 00321 099F          	BC                  FccTestModeFlag/8,FccTestModeFlag%8
   654 00322 0012          	RET
   655                     
   656 00323               FccSearchLinkMode_Set:      ;0X41
   657 00323 0A1F          	BS                  SearchStatusFlag/8,SearchStatusFlag%8            ;set search mode
   658 00324 085F          	BC                  NormalStatusFlag/8,NormalStatusFlag%8            ;Clear normal mode
   659 00325 089F          	BC                  LoseFrameStatusFlag/8,LoseFrameStatusFlag%8      ;Clear LoseFreq mode
   660 00326 08DF          	BC                  EEpromWRStatusFlag/8,EEpromWRStatusFlag%8
   661 00327 091F          	BC                  LinkModeFlag/8,LinkModeFlag%8
   662 00328 095F          	BC                  ForceLinkModeFlag/8,ForceLinkModeFlag%8
   663 00329 0B9F          	BS                  FccTestModeFlag/8,FccTestModeFlag%8
   664 0032A 0012          	RET
   665                     
   666                     
   667                     ;===============================================
   668                     ; Function: Delay 20us
   669                     ; Input:    None
   670                     ; Output:   None
   671                     ; Crystal:  8MHz
   672                     ;===============================================
   673 0032B               DELAY_8MHz_X10US:
   674 0032B 0051          	MOV                 TEMP1,A
   675 0032C                 Delay_Loop_X10US:
   676 0032C 1812          	MOV                 A,@18      ;
   677 0032D 0052          	MOV                 TEMP2,A
   678 0032E                 Waiting_X10US:
   679 0032E 05D2          	DJZ                 TEMP2
   680 0032F 172E          	JMP                 Waiting_X10US
   681 00330 05D1          	DJZ                 TEMP1
   682 00331 172C          	JMP                 Delay_Loop_X10US
   683 00332 0012          	RET
   684                     
   685                     ;===============================================
   686                     ; Function: Delay 100us
   687                     ; Input:    None
   688                     ; Output:   None
   689                     ; Crystal:  8MHz
   690                     ;===============================================
   691 00333               DELAY_8MHz_X100US:
   692 00333 0051          	MOV                 TEMP1,A
   693 00334                 Delay_Loop_X100US:
   694 00334 18C4          	MOV                 A,@196     ;
   695 00335 0052          	MOV                 TEMP2,A
   696 00336                 Waiting_X100US:
   697 00336 05D2          	DJZ                 TEMP2
   698 00337 1736          	JMP                 Waiting_X100US
   699 00338 05D1          	DJZ                 TEMP1
   700 00339 1734          	JMP                 Delay_Loop_X100US
   701 0033A 0012          	RET
   702                     
   703                     
   704                     ;===============================================
   705                     ; Function: Delay 20ms
   706                     ; Input:    ACC
   707                     ; Output:   None
   708                     ; Crystal:  8MHz
   709                     ;===============================================
   710 0033B               DELAY_8MHz_X20MS:
   711 0033B 0052          	MOV                 TEMP2, A
   712 0033C                 Delay_Loop_X20MS:
   713 0033C 18C8          	MOV                 A,@200
   714 0033D 0051          	MOV                 TEMP1, A
   715 0033E                 Waiting_X20MS:
   716 0033E 18C6          	MOV                 A,@198
   717 0033F 0050          	MOV                 TEMP,A
   718 00340 05D0          	DJZ                 TEMP
   719 00341 1740          	JMP                 $-1
   720 00342 05D1          	DJZ                 TEMP1
   721 00343 173E          	JMP                 Waiting_X20MS
   722 00344 05D2          	DJZ                 TEMP2
   723 00345 173C          	JMP                 Delay_Loop_X20MS
   724 00346 0012          	RET
  0 Error(s), 10 Warning(s), 0 User Message(s)