     1                     ;==================================================================
     2                     ; Filename     :  EM78M611
     3                     ; Author       :  yu.wei
     4                     ; Company      :  ELAN
     5                     ; VERSION      :  1.1
     6                     ; CRYSTAL      :  8MHZ
     7                     ; Creat date   :  2009/11/4
     8                     ; tool ver.    :  eUIDE
     9                     ; Description  :  modify for code conformity
    10                     ;=========================================================================
    11                     M611rxP40M1v6V10.ASM    EQU    M611rxP40M1v6V10.ASM
    12                     
    13                     include "D:\include\EM78xx\EM78M611E.H"
     1            C        ;==================================================================
     2            C        ;  Tilte:       EM78M612 include file                ;
     3            C        ;  Description: The Definition of EM78M612 Registers ;
     4            C        ;  Company:     Elan Electronic Corp.                  ;
     5            C        ;  Author:      YU.WEI                            ;
     6            C        ;  Date:        2009.02.26                             ;
     7            C        ;  Version:     v1.0                                   ;
     8            C        ;===================================================================
     9            C        ;-----------------------------------------------------------------
    10            C        EM78M611E.H     EQU     EM78M611E.H
    11            C        
    12            C        ;-----------------------------------------------------------------
    13            C        ; Indirect Addressing register
    14       0000 C        	R0      ==      0X00
    15            C        
    16            C        ; Time Clock/Counter
    17       0001 C        	R1      ==      0X01
    18       0001 C        	TCC     ==      0X01
    19            C        
    20            C        ; Program Counter
    21       0002 C        	R2      ==      0X02
    22       0002 C        	PC      ==      0X02
    23            C        
    24            C        ; Status Register
    25       0003 C        	R3      ==      0X03
    26       0003 C        	STATUS  ==      0X03
    27            C        	;{
    28       0000 C        		C       == 0X00; CARRYFLAG
    29       0001 C        		DC      == 0X01; AUXILIARY CARRY FLAG
    30       0002 C        		Z       == 0X02; ZERO FLAG
    31       0003 C        		P       == 0X03; POWER DOWN BIT
    32       0004 C        		T       == 0X04; TIME-OUT BIT
    33       0005 C        		PS0     == 0X05; PAGE select BIT 1
    34       0006 C        		PS1     == 0X06; PAGE select BIT 2
    35       0007 C        		PS2     == 0X07; PAGE select BIT 3
    36            C        		;{
    37            C        			PAGE0	MACRO			;000
    38            C        				BC	STATUS,PS2
    39            C        				BC	STATUS,PS1
    40            C        				BC	STATUS,PS0
    41            C        				ENDM
    42            C        			PAGE1	MACRO			;001
    43            C        				BC	STATUS,PS2
    44            C        				BC	STATUS,PS1
    45            C        				BS	STATUS,PS0
    46            C        				ENDM
    47            C        			PAGE2	MACRO			;010
    48            C        				BC	STATUS,PS2
    49            C        				BS	STATUS,PS1
    50            C        				BC	STATUS,PS0
    51            C        				ENDM
    52            C        			PAGE3	MACRO			;011
    53            C        				BC	STATUS,PS2
    54            C        				BS	STATUS,PS1
    55            C        				BS	STATUS,PS0
    56            C        				ENDM
    57            C        			PAGE4	MACRO			;100
    58            C        				BS	STATUS,PS2
    59            C        				BC	STATUS,PS1
    60            C        				BC	STATUS,PS0
    61            C        				ENDM
    62            C        			PAGE5	MACRO			;101
    63            C        				BS	STATUS,PS2
    64            C        				BC	STATUS,PS1
    65            C        				BS	STATUS,PS0
    66            C        				ENDM
    67            C        
    68            C        		;}
    69            C                  ;}
    70            C        
    71            C        
    72            C        ; RAM Select Register (RSR)
    73       0004 C        	R4             ==     0X04;
    74       0004 C        	RSR            ==     0X04
    75            C        	;{
    76       0006 C        		BK0     == 0X06; BANK selector BIT 0
    77       0007 C        		BK1     == 0X07; BANK selector BIT 1
    78            C        
    79            C        		BANK0	MACRO		;00
    80            C        			BC	RSR,BK0
    81            C        			BC	RSR,BK1
    82            C        			ENDM
    83            C        		BANK1	MACRO		;01
    84            C        			BS	RSR,BK0
    85            C        			BC	RSR,BK1
    86            C        			ENDM
    87            C        		BANK2	MACRO		;10
    88            C        			BC	RSR,BK0
    89            C        			BS	RSR,BK1
    90            C        			ENDM
    91            C        		BANK3	MACRO		;11
    92            C        			BS	RSR,BK0
    93            C        			BS	RSR,BK1
    94            C        			ENDM
    95            C        	;}
    96            C        
    97            C        ;====================================================================
    98       0005 C        	R5      == 0X05
    99       0005 C        	PORT5   == 0X05
   100            C        	;{
   101       0007 C        		P57	== 0X07
   102       0006 C        		P56	== 0X06
   103       0005 C        		P55	== 0X05
   104       0004 C        		P54	== 0X04
   105       0003 C        		P53	== 0X03
   106       0002 C        		P52	== 0X02
   107       0001 C        		P51	== 0X01
   108       0000 C        		P50	== 0X00
   109            C        	;}
   110            C        
   111            C        ;====================================================================
   112       0006 C        	R6      == 0X06
   113       0006 C        	PORT6   == 0X06
   114            C        	;{
   115       0007 C        		P67	== 0X07
   116       0006 C        		P66	== 0X06
   117       0005 C        		P65	== 0X05
   118       0004 C        		P64	== 0X04
   119       0003 C        		P63	== 0X03
   120       0002 C        		P62	== 0X02
   121       0001 C        		P61	== 0X01
   122       0000 C        		P60	== 0X00
   123            C        	;}
   124            C        
   125            C        ;====================================================================
   126       0007 C        	R7      == 0X07
   127       0007 C        	PORT7   == 0X07
   128            C        	;{
   129       0007 C        		P77	== 0X07
   130       0006 C        		P76	== 0X06
   131       0005 C        		P75	== 0X05
   132       0004 C        		P74	== 0X04
   133       0003 C        		P73	== 0X03
   134       0002 C        		P72	== 0X02
   135       0001 C        		P71	== 0X01
   136       0000 C        		P70	== 0X00
   137            C        	;}
   138            C        
   139            C        ;====================================================================
   140       0008 C        	R8      == 0X08; /PORT6 WAKE-UP PIN SELECT REGISTER
   141       0008 C        	PORT8   == 0X08
   142            C        	;{
   143       0007 C        		P87	== 0X07
   144       0006 C        		P86	== 0X06
   145       0005 C        		P85	== 0X05
   146       0004 C        		P84	== 0X04
   147       0003 C        		P83	== 0X03
   148       0002 C        		P82	== 0X02
   149       0001 C        		P81	== 0X01
   150       0000 C        		P80	== 0X00
   151            C        	;}
   152            C        
   153            C        ;====================================================================
   154       0009 C        	R9      == 0X09; /PORT7 WAKE-UP PIN SELECT REGISTER
   155       0009 C        	PORT9   == 0X09;
   156            C        	;{
   157       0007 C        		P97	== 0X07
   158       0006 C        		P96	== 0X06
   159       0005 C        		P95	== 0X05
   160       0004 C        		P94	== 0X04
   161       0003 C        		P93	== 0X03
   162       0002 C        		P92	== 0X02
   163       0001 C        		P91	== 0X01
   164       0000 C        		P90	== 0X00
   165            C        	;}
   166            C        
   167            C        ;====================================================================
   168       000A C        	RA      == 0X0A; HIGH PATTERN COUNTER
   169       000A C        	EECR    == 0X0A
   170            C        	;{
   171       0002 C        		EE_OK	== 0X02
   172       0001 C        		EE_C1	== 0X01
   173       0000 C        		EE_C0	== 0X00
   174            C        	;}
   175            C        
   176            C        ;====================================================================
   177       000B C        	RB      == 0X0B; LOW PATTERN COUNTER
   178       000B C        	PDACR       == 0X0B
   179            C        	;{
   180       0007 C        		SE2F    == 0X07
   181       0006 C        		SE1F    == 0X06
   182       0005 C        		SR2	== 0X05
   183       0004 C        		SR1	== 0X04
   184       0003 C        		SR0	== 0X03
   185       0002 C        		DB2	== 0X02
   186       0001 C        		DB1	== 0X01
   187       0000 C        		DB0	== 0X00
   188            C        	;}
   189            C        
   190            C        ;====================================================================
   191       000C C        	RC      == 0X0C; USB APPLICATION STATUS REGISTER
   192       000C C        	USBASR  == 0X0C
   193            C        	;{
   194       0007 C        		EP0_W           == 0X07
   195       0006 C        		EP0_R           == 0X06
   196       0005 C        		EP1_R           == 0X05
   197       0004 C        		EP2_R           == 0X04
   198       0003 C        		EP2_W           == 0X03
   199       0002 C        		HOST_SUSPEND    == 0X02
   200       0001 C        		EP0_BUSY        == 0X01
   201       0000 C        		STALL           == 0X00
   202            C        	;}
   203            C        
   204            C        ;====================================================================
   205       000D C        	RD       == 0X0D; USB APPLICATION FIFO ADDRESS REGISTER
   206       000D C        	FIFOAR   == 0X0D
   207            C        	;{
   208            C        		;---------------------------
   209            C        		;   00	Endpoint 0
   210            C        			;---------
   211            C        			;    0
   212            C        			;---------
   213            C        			;    1
   214            C        			;---------
   215            C        			;    2
   216            C        			;---------
   217            C        			;    3
   218            C        			;---------
   219            C        			;    4
   220            C        			;---------
   221            C        			;    5
   222            C        			;---------
   223            C        			;    6
   224            C        			;---------
   225            C        			;    7
   226            C        		;---------------------------
   227            C        		;    01    ;
   228            C        		;    :     ;
   229            C        		;    :	   ; Endpoint address
   230            C        		;    :     ;
   231            C        		;    0F    ;
   232            C        		;---------------------------
   233            C        		;    10	   ; EP0_STATUS
   234            C        		;---------------------------
   235            C        		;    11    ;
   236            C        		;    :     ;
   237            C        		;    :     ; EP_STATUS
   238            C        		;    :     ;
   239            C        		;    1F    ;
   240            C        		;---------------------------
   241            C        
   242            C        	;}
   243            C        
   244            C        ;====================================================================
   245       000E C        	RE          == 0X0E; USB APPLICATION FIFO DATA REGISTER A[0..3]POINTER [4..7]COUNTER
   246       000E C        	FIFODR      == 0X0E
   247            C        	;{
   248            C        
   249            C        	;}
   250            C        
   251            C        ;====================================================================
   252       000F C        	RF      == 0X0F; INTERRUPT STATUS REGISTER
   253       000F C        	ISR     == 0X0F; INTERRUPT STATUS REGISTER
   254            C        	;{
   255       0000 C        		TCCIF       == 0X00
   256       0001 C        		EP0IF       == 0X01
   257       0002 C        		USBSIF      == 0X02
   258       0003 C        		USBRIF      == 0X03
   259       0004 C        		P7SCIF      == 0X04
   260       0005 C        		SE1IF       == 0X05
   261       0006 C        		SE2IF       == 0X06
   262       0007 C        		USBHRIF     == 0X07
   263            C        	;}
   264            C        
   265            C        ;====================================================================
   266            C        
   267            C        
   268       0005 C        	IOC5		== 0X05;	port 5 direction control register
   269       0006 C        	IOC6		== 0X06;	port 6 direction control register
   270       0007 C        	IOC7		== 0X07;	port 7 direction control register
   271       0008 C        	IOC8		== 0X08; 	port 8 direction control register
   272       0009 C        	IOC9		== 0X09; 	port 9 direction control register
   273       000A C        	IOCA		== 0X0A; 	OPERATION MODE
   274            C        	;{
   275       0000 C        		USBM        == 0X00
   276       0001 C        		PS2M        == 0X01
   277       0002 C        		PDAM        == 0X02
   278       0003 C        		EXRegSel    == 0X03
   279            C        	;}
   280            C        ;====================================================================
   281       000B C        	IOCB		== 0X0B; PORT6 PULL-LOW
   282            C        
   283            C        ;====================================================================
   284       000C C        	IOCC		== 0X0C; PORT6 PULL-HIGH
   285            C        
   286            C        ;====================================================================
   287       000D C        	IOCD		== 0X0D; PORT7 PULL-HIGH
   288            C        
   289            C        ;====================================================================
   290       000E C        	IOCE		== 0X0E; SPECIAL FUNCTION
   291       000E C        	SFCR		== 0X0E;
   292            C        	;{
   293       0004 C        		RUN         == 0X04
   294       0005 C        		WTE         == 0X05
   295       0002 C        		_PULL8      == 0X02
   296       0001 C        		_PULL6      == 0X01
   297       0000 C        		_PULL5      == 0X00
   298            C        	;}
   299            C        
   300            C        ;====================================================================
   301       000F C        	IOCF    == 0X0F; INTERRUPT MASK
   302       000F C        	IMR     == 0X0F
   303            C        	;{
   304       0000 C        		TCIE        == 0X00
   305       0001 C        		EPOIE       == 0X01
   306       0002 C        		USBSIE      == 0X02
   307       0003 C        		USBRIE      == 0X03
   308       0004 C        		P5SCIE      == 0X04
   309       0005 C        		SE1IE       == 0X05
   310       0006 C        		SE2IE       == 0X06
   311       0004 C        		USBHRIE     == 0X04
   312            C        	;}
   313            C        
   314            C        
   315            C        
   316            C        
   317            C        ;======================================================;
   318            C        ; Register R10~R3F                                     ;
   319            C        ;======================================================;
   320            C        ;
   321            C        ; (R10 ~ R3F): General Purpose Register
   322            C        ;
   323       0010 C         R10    ==    0x10
   324       0011 C         R11    ==    0x11
   325       0012 C         R12    ==    0x12
   326       0013 C         R13    ==    0x13
   327       0014 C         R14    ==    0x14
   328       0015 C         R15    ==    0x15
   329       0016 C         R16    ==    0x16
   330       0017 C         R17    ==    0x17
   331       0018 C         R18    ==    0x18
   332       0019 C         R19    ==    0x19
   333       001A C         R1A    ==    0x1A
   334       001B C         R1B    ==    0x1B
   335       001C C         R1C    ==    0x1C
   336       001D C         R1D    ==    0x1D
   337       001E C         R1E    ==    0x1E
   338       001F C         R1F    ==    0x1F
   339            C        ;
   340       0020 C         R20    ==    0x20
   341       0021 C         R21    ==    0x21
   342       0022 C         R22    ==    0x22
   343       0023 C         R23    ==    0x23
   344       0024 C         R24    ==    0x24
   345       0025 C         R25    ==    0x25
   346       0026 C         R26    ==    0x26
   347       0027 C         R27    ==    0x27
   348       0028 C         R28    ==    0x28
   349       0029 C         R29    ==    0x29
   350       002A C         R2A    ==    0x2A
   351       002B C         R2B    ==    0x2B
   352       002C C         R2C    ==    0x2C
   353       002D C         R2D    ==    0x2D
   354       002E C         R2E    ==    0x2E
   355       002F C         R2F    ==    0x2F
   356            C        ;
   357       0030 C         R30    ==    0x30
   358       0031 C         R31    ==    0x31
   359       0032 C         R32    ==    0x32
   360       0033 C         R33    ==    0x33
   361       0034 C         R34    ==    0x34
   362       0035 C         R35    ==    0x35
   363       0036 C         R36    ==    0x36
   364       0037 C         R37    ==    0x37
   365       0038 C         R38    ==    0x38
   366       0039 C         R39    ==    0x39
   367       003A C         R3A    ==    0x3A
   368       003B C         R3B    ==    0x3B
   369       003C C         R3C    ==    0x3C
   370       003D C         R3D    ==    0x3D
   371       003E C         R3E    ==    0x3E
   372       003F C         R3F    ==    0x3F
    14                     include "D:\include\EM78xx\EM78CtrlIns.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;位操作类宏
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;条件分支结构类宏
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;中断压栈与出栈类宏
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 压栈程序
   284            C        ; 说明:中断入口调用此程序,将ACC,R3压栈
   285            C        ; A      -> A_TEMP
   286            C        ; R4    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;R4              ;SAVE R4(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;R4,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;R4,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;========================== EM78P520 =================================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;R4,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ; 跨页调用与跳转类宏
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; 选择程序页面
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; 智能跨页调用
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; 跨页调用
   426            C        ; 入口:NUM = 被调用程序页号,  ADDRESS =  B被调用程序地址
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; 智能跨页跳转
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ;跨页跳转
   460            C        ; 入口:NUM = 被调用程序页号,  ADDRESS =  B被调用程序地址
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; 选择程序页面
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611E.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C        	MOV     A, @0XE0        ; 清RAM 初始地址
   513            C        	MOV     R4, A           ;
   514            C        	CLR     BSR
   515            C        	;INC     BSR            ; BANK 0 is used for exchange reg(FIFO)
   516            C        ;CLEAR_RAM_LOOP_P510:
   517            C        	WDTC
   518            C        	CLR     R0
   519            C        	INC     R4
   520            C        	MOV     A,R4
   521            C        	AND     A,@0X3F
   522            C        	JBS     R3,Z
   523            C        	JMP     $-5            ; CLEAR_RAM_LOOP_P510
   524            C        	INC     BSR
   525            C        	MOV     A,BSR         ; 选择BANK0 (BSR == 0X05)
   526            C        	AND     A,@0X07
   527            C        	BS      R4,5
   528            C        	BS      R4,6
   529            C        	JBS     R3,2
   530            C        	JMP     $-13           ; CLEAR_RAM_LOOP_P510
   531            C        	CLR     R4
   532            C        	CLR     BSR
   533            C        	BS      R4,6
   534            C        
   535            C        ELSEIFDEF EM78M611E.H
   536            C         	MOV     A,@0x10
   537            C        	MOV     R4,A
   538            C        ;CLEAR_RAM_LOOP_M611:
   539            C        	CLR     R0
   540            C        	INC     R4
   541            C        	JBC     R4,6
   542            C        	BS      R4,5
   543            C        	JBC     R4,7
   544            C        	BS      R4,5
   545            C        	JBS     R3,Z
   546            C        	JMP     $-7            ; CLEAR_RAM_LOOP_M611:
   547            C        	CLR     R4
   548            C        
   549            C        	MOV     A,@0X11
   550            C        	MOV     RD,A
   551            C        	CLR     RE
   552            C        	MOV     A,@1
   553            C        	MOV     RD,A
   554            C        	MOV     A,@0X00
   555            C        	MOV     RE,A
   556            C        	MOV     RE,A
   557            C        	MOV     RE,A
   558            C        	MOV     RE,A
   559            C        	MOV     RE,A
   560            C        	MOV     RE,A
   561            C        	MOV     RE,A
   562            C        	MOV     RE,A
   563            C        	BS      RC,5
   564            C        
   565            C        ELSEIFDEF EM78P447.H
   566            C         	MOV     A,@0x10
   567            C        	MOV     R4,A
   568            C        ;CLEAR_RAM_LOOP_P447:
   569            C        	CLR     R0
   570            C        	INC     R4
   571            C        	JBC     R4,6
   572            C        	BS      R4,5
   573            C        	JBC     R4,7
   574            C        	BS      R4,5
   575            C        	JBS     R3,Z
   576            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P447:
   577            C        	CLR     R4
   578            C        
   579            C        ELSEIFDEF EM78P468.H
   580            C        	MOV     A,@0X10
   581            C        	MOV     R4,A
   582            C        ;CLEAR_RAM_LOOP_P468:
   583            C        	CLR     R0
   584            C        	INC     R4
   585            C        	JBC     R4,6
   586            C        	BS      R4,5
   587            C        	JBC     R4,7
   588            C        	BS      R4,5
   589            C        	JBS     STATUS,Z
   590            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P468
   591            C        	CLR     R4
   592            C        
   593            C        ELSEIFDEF EM78P458.H
   594            C                MOV     A,@0X10
   595            C                MOV     R4,A
   596            C        ;CLEAR_RAM_LOOP_P458:
   597            C                CLR     R0
   598            C                INC     R4
   599            C                JBC     R4,6
   600            C                BS      R4,5
   601            C                JBS     R4,7
   602            C                JMP     $-5        ; CLEAR_RAM_LOOP_P458
   603            C                CLR     R4
   604            C        
   605            C        ELSEIFDEF EM78P451.H
   606            C                MOV     A,@0X10
   607            C                MOV     R4,A
   608            C        ;CLEAR_RAM_LOOP_P451:
   609            C                CLR     R0
   610            C                INC     R4
   611            C                JBC     R4,6
   612            C                BS      R4,5
   613            C                JBC     R4,7
   614            C                BS      R4,5
   615            C                JBS     STATUS,Z
   616            C                JMP     $-7        ; CLEAR_RAM_LOOP_P451
   617            C        
   618            C        ELSE
   619            C        	MOV     A,@0x10        ; clear all ram bank
   620            C        	MOV     R4,A
   621            C        ;CLEAR_RAM_LOOP:
   622            C        	CLR     R0
   623            C        	INC     R4
   624            C        	JBC     R4,6
   625            C        	BS      R4,5
   626            C        	JBC     R4,7
   627            C        	BS      R4,5
   628            C        	JBS     R3,Z
   629            C        	JMP     $-7            ; CLEAR_RAM_LOOP:
   630            C        	CLR     R4
   631            C        	MESSAGE "Clear all RAM bank"
   632            C        ENDIF
   633            C        ENDM
   634            C        
   635            C        ;*******************************************
   636            C        ; RAM clear function
   637            C        ; [ELSE]: default the MCU have four bank
   638            C        ; others: xx.h must be define in "xx.h"
   639            C        ;*******************************************
   640            C        ClrCommRamBank MACRO
   641            C        	MOV                 A, @0X10                ; 清RAM 初始地址
   642            C        	MOV                 R4, A
   643            C        CLEAR_10_1F_RAM_LOOP:
   644            C        	WDTC
   645            C        	CLR                 R0
   646            C        	INC                 R4
   647            C        	MOV                 A,@0B00111111
   648            C        	AND                 A,R4
   649            C        	SUB                 A,@0X1F
   650            C        	JBC                 R3,C
   651            C        	JMP                 CLEAR_10_1F_RAM_LOOP
   652            C        	CLR                 R4
   653            C        ENDM
   654            C        
   655            C        
    15                     include "D:\include\EM78xx\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        ;**********************************************************************;
    18            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    19            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    20            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    21            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    22            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    23            C        ; Input:       reg_acc1                                                ;
    24            C        ; Output:      reg_acc3, reg_acc2                                      ;
    25            C        ; Variable Register:None                                               ;
    26            C        ; Register Changed: R3, 0 ;ACC                                         ;
    27            C        ;**********************************************************************;
    28            C        ;-----------------------------------------------------------------
    29            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    30            C        ;
    31            C                CLR     reg_acc2        ;clear BCD data register
    32            C                CLR     reg_acc3
    33            C                MOV     A, reg_acc1
    34            C        $Bin_Bcd1:
    35            C                ADD     A, @156         ;subtract 100 from binary that is transform
    36            C                JBS     STATUS, C       ;borrow bigit?
    37            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    38            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    39            C                JMP     $Bin_Bcd1       ;backing out
    40            C        $Bin_Bcd2:
    41            C                ADD     A, @100         ;有借位，则加回被减去的数100
    42            C                MOV     reg_acc1, A
    43            C        $Bin_Bcd3:
    44            C                ADD     A, @246         ;余下的被减数再减10
    45            C                JBS     STATUS, C       ;有借位吗？
    46            C                JMP     $Bin_Bcd4       ;有借位，则跳出
    47            C                INC     reg_acc2        ;无借位，则BCD码的十位寄存器加1
    48            C                JMP     $Bin_Bcd3
    49            C        $Bin_Bcd4:
    50            C                ADD     A, @10          ;有借位，则加回被减去的数10
    51            C                SWAP    reg_acc2        ;将BCD码的十位存到reg_acc2的高半字节
    52            C                ADD     reg_acc2, A     ;将BCD码的个位存到reg_acc2的低半字节
    53            C                ENDM
    54            C        ;
    55            C        ;**********************************************************************;
    56            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    57            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    58            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    59            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    60            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    61            C        ; Input:       reg_acc1, reg_acc2                                      ;
    62            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    63            C        ; Variable Register:reg_acc, reg_accd                                  ;
    64            C        ; Register Changed: R3, 0; ACC                                         ;
    65            C        ; Status:      1                                                       ;
    66            C        ;**********************************************************************;
    67            C        ;
    68            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    69            C        ;
    70            C                MOV     A, @16          ;设定移位字节长度(其值=byte*8)
    71            C                MOV     reg_acc, A
    72            C                CLR     reg_acc5        ;清BCD码寄存器
    73            C                CLR     reg_acc4
    74            C                CLR     reg_acc3
    75            C                BC      STATUS, C       ;清R3标志位C
    76            C        $Bin_Bcd1:
    77            C                RLC     reg_acc1        ;左移被转换的字节的最低位寄存器
    78            C                RLC     reg_acc2        ;左移被转换的字节的最高位寄存器
    79            C                RLC     reg_acc3        ;左移BCD码的最低位寄存器
    80            C                RLC     reg_acc4
    81            C                RLC     reg_acc5        ;左移BCD码的最高位寄存器
    82            C                DJZ     reg_acc         ;移位完成了吗？
    83            C                JMP     $Bin_Bcd2       ;未完，进行BCD码调整
    84            C                JMP     $Bin_Bcd3       ;移位完，跳出
    85            C        $Bin_Bcd2:
    86            C                MOV     A, reg_acc3     ;对reg_acc3进行BCD码调整
    87            C                CALL    $bcdadj         ;调BCD码调整子程序
    88            C                MOV     reg_acc3, A     ;
    89            C                MOV     A, reg_acc4     ;对reg_acc4进行BCD码调整
    90            C                CALL    $BCDADJ
    91            C                MOV     reg_acc4, A
    92            C                MOV     A, reg_acc5     ;对reg_acc5进行BCD码调整
    93            C                CALL    $BCDADJ
    94            C                MOV     reg_acc5, A
    95            C                JMP     $Bin_Bcd1       ;返回，继续进行移位处理
    96            C        ;-------BCD Code Adjust Subprogram---------------
    97            C        $BCDADJ:
    98            C                ADD     A, @51
    99            C                MOV     reg_accd, A
   100            C                JBS     reg_accd, 3
   101            C                ADD     A, @253
   102            C                JBS     reg_accd, 7
   103            C                ADD     A, @208
   104            C                RET
   105            C        $Bin_Bcd3:
   106            C                ENDM
   107            C        ;
   108            C        ;**********************************************************************;
   109            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   110            C        ; Description:reg_acc7的高半字节存放BCD码的最高位，                    ;
   111            C        ;             reg_acc4的低半字节存放BCD码的最低位,                     ;
   112            C        ;             reg_acc3存放被转换字节的最高位，                         ;
   113            C        ;             reg_acc1存放被转换字节的最低位。                         ;
   114            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   115            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   116            C        ; Variable Register:reg_acc, reg_accd                                  ;
   117            C        ; Register Changed: R3, 0;ACC                                          ;
   118            C        ; stack:      1                                                        ;
   119            C        ;**********************************************************************;
   120            C        ;
   121            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   122            C        ;
   123            C                MOV     A, @24          ;设定移位字节长度（其值=byte*8)
   124            C                MOV     reg_acc, A
   125            C                CLR     reg_acc4
   126            C                CLR     reg_acc5
   127            C                CLR     reg_acc6
   128            C                CLR     reg_acc7
   129            C                BC      STATUS, C       ;清R3标志位C
   130            C        $Bin_Bcd1:
   131            C                RLC     reg_acc1        ;左移被转换字节数的最低位寄存器
   132            C                RLC     reg_acc2
   133            C                RLC     reg_acc3        ;左移被转换字节数的最高位寄存器
   134            C                RLC     reg_acc4        ;左移BCD码的最低位寄存器
   135            C                RLC     reg_acc5
   136            C                RLC     reg_acc6
   137            C                RLC     reg_acc7        ;左移BCD码的最高位寄存器
   138            C                DJZ     reg_acc         ;移位完成了吗？
   139            C                JMP     $Bin_Bcd2       ;未完，进行BCD码调整
   140            C                JMP     $Bin_Bcd3       ;移位完，跳出
   141            C        $Bin_Bcd2:
   142            C                MOV     A, reg_acc4     ;对reg_acc4进行BCD码调整
   143            C                CALL    $BCDADJ         ;调BCD码调整子程序
   144            C                MOV     reg_acc4, A
   145            C                MOV     A, reg_acc5     ;对reg_acc5进行BCD码调整
   146            C                CALL    $BCDADJ
   147            C                MOV     reg_acc5, A
   148            C                MOV     A, reg_acc6     ;对reg_acc6进行BCD码调整
   149            C                CALL    $BCDADJ
   150            C                MOV     reg_acc6, A
   151            C                MOV     A, reg_acc7     ;对reg_acc7进行BCD码调整
   152            C                CALL    $BCDADJ
   153            C                MOV     reg_acc7, A
   154            C                JMP     $Bin_Bcd1       ;移位未完，返回，继续进行移位处理
   155            C        ;-------BCD Code Adjust Subprogram---------------
   156            C        $BCDADJ:
   157            C                ADD     A, @51
   158            C                MOV     reg_accd, A
   159            C                JBS     reg_accd, 3
   160            C                ADD     A, @253
   161            C                JBS     reg_accd, 7
   162            C                ADD     A, @208
   163            C                RET
   164            C        $Bin_Bcd3:
   165            C                ENDM
   166            C        ;
   167            C        ;**********************************************************************;
   168            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   169            C        ; Description:reg_acc9的高半字节存放BCD码的最高位，                    ;
   170            C        ;             reg_acc5的低半字节存放BCD码的最低位，                    ;
   171            C        ;             reg_acc4存放被转换字节的最高位，                         ;
   172            C        ;             reg_acc1存放被转换字节的最低位?                          ;
   173            C        ; Arithmetic:                                                          ;
   174            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   175            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   176            C        ; Variable Register:reg_acc, reg_accd                                  ;
   177            C        ; Register Changed: R3, 0; ACC                                         ;
   178            C        ; stack:      1                                                        ;
   179            C        ;**********************************************************************;
   180            C        ;
   181            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   182            C        ;
   183            C                MOV     A,  @32         ;设定移位字节长度(其值=byte*8)
   184            C                MOV     reg_acc, A
   185            C                CLR     reg_acc5        ;清BCD码寄存器
   186            C                CLR     reg_acc6
   187            C                CLR     reg_acc7
   188            C                CLR     reg_acc8
   189            C                CLR     reg_acc9
   190            C                BC      STATUS, C       ;清R3标志位C
   191            C        $Bin_Bcd1:
   192            C                RLC     reg_acc1        ;左移被转换字节数的最低位寄存器
   193            C                RLC     reg_acc2
   194            C                RLC     reg_acc3
   195            C                RLC     reg_acc4        ;左移被转换字节数的最高位寄存器
   196            C                RLC     reg_acc5
   197            C                RLC     reg_acc6        ;左移BCD码的最低位寄存器
   198            C                RLC     reg_acc7
   199            C                RLC     reg_acc8
   200            C                RLC     reg_acc9        ;左移BCD码的最高位寄存器
   201            C                DJZ     reg_acc         ;移位完成了吗？
   202            C                JMP     $Bin_Bcd2       ;未完，进行BCD码调整
   203            C                JMP     $Bin_Bcd3       ;移位完，跳出
   204            C        $Bin_Bcd2:
   205            C                MOV     A, reg_acc5     ;对reg_acc5进行BCD码调整
   206            C                CALL    $BCDADJ         ;调BCD码调整子程序
   207            C                MOV     reg_acc5, A
   208            C                MOV     A, reg_acc6     ;对reg_acc6进行BCD码调整
   209            C                CALL    $BCDADJ
   210            C                MOV     reg_acc6, A
   211            C                MOV     A, reg_acc7     ;对reg_acc7进行BCD码调整
   212            C                CALL    $BCDADJ
   213            C                MOV     reg_acc7, A
   214            C                MOV     A, reg_acc8     ;对reg_acc8进行BCD码调整
   215            C                CALL    $BCDADJ
   216            C                MOV     reg_acc8, A
   217            C                MOV     A, reg_acc9     ;对reg_acc9进行BCD码调整
   218            C                CALL    $BCDADJ
   219            C                MOV     reg_acc9, A
   220            C                JMP     $Bin_Bcd1       ;移位未完成，返回，继续进行移位处理
   221            C        ;-------BCD Code Adjust Subprogram---------------
   222            C        $BCDADJ:
   223            C                ADD     A, @51
   224            C                MOV     reg_accd, A
   225            C                JBS     reg_accd, 3
   226            C                ADD     A, @253
   227            C                JBS     reg_accd, 7
   228            C                ADD     A, @208
   229            C                RET
   230            C        $Bin_Bcd3:
   231            C                ENDM
   232            C        ;**********************************************************************;
   233            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   234            C        ; Description:reg_accc的低半字节存放BCD的最高位，                      ;
   235            C        ;             reg_acc6的低半字节存放BCD的最低位，                      ;
   236            C        ;             reg_acc5存放被转换字节的最高位，                         ;
   237            C        ;             reg_acc1存放被转换字节的最低位。                         ;
   238            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   239            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   240            C        ;             reg_accb, reg_accc                                       ;
   241            C        ; Variable Register:reg_acc, reg_accd                                  ;
   242            C        ; Register Changed: R3, 0;ACC                                          ;
   243            C        ; Stack:      1                                                        ;
   244            C        ;**********************************************************************;
   245            C        ;
   246            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   247            C        ;
   248            C                MOV     A,  @40         ;设定移位字节长度(其值=byte*8)
   249            C                MOV     reg_acc, A
   250            C                CLR     reg_acc6        ;清BCD码寄存器
   251            C                CLR     reg_acc7
   252            C                CLR     reg_acc8
   253            C                CLR     reg_acc9
   254            C                CLR     reg_acca
   255            C                CLR     reg_accb
   256            C                CLR     reg_accc
   257            C                BC      STATUS, C       ;清R3标志位C
   258            C        $Bin_Bcd1:
   259            C                RLC     reg_acc1
   260            C                RLC     reg_acc2
   261            C                RLC     reg_acc3        ;左移被转换字节的最低位寄存器
   262            C                RLC     reg_acc4        ;
   263            C                RLC     reg_acc5        ;左移被转换字节的最高位寄存器
   264            C        ;
   265            C                RLC     reg_acc6        ;左移BCD码寄存器的最低位
   266            C                RLC     reg_acc7
   267            C                RLC     reg_acc8
   268            C                RLC     reg_acc9
   269            C                RLC     reg_acca
   270            C                RLC     reg_accb
   271            C                RLC     reg_accc        ;左移BCD码寄存器的最高位
   272            C                DJZ     reg_acc         ;移位完成了吗？
   273            C                JMP     $Bin_Bcd2       ;未完，进行BCD码调整
   274            C                JMP     $Bin_Bcd3       ;移位完，跳出
   275            C        $Bin_Bcd2:
   276            C                MOV     A, reg_acc6     ;对reg_acc6进行BCD码调整
   277            C                CALL    $BCDADJ         ;调BCD码调整子程序
   278            C                MOV     reg_acc6, A
   279            C                MOV     A, reg_acc7     ;对reg_acc7进行BCD码调整
   280            C                CALL    $BCDADJ
   281            C                MOV     reg_acc7, A
   282            C                MOV     A, reg_acc8     ;对reg_acc8进行BCD码调整
   283            C                CALL    $BCDADJ
   284            C                MOV     reg_acc8, A
   285            C                MOV     A, reg_acc9     ;对reg_acc9进行BCD码调整
   286            C                CALL    $BCDADJ
   287            C                MOV     reg_acc9, A
   288            C                MOV     A, reg_acca     ;对reg_acca进行BCD码调整
   289            C                CALL    $BCDADJ
   290            C                MOV     reg_acca, A
   291            C                MOV     A, reg_accb     ;对reg_accb进行BCD码调整
   292            C                CALL    $BCDADJ
   293            C                MOV     reg_accb, A
   294            C                MOV     A, reg_accc     ;对reg_accc进行BCD码调整
   295            C                CALL    $BCDADJ
   296            C                MOV     reg_accc, A
   297            C                JMP     $Bin_Bcd1       ;未移完，返回，继续进行移位处理
   298            C        ;
   299            C        ;-------BCD Code Adjust Subprogram---------------
   300            C        $BCDADJ:
   301            C                ADD     A, @51
   302            C                MOV     reg_accd, A
   303            C                JBS     reg_accd, 3
   304            C                ADD     A, @253
   305            C                JBS     reg_accd, 7
   306            C                ADD     A, @208
   307            C                RET
   308            C        $Bin_Bcd3:
   309            C                ENDM
   310            C        ;
   311            C        ;**********************************************************************;
   312            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   313            C        ; Input:      reg_acc1(BCD code)                                       ;
   314            C        ; Output:     reg_acc2(Binary Code)                                    ;
   315            C        ; Register Changed: STATUS, C;ACC                                      ;
   316            C        ;**********************************************************************;
   317            C        ;
   318            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   319            C        ;
   320            C                CLR     reg_acc2
   321            C                SWAPA   reg_acc1        ;将reg_acc1的高半字节送到A的低半字节
   322            C                AND     A, @0X0F        ;屏蔽reg_acc1, 0-3bit.
   323            C                MOV     reg_acc2, A
   324            C                BC      STATUS, C
   325            C                RLC     reg_acc2        ;reg_acc2*10
   326            C                RLC     reg_acc2
   327            C                ADD     reg_acc2, A
   328            C                RLC     reg_acc2
   329            C                MOV     A, reg_acc1
   330            C                AND     A, @0X0F        ;屏蔽reg_acc1, 4-7bit
   331            C                ADD     reg_acc2, A     ;bcd code的十位数乘10后加bcd code的个位数
   332            C                ENDM
   333            C        ;
   334            C        ;**********************************************************************;
   335            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   336            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   337            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   338            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   339            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   340            C        ; Register Changed: STATUS, C; ACC                                     ;
   341            C        ; Stack:     1                                                         ;
   342            C        ;**********************************************************************;
   343            C        ;
   344            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   345            C        ;
   346            C                CLR     reg_acc3        ;clear binary code register
   347            C                CLR     reg_acc4
   348            C                MOV     A, @16          ;移位的次数（reg_acc==byte*8)
   349            C                Mov     reg_acc, A
   350            C        $Bcd_Bin1:
   351            C                BC      STATUS, C
   352            C                RRC     reg_acc2        ;将BCD数和BINARY数一起右移，从高移到低
   353            C                RRC     reg_acc1
   354            C                RRC     reg_acc4
   355            C                RRC     reg_acc3
   356            C                MOV     A, reg_acc1     ;对BCD数进行BCD调整
   357            C                CALL    $Binadj
   358            C                MOV     reg_acc1, A
   359            C                MOV     A, reg_acc2
   360            C                CALL    $Binadj
   361            C                MOV     reg_acc2, A
   362            C                DJZ     reg_acc
   363            C                JMP     $Bcd_Bin1
   364            C                JMP     $Bcd_Bin2
   365            C        $Binadj:
   366            C                MOV     reg_accd, A
   367            C                JBC     reg_accd, 3
   368            C                ADD     A, @253
   369            C                JBC     reg_accd, 7
   370            C                ADD     A, @208
   371            C                RET
   372            C        $Bcd_Bin2:
   373            C                ENDM
   374            C        ;
   375            C        ;**********************************************************************;
   376            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   377            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   378            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   379            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   380            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   381            C        ; Register Changed: STATUS, C; ACC                                     ;
   382            C        ; Stack:     1                                                         ;
   383            C        ;**********************************************************************;
   384            C        ;
   385            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   386            C        ;
   387            C                CLR     reg_acc4
   388            C                CLR     reg_acc5
   389            C                CLR     reg_acc6
   390            C                MOV     A, @24          ;移位的次数（reg_acc==BYTE*8)
   391            C                MOV     reg_acc, A
   392            C        $Bcd_Bin1:
   393            C                BC      STATUS, C
   394            C                RRC     reg_acc3
   395            C                RRC     reg_acc2
   396            C                RRC     reg_acc1
   397            C                RRC     reg_acc6
   398            C                RRC     reg_acc5
   399            C                RRC     reg_acc4
   400            C                MOV     A, reg_acc1
   401            C                CALL    $Binadj
   402            C                MOV     reg_acc1, A
   403            C                MOV     A, reg_acc2
   404            C                CALL    $Binadj
   405            C                MOV     reg_acc2, A
   406            C                MOV     A, reg_acc3
   407            C                CALL    $Binadj
   408            C                MOV     reg_acc3, A
   409            C                DJZ     reg_acc
   410            C                JMP     $Bcd_Bin1
   411            C                JMP     $Bcd_Bin2
   412            C        $Binadj:
   413            C                MOV     reg_accd, A
   414            C                JBC     reg_accd, 3
   415            C                ADD     A, @253
   416            C                JBC     reg_accd, 7
   417            C                ADD     A, @208
   418            C                RET
   419            C        $Bcd_Bin2:
   420            C                ENDM
   421            C        ;
   422            C        ;**********************************************************************;
   423            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   424            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   425            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   426            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   427            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   428            C        ; Register Changed: STATUS, C;ACC                                      ;
   429            C        ; Stack:     1                                                         ;
   430            C        ;**********************************************************************;
   431            C        ;
   432            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   433            C        ;
   434            C                CLR     reg_acc5
   435            C                CLR     reg_acc6
   436            C                CLR     reg_acc7
   437            C                CLR     reg_acc8
   438            C                MOV     A, @32          ;移位的次数（reg_acc==BYTE*8)
   439            C                MOV     reg_acc, A
   440            C        $Bcd_Bin1:
   441            C                BC      STATUS, C
   442            C                RRC     reg_acc4
   443            C                RRC     reg_acc3
   444            C                RRC     reg_acc2
   445            C                RRC     reg_acc1
   446            C                RRC     reg_acc8
   447            C                RRC     reg_acc7
   448            C                RRC     reg_acc6
   449            C                RRC     reg_acc5
   450            C                MOV     A, reg_acc1
   451            C                CALL    $Binadj
   452            C                MOV     reg_acc1, A
   453            C                MOV     A, reg_acc2
   454            C                CALL    $Binadj
   455            C                MOV     reg_acc2, A
   456            C                MOV     A, reg_acc3
   457            C                CALL    $Binadj
   458            C                MOV     reg_acc3, A
   459            C                MOV     A, reg_acc4
   460            C                CALL    $Binadj
   461            C                MOV     reg_acc4, A
   462            C                DJZ     reg_acc
   463            C                JMP     $Bcd_Bin1
   464            C                JMP     $Bcd_Bin2
   465            C        $Binadj:
   466            C                MOV     reg_accd, A
   467            C                JBC     reg_accd, 3
   468            C                ADD     A, @253
   469            C                JBC     reg_accd, 7
   470            C                ADD     A, @208
   471            C                RET
   472            C        $Bcd_Bin2:
   473            C                ENDM
   474            C        ;
   475            C        ;**********************************************************************;
   476            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   477            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   478            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   479            C        ;            Bcd Code.                                                 ;
   480            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   481            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   482            C        ;            Of Binary Code.                                           ;
   483            C        ; Register Changed: STATUS, C; ACC                                     ;
   484            C        ; Stack:     1                                                         ;
   485            C        ;**********************************************************************;
   486            C        ;
   487            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   488            C        ;
   489            C                CLR     reg_acc6
   490            C                CLR     reg_acc7
   491            C                CLR     reg_acc8
   492            C                CLR     reg_acc9
   493            C                CLR     reg_acca
   494            C                MOV     A, @40          ;移位的次数（reg_acc==BYTE*8)
   495            C                MOV     reg_acc, A
   496            C        $Bcd_Bin1:
   497            C                BC      STATUS, C
   498            C                RRC     reg_acc5
   499            C                RRC     reg_acc4
   500            C                RRC     reg_acc3
   501            C                RRC     reg_acc2
   502            C                RRC     reg_acc1
   503            C                RRC     reg_acca
   504            C                RRC     reg_acc9
   505            C                RRC     reg_acc8
   506            C                RRC     reg_acc7
   507            C                RRC     reg_acc6
   508            C                MOV     A, reg_acc1
   509            C                CALL    $Binadj
   510            C                MOV     reg_acc1, A
   511            C                MOV     A, reg_acc2
   512            C                CALL    $Binadj
   513            C                MOV     reg_acc2, A
   514            C                MOV     A, reg_acc3
   515            C                CALL    $Binadj
   516            C                MOV     reg_acc3, A
   517            C                MOV     A, reg_acc4
   518            C                CALL    $Binadj
   519            C                MOV     reg_acc4, A
   520            C                MOV     A, reg_acc5
   521            C                CALL    $Binadj
   522            C                MOV     reg_acc5, A
   523            C                DJZ     reg_acc
   524            C                JMP     $Bcd_Bin1
   525            C                JMP     $Bcd_Bin2
   526            C        $Binadj:
   527            C                MOV     reg_accd, A
   528            C                JBC     reg_accd, 3
   529            C                ADD     A, @253
   530            C                JBC     reg_accd, 7
   531            C                ADD     A, @208
   532            C                RET
   533            C        $Bcd_Bin2:
   534            C                ENDM
   535            C        
   536            C        
   537            C        ;*****************************************************************
   538            C        ;Function:    Subtration
   539            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   540            C        ;Output:      reg_acc2, reg_acc1
   541            C        ;description: reg_acc2/reg_acc1 is the reslut;
   542            C        ;             reg_acc3 is a symbol:
   543            C        ;             0X00 Mean reslut is plus
   544            C        ;             0X01 Mean reslut is negative
   545            C        ;*****************************************************************
   546            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   547            C                BC      STATUS,C
   548            C                MOV     A,reg_acc3
   549            C                SUB     reg_acc1,A
   550            C                JBC     STATUS,C
   551            C                JMP     Subtration_End  
   552            C                CLR     reg_acc3
   553            C                MOV     A,@0X01
   554            C                SUB     A,reg_acc2
   555            C                JBC     STATUS,C
   556            C                DEC     reg_acc2
   557            C                JBC     STATUS,C
   558            C                INC     reg_acc3        
   559            C        Subtration_End:
   560            C                ENDM
   561            C        
   562            C        ;**********************************************************************;
   563            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   564            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   565            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   566            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   567            C        ; Variable Register:None                                               ;
   568            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   569            C        ;**********************************************************************;
   570            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   571            C        ;
   572            C                MOV     A, @8           ;Recurrence Cortrol Data
   573            C                MOV     reg_acc, A
   574            C                CLRA                    ;Check Divisor Is Zero
   575            C                OR      A, reg_acc2     ;Divisor load into A register
   576            C                JBC     STATUS, 2
   577            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0，Exit Peration.
   578            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin Peration，Then A=1
   579            C        $_Div_Sub:
   580            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   581            C                RLC     reg_acc2
   582            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   583            C                SUB     reg_acc2, a
   584            C                JBC     STATUS, C
   585            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   586            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   587            C                ADD     reg_acc2, A     ;Revert Dividend
   588            C        $_Div_Cnt:
   589            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   590            C                JMP     $_Div_Sub
   591            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   592            C        $_Div_Out:
   593            C                ENDM
   594            C        ;
   595            C        ;**********************************************************************;
   596            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   597            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   598            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   599            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   600            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   601            C        ; Variable Register:None                                               ;
   602            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   603            C        ;**********************************************************************;
   604            C        ;
   605            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   606            C        ;
   607            C                MOV     A, @16          ;Recurrence Cortrol Data
   608            C                MOV     reg_acc, A
   609            C                CLRA                    ;Check Divisor Is Zero
   610            C                OR      A, reg_acc3     ;Divisor load into A register
   611            C                JBC     STATUS, Z
   612            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0，Exit Peration.
   613            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin Peration，Then A=1
   614            C        $_Div_Sub:
   615            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   616            C                RLC     reg_acc2
   617            C                RLC     reg_acc3
   618            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   619            C                JBS     STATUS, C
   620            C                JMP     $_Div_S_0
   621            C                SUB     reg_acc3, A
   622            C                JMP     $_Div_Cnt
   623            C        $_Div_S_0:
   624            C                SUB     reg_acc3, A
   625            C                JBC     STATUS, C
   626            C                JMP     $_Div_Cnt
   627            C                BC      reg_acc1, 0
   628            C                ADD     reg_acc3, A
   629            C        $_Div_Cnt:
   630            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   631            C                JMP     $_Div_Sub
   632            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   633            C        $_Div_Out:
   634            C                ENDM
   635            C        ;
   636            C        ;**********************************************************************;
   637            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   638            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   639            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   640            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   641            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   642            C        ; Variable Register:None                                               ;
   643            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   644            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   645            C        ;**********************************************************************;
   646            C        ;
   647            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   648            C        ;
   649            C                CLRA
   650            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   651            C                OR      A, reg_acc4
   652            C                JBC     STATUS, Z
   653            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0，Exit Peration.
   654            C                MOV     A, @16          ;Recurrence Cortrol Data
   655            C                MOV     reg_acc, A
   656            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin Peration，Then A=1
   657            C                CLR     reg_acc6
   658            C        $_Div_Sub:
   659            C                BC      STATUS, C       ;Clear c Flag
   660            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   661            C                RLC     reg_acc2
   662            C                RLC     reg_acc5
   663            C                RLC     reg_acc6
   664            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   665            C                SUB     A, reg_acc6     ;Check High Word  Equal
   666            C                JBS     STATUS, Z
   667            C                JMP     $_Div_Set
   668            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   669            C                SUB     A, reg_acc5
   670            C        $_Div_Set:
   671            C                JBS     STATUS, C
   672            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   673            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   674            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   675            C                SUB     reg_acc5, A     ;Save Diviso
   676            C                JBS     STATUS, C
   677            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   678            C                MOV     A, reg_acc4
   679            C                SUB     reg_acc6, A
   680            C        $_Div_S_0:
   681            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   682            C                JMP     $_Div_Sub
   683            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   684            C                MOV     reg_acc4, A
   685            C                MOV     A, reg_acc5
   686            C                MOV     reg_acc3, A
   687            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   688            C        $_Div_Out:
   689            C                ENDM
   690            C        ;
   691            C        ;**********************************************************************;
   692            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   693            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   694            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   695            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   696            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   697            C        ; Variable Register:None                                               ;
   698            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   699            C        ;**********************************************************************;
   700            C        ;
   701            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   702            C        ;
   703            C                MOV     A, @24          ;Recurrence Cortrol Data
   704            C                MOV     reg_acc, A
   705            C                CLRA                    ;Check Divisor Is Zero
   706            C                OR      A, reg_acc4     ;Divisor load into A register
   707            C                JBC     STATUS, Z
   708            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0，Exit Peration.
   709            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin Peration，Then A=1
   710            C        $_Div_Sub:
   711            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   712            C                RLC     reg_acc2
   713            C                RLC     reg_acc3
   714            C                RLC     reg_acc4
   715            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   716            C                JBS     STATUS, C
   717            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   718            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   719            C                JMP     $_Div_Cnt
   720            C        $_Div_S_0:
   721            C                SUB     reg_acc4, A
   722            C                JBC     STATUS, C
   723            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   724            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   725            C                ADD     reg_acc4, A     ;Revert Dividend
   726            C        $_Div_Cnt:
   727            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   728            C                JMP     $_Div_Sub
   729            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   730            C        $_Div_Out:
   731            C                ENDM
   732            C        ;
   733            C        ;**********************************************************************;
   734            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   735            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   736            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   737            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   738            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   739            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   740            C        ;               Remainder reg_acc5, reg_acc4                           ;
   741            C        ; Variable Register: None                                              ;
   742            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   743            C        ;                   , reg_acc7(0x27)                                   ;
   744            C        ;**********************************************************************;
   745            C        ;
   746            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   747            C        ;
   748            C                CLRA
   749            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   750            C                OR      A, reg_acc5
   751            C                JBC     STATUS, Z
   752            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0，Exit Peration.
   753            C                MOV     A, @24          ;Recurrence Cortrol Data
   754            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin Peration，Then A=1.
   755            C                CLR     reg_acc6        ;clear Remainder register
   756            C                CLR     reg_acc7
   757            C        $_Div_Sub:
   758            C                BC      STATUS, C       ;Clear c Flag
   759            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   760            C                RLC     reg_acc2
   761            C                RLC     reg_acc3
   762            C                RLC     reg_acc6
   763            C                RLC     reg_acc7
   764            C                JBC     STATUS, C
   765            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   766            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   767            C                SUB     A, reg_acc7     ;Check High Word  Equal
   768            C                JBS     STATUS, Z
   769            C                JMP     $_Div_Set
   770            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   771            C                SUB     A, reg_acc6
   772            C        $_Div_Set:
   773            C                JBS     STATUS, C
   774            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   775            C        $_Div_Set_1:
   776            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   777            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   778            C                SUB     reg_acc6, A     ;Save Diviso
   779            C                JBS     STATUS, C
   780            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   781            C                MOV     A, reg_acc5
   782            C                SUB     reg_acc7, A
   783            C        $_Div_S_0:
   784            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   785            C                JMP     $_Div_Sub
   786            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   787            C                MOV     reg_acc5, A
   788            C                MOV     A, reg_acc6
   789            C                MOV     reg_acc4, A
   790            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   791            C        $_Div_Out:
   792            C                ENDM
   793            C        ;
   794            C        ;**********************************************************************;
   795            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   796            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   797            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   798            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   799            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   800            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   801            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   802            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   803            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   804            C        ; Variable Register:None                                               ;
   805            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   806            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   807            C        ;**********************************************************************;
   808            C        ;
   809            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   810            C        ;
   811            C                CLRA
   812            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   813            C                OR      A, reg_acc5
   814            C                OR      A, reg_acc6
   815            C                JBC     STATUS, Z
   816            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0，Exit Peration.
   817            C                MOV     A, @24          ;Recurrence Cortrol Data
   818            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin Peration，Then A=1.
   819            C                CLR     reg_acc7        ;clear Remainder register
   820            C                CLR     reg_acc8
   821            C                CLR     reg_acc9
   822            C        $_Div_Sub:
   823            C                BC      STATUS, C       ;Clear c Flag
   824            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   825            C                RLC     reg_acc2
   826            C                RLC     reg_acc3
   827            C                RLC     reg_acc7
   828            C                RLC     reg_acc8
   829            C                RLC     reg_acc9
   830            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   831            C                SUB     A, reg_acc9     ;Check High Word  Equal
   832            C                JBS     STATUS, Z
   833            C                JMP     $_Div_Set
   834            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   835            C                SUB     A, reg_acc8
   836            C                JBS     STATUS, Z
   837            C                JMP     $_Div_Set
   838            C                MOV     A, reg_acc4
   839            C                SUB     A, reg_acc7
   840            C        $_Div_Set:
   841            C                JBS     STATUS, C
   842            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   843            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   844            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   845            C                SUB     reg_acc7, A     ;Save Diviso
   846            C                JBS     STATUS, C
   847            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   848            C                MOV     A, reg_acc5
   849            C                SUB     reg_acc8, A
   850            C                JBS     STATUS, C
   851            C                DEC     reg_acc9
   852            C                MOV     A, reg_acc6
   853            C                SUB     reg_acc9, A
   854            C        $_Div_S_0:
   855            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   856            C                JMP     $_Div_Sub
   857            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   858            C                MOV     reg_acc6, A
   859            C                MOV     A, reg_acc8
   860            C                MOV     reg_acc5, A
   861            C                MOV     A, reg_acc7
   862            C                MOV     reg_acc4, A
   863            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   864            C        $_Div_Out:
   865            C                ENDM
   866            C        ;
   867            C        ;**********************************************************************;
   868            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   869            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   870            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   871            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   872            C        ;               Divisor   reg_acc5                                     ;
   873            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   874            C        ;               Remainder reg_acc5                                     ;
   875            C        ; Variable Register:None                                               ;
   876            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   877            C        ;**********************************************************************;
   878            C        ;
   879            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   880            C        ;
   881            C                MOV     A, @32          ;Recurrence Cortrol Data
   882            C                MOV     reg_acc, A
   883            C                CLRA                    ;Check Divisor Is Zero
   884            C                OR      A, reg_acc5     ;Divisor load into A register
   885            C                JBC     STATUS, Z
   886            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0，Exit Peration.
   887            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin Peration，Then A=1.
   888            C        $_Div_Sub:
   889            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   890            C                RLC     reg_acc2
   891            C                RLC     reg_acc3
   892            C                RLC     reg_acc4
   893            C                RLC     reg_acc5
   894            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   895            C                JBS     STATUS, C
   896            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   897            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   898            C                JMP     $_Div_Cnt
   899            C        $_Div_S_0:
   900            C                SUB     reg_acc5, A
   901            C                JBC     STATUS, C
   902            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   903            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   904            C                ADD     reg_acc5, A     ;Revert Dividend
   905            C        $_Div_Cnt:
   906            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   907            C                JMP     $_Div_Sub
   908            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   909            C        $_Div_Out:
   910            C                ENDM
   911            C        ;
   912            C        ;**********************************************************************;
   913            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   914            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   915            C        ;               (reg_acc6, reg_acc5)                                   ;
   916            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   917            C        ;               --(reg_acc6, reg_acc5)                                 ;
   918            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   919            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   920            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   921            C        ;               Remainder reg_acc6, reg_acc5                           ;
   922            C        ; Variable Register:None                                               ;
   923            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   924            C        ;                   , reg_acc8(0x28)                                   ;
   925            C        ;**********************************************************************;
   926            C        ;
   927            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   928            C        ;
   929            C                CLRA
   930            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   931            C                OR      A, reg_acc5
   932            C                JBC     STATUS, Z
   933            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0，Exit Peration.
   934            C                MOV     A, @32          ;Recurrence Cortrol Data
   935            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin Peration，Then A=1.
   936            C                CLR     reg_acc7        ;clear Remainder register
   937            C                CLR     reg_acc8
   938            C        $_Div_Sub:
   939            C                BC      STATUS, C       ;Clear c Flag
   940            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   941            C                RLC     reg_acc2
   942            C                RLC     reg_acc3
   943            C                RLC     reg_acc4
   944            C                RLC     reg_acc7
   945            C                RLC     reg_acc8
   946            C                JBC     STATUS, C
   947            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   948            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   949            C                SUB     A, reg_acc8     ;Check High Word  Equal
   950            C                JBS     STATUS, Z
   951            C                JMP     $_Div_Set
   952            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   953            C                SUB     A, reg_acc7
   954            C        $_Div_Set:
   955            C                JBS     STATUS, C
   956            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   957            C        $_Div_Set_1:
   958            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   959            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   960            C                SUB     reg_acc7, A     ;Save Divisor
   961            C                JBS     STATUS, C
   962            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   963            C                MOV     A, reg_acc6
   964            C                SUB     reg_acc8, A
   965            C        $_Div_S_0:
   966            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   967            C                JMP     $_Div_Sub
   968            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   969            C                MOV     reg_acc6, A
   970            C                MOV     A, reg_acc7
   971            C                MOV     reg_acc5, A
   972            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   973            C        $_Div_Out:
   974            C                ENDM
   975            C        ;
   976            C        ;**********************************************************************;
   977            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   978            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   979            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   980            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   981            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   982            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   983            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   984            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   985            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   986            C        ; Variable Register:None                                               ;
   987            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   988            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   989            C        ;**********************************************************************;
   990            C        ;
   991            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   992            C        ;
   993            C                CLRA
   994            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   995            C                OR      A, reg_acc6
   996            C                OR      A, reg_acc5
   997            C                JBC     STATUS, Z
   998            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0，Exit Peration.
   999            C                MOV     A, @32          ;Recurrence Cortrol Data
  1000            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin Peration，Then A=1.
  1001            C                CLR     reg_acc8        ;clear Remainder register
  1002            C                CLR     reg_acc9
  1003            C                CLR     reg_acca
  1004            C        $_Div_Sub:
  1005            C                BC      STATUS, 0       ;Clear c Flag
  1006            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1007            C                RLC     reg_acc2
  1008            C                RLC     reg_acc3
  1009            C                RLC     reg_acc4
  1010            C                RLC     reg_acc8
  1011            C                RLC     reg_acc9
  1012            C                RLC     reg_acca
  1013            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1014            C                JMP     $_Div_Set_1
  1015            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1016            C                SUB     A, reg_acca     ;Check High Word  Equal
  1017            C                JBS     STATUS, Z
  1018            C                JMP     $_Div_Set
  1019            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1020            C                SUB     A, reg_acc9
  1021            C                JBS     STATUS, Z
  1022            C                JMP     $_Div_Set
  1023            C                MOV     A, reg_acc5
  1024            C                SUB     A, reg_acc8
  1025            C        $_Div_Set:
  1026            C                JBS     STATUS, C
  1027            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1028            C        $_Div_Set_1:
  1029            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1030            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1031            C                SUB     reg_acc8, A     ;Save Divisor
  1032            C                JBS     STATUS, C
  1033            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1034            C                MOV     A, reg_acc6
  1035            C                SUB     reg_acc9, A
  1036            C                JBS     STATUS, C
  1037            C                DEC     reg_acca
  1038            C                MOV     A, reg_acc7
  1039            C                SUB     reg_acca, A
  1040            C        $_Div_S_0:
  1041            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1042            C                JMP     $_Div_Sub
  1043            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1044            C                MOV     reg_acc7, A
  1045            C                MOV     A, reg_acc9
  1046            C                MOV     reg_acc6, A
  1047            C                MOV     A, reg_acc8
  1048            C                MOV     reg_acc5, A
  1049            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1050            C        $_Div_Out:
  1051            C                ENDM
  1052            C        ;
  1053            C        ;**********************************************************************;
  1054            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1055            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1056            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1057            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1058            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1059            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1060            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1061            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1062            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1063            C        ; Variable Register:None                                               ;
  1064            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1065            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1066            C        ;**********************************************************************;
  1067            C        ;
  1068            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1069            C        ;
  1070            C                CLRA
  1071            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1072            C                OR      A, reg_acc7
  1073            C                OR      A, reg_acc6
  1074            C                OR      A, reg_acc5
  1075            C                JBC     STATUS, Z
  1076            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0，Exit Peration.
  1077            C                MOV     A, @32          ;Recurrence Cortrol Data
  1078            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin Peration，Then A=1.
  1079            C                CLR     reg_acc9        ;clear Remainder register
  1080            C                CLR     reg_acca
  1081            C                CLR     reg_accb
  1082            C                CLR     reg_accc
  1083            C        $_Div_Sub:
  1084            C                BC      STATUS, C       ;Clear c Flag
  1085            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1086            C                RLC     reg_acc2
  1087            C                RLC     reg_acc3
  1088            C                RLC     reg_acc4
  1089            C                RLC     reg_acc9
  1090            C                RLC     reg_acca
  1091            C                RLC     reg_accb
  1092            C                RLC     reg_accc
  1093            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1094            C                SUB     A, reg_accc     ;Check High Word  Equal
  1095            C                JBS     STATUS, Z
  1096            C                JMP     $_Div_Set
  1097            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1098            C                SUB     A, reg_accb
  1099            C                JBS     STATUS, Z
  1100            C                JMP     $_Div_Set
  1101            C                MOV     A, reg_acc6
  1102            C                SUB     A, reg_acca
  1103            C                JBS     STATUS, Z
  1104            C                JMP     $_Div_Set
  1105            C                MOV     A, reg_acc5
  1106            C                SUB     A, reg_acc9
  1107            C        $_Div_Set:
  1108            C                JBS     STATUS, C
  1109            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1110            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1111            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1112            C                SUB     reg_acc9, A     ;Save Divisor
  1113            C                JBS     STATUS, C
  1114            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1115            C                MOV     A, reg_acc6
  1116            C                SUB     reg_acca, A
  1117            C                JBS     STATUS, C
  1118            C                DEC     reg_accb
  1119            C                MOV     A, reg_acc7
  1120            C                SUB     reg_accb, A
  1121            C                JBS     STATUS, C
  1122            C                DEC     reg_accc
  1123            C                MOV     A, reg_acc8
  1124            C                SUB     reg_accc, A
  1125            C        $_Div_S_0:
  1126            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1127            C                JMP     $_Div_Sub
  1128            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1129            C                MOV     reg_acc8, A
  1130            C                MOV     A, reg_accb
  1131            C                MOV     reg_acc7, A
  1132            C                MOV     A, reg_acca
  1133            C                MOV     reg_acc6, A
  1134            C                MOV     A, reg_acc9
  1135            C                MOV     reg_acc5, A
  1136            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1137            C        $_Div_Out:
  1138            C                ENDM
  1139            C        ;
  1140            C        ;**********************************************************************;
  1141            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1142            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1143            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1144            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1145            C        ; Register change:reg_acc                                              ;
  1146            C        ;**********************************************************************;
  1147            C        ;
  1148            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1149            C        ;
  1150            C                MOV     A, @8
  1151            C                MOV     reg_acc, A
  1152            C                MOV     A, reg_acc2
  1153            C                CLR     reg_acc2
  1154            C        $Mul11_Loop:
  1155            C                BC      STATUS, C
  1156            C                JBC     reg_acc1, 0
  1157            C                ADD     reg_acc2, A
  1158            C                RRC     reg_acc2
  1159            C                RRC     reg_acc1
  1160            C        ;
  1161            C                DJZ     reg_acc
  1162            C                JMP     $Mul11_Loop
  1163            C                ENDM
  1164            C        ;
  1165            C        ;**********************************************************************;
  1166            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1167            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1168            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1169            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1170            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Register change:reg_acc                                              ;
  1172            C        ;**********************************************************************;
  1173            C        ;
  1174            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1175            C        ;
  1176            C                MOV     A, @16
  1177            C                MOV     reg_acc, A
  1178            C                MOV     A, reg_acc3
  1179            C                CLR     reg_acc3
  1180            C        $Mul12_Loop:
  1181            C                BC      STATUS, C
  1182            C                JBC     reg_acc1, 0
  1183            C                ADD     reg_acc3, A
  1184            C                RRC     reg_acc3
  1185            C                RRC     reg_acc2
  1186            C                RRC     reg_acc1
  1187            C        ;
  1188            C                DJZ     reg_acc
  1189            C                JMP     $Mul12_Loop
  1190            C                ENDM
  1191            C        ;
  1192            C        ;**********************************************************************;
  1193            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1194            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1195            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1196            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1197            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Register change:reg_acc                                              ;
  1199            C        ;**********************************************************************;
  1200            C        ;
  1201            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1202            C        ;
  1203            C                MOV     A, @24
  1204            C                MOV     reg_acc, A
  1205            C                MOV     A, reg_acc4
  1206            C                CLR     reg_acc4
  1207            C        $Mul13_Loop:
  1208            C                BC      STATUS, C
  1209            C                JBC     reg_acc1, 0
  1210            C                ADD     reg_acc4, A
  1211            C                RRC     reg_acc4
  1212            C                RRC     reg_acc3
  1213            C                RRC     reg_acc2
  1214            C                RRC     reg_acc1
  1215            C        ;
  1216            C                DJZ     reg_acc
  1217            C                JMP     $Mul13_Loop
  1218            C                ENDM
  1219            C        ;
  1220            C        ;**********************************************************************;
  1221            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1222            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1223            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1224            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1225            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Register change:reg_acc                                              ;
  1227            C        ;**********************************************************************;
  1228            C        ;
  1229            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1230            C        ;
  1231            C                MOV     A, @32
  1232            C                MOV     reg_acc, A
  1233            C                MOV     A, reg_acc5
  1234            C                CLR     reg_acc5
  1235            C        $Mul14_Loop:
  1236            C                BC      STATUS, C
  1237            C                JBC     reg_acc1, 0
  1238            C                ADD     reg_acc5, A
  1239            C                RRC     reg_acc5
  1240            C                RRC     reg_acc4
  1241            C                RRC     reg_acc3
  1242            C                RRC     reg_acc2
  1243            C                RRC     reg_acc1
  1244            C        ;
  1245            C                DJZ     reg_acc
  1246            C                JMP     $Mul14_Loop
  1247            C                ENDM
  1248            C        ;
  1249            C        ;**********************************************************************;
  1250            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1251            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1252            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1253            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1254            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1256            C        ;**********************************************************************;
  1257            C        ;
  1258            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1259            C        ;
  1260            C                MOV     A, @16
  1261            C                MOV     reg_acc, A
  1262            C                MOV     A, reg_acc4
  1263            C                MOV     reg_acc6, A
  1264            C                MOV     A, reg_acc3
  1265            C                MOV     reg_acc5, A
  1266            C                CLR     reg_acc3
  1267            C                CLR     reg_acc4
  1268            C        $Mul22_Loop:
  1269            C                BC      STATUS, C
  1270            C                JBS     reg_acc1, 0
  1271            C                JMP     $Mul22_Rs
  1272            C                MOV     A, reg_acc5
  1273            C                ADD     reg_acc3, A
  1274            C        ;--------------------------------------
  1275            C                MOV     A, reg_acc4
  1276            C                JBC     STATUS, C
  1277            C                ADD     A, @1
  1278            C                RLC     reg_acc
  1279            C                ADD     A, reg_acc6
  1280            C                MOV     reg_acc4, A
  1281            C                JBC     STATUS, C
  1282            C                BS      reg_acc, 0
  1283            C                RRC     reg_acc
  1284            C        $Mul22_Rs:
  1285            C                RRC     reg_acc4
  1286            C                RRC     reg_acc3
  1287            C                RRC     reg_acc2
  1288            C                RRC     reg_acc1
  1289            C        ;
  1290            C                BC      reg_acc, 7
  1291            C                DJZ     reg_acc
  1292            C                JMP     $Mul22_Loop
  1293            C                ENDM
  1294            C        ;
  1295            C        ;**********************************************************************;
  1296            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1297            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1298            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1299            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1300            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1302            C        ;**********************************************************************;
  1303            C        ;
  1304            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1305            C        ;
  1306            C                MOV     A, @24
  1307            C                MOV     reg_acc, A
  1308            C                MOV     A, reg_acc5
  1309            C                MOV     reg_acc7, A
  1310            C                MOV     A, reg_acc4
  1311            C                MOV     reg_acc6, A
  1312            C                CLR     reg_acc4
  1313            C                CLR     reg_acc5
  1314            C        $Mul23_Loop:
  1315            C                BC      STATUS, C
  1316            C                JBS     reg_acc1, 0
  1317            C                JMP     $Mul23_Rs
  1318            C                MOV     A, reg_acc6
  1319            C                ADD     reg_acc4, A
  1320            C        ;--------------------------------------
  1321            C                MOV     A, reg_acc5
  1322            C                JBC     STATUS, C
  1323            C                ADD     A, @1
  1324            C                RLC     reg_acc
  1325            C                ADD     A, reg_acc7
  1326            C                MOV     reg_acc5, A
  1327            C                JBC     STATUS, C
  1328            C                BS      reg_acc, 0
  1329            C                RRC     reg_acc
  1330            C        $Mul23_Rs:
  1331            C                RRC     reg_acc5
  1332            C                RRC     reg_acc4
  1333            C                RRC     reg_acc3
  1334            C                RRC     reg_acc2
  1335            C                RRC     reg_acc1
  1336            C        ;
  1337            C                BC      reg_acc, 7
  1338            C                DJZ     reg_acc
  1339            C                JMP     $Mul23_Loop
  1340            C                ENDM
  1341            C        ;
  1342            C        ;**********************************************************************;
  1343            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1344            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1345            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1346            C        ;                 , reg_acc2, reg_acc1)                                ;
  1347            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1348            C        ;                 reg_acc6                                             ;
  1349            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1350            C        ;                 reg_acc6                                             ;
  1351            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1352            C        ;**********************************************************************;
  1353            C        ;
  1354            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1355            C        ;
  1356            C                MOV     A, @32
  1357            C                MOV     reg_acc, A
  1358            C                MOV     A, reg_acc6
  1359            C                MOV     reg_acc8, A
  1360            C                MOV     A, reg_acc5
  1361            C                MOV     reg_acc7, A
  1362            C                CLR     reg_acc5
  1363            C                CLR     reg_acc6
  1364            C        $Mul24_Loop:
  1365            C                BC      STATUS, C
  1366            C                JBS     reg_acc1, 0
  1367            C                JMP     $Mul24_Rs
  1368            C                MOV     A, reg_acc7
  1369            C                ADD     reg_acc5, A
  1370            C        ;--------------------------------------
  1371            C                MOV     A, reg_acc6
  1372            C                JBC     STATUS, C
  1373            C                ADD     A, @1
  1374            C                RLC     reg_acc
  1375            C                ADD     A, reg_acc8
  1376            C                MOV     reg_acc6, A
  1377            C                JBC     STATUS, C
  1378            C                BS      reg_acc, 0
  1379            C                RRC     reg_acc
  1380            C        $Mul24_Rs:
  1381            C                RRC     reg_acc6
  1382            C                RRC     reg_acc5
  1383            C                RRC     reg_acc4
  1384            C                RRC     reg_acc3
  1385            C                RRC     reg_acc2
  1386            C                RRC     reg_acc1
  1387            C        ;
  1388            C                BC      reg_acc, 7
  1389            C                DJZ     reg_acc
  1390            C                JMP     $Mul24_Loop
  1391            C                ENDM
  1392            C        ;
  1393            C        ;**********************************************************************;
  1394            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1395            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1396            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1397            C        ;                 , reg_acc2, reg_acc1)                                ;
  1398            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1399            C        ;                 , reg_acc6                                           ;
  1400            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1401            C        ;                 , reg_acc6                                           ;
  1402            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1403            C        ;**********************************************************************;
  1404            C        ;
  1405            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1406            C        ;
  1407            C                MOV     A, @24
  1408            C                MOV     reg_acc, A
  1409            C                MOV     A, reg_acc4
  1410            C                MOV     reg_acc7, A
  1411            C                MOV     A, reg_acc5
  1412            C                MOV     reg_acc8, A
  1413            C                MOV     A, reg_acc6
  1414            C                MOV     reg_acc9, A
  1415            C                CLR     reg_acc4
  1416            C                CLR     reg_acc5
  1417            C                CLR     reg_acc6
  1418            C        $Mul33_Loop:
  1419            C                BC      STATUS, C
  1420            C                JBS     reg_acc1, 0
  1421            C                JMP     $Mul33_Rs
  1422            C                MOV     A, reg_acc7
  1423            C                ADD     reg_acc4, A
  1424            C        ;--------------------------------------
  1425            C                MOV     A, reg_acc5
  1426            C                JBC     STATUS, C
  1427            C                ADD     A, @1
  1428            C                RLC     reg_acc
  1429            C                ADD     A, reg_acc8
  1430            C                MOV     reg_acc5, A
  1431            C                JBC     STATUS, C
  1432            C                BS      reg_acc, 0
  1433            C                RRC     reg_acc
  1434            C        ;--------------------------------------
  1435            C                MOV     A, reg_acc6
  1436            C                JBC     STATUS, C
  1437            C                ADD     A, @1
  1438            C                RLC     reg_acc
  1439            C                ADD     A, reg_acc9
  1440            C                MOV     reg_acc6, A
  1441            C                JBC     STATUS, C
  1442            C                BS      reg_acc, 0
  1443            C                RRC     reg_acc
  1444            C        $Mul33_Rs:
  1445            C                RRC     reg_acc6
  1446            C                RRC     reg_acc5
  1447            C                RRC     reg_acc4
  1448            C                RRC     reg_acc3
  1449            C                RRC     reg_acc2
  1450            C                RRC     reg_acc1
  1451            C        ;
  1452            C                BC      reg_acc, 7
  1453            C                DJZ     reg_acc
  1454            C                JMP     $Mul33_Loop
  1455            C                ENDM
  1456            C        ;
  1457            C        ;**********************************************************************;
  1458            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1459            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1460            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1461            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1462            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1463            C        ;                 , reg_acc6, reg_acc7                                 ;
  1464            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1465            C        ;                 , reg_acc6, reg_acc7                                 ;
  1466            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1467            C        ;**********************************************************************;
  1468            C        ;
  1469            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1470            C        ;
  1471            C                MOV     A, @32
  1472            C                MOV     reg_acc, A
  1473            C                MOV     A, reg_acc5
  1474            C                MOV     reg_acc8, A
  1475            C                MOV     A, reg_acc6
  1476            C                MOV     reg_acc9, A
  1477            C                MOV     A, reg_acc7
  1478            C                MOV     reg_acca, A
  1479            C                CLR     reg_acc5
  1480            C                CLR     reg_acc6
  1481            C                CLR     reg_acc7
  1482            C        $Mul34_Loop:
  1483            C                BC      STATUS, C
  1484            C                JBS     reg_acc1, 0
  1485            C                JMP     $Mul34_Rs
  1486            C                MOV     A, reg_acc8
  1487            C                ADD     reg_acc5, A
  1488            C        ;--------------------------------------
  1489            C                MOV     A, reg_acc6
  1490            C                JBC     STATUS, C
  1491            C                ADD     A, @1
  1492            C                RLC     reg_acc
  1493            C                ADD     A, reg_acc9
  1494            C                MOV     reg_acc6, A
  1495            C                JBC     STATUS, C
  1496            C                BS      reg_acc, 0
  1497            C                RRC     reg_acc
  1498            C        ;--------------------------------------
  1499            C                MOV     A, reg_acc7
  1500            C                JBC     STATUS, C
  1501            C                ADD     A, @1
  1502            C                RLC     reg_acc
  1503            C                ADD     A, reg_acca
  1504            C                MOV     reg_acc7, A
  1505            C                JBC     STATUS, C
  1506            C                BS      reg_acc, 0
  1507            C                RRC     reg_acc
  1508            C        $Mul34_Rs:
  1509            C                RRC     reg_acc7
  1510            C                RRC     reg_acc6
  1511            C                RRC     reg_acc5
  1512            C                RRC     reg_acc4
  1513            C                RRC     reg_acc3
  1514            C                RRC     reg_acc2
  1515            C                RRC     reg_acc1
  1516            C        ;
  1517            C                BC      reg_acc, 7
  1518            C                DJZ     reg_acc
  1519            C                JMP     $Mul34_Loop
  1520            C                ENDM
  1521            C        ;
  1522            C        ;**********************************************************************;
  1523            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1524            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1525            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1526            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1527            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1528            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1529            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1530            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1531            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1532            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1533            C        ;**********************************************************************;
  1534            C        ;
  1535            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1536            C        ;
  1537            C                MOV     A, @32
  1538            C                MOV     reg_acc, A
  1539            C                MOV     A, reg_acc5
  1540            C                MOV     reg_acc9, A
  1541            C                MOV     A, reg_acc6
  1542            C                MOV     reg_acca, A
  1543            C                MOV     A, reg_acc7
  1544            C                MOV     reg_accb, A
  1545            C                MOV     A, reg_acc8
  1546            C                MOV     reg_accc, A
  1547            C                CLR     reg_acc5
  1548            C                CLR     reg_acc6
  1549            C                CLR     reg_acc7
  1550            C                CLR     reg_acc8
  1551            C        $Mul44_Loop:
  1552            C                BC      STATUS, C
  1553            C                JBS     reg_acc1, 0
  1554            C                JMP     $Mul44_Rs
  1555            C                MOV     A, reg_acc9
  1556            C                ADD     reg_acc5, A
  1557            C        ;--------------------------------------
  1558            C                MOV     A, reg_acc6
  1559            C                JBC     STATUS, C
  1560            C                ADD     A, @1
  1561            C                RLC     reg_acc
  1562            C                ADD     A, reg_acca
  1563            C                MOV     reg_acc6, A
  1564            C                JBC     STATUS, C
  1565            C                BS      reg_acc, 0
  1566            C                RRC     reg_acc
  1567            C        ;--------------------------------------
  1568            C                MOV     A, reg_acc7
  1569            C                JBC     STATUS, C
  1570            C                ADD     A, @1
  1571            C                RLC     reg_acc
  1572            C                ADD     A, reg_accb
  1573            C                MOV     reg_acc7, A
  1574            C                JBC     STATUS, C
  1575            C                BS      reg_acc, 0
  1576            C                RRC     reg_acc
  1577            C        ;--------------------------------------
  1578            C                MOV     A, reg_acc8
  1579            C                JBC     STATUS, C
  1580            C                ADD     A, @1
  1581            C                RLC     reg_acc
  1582            C                ADD     A, reg_accc
  1583            C                MOV     reg_acc8, A
  1584            C                JBC     STATUS, C
  1585            C                BS      reg_acc, 0
  1586            C                RRC     reg_acc
  1587            C        $Mul44_Rs:
  1588            C                RRC     reg_acc8
  1589            C                RRC     reg_acc7
  1590            C                RRC     reg_acc6
  1591            C                RRC     reg_acc5
  1592            C                RRC     reg_acc4
  1593            C                RRC     reg_acc3
  1594            C                RRC     reg_acc2
  1595            C                RRC     reg_acc1
  1596            C        ;
  1597            C                BC      reg_acc, 7
  1598            C                DJZ     reg_acc
  1599            C                JMP     $Mul44_Loop
  1600            C                ENDM
  1601            C        
  1602            C        
  1603            C        
  1604            C        ;*****************************************************************
  1605            C        ;Function:    generat random data
  1606            C        ;Input:       @banksel,@address,@length
  1607            C        ;Output:      rang by address which is the lowest address
  1608            C        ;description: used common register temp,temp1,temp2 for operation
  1609            C        ;             rand address must be in the same bank
  1610            C        ;             TEMP:  Operate Data TEMP
  1611            C        ;             TEMP1:
  1612            C        ;             TEMP2:
  1613            C        ;*****************************************************************
  1614            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1615            C        	MOV         TEMP,A
  1616            C        	BANK        @BankSel
  1617            C        	MOV         A,Address
  1618            C        	ADD         TEMP,A        ; save latest data as current seed
  1619            C        
  1620            C        	CLR         RSR
  1621            C        $_RAND_SEED_LOOP1:
  1622            C        	MOV         A,R0
  1623            C        	ADD         TEMP,A        ; seed
  1624            C        
  1625            C        	RLC         TEMP          ; x*y+1 MOD z
  1626            C        	RLC         TEMP
  1627            C        	RLC         TEMP
  1628            C        	INC         TEMP
  1629            C        	RRC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	JBS         STATUS,C
  1633            C        	BC          TEMP,0
  1634            C        	JBC         STATUS,C
  1635            C        	BS          TEMP,0
  1636            C        
  1637            C        	INC         RSR
  1638            C        	MOV         A,RSR
  1639            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1640            C        	XOR         A,@0X40
  1641            C        	JBS         STATUS,Z
  1642            C        	JMP         $_RAND_SEED_LOOP1
  1643            C        	MOV         A,R0
  1644            C        	ADD         TEMP,A          ;next seed
  1645            C        
  1646            C        	MOV         A,@length
  1647            C        	MOV         TEMP1,A
  1648            C        	MOV         A,@Address
  1649            C        	MOV         TEMP2,A
  1650            C        	MOV         RSR,A
  1651            C        	BANK        @BankSel
  1652            C        	MOV         A,RSR
  1653            C        	MOV         TEMP2,A       ; save address base
  1654            C        	MESSAGE     "adding form 0x00 to bank 0"
  1655            C        
  1656            C        $_RAND_DATA_LOOP1:
  1657            C        	MOV         A,TEMP2
  1658            C        	MOV         RSR,A
  1659            C        	MOV         A,TEMP
  1660            C        	MOV         R0,A
  1661            C        
  1662            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1663            C        	RLC         TEMP
  1664            C        	RLC         TEMP
  1665            C        	INC         TEMP
  1666            C        	RRC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	JBS         STATUS,C
  1670            C        	BC          TEMP,0
  1671            C        	JBC         STATUS,C
  1672            C        	BS          TEMP,0
  1673            C        
  1674            C        	INC         TEMP2
  1675            C        	DJZ         TEMP1
  1676            C        	JMP         $_RAND_DATA_LOOP1:
  1677            C        	NOP
  1678            C        
  1679            C        ENDM
  1680            C        
    16                     include "config.h"
     1            C        /*****************************************************************
     2            C        ; Filename     :  EM78M611rxP40M1v6V10 config
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-------------------------------------------------------------------------
    12            C        config.h   EQU    config.h
    13            C        
    14            C        ;-------------------------------------------------------------------------
    15            C        
    16            C        
    17       0000 C        USED_PID_FUNCTION               EQU     0    ; 1:used this function; 0:not used
    18       0006 C        TotalGamePads                   EQU     6
    19       0020 C        DataBufferBase                  EQU     0x20  ; address:0x20 ,bit6:select all bank
    20       0008 C        ComuTime                        EQU     8     ; 8ms
    21       0000 C        RetryCNT                        EQU     0X00  ; transmit 2 Times
    22       0097 C        RX_IDH_DEFAULT                  EQU     0X97  
    23       003A C        RX_IDL_DEFAULT                  EQU     0X3A  ; Adress_default =  (RX_IDL_DEFAULT&0x0f)|0x01
    24            C        
    17                     include "M611rxP40M1v6V10.H"
     1            C        ;==================================================================
     2            C        ; Filename     :  EM78M611
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        ;  Description: PAGE0(0X0000-0X03FF): EM78M611 initial / EEprom setting / SYNC_COM_TX
    11            C        ;               PAGE1(0X0400-0X07FF): RX1_FUNCTION / RX2_FUNCTION / RX3_FUNCTION / RX4_FUNCTION
    12            C        ;               PAGE2(0X0800-0X0BFF): RX5_FUNCTION / RX6_FUNCTION / RX7_FUNCTION / RX8_FUNCTION
    13            C        ;               PAGE3(0X0C00-0X0FFF): Communicate_USB_Function table
    14            C        ;               PAGE4(0X1000-0X13FF): Communicate_USB_Function Function
    15            C        ;               PAGE5(0X1400-0X17FF): RF initial function
    16            C        
    17            C        ;==================================================================
    18            C        M611rxP40M1v6V10.H              EQU     M611rxP40M1v6V10.H
    19            C        
    20            C        
    21            C        ;==================================================================
    22       0010 C        TEMP                            EQU     0X10        ; used for rock-bottom RF initial
    23       0011 C        TEMP1                           EQU     0X11        ; used for rock-bottom RF initial
    24       0012 C        TEMP2                           EQU     0X12        ; used for rock-bottom RF initial
    25       0013 C        TEMP3                           EQU     0X13        ; used for rock-bottom RF initial
    26       0014 C        TEMP4                           EQU     0X14        ; used for rock-bottom RF initial
    27       0015 C        TEMP5                           EQU     0X15        ;
    28       0016 C        TEMP6                           EQU     0X16        ;
    29            C        
    30       0017 C        SystemTimeCNT                   EQU     0X17
    31       0018 C        TABLE_INDEX                     EQU     0x18        ; descriptor table's start position
    32       0019 C        DataShiftCounter                EQU     0X19        ; data counter
    33       001A C        DataByteLength                  EQU     0X1A		; READ/WRITE DATA LENGTH
    34       001B C        ComuClock                       EQU     0X1B        ; Communication clock
    35            C        
    36       001C C        TRANSFER                        EQU     0X1C		     ;
    37       01C0 C        	JudgeHandFlag1              ==      TRANSFER*16+0    ; judge which hand send to host,BYTE0
    38       01C1 C        	JudgeHandFlag2              ==      TRANSFER*16+1    ; judge which hand send to host,BYTE1
    39       01C2 C        	JudgeHandFlag3              ==      TRANSFER*16+2    ; judge which hand send to host,BYTE2
    40       01C3 C        	SetupDataStageFlag          ==      TRANSFER*16+3    ; select HID table 1
    41       01C4 C        	TableSelectFlag1            ==      TRANSFER*16+4    ; select HID table 1
    42       01C5 C        	TableSelectFlag2            ==      TRANSFER*16+5    ; select HID table 2
    43       01C6 C        	TableSelectFlag3            ==      TRANSFER*16+6    ; select HID table 3
    44       01C7 C        	UsbEP0interruptflag         ==      TRANSFER*16+7	
    45            C        
    46       001D C        GeneralStatusFlag1              EQU     0X1D
    47       01D7 C        	RFInitialFailFlag           ==      GeneralStatusFlag1*16+7 ; 
    48       01D6 C        	RFInitialOKFlag             ==      GeneralStatusFlag1*16+6
    49       01D5 C        	RFTestFailFlag              ==      GeneralStatusFlag1*16+5
    50       01D0 C        	ModeSelectFlag              ==      GeneralStatusFlag1*16+0 ;1:analog  0:digital(default 0)
    51            C        
    52            C        
    53       001F C        GeneralStatusFlag               EQU     0X1F
    54       01F7 C        	ReadLengthError             ==      GeneralStatusFlag*16+7
    55       01F6 C        	KeyScanStatusFlag           ==      GeneralStatusFlag*16+6	
    56       01F5 C        	KeyStatusFlag               ==      GeneralStatusFlag*16+5	
    57       01F4 C        	KeyScanFinishFlag           ==      GeneralStatusFlag*16+4
    58            C        	
    59       01F0 C        	FRAMER_CONFIG_ERROR         ==      GeneralStatusFlag*16+0 ; Framer Compare Bit Error Flag
    60       01F0 C        	RECEIVE_ERROR               ==      GeneralStatusFlag*16+0 ; Judge Receive Register 64 Error Flag
    61            C        
    62       001E C        CommuStatusFlag                 EQU     0X1E
    63            C        ;SearchStatusFlag,NormalStatusFlag,LoseFreqStatusFlag,LoseFrameStatusFlag is used for working status
    64            C        ;LinkModeFlag,ForceLinkModeFlag,FccTestModeFlag is used for check master ID and FCC test
    65       01E7 C        	DescriptorFinishFlag        ==      CommuStatusFlag*16+7   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    66       01E6 C        	FccTestModeFlag             ==      CommuStatusFlag*16+6
    67       01E5 C        	ForceLinkModeFlag           ==      CommuStatusFlag*16+5   ; force link flag
    68       01E4 C        	LinkModeFlag                ==      CommuStatusFlag*16+4   ; link flag
    69       01E3 C        	EEpromWRStatusFlag          ==      CommuStatusFlag*16+3
    70       01E2 C        	LoseFrameStatusFlag         ==      CommuStatusFlag*16+2   ; lose frequency and search mode flag
    71       01E1 C        	NormalStatusFlag            ==      CommuStatusFlag*16+1   ; Normal mode Flag
    72       01E0 C        	SearchStatusFlag            ==      CommuStatusFlag*16+0   ; Search mode flag
    73            C        
    74            C        
    75            C        ;-----------------------------------------------------------------------
    76       0010 C        SPIWB                           EQU     TEMP     ; SPI WRITE BYTE VALUE
    77       0010 C        SPIRB                           EQU     TEMP
    78       0011 C        r_acc1                          EQU     TEMP1    ; TEMP1 - TEMP5 used for eeprom
    79       0012 C        r_acc2                          EQU     TEMP2
    80       0013 C        r_acc3                          EQU     TEMP3
    81       0014 C        DataAddressInMCU                EQU     TEMP4    ; 93C46
    82       0015 C        DataAddressInEEPROM             EQU     TEMP5
    83            C        
    84       0013 C        CMD_SELECT                      EQU     TEMP3
    85       0014 C        A_TEMP                          EQU     TEMP4    ; TEMP4 - TEMP6 used for PUSH and POP
    86       0015 C        RSR_TEMP                        EQU     TEMP5
    87       0016 C        STATUS_TEMP                     EQU     TEMP6
    88            C        
    89            C        
    90            C        ;==============================I/O Port Define==========================
    91       0060 C        SPI_MISO                        ==      PORT6*16+0   ;0
    92       0061 C        RESET_N                         ==      PORT6*16+1	;1
    93       0062 C        SPI_CLK                         ==      PORT6*16+2   ;2
    94       0063 C        SPI_MOSI                        ==      PORT6*16+3   ;3
    95       0064 C        SPI_SS                          ==      PORT6*16+4   ;4
    96       0065 C        FIFO_FLAG                       ==      PORT6*16+5   ;5
    97       0066 C        PKT_FLAG                        ==      PORT6*16+6   ;6
    98            C        
    99       0054 C        IIC_SCL                         ==      Port5*16+4
   100       0055 C        IIC_Sda                         ==      Port5*16+5
   101       0056 C        AT93C46_CS                      ==      Port5*16+6 ;4  93c46 enable select
   102            C        
   103       0092 C        Keystoke                        ==      Port9*16+2
   104       0093 C        LED1_STATUS                     ==      PORT9*16+3 ;LED
   105            C        
   106            C        
   107            C        ;============================================== BANK 0 ============================================
   108            C        ; bank0 20-3f used for data exchange section[Data Buffer]
   109            C        ; such as read or write EEPROM and RF,it used for data buffer
   110            C        ; sync timing:             RX_IDH,RX_IDL,CHN_FLAG,CommuStatusFlag,DirectionCtrl,CH_NO,TX1_ID,TX2_ID,TX3_ID,TX4_ID,TX5_ID,TX6_ID
   111            C        ; responses answer timing: RX_IDH,RX_IDL,CHN_FLAG,CommuStatusFlag,DirectionCtrl,CH_NO,TXx_ID
   112            C        ; responses data timing:   RX_IDH,RX_IDL,CHN_FLAG,CommuStatusFlag,DirectionCtrlO.)
   113            C        
   114            C        ;------------------------ used for RF communicate --------------------
   115       0020 C        PID_DATA_Buffer         EQU     0X20    ; PID DATARX_IDH_Buffer           EQU     0X20    ; master ID
   116       0021 C        RX_IDH_Buffer           EQU     0X21    ; master ID
   117       0022 C        RX_IDL_Buffer           EQU     0X22
   118       0023 C        CHN_FLAG_Buffer         EQU     0X23    ; Channel flag, gamepad status
   119       0024 C        CommuStatusFlag_Buffer  EQU     0X24
   120       0025 C        DirectionCtrl_Buffer    EQU     0X25    ; Communication trsmitter direction
   121       0026 C        N_CHN_Buffer            EQU     0X26    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   122       0026 C        TX_ID_Buffer            EQU     0X26    ; repeat package data
   123            C        
   124       0027 C        TX1_ID_Buffer           EQU     0X27     ;
   125       0028 C        TX2_ID_Buffer           EQU     0X28     ;
   126       0029 C        TX3_ID_Buffer           EQU     0X29     ;
   127       002A C        TX4_ID_Buffer           EQU     0X2A     ;
   128       002B C        TX5_ID_Buffer           EQU     0X2B     ;
   129       002C C        TX6_ID_Buffer           EQU     0X2C     ;
   130            C        
   131            C        ;--------------------------------------------------------
   132       0027 C        DataA_Buffer            EQU     0X27 ;rocker, left-x(left-right) data
   133       0028 C        DataB_Buffer            EQU     0X28 ;rocker, left-y(up-down) data
   134       0029 C        DataC_Buffer            EQU     0X29 ;rocker, right-x(left-right) data
   135       002A C        DataD_Buffer            EQU     0X2A ;rocker, right-y(up-down) data
   136       002B C        DataE_Buffer            EQU     0X2B ;A,B,C,D,L1,R1,L2,R2
   137       002C C        DataF_Buffer            EQU     0X2C ;Select,start,LSW,RSW,MODE,MACRO,TEST1,TEST2
   138       002D C        DataG_Buffer            EQU     0X2D ;000:45’ 001:90’ 010:135’ 011:180’ 100:225’ 101:270’ 110:315’
   139            C        
   140            C        ;--------------------------------------------------------
   141       0030 C        GS_XPoint_LOW_Buffer    EQU     0X30
   142       0031 C        GS_YPoint_LOW_Buffer    EQU     0X31
   143       0032 C        GS_ZPoint_LOW_Buffer    EQU     0X32
   144       0033 C        GS_Point_HIGH_Buffer    EQU     0X33
   145       0034 C        CMOS_XPoint_LOW_Buffer  EQU     0X34
   146       0035 C        CMOS_YPoint_LOW_Buffer  EQU     0X35
   147       0036 C        CMOS_Point_HIGH_Buffer  EQU     0X36
   148            C        
   149       0039 C        GS_XPoint_LOW           EQU     0X39
   150       003A C        GS_YPoint_LOW           EQU     0X3A
   151       003B C        GS_ZPoint_LOW           EQU     0X3B
   152       003C C        GS_Point_HIGH           EQU     0X3C
   153       003D C        CMOS_XPoint_LOW         EQU     0X3D
   154       003E C        CMOS_YPoint_LOW         EQU     0X3E
   155       003F C        CMOS_Point_HIGH         EQU     0X3F
   156            C        
   157            C        ;----------------------- used for USB Command ----------------------------
   158       0020 C        BYTE0                   EQU     0X20
   159       0021 C        BYTE1                   EQU     0X21
   160       0022 C        BYTE2                   EQU     0X22
   161       0023 C        BYTE3                   EQU     0X23
   162       0024 C        BYTE4                   EQU     0X24
   163       0025 C        BYTE5                   EQU     0X25
   164       0026 C        BYTE6                   EQU     0X26
   165       0027 C        BYTE7                   EQU     0X27
   166            C        
   167            C        
   168       0039 C        PROTOCOL_TEMP           EQU     0X39                ; BYTE 2 , (0)Boot Protocol,(1)Report Protocol
   169       003A C        IDLE_TEMP               EQU     0X3A                ; BYTE 3
   170       003B C        PC_WANT0                EQU     0X3B                ; BYTE 6
   171       003C C        PC_WANT1                EQU     0X3C                ; BYTE 7
   172            C        
   173       003D C        DataMaxTable1           EQU     0X3D                ; descriptor table's data length (table 1)
   174       003E C        DataMaxTable2           EQU     0X3E                ; descriptor table's data length (table 2)
   175       003F C        DataMaxTable3           EQU     0X3F                ; descriptor table's data length (table 3)
   176            C        
   177            C        ;============================================== BANK 1 ============================================
   178       0020 C        PID_DATA                EQU     0X20    ; PID DATA
   179       0021 C        RX_IDH                  EQU     0X21    ; master ID
   180       0022 C        RX_IDL                  EQU     0X22
   181       0023 C        CHN_FLAG                EQU     0X23    ; Channel flag, gamepad status
   182       0024 C        DirectionCtrl           EQU     0X24    ; Communication trsmitter direction
   183       0025 C        N_CHN                   EQU     0X25    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   184       0026 C        TX_ID                   EQU     0X26     ;
   185       0027 C        TX1_ID                  EQU     0X27     ;
   186       0028 C        TX2_ID                  EQU     0X28     ;
   187       0029 C        TX3_ID                  EQU     0X29     ;
   188       002A C        TX4_ID                  EQU     0X2A     ;
   189       002B C        TX5_ID                  EQU     0X2B     ;
   190       002C C        TX6_ID                  EQU     0X2C     ;
   191            C        
   192            C        
   193       002E C        CHN_FLAG_TEMP           EQU     0X2E
   194       002F C        FccFreqIndex            EQU     0X2F
   195            C        ;----------------------------------------------------------------------
   196       0030 C        ADDR                    EQU     0X30 ;OUTPUT DATA ADDRESS
   197       0031 C        VALUE                   EQU     0X31 ;OUTPUT DATA HIGH
   198       0033 C        CH_NO                   EQU     0X33
   199            C        
   200       0034 C        RF_RSSI                 EQU     0X34
   201       0035 C        KeystokeFlag_Befor      EQU     0X35 ;       Click                     Dblclick                    Lasting_Press
   202       0036 C        KeystokeTimeCNT         EQU     0X36
   203            C                                             ;________    _______.__________    ______    _______.___________         ____________
   204            C                                             ;        |__|                  |__|      |__|                   |_______|
   205       0037 C        KEY_NUM                 EQU     0X37
   206            C                                             ;___________                       _________                             ____________
   207            C                                             ;           |_______._____________|         |________.__________________|
   208       0038 C        RX1_LossframeCNT        EQU     0X38
   209       0039 C        RX2_LossframeCNT        EQU     0X39
   210       003A C        RX3_LossframeCNT        EQU     0X3A
   211       003B C        RX4_LossframeCNT        EQU     0X3B
   212       003C C        RX5_LossframeCNT        EQU     0X3C
   213       003D C        RX6_LossframeCNT        EQU     0X3D
   214            C        
   215            C        
   216            C        
   217            C        ;============================================== BANK 2 ============================================
   218       0020 C        TX1_DATA1               EQU     0X20
   219       0021 C        TX1_DATA2               EQU     0X21
   220       0022 C        TX1_DATA3               EQU     0X22
   221       0023 C        TX1_DATA4               EQU     0X23
   222       0024 C        TX1_DATA5               EQU     0X24
   223       0025 C        TX1_DATA6               EQU     0X25
   224       0026 C        TX1_DATA7               EQU     0X26
   225       0027 C        TX1_DATA8               EQU     0X27
   226            C        ;------------------------------------------------------------
   227       0028 C        TX2_DATA1               EQU     0X28    ; sensor x-axis
   228       0029 C        TX2_Data2               EQU     0X29
   229       002A C        TX2_DATA3               EQU     0X2A    ; sensor y-axis
   230       002B C        TX2_DATA4               EQU     0X2B
   231       002C C        TX2_DATA5               EQU     0X2C    ; sensor z-axis
   232       002D C        TX2_DATA6               EQU     0X2D
   233       002E C        TX2_DATA7               EQU     0X2E
   234       002F C        TX2_DATA8               EQU     0X2F
   235            C        ;------------------------------------------------------------
   236       0030 C        TX3_DATA1               EQU     0X30
   237       0031 C        TX3_DATA2               EQU     0X31
   238       0032 C        TX3_DATA3               EQU     0X32
   239       0033 C        TX3_DATA4               EQU     0X33
   240       0034 C        TX3_DATA5               EQU     0X34
   241       0035 C        TX3_DATA6               EQU     0X35
   242       0036 C        TX3_DATA7               EQU     0X36
   243       0037 C        TX3_DATA8               EQU     0X37
   244            C        ;------------------------------------------------------------
   245       0038 C        TX4_DATA1               EQU     0X38    ; sensor x-axis
   246       0039 C        TX4_DATA2               EQU     0X39
   247       003A C        TX4_DATA3               EQU     0X3A    ; sensor y-axis
   248       003B C        TX4_DATA4               EQU     0X3B
   249       003C C        TX4_DATA5               EQU     0X3C    ; sensor z-axis
   250       003D C        TX4_DATA6               EQU     0X3D
   251       003E C        TX4_DATA7               EQU     0X3E
   252       003F C        TX4_DATA8               EQU     0X3F
   253            C        
   254            C        ;============================================== BANK 3 ============================================
   255       0020 C        TX5_DATA1               EQU     0X20
   256       0021 C        TX5_DATA2               EQU     0X21
   257       0022 C        TX5_DATA3               EQU     0X22
   258       0023 C        TX5_DATA4               EQU     0X23
   259       0024 C        TX5_DATA5               EQU     0X24
   260       0025 C        TX5_DATA6               EQU     0X25
   261       0026 C        TX5_DATA7               EQU     0X26
   262       0027 C        TX5_DATA8               EQU     0X27
   263            C        ;------------------------------------------------------------
   264       0028 C        TX6_DATA1               EQU     0X28    ; sensor x-axis
   265       0029 C        TX6_DATA2               EQU     0X29
   266       002A C        TX6_DATA3               EQU     0X2A    ; sensor y-axis
   267       002B C        TX6_DATA4               EQU     0X2B
   268       002C C        TX6_DATA5               EQU     0X2C    ; sensor z-axis   ;flash byte 1
   269       002D C        TX6_DATA6               EQU     0X2D                      ;flash byte 2
   270       002E C        TX6_DATA7               EQU     0X2E                      ;flash byte 3
   271       002F C        TX6_DATA8               EQU     0X2F                      ;flash byte 4
   272            C        ;--------------------------------------------------------
   273       0030 C        TX7_DATA1               EQU     0X30
   274       0031 C        TX7_DATA2               EQU     0X31
   275       0032 C        TX7_DATA3               EQU     0X32
   276       0033 C        TX7_DATA4               EQU     0X33
   277       0034 C        TX7_DATA5               EQU	    0X34
   278       0035 C        TX7_DATA6               EQU     0X35
   279       0026 C        TX7_DATA7               EQU     0X26
   280       0037 C        TX7_DATA8               EQU     0X37
   281            C        ;------------------------------------------------------------
   282       0038 C        TX8_DATA1               EQU     0X38    ; sensor x-axis
   283       0039 C        TX8_DATA2               EQU     0X39
   284       003A C        TX8_DATA3               EQU     0X3A    ; sensor y-axis
   285       003B C        TX8_DATA4               EQU     0X3B
   286       003C C        TX8_DATA5               EQU	    0X3C    ; sensor z-axis
   287       003D C        TX8_DATA6               EQU     0X3D
   288       002E C        TX8_DATA7               EQU     0X2E
   289       003F C        TX8_DATA8               EQU     0X3F
   290            C        
    18                     include "EM198850_For_EM78M611.ASM"
     1            C        ;==================================================================
     2            C        ; Filename     :  EM78M611
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        ;===================================================================
    11            C        
    12            C        include	"EM198850_For_EM78M611.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78M611dev.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL	   :  8MHZ
     7            C        * Creat date   :  2009/9/11
     8            C        * tool ver.    :  WicePlus 2.7
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        
    12            C        ;--------------------------------------------------------------------------
    13       0052 C        FIFO_PTR                EQU     82			;FIFO POINTER CONTROL=REG 82
    14       0080 C        CLR_W_PTR               EQU     0X80		;CLR POINTER MARK VALUE
    15       0050 C        FIFO_REG                EQU     80			;FIFO POINTER=REG 80
    16       0080 C        READ_MASK               EQU     0X80		;READ REG,MSB SET TO 1
    17       0080 C        RX_MASK                 EQU     0X80		;ENABLE RX
    18            C        
    19       0010 C        PKT_LEN                 EQU     0X10        ;DataByteLength = 16
    20       0000 C        TXADDRL                 EQU     0X00
    21       0011 C        TXADDRH                 EQU     0X11
    22       0020 C        RX_BUF                  EQU     0B00100000  ;0x20(bank 0)
    23       0020 C        TX_BUF                  EQU     0B00100000  ;0x20(bank 0)
    24            C        
    25            C        
    26            C        
    27            C        
    28            C        
    29            C        ;==================================================================
    30            C        
    13            C        
    14            C        	ORG                 0X1400    ;PAGE 5
    15            C        ;**************************************************
    16            C        ;LOOKUP TABLE
    17            C        ;Famer Register initial value(Reg48~57)
    18            C        ;**************************************************
    19 01400      C        FRAME_TABLE:
    20 01400 03C2 C        	ADD                 PC,A
    21 01401 1C4E C        	RETL                @0X4E		;1		01---16M
    22 01402 1C02 C        	RETL                @0X02		;2		10---24M
    23            C        
    24 01403 1C4D C        	RETL                @0X4D		;3		RESET FIFO
    25 01404 1C01 C        	RETL                @0X01		;4
    26            C        
    27 01405 1C42 C        	RETL                @0X42		;5		24M/1MBPS
    28 01406 1C98 C        	RETL                @0X98		;6
    29            C        
    30 01407 1C43 C        	RETL                @0X43		;7
    31 01408 1CC8 C        	RETL                @0XC8 		;8		;8		;default:C4  Set sync word length，CRC count
    32            C        
    33 01409 1C44 C        	RETL                @0X44		;9		PKT_LEN
    34 0140A 1C10 C        	RETL                @PKT_LEN	;10		24 DATA
    35            C        
    36 0140B 1C45 C        	RETL                @0X45		;11		PKTCNT
    37 0140C 1C10 C        	RETL                @0X10		;12		1 packet
    38            C        
    39 0140D 1C46 C        	RETL                @0X46		;13		BIT3~5	TX AMPLIFIER DELAY 10+5X
    40 0140E 1C09 C        	RETL                @0X09		;14		BIT0~2	PLL DELAY 120+20X
    41            C        
    42 0140F 1C47 C        	RETL                @0X47		;15		BIT4~7  RETRY CNT
    43 01410 1C01 C        	RETL                @0X01		;16		BIT0~3	Slot TIME UNIT 10US
    44            C        
    45 01411 1C48 C        	RETL                @0X48		;17		Slot
    46 01412 1C01 C        	RETL                @0X01		;18
    47            C        
    48 01413 1C49 C        	RETL                @0X49		;19		ACKTOSLOT
    49 01414 1C14 C        	RETL                @0X14 		;20     default: 0X8A
    50            C        
    51 01415 1C4A C        	RETL                @0X4A		;21		RSSITH
    52 01416 1C27 C        	RETL                @0X27		;22
    53            C        
    54 01417 1C4B C        	RETL                @0X4B		;23		RF_RSSI
    55 01418 1C00 C        	RETL                @0X00		;24
    56            C        
    57 01419 1C4C C        	RETL                @0X4C		;25		TD_PLL	IN UNIT 10US
    58 0141A 1C06 C        	RETL                @0X06		;26
    59            C        
    60 0141B 1C50 C        	RETL                @0X50		;27		TXADDR
    61 0141C 1C00 C        	RETL                @TXADDRL	;28
    62            C        
    63 0141D 1C51 C        	RETL                @0X51		;29		TX ADDR
    64 0141E 1C11 C        	RETL                @TXADDRH	;30
    65            C        
    66 0141F 1C52 C        	RETL                @0X52		;31		RX	ADDR1
    67 01420 1C22 C        	RETL                @0X22		;32
    68            C        
    69 01421 1C53 C        	RETL                @0X53		;33		RX	ADDR2
    70 01422 1C33 C        	RETL                @0X33		;34
    71            C        
    72 01423 1C54 C        	RETL                @0X54		;35		RX	ADDR3
    73 01424 1C44 C        	RETL                @0X44		;36
    74            C        
    75 01425 1C55 C        	RETL                @0X55		;37		RX	ADDR4
    76 01426 1C55 C        	RETL                @0X55		;38
    77            C        
    78 01427 1C56 C        	RETL                @0X56		;39		RX	ADDR5
    79 01428 1C66 C        	RETL                @0X66		;40
    80            C        
    81 01429 1C57 C        	RETL                @0X57		;41		RX	ADDR6
    82 0142A 1C77 C        	RETL                @0X77		;42
    83            C        
    84 0142B 1C58 C        	RETL                @0X58		;43
    85 0142C 1C08 C        	RETL                @0X08		;44
    86            C        
    87            C        ;-----------------------------------------------------------
    88 0142D 1C00 C        	RETL                @0X00		;45
    89 0142E 1CE5 C        	RETL                @0XE5		;46
    90            C        
    91 0142F 1C01 C        	RETL                @0X01		;47
    92 01430 1C84 C        	RETL                @0X84		;48
    93            C        
    94 01431 1C02 C        	RETL                @0X02		;49
    95 01432 1C00 C        	RETL                @0X00		;50		CHANNEL
    96            C        
    97 01433 1C03 C        	RETL                @0X03		;51
    98 01434 1CC6 C        	RETL                @0XC6		;52
    99            C        
   100 01435 1C04 C        	RETL                @0X04		;53
   101 01436 1C00 C        	RETL                @0X00		;54
   102            C        
   103 01437 1C05 C        	RETL                @0X05		;55
   104 01438 1C40 C        	RETL                @0X40		;56
   105            C        
   106 01439 1C06 C        	RETL                @0X06		;57
   107 0143A 1C5D C        	RETL                @0X5D		;58
   108            C        
   109 0143B 1C07 C        	RETL                @0X07		;59
   110 0143C 1C18 C        	RETL                @0X18		;60
   111            C        
   112 0143D 1C08 C        	RETL                @0X08		;61
   113 0143E 1C40 C        	RETL                @0X40		;62
   114            C        
   115 0143F 1C09 C        	RETL                @0X09		;63
   116 01440 1C18 C        	RETL                @0X18		;64
   117            C        
   118 01441 1C0A C        	RETL                @0X0A		;65
   119 01442 1C47 C        	RETL                @0X47		;66
   120            C        
   121 01443 1C0B C        	RETL                @0X0B		;67
   122 01444 1C0B C        	RETL                @0X0B		;68
   123            C        
   124 01445 1C0C C        	RETL                @0X0C		;69
   125 01446 1CE0 C        	RETL                @0XE0		;70
   126            C        
   127 01447 1C0D C        	RETL                @0X0D		;71
   128 01448 1C4F C        	RETL                @0X4F		;72
   129            C        
   130 01449 1C0E C        	RETL                @0X0E		;73
   131 0144A 1C11 C        	RETL                @0X11		;74
   132            C        
   133 0144B 1C0F C        	RETL                @0X0F		;75
   134 0144C 1C1C C        	RETL                @0X1C		;76
   135            C        
   136 0144D 1C20 C        	RETL                @0X20		;77
   137 0144E 1CAD C        	RETL                @0XAD		;78
   138            C        
   139 0144F 1C21 C        	RETL                @0X21		;79
   140 01450 1C64 C        	RETL                @0X64		;80
   141            C        
   142 01451 1C22 C        	RETL                @0X22		;81
   143 01452 1C00 C        	RETL                @0X00		;82
   144            C        
   145 01453 1C23 C        	RETL                @0X23		;83
   146 01454 1CC3 C        	RETL                @0XC3		;84
   147            C        
   148 01455 1C24 C        	RETL                @0X24		;85
   149 01456 1CBD C        	RETL                @0XBD		;86
   150            C        
   151 01457 1C25 C        	RETL                @0X25		;87
   152 01458 1CA2 C        	RETL                @0XA2		;88
   153            C        
   154 01459 1C26 C        	RETL                @0X26		;89
   155 0145A 1C1A C        	RETL                @0X1A		;90
   156            C        
   157 0145B 1C27 C        	RETL                @0X27		;91
   158 0145C 1C09 C        	RETL                @0X09		;92
   159            C        
   160 0145D 1C28 C        	RETL                @0X28		;93
   161 0145E 1C00 C        	RETL                @0X00		;94
   162            C        
   163 0145F 1C29 C        	RETL                @0X29		;95
   164 01460 1CB8 C        	RETL                @0XB8		;96
   165            C        
   166 01461 1C2A C        	RETL                @0X2A		;97
   167 01462 1C71 C        	RETL                @0X71		;98
   168            C        
   169 01463 1C2B C        	RETL                @0X2B		;99
   170 01464 1C06 C        	RETL                @0X06		;100
   171            C        
   172 01465 1C2C C        	RETL                @0X2C		;101
   173 01466 1C80 C        	RETL                @0X80		;102
   174            C        
   175 01467 1C2D C        	RETL                @0X2D		;103
   176 01468 1C1A C        	RETL                @0X1A		;104
   177            C        
   178 01469 1C2E C        	RETL                @0X2E		;105
   179 0146A 1C09 C        	RETL                @0X09;03		;106
   180            C        
   181 0146B 1C2F C        	RETL                @0X2F		;107
   182 0146C 1C64 C        	RETL                @0X64		;108
   183            C        
   184 0146D 1C30 C        	RETL                @0X30		;109
   185 0146E 1CC0 C        	RETL                @0XC0		;110
   186            C        
   187 0146F 1C31 C        	RETL                @0X31		;111
   188 01470 1C00 C        	RETL                @0X00		;112
   189            C        
   190 01471 1C32 C        	RETL                @0X32		;113
   191 01472 1C40 C        	RETL                @0X40		;114
   192            C        
   193 01473 1C33 C        	RETL                @0X33		;115
   194 01474 1C3B C        	RETL                @0X3B		;116
   195            C        
   196 01475 1C00 C        	RETL                @0X00		;117
   197 01476 1CA7 C        	RETL                @0XA7		;118
   198            C        
   199 01477 1C32 C        	RETL                @0X32		;119
   200 01478 1C4A C        	RETL                @0X4A		;120
   201            C        
   202 01479 1C00 C        	RETL                @0X00		;121
   203 0147A 1CE5 C        	RETL                @0XE5		;122
   204            C        
   205 0147B 1C0E C        	RETL                @0X0E		;123
   206 0147C 1C91 C        	RETL                @0X91		;124
   207            C        
   208 0147D 1C40 C        	RETL                @0X40		;125
   209 0147E 1C51 C        	RETL                @0X51		;126
   210            C        
   211 0147F 1C41 C        	RETL                @0X41		;127
   212 01480 1CBF C        	RETL                @0XBF		;128
   213            C        
   214 01481 1C0C C        	RETL                @0X0C		;129
   215 01482 1CC0 C        	RETL                @0XC0		;130
   216            C        
   217 01483 1C02 C        	RETL                @0X02		;131
   218 01484 1C80 C        	RETL                @0X80		;132
   219            C        
   220 01485 1C04 C        	RETL                @0X04		;133
   221 01486 1C4A C        	RETL                @0X4A		;134
   222            C        
   223 01487 1C05 C        	RETL                @0X05		;135
   224 01488 1CDA C        	RETL                @0XDA		;136
   225            C        
   226 01489 1C06 C        	RETL                @0X06		;137
   227 0148A 1CFA C        	RETL                @0XFA		;138
   228            C        
   229 0148B 1CFF C        	RETL                @0XFF
   230            C        
   231            C        ;===========================================================
   232 0148C      C        RF_TABLE:			;LENGTH 30
   233 0148C 03C2 C        	ADD                 PC,A
   234 0148D 1C4E C        	RETL                @0X4E
   235 0148E 1C02 C        	RETL                @0X02
   236            C        
   237 0148F 1C43 C        	RETL                @0X43
   238 01490 1CC8 C        	RETL                @0XC8
   239            C        
   240 01491 1C44 C        	RETL                @0X44
   241 01492 1C10 C        	RETL                @PKT_LEN
   242            C        
   243 01493 1C45 C        	RETL                @0X45
   244 01494 1C10 C        	RETL                @0X10
   245            C        
   246 01495 1C48 C        	RETL                @0X48
   247 01496 1C01 C        	RETL                @0X01
   248            C        
   249 01497 1C4C C        	RETL                @0X4C
   250 01498 1C06 C         	RETL                @0X06
   251            C        
   252 01499 1C50 C        	RETL                @0X50
   253 0149A 1C00 C        	RETL                @TXADDRL
   254            C        
   255 0149B 1C51 C        	RETL                @0X51
   256 0149C 1C11 C        	RETL                @TXADDRH
   257            C        
   258 0149D 1C52 C        	RETL                @0X52
   259 0149E 1C22 C        	RETL                @0X22
   260            C        
   261 0149F 1C53 C        	RETL                @0X53
   262 014A0 1C33 C        	RETL                @0X33
   263            C        
   264 014A1 1C54 C        	RETL                @0X54
   265 014A2 1C44 C        	RETL                @0X44
   266            C        
   267 014A3 1C55 C        	RETL                @0X55
   268 014A4 1C55 C        	RETL                @0X55
   269            C        
   270 014A5 1C56 C        	RETL                @0X56
   271 014A6 1C66 C        	RETL                @0X66
   272            C        
   273 014A7 1C57 C        	RETL                @0X57
   274 014A8 1C77 C        	RETL                @0X77
   275            C        
   276 014A9 1C58 C        	RETL                @0X58
   277 014AA 1C08 C        	RETL                @0X08
   278            C        
   279 014AB 1CFF C        	RETL                @0XFF
   280            C        ;===========================================================
   281 014AC      C        CH_TABLE:
   282 014AC 03C2 C        	ADD                 PC,A
   283 014AD 1C1D C        	RETL                @29        ;freq:2431 ;@0X1D
   284 014AE 1C04 C        	RETL                @4         ;freq:2406 ;@0X04
   285 014AF 1C43 C        	RETL                @67        ;freq:2469 ;@0X43
   286 014B0 1C20 C        	RETL                @32        ;freq:2434 ;@0X20
   287            C        
   288 014B1 1C07 C        	RETL                @7         ;freq:2409 ;@0X07
   289 014B2 1C41 C        	RETL                @65        ;freq:2467 ;@0X41
   290 014B3 1C24 C        	RETL                @36        ;freq:2438 ;@0X24
   291 014B4 1C0A C        	RETL                @10        ;freq:2412 ;@0X0A
   292            C        
   293 014B5 1C3E C        	RETL                @62        ;freq:2464 ;@0X3E
   294 014B6 1C26 C        	RETL                @38        ;freq:2440 ;@0X26
   295 014B7 1C08 C        	RETL                @8         ;freq:2410 ;@0X08
   296 014B8 1C3B C        	RETL                @59        ;freq:2461 ;@0X3B
   297            C        
   298 014B9 1C2D C        	RETL                @45        ;freq:2447 ;@0X2D
   299 014BA 1C0C C        	RETL                @12        ;freq:2414 ;@0X0C
   300 014BB 1C4C C        	RETL                @76        ;freq:2478 ;@0X4C
   301 014BC 1C28 C        	RETL                @40        ;freq:2442 ;@0X28
   302            C        
   303            C        ;===========================================================
   304            C        ; RF Initialize SubRoutine
   305            C        ;===========================================================
   306 014BD      C        EM198850_RESET:
   307 014BD 1305 C        	CALL                PAGE5BANK1
   308 014BE 0846 C        	BC                  RESET_N/16,RESET_N%16
   309 014BF 181E C        	MOV                 A,@30                         ; wating 3ms
   310 014C0 12C0 C        	CALL                DELAY_X100US
   311 014C1 0A46 C        	BS                  RESET_N/16,RESET_N%16          ; RESET=1
   312 014C2 1864 C        	MOV                 A,@100                          ; wating 10ms
   313 014C3 12C0 C        	CALL                DELAY_X100US
   314            C        
   315 014C4 095D C        	BC                  RFTestfailFlag/16,RFTestfailFlag%16
   316 014C5 10D2 C        	CALL                INIT_FRAMEREG                  ; load	FRAMER TABLE send
   317 014C6 1805 C        	MOV                 A,@5
   318 014C7 12C0 C        	CALL                DELAY_X100US
   319 014C8 0000 C        	NOP
   320 014C9 10E5 C        	CALL                INIT_RSSI_CALIBRATION
   321 014CA 0000 C        	NOP
   322 014CB 12C9 C        	CALL                TEST_INITIAL_RF
   323 014CC 0000 C        	NOP
   324 014CD 0D5D C        	JBC                 RFTestfailFlag/16,RFTestfailFlag%16
   325 014CE 14BD C        	JMP                 EM198850_RESET
   326            C        
   327 014CF 123C C        	CALL                Enter_StandbyII_Mode
   328 014D0 0B9D C        	BS                  RFInitialOKflag/16,RFInitialOKflag%16
   329            C        
   330 014D1 0012 C        	RET
   331            C        
   332            C        ;===============================================
   333 014D2      C        INIT_FRAMEREG:
   334 014D2 1305 C        	CALL                PAGE5BANK1
   335 014D3 00D8 C        	CLR                 TABLE_INDEX
   336 014D4      C          Set_FrameReg:
   337 014D4 0418 C        	MOV                 A,TABLE_INDEX
   338 014D5 1000 C        	CALL                FRAME_TABLE
   339 014D6 0070 C        	MOV                 ADDR,A
   340 014D7 1BFF C        	XOR                 A,@0XFF
   341 014D8 0C83 C        	JBC                 STATUS,Z
   342 014D9 14E3 C        	JMP                 Set_Framereg_End
   343 014DA 0558 C        	INC                 TABLE_INDEX
   344 014DB 0418 C        	MOV                 A,TABLE_INDEX
   345 014DC 1000 C        	CALL                FRAME_TABLE
   346 014DD 0000 C        	NOP
   347 014DE 0071 C        	MOV                 VALUE,A
   348 014DF 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   349 014E0 0000 C        	NOP
   350 014E1 0558 C        	INC                 TABLE_INDEX
   351 014E2 14D4 C        	JMP                 Set_FrameReg
   352 014E3      C          Set_Framereg_End:
   353 014E3 0000 C        	NOP
   354 014E4 0012 C        	RET
   355            C        
   356            C        ;=================================================
   357 014E5      C        INIT_RSSI_CALIBRATION:
   358 014E5 1305 C        	CALL                PAGE5BANK1
   359 014E6 1805 C        	MOV                 A,@0X05
   360 014E7 005A C        	MOV                 DataByteLength,A
   361 014E8 00F4 C        	CLR                 RF_RSSI
   362 014E9      C          Repeat_Read_RSSI:
   363 014E9 184B C        	MOV                 A,@0X4B
   364 014EA 0070 C        	MOV                 ADDR,A
   365 014EB 111B C        	CALL                READ_SPI_REG
   366 014EC 0000 C        	NOP
   367 014ED 0434 C        	MOV                 A,RF_RSSI
   368 014EE 0131 C        	SUB                 A,VALUE
   369 014EF 0E03 C        	JBS                 STATUS,C
   370 014F0 14F3 C        	JMP                 $+3
   371 014F1 0431 C        	MOV                 A,VALUE
   372 014F2 0074 C        	MOV                 RF_RSSI,A
   373 014F3 05DA C        	DJZ                 DataByteLength
   374 014F4 14E9 C        	JMP                 Repeat_Read_RSSI
   375            C        
   376 014F5 1804 C        	MOV                 A,@0X04
   377 014F6 0174 C        	SUB                 RF_RSSI,A
   378 014F7 0434 C        	MOV                 A,RF_RSSI
   379 014F8 0071 C        	MOV                 VALUE,A
   380 014F9 184A C        	MOV                 A,@0X4A
   381 014FA 0070 C        	MOV                 ADDR,A
   382 014FB 1110 C        	CALL                WRITE_SPI_REG
   383 014FC 0000 C        	NOP
   384 014FD 1805 C        	MOV                 A,@0X05
   385 014FE 0070 C        	MOV                 ADDR,A
   386 014FF 1840 C        	MOV                 A,@0X40
   387 01500 0071 C        	MOV                 VALUE,A
   388 01501 1110 C        	CALL                WRITE_SPI_REG
   389 01502 0000 C        	NOP
   390 01503 1802 C        	MOV                 A,@0X02
   391 01504 0070 C        	MOV                 ADDR,A
   392 01505 1800 C        	MOV                 A,@0X00
   393 01506 0071 C        	MOV                 VALUE,A
   394 01507 1110 C        	CALL                WRITE_SPI_REG
   395 01508 0000 C        	NOP
   396 01509 180C C        	MOV                 A,@0X0C
   397 0150A 0070 C        	MOV                 ADDR,A
   398 0150B 18E0 C        	MOV                 A,@0XE0
   399 0150C 0071 C        	MOV                 VALUE,A
   400 0150D 1110 C        	CALL                WRITE_SPI_REG
   401 0150E 0000 C        	NOP
   402 0150F 0012 C        	RET
   403            C        
   404            C        ;===========================================================
   405            C        ; RF Initialize End
   406            C        ;===========================================================
   407            C        ;===============================================
   408            C        ; Function: Write SPI Register
   409            C        ; Input:    ADDR,VALUE
   410            C        ; Output:   None
   411            C        ;===============================================
   412 01510      C        WRITE_SPI_REG:
   413 01510 1302 C        	CALL                PAGE5BANK0
   414 01511 0906 C        	BC                  SPI_SS/16,SPI_SS%16				;	/SS	=0
   415 01512 1305 C        	CALL                PAGE5BANK1
   416 01513 0430 C        	MOV                 A,ADDR
   417 01514 1127 C        	CALL                SIM_SPI_WRITE
   418 01515 0431 C        	MOV                 A,VALUE
   419 01516 1127 C        	CALL                SIM_SPI_WRITE
   420 01517 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   421 01518 0000 C        	NOP
   422 01519 0B06 C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=1
   423 0151A 0012 C        	RET
   424            C        
   425            C        ;===============================================
   426            C        ; Function: Read SPI Register
   427            C        ; Input:   SPIWB
   428            C        ; Output:  SPIRB
   429            C        ;===============================================
   430 0151B      C        READ_SPI_REG:
   431 0151B 1305 C        	CALL                PAGE5BANK1
   432 0151C 0906 C        	BC                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   433 0151D 0430 C        	MOV                 A,ADDR
   434 0151E 1980 C        	OR                  A,@0X80
   435 0151F 1127 C        	CALL                SIM_SPI_WRITE
   436 01520 0000 C        	NOP
   437 01521 1139 C        	CALL                SIM_SPI_READ
   438 01522 0071 C        	MOV                 VALUE,A
   439 01523 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   440 01524 0000 C        	NOP	
   441 01525 0B06 C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   442 01526 0012 C        	RET
   443            C        
   444            C        ;===============================================
   445            C        ; Function: Write SPI communication subroutine rising edge
   446            C        ; Input:    ACC
   447            C        ; Output:   None
   448            C        ;===============================================
   449 01527      C        SIM_SPI_WRITE:
   450 01527 0050 C        	MOV                 SPIWB,A
   451 01528 1808 C        	MOV                 A,@8
   452 01529 0059 C        	MOV                 DataShiftCounter,A
   453 0152A      C          WRITE_SPI_1:
   454 0152A 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   455 0152B 06D0 C        	RLC                 SPIWB
   456 0152C 0C03 C        	JBC                 STATUS,C
   457 0152D 1530 C        	JMP                 SET_SPI_MOSI
   458 0152E 08C6 C        	BC                  SPI_MOSI/16,SPI_MOSI%16
   459 0152F 1531 C        	JMP                 WRITE_SPI_COUNT_DEC
   460 01530      C          SET_SPI_MOSI:
   461 01530 0AC6 C        	BS                  SPI_MOSI/16,SPI_MOSI%16
   462 01531      C          WRITE_SPI_COUNT_DEC:
   463 01531 0A86 C        	BS                  SPI_CLK/16,SPI_CLK%16
   464 01532 0000 C        	NOP
   465 01533 05D9 C        	DJZ                 DataShiftCounter
   466 01534 152A C        	JMP                 WRITE_SPI_1
   467 01535 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   468 01536 0000 C        	NOP
   469 01537 08C6 C        	BC                  SPI_MOSI/16,SPI_MOSI%16
   470 01538 0012 C        	RET
   471            C        
   472            C        ;===============================================
   473            C        ; Function: Read SPI communication subroutine rising edge
   474            C        ; Input:    None
   475            C        ; Output:   SPI Data
   476            C        ;===============================================
   477 01539      C        SIM_SPI_READ:
   478 01539 00D0 C        	CLR                 SPIRB
   479 0153A 1808 C        	MOV                 A,@8
   480 0153B 0059 C        	MOV                 DataShiftCounter,A
   481 0153C      C          READ_SPI_1:
   482 0153C 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   483 0153D 0000 C        	NOP
   484 0153E 0000 C        	NOP
   485 0153F 0000 C        	NOP
   486 01540 0A86 C        	BS                  SPI_CLK/16,SPI_CLK%16
   487 01541 0E06 C        	JBS                 SPI_MISO/16,SPI_MISO%16
   488 01542 1545 C        	JMP                 CLR_STATUS_C
   489 01543 0A03 C        	BS                  STATUS,C
   490 01544 1546 C        	JMP                 READ_SPI_MISO
   491 01545      C          CLR_STATUS_C:
   492 01545 0803 C        	BC                  STATUS,C
   493 01546      C          READ_SPI_MISO:
   494 01546 06D0 C        	RLC                 SPIRB
   495 01547 05D9 C        	DJZ                 DataShiftCounter
   496 01548 153C C        	JMP                 READ_SPI_1
   497 01549 0886 C        	BC                  SPI_CLK/16,SPI_CLK%16
   498 0154A 0410 C        	MOV                 A,SPIRB
   499 0154B 0012 C        	RET
   500            C        
   501            C        
   502            C        ;***********************************************************
   503            C        ; Function: Read FIFO RAM
   504            C        ; Input:    None
   505            C        ; Output:   RX_BUF	,Receive_Error
   506            C        ;***********************************************************
   507 0154C      C        READ_FIFO_RAM:
   508 0154C 1820 C        	MOV                 A,@RX_BUF					;READ DATA START Address
   509 0154D 0044 C        	MOV                 RSR,A
   510 0154E 0000 C        	NOP
   511 0154F 0000 C        	NOP
   512 01550 0906 C        	BC                  SPI_SS/16,SPI_SS%16				;/SS=0
   513 01551 18FF C        	MOV                 A,@0XFF						;0X7F||0X80 FIFO ADDRESS
   514 01552 1127 C        	CALL                SIM_SPI_WRITE
   515 01553 0000 C        	NOP
   516 01554 0000 C        	NOP
   517 01555 1810 C        	MOV                 A,@PKT_LEN
   518 01556 005A C        	MOV                 DataByteLength,A
   519 01557      C          Read_FIFO_Loop:
   520 01557 1139 C        	CALL                SIM_SPI_READ	 					;Packet & Device	ID
   521 01558 0040 C        	MOV                 R0, A
   522 01559 0544 C        	INC                 RSR
   523 0155A 05DA C        	DJZ                 DataByteLength
   524 0155B 1557 C        	JMP                 Read_FIFO_Loop
   525 0155C 0000 C        	NOP
   526 0155D 0B06 C        	BS                  SPI_SS/16,SPI_SS%16				;/SS=1
   527 0155E 0012 C        	RET
   528            C        
   529            C        
   530            C        ;***********************************************************
   531            C        ; Function: Write FIFO RAM
   532            C        ; Input:    None
   533            C        ; Output:   RX_Buf	,Receive_Error%16
   534            C        ;***********************************************************
   535 0155F      C        WRITE_FIFO_RAM:
   536 0155F 0906 C        	BC                  SPI_SS/16,SPI_SS%16    ;/SS=1
   537 01560 187F C        	MOV                 A,@0X7F         ;reg0X7F
   538 01561 1127 C        	CALL                SIM_SPI_WRITE   ;use I/O as	SPI	pro
   539 01562 0000 C        	NOP
   540 01563 1810 C        	MOV                 A,@PKT_LEN
   541 01564 005A C        	MOV                 DataByteLength,A
   542 01565 1820 C        	MOV                 A,@TX_BUF       ;Write DATA START Address
   543 01566 0044 C        	MOV                 RSR,A
   544 01567      C         Write_FIFO_Loop:
   545 01567 0400 C        	MOV                 A,R0
   546 01568 1127 C        	CALL                SIM_SPI_WRITE   ;use I/O as	SPI	pro
   547 01569 0000 C        	NOP
   548 0156A 0544 C        	INC                 RSR
   549 0156B 05DA C        	DJZ                 DataByteLength
   550 0156C 1567 C        	JMP                 Write_FIFO_Loop
   551 0156D 0B06 C        	BS                  SPI_SS/16,SPI_SS%16    ;/SS=1
   552 0156E 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16
   553 0156F 156E C        	JMP                 $-1
   554 01570 0012 C        	RET
   555            C        
   556            C        
   557            C        ;===============================================
   558            C        ; Function: Reset RF FIFO
   559            C        ; Input:    None
   560            C        ; Output:   None
   561            C        ;===============================================
   562 01571      C        RESET_RF_FIFO:
   563 01571 1305 C        	CALL                PAGE5BANK1
   564 01572 184D C        	MOV                 A,@0X4D
   565 01573 0070 C        	MOV                 ADDR,A					;ADDR=0X4D
   566 01574 1801 C        	MOV                 A,@0X01
   567 01575 0071 C        	MOV                 VALUE,A
   568 01576 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   569 01577 1802 C        	MOV                 A,@0X02
   570 01578 12C0 C        	CALL                DELAY_X100US
   571 01579 0012 C        	RET
   572            C        
   573            C        
   574            C        ;***********************************************************
   575            C        ; Function: Enter TX Buffered ACK
   576            C        ; Input:    None
   577            C        ; Output:   None
   578            C        ;***********************************************************
   579 0157A      C        ENTER_TX_BUFFER_ACK:
   580 0157A 1305 C        	CALL                PAGE5BANK1
   581 0157B 1800 C        	MOV                 A,@0X00
   582 0157C 0070 C        	MOV                 ADDR,A
   583 0157D 18E5 C        	MOV                 A,@0XE5
   584 0157E 0071 C        	MOV                 VALUE,A
   585 0157F 1110 C        	CALL                WRITE_SPI_REG
   586 01580 1801 C        	MOV                 A,@0X01
   587 01581 0070 C        	MOV                 ADDR,A
   588 01582 1884 C        	MOV                 A,@0X84
   589 01583 0071 C        	MOV                 VALUE,A
   590 01584 1110 C        	CALL                WRITE_SPI_REG
   591 01585 1841 C        	MOV                 A,@0X41
   592 01586 0070 C        	MOV                 ADDR,A
   593 01587 18BF C        	MOV                 A,@0XBF
   594 01588 0071 C        	MOV                 VALUE,A
   595 01589 1110 C        	CALL                WRITE_SPI_REG
   596 0158A 1840 C        	MOV                 A,@0X40
   597 0158B 0070 C        	MOV                 ADDR,A
   598 0158C 185E C        	MOV                 A,@0X5E
   599            C        	if                  USED_PID_FUNCTION
   600            C        		OR              A,@0X80
   601            C        	endif
   602 0158D 0071 C        	MOV                 VALUE,A
   603 0158E 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   604 0158F 0012 C        	RET
   605            C        
   606            C        
   607            C        ;***********************************************************
   608            C        ; Function: Enter TX Buffered NACK
   609            C        ; Input:    None
   610            C        ; Output:   None
   611            C        ;***********************************************************
   612 01590      C        Enter_TX_Buffer_NACK:
   613 01590 1305 C        	CALL                PAGE5BANK1
   614 01591 1800 C        	MOV                 A,@0X00
   615 01592 0070 C        	MOV                 ADDR,A
   616 01593 18E5 C        	MOV                 A,@0XE5
   617 01594 0071 C        	MOV                 VALUE,A
   618 01595 1110 C        	CALL                WRITE_SPI_REG
   619 01596 1801 C        	MOV                 A,@0X01
   620 01597 0070 C        	MOV                 ADDR,A
   621 01598 1884 C        	MOV                 A,@0X84
   622 01599 0071 C        	MOV                 VALUE,A
   623 0159A 1110 C        	CALL                WRITE_SPI_REG
   624 0159B 1841 C        	MOV                 A,@0X41
   625 0159C 0070 C        	MOV                 ADDR,A
   626 0159D 18BF C        	MOV                 A,@0XBF
   627 0159E 0071 C        	MOV                 VALUE,A
   628 0159F 1110 C        	CALL                WRITE_SPI_REG
   629 015A0 1840 C        	MOV                 A,@0X40
   630 015A1 0070 C        	MOV                 ADDR,A
   631 015A2 1856 C        	MOV                 A,@0X56
   632            C        	if                  USED_PID_FUNCTION
   633            C        		OR              A,@0X80
   634            C        	endif
   635 015A3 0071 C        	MOV                 VALUE,A
   636 015A4 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   637 015A5 0012 C        	RET
   638            C        
   639            C        
   640            C        ;***********************************************************
   641            C        ; Function: Enter TX Direct ACK
   642            C        ; Input:    None
   643            C        ; Output:   None
   644            C        ;***********************************************************
   645 015A6      C        Enter_TX_Direct_ACK:
   646 015A6 1305 C        	CALL                PAGE5BANK1
   647 015A7 1800 C        	MOV                 A,@0X00
   648 015A8 0070 C        	MOV                 ADDR,A
   649 015A9 1885 C        	MOV                 A,@0X85
   650 015AA 0071 C        	MOV                 VALUE,A
   651 015AB 1110 C        	CALL                WRITE_SPI_REG
   652 015AC 1801 C        	MOV                 A,@0X01
   653 015AD 0070 C        	MOV                 ADDR,A
   654 015AE 1884 C        	MOV                 A,@0X84
   655 015AF 0071 C        	MOV                 VALUE,A
   656 015B0 1110 C        	CALL                WRITE_SPI_REG
   657 015B1 1841 C        	MOV                 A,@0X41
   658 015B2 0070 C        	MOV                 ADDR,A
   659 015B3 18BF C        	MOV                 A,@0XBF
   660 015B4 0071 C        	MOV                 VALUE,A
   661 015B5 1110 C        	CALL                WRITE_SPI_REG
   662 015B6 1840 C        	MOV                 A,@0X40
   663 015B7 0070 C        	MOV                 ADDR,A
   664 015B8 185E C        	MOV                 A,@0X5E
   665            C        	if                  USED_PID_FUNCTION
   666            C        		OR              A,@0X80
   667            C        	endif
   668 015B9 0071 C        	MOV                 VALUE,A
   669 015BA 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   670 015BB 0012 C        	RET
   671            C        
   672            C        
   673            C        ;***********************************************************
   674            C        ; Function: Enter TX Direct NACK
   675            C        ; Input:    None
   676            C        ; Output:   None
   677            C        ;***********************************************************
   678 015BC      C        Enter_TX_Direct_NACK:
   679 015BC 1305 C        	CALL                PAGE5BANK1
   680 015BD 1800 C        	MOV                 A,@0X00
   681 015BE 0070 C        	MOV                 ADDR,A
   682 015BF 1885 C        	MOV                 A,@0X85
   683 015C0 0071 C        	MOV                 VALUE,A
   684 015C1 1110 C        	CALL                WRITE_SPI_REG
   685 015C2 1801 C        	MOV                 A,@0X01
   686 015C3 0070 C        	MOV                 ADDR,A
   687 015C4 1884 C        	MOV                 A,@0X84
   688 015C5 0071 C        	MOV                 VALUE,A
   689 015C6 1110 C        	CALL                WRITE_SPI_REG
   690 015C7 1841 C        	MOV                 A,@0X41
   691 015C8 0070 C        	MOV                 ADDR,A
   692 015C9 18BF C        	MOV                 A,@0XBF
   693 015CA 0071 C        	MOV                 VALUE,A
   694 015CB 1110 C        	CALL                WRITE_SPI_REG
   695 015CC 1840 C        	MOV                 A,@0X40
   696 015CD 0070 C        	MOV                 ADDR,A
   697 015CE 1856 C        	MOV                 A,@0X56
   698            C        	if                  USED_PID_FUNCTION
   699            C        		OR              A,@0X80
   700            C        	endif
   701 015CF 0071 C        	MOV                 VALUE,A
   702 015D0 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   703 015D1 0012 C        	RET
   704            C        
   705            C        
   706            C        ;***********************************************************
   707            C        ; Function: Enter RX Buffered ACK
   708            C        ; Input:    None
   709            C        ; Output:   None
   710            C        ;***********************************************************
   711 015D2      C        Enter_RX_Buffer_ACK:
   712 015D2 1305 C        	CALL                PAGE5BANK1
   713 015D3 1800 C        	MOV                 A,@0X00
   714 015D4 0070 C        	MOV                 ADDR,A
   715 015D5 18E5 C        	MOV                 A,@0XE5
   716 015D6 0071 C        	MOV                 VALUE,A
   717 015D7 1110 C        	CALL                WRITE_SPI_REG
   718 015D8 1801 C        	MOV                 A,@0X01
   719 015D9 0070 C        	MOV                 ADDR,A
   720 015DA 1884 C        	MOV                 A,@0X84
   721 015DB 0071 C        	MOV                 VALUE,A
   722 015DC 1110 C        	CALL                WRITE_SPI_REG
   723 015DD 1841 C        	MOV                 A,@0X41
   724 015DE 0070 C        	MOV                 ADDR,A
   725 015DF 18BF C        	MOV                 A,@0XBF
   726 015E0 0071 C        	MOV                 VALUE,A
   727 015E1 1110 C        	CALL                WRITE_SPI_REG
   728 015E2 1840 C        	MOV                 A,@0X40
   729 015E3 0070 C        	MOV                 ADDR,A
   730 015E4 185D C        	MOV                 A,@0X5D
   731            C        	if                  USED_PID_FUNCTION
   732            C        		OR              A,@0X80
   733            C        	endif
   734 015E5 0071 C        	MOV                 VALUE,A
   735 015E6 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   736 015E7 0000 C        	NOP
   737 015E8 0012 C        	RET
   738            C        
   739            C        
   740            C        ;**********************************************************
   741            C        ; Function: Enter RX Buffered NACK
   742            C        ; Input:    None
   743            C        ; Output:   None
   744            C        ;***********************************************************
   745 015E9      C        Enter_RX_Buffer_NACK:
   746 015E9 1305 C        	CALL                PAGE5BANK1
   747 015EA 1800 C        	MOV                 A,@0X00
   748 015EB 0070 C        	MOV                 ADDR,A
   749 015EC 18E5 C        	MOV                 A,@0XE5
   750 015ED 0071 C        	MOV                 VALUE,A
   751 015EE 1110 C        	CALL                WRITE_SPI_REG
   752 015EF 1801 C        	MOV                 A,@0X01
   753 015F0 0070 C        	MOV                 ADDR,A
   754 015F1 1884 C        	MOV                 A,@0X84
   755 015F2 0071 C        	MOV                 VALUE,A
   756 015F3 1110 C        	CALL                WRITE_SPI_REG
   757 015F4 1841 C        	MOV                 A,@0X41
   758 015F5 0070 C        	MOV                 ADDR,A
   759 015F6 18BF C        	MOV                 A,@0XBF
   760 015F7 0071 C        	MOV                 VALUE,A
   761 015F8 1110 C        	CALL                WRITE_SPI_REG
   762 015F9 1840 C        	MOV                 A,@0X40
   763 015FA 0070 C        	MOV                 ADDR,A
   764 015FB 1855 C        	MOV                 A,@0X55
   765            C        	if                  USED_PID_FUNCTION
   766            C        		OR              A,@0X80
   767            C        	endif
   768 015FC 0071 C        	MOV                 VALUE,A
   769 015FD 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   770 015FE 0012 C        	RET
   771            C        
   772            C        
   773            C        ;***********************************************************
   774            C        ; Function: Enter RX Direct ACK
   775            C        ; Input:    None
   776            C        ; Output:   None
   777            C        ;***********************************************************
   778 015FF      C        Enter_RX_Direct_ACK:
   779 015FF 1305 C        	CALL                PAGE5BANK1
   780 01600 1800 C        	MOV                 A,@0X00
   781 01601 0070 C        	MOV                 ADDR,A
   782 01602 1885 C        	MOV                 A,@0X85
   783 01603 0071 C        	MOV                 VALUE,A
   784 01604 1110 C        	CALL                WRITE_SPI_REG
   785 01605 1801 C        	MOV                 A,@0X01
   786 01606 0070 C        	MOV                 ADDR,A
   787 01607 1884 C        	MOV                 A,@0X84
   788 01608 0071 C        	MOV                 VALUE,A
   789 01609 1110 C        	CALL                WRITE_SPI_REG
   790 0160A 1841 C        	MOV                 A,@0X41
   791 0160B 0070 C        	MOV                 ADDR,A
   792 0160C 18BF C        	MOV                 A,@0XBF
   793 0160D 0071 C        	MOV                 VALUE,A
   794 0160E 1110 C        	CALL                WRITE_SPI_REG
   795 0160F 1840 C        	MOV                 A,@0X40
   796 01610 0070 C        	MOV                 ADDR,A
   797 01611 185D C        	MOV                 A,@0X5D
   798            C        	if                  USED_PID_FUNCTION
   799            C        		OR              A,@0X80
   800            C        	endif
   801 01612 0071 C        	MOV                 VALUE,A
   802 01613 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   803 01614 0012 C        	RET
   804            C        
   805            C        
   806            C        ;**********************************************************
   807            C        ; Function: Enter RX Direct NACK
   808            C        ; Input:    None
   809            C        ; Output:   None
   810            C        ;***********************************************************
   811 01615      C        Enter_RX_Direct_NACK:
   812 01615 1305 C        	CALL                PAGE5BANK1
   813 01616 1800 C        	MOV                 A,@0X00
   814 01617 0070 C        	MOV                 ADDR,A
   815 01618 1885 C        	MOV                 A,@0X85
   816 01619 0071 C        	MOV                 VALUE,A
   817 0161A 1110 C        	CALL                WRITE_SPI_REG
   818 0161B 1801 C        	MOV                 A,@0X01
   819 0161C 0070 C        	MOV                 ADDR,A
   820 0161D 1884 C        	MOV                 A,@0X84
   821 0161E 0071 C        	MOV                 VALUE,A
   822 0161F 1110 C        	CALL                WRITE_SPI_REG
   823 01620 1841 C        	MOV                 A,@0X41
   824 01621 0070 C        	MOV                 ADDR,A
   825 01622 18BF C        	MOV                 A,@0XBF
   826 01623 0071 C        	MOV                 VALUE,A
   827 01624 1110 C        	CALL                WRITE_SPI_REG
   828 01625 1840 C        	MOV                 A,@0X40
   829 01626 0070 C        	MOV                 ADDR,A
   830 01627 1855 C        	MOV                 A,@0X55
   831            C        	if                  USED_PID_FUNCTION
   832            C        		OR              A,@0X80
   833            C        	endif
   834 01628 0071 C        	MOV                 VALUE,A
   835 01629 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   836 0162A 0012 C        	RET
   837            C        
   838            C        
   839            C        ;***********************************************************
   840            C        ; Function: Enter StandbyI Mode
   841            C        ; Input:    None
   842            C        ; Output:   None
   843            C        ; description:
   844            C        ;***********************************************************
   845 0162B      C        Enter_StandbyI_Mode:
   846 0162B 1305 C        	CALL                PAGE5BANK1
   847 0162C 1800 C        	MOV                 A,@0X00
   848 0162D 0070 C        	MOV                 ADDR,A
   849 0162E 1865 C        	MOV                 A,@0X65
   850 0162F 0071 C        	MOV                 VALUE,A
   851 01630 1110 C        	CALL                WRITE_SPI_REG
   852 01631 1801 C        	MOV                 A,@0X01
   853 01632 0070 C        	MOV                 ADDR,A
   854 01633 188C C        	MOV                 A,@0X8C
   855 01634 0071 C        	MOV                 VALUE,A
   856 01635 1110 C        	CALL                WRITE_SPI_REG
   857 01636 1840 C        	MOV                 A,@0X40
   858 01637 0070 C        	MOV                 ADDR,A
   859 01638 1850 C        	MOV                 A,@0X50
   860            C        	if USED_PID_FUNCTION
   861            C        		OR              A,@0X80
   862            C        	endif
   863 01639 0071 C        	MOV                 VALUE,A
   864 0163A 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   865 0163B 0012 C        	RET
   866            C        
   867            C        
   868            C        ;***********************************************************
   869            C        ; Function: Enter StandbyII Mode
   870            C        ; Input:    None
   871            C        ; Output:   None
   872            C        ; description: auto enter
   873            C        ;***********************************************************
   874 0163C      C        Enter_StandbyII_Mode:
   875 0163C 1305 C        	CALL                PAGE5BANK1
   876 0163D 1800 C        	MOV                 A,@0X00
   877 0163E 0070 C        	MOV                 ADDR,A
   878 0163F 18E5 C        	MOV                 A,@0XE5
   879 01640 0071 C        	MOV                 VALUE,A
   880 01641 1110 C        	CALL                WRITE_SPI_REG
   881 01642 1801 C        	MOV                 A,@0X01
   882 01643 0070 C        	MOV                 ADDR,A
   883 01644 1884 C        	MOV                 A,@0X84
   884 01645 0071 C        	MOV                 VALUE,A
   885 01646 1110 C        	CALL                WRITE_SPI_REG
   886 01647 1841 C        	MOV                 A,@0X41
   887 01648 0070 C        	MOV                 ADDR,A
   888 01649 18BF C        	MOV                 A,@0XBF
   889 0164A 0071 C        	MOV                 VALUE,A
   890 0164B 1110 C        	CALL                WRITE_SPI_REG
   891 0164C 1840 C        	MOV                 A,@0X40
   892 0164D 0070 C        	MOV                 ADDR,A
   893 0164E 1852 C        	MOV                 A,@0X52
   894            C        	if                  USED_PID_FUNCTION
   895            C        		OR              A,@0X80
   896            C        	endif
   897 0164F 0071 C        	MOV                 VALUE,A
   898 01650 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   899 01651 0012 C        	RET
   900            C        
   901            C        
   902            C        ;===============================================
   903            C        ; Function: Enter Idle Mode
   904            C        ; Input:    None
   905            C        ; Output:   None
   906            C        ;===============================================
   907 01652      C        ENTER_IDLE_MODE:
   908 01652 1305 C        	CALL                PAGE5BANK1
   909 01653 1800 C        	MOV                 A,@0X00
   910 01654 0070 C        	MOV                 ADDR,A
   911 01655 18C0 C        	MOV                 A,@0XC0
   912 01656 0071 C        	MOV                 VALUE,A
   913 01657 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   914 01658 1801 C        	MOV                 A,@0X01
   915 01659 0070 C        	MOV                 ADDR,A
   916 0165A 188A C        	MOV                 A,@0X8A
   917 0165B 0071 C        	MOV                 VALUE,A
   918 0165C 1110 C        	CALL                WRITE_SPI_REG
   919 0165D 1302 C        	CALL                PAGE5BANK0
   920 0165E 0846 C        	BC                  RESET_N/16,RESET_N%16
   921 0165F 1305 C        	CALL                PAGE5BANK1
   922 01660 0012 C        	RET
   923            C        
   924            C        
   925            C        ;===============================================
   926            C        ; Function: RF Enter Sleep Mode
   927            C        ; Input:    ADDR,VALUE
   928            C        ; Output:   None
   929            C        ;===============================================
   930 01661      C        ENTER_RF_SLEEP:
   931 01661 1305 C        	CALL                PAGE5BANK1
   932 01662 1800 C        	MOV                 A,@0X00
   933 01663 0070 C        	MOV                 ADDR,A
   934 01664 18E5 C        	MOV                 A,@0XE5
   935 01665 0071 C        	MOV                 VALUE,A
   936 01666 1110 C        	CALL                WRITE_SPI_REG
   937 01667 0000 C        	NOP
   938 01668 1302 C        	CALL                PAGE5BANK0
   939 01669 0846 C        	BC                  RESET_N/16,RESET_N%16
   940 0166A 1305 C        	CALL                PAGE5BANK1
   941 0166B 0012 C        	RET
   942            C        
   943            C        
   944            C        ;===============================================
   945            C        ; Function: RF Wake Up
   946            C        ; Input:    None
   947            C        ; Output:   None
   948            C        ;===============================================
   949 0166C      C        RF_WAKEUP:
   950 0166C 0A46 C        	BS                  RESET_N/16,RESET_N%16
   951 0166D 1800 C        	MOV                 A,@0X00
   952 0166E 0070 C        	MOV                 ADDR,A
   953 0166F 18E5 C        	MOV                 A, @0XE5
   954 01670 0071 C        	MOV                 VALUE,A
   955 01671 1110 C        	CALL                WRITE_SPI_REG
   956 01672 180F C        	MOV                 A,@0X0F
   957 01673 12C0 C        	CALL                DELAY_X100US
   958 01674 0012 C        	RET
   959            C        
   960            C        
   961            C        ;===============================================
   962            C        ; Function: RF Channel Frequency Set
   963            C        ; Input:    TABLE_INDEX
   964            C        ; Output:   None
   965            C        ;===============================================
   966 01675      C        RF_FREQ_SET:
   967 01675 1305 C        	CALL                PAGE5BANK1
   968 01676 1802 C        	MOV                 A,@0X02
   969 01677 0070 C        	MOV                 ADDR,A
   970 01678 0433 C        	MOV                 A,CH_NO
   971 01679 10AC C        	CALL                CH_TABLE
   972 0167A 0071 C        	MOV                 VALUE,A
   973 0167B 1110 C        	CALL                WRITE_SPI_REG
   974 0167C 0012 C        	RET
   975            C        
   976            C        
   977            C        ;===============================================
   978            C        ; Function: Read PKT Lost Count
   979            C        ; Input:    None
   980            C        ; Output:   PKT_Lost_Count
   981            C        ;===============================================
   982 0167D      C        Read_PKT_LOST_CNT:
   983 0167D 184F C        	MOV                 A,@0X4F
   984 0167E 0070 C        	MOV                 ADDR,A
   985 0167F 111B C        	CALL                READ_SPI_REG
   986 01680 0012 C        	RET
   987            C        
   988            C        
   989            C        ;===============================================
   990            C        ; Function: Clr PKT Lost Count
   991            C        ; Input:    Zero
   992            C        ; Output:   None
   993            C        ;===============================================
   994 01681      C        CLR_PKT_LOST_CNT:
   995 01681 184F C        	MOV                 A,@0X4F
   996 01682 0070 C        	MOV                 ADDR,A
   997 01683 1800 C        	MOV                 A,@0X00
   998 01684 0071 C        	MOV                 VALUE,A
   999 01685 1110 C        	CALL                WRITE_SPI_REG
  1000 01686 0012 C        	RET
  1001            C        
  1002            C        ;===============================================
  1003            C        ; Function: Address change function
  1004            C        ; Input:    RX_IDH,RX_IDL
  1005            C        ; Output:   None
  1006            C        ;===============================================
  1007 01687      C        CHANGE_ADDRESS_VALUE:
  1008 01687 1305 C        	CALL                PAGE5BANK1
  1009 01688 1841 C        	MOV                 A,@0X41
  1010 01689 0070 C        	MOV                 ADDR,A
  1011 0168A 18BF C        	MOV                 A,@0B10111111
  1012 0168B 0071 C        	MOV                 VALUE,A
  1013 0168C 1110 C        	CALL                WRITE_SPI_REG    ; Enalbe 6 TX
  1014            C        
  1015 0168D 1851 C        	MOV                 A,@0X51
  1016 0168E 0070 C        	MOV                 ADDR,A
  1017 0168F 0421 C        	MOV                 A,RX_IDH
  1018 01690 0071 C        	MOV                 VALUE,A
  1019 01691 1110 C        	CALL                WRITE_SPI_REG
  1020            C        
  1021 01692 1853 C        	MOV                 A,@0X53
  1022 01693 0070 C        	MOV                 ADDR,A
  1023 01694 0421 C        	MOV                 A,RX_IDH
  1024 01695 0071 C        	MOV                 VALUE,A
  1025 01696 1110 C        	CALL                WRITE_SPI_REG
  1026            C        
  1027 01697 0422 C        	MOV                 A,RX_IDL
  1028 01698 1AF0 C        	AND                 A,@0B11110000
  1029 01699 0054 C        	MOV                 TEMP4,A
  1030 0169A 0554 C        	INC                 TEMP4
  1031            C        
  1032 0169B 1850 C        	MOV                 A,@0X50
  1033 0169C 0070 C        	MOV                 ADDR,A
  1034 0169D 0414 C        	MOV                 A,TEMP4
  1035 0169E 1F00 C        	ADD                 A,@0
  1036 0169F 0071 C        	MOV                 VALUE,A      ; TX_ID1=(RX_IDL&0XF0)|0X01
  1037 016A0 1110 C        	CALL                WRITE_SPI_REG
  1038            C        
  1039 016A1 1852 C        	MOV                 A,@0X52
  1040 016A2 0070 C        	MOV                 ADDR,A
  1041 016A3 0414 C        	MOV                 A,TEMP4
  1042 016A4 1F01 C        	ADD                 A,@1
  1043 016A5 0071 C        	MOV                 VALUE,A      ; TX_ID2=(RX_IDL&0XF0)|0X02
  1044 016A6 1110 C        	CALL                WRITE_SPI_REG
  1045            C        
  1046 016A7 1854 C        	MOV                 A,@0X54
  1047 016A8 0070 C        	MOV                 ADDR,A
  1048 016A9 0414 C        	MOV                 A,TEMP4
  1049 016AA 1F02 C        	ADD                 A,@2
  1050 016AB 0071 C        	MOV                 VALUE,A      ; TX_ID3=(RX_IDL&0XF0)|0X03
  1051 016AC 1110 C        	CALL                WRITE_SPI_REG
  1052            C        
  1053 016AD 1855 C        	MOV                 A,@0X55
  1054 016AE 0070 C        	MOV                 ADDR,A
  1055 016AF 0414 C        	MOV                 A,TEMP4
  1056 016B0 1F03 C        	ADD                 A,@3
  1057 016B1 0071 C        	MOV                 VALUE,A      ; TX_ID4=(RX_IDL&0XF0)|0X04
  1058 016B2 1110 C        	CALL                WRITE_SPI_REG
  1059            C        
  1060 016B3 1856 C        	MOV                 A,@0X56
  1061 016B4 0070 C        	MOV                 ADDR,A
  1062 016B5 0414 C        	MOV                 A,TEMP4
  1063 016B6 1F04 C        	ADD                 A,@4
  1064 016B7 0071 C        	MOV                 VALUE,A      ; TX_ID5=(RX_IDL&0XF0)|0X05
  1065 016B8 1110 C        	CALL                WRITE_SPI_REG
  1066            C        
  1067 016B9 1857 C        	MOV                 A,@0X57
  1068 016BA 0070 C        	MOV                 ADDR,A
  1069 016BB 0414 C        	MOV                 A,TEMP4
  1070 016BC 1F05 C        	ADD                 A,@5
  1071 016BD 0071 C        	MOV                 VALUE,A      ; TX_ID6=(RX_IDL&0XF0)|0X06
  1072 016BE 1110 C        	CALL                WRITE_SPI_REG
  1073 016BF 0012 C        	RET
  1074            C        	
  1075            C        
  1076            C        ;===============================================
  1077            C        ; Function: Delay 100us
  1078            C        ; Input:    None
  1079            C        ; Output:   None
  1080            C        ;===============================================
  1081 016C0      C        DELAY_X100US:
  1082 016C0 0051 C        	MOV                 TEMP1,A
  1083 016C1      C          Delay_Loop:
  1084 016C1 1850 C        	MOV                 A,@0X50      ;
  1085 016C2 0052 C        	MOV                 TEMP2,A
  1086 016C3      C          Waiting:
  1087 016C3 0000 C          	NOP
  1088 016C4 05D2 C        	DJZ                 TEMP2
  1089 016C5 16C3 C        	JMP                 Waiting
  1090 016C6 05D1 C        	DJZ                 TEMP1
  1091 016C7 16C1 C        	JMP                 Delay_Loop
  1092 016C8 0012 C        	RET
  1093            C        
  1094            C        
  1095            C        ;===============================================
  1096            C        ;test RF Register, if read==write test pass
  1097            C        ;===============================================
  1098 016C9      C        TEST_INITIAL_RF:
  1099 016C9      C          Analog_Reg_Test:
  1100 016C9 1807 C        	MOV                 A,@0X07
  1101 016CA 0070 C        	MOV                 ADDR,A
  1102 016CB 1858 C        	MOV                 A,@0X58						;R7[6]=1
  1103 016CC 0071 C        	MOV                 VALUE,A
  1104 016CD 1110 C        	CALL                WRITE_SPI_REG
  1105 016CE 0000 C        	NOP
  1106 016CF 180E C        	MOV                 A,@0X0E
  1107 016D0 0070 C        	MOV                 ADDR,A
  1108 016D1 1811 C        	MOV                 A,@0X11						;RE[7]=0
  1109 016D2 0071 C        	MOV                 VALUE,A
  1110 016D3 1110 C        	CALL                WRITE_SPI_REG
  1111 016D4 0000 C        	NOP
  1112 016D5 182E C        	MOV                 A,@0X2E
  1113 016D6 0070 C        	MOV                 ADDR,A
  1114 016D7 1823 C        	MOV                 A,@0X23						;R2E[5]=1
  1115 016D8 0071 C        	MOV                 VALUE,A
  1116 016D9 1110 C        	CALL                WRITE_SPI_REG
  1117 016DA 0000 C        	NOP
  1118 016DB 180E C        	MOV                 A,@0X0E
  1119 016DC 0070 C        	MOV                 ADDR,A
  1120 016DD 1891 C        	MOV                 A,@0X91						;RE[7]=1
  1121 016DE 0071 C        	MOV                 VALUE,A
  1122 016DF 1110 C        	CALL                WRITE_SPI_REG
  1123 016E0 0000 C        	NOP
  1124 016E1 11D2 C        	CALL                Enter_RX_Buffer_ACK
  1125 016E2 0000 C        	NOP
  1126            C        	;MOV                 A,@8
  1127            C        	;CALL                DELAY_X100US
  1128 016E3 0000 C        	NOP
  1129 016E4 184B C        	MOV                 A,@0X4B
  1130 016E5 0070 C        	MOV                 ADDR,A
  1131 016E6 111B C        	CALL                READ_SPI_REG
  1132 016E7 0000 C        	NOP
  1133 016E8 0C31 C        	JBC                 VALUE,0					;R4B[0]:LD=1,Analog Reg Initial is OK
  1134 016E9 16EC C        	JMP                 Digit_Reg_Test
  1135 016EA 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1136 016EB 1701 C        	JMP                 RF_TEST_RET
  1137 016EC      C          Digit_Reg_Test:
  1138 016EC 00D8 C        	CLR                 TABLE_INDEX
  1139 016ED      C          Check_Digit_Reg:
  1140 016ED 0418 C        	MOV                 A,TABLE_INDEX
  1141 016EE 108C C        	CALL                RF_TABLE
  1142 016EF 0000 C        	NOP
  1143 016F0 0070 C        	MOV                 ADDR,A
  1144 016F1 1BFF C        	XOR                 A, @0XFF
  1145 016F2 0C83 C        	JBC                 STATUS,Z
  1146 016F3 1701 C        	JMP                 RF_TEST_RET
  1147 016F4 111B C        	CALL                READ_SPI_REG
  1148 016F5 0000 C        	NOP
  1149 016F6 0558 C        	INC                 TABLE_INDEX
  1150 016F7 0418 C        	MOV                 A,TABLE_INDEX
  1151 016F8 108C C        	CALL                RF_TABLE
  1152 016F9 0000 C        	NOP
  1153 016FA 0331 C        	XOR                 A,VALUE
  1154 016FB 0C83 C        	JBC                 STATUS,Z
  1155 016FC 16FF C        	JMP                 RF_TABLE_INC
  1156 016FD 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1157 016FE 1701 C        	JMP                 RF_TEST_RET
  1158 016FF      C          RF_TABLE_INC:
  1159 016FF 0558 C        	INC                 TABLE_INDEX
  1160 01700 16ED C        	JMP                 Check_Digit_Reg
  1161 01701      C          RF_TEST_RET:
  1162 01701 0012 C        	RET
  1163            C        
  1164            C        
  1165            C        ;=====================================================================
  1166            C        ; BANK exchange function
  1167            C        ;=====================================================================
  1168 01702      C        PAGE5BANK0:
  1169 01702 09C4 C        	BC        0X04,7
  1170 01703 0984 C        	BC        0X04,6
  1171 01704 0012 C        RET
  1172 01705      C        PAGE5BANK1:
  1173 01705 09C4 C        	BC        0X04,7
  1174 01706 0B84 C        	BS        0X04,6
  1175 01707 0012 C        RET
  1176 01708      C        PAGE5BANK2:
  1177 01708 0BC4 C        	BS        0X04,7
  1178 01709 0984 C        	BC        0X04,6
  1179 0170A 0012 C        RET
  1180 0170B      C        PAGE5BANK3:
  1181 0170B 0BC4 C        	BS        0X04,7
  1182 0170C 0B84 C        	BS        0X04,6
  1183 0170D 0012 C        RET
    19                     include "M611SkipFreqFun.ASM"
     1            C        ;==================================================================
     2            C        ; Filename     :  EM78M611
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        ;=========================================================================
    11            C        M611SKIPFREQFUN.ASM    EQU    M611SKIPFREQFUN.ASM
    12            C        
    13            C        ifndef M611rxP40M1v6V10.H
    14            C        include "M611rxP40M1v6V10.H"
    15            C        endif
    16            C        
    17            C        ifndef EM78CtrlIns.H
    18            C        include "EM78CtrlIns.H"
    19            C        endif
    20            C        ;=========================================================================
    21            C        
    22            C        
    23            C        
    24            C        	ORG                 0X200    ;PAGE 0
    25            C        ;=======================================================================
    26            C        ; Sync    Communication function
    27            C        ; input:  none
    28            C        ; output: none
    29            C        ;=======================================================================
    30 00200      C        SYNC_COM_TX:
    31 00200 0000 C        	NOP
    32 00201 0004 C        	WDTC
    33            C      M 	PAGE                5
       00202 0BC3     1     BS  3 , 7 
       00203 0983     1     BC  3 , 6 
       00204 0B43     1     BS  3 , 5 
    34 00205 1275 C        	CALL                RF_FREQ_SET
    35            C      M 	PAGE                4
       00206 0BC3     1     BS  3 , 7 
       00207 0983     1     BC  3 , 6 
       00208 0943     1     BC  3 , 5 
    36 00209 1000 C         	CALL                Communicate_USB_Function
    37            C      M  	PAGE                0
       0020A 09C3     1     BC  3 , 7 
       0020B 0983     1     BC  3 , 6 
       0020C 0943     1     BC  3 , 5 
    38            C        ;-----------------------------------------------------------------
    39 0020D 041B C        	MOV                 A,ComuClock                  ; ComuClock == 6 will continue
    40 0020E 1D05 C        	SUB                 A,@5
    41 0020F 0C03 C        	JBC                 STATUS,C
    42 00210 160D C        	JMP                 $-3
    43            C        ;-----------------------------------------------------------------
    44            C        
    45            C        	;MOV                 A,@PKT_LEN                   ;16 Bytes length
    46            C        	;MOV                 DataByteLength,A
    47            C        
    48 00211 11B5 C        	CALL                PAGE0BANK0
    49 00212 1800 C        	MOV                 A,@0X00                      ;PID_DATA
    50 00213 0060 C        	MOV                 PID_DATA_Buffer,A
    51            C        
    52 00214 11B8 C        	CALL                PAGE0BANK1
    53 00215 0421 C        	MOV                 A,RX_IDH			         ;RX_IDH
    54 00216 11B5 C        	CALL                PAGE0BANK0
    55 00217 0061 C        	MOV                 RX_IDH_Buffer,A
    56            C        
    57 00218 11B8 C        	CALL                PAGE0BANK1
    58 00219 0422 C        	MOV                 A,RX_IDL                     ;RX_IDL
    59 0021A 11B5 C        	CALL                PAGE0BANK0
    60 0021B 0062 C        	MOV                 RX_IDL_Buffer,A
    61            C        
    62 0021C 11B8 C        	CALL                PAGE0BANK1
    63 0021D 0423 C        	MOV                 A,CHN_FLAG                   ;CHN_FLAG
    64 0021E 11B5 C        	CALL                PAGE0BANK0
    65 0021F 0063 C        	MOV                 CHN_FLAG_Buffer,A
    66            C        
    67 00220 041E C        	MOV                 A,CommuStatusFlag            ;CommuStatusFlag
    68 00221 0064 C        	MOV                 CommuStatusFlag_Buffer,A
    69            C        
    70 00222 11B8 C        	CALL                PAGE0BANK1
    71 00223 0424 C        	MOV                 A,DirectionCtrl              ;DirectionCtrl
    72 00224 11B5 C        	CALL                PAGE0BANK0
    73 00225 0065 C        	MOV                 DirectionCtrl_Buffer,A
    74            C        
    75 00226 11B8 C        	CALL                PAGE0BANK1
    76 00227 1806 C        	MOV                 A,@TotalGamepads             ;N_CHN=(TotalGamepads << 4) | CH_NO
    77 00228 0065 C        	MOV                 N_CHN,A
    78 00229 0765 C        	SWAP                N_CHN
    79 0022A 0433 C        	MOV                 A,CH_NO
    80 0022B 0265 C        	OR                  N_CHN,A
    81 0022C 0425 C        	MOV                 A,N_CHN                      ;CH_NO,  ;Current freqency NUM
    82 0022D 11B5 C        	CALL                PAGE0BANK0
    83 0022E 0066 C        	MOV                 N_CHN_Buffer,A
    84            C        
    85 0022F 041E C        	MOV                 A,CommuStatusFlag            ;CommuStatusFlag
    86 00230 0064 C        	MOV                 CommuStatusFlag_Buffer,A
    87            C        
    88 00231 11B8 C        	CALL                PAGE0BANK1
    89 00232 0424 C        	MOV                 A,DirectionCtrl              ;DirectionCtrl
    90 00233 11B5 C        	CALL                PAGE0BANK0
    91 00234 0065 C        	MOV                 DirectionCtrl_Buffer,A
    92            C        
    93 00235 11B8 C        	CALL                PAGE0BANK1
    94 00236 0427 C        	MOV                 A,TX1_ID                     ;TX1_ID
    95 00237 11B5 C        	CALL                PAGE0BANK0
    96 00238 0067 C        	MOV                 TX1_ID_Buffer,A
    97            C        
    98 00239 11B8 C        	CALL                PAGE0BANK1
    99 0023A 0428 C        	MOV                 A,TX2_ID                     ;TX2_ID
   100 0023B 11B5 C        	CALL                PAGE0BANK0
   101 0023C 0068 C        	MOV                 TX2_ID_Buffer,A
   102            C        
   103 0023D 11B8 C        	CALL                PAGE0BANK1
   104 0023E 0429 C        	MOV                 A,TX3_ID                     ;TX3_ID
   105 0023F 11B5 C        	CALL                PAGE0BANK0
   106 00240 0069 C        	MOV                 TX3_ID_Buffer,A
   107            C        
   108 00241 11B8 C        	CALL                PAGE0BANK1
   109 00242 042A C        	MOV                 A,TX4_ID                     ;TX4_ID
   110 00243 11B5 C        	CALL                PAGE0BANK0
   111 00244 006A C        	MOV                 TX4_ID_Buffer,A
   112            C        
   113 00245 11B8 C        	CALL                PAGE0BANK1
   114 00246 042B C        	MOV                 A,TX5_ID                     ;TX5_ID
   115 00247 11B5 C        	CALL                PAGE0BANK0
   116 00248 006B C        	MOV                 TX5_ID_Buffer,A
   117            C        
   118 00249 11B8 C        	CALL                PAGE0BANK1
   119 0024A 042C C        	MOV                 A,TX6_ID                     ;TX6_ID
   120 0024B 11B5 C        	CALL                PAGE0BANK0
   121 0024C 006C C        	MOV                 TX6_ID_Buffer,A
   122            C        
   123            C        ;---------------------------------------------------------------------
   124 0024D 11B5 C        	CALL                PAGE0BANK0
   125 0024E 0430 C        	MOV                 A,GS_XPoint_LOW_Buffer
   126 0024F 11B8 C        	CALL                PAGE0BANK1
   127 00250 0079 C        	MOV                 GS_XPoint_LOW,A
   128            C        
   129 00251 11B5 C        	CALL                PAGE0BANK0
   130 00252 0431 C        	MOV                 A,GS_YPoint_LOW_Buffer
   131 00253 11B8 C        	CALL                PAGE0BANK1
   132 00254 007A C        	MOV                 GS_YPoint_LOW,A
   133            C        
   134 00255 11B5 C        	CALL                PAGE0BANK0
   135 00256 0432 C        	MOV                 A,GS_ZPoint_LOW_Buffer
   136 00257 11B8 C        	CALL                PAGE0BANK1
   137 00258 007B C        	MOV                 GS_ZPoint_LOW,A
   138            C        
   139 00259 11B5 C        	CALL                PAGE0BANK0
   140 0025A 0433 C        	MOV                 A,GS_Point_HIGH_Buffer
   141 0025B 11B8 C        	CALL                PAGE0BANK1
   142 0025C 007C C        	MOV                 GS_Point_HIGH,A
   143            C        
   144 0025D 11B5 C        	CALL                PAGE0BANK0
   145 0025E 0434 C        	MOV                 A,CMOS_XPoint_LOW_Buffer
   146 0025F 11B8 C        	CALL                PAGE0BANK1
   147 00260 007D C        	MOV                 CMOS_XPoint_LOW,A
   148            C        
   149 00261 11B5 C        	CALL                PAGE0BANK0
   150 00262 0435 C        	MOV                 A,CMOS_YPoint_LOW_Buffer
   151 00263 11B8 C        	CALL                PAGE0BANK1
   152 00264 007E C        	MOV                 CMOS_YPoint_LOW,A
   153            C        
   154 00265 11B5 C        	CALL                PAGE0BANK0
   155 00266 0436 C        	MOV                 A,CMOS_Point_HIGH_Buffer
   156 00267 11B8 C        	CALL                PAGE0BANK1
   157 00268 007F C        	MOV                 CMOS_Point_HIGH,A
   158            C        
   159            C        ;-------------------------------------------------------------------
   160            C      M 	PAGE                5
       00269 0BC3     1     BS  3 , 7 
       0026A 0983     1     BC  3 , 6 
       0026B 0B43     1     BS  3 , 5 
   161 0026C 1190 C        	CALL                Enter_TX_Buffer_NACK
   162 0026D 1171 C        	CALL                Reset_RF_FIFO		
   163 0026E 115F C        	CALL                Write_FIFO_RAM
   164            C      M 	PAGE                0
       0026F 09C3     1     BC  3 , 7 
       00270 0983     1     BC  3 , 6 
       00271 0943     1     BC  3 , 5 
   165            C        ;---------------------------------------------------------------------------------
   166 00272 18D1 C        	MOV                 A,@(256-47)               ; N=47,P=64,f=4MHz ==> T=1ms
   167 00273 0041 C        	MOV                 TCC,A                     ; TCC reload by PKT pull high
   168 00274 1880 C        	MOV                 A,@0X80                   ; (test)P57 exchange when intrrupt
   169 00275 0345 C        	XOR                 PORT5,A
   170 00276 00DB C        	CLR                 ComuClock                 ; ComuClock = 0
   171            C        ;-----------------------------------------------------------------------------------
   172 00277 0000 C        	NOP
   173 00278 0012 C        	RET
   174            C        
   175            C        ;*****************************************************************
   176            C        ;Function:    mode select
   177            C        ;Input:
   178            C        ;Output:      None
   179            C        ;desciption:  set timing and select mode
   180            C        ;*****************************************************************
   181 00279      C        SearchLinkMode_Set: ;0x11
   182 00279 0A1E C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   183 0027A 085E C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   184 0027B 08DE C        	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   185 0027C 0B1E C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   186 0027D 095E C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   187 0027E 099E C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   188 0027F 0012 C        	RET
   189 00280      C        NormalLinkMode_Set: ;0x12
   190 00280 081E C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   191 00281 0A5E C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   192 00282 08DE C        	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   193 00283 0B1E C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   194 00284 095E C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   195 00285 099E C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   196 00286 0012 C        	RET
   197 00287      C        SearchForceLinkMode_Set: ;0x21
   198 00287 0A1E C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   199 00288 085E C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   200 00289 08DE C        	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   201 0028A 091E C        	BC                  LinkModeFlag/16,LinkModeFlag%16
   202 0028B 0B5E C        	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   203 0028C 099E C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   204 0028D 0012 C        	RET
   205 0028E      C        NormalFccLinkMode_Set: ;0x42
   206 0028E 081E C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   207 0028F 0A5E C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   208 00290 08DE C        	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   209 00291 091E C        	BC                  LinkModeFlag/16,LinkModeFlag%16
   210 00292 095E C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   211 00293 0B9E C        	BS                  FccTestModeFlag/16,FccTestModeFlag%16
   212 00294 0012 C        	RET
   213            C        
   214            C        
   215            C        
   216            C        ;***************************************************************************
   217            C        ; gamepad skip frequency RX1-RX4
   218            C        ;***************************************************************************
   219            C        	ORG                 0X400    ;PAGE 1
   220            C        ;========================================================================
   221            C        ;=========================================================================
   222            C        ;Function:  setting
   223            C        ;Input:
   224            C        ;Output:    None
   225            C        ;=========================================================================
   226 00400      C        RX1_FUNCTION:
   227 00400 0004 C        	WDTC
   228            C      M 	PAGE                5
       00401 0BC3     1     BS  3 , 7 
       00402 0983     1     BC  3 , 6 
       00403 0B43     1     BS  3 , 5 
   229 00404 122B C        	CALL                Enter_StandbyI_Mode
   230 00405 1171 C        	CALL                RESET_RF_FIFO
   231 00406 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   232            C      M 	PAGE                1
       00407 09C3     1     BC  3 , 7 
       00408 0983     1     BC  3 , 6 
       00409 0B43     1     BS  3 , 5 
   233            C        
   234 0040A      C          RX1_DETECT_LOOP:
   235 0040A 041B C        	MOV                 A,ComuClock                  ;ComuClock == 8 will continue
   236 0040B 1D07 C        	SUB                 A,@7
   237 0040C 0E03 C        	JBS                 STATUS,C
   238 0040D 1450 C        	JMP                 Rx1_Detect_Timeout           ; RX1,Timeout but have not received TX data
   239 0040E 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   240 0040F 140A C        	JMP                 RX1_DETECT_LOOP
   241 00410 0000 C        	NOP
   242            C      M 	PAGE                5
       00411 0BC3     1     BS  3 , 7 
       00412 0983     1     BC  3 , 6 
       00413 0B43     1     BS  3 , 5 
   243 00414 114C C        	CALL                READ_FIFO_RAM
   244 00415 122B C        	CALL                Enter_StandbyI_Mode	
   245            C      M 	PAGE                1
       00416 09C3     1     BC  3 , 7 
       00417 0983     1     BC  3 , 6 
       00418 0B43     1     BS  3 , 5 
   246            C        
   247            C        ;------------------- check sync imformation ---------------------
   248 00419 11DB C        	CALL                PAGE1BANK1
   249 0041A 0421 C        	MOV                 A,RX_IDH
   250 0041B 11D8 C        	CALL                PAGE1BANK0
   251 0041C 0361 C        	XOR                 RX_IDH_Buffer,A
   252 0041D 0E83 C        	JBS                 STATUS,Z
   253 0041E 145B C        	JMP                 LoseFrameStatus_RxTxID1_Error
   254 0041F 11DB C        	CALL                PAGE1BANK1
   255 00420 0422 C        	MOV                 A,RX_IDL
   256 00421 11D8 C        	CALL                PAGE1BANK0
   257 00422 0362 C        	XOR                 RX_IDL_Buffer,A
   258 00423 0E83 C        	JBS                 STATUS,Z
   259 00424 145B C        	JMP                 LoseFrameStatus_RxTxID1_Error
   260 00425 11DB C        	CALL                PAGE1BANK1
   261 00426 0427 C        	MOV                 A,TX1_ID
   262 00427 11D8 C        	CALL                PAGE1BANK0
   263 00428 0366 C        	XOR                 TX_ID_Buffer,A
   264 00429 0E83 C        	JBS                 STATUS,Z
   265 0042A 145B C        	JMP                 LoseFrameStatus_RxTxID1_Error
   266            C        
   267            C        ;---------------------------------------------------------------
   268 0042B 11D8 C        	CALL                PAGE1BANK0                       ; Save data from buffer to local
   269 0042C 0427 C        	MOV                 A,DataA_Buffer
   270 0042D 11DE C        	CALL                PAGE1BANK2
   271 0042E 0060 C        	MOV                 TX1_DATA1,A
   272            C        
   273 0042F 11D8 C        	CALL                PAGE1BANK0
   274 00430 0428 C        	MOV                 A,DataB_Buffer
   275 00431 11DE C        	CALL                PAGE1BANK2
   276 00432 0061 C        	MOV                 TX1_DATA2,A
   277            C        
   278 00433 11D8 C        	CALL                PAGE1BANK0
   279 00434 0429 C        	MOV                 A,DataC_Buffer
   280 00435 11DE C        	CALL                PAGE1BANK2
   281 00436 0062 C        	MOV                 TX1_DATA3,A
   282            C        
   283 00437 11D8 C        	CALL                PAGE1BANK0
   284 00438 042A C        	MOV                 A,DataD_Buffer
   285 00439 11DE C        	CALL                PAGE1BANK2
   286 0043A 0063 C        	MOV                 TX1_DATA4,A
   287            C        
   288 0043B 11D8 C        	CALL                PAGE1BANK0
   289 0043C 042B C        	MOV                 A,DataE_Buffer
   290 0043D 11DE C        	CALL                PAGE1BANK2
   291 0043E 0064 C        	MOV                 TX1_DATA5,A
   292            C        
   293 0043F 11D8 C        	CALL                PAGE1BANK0
   294 00440 042C C        	MOV                 A,DataF_Buffer
   295 00441 11DE C        	CALL                PAGE1BANK2
   296 00442 0065 C        	MOV                 TX1_DATA6,A
   297            C        
   298 00443 11D8 C        	CALL                PAGE1BANK0
   299 00444 042D C        	MOV                 A,DataG_Buffer
   300 00445 11DE C        	CALL                PAGE1BANK2
   301 00446 0066 C        	MOV                 TX1_DATA7,A
   302            C        
   303 00447 11DB C        	CALL                PAGE1BANK1
   304 00448 0A23 C        	BS                  CHN_FLAG,0
   305 00449 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   306 0044A 1468 C        	JMP                 EP1_REPORT_RX1
   307 0044B 0C2E C        	JBC                 CHN_FLAG_TEMP,0                           ; CHN_FLAG rising edge
   308 0044C 146F C        	JMP                 Clear_RX1_LossframeCNT
   309 0044D 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
   310 0044E 00D7 C        	CLR                 SystemTimeCNT
   311 0044F 146F C        	JMP                 Clear_RX1_LossframeCNT
   312            C        
   313            C        
   314            C        ;-------------------------------------------------------------------------
   315 00450      C          Rx1_Detect_Timeout:
   316 00450 11DB C        	CALL                PAGE1BANK1
   317 00451 0E23 C        	JBS                 CHN_FLAG,0                                ; Lossframe Status
   318 00452 146F C        	JMP                 Clear_RX1_LossframeCNT                    ; if not SearchStatus,it must be in NormalStatus
   319 00453 0438 C        	MOV                 A,RX1_LossframeCNT                        ; result = constant - variable
   320 00454 1D03 C        	SUB                 A,@3                                      ;   | result > 0   c=1  variable less than constant
   321 00455 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
   322 00456 1466 C        	JMP                 Increase_RX1_LossframeCNT
   323 00457 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   324 00458 146F C        	JMP                 Clear_RX1_LossframeCNT
   325 00459 0823 C        	BC                  CHN_FLAG,0
   326 0045A 146F C        	JMP                 Clear_RX1_LossframeCNT
   327            C        ;-----------------------------------------------------------------------------
   328 0045B      C          LoseFrameStatus_RxTxID1_Error:
   329 0045B 11DB C        	CALL                PAGE1BANK1
   330 0045C 0E23 C        	JBS                 CHN_FLAG,0
   331 0045D 146F C        	JMP                 Clear_RX1_LossframeCNT
   332 0045E 0438 C        	MOV                 A,RX1_LossframeCNT                                   ; 5 times lossframe
   333 0045F 1D05 C        	SUB                 A,@5
   334 00460 0C03 C        	JBC                 STATUS,C
   335 00461 1466 C        	JMP                 Increase_RX1_LossframeCNT
   336 00462 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   337 00463 146F C        	JMP                 Clear_RX1_LossframeCNT
   338 00464 0823 C        	BC                  CHN_FLAG,0
   339 00465 146F C        	JMP                 Clear_RX1_LossframeCNT
   340            C        
   341            C        ;--------------------------------------------------------------------------------
   342 00466      C          Increase_RX1_LossframeCNT:
   343 00466 0578 C        	INC                 RX1_LossframeCNT
   344 00467 1470 C        	JMP                 RX1_Over_Judge
   345 00468      C          EP1_REPORT_RX1:
   346            C      M 	PAGE                4
       00468 0BC3     1     BS  3 , 7 
       00469 0983     1     BC  3 , 6 
       0046A 0943     1     BC  3 , 5 
   347 0046B 1314 C        	CALL                EP1_Report_1st
   348            C      M 	PAGE                1
       0046C 09C3     1     BC  3 , 7 
       0046D 0983     1     BC  3 , 6 
       0046E 0B43     1     BS  3 , 5 
   349 0046F      C          Clear_RX1_LossframeCNT:
   350 0046F 00F8 C        	CLR                 RX1_LossframeCNT
   351 00470      C          RX1_Over_Judge:
   352 00470 041B C        	MOV                 A,ComuClock                  ; ComuClock == 8 will continue
   353 00471 1D07 C        	SUB                 A,@7
   354 00472 0C03 C        	JBC                 STATUS,C
   355 00473 1470 C        	JMP                 $-3
   356 00474 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
   357 00475 0000 C        	NOP
   358 00476 0012 C        	RET
   359            C        
   360            C        
   361            C        
   362            C        
   363            C        ;========================================================================
   364            C        ;=========================================================================
   365            C        ;Function:  setting
   366            C        ;Input:     LossFrameCNTCNT,LossFreqCNT,DataBaseAddress
   367            C        ;Output:    None
   368            C        ;=========================================================================
   369 00477      C        RX2_FUNCTION:
   370 00477 0004 C        	WDTC
   371            C      M 	PAGE                5
       00478 0BC3     1     BS  3 , 7 
       00479 0983     1     BC  3 , 6 
       0047A 0B43     1     BS  3 , 5 
   372            C        	;CALL                Enter_StandbyI_Mode
   373 0047B 1171 C        	CALL                RESET_RF_FIFO
   374 0047C 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   375            C      M 	PAGE                1
       0047D 09C3     1     BC  3 , 7 
       0047E 0983     1     BC  3 , 6 
       0047F 0B43     1     BS  3 , 5 
   376            C        
   377 00480      C          RX2_DETECT_LOOP:
   378 00480 041B C        	MOV                 A,ComuClock                  ;ComuClock == 16 will continue
   379 00481 1D0F C        	SUB                 A,@15
   380 00482 0E03 C        	JBS                 STATUS,C
   381 00483 14C7 C        	JMP                 RX2_Detect_Timeout           ; RX2,Timeout but have not received TX data
   382 00484 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   383 00485 1480 C        	JMP                 RX2_DETECT_LOOP
   384 00486 0000 C        	NOP
   385            C      M 	PAGE                5
       00487 0BC3     1     BS  3 , 7 
       00488 0983     1     BC  3 , 6 
       00489 0B43     1     BS  3 , 5 
   386 0048A 114C C        	CALL                READ_FIFO_RAM
   387 0048B 122B C        	CALL                Enter_StandbyI_Mode	
   388            C      M 	PAGE                1
       0048C 09C3     1     BC  3 , 7 
       0048D 0983     1     BC  3 , 6 
       0048E 0B43     1     BS  3 , 5 
   389 0048F 0000 C        	NOP
   390            C        
   391            C        ;------------------- check sync imformation ---------------------
   392 00490 11DB C        	CALL                PAGE1BANK1
   393 00491 0421 C        	MOV                 A,RX_IDH
   394 00492 11D8 C        	CALL                PAGE1BANK0
   395 00493 0361 C        	XOR                 RX_IDH_Buffer,A
   396 00494 0E83 C        	JBS                 STATUS,Z
   397 00495 14D2 C        	JMP                 LoseFrameStatus_RxTxID2_Error
   398 00496 11DB C        	CALL                PAGE1BANK1
   399 00497 0422 C        	MOV                 A,RX_IDL
   400 00498 11D8 C        	CALL                PAGE1BANK0
   401 00499 0362 C        	XOR                 RX_IDL_Buffer,A
   402 0049A 0E83 C        	JBS                 STATUS,Z
   403 0049B 14D2 C        	JMP                 LoseFrameStatus_RxTxID2_Error
   404 0049C 11DB C        	CALL                PAGE1BANK1
   405 0049D 0428 C        	MOV                 A,TX2_ID
   406 0049E 11D8 C        	CALL                PAGE1BANK0
   407 0049F 0366 C        	XOR                 TX_ID_Buffer,A
   408 004A0 0E83 C        	JBS                 STATUS,Z
   409 004A1 14D2 C        	JMP                 LoseFrameStatus_RxTxID2_Error
   410            C        
   411            C        ;---------------------------------------------------------------
   412 004A2 11D8 C        	CALL                PAGE1BANK0                       ; Save data from buffer to local
   413 004A3 0427 C        	MOV                 A,DataA_Buffer
   414 004A4 11DE C        	CALL                PAGE1BANK2
   415 004A5 0068 C        	MOV                 TX2_DATA1,A
   416            C        
   417 004A6 11D8 C        	CALL                PAGE1BANK0
   418 004A7 0428 C        	MOV                 A,DataB_Buffer
   419 004A8 11DE C        	CALL                PAGE1BANK2
   420 004A9 0069 C        	MOV                 TX2_DATA2,A
   421            C        
   422 004AA 11D8 C        	CALL                PAGE1BANK0
   423 004AB 0429 C        	MOV                 A,DataC_Buffer
   424 004AC 11DE C        	CALL                PAGE1BANK2
   425 004AD 006A C        	MOV                 TX2_DATA3,A
   426            C        
   427 004AE 11D8 C        	CALL                PAGE1BANK0
   428 004AF 042A C        	MOV                 A,DataD_Buffer
   429 004B0 11DE C        	CALL                PAGE1BANK2
   430 004B1 006B C        	MOV                 TX2_DATA4,A
   431            C        
   432 004B2 11D8 C        	CALL                PAGE1BANK0
   433 004B3 042B C        	MOV                 A,DataE_Buffer
   434 004B4 11DE C        	CALL                PAGE1BANK2
   435 004B5 006C C        	MOV                 TX2_DATA5,A
   436            C        
   437 004B6 11D8 C        	CALL                PAGE1BANK0
   438 004B7 042C C        	MOV                 A,DataF_Buffer
   439 004B8 11DE C        	CALL                PAGE1BANK2
   440 004B9 006D C        	MOV                 TX2_DATA6,A
   441            C        
   442 004BA 11D8 C        	CALL                PAGE1BANK0
   443 004BB 042D C        	MOV                 A,DataG_Buffer
   444 004BC 11DE C        	CALL                PAGE1BANK2
   445 004BD 006E C        	MOV                 TX2_DATA7,A
   446            C        
   447 004BE 11DB C        	CALL                PAGE1BANK1
   448 004BF 0A63 C        	BS                  CHN_FLAG,1
   449 004C0 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   450 004C1 14DF C        	JMP                 EP1_REPORT_RX2
   451 004C2 0C6E C        	JBC                 CHN_FLAG_TEMP,1                           ; CHN_FLAG rising edge
   452 004C3 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   453 004C4 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
   454 004C5 00D7 C        	CLR                 SystemTimeCNT
   455 004C6 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   456            C        
   457            C        ;-------------------------------------------------------------------------
   458 004C7      C          RX2_Detect_Timeout:
   459 004C7 11DB C        	CALL                PAGE1BANK1
   460 004C8 0E63 C        	JBS                 CHN_FLAG,1                                ;Lossframe Status
   461 004C9 14E6 C        	JMP                 Clear_RX2_LossframeCNT                    ;if not SearchStatus,it must be in NormalStatus
   462 004CA 0439 C        	MOV                 A,RX2_LossframeCNT                        ; result = constant - variable
   463 004CB 1D03 C        	SUB                 A,@3                                      ;   | result > 0   c=1  variable less than constant
   464 004CC 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
   465 004CD 14DD C        	JMP                 Increase_RX2_LossframeCNT
   466 004CE 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   467 004CF 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   468 004D0 0863 C        	BC                  CHN_FLAG,1
   469 004D1 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   470            C        ;-----------------------------------------------------------------------------
   471 004D2      C          LoseFrameStatus_RxTxID2_Error:
   472 004D2 11DB C        	CALL                PAGE1BANK1
   473 004D3 0E63 C        	JBS                 CHN_FLAG,1
   474 004D4 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   475 004D5 0439 C        	MOV                 A,RX2_LossframeCNT                                   ; 5 times lossframe
   476 004D6 1D05 C        	SUB                 A,@5
   477 004D7 0C03 C        	JBC                 STATUS,C
   478 004D8 14DD C        	JMP                 Increase_RX2_LossframeCNT
   479 004D9 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   480 004DA 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   481 004DB 0863 C        	BC                  CHN_FLAG,1
   482 004DC 14E6 C        	JMP                 Clear_RX2_LossframeCNT
   483            C        
   484            C        ;--------------------------------------------------------------------------------
   485 004DD      C          Increase_RX2_LossframeCNT:
   486 004DD 0579 C        	INC                 RX2_LossframeCNT
   487 004DE 14E7 C        	JMP                 RX2_Over_Judge
   488 004DF      C          EP1_REPORT_RX2:
   489            C      M 	PAGE                4
       004DF 0BC3     1     BS  3 , 7 
       004E0 0983     1     BC  3 , 6 
       004E1 0943     1     BC  3 , 5 
   490 004E2 132F C        	CALL                EP1_Report_2nd
   491            C      M 	PAGE                1
       004E3 09C3     1     BC  3 , 7 
       004E4 0983     1     BC  3 , 6 
       004E5 0B43     1     BS  3 , 5 
   492 004E6      C          Clear_RX2_LossframeCNT:
   493 004E6 00F9 C        	CLR                 RX2_LossframeCNT
   494 004E7      C          RX2_Over_Judge:
   495 004E7 041B C        	MOV                 A,ComuClock       ;ComuClock == 16 will continue
   496 004E8 1D0F C        	SUB                 A,@15
   497 004E9 0C03 C        	JBC                 STATUS,C
   498 004EA 14E7 C        	JMP                 $-3
   499 004EB 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
   500 004EC 0000 C        	NOP
   501 004ED 0012 C        	RET
   502            C        
   503            C        
   504            C        
   505            C        ;========================================================================
   506            C        ;=========================================================================
   507            C        ;Function:  setting
   508            C        ;Input:     LossFrameCNTCNT,LossFreqCNT,DataBaseAddress
   509            C        ;Output:    None
   510            C        ;=========================================================================
   511 004EE      C        RX3_FUNCTION:
   512            C      M 	PAGE                5
       004EE 0BC3     1     BS  3 , 7 
       004EF 0983     1     BC  3 , 6 
       004F0 0B43     1     BS  3 , 5 
   513            C        	;CALL                Enter_StandbyI_Mode
   514 004F1 1171 C        	CALL                RESET_RF_FIFO
   515 004F2 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   516            C      M 	PAGE                1
       004F3 09C3     1     BC  3 , 7 
       004F4 0983     1     BC  3 , 6 
       004F5 0B43     1     BS  3 , 5 
   517            C        
   518 004F6      C          RX3_DETECT_LOOP:
   519 004F6 041B C        	MOV                 A,ComuClock                  ;ComuClock == 24 will continue
   520 004F7 1D17 C        	SUB                 A,@23
   521 004F8 0E03 C        	JBS                 STATUS,C
   522 004F9 153C C        	JMP                 RX3_Detect_Timeout           ; RX3,Timeout but have not received TX data
   523 004FA 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   524 004FB 14F6 C        	JMP                 RX3_DETECT_LOOP
   525 004FC 0000 C        	NOP
   526            C      M 	PAGE                5
       004FD 0BC3     1     BS  3 , 7 
       004FE 0983     1     BC  3 , 6 
       004FF 0B43     1     BS  3 , 5 
   527 00500 114C C        	CALL                READ_FIFO_RAM
   528 00501 122B C        	CALL                Enter_StandbyI_Mode	
   529            C      M 	PAGE                1
       00502 09C3     1     BC  3 , 7 
       00503 0983     1     BC  3 , 6 
       00504 0B43     1     BS  3 , 5 
   530            C        
   531            C        ;------------------- check sync imformation ---------------------
   532 00505 11DB C        	CALL                PAGE1BANK1
   533 00506 0421 C        	MOV                 A,RX_IDH
   534 00507 11D8 C        	CALL                PAGE1BANK0
   535 00508 0361 C        	XOR                 RX_IDH_Buffer,A
   536 00509 0E83 C        	JBS                 STATUS,Z
   537 0050A 1547 C        	JMP                 LoseFrameStatus_RxTxID3_Error
   538 0050B 11DB C        	CALL                PAGE1BANK1
   539 0050C 0422 C        	MOV                 A,RX_IDL
   540 0050D 11D8 C        	CALL                PAGE1BANK0
   541 0050E 0362 C        	XOR                 RX_IDL_Buffer,A
   542 0050F 0E83 C        	JBS                 STATUS,Z
   543 00510 1547 C        	JMP                 LoseFrameStatus_RxTxID3_Error
   544 00511 11DB C        	CALL                PAGE1BANK1
   545 00512 0429 C        	MOV                 A,TX3_ID
   546 00513 11D8 C        	CALL                PAGE1BANK0
   547 00514 0366 C        	XOR                 TX_ID_Buffer,A
   548 00515 0E83 C        	JBS                 STATUS,Z
   549 00516 1547 C        	JMP                 LoseFrameStatus_RxTxID3_Error
   550            C        
   551            C        ;---------------------------------------------------------------
   552 00517 11D8 C        	CALL                PAGE1BANK0                       ; Save data from buffer to local
   553 00518 0427 C        	MOV                 A,DataA_Buffer
   554 00519 11DE C        	CALL                PAGE1BANK2
   555 0051A 0070 C        	MOV                 TX3_DATA1,A
   556            C        
   557 0051B 11D8 C        	CALL                PAGE1BANK0
   558 0051C 0428 C        	MOV                 A,DataB_Buffer
   559 0051D 11DE C        	CALL                PAGE1BANK2
   560 0051E 0071 C        	MOV                 TX3_DATA2,A
   561            C        
   562 0051F 11D8 C        	CALL                PAGE1BANK0
   563 00520 0429 C        	MOV                 A,DataC_Buffer
   564 00521 11DE C        	CALL                PAGE1BANK2
   565 00522 0072 C        	MOV                 TX3_DATA3,A
   566            C        
   567 00523 11D8 C        	CALL                PAGE1BANK0
   568 00524 042A C        	MOV                 A,DataD_Buffer
   569 00525 11DE C        	CALL                PAGE1BANK2
   570 00526 0073 C        	MOV                 TX3_DATA4,A
   571            C        
   572 00527 11D8 C        	CALL                PAGE1BANK0
   573 00528 042B C        	MOV                 A,DataE_Buffer
   574 00529 11DE C        	CALL                PAGE1BANK2
   575 0052A 0074 C        	MOV                 TX3_DATA5,A
   576            C        
   577 0052B 11D8 C        	CALL                PAGE1BANK0
   578 0052C 042C C        	MOV                 A,DataF_Buffer
   579 0052D 11DE C        	CALL                PAGE1BANK2
   580 0052E 0075 C        	MOV                 TX3_DATA6,A
   581            C        
   582 0052F 11D8 C        	CALL                PAGE1BANK0
   583 00530 042D C        	MOV                 A,DataG_Buffer
   584 00531 11DE C        	CALL                PAGE1BANK2
   585 00532 0076 C        	MOV                 TX3_DATA7,A
   586            C        
   587 00533 11DB C        	CALL                PAGE1BANK1
   588 00534 0AA3 C        	BS                  CHN_FLAG,2
   589 00535 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   590 00536 1554 C        	JMP                 EP1_REPORT_RX3
   591 00537 0CAE C        	JBC                 CHN_FLAG_TEMP,2                           ; CHN_FLAG rising edge
   592 00538 155B C        	JMP                 Clear_RX3_LossframeCNT
   593 00539 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
   594 0053A 00D7 C        	CLR                 SystemTimeCNT
   595 0053B 155B C        	JMP                 Clear_RX3_LossframeCNT
   596            C        
   597            C        ;-------------------------------------------------------------------------
   598 0053C      C          RX3_Detect_Timeout:
   599 0053C 11DB C        	CALL                PAGE1BANK1
   600 0053D 0EA3 C        	JBS                 CHN_FLAG,2                                ;Lossframe Status
   601 0053E 155B C        	JMP                 Clear_RX3_LossframeCNT                    ;if not SearchStatus,it must be in NormalStatus
   602 0053F 043A C        	MOV                 A,RX3_LossframeCNT                        ; result = constant - variable
   603 00540 1D03 C        	SUB                 A,@3                                      ;   | result > 0   c=1  variable less than constant
   604 00541 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
   605 00542 1552 C        	JMP                 Increase_RX3_LossframeCNT
   606 00543 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   607 00544 155B C        	JMP                 Clear_RX3_LossframeCNT
   608 00545 08A3 C        	BC                  CHN_FLAG,2
   609 00546 155B C        	JMP                 Clear_RX3_LossframeCNT
   610            C        ;-----------------------------------------------------------------------------
   611 00547      C          LoseFrameStatus_RxTxID3_Error:
   612 00547 11DB C        	CALL                PAGE1BANK1
   613 00548 0EA3 C        	JBS                 CHN_FLAG,2
   614 00549 155B C        	JMP                 Clear_RX3_LossframeCNT
   615 0054A 043A C        	MOV                 A,RX3_LossframeCNT                                   ; 5 times lossframe
   616 0054B 1D05 C        	SUB                 A,@5
   617 0054C 0C03 C        	JBC                 STATUS,C
   618 0054D 1552 C        	JMP                 Increase_RX3_LossframeCNT
   619 0054E 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   620 0054F 155B C        	JMP                 Clear_RX3_LossframeCNT
   621 00550 08A3 C        	BC                  CHN_FLAG,2
   622 00551 155B C        	JMP                 Clear_RX3_LossframeCNT
   623            C        
   624            C        ;--------------------------------------------------------------------------------
   625 00552      C          Increase_RX3_LossframeCNT:
   626 00552 057A C        	INC                 RX3_LossframeCNT
   627 00553 155C C        	JMP                 RX3_Over_Judge
   628 00554      C          EP1_REPORT_RX3:
   629            C      M 	PAGE                4
       00554 0BC3     1     BS  3 , 7 
       00555 0983     1     BC  3 , 6 
       00556 0943     1     BC  3 , 5 
   630 00557 134B C        	CALL                EP1_Report_3rd
   631            C      M 	PAGE                1
       00558 09C3     1     BC  3 , 7 
       00559 0983     1     BC  3 , 6 
       0055A 0B43     1     BS  3 , 5 
   632 0055B      C          Clear_RX3_LossframeCNT:
   633 0055B 00FA C        	CLR                 RX3_LossframeCNT
   634 0055C      C          RX3_Over_Judge:
   635 0055C 041B C        	MOV                 A,ComuClock       ;ComuClock == 24 will continue
   636 0055D 1D17 C        	SUB                 A,@23
   637 0055E 0C03 C        	JBC                 STATUS,C
   638 0055F 155C C        	JMP                 $-3
   639 00560 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
   640 00561 0000 C        	NOP
   641 00562 0012 C        	RET
   642            C        
   643            C        
   644            C        ;========================================================================
   645            C        ;=========================================================================
   646            C        ;Function:  setting
   647            C        ;Input:     LossFrameCNTCNT,LossFreqCNT,DataBaseAddress
   648            C        ;Output:    None
   649            C        ;=========================================================================
   650 00563      C        RX4_FUNCTION:
   651            C      M 	PAGE                5
       00563 0BC3     1     BS  3 , 7 
       00564 0983     1     BC  3 , 6 
       00565 0B43     1     BS  3 , 5 
   652            C        	;CALL                Enter_StandbyI_Mode
   653 00566 1171 C        	CALL                RESET_RF_FIFO
   654 00567 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   655            C      M 	PAGE                1
       00568 09C3     1     BC  3 , 7 
       00569 0983     1     BC  3 , 6 
       0056A 0B43     1     BS  3 , 5 
   656            C        
   657 0056B      C          RX4_DETECT_LOOP:
   658 0056B 041B C        	MOV                 A,ComuClock                  ;ComuClock == 32 will continue
   659 0056C 1D1F C        	SUB                 A,@31
   660 0056D 0E03 C        	JBS                 STATUS,C
   661 0056E 15B1 C        	JMP                 RX4_Detect_Timeout           ; RX4,Timeout but have not received TX data
   662 0056F 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   663 00570 156B C        	JMP                 RX4_DETECT_LOOP
   664 00571 0000 C        	NOP
   665            C      M 	PAGE                5
       00572 0BC3     1     BS  3 , 7 
       00573 0983     1     BC  3 , 6 
       00574 0B43     1     BS  3 , 5 
   666 00575 114C C        	CALL                READ_FIFO_RAM
   667 00576 122B C        	CALL                Enter_StandbyI_Mode	
   668            C      M 	PAGE                1
       00577 09C3     1     BC  3 , 7 
       00578 0983     1     BC  3 , 6 
       00579 0B43     1     BS  3 , 5 
   669            C        
   670            C        ;------------------- check sync imformation ---------------------
   671 0057A 11DB C        	CALL                PAGE1BANK1
   672 0057B 0421 C        	MOV                 A,RX_IDH
   673 0057C 11D8 C        	CALL                PAGE1BANK0
   674 0057D 0361 C        	XOR                 RX_IDH_Buffer,A
   675 0057E 0E83 C        	JBS                 STATUS,Z
   676 0057F 15BC C        	JMP                 LoseFrameStatus_RxTxID4_Error
   677 00580 11DB C        	CALL                PAGE1BANK1
   678 00581 0422 C        	MOV                 A,RX_IDL
   679 00582 11D8 C        	CALL                PAGE1BANK0
   680 00583 0362 C        	XOR                 RX_IDL_Buffer,A
   681 00584 0E83 C        	JBS                 STATUS,Z
   682 00585 15BC C        	JMP                 LoseFrameStatus_RxTxID4_Error
   683 00586 11DB C        	CALL                PAGE1BANK1
   684 00587 042A C        	MOV                 A,TX4_ID
   685 00588 11D8 C        	CALL                PAGE1BANK0
   686 00589 0366 C        	XOR                 TX_ID_Buffer,A
   687 0058A 0E83 C        	JBS                 STATUS,Z
   688 0058B 15BC C        	JMP                 LoseFrameStatus_RxTxID4_Error
   689            C        
   690            C        ;---------------------------------------------------------------
   691 0058C 11D8 C        	CALL                PAGE1BANK0                       ; Save data from buffer to local
   692 0058D 0427 C        	MOV                 A,DataA_Buffer
   693 0058E 11DE C        	CALL                PAGE1BANK2
   694 0058F 0078 C        	MOV                 TX4_DATA1,A
   695            C        
   696 00590 11D8 C        	CALL                PAGE1BANK0
   697 00591 0428 C        	MOV                 A,DataB_Buffer
   698 00592 11DE C        	CALL                PAGE1BANK2
   699 00593 0079 C        	MOV                 TX4_DATA2,A
   700            C        
   701 00594 11D8 C        	CALL                PAGE1BANK0
   702 00595 0429 C        	MOV                 A,DataC_Buffer
   703 00596 11DE C        	CALL                PAGE1BANK2
   704 00597 007A C        	MOV                 TX4_DATA3,A
   705            C        
   706 00598 11D8 C        	CALL                PAGE1BANK0
   707 00599 042A C        	MOV                 A,DataD_Buffer
   708 0059A 11DE C        	CALL                PAGE1BANK2
   709 0059B 007B C        	MOV                 TX4_DATA4,A
   710            C        
   711 0059C 11D8 C        	CALL                PAGE1BANK0
   712 0059D 042B C        	MOV                 A,DataE_Buffer
   713 0059E 11DE C        	CALL                PAGE1BANK2
   714 0059F 007C C        	MOV                 TX4_DATA5,A
   715            C        
   716 005A0 11D8 C        	CALL                PAGE1BANK0
   717 005A1 042C C        	MOV                 A,DataF_Buffer
   718 005A2 11DE C        	CALL                PAGE1BANK2
   719 005A3 007D C        	MOV                 TX4_DATA6,A
   720            C        
   721 005A4 11D8 C        	CALL                PAGE1BANK0
   722 005A5 042D C        	MOV                 A,DataG_Buffer
   723 005A6 11DE C        	CALL                PAGE1BANK2
   724 005A7 007E C        	MOV                 TX4_DATA7,A
   725            C        
   726 005A8 11DB C        	CALL                PAGE1BANK1
   727 005A9 0AE3 C        	BS                  CHN_FLAG,3
   728 005AA 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   729 005AB 15C9 C        	JMP                 EP1_REPORT_RX4
   730 005AC 0CEE C        	JBC                 CHN_FLAG_TEMP,3                           ; CHN_FLAG rising edge
   731 005AD 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   732 005AE 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
   733 005AF 00D7 C        	CLR                 SystemTimeCNT
   734 005B0 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   735            C        
   736            C        ;-------------------------------------------------------------------------
   737 005B1      C          RX4_Detect_Timeout:
   738 005B1 11DB C        	CALL                PAGE1BANK1
   739 005B2 0EE3 C        	JBS                 CHN_FLAG,3                                ;Lossframe Status
   740 005B3 15D0 C        	JMP                 Clear_RX4_LossframeCNT                    ;if not SearchStatus,it must be in NormalStatus
   741 005B4 043B C        	MOV                 A,RX4_LossframeCNT                        ; result = constant - variable
   742 005B5 1D03 C        	SUB                 A,@3                                      ;   | result > 0   c=1  variable less than constant
   743 005B6 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
   744 005B7 15C7 C        	JMP                 Increase_RX4_LossframeCNT
   745 005B8 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   746 005B9 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   747 005BA 08E3 C        	BC                  CHN_FLAG,3
   748 005BB 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   749            C        ;-----------------------------------------------------------------------------
   750 005BC      C          LoseFrameStatus_RxTxID4_Error:
   751 005BC 11DB C        	CALL                PAGE1BANK1
   752 005BD 0EE3 C        	JBS                 CHN_FLAG,3
   753 005BE 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   754 005BF 043B C        	MOV                 A,RX4_LossframeCNT                                   ; 5 times lossframe
   755 005C0 1D05 C        	SUB                 A,@5
   756 005C1 0C03 C        	JBC                 STATUS,C
   757 005C2 15C7 C        	JMP                 Increase_RX4_LossframeCNT
   758 005C3 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   759 005C4 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   760 005C5 08E3 C        	BC                  CHN_FLAG,3
   761 005C6 15D0 C        	JMP                 Clear_RX4_LossframeCNT
   762            C        
   763            C        ;--------------------------------------------------------------------------------
   764 005C7      C          Increase_RX4_LossframeCNT:
   765 005C7 057B C        	INC                 RX4_LossframeCNT
   766 005C8 15D1 C        	JMP                 RX4_Over_Judge
   767 005C9      C          EP1_REPORT_RX4:
   768            C      M 	PAGE                4
       005C9 0BC3     1     BS  3 , 7 
       005CA 0983     1     BC  3 , 6 
       005CB 0943     1     BC  3 , 5 
   769 005CC 1366 C        	CALL                EP1_Report_4th
   770            C      M 	PAGE                1
       005CD 09C3     1     BC  3 , 7 
       005CE 0983     1     BC  3 , 6 
       005CF 0B43     1     BS  3 , 5 
   771 005D0      C          Clear_RX4_LossframeCNT:
   772 005D0 00FB C        	CLR                 RX4_LossframeCNT
   773 005D1      C          RX4_Over_Judge:
   774 005D1 041B C        	MOV                 A,ComuClock       ;ComuClock == 32 will continue
   775 005D2 1D1F C        	SUB                 A,@31
   776 005D3 0C03 C        	JBC                 STATUS,C
   777 005D4 15D1 C        	JMP                 $-3
   778 005D5 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
   779 005D6 0000 C        	NOP
   780 005D7 0012 C        	RET
   781            C        
   782            C        ;=====================================================================
   783            C        ; BANK exchange function
   784            C        ;=====================================================================
   785 005D8      C        	PAGE1BANK0:
   786 005D8 09C4 C        		BC              0X04,7
   787 005D9 0984 C        		BC              0X04,6
   788 005DA 0012 C        	RET
   789 005DB      C        	PAGE1BANK1:
   790 005DB 09C4 C        		BC              0X04,7
   791 005DC 0B84 C        		BS              0X04,6
   792 005DD 0012 C        	RET
   793 005DE      C        	PAGE1BANK2:
   794 005DE 0BC4 C        		BS              0X04,7
   795 005DF 0984 C        		BC              0X04,6
   796 005E0 0012 C        	RET
   797 005E1      C        	PAGE1BANK3:
   798 005E1 0BC4 C        		BS              0X04,7
   799 005E2 0B84 C        		BS              0X04,6
   800 005E3 0012 C        	RET
   801            C        
   802            C        
   803            C        
   804            C        ;***************************************************************************
   805            C        ; gamepad skip frequency RX5-RX8
   806            C        ;***************************************************************************
   807            C        	ORG                 0X800   ;PAGE 2
   808            C        ;========================================================================
   809            C        ;=========================================================================
   810            C        ;Function:  setting
   811            C        ;Input:     LossFrameCNTCNT,LossFreqCNT,DataBaseAddress
   812            C        ;Output:    None
   813            C        ;=========================================================================
   814 00800      C        RX5_FUNCTION:
   815            C      M 	PAGE                5
       00800 0BC3     1     BS  3 , 7 
       00801 0983     1     BC  3 , 6 
       00802 0B43     1     BS  3 , 5 
   816            C        	;CALL                Enter_StandbyI_Mode
   817 00803 1171 C        	CALL                RESET_RF_FIFO
   818 00804 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   819            C      M 	PAGE                2
       00805 09C3     1     BC  3 , 7 
       00806 0B83     1     BS  3 , 6 
       00807 0943     1     BC  3 , 5 
   820            C        
   821 00808      C          RX5_DETECT_LOOP:
   822 00808 041B C        	MOV                 A,ComuClock                  ;ComuClock == 40 will continue
   823 00809 1D27 C        	SUB                 A,@39
   824 0080A 0E03 C        	JBS                 STATUS,C
   825 0080B 144F C        	JMP                 RX5_Detect_Timeout           ; RX5,Timeout but have not received TX data
   826 0080C 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   827 0080D 1408 C        	JMP                 RX5_DETECT_LOOP
   828 0080E 0000 C        	NOP
   829            C      M 	PAGE                5
       0080F 0BC3     1     BS  3 , 7 
       00810 0983     1     BC  3 , 6 
       00811 0B43     1     BS  3 , 5 
   830 00812 114C C        	CALL                READ_FIFO_RAM
   831 00813 122B C        	CALL                Enter_StandbyI_Mode	
   832            C      M 	PAGE                2
       00814 09C3     1     BC  3 , 7 
       00815 0B83     1     BS  3 , 6 
       00816 0943     1     BC  3 , 5 
   833 00817 0000 C        	NOP
   834            C        
   835            C        ;------------------- check sync imformation ---------------------
   836 00818 10EF C        	CALL                PAGE2BANK1
   837 00819 0421 C        	MOV                 A,RX_IDH
   838 0081A 10EC C        	CALL                PAGE2BANK0
   839 0081B 0361 C        	XOR                 RX_IDH_Buffer,A
   840 0081C 0E83 C        	JBS                 STATUS,Z
   841 0081D 145A C        	JMP                 LoseFrameStatus_RxTxID5_Error
   842 0081E 10EF C        	CALL                PAGE2BANK1
   843 0081F 0422 C        	MOV                 A,RX_IDL
   844 00820 10EC C        	CALL                PAGE2BANK0
   845 00821 0362 C        	XOR                 RX_IDL_Buffer,A
   846 00822 0E83 C        	JBS                 STATUS,Z
   847 00823 145A C        	JMP                 LoseFrameStatus_RxTxID5_Error
   848 00824 10EF C        	CALL                PAGE2BANK1
   849 00825 042B C        	MOV                 A,TX5_ID
   850 00826 10EC C        	CALL                PAGE2BANK0
   851 00827 0366 C        	XOR                 TX_ID_Buffer,A
   852 00828 0E83 C        	JBS                 STATUS,Z
   853 00829 145A C        	JMP                 LoseFrameStatus_RxTxID5_Error
   854            C        
   855            C        ;---------------------------------------------------------------
   856 0082A 10EC C        	CALL                PAGE2BANK0                       ; Save data from buffer to local
   857 0082B 0427 C        	MOV                 A,DataA_Buffer
   858 0082C 10F5 C        	CALL                PAGE2BANK3
   859 0082D 0060 C        	MOV                 TX5_DATA1,A
   860            C        
   861 0082E 10EC C        	CALL                PAGE2BANK0
   862 0082F 0428 C        	MOV                 A,DataB_Buffer
   863 00830 10F5 C        	CALL                PAGE2BANK3
   864 00831 0061 C        	MOV                 TX5_DATA2,A
   865            C        
   866 00832 10EC C        	CALL                PAGE2BANK0
   867 00833 0429 C        	MOV                 A,DataC_Buffer
   868 00834 10F5 C        	CALL                PAGE2BANK3
   869 00835 0062 C        	MOV                 TX5_DATA3,A
   870            C        
   871 00836 10EC C        	CALL                PAGE2BANK0
   872 00837 042A C        	MOV                 A,DataD_Buffer
   873 00838 10F5 C        	CALL                PAGE2BANK3
   874 00839 0063 C        	MOV                 TX5_DATA4,A
   875            C        
   876 0083A 10EC C        	CALL                PAGE2BANK0
   877 0083B 042B C        	MOV                 A,DataE_Buffer
   878 0083C 10F5 C        	CALL                PAGE2BANK3
   879 0083D 0064 C        	MOV                 TX5_DATA5,A
   880            C        
   881 0083E 10EC C        	CALL                PAGE2BANK0
   882 0083F 042C C        	MOV                 A,DataF_Buffer
   883 00840 10F5 C        	CALL                PAGE2BANK3
   884 00841 0065 C        	MOV                 TX5_DATA6,A
   885            C        
   886 00842 10EC C        	CALL                PAGE2BANK0
   887 00843 042D C        	MOV                 A,DataG_Buffer
   888 00844 10F5 C        	CALL                PAGE2BANK3
   889 00845 0066 C        	MOV                 TX5_DATA7,A
   890            C        
   891 00846 10EF C        	CALL                PAGE2BANK1
   892 00847 0B23 C        	BS                  CHN_FLAG,4
   893 00848 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   894 00849 1467 C        	JMP                 EP1_REPORT_RX5
   895 0084A 0D2E C        	JBC                 CHN_FLAG_TEMP,4                           ; CHN_FLAG rising edge
   896 0084B 146E C        	JMP                 Clear_RX5_LossframeCNT
   897 0084C 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
   898 0084D 00D7 C        	CLR                 SystemTimeCNT
   899 0084E 146E C        	JMP                 Clear_RX5_LossframeCNT
   900            C        
   901            C        ;-------------------------------------------------------------------------
   902 0084F      C          RX5_Detect_Timeout:
   903 0084F 10EF C        	CALL                PAGE2BANK1
   904 00850 0F23 C        	JBS                 CHN_FLAG,4                                ;Lossframe Status
   905 00851 146E C        	JMP                 Clear_RX5_LossframeCNT                    ;if not SearchStatus,it must be in NormalStatus
   906 00852 043C C        	MOV                 A,RX5_LossframeCNT                        ; result = constant - variable
   907 00853 1D03 C        	SUB                 A,@3                                      ;   | result > 0   c=1  variable less than constant
   908 00854 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
   909 00855 1465 C        	JMP                 Increase_RX5_LossframeCNT
   910 00856 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   911 00857 146E C        	JMP                 Clear_RX5_LossframeCNT
   912 00858 0923 C        	BC                  CHN_FLAG,4
   913 00859 146E C        	JMP                 Clear_RX5_LossframeCNT
   914            C        ;-----------------------------------------------------------------------------
   915 0085A      C          LoseFrameStatus_RxTxID5_Error:
   916 0085A 10EF C        	CALL                PAGE2BANK1
   917 0085B 0F23 C        	JBS                 CHN_FLAG,4
   918 0085C 146E C        	JMP                 Clear_RX5_LossframeCNT
   919 0085D 043C C        	MOV                 A,RX5_LossframeCNT                                   ; 5 times lossframe
   920 0085E 1D05 C        	SUB                 A,@5
   921 0085F 0C03 C        	JBC                 STATUS,C
   922 00860 1465 C        	JMP                 Increase_RX5_LossframeCNT
   923 00861 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   924 00862 146E C        	JMP                 Clear_RX5_LossframeCNT
   925 00863 0923 C        	BC                  CHN_FLAG,4
   926 00864 146E C        	JMP                 Clear_RX5_LossframeCNT
   927            C        
   928            C        ;--------------------------------------------------------------------------------
   929 00865      C          Increase_RX5_LossframeCNT:
   930 00865 057C C        	INC                 RX5_LossframeCNT
   931 00866 146F C        	JMP                 RX5_Over_Judge
   932 00867      C          EP1_REPORT_RX5:
   933            C      M 	PAGE                4
       00867 0BC3     1     BS  3 , 7 
       00868 0983     1     BC  3 , 6 
       00869 0943     1     BC  3 , 5 
   934 0086A 1381 C        	CALL                EP1_Report_5th
   935            C      M 	PAGE                2
       0086B 09C3     1     BC  3 , 7 
       0086C 0B83     1     BS  3 , 6 
       0086D 0943     1     BC  3 , 5 
   936 0086E      C          Clear_RX5_LossframeCNT:
   937 0086E 00FC C        	CLR                 RX5_LossframeCNT
   938 0086F      C          RX5_Over_Judge:
   939 0086F 041B C        	MOV                 A,ComuClock       ;ComuClock == 40 will continue
   940 00870 1D27 C        	SUB                 A,@39
   941 00871 0C03 C        	JBC                 STATUS,C
   942 00872 146F C        	JMP                 $-3
   943 00873 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
   944 00874 0000 C        	NOP
   945 00875 0012 C        	RET
   946            C        
   947            C        
   948            C        
   949            C        
   950            C        ;========================================================================
   951            C        ;=========================================================================
   952            C        ;Function:  setting
   953            C        ;Input:     LossFrameCNTCNT,LossFreqCNT,DataBaseAddress
   954            C        ;Output:    None
   955            C        ;=========================================================================
   956 00876      C        RX6_FUNCTION:
   957            C      M 	PAGE                5
       00876 0BC3     1     BS  3 , 7 
       00877 0983     1     BC  3 , 6 
       00878 0B43     1     BS  3 , 5 
   958            C        	;CALL                Enter_StandbyI_Mode
   959 00879 1171 C        	CALL                RESET_RF_FIFO
   960 0087A 11D2 C        	CALL                ENTER_RX_BUFFER_ACK
   961            C      M 	PAGE                2
       0087B 09C3     1     BC  3 , 7 
       0087C 0B83     1     BS  3 , 6 
       0087D 0943     1     BC  3 , 5 
   962            C        
   963 0087E      C          RX6_DETECT_LOOP:
   964 0087E 041B C        	MOV                 A,ComuClock                  ;ComuClock == 48 will continue
   965 0087F 1D2F C        	SUB                 A,@47
   966 00880 0E03 C        	JBS                 STATUS,C
   967 00881 14C4 C        	JMP                 RX6_Detect_Timeout           ; RX6,Timeout but have not received TX data
   968 00882 0F86 C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   969 00883 147E C        	JMP                 RX6_DETECT_LOOP
   970 00884 0000 C        	NOP
   971            C      M 	PAGE                5
       00885 0BC3     1     BS  3 , 7 
       00886 0983     1     BC  3 , 6 
       00887 0B43     1     BS  3 , 5 
   972 00888 114C C        	CALL                READ_FIFO_RAM
   973 00889 122B C        	CALL                Enter_StandbyI_Mode	
   974            C      M 	PAGE                2
       0088A 09C3     1     BC  3 , 7 
       0088B 0B83     1     BS  3 , 6 
       0088C 0943     1     BC  3 , 5 
   975            C        
   976            C        ;------------------- check sync imformation ---------------------
   977 0088D 10EF C        	CALL                PAGE2BANK1
   978 0088E 0421 C        	MOV                 A,RX_IDH
   979 0088F 10EC C        	CALL                PAGE2BANK0
   980 00890 0361 C        	XOR                 RX_IDH_Buffer,A
   981 00891 0E83 C        	JBS                 STATUS,Z
   982 00892 14CF C        	JMP                 LoseFrameStatus_RxTxID6_Error
   983 00893 10EF C        	CALL                PAGE2BANK1
   984 00894 0422 C        	MOV                 A,RX_IDL
   985 00895 10EC C        	CALL                PAGE2BANK0
   986 00896 0362 C        	XOR                 RX_IDL_Buffer,A
   987 00897 0E83 C        	JBS                 STATUS,Z
   988 00898 14CF C        	JMP                 LoseFrameStatus_RxTxID6_Error
   989 00899 10EF C        	CALL                PAGE2BANK1
   990 0089A 042C C        	MOV                 A,TX6_ID
   991 0089B 10EC C        	CALL                PAGE2BANK0
   992 0089C 0366 C        	XOR                 TX_ID_Buffer,A
   993 0089D 0E83 C        	JBS                 STATUS,Z
   994 0089E 14CF C        	JMP                 LoseFrameStatus_RxTxID6_Error
   995            C        
   996            C        ;---------------------------------------------------------------
   997 0089F 10EC C        	CALL                PAGE2BANK0                       ; Save data from buffer to local
   998 008A0 0427 C        	MOV                 A,DataA_Buffer
   999 008A1 10F5 C        	CALL                PAGE2BANK3
  1000 008A2 0068 C        	MOV                 TX6_DATA1,A
  1001            C        
  1002 008A3 10EC C        	CALL                PAGE2BANK0
  1003 008A4 0428 C        	MOV                 A,DataB_Buffer
  1004 008A5 10F5 C        	CALL                PAGE2BANK3
  1005 008A6 0069 C        	MOV                 TX6_DATA2,A
  1006            C        
  1007 008A7 10EC C        	CALL                PAGE2BANK0
  1008 008A8 0429 C        	MOV                 A,DataC_Buffer
  1009 008A9 10F5 C        	CALL                PAGE2BANK3
  1010 008AA 006A C        	MOV                 TX6_DATA3,A
  1011            C        
  1012 008AB 10EC C        	CALL                PAGE2BANK0
  1013 008AC 042A C        	MOV                 A,DataD_Buffer
  1014 008AD 10F5 C        	CALL                PAGE2BANK3
  1015 008AE 006B C        	MOV                 TX6_DATA4,A
  1016            C        
  1017 008AF 10EC C        	CALL                PAGE2BANK0
  1018 008B0 042B C        	MOV                 A,DataE_Buffer
  1019 008B1 10F5 C        	CALL                PAGE2BANK3
  1020 008B2 006C C        	MOV                 TX6_DATA5,A
  1021            C        
  1022 008B3 10EC C        	CALL                PAGE2BANK0
  1023 008B4 042C C        	MOV                 A,DataF_Buffer
  1024 008B5 10F5 C        	CALL                PAGE2BANK3
  1025 008B6 006D C        	MOV                 TX6_DATA6,A
  1026            C        
  1027 008B7 10EC C        	CALL                PAGE2BANK0
  1028 008B8 042D C        	MOV                 A,DataG_Buffer
  1029 008B9 10F5 C        	CALL                PAGE2BANK3
  1030 008BA 006E C        	MOV                 TX6_DATA7,A
  1031            C        
  1032 008BB 10EF C        	CALL                PAGE2BANK1
  1033 008BC 0B63 C        	BS                  CHN_FLAG,5
  1034 008BD 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
  1035 008BE 14DC C        	JMP                 EP1_REPORT_RX6
  1036 008BF 0D6E C        	JBC                 CHN_FLAG_TEMP,5                           ; CHN_FLAG rising edge
  1037 008C0 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1038 008C1 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16             ;
  1039 008C2 00D7 C        	CLR                 SystemTimeCNT
  1040 008C3 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1041            C        
  1042            C        ;-------------------------------------------------------------------------
  1043 008C4      C          RX6_Detect_Timeout:
  1044 008C4 10EF C        	CALL                PAGE2BANK1
  1045 008C5 0F63 C        	JBS                 CHN_FLAG,5                                ;Lossframe Status
  1046 008C6 14E3 C        	JMP                 Clear_RX6_LossframeCNT                    ;if not SearchStatus,it must be in NormalStatus
  1047 008C7 043D C        	MOV                 A,RX6_LossframeCNT                        ; result = constant - variable
  1048 008C8 1D03 C        	SUB                 A,@3                                   ;   | result > 0   c=1  variable less than constant
  1049 008C9 0C03 C        	JBC                 STATUS,C	                              ;   | result < 0   c=0  variable more than constant
  1050 008CA 14DA C        	JMP                 Increase_RX6_LossframeCNT
  1051 008CB 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
  1052 008CC 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1053 008CD 0963 C        	BC                  CHN_FLAG,5
  1054 008CE 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1055            C        ;-----------------------------------------------------------------------------
  1056 008CF      C          LoseFrameStatus_RxTxID6_Error:
  1057 008CF 10EF C        	CALL                PAGE2BANK1
  1058 008D0 0F63 C        	JBS                 CHN_FLAG,5
  1059 008D1 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1060 008D2 043D C        	MOV                 A,RX6_LossframeCNT                                   ; 5 times lossframe
  1061 008D3 1D05 C        	SUB                 A,@5
  1062 008D4 0C03 C        	JBC                 STATUS,C
  1063 008D5 14DA C        	JMP                 Increase_RX6_LossframeCNT
  1064 008D6 0D5E C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
  1065 008D7 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1066 008D8 0963 C        	BC                  CHN_FLAG,5
  1067 008D9 14E3 C        	JMP                 Clear_RX6_LossframeCNT
  1068            C        
  1069            C        ;--------------------------------------------------------------------------------
  1070 008DA      C          Increase_RX6_LossframeCNT:
  1071 008DA 057D C        	INC                 RX6_LossframeCNT
  1072 008DB 14E4 C        	JMP                 RX6_Over_Judge
  1073 008DC      C          EP1_REPORT_RX6:
  1074            C      M 	PAGE                4
       008DC 0BC3     1     BS  3 , 7 
       008DD 0983     1     BC  3 , 6 
       008DE 0943     1     BC  3 , 5 
  1075 008DF 139C C        	CALL                EP1_Report_6th
  1076            C      M 	PAGE                2
       008E0 09C3     1     BC  3 , 7 
       008E1 0B83     1     BS  3 , 6 
       008E2 0943     1     BC  3 , 5 
  1077 008E3      C          Clear_RX6_LossframeCNT:
  1078 008E3 00FD C        	CLR                 RX6_LossframeCNT
  1079 008E4      C          RX6_Over_Judge:
  1080 008E4 041B C        	MOV                 A,ComuClock       ;ComuClock == 48 will continue
  1081 008E5 1D2F C        	SUB                 A,@47
  1082 008E6 0C03 C        	JBC                 STATUS,C
  1083 008E7 14E4 C        	JMP                 $-3
  1084 008E8 0B06 C        	BS                  SPI_SS/16,SPI_SS%16          ; Dissable RF
  1085            C        
  1086 008E9 00DB C        	CLR                 ComuClock
  1087 008EA 0000 C        	NOP
  1088 008EB 0012 C        	RET
  1089            C        
  1090            C        
  1091            C        
  1092            C        ;=====================================================================
  1093            C        ; BANK exchange function
  1094            C        ;=====================================================================
  1095 008EC      C        	PAGE2BANK0:
  1096 008EC 09C4 C        		BC              0X04,7
  1097 008ED 0984 C        		BC              0X04,6
  1098 008EE 0012 C        	RET
  1099 008EF      C        	PAGE2BANK1:
  1100 008EF 09C4 C        		BC              0X04,7
  1101 008F0 0B84 C        		BS              0X04,6
  1102 008F1 0012 C        	RET
  1103 008F2      C        	PAGE2BANK2:
  1104 008F2 0BC4 C        		BS              0X04,7
  1105 008F3 0984 C        		BC              0X04,6
  1106 008F4 0012 C        	RET
  1107 008F5      C        	PAGE2BANK3:
  1108 008F5 0BC4 C        		BS              0X04,7
  1109 008F6 0B84 C        		BS              0X04,6
  1110 008F7 0012 C        	RET
    20                     include "M611ManageFunc.ASM"
     1            C        ;==================================================================
     2            C        ; Filename     :  EM78M611
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        ;=========================================================================
    11            C        M611ManageFunc.ASM    EQU    M611ManageFunc.ASM
    12            C        
    13            C        include "M611USBDriver.ASM"
     1            C        ;==================================================================
     2            C        ; Filename     :  EM78M611
     3            C        ; Author       :  yu.wei
     4            C        ; Company      :  ELAN
     5            C        ; VERSION      :  1.1
     6            C        ; CRYSTAL      :  8MHZ
     7            C        ; Creat date   :  2009/11/4
     8            C        ; tool ver.    :  eUIDE
     9            C        ; Description  :  modify for code conformity
    10            C        ;=========================================================================
    11            C        M611USBDriver.ASM    EQU    M611USBDriver.ASM
    12            C        
    13            C        
    14            C        include "M611USBDescData.ASM"
     1            C        ;==================================================================
     2            C        ;  Tilte:       EM78M198810 include file		;
     3            C        ;  NAME:        EM198810_FOR_EM78M611.ASM
     4            C        ;  Description: The Definition of EM78M198810 for EM78612 Registers ;
     5            C        ;  Company:     Elan Electronic Corp.		;
     6            C        ;  Author:      YU.WEI				;
     7            C        ;  Date:        2009.02.26			;
     8            C        ;  Version:     v1.0				;
     9            C        ;  Tool:        wiceplus 2.7
    10            C        ;=========================================================================
    11            C        M611USBDescData.ASM    EQU    M611USBDescData.ASM
    12            C        
    13            C        
    14            C        ;********************************************************************************
    15            C        ; initial USB communiate to PC,INITIAL
    16            C        ;********************************************************************************
    17            C        ;============================================================
    18            C        ;	DESCRIPTORS
    19            C        ;============================================================
    20            C        
    21            C        		ORG 	0XC00	;PAGE 3
    22 00C00      C        DEVICE_TABLE:
    23 00C00 0020 C        		TBL
    24            C        		;Device Descriptor
    25 00C01 1C12 C        		RETL	@0X12;01	bLength
    26 00C02 1C01 C        		RETL	@0X01;02	bDescriptorType
    27 00C03 1C10 C        		RETL	@0X10;03	bcdUSB
    28 00C04 1C01 C        		RETL	@0X01;04
    29 00C05 1C00 C        		RETL	@0X00;05	bDeviceCalss
    30 00C06 1C00 C        		RETL	@0X00;06	bDeviceSubClass
    31 00C07 1C00 C        		RETL	@0X00;07	bDeviceProtocol
    32 00C08 1C08 C        		RETL	@0X08;08	bMaxPacketSize0 ,MCU point0 byte length
    33 00C09 1CF3 C        		RETL	@0XF3;09	idVendor 0X04F3
    34 00C0A 1C04 C        		RETL	@0X04;0A
    35 00C0B 1C1F C        		RETL	@0X1F;0B	idProduct (joystick:0x0f1f)
    36 00C0C 1C0F C        		RETL	@0X0F;0C
    37 00C0D 1C70 C        		RETL	@0X70;0D	bcdDevice v1.7.0
    38 00C0E 1C01 C        		RETL	@0X01;0E
    39 00C0F 1C01 C        		RETL	@0X01;0F	iManufacturer
    40 00C10 1C02 C        		RETL	@0X02;10	iProduct
    41 00C11 1C03 C        		RETL	@0X03;11	iSerialNumber
    42 00C12 1C01 C        		RETL	@0X01;12	bNumConfigurations
    43            C        
    44            C        
    45 00C13      C        CONFIG_TABLE:
    46 00C13 0020 C        		TBL
    47            C        		;Configuration Descriptor
    48 00C14 1C09 C        		RETL	@0X09;01	bLength
    49 00C15 1C02 C        		RETL	@0X02;02	bDescritorType
    50 00C16 1C22 C        		RETL	@0X22;03	wTotalLength
    51 00C17 1C00 C        		RETL	@0X00;04
    52 00C18 1C01 C        		RETL	@0X01;05	bConfigurationValue
    53 00C19 1C01 C        		RETL	@0X01;06	bNumInterfaces
    54 00C1A 1C00 C        		RETL	@0X00;07	iConfiguration
    55 00C1B 1C80 C        		RETL	@0X80;08	bmAttributes
    56 00C1C 1C32 C        		RETL	@0X32;09	bMaxPower ,Imax=100mA
    57            C        
    58            C        		;Interface Descriptor
    59 00C1D 1C09 C        		RETL	@0X09;0A	bLength
    60 00C1E 1C04 C        		RETL	@0X04;0B	bDescriptorType
    61 00C1F 1C00 C        		RETL	@0X00;0C	bInterfaceNumber
    62 00C20 1C00 C        		RETL	@0X00;0D	bAlternateSetting
    63 00C21 1C01 C        		RETL	@0X01;0E	bNumEndpoints
    64 00C22 1C03 C        		RETL	@0X03;0F	bInterfaceClass (Class:HID)
    65 00C23 1C00 C        		RETL	@0X00;10	bInterfaceSubClass (BOOT DEVICE)
    66 00C24 1C00 C        		RETL	@0X00;11	bInterfaceProtocol (joystick)
    67 00C25 1C00 C        		RETL	@0X00;12	iConfiguration
    68            C        
    69            C        		;HID Descriptor
    70 00C26 1C09 C        		RETL	@0X09            ;13    bLength
    71 00C27 1C21 C        		RETL	@0X21            ;14    bDescriptorType
    72 00C28 1C10 C        		RETL	@0X10            ;15    bcdHID
    73 00C29 1C01 C        		RETL	@0X01            ;16
    74 00C2A 1C21 C        		RETL	@0X21            ;17    bCountryCode
    75 00C2B 1C01 C        		RETL	@0X01            ;18    bNumDescriptors
    76 00C2C 1C22 C        		RETL	@0X22            ;19    bDescriptorType. report descriptor:0x22, physics descriptor:0x23
    77            C                                                ;1A    bLength of the Report Descriptor ;0XF8
    78 00C2D 1CD4 C        		RETL	@(End_HID_Report_Table1-Begin_HID_Report_Table1)+(End_HID_Report_Table2-Begin_HID_Report_HID_Report_Table3)-0X100
    79 00C2E 1C01 C        		RETL	@0X01            ;1B    ;0X01
    80            C        
    81            C        		;Endpoint Descriptor
    82 00C2F 1C07 C        		RETL	@0X07;1C	bLength
    83 00C30 1C05 C        		RETL	@0X05;1D	bDescriptorType
    84 00C31 1C81 C        		RETL	@0X81;1E	bEndpointAddress
    85 00C32 1C03 C        		RETL	@0X03;1F	bmAttributes
    86 00C33 1C08 C        		RETL	@0X08;20	wMaxPackerSize
    87 00C34 1C00 C        		RETL	@0X00;21
    88 00C35 1C05 C        		RETL	@0X05;22	bInterval    ;change 20ms
    89            C        
    90            C        
    91            C        ;---------------------------------------------------------------------
    92            C        ;---------------------------------------------------------------------
    93 00C36      C        STRING0T:
    94            C        		;String Descriptor Of Languages
    95 00C36 0020 C        		TBL
    96 00C37 1C04 C        		RETL	@0X04;01	bLength
    97 00C38 1C03 C        		RETL	@0X03;02	bdescriptorType
    98 00C39 1C09 C        		RETL	@0X09;03
    99 00C3A 1C04 C        		RETL	@0X04;04	END OF LANGUAGES
   100            C        
   101            C        
   102            C        ;---------------------------------------------------------------------
   103            C        ;---------------------------------------------------------------------
   104            C        		ORG         0XD00
   105 00D00      C        HID_REPORT_TABLE1:
   106 00D00 0020 C        		TBL
   107 00D01      C        	Begin_HID_Report_Table1:
   108            C        ;----------------------------------------------------------
   109            C        	;--REPORT DESCRIPTOR--
   110 00D01 1C05 C        	RETL @0X05    ;USAGE PAGE
   111 00D02 1C01 C        	RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   112 00D03 1C09 C        	RETL @0X09    ;USAGE
   113 00D04 1C04 C        	RETL @0X04    ;(JOYSTICK)
   114            C        	;{
   115 00D05 1CA1 C        		RETL @0XA1    ;COLLECTION
   116 00D06 1C01 C        		RETL @0X01    ;(APPLICATION)
   117 00D07 1C85 C        		RETL @0X85    ;REPORT ID
   118 00D08 1C01 C        		RETL @0X01
   119            C        		;{
   120            C        		;{X,Y,Z,Rz
   121 00D09 1CA1 C        			RETL	@0XA1    ;Collection
   122 00D0A 1C02 C        			RETL	@0X02    ;Logical
   123 00D0B 1C09 C        			RETL	@0X09    ;USAGE
   124 00D0C 1C30 C        			RETL	@0X30    ;(X)
   125 00D0D 1C09 C        			RETL	@0X09    ;USAGE
   126 00D0E 1C31 C        			RETL	@0X31    ;(Y)
   127 00D0F 1C09 C        			RETL	@0X09    ;USAGE
   128 00D10 1C35 C        			RETL	@0X35    ;(Rz)
   129 00D11 1C09 C        			RETL	@0X09    ;USAGE
   130 00D12 1C32 C        			RETL	@0X32    ;(Z)
   131 00D13 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   132 00D14 1C00 C        			RETL	@0X00    ;(0)
   133 00D15 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   134 00D16 1CFF C        			RETL	@0XFF    ;(FF)
   135 00D17 1C00 C        			RETL	@0X00
   136 00D18 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   137 00D19 1C00 C        			RETL	@0X00    ;(0)
   138 00D1A 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   139 00D1B 1CFF C        			RETL	@0XFF    ;(FF)
   140 00D1C 1C00 C        			RETL	@0X00
   141 00D1D 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   142 00D1E 1C08 C        			RETL	@0X08    ;(8)
   143 00D1F 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   144 00D20 1C04 C        			RETL	@0X04    ;(4)
   145 00D21 1C81 C        			RETL	@0X81    ;INPUT
   146 00D22 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   147            C        		;}
   148            C        		;{Button
   149 00D23 1C05 C        			RETL @0X05    ;USAGE_PAGE
   150 00D24 1C09 C        			RETL @0X09    ;(Button)
   151 00D25 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   152 00D26 1C01 C        			RETL @0X01    ;(BUTTON 1)
   153 00D27 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   154 00D28 1C10 C        			RETL @0X10    ;(BUTTON 16)
   155 00D29 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   156 00D2A 1C01 C        			RETL @0X01    ;(1)
   157 00D2B 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   158 00D2C 1C01 C        			RETL @0X01    ;(1)
   159 00D2D 1C75 C        			RETL @0X75    ;REPORT_SIZE
   160 00D2E 1C01 C        			RETL @0X01    ;(1)
   161 00D2F 1C95 C        			RETL @0X95    ;REPORT_COUNT
   162 00D30 1C10 C        			RETL @0X10    ;(16)
   163 00D31 1C81 C        			RETL @0X81    ;INPUT
   164 00D32 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   165            C        		;}
   166            C        		;{Hat Switch
   167 00D33 1C06 C        			RETL @0X06
   168 00D34 1C01 C        			RETL @0X01
   169 00D35 1C00 C        			RETL @0X00
   170 00D36 1C09 C        			RETL @0X09    ;USAGE
   171 00D37 1C39 C        			RETL @0X39    ;(Hat Switch)
   172 00D38 1C75 C        			RETL @0X75    ;REPORT_SIZE
   173 00D39 1C04 C        			RETL @0X04    ;(4)
   174 00D3A 1C95 C        			RETL @0X95    ;REPORT_COUNT
   175 00D3B 1C01 C        			RETL @0X01    ;(1)
   176 00D3C 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   177 00D3D 1C07 C        			RETL @0X07    ;(7)
   178 00D3E 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   179 00D3F 1C3B C        			RETL @0X3B    ;(315)
   180 00D40 1C01 C        			RETL @0X01
   181 00D41 1C65 C        			RETL @0X65    ;UNIT
   182 00D42 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   183 00D43 1C81 C        			RETL @0X81    ;INPUT
   184 00D44 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   185            C        		;}
   186            C        		;{Const
   187 00D45 1C65 C        			RETL @0X65    ;UNIT
   188 00D46 1C00 C        			RETL @0X00    ;(None)
   189 00D47 1C75 C        			RETL @0X75    ;REPORT_SIZE
   190 00D48 1C04 C        			RETL @0X04    ;(4)
   191 00D49 1C95 C        			RETL @0X95    ;REPORT_COUNT
   192 00D4A 1C01 C        			RETL @0X01    ;(1)
   193 00D4B 1C81 C        			RETL @0X81    ;INPUT
   194 00D4C 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   195 00D4D 1CC0 C        			RETL @0XC0    ;END COLLECTION
   196            C        		;}
   197            C        	;}
   198 00D4E 1CC0 C          RETL @0XC0              ;78;END COLLECTION
   199            C        
   200            C        ;----------------------------------------------------
   201            C        	;--REPORT DESCRIPTOR--
   202 00D4F 1C05 C        	RETL @0X05    ;USAGE PAGE
   203 00D50 1C01 C        	RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   204 00D51 1C09 C        	RETL @0X09    ;USAGE
   205 00D52 1C04 C        	RETL @0X04    ;(JOYSTICK)
   206            C        	;{
   207 00D53 1CA1 C        		RETL @0XA1    ;COLLECTION
   208 00D54 1C01 C        		RETL @0X01    ;(APPLICATION)
   209 00D55 1C85 C        		RETL @0X85    ;REPORT ID
   210 00D56 1C02 C        		RETL @0X02
   211            C        		;{
   212            C        		;{X,Y,Z,Rz
   213 00D57 1CA1 C        			RETL	@0XA1    ;Collection
   214 00D58 1C02 C        			RETL	@0X02    ;Logical
   215 00D59 1C09 C        			RETL	@0X09    ;USAGE
   216 00D5A 1C30 C        			RETL	@0X30    ;(X)
   217 00D5B 1C09 C        			RETL	@0X09    ;USAGE
   218 00D5C 1C31 C        			RETL	@0X31    ;(Y)
   219 00D5D 1C09 C        			RETL	@0X09    ;USAGE
   220 00D5E 1C35 C        			RETL	@0X35    ;(Rz)
   221 00D5F 1C09 C        			RETL	@0X09    ;USAGE
   222 00D60 1C32 C        			RETL	@0X32    ;(Z)
   223 00D61 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   224 00D62 1C00 C        			RETL	@0X00    ;(0)
   225 00D63 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   226 00D64 1CFF C        			RETL	@0XFF    ;(FF)
   227 00D65 1C00 C        			RETL	@0X00
   228 00D66 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   229 00D67 1C00 C        			RETL	@0X00    ;(0)
   230 00D68 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   231 00D69 1CFF C        			RETL	@0XFF    ;(FF)
   232 00D6A 1C00 C        			RETL	@0X00
   233 00D6B 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   234 00D6C 1C08 C        			RETL	@0X08    ;(8)
   235 00D6D 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   236 00D6E 1C04 C        			RETL	@0X04    ;(4)
   237 00D6F 1C81 C        			RETL	@0X81    ;INPUT
   238 00D70 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   239            C        		;}
   240            C        		;{Button
   241 00D71 1C05 C        			RETL @0X05    ;USAGE_PAGE
   242 00D72 1C09 C        			RETL @0X09    ;(Button)
   243 00D73 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   244 00D74 1C01 C        			RETL @0X01    ;(BUTTON 1)
   245 00D75 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   246 00D76 1C10 C        			RETL @0X10    ;(BUTTON 16)
   247 00D77 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   248 00D78 1C01 C        			RETL @0X01    ;(1)
   249 00D79 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   250 00D7A 1C01 C        			RETL @0X01    ;(1)
   251 00D7B 1C75 C        			RETL @0X75    ;REPORT_SIZE
   252 00D7C 1C01 C        			RETL @0X01    ;(1)
   253 00D7D 1C95 C        			RETL @0X95    ;REPORT_COUNT
   254 00D7E 1C10 C        			RETL @0X10    ;(16)
   255 00D7F 1C81 C        			RETL @0X81    ;INPUT
   256 00D80 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   257            C        		;}
   258            C        		;{Hat Switch
   259 00D81 1C06 C        			RETL @0X06
   260 00D82 1C01 C        			RETL @0X01
   261 00D83 1C00 C        			RETL @0X00
   262 00D84 1C09 C        			RETL @0X09    ;USAGE
   263 00D85 1C39 C        			RETL @0X39    ;(Hat Switch)
   264 00D86 1C75 C        			RETL @0X75    ;REPORT_SIZE
   265 00D87 1C04 C        			RETL @0X04    ;(4)
   266 00D88 1C95 C        			RETL @0X95    ;REPORT_COUNT
   267 00D89 1C01 C        			RETL @0X01    ;(1)
   268 00D8A 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   269 00D8B 1C07 C        			RETL @0X07    ;(7)
   270 00D8C 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   271 00D8D 1C3B C        			RETL @0X3B    ;(315)
   272 00D8E 1C01 C        			RETL @0X01
   273 00D8F 1C65 C        			RETL @0X65    ;UNIT
   274 00D90 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   275 00D91 1C81 C        			RETL @0X81    ;INPUT
   276 00D92 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   277            C        		;}
   278            C        		;{Const
   279 00D93 1C65 C        			RETL @0X65    ;UNIT
   280 00D94 1C00 C        			RETL @0X00    ;(None)
   281 00D95 1C75 C        			RETL @0X75    ;REPORT_SIZE
   282 00D96 1C04 C        			RETL @0X04    ;(4)
   283 00D97 1C95 C        			RETL @0X95    ;REPORT_COUNT
   284 00D98 1C01 C        			RETL @0X01    ;(1)
   285 00D99 1C81 C        			RETL @0X81    ;INPUT
   286 00D9A 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   287 00D9B 1CC0 C        			RETL @0XC0    ;END COLLECTION
   288            C        		;}
   289            C        	;}
   290 00D9C 1CC0 C        	RETL @0XC0              ;78;END COLLECTION
   291 00D9D      C        	End_HID_Report_Table1:
   292            C        
   293            C        ;---------------------------------------------------------------------
   294            C        ;---------------------------------------------------------------------
   295            C        		ORG         0XE00
   296 00E00      C        HID_REPORT_TABLE2:
   297 00E00 0020 C        		TBL
   298 00E01      C        	Begin_HID_Report_Table2:
   299            C        ;-------------------------------------------------------
   300            C        	;--REPORT DESCRIPTOR--
   301 00E01 1C05 C        		RETL @0X05    ;USAGE PAGE
   302 00E02 1C01 C        		RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   303 00E03 1C09 C        		RETL @0X09    ;USAGE
   304 00E04 1C04 C        		RETL @0X04    ;(JOYSTICK)
   305            C        	;{
   306 00E05 1CA1 C        		RETL @0XA1    ;COLLECTION
   307 00E06 1C01 C        		RETL @0X01    ;(APPLICATION)
   308 00E07 1C85 C        		RETL @0X85    ;REPORT ID
   309 00E08 1C03 C        		RETL @0X03
   310            C        		;{
   311            C        		;{X,Y,Z,Rz
   312 00E09 1CA1 C        			RETL	@0XA1    ;Collection
   313 00E0A 1C02 C        			RETL	@0X02    ;Logical
   314 00E0B 1C09 C        			RETL	@0X09    ;USAGE
   315 00E0C 1C30 C        			RETL	@0X30    ;(X)
   316 00E0D 1C09 C        			RETL	@0X09    ;USAGE
   317 00E0E 1C31 C        			RETL	@0X31    ;(Y)
   318 00E0F 1C09 C        			RETL	@0X09    ;USAGE
   319 00E10 1C35 C        			RETL	@0X35    ;(Rz)
   320 00E11 1C09 C        			RETL	@0X09    ;USAGE
   321 00E12 1C32 C        			RETL	@0X32    ;(Z)
   322 00E13 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   323 00E14 1C00 C        			RETL	@0X00    ;(0)
   324 00E15 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   325 00E16 1CFF C        			RETL	@0XFF    ;(FF)
   326 00E17 1C00 C        			RETL	@0X00
   327 00E18 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   328 00E19 1C00 C        			RETL	@0X00    ;(0)
   329 00E1A 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   330 00E1B 1CFF C        			RETL	@0XFF    ;(FF)
   331 00E1C 1C00 C        			RETL	@0X00
   332 00E1D 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   333 00E1E 1C08 C        			RETL	@0X08    ;(8)
   334 00E1F 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   335 00E20 1C04 C        			RETL	@0X04    ;(4)
   336 00E21 1C81 C        			RETL	@0X81    ;INPUT
   337 00E22 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   338            C        		;}
   339            C        		;{Button
   340 00E23 1C05 C        			RETL @0X05    ;USAGE_PAGE
   341 00E24 1C09 C        			RETL @0X09    ;(Button)
   342 00E25 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   343 00E26 1C01 C        			RETL @0X01    ;(BUTTON 1)
   344 00E27 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   345 00E28 1C10 C        			RETL @0X10    ;(BUTTON 16)
   346 00E29 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   347 00E2A 1C01 C        			RETL @0X01    ;(1)
   348 00E2B 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   349 00E2C 1C01 C        			RETL @0X01    ;(1)
   350 00E2D 1C75 C        			RETL @0X75    ;REPORT_SIZE
   351 00E2E 1C01 C        			RETL @0X01    ;(1)
   352 00E2F 1C95 C        			RETL @0X95    ;REPORT_COUNT
   353 00E30 1C10 C        			RETL @0X10    ;(16)
   354 00E31 1C81 C        			RETL @0X81    ;INPUT
   355 00E32 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   356            C        		;}
   357            C        		;{Hat Switch
   358 00E33 1C06 C        			RETL @0X06
   359 00E34 1C01 C        			RETL @0X01
   360 00E35 1C00 C        			RETL @0X00
   361 00E36 1C09 C        			RETL @0X09    ;USAGE
   362 00E37 1C39 C        			RETL @0X39    ;(Hat Switch)
   363 00E38 1C75 C        			RETL @0X75    ;REPORT_SIZE
   364 00E39 1C04 C        			RETL @0X04    ;(4)
   365 00E3A 1C95 C        			RETL @0X95    ;REPORT_COUNT
   366 00E3B 1C01 C        			RETL @0X01    ;(1)
   367 00E3C 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   368 00E3D 1C07 C        			RETL @0X07    ;(7)
   369 00E3E 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   370 00E3F 1C3B C        			RETL @0X3B    ;(315)
   371 00E40 1C01 C        			RETL @0X01
   372 00E41 1C65 C        			RETL @0X65    ;UNIT
   373 00E42 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   374 00E43 1C81 C        			RETL @0X81    ;INPUT
   375 00E44 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   376            C        		;}
   377            C        		;{Const
   378 00E45 1C65 C        			RETL @0X65    ;UNIT
   379 00E46 1C00 C        			RETL @0X00    ;(None)
   380 00E47 1C75 C        			RETL @0X75    ;REPORT_SIZE
   381 00E48 1C04 C        			RETL @0X04    ;(4)
   382 00E49 1C95 C        			RETL @0X95    ;REPORT_COUNT
   383 00E4A 1C01 C        			RETL @0X01    ;(1)
   384 00E4B 1C81 C        			RETL @0X81    ;INPUT
   385 00E4C 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   386 00E4D 1CC0 C        			RETL @0XC0    ;END COLLECTION
   387            C        		;}
   388            C        	;}
   389 00E4E 1CC0 C        	RETL @0XC0              ;78;END COLLECTION
   390            C        
   391            C        ;-----------------------------------------------------
   392            C        	;--REPORT DESCRIPTOR--
   393 00E4F 1C05 C        	RETL @0X05    ;USAGE PAGE
   394 00E50 1C01 C        	RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   395 00E51 1C09 C        	RETL @0X09    ;USAGE
   396 00E52 1C04 C        	RETL @0X04    ;(JOYSTICK)
   397            C        	;{
   398 00E53 1CA1 C        		RETL @0XA1    ;COLLECTION
   399 00E54 1C01 C        		RETL @0X01    ;(APPLICATION)
   400 00E55 1C85 C        		RETL @0X85    ;REPORT ID
   401 00E56 1C04 C        		RETL @0X04
   402            C        		;{
   403            C        		;{X,Y,Z,Rz
   404 00E57 1CA1 C        			RETL	@0XA1    ;Collection
   405 00E58 1C02 C        			RETL	@0X02    ;Logical
   406 00E59 1C09 C        			RETL	@0X09    ;USAGE
   407 00E5A 1C30 C        			RETL	@0X30    ;(X)
   408 00E5B 1C09 C        			RETL	@0X09    ;USAGE
   409 00E5C 1C31 C        			RETL	@0X31    ;(Y)
   410 00E5D 1C09 C        			RETL	@0X09    ;USAGE
   411 00E5E 1C35 C        			RETL	@0X35    ;(Rz)
   412 00E5F 1C09 C        			RETL	@0X09    ;USAGE
   413 00E60 1C32 C        			RETL	@0X32    ;(Z)
   414 00E61 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   415 00E62 1C00 C        			RETL	@0X00    ;(0)
   416 00E63 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   417 00E64 1CFF C        			RETL	@0XFF    ;(FF)
   418 00E65 1C00 C        			RETL	@0X00
   419 00E66 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   420 00E67 1C00 C        			RETL	@0X00    ;(0)
   421 00E68 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   422 00E69 1CFF C        			RETL	@0XFF    ;(FF)
   423 00E6A 1C00 C        			RETL	@0X00
   424 00E6B 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   425 00E6C 1C08 C        			RETL	@0X08    ;(8)
   426 00E6D 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   427 00E6E 1C04 C        			RETL	@0X04    ;(4)
   428 00E6F 1C81 C        			RETL	@0X81    ;INPUT
   429 00E70 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   430            C        		;}
   431            C        		;{Button
   432 00E71 1C05 C        			RETL @0X05    ;USAGE_PAGE
   433 00E72 1C09 C        			RETL @0X09    ;(Button)
   434 00E73 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   435 00E74 1C01 C        			RETL @0X01    ;(BUTTON 1)
   436 00E75 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   437 00E76 1C10 C        			RETL @0X10    ;(BUTTON 16)
   438 00E77 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   439 00E78 1C01 C        			RETL @0X01    ;(1)
   440 00E79 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   441 00E7A 1C01 C        			RETL @0X01    ;(1)
   442 00E7B 1C75 C        			RETL @0X75    ;REPORT_SIZE
   443 00E7C 1C01 C        			RETL @0X01    ;(1)
   444 00E7D 1C95 C        			RETL @0X95    ;REPORT_COUNT
   445 00E7E 1C10 C        			RETL @0X10    ;(16)
   446 00E7F 1C81 C        			RETL @0X81    ;INPUT
   447 00E80 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   448            C        		;}
   449            C        		;{Hat Switch
   450 00E81 1C06 C        			RETL @0X06
   451 00E82 1C01 C        			RETL @0X01
   452 00E83 1C00 C        			RETL @0X00
   453 00E84 1C09 C        			RETL @0X09    ;USAGE
   454 00E85 1C39 C        			RETL @0X39    ;(Hat Switch)
   455 00E86 1C75 C        			RETL @0X75    ;REPORT_SIZE
   456 00E87 1C04 C        			RETL @0X04    ;(4)
   457 00E88 1C95 C        			RETL @0X95    ;REPORT_COUNT
   458 00E89 1C01 C        			RETL @0X01    ;(1)
   459 00E8A 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   460 00E8B 1C07 C        			RETL @0X07    ;(7)
   461 00E8C 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   462 00E8D 1C3B C        			RETL @0X3B    ;(315)
   463 00E8E 1C01 C        			RETL @0X01
   464 00E8F 1C65 C        			RETL @0X65    ;UNIT
   465 00E90 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   466 00E91 1C81 C        			RETL @0X81    ;INPUT
   467 00E92 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   468            C        		;}
   469            C        		;{Const
   470 00E93 1C65 C        			RETL @0X65    ;UNIT
   471 00E94 1C00 C        			RETL @0X00    ;(None)
   472 00E95 1C75 C        			RETL @0X75    ;REPORT_SIZE
   473 00E96 1C04 C        			RETL @0X04    ;(4)
   474 00E97 1C95 C        			RETL @0X95    ;REPORT_COUNT
   475 00E98 1C01 C        			RETL @0X01    ;(1)
   476 00E99 1C81 C        			RETL @0X81    ;INPUT
   477 00E9A 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   478 00E9B 1CC0 C        			RETL @0XC0    ;END COLLECTION
   479            C        		;}
   480            C        	;}
   481 00E9C 1CC0 C        	RETL @0XC0              ;78;END COLLECTION
   482 00E9D      C        	End_HID_Report_Table2:
   483            C        
   484            C        ;---------------------------------------------------------------------
   485            C        ;---------------------------------------------------------------------
   486            C        		ORG         0XF00
   487 00F00      C        HID_REPORT_TABLE3:
   488 00F00 0020 C        		TBL
   489 00F01      C        	Begin_HID_Report_Table3:
   490            C        ;--------------------------------------------------
   491            C        	;--REPORT DESCRIPTOR--
   492 00F01 1C05 C        	RETL @0X05    ;USAGE PAGE
   493 00F02 1C01 C        	RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   494 00F03 1C09 C        	RETL @0X09    ;USAGE
   495 00F04 1C04 C        	RETL @0X04    ;(JOYSTICK)
   496            C        	;{
   497 00F05 1CA1 C        		RETL @0XA1    ;COLLECTION
   498 00F06 1C01 C        		RETL @0X01    ;(APPLICATION)
   499 00F07 1C85 C        		RETL @0X85    ;REPORT ID
   500 00F08 1C05 C        		RETL @0X05
   501            C        		;{
   502            C        		;{X,Y,Z,Rz
   503 00F09 1CA1 C        			RETL	@0XA1    ;Collection
   504 00F0A 1C02 C        			RETL	@0X02    ;Logical
   505 00F0B 1C09 C        			RETL	@0X09    ;USAGE
   506 00F0C 1C30 C        			RETL	@0X30    ;(X)
   507 00F0D 1C09 C        			RETL	@0X09    ;USAGE
   508 00F0E 1C31 C        			RETL	@0X31    ;(Y)
   509 00F0F 1C09 C        			RETL	@0X09    ;USAGE
   510 00F10 1C35 C        			RETL	@0X35    ;(Rz)
   511 00F11 1C09 C        			RETL	@0X09    ;USAGE
   512 00F12 1C32 C        			RETL	@0X32    ;(Z)
   513 00F13 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   514 00F14 1C00 C        			RETL	@0X00    ;(0)
   515 00F15 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   516 00F16 1CFF C        			RETL	@0XFF    ;(FF)
   517 00F17 1C00 C        			RETL	@0X00
   518 00F18 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   519 00F19 1C00 C        			RETL	@0X00    ;(0)
   520 00F1A 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   521 00F1B 1CFF C        			RETL	@0XFF    ;(FF)
   522 00F1C 1C00 C        			RETL	@0X00
   523 00F1D 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   524 00F1E 1C08 C        			RETL	@0X08    ;(8)
   525 00F1F 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   526 00F20 1C04 C        			RETL	@0X04    ;(4)
   527 00F21 1C81 C        			RETL	@0X81    ;INPUT
   528 00F22 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   529            C        		;}
   530            C        		;{Button
   531 00F23 1C05 C        			RETL @0X05    ;USAGE_PAGE
   532 00F24 1C09 C        			RETL @0X09    ;(Button)
   533 00F25 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   534 00F26 1C01 C        			RETL @0X01    ;(BUTTON 1)
   535 00F27 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   536 00F28 1C10 C        			RETL @0X10    ;(BUTTON 16)
   537 00F29 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   538 00F2A 1C01 C        			RETL @0X01    ;(1)
   539 00F2B 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   540 00F2C 1C01 C        			RETL @0X01    ;(1)
   541 00F2D 1C75 C        			RETL @0X75    ;REPORT_SIZE
   542 00F2E 1C01 C        			RETL @0X01    ;(1)
   543 00F2F 1C95 C        			RETL @0X95    ;REPORT_COUNT
   544 00F30 1C10 C        			RETL @0X10    ;(16)
   545 00F31 1C81 C        			RETL @0X81    ;INPUT
   546 00F32 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   547            C        		;}
   548            C        		;{Hat Switch
   549 00F33 1C06 C        			RETL @0X06
   550 00F34 1C01 C        			RETL @0X01
   551 00F35 1C00 C        			RETL @0X00
   552 00F36 1C09 C        			RETL @0X09    ;USAGE
   553 00F37 1C39 C        			RETL @0X39    ;(Hat Switch)
   554 00F38 1C75 C        			RETL @0X75    ;REPORT_SIZE
   555 00F39 1C04 C        			RETL @0X04    ;(4)
   556 00F3A 1C95 C        			RETL @0X95    ;REPORT_COUNT
   557 00F3B 1C01 C        			RETL @0X01    ;(1)
   558 00F3C 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   559 00F3D 1C07 C        			RETL @0X07    ;(7)
   560 00F3E 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   561 00F3F 1C3B C        			RETL @0X3B    ;(315)
   562 00F40 1C01 C        			RETL @0X01
   563 00F41 1C65 C        			RETL @0X65    ;UNIT
   564 00F42 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   565 00F43 1C81 C        			RETL @0X81    ;INPUT
   566 00F44 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   567            C        		;}
   568            C        		;{Const
   569 00F45 1C65 C        			RETL @0X65    ;UNIT
   570 00F46 1C00 C        			RETL @0X00    ;(None)
   571 00F47 1C75 C        			RETL @0X75    ;REPORT_SIZE
   572 00F48 1C04 C        			RETL @0X04    ;(4)
   573 00F49 1C95 C        			RETL @0X95    ;REPORT_COUNT
   574 00F4A 1C01 C        			RETL @0X01    ;(1)
   575 00F4B 1C81 C        			RETL @0X81    ;INPUT
   576 00F4C 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   577 00F4D 1CC0 C        			RETL @0XC0    ;END COLLECTION
   578            C        		;}
   579            C        	;}
   580 00F4E 1CC0 C        	RETL @0XC0              ;78;END COLLECTION
   581            C        
   582            C        ;--------------------------------------------------
   583            C        	;--REPORT DESCRIPTOR--
   584 00F4F 1C05 C        	RETL @0X05    ;USAGE PAGE
   585 00F50 1C01 C        	RETL @0X01    ;(GENERIC DESKTOP CONTROL)
   586 00F51 1C09 C        	RETL @0X09    ;USAGE
   587 00F52 1C04 C        	RETL @0X04    ;(JOYSTICK)
   588            C        	;{
   589 00F53 1CA1 C        		RETL @0XA1    ;COLLECTION
   590 00F54 1C01 C        		RETL @0X01    ;(APPLICATION)
   591 00F55 1C85 C        		RETL @0X85    ;REPORT ID
   592 00F56 1C06 C        		RETL @0X06
   593            C        		;{
   594            C        		;{X,Y,Z,Rz
   595 00F57 1CA1 C        			RETL	@0XA1    ;Collection
   596 00F58 1C02 C        			RETL	@0X02    ;Logical
   597 00F59 1C09 C        			RETL	@0X09    ;USAGE
   598 00F5A 1C30 C        			RETL	@0X30    ;(X)
   599 00F5B 1C09 C        			RETL	@0X09    ;USAGE
   600 00F5C 1C31 C        			RETL	@0X31    ;(Y)
   601 00F5D 1C09 C        			RETL	@0X09    ;USAGE
   602 00F5E 1C35 C        			RETL	@0X35    ;(Rz)
   603 00F5F 1C09 C        			RETL	@0X09    ;USAGE
   604 00F60 1C32 C        			RETL	@0X32    ;(Z)
   605 00F61 1C15 C        			RETL	@0X15    ;LOGICAL_MINIMUN
   606 00F62 1C00 C        			RETL	@0X00    ;(0)
   607 00F63 1C26 C        			RETL	@0X26    ;LOGICAL_MAXIMUM
   608 00F64 1CFF C        			RETL	@0XFF    ;(FF)
   609 00F65 1C00 C        			RETL	@0X00
   610 00F66 1C35 C        			RETL	@0X35    ;PHYSICAL MINIMUM
   611 00F67 1C00 C        			RETL	@0X00    ;(0)
   612 00F68 1C46 C        			RETL	@0X46    ;PHYSICAL MAXIMUM
   613 00F69 1CFF C        			RETL	@0XFF    ;(FF)
   614 00F6A 1C00 C        			RETL	@0X00
   615 00F6B 1C75 C        			RETL	@0X75    ;REPORT_SIZE
   616 00F6C 1C08 C        			RETL	@0X08    ;(8)
   617 00F6D 1C95 C        			RETL	@0X95    ;REPORT_COUNT
   618 00F6E 1C04 C        			RETL	@0X04    ;(4)
   619 00F6F 1C81 C        			RETL	@0X81    ;INPUT
   620 00F70 1C02 C        			RETL	@0X02    ;(Data Ary,Abs)
   621            C        		;}
   622            C        		;{Button
   623 00F71 1C05 C        			RETL @0X05    ;USAGE_PAGE
   624 00F72 1C09 C        			RETL @0X09    ;(Button)
   625 00F73 1C19 C        			RETL @0X19    ;USAGE MINIMUN
   626 00F74 1C01 C        			RETL @0X01    ;(BUTTON 1)
   627 00F75 1C29 C        			RETL @0X29    ;USAGE MAXIMUM
   628 00F76 1C10 C        			RETL @0X10    ;(BUTTON 16)
   629 00F77 1C25 C        			RETL @0X25    ;LOGICAL MAXIMUM
   630 00F78 1C01 C        			RETL @0X01    ;(1)
   631 00F79 1C45 C        			RETL @0X45    ;PHYSICAL MAXIMUM
   632 00F7A 1C01 C        			RETL @0X01    ;(1)
   633 00F7B 1C75 C        			RETL @0X75    ;REPORT_SIZE
   634 00F7C 1C01 C        			RETL @0X01    ;(1)
   635 00F7D 1C95 C        			RETL @0X95    ;REPORT_COUNT
   636 00F7E 1C10 C        			RETL @0X10    ;(16)
   637 00F7F 1C81 C        			RETL @0X81    ;INPUT
   638 00F80 1C02 C        			RETL @0X02    ;(Data Ary,Abs)
   639            C        		;}
   640            C        		;{Hat Switch
   641 00F81 1C06 C        			RETL @0X06
   642 00F82 1C01 C        			RETL @0X01
   643 00F83 1C00 C        			RETL @0X00
   644 00F84 1C09 C        			RETL @0X09    ;USAGE
   645 00F85 1C39 C        			RETL @0X39    ;(Hat Switch)
   646 00F86 1C75 C        			RETL @0X75    ;REPORT_SIZE
   647 00F87 1C04 C        			RETL @0X04    ;(4)
   648 00F88 1C95 C        			RETL @0X95    ;REPORT_COUNT
   649 00F89 1C01 C        			RETL @0X01    ;(1)
   650 00F8A 1C25 C        			RETL @0X25    ;LOGICAL_MAX
   651 00F8B 1C07 C        			RETL @0X07    ;(7)
   652 00F8C 1C46 C        			RETL @0X46    ;PHYSICAL_MAX
   653 00F8D 1C3B C        			RETL @0X3B    ;(315)
   654 00F8E 1C01 C        			RETL @0X01
   655 00F8F 1C65 C        			RETL @0X65    ;UNIT
   656 00F90 1C14 C        			RETL @0X14    ;(Eng Rot:Angular Pos)
   657 00F91 1C81 C        			RETL @0X81    ;INPUT
   658 00F92 1C42 C        			RETL @0X42    ;(Data,Var,Abs,Null)
   659            C        		;}
   660            C        		;{Const
   661 00F93 1C65 C        			RETL @0X65    ;UNIT
   662 00F94 1C00 C        			RETL @0X00    ;(None)
   663 00F95 1C75 C        			RETL @0X75    ;REPORT_SIZE
   664 00F96 1C04 C        			RETL @0X04    ;(4)
   665 00F97 1C95 C        			RETL @0X95    ;REPORT_COUNT
   666 00F98 1C01 C        			RETL @0X01    ;(1)
   667 00F99 1C81 C        			RETL @0X81    ;INPUT
   668 00F9A 1C01 C        			RETL @0X01    ;(Const,Var,Abs)
   669 00F9B 1CC0 C        			RETL @0XC0    ;END COLLECTION
   670            C        		;}
   671            C        	;}
   672 00F9C 1CC0 C        	RETL @0XC0              ;78;END COLLECTION
   673            C        
   674 00F9D      C        	End_HID_Report_Table3:
   675            C        
   676            C        
   677            C        
    15            C        
    16            C        ifndef EM78CtrlIns.H
    17            C        include "EM78CtrlIns.H"
    18            C        endif
    19            C        
    20            C        ifndef M611rxP40M1v6V10.H
    21            C        include "M611rxP40M1v6V10.H"
    22            C        endif
    23            C        ;=========================================================================
    24            C        
    25            C        	ORG                 0X1150    ;PAGE 4
    26            C        ;***********************************************************************************
    27            C        ;**********************************************************************************
    28            C        ; USB Driver
    29            C        ;*********************************************************************************
    30            C        ;==============================================================================
    31            C        ;==============================================================================
    32            C        ; READ USB COMMAND ,HOST command
    33            C        ;==============================================================================
    34            C        
    35 01150      C        READ_COMMAND:
    36 01150 0C4C C        	JBC                 RC,EP0_BUSY           ;CHECK UDC BUSY OR NOT
    37 01151 1550 C        	JMP                 READ_COMMAND
    38 01152 0FCC C        	JBS                 RC,EP0_W              ;CHECK EP0 W HAVE DATA OR NOT
    39 01153 1550 C        	JMP                 READ_COMMAND
    40 01154 098C C        	BC                  RC,EP0_R              ;DISABLE UDC READ
    41            C        
    42 01155 1810 C        	MOV                 A,@0X10
    43 01156 004D C        	MOV                 RD,A
    44 01157 00CE C        	CLR                 RE                    ;RESET POINTER & COUNTER
    45 01158 00CD C        	CLR                 RD
    46            C        
    47 01159 040E C        	MOV                 A,RE
    48 0115A 0060 C        	MOV                 BYTE0,A
    49 0115B 040E C        	MOV                 A,RE
    50 0115C 0061 C        	MOV                 BYTE1,A
    51 0115D 040E C        	MOV                 A,RE
    52 0115E 0062 C        	MOV                 BYTE2,A
    53 0115F 040E C        	MOV                 A,RE
    54 01160 0063 C        	MOV                 BYTE3,A
    55 01161 040E C        	MOV                 A,RE
    56 01162 0064 C        	MOV                 BYTE4,A
    57 01163 040E C        	MOV                 A,RE
    58 01164 0065 C        	MOV                 BYTE5,A
    59 01165 040E C        	MOV                 A,RE
    60 01166 0066 C        	MOV                 BYTE6,A
    61 01167 040E C        	MOV                 A,RE
    62 01168 0067 C        	MOV                 BYTE7,A
    63 01169 1810 C        	MOV                 A,@0X10
    64 0116A 004D C        	MOV                 RD,A
    65 0116B 00CE C        	CLR                 RE                                             ;RESET POINTER & COUNTER
    66 0116C 00CD C        	CLR                 RD
    67 0116D 09CC C        	BC                  RC,EP0_W                                       ;CLEAR EP0_W
    68 0116E 08DC C        	BC                  SetupDataStageFlag/16,SetupDataStageFlag%16    ;REFRESH EP0_REPORT COMMAND
    69 0116F 09DC C        	BC                  UsbEP0interruptflag/16,UsbEP0interruptflag%16
    70            C        	;CLR                 TRANSFER
    71            C        
    72            C        ;=========================================================
    73            C        ;USB COMMAND DECODE:
    74            C        ;	|
    75            C        ;	|---STANDARD_DEVICE_REQUESTS
    76            C        ;	|	|
    77            C        ;	|	|---GET_DESCRIPTOR
    78            C        ;	|		|
    79            C        ;	|		|---STANDARD_DESCRIPTOR_TYPE
    80            C        ;	|		|	|
    81            C        ;	|		|	|---GET_DEVICE_D
    82            C        ;	|		|	|---GET_CONFIGURATION_D
    83            C        ;	|		|	|---GET_STRING_D
    84            C        ;	|		|
    85            C        ;	|		|---CLASS_DESCRIPTOR_TYPE
    86            C        ;	|			|
    87            C        ;	|			|---GET_HID_D
    88            C        ;	|			|---GET_REPORT_D
    89            C        ;	|
    90            C        ;	|---CLASS_SPECIFIC_REQUESTS
    91            C        ;		|
    92            C        ;		|---HID_SET_REQUEST
    93            C        ;		|	|
    94            C        ;		|	|---SET_REPORT_R
    95            C        ;		|	|---SET_IDLE_R
    96            C        ;		|	|---SET_PROTOCOL_R
    97            C        ;		|
    98            C        ;		|---HID_GET_REQUEST
    99            C        ;			|
   100            C        ;			|---GET_REPORT_R
   101            C        ;			|---GET_IDLE_R
   102            C        ;			|---GET_PROTOCOL_R
   103            C        ;=========================================================
   104 01170      C        DECODE:
   105 01170 0420 C        	MOV                 A,BYTE0				        ;bmRequestType
   106 01171 1A60 C        	AND                 A,@0B01100000
   107 01172 0C83 C        	JBC                 STATUS,Z
   108 01173 1578 C        	JMP                 STANDARD_DEVICE_REQUESTS	;bmRequestType[6,5]=[0,0]
   109 01174 1B20 C        	XOR                 A,@0B00100000
   110 01175 0C83 C        	JBC                 STATUS,Z
   111 01176 15D5 C        	JMP                 CLASS_SPECIFIC_REQUESTS		;bmRequestType[6,5]=[0,1]    [0,1]
   112 01177 1597 C        	JMP                 STALL_STATUS				;bmRequestType[6,5]=[1,0] OR [1,1]
   113            C        
   114 01178      C        STANDARD_DEVICE_REQUESTS:
   115 01178 1806 C        	MOV                 A,@0B00000110                  ;0X06
   116 01179 0321 C        	XOR                 A,BYTE1				        ;bRequest (Request Code)
   117 0117A 0C83 C        	JBC                 STATUS,Z
   118 0117B 157D C        	JMP                 GET_DESCRIPTOR
   119 0117C 1597 C        	JMP                 STALL_STATUS
   120 0117D      C          GET_DESCRIPTOR:
   121 0117D 00D8 C        	CLR                 TABLE_INDEX
   122 0117E 0423 C        	MOV                 A,BYTE3				        ;wValue (Descriptor Type)
   123 0117F 1A60 C        	AND                 A,@0B01100000
   124 01180 0C83 C        	JBC                 STATUS,Z
   125 01181 1586 C        	JMP                 STANDARD_DESCRIPTOR_TYPE	;wValue[6,5]=[0,0]
   126 01182 1B20 C        	XOR                 A,@0B00100000
   127 01183 0C83 C        	JBC                 STATUS,Z
   128 01184 158F C        	JMP                 CLASS_DESCRIPTOR_TYPE		;wValue[6,5]=[0,1]
   129 01185 1597 C        	JMP                 STALL_STATUS				;wValue[6,5]=[1,0] OR [1,1]
   130            C        
   131 01186      C          STANDARD_DESCRIPTOR_TYPE:
   132 01186 0423 C        	MOV                 A,BYTE3
   133 01187 1D03 C        	SUB                 A,@0X03
   134 01188 0E03 C        	JBS                 STATUS,C
   135 01189 1597 C        	JMP                 STALL_STATUS
   136            C        
   137 0118A 0020 C        	TBL
   138 0118B 15BD C        	JMP                 STRING_SET          ;	3
   139 0118C 15A2 C        	JMP                 CONFIG_SET          ;	2
   140 0118D 159B C        	JMP                 DEVICE_SET          ;	1
   141 0118E 1597 C        	JMP                 STALL_STATUS        ;	0
   142            C        
   143 0118F      C          CLASS_DESCRIPTOR_TYPE:
   144 0118F 1821 C        	MOV                 A,@0X21
   145 01190 0323 C        	XOR                 A,BYTE3
   146 01191 0C83 C        	JBC                 STATUS,2
   147 01192 15AA C        	JMP                 HID_SET             ; GET HID
   148            C        
   149 01193 1822 C        	MOV                 A,@0X22
   150 01194 0323 C        	XOR                 A,BYTE3
   151 01195 0C83 C        	JBC                 STATUS,2
   152 01196 15B4 C        	JMP                 HID_REPORT_SET      ; GET REPORT
   153            C        
   154 01197      C          STALL_STATUS:
   155 01197 0A0C C        	BS                  RC,0
   156 01198 09CC C        	BC                  RC,7
   157 01199 084F C        	BC                  ISR,EP0IF
   158 0119A 160C C        	JMP                 BC_EP0_FLAG
   159            C        ;----------------------------
   160            C        ;	GET DESCRIPTOR
   161            C        ;----------------------------
   162 0119B      C          DEVICE_SET:
   163 0119B 00D3 C        	CLR                 CMD_SELECT
   164 0119C 1812 C        	MOV                 A,@0X12
   165 0119D 007D C        	MOV                 DataMaxTable1,A
   166 0119E 00FE C        	CLR                 DataMaxTable2
   167 0119F 00FF C        	CLR                 DataMaxTable3
   168 011A0 12D1 C        	CALL                Set_Table1_Select
   169 011A1 15CF C        	JMP                 END_DESCRIPTOR
   170            C        
   171 011A2      C          CONFIG_SET:
   172 011A2 1801 C        	MOV                 A,@0X01
   173 011A3 0053 C        	MOV                 CMD_SELECT,A
   174 011A4 1822 C        	MOV                 A,@0X22
   175 011A5 007D C        	MOV                 DataMaxTable1,A
   176 011A6 00FE C        	CLR                 DataMaxTable2
   177 011A7 00FF C        	CLR                 DataMaxTable3
   178 011A8 12D1 C        	CALL                Set_Table1_Select
   179 011A9 15CF C        	JMP                 END_DESCRIPTOR
   180            C        
   181 011AA      C          HID_SET:
   182 011AA 1801 C        	MOV                 A,@0X01
   183 011AB 0053 C        	MOV                 CMD_SELECT,A
   184 011AC 1812 C        	MOV                 A,@0X12
   185 011AD 0058 C        	MOV                 TABLE_INDEX,A
   186 011AE 1809 C        	MOV                 A,@0X09
   187 011AF 007D C        	MOV                 DataMaxTable1,A
   188 011B0 00FE C        	CLR                 DataMaxTable2
   189 011B1 00FF C        	CLR                 DataMaxTable3
   190 011B2 12D1 C        	CALL                Set_Table1_Select
   191 011B3 15CF C        	JMP                 END_DESCRIPTOR
   192            C        
   193 011B4      C          HID_REPORT_SET:
   194 011B4 1802 C        	MOV                 A,@0X02
   195 011B5 0053 C        	MOV                 CMD_SELECT,A
   196 011B6 189C C        	MOV                 A,@(End_HID_Report_Table1-Begin_HID_Report_Table1)
   197 011B7 007D C        	MOV                 DataMaxTable1,A
   198 011B8 189C C        	MOV                 A,@(End_HID_Report_Table2-Begin_HID_Report_Table2)
   199 011B9 007E C        	MOV                 DataMaxTable2,A
   200 011BA 189C C        	MOV                 A,@(End_HID_Report_Table3-Begin_HID_Report_Table3)
   201 011BB 007F C        	MOV                 DataMaxTable3,A
   202 011BC 15CF C        	JMP                 END_DESCRIPTOR
   203            C        
   204 011BD      C          STRING_SET:
   205 011BD 1800 C        	MOV                 A,@0X00
   206 011BE 0322 C        	XOR                 A,BYTE2
   207 011BF 0C83 C        	JBC                 STATUS,2
   208 011C0 15C5 C        	JMP                 STRING0
   209            C        
   210 011C1 1802 C        	MOV                 A,@0X02
   211 011C2 0322 C        	XOR                 A,BYTE2
   212 011C3 0C83 C        	JBC                 STATUS,2
   213 011C4 15CA C        	JMP                 STRING2
   214 011C5      C          STRING0:
   215 011C5 1806 C        	MOV                 A,@0X06
   216 011C6 0053 C        	MOV                 CMD_SELECT,A
   217 011C7 1804 C        	MOV                 A,@0X04
   218 011C8 007D C        	MOV                 DataMaxTable1,A
   219 011C9 15CF C        	JMP                 END_DESCRIPTOR
   220            C        
   221 011CA      C          STRING2:
   222 011CA 1807 C        	MOV                 A,@0X07
   223 011CB 0053 C        	MOV                 CMD_SELECT,A
   224 011CC 181E C        	MOV                 A,@0X1E
   225 011CD 007D C        	MOV                 DataMaxTable1,A
   226 011CE 15CF C        	JMP                 END_DESCRIPTOR
   227            C        
   228 011CF      C          END_DESCRIPTOR:
   229 011CF 0426 C        	MOV                 A,BYTE6
   230 011D0 007B C        	MOV                 PC_WANT0,A
   231 011D1 0427 C        	MOV                 A,BYTE7
   232 011D2 007C C        	MOV                 PC_WANT1,A
   233 011D3 0ADC C        	BS                  SetupDataStageFlag/16,SetupDataStageFlag%16
   234 011D4 160C C        	JMP                 BC_EP0_FLAG
   235            C        
   236            C        ;------------------------------------------
   237            C        ;	HID_CLASS_SPECIFIC_REQUESTS
   238            C        ;------------------------------------------
   239 011D5      C        CLASS_SPECIFIC_REQUESTS:
   240 011D5 1821 C        	MOV                 A,@0X21
   241 011D6 0320 C        	XOR                 A,BYTE0
   242 011D7 0C83 C        	JBC                 STATUS,Z
   243 011D8 15DE C        	JMP                 HID_SET_REQUEST
   244            C        
   245 011D9 18A1 C        	MOV                 A,@0XA1
   246 011DA 0320 C        	XOR                 A,BYTE0
   247 011DB 0C83 C        	JBC                 STATUS,Z
   248 011DC 15F8 C        	JMP                 HID_GET_REQUEST
   249 011DD 1597 C        	JMP                 STALL_STATUS
   250            C        
   251 011DE      C          HID_SET_REQUEST:
   252 011DE 1809 C        	MOV                 A,@0X09
   253 011DF 0321 C        	XOR                 A,BYTE1
   254 011E0 0C83 C        	JBC                 STATUS,Z
   255 011E1 15EB C        	JMP                 SET_REPORT
   256            C        
   257 011E2 180A C        	MOV                 A,@0X0A
   258 011E3 0321 C        	XOR                 A,BYTE1
   259 011E4 0C83 C        	JBC                 STATUS,Z
   260 011E5 15EC C        	JMP                 SET_IDLE
   261            C        
   262 011E6 180B C        	MOV                 A,@0X0B
   263 011E7 0321 C        	XOR                 A,BYTE1
   264 011E8 0C83 C        	JBC                 STATUS,Z
   265 011E9 15EF C        	JMP                 SET_PROTOCOL
   266 011EA 1597 C        	JMP                 STALL_STATUS
   267            C        
   268 011EB      C          SET_REPORT:
   269 011EB 15F1 C        	JMP                 SET_RET
   270 011EC      C          SET_IDLE:
   271 011EC 0423 C        	MOV                 A,BYTE3
   272 011ED 007A C        	MOV                 IDLE_TEMP,A
   273 011EE 15F1 C        	JMP                 SET_RET
   274 011EF      C          SET_PROTOCOL:
   275 011EF 0422 C        	MOV                 A,BYTE2
   276 011F0 0079 C        	MOV                 PROTOCOL_TEMP,A
   277 011F1      C          SET_RET:
   278 011F1 00D8 C        	CLR                 TABLE_INDEX
   279 011F2 00FD C        	CLR                 DataMaxTable1
   280 011F3 00FB C        	CLR                 PC_WANT0
   281 011F4 00FC C        	CLR                 PC_WANT1
   282 011F5 0ADC C        	BS                  SetupDataStageFlag/16,SetupDataStageFlag%16
   283 011F6 0080 C        	CLRA
   284 011F7 160C C        	JMP                 BC_EP0_FLAG
   285            C        
   286 011F8      C          HID_GET_REQUEST:
   287 011F8 0421 C        	MOV                 A,BYTE1
   288 011F9 1D03 C        	SUB                 A,@0X03
   289 011FA 0E03 C        	JBS                 STATUS,C
   290 011FB 1597 C        	JMP                 STALL_STATUS
   291 011FC 0020 C        	TBL
   292 011FD 1604 C        	JMP                 GET_PROTOCOL     ; BYTE1 = 0X03
   293 011FE 1601 C        	JMP                 GET_IDLE         ; BYTE1 = 0X02
   294 011FF 1607 C        	JMP                 GET_REPORT       ; BYTE1 = 0X01
   295 01200 1597 C        	JMP                 STALL_STATUS
   296            C        
   297 01201      C          GET_IDLE:
   298 01201 1803 C        	MOV                 A,@0X03
   299 01202 0053 C        	MOV                 CMD_SELECT,A
   300 01203 1609 C        	JMP                 GET_RET
   301 01204      C          GET_PROTOCOL:
   302 01204 1804 C        	MOV                 A,@0X04
   303 01205 0053 C        	MOV                 CMD_SELECT,A
   304 01206 1609 C        	JMP                 GET_RET
   305 01207      C          GET_REPORT:
   306 01207 1805 C        	MOV                 A,@0X05
   307 01208 0053 C        	MOV                 CMD_SELECT,A
   308 01209      C          GET_RET:
   309 01209 1801 C        	MOV                 A,@0X01
   310 0120A 007D C        	MOV                 DataMaxTable1,A
   311 0120B 15CF C        	JMP                 END_DESCRIPTOR
   312            C        
   313 0120C      C          BC_EP0_FLAG:
   314 0120C 084F C        	BC                  ISR,EP0IF
   315            C      M 	PAGE                0
       0120D 09C3     1     BC  3 , 7 
       0120E 0983     1     BC  3 , 6 
       0120F 0943     1     BC  3 , 5 
   316 01210 146B C        	JMP                 INT_RET
   317            C        
   318            C        
   319            C        ;===================================================================================
   320            C        ;===================================================================================
   321 01211      C        EP0_REPORT:
   322 01211 0BCC C        	BS                  RC,EP0_W          ;Set 1, when MCU will write data to FIFO
   323 01212 0E4C C        	JBS                 RC,EP0_BUSY       ;It is '1' while UDC write/read endpoint0 FIFO
   324 01213 1616 C        	JMP                 REPORT_INITIAL
   325 01214 09CC C        	BC                  RC,EP0_W          ;if EP0 busy go back main loop wait for udc non-busy
   326 01215 0012 C        	RET
   327 01216      C          REPORT_INITIAL:	                   ;clear pointer and counter
   328 01216 1810 C        	MOV                 A,@0X10
   329 01217 004D C        	MOV                 RD,A       ;set to control pointer & counter
   330 01218 00CE C        	CLR                 RE         ;clear pointer & counter
   331 01219 00CD C        	CLR                 RD         ; FIFO adress=base
   332 0121A      C          REPORT_START:
   333 0121A 047D C        	MOV                 DataMaxTable1,DataMaxTable1
   334 0121B 0E83 C        	JBS                 STATUS,Z
   335 0121C 1623 C        	JMP                 Load_FIFO_ByteLength	    ;if DataMaxTable1/2/3 = 0  jmp to finish
   336 0121D 047E C        	MOV                 DataMaxTable2,DataMaxTable2
   337 0121E 0E83 C        	JBS                 STATUS,Z
   338 0121F 1623 C        	JMP                 Load_FIFO_ByteLength
   339 01220 047F C        	MOV                 DataMaxTable3,DataMaxTable3
   340 01221 0C83 C        	JBC                 STATUS,Z
   341 01222 16E9 C        	JMP                 FINISH
   342            C        
   343 01223      C          Load_FIFO_ByteLength:
   344 01223 1808 C        	MOV                 A,@0X08
   345 01224 005A C        	MOV                 DataByteLength,A
   346            C        	;CLR                 RE
   347 01225 00CD C        	CLR                 RD
   348 01226      C          REPORT_LOOP:
   349 01226 0413 C        	MOV                 A,CMD_SELECT
   350 01227 0020 C        	TBL
   351 01228 1630 C        	JMP                 DEVICE_LOOP	;0
   352 01229 1639 C        	JMP                 CONFIG_LOOP	;1
   353 0122A 1642 C        	JMP                 HID_REPORTL	;2
   354 0122B 1663 C        	JMP                 IDLE_LOOP	;3
   355 0122C 1665 C        	JMP                 PROTOCOLL	;4
   356 0122D 1667 C        	JMP                 REPORT_EP0	;5
   357 0122E 166E C        	JMP                 STRING0L	;6
   358            C        	;JMP                 STRING1L    ;7
   359 0122F 1677 C        	JMP                 STRING2L	;8
   360            C        
   361            C        ;-------------------------------------------------------------
   362 01230      C          DEVICE_LOOP:
   363 01230 0418 C        	MOV                 A,TABLE_INDEX
   364            C      M 	PAGE                3
       01231 09C3     1     BC  3 , 7 
       01232 0B83     1     BS  3 , 6 
       01233 0B43     1     BS  3 , 5 
   365 01234 1000 C        	CALL                DEVICE_TABLE
   366            C      M 	PAGE                4
       01235 0BC3     1     BS  3 , 7 
       01236 0983     1     BC  3 , 6 
       01237 0943     1     BC  3 , 5 
   367 01238 1682 C        	JMP                 RLOOP
   368            C        ;-------------------------------------------------------------
   369 01239      C          CONFIG_LOOP:
   370 01239 0418 C        	MOV                 A,TABLE_INDEX
   371            C      M 	PAGE                3
       0123A 09C3     1     BC  3 , 7 
       0123B 0B83     1     BS  3 , 6 
       0123C 0B43     1     BS  3 , 5 
   372 0123D 1013 C        	CALL                CONFIG_TABLE
   373            C      M 	PAGE                4
       0123E 0BC3     1     BS  3 , 7 
       0123F 0983     1     BC  3 , 6 
       01240 0943     1     BC  3 , 5 
   374 01241 1682 C        	JMP                 RLOOP
   375            C        ;-------------------------------------------------------------
   376 01242      C          HID_REPORTL:
   377 01242 0D1C C        	JBC                 TableSelectFlag1/16,TableSelectFlag1%16
   378 01243 1648 C        	JMP                 HID_Table_1st
   379 01244 0D5C C        	JBC                 TableSelectFlag2/16,TableSelectFlag2%16
   380 01245 1651 C        	JMP                 HID_Table_2nd
   381 01246 0D9C C        	JBC                 TableSelectFlag3/16,TableSelectFlag3%16
   382 01247 165A C        	JMP                 HID_Table_3rd
   383            C        
   384 01248      C          HID_Table_1st:
   385 01248 0418 C        	MOV                 A,TABLE_INDEX
   386            C      M 	PAGE                3
       01249 09C3     1     BC  3 , 7 
       0124A 0B83     1     BS  3 , 6 
       0124B 0B43     1     BS  3 , 5 
   387 0124C 1100 C        	CALL                HID_REPORT_TABLE1
   388            C      M 	PAGE                4
       0124D 0BC3     1     BS  3 , 7 
       0124E 0983     1     BC  3 , 6 
       0124F 0943     1     BC  3 , 5 
   389 01250 1682 C        	JMP                 RLOOP
   390 01251      C          HID_Table_2nd:
   391 01251 0418 C        	MOV                 A,TABLE_INDEX
   392            C      M 	PAGE                3
       01252 09C3     1     BC  3 , 7 
       01253 0B83     1     BS  3 , 6 
       01254 0B43     1     BS  3 , 5 
   393 01255 1200 C        	CALL                HID_REPORT_TABLE2
   394            C      M 	PAGE                4
       01256 0BC3     1     BS  3 , 7 
       01257 0983     1     BC  3 , 6 
       01258 0943     1     BC  3 , 5 
   395 01259 1682 C        	JMP                 RLOOP
   396 0125A      C          HID_Table_3rd:
   397 0125A 0418 C        	MOV                 A,TABLE_INDEX
   398            C      M 	PAGE                3
       0125B 09C3     1     BC  3 , 7 
       0125C 0B83     1     BS  3 , 6 
       0125D 0B43     1     BS  3 , 5 
   399 0125E 1300 C        	CALL                HID_REPORT_TABLE3
   400            C      M 	PAGE                4
       0125F 0BC3     1     BS  3 , 7 
       01260 0983     1     BC  3 , 6 
       01261 0943     1     BC  3 , 5 
   401 01262 1682 C        	JMP                 RLOOP
   402            C        ;--------------------------------------------------------------
   403 01263      C          IDLE_LOOP:
   404 01263 043A C        	MOV                 A,IDLE_TEMP
   405 01264 1682 C        	JMP                 RLOOP
   406            C        ;---------------------------------------------------------------
   407 01265      C          PROTOCOLL:
   408 01265 0439 C        	MOV                 A,PROTOCOL_TEMP
   409 01266 1682 C        	JMP                 RLOOP
   410            C        ;---------------------------------------------------------------
   411 01267      C          REPORT_EP0:
   412 01267 1810 C        	MOV                 A,@0X10
   413 01268 004D C        	MOV                 RD,A		;EP0 POINTER&COUNTER
   414 01269 00CE C        	CLR                 RE
   415 0126A 1800 C        	MOV                 A,@0X00
   416 0126B 004D C        	MOV                 RD,A		;EP0 FIFO
   417 0126C 12ED C        	CALL                SEND_USB_DATA
   418 0126D 16E9 C        	JMP                 FINISH
   419            C        ;---------------------------------------------------------------
   420 0126E      C          STRING0L:
   421 0126E 0418 C        	MOV                 A,TABLE_INDEX
   422            C      M 	PAGE                3
       0126F 09C3     1     BC  3 , 7 
       01270 0B83     1     BS  3 , 6 
       01271 0B43     1     BS  3 , 5 
   423 01272 1036 C        	CALL                STRING0T
   424            C      M 	PAGE                4
       01273 0BC3     1     BS  3 , 7 
       01274 0983     1     BC  3 , 6 
       01275 0943     1     BC  3 , 5 
   425 01276 1682 C        	JMP                 RLOOP
   426            C        
   427            C        ;STRING1L:
   428            C        ;	CALL                STRING_SUB
   429            C        ;	CALL                STRING1T
   430            C        ;	JMP                 RLOOP
   431            C        
   432 01277      C          STRING2L:
   433 01277 1279 C        	CALL                STRING_SUB
   434 01278 1682 C        	JMP                 RLOOP
   435            C        
   436 01279      C          STRING_SUB:
   437 01279 0418 C        	MOV                 A,TABLE_INDEX
   438 0127A 1D01 C        	SUB	                A,@0X01
   439 0127B 0C03 C        	JBC                 STATUS,C
   440 0127C 0012 C        	RET
   441 0127D 0C18 C        	JBC                 TABLE_INDEX,0
   442 0127E 1C02 C        	RETL                @0X02
   443 0127F 0618 C        	RRCA                TABLE_INDEX
   444 01280 1F02 C        	ADD                 A,@0X02
   445 01281 0012 C        	RET
   446            C        
   447            C        ;***************************************************************
   448            C        ;***************************************************************
   449 01282      C        RLOOP:
   450 01282 004E C        	MOV                 RE,A
   451 01283 0558 C        	INC                 TABLE_INDEX
   452 01284 01FB C        	DEC                 PC_WANT0
   453 01285 047B C        	MOV                 PC_WANT0,PC_WANT0
   454 01286 0C83 C        	JBC                 STATUS,Z
   455 01287 16BE C        	JMP                 Null_Data                 ;PC_WANT0 null data
   456            C        
   457 01288      C          To_Continue:
   458 01288 047F C        	MOV                 DataMaxTable3,DataMaxTable3
   459 01289 0E83 C        	JBS                 STATUS,Z
   460 0128A 1691 C        	JMP                 Continue_Fill_In_8Byte
   461 0128B 047E C        	MOV                 DataMaxTable2,DataMaxTable2
   462 0128C 0E83 C        	JBS                 STATUS,Z
   463 0128D 1691 C        	JMP                 Continue_Fill_In_8Byte
   464 0128E 047D C        	MOV                 DataMaxTable1,DataMaxTable1
   465 0128F 0C83 C        	JBC                 STATUS,Z
   466 01290 16E9 C        	JMP                 FINISH
   467            C        
   468 01291      C          Continue_Fill_In_8Byte:
   469 01291 05DA C        	DJZ                 DataByteLength
   470 01292 169B C        	JMP                 Fill_In_8Byte_Cycle
   471            C        
   472 01293 0D9C C        	JBC                 TableSelectFlag3/16,TableSelectFlag3%16
   473 01294 01FF C        	DEC                 DataMaxTable3
   474 01295 0D5C C        	JBC                 TableSelectFlag2/16,TableSelectFlag2%16
   475 01296 01FE C        	DEC                 DataMaxTable2
   476 01297 0D1C C        	JBC                 TableSelectFlag1/16,TableSelectFlag1%16
   477 01298 01FD C        	DEC                 DataMaxTable1
   478 01299 12C7 C        	CALL                Set_Table_Select
   479 0129A 16C3 C        	JMP                 END_Fill_In_8Byte_Cycle   ;8 byte full , End this cycle
   480            C        
   481 0129B      C          Fill_In_8Byte_Cycle:
   482 0129B 0D9C C        	JBC                 TableSelectFlag3/16,TableSelectFlag3%16
   483 0129C 01FF C        	DEC                 DataMaxTable3
   484 0129D 0D5C C        	JBC                 TableSelectFlag2/16,TableSelectFlag2%16
   485 0129E 01FE C        	DEC                 DataMaxTable2
   486 0129F 0D1C C        	JBC                 TableSelectFlag1/16,TableSelectFlag1%16
   487 012A0 01FD C        	DEC                 DataMaxTable1
   488 012A1 12C7 C        	CALL                Set_Table_Select
   489 012A2 047F C        	MOV                 DataMaxTable3,DataMaxTable3
   490 012A3 0E83 C        	JBS                 STATUS,Z
   491 012A4 16AC C        	JMP                 HID_NOT_END
   492 012A5 047E C        	MOV                 DataMaxTable2,DataMaxTable2
   493 012A6 0E83 C        	JBS                 STATUS,Z
   494 012A7 16AC C        	JMP                 HID_NOT_END
   495 012A8 047D C        	MOV                 DataMaxTable1,DataMaxTable1
   496 012A9 0E83 C        	JBS                 STATUS,Z
   497 012AA 16AC C        	JMP                 HID_NOT_END
   498 012AB 16C3 C        	JMP                 END_Fill_In_8Byte_Cycle
   499 012AC      C          HID_NOT_END:
   500 012AC 0D1C C        	JBC                 TableSelectFlag1/16,TableSelectFlag1%16
   501 012AD 16B2 C        	JMP                 Table1_Sel
   502 012AE 0D5C C        	JBC                 TableSelectFlag2/16,TableSelectFlag2%16
   503 012AF 16B6 C        	JMP                 Table2_Sel
   504 012B0 0D9C C        	JBC                 TableSelectFlag3/16,TableSelectFlag3%16
   505 012B1 16BA C        	JMP                 Table3_Sel
   506 012B2      C          Table1_Sel:
   507            C        	;DEC                 DataMaxTable1
   508 012B2 047D C        	MOV                 DataMaxTable1,DataMaxTable1
   509 012B3 0C83 C        	JBC                 STATUS,Z
   510 012B4 16E9 C        	JMP                 FINISH
   511 012B5 1626 C        	JMP                 REPORT_LOOP
   512 012B6      C          Table2_Sel:
   513            C        	;DEC                 DataMaxTable2
   514 012B6 047E C        	MOV                 DataMaxTable2,DataMaxTable2
   515 012B7 0C83 C        	JBC                 STATUS,Z
   516 012B8 16E9 C        	JMP                 FINISH
   517 012B9 1626 C        	JMP                 REPORT_LOOP
   518 012BA      C          Table3_Sel:
   519            C        	;DEC                 DataMaxTable3
   520 012BA 047F C        	MOV                 DataMaxTable3,DataMaxTable3
   521 012BB 0C83 C        	JBC                 STATUS,Z
   522 012BC 16E9 C        	JMP                 FINISH
   523 012BD 1626 C        	JMP                 REPORT_LOOP
   524            C        
   525 012BE      C          Null_Data:
   526 012BE 043C C        	MOV                 A,PC_WANT1
   527 012BF 0C83 C        	JBC                 STATUS,Z
   528 012C0 16E9 C        	JMP                 FINISH
   529 012C1 01FC C        	DEC                 PC_WANT1
   530 012C2 1688 C        	JMP                 To_Continue
   531            C        
   532 012C3      C          END_Fill_In_8Byte_Cycle:
   533 012C3 0000 C        	NOP
   534 012C4 09CC C        	BC                  RC,7
   535 012C5 0B8C C        	BS                  RC,6
   536 012C6 0012 C        	RET
   537            C        
   538 012C7      C          Set_Table_Select:
   539 012C7 047F C        	MOV                 DataMaxTable3,DataMaxTable3
   540 012C8 0E83 C        	JBS                 STATUS,Z
   541 012C9 12E1 C        	CALL                Set_Table3_Select
   542 012CA 047E C        	MOV                 DataMaxTable2,DataMaxTable2
   543 012CB 0E83 C        	JBS                 STATUS,Z
   544 012CC 12D9 C        	CALL                Set_Table2_Select
   545 012CD 047D C        	MOV                 DataMaxTable1,DataMaxTable1
   546 012CE 0E83 C        	JBS                 STATUS,Z
   547 012CF 12D1 C        	CALL                Set_Table1_Select
   548 012D0 0012 C        	RET
   549 012D1      C          Set_Table1_Select:
   550 012D1 0B1C C        	BS                  TableSelectFlag1/16,TableSelectFlag1%16
   551 012D2 095C C        	BC                  TableSelectFlag2/16,TableSelectFlag2%16
   552 012D3 099C C        	BC                  TableSelectFlag3/16,TableSelectFlag3%16
   553 012D4 0418 C        	MOV                 A,TABLE_INDEX         ;table max mustn't at 8*N,or it will error
   554 012D5 1B9C C        	XOR                 A,@(End_HID_Report_Table3-Begin_HID_Report_Table3)
   555 012D6 0C83 C        	JBC                 STATUS,Z
   556 012D7 00D8 C        	CLR                 TABLE_INDEX
   557 012D8 0012 C        	RET
   558 012D9      C          Set_Table2_Select:
   559 012D9 091C C        	BC                  TableSelectFlag1/16,TableSelectFlag1%16
   560 012DA 0B5C C        	BS                  TableSelectFlag2/16,TableSelectFlag2%16
   561 012DB 099C C        	BC                  TableSelectFlag3/16,TableSelectFlag3%16
   562 012DC 0418 C        	MOV                 A,TABLE_INDEX         ;table max mustn't at 8*N,or it will error
   563 012DD 1B9C C        	XOR                 A,@(End_HID_Report_Table3-Begin_HID_Report_Table3)
   564 012DE 0C83 C        	JBC                 STATUS,Z
   565 012DF 00D8 C        	CLR                 TABLE_INDEX
   566 012E0 0012 C        	RET
   567 012E1      C          Set_Table3_Select:
   568 012E1 091C C        	BC                  TableSelectFlag1/16,TableSelectFlag1%16
   569 012E2 095C C        	BC                  TableSelectFlag2/16,TableSelectFlag2%16
   570 012E3 0B9C C        	BS                  TableSelectFlag3/16,TableSelectFlag3%16
   571 012E4 0418 C        	MOV                 A,TABLE_INDEX         ;table max mustn't at 8*N,or it will error
   572 012E5 1B9C C        	XOR                 A,@(End_HID_Report_Table3-Begin_HID_Report_Table3)
   573 012E6 0C83 C        	JBC                 STATUS,Z
   574 012E7 00D8 C        	CLR                 TABLE_INDEX
   575 012E8 0012 C        	RET
   576            C        ;=========================================================
   577 012E9      C          FINISH:
   578 012E9 09CC C        	BC                  RC,7
   579 012EA 0B8C C        	BS                  RC,6
   580 012EB 08DC C        	BC                  SetupDataStageFlag/16,SetupDataStageFlag%16
   581 012EC 0012 C        	RET
   582            C        
   583            C        
   584            C        ;=================================================================
   585            C        ;	USB DATA FORMAT
   586            C        ;	BYTE1	BYTE2	BYTE3	BYTE4	BYTE5	BYTE6	BYTE7	BYTE8
   587            C        ;   BOOT	BTM	X_8	Y_8	--	--	--	--	--
   588            C        ;=================================================================
   589 012ED      C        SEND_USB_DATA:
   590 012ED 1801 C        	MOV                 A,@0X01
   591 012EE 004E C        	MOV                 RE,A			;BYTE1(BTM)
   592            C        
   593 012EF      C          REPORT_PROTOCOL_DATA:
   594 012EF 187F C        	MOV                 A,@0X7F
   595 012F0 004E C        	MOV                 RE,A			;BYTE2(X)
   596 012F1 004E C        	MOV                 RE,A			;BYTE3(Y)
   597 012F2 004E C        	MOV                 RE,A			;BYTE4
   598 012F3 004E C        	MOV                 RE,A			;BYTE5
   599 012F4 183F C        	MOV                 A,@0X3F
   600 012F5 004E C        	MOV                 RE,A			;BYTE6(X)
   601 012F6 1800 C        	MOV                 A,@0X00
   602 012F7 004E C        	MOV                 RE,A			;BYTE7(X)
   603 012F8 004E C        	MOV                 RE,A			;BYTE8(X)
   604            C        
   605 012F9 0C0D C        	JBC                 RD,0		;CHECK EP0 or EP1
   606 012FA 0B4C C        	BS                  RC,EP1_R
   607 012FB      C          RETURN:
   608 012FB 0012 C        	RET
   609            C        
   610            C        ;=================================================================================
   611            C        ;================================================================================
   612 012FC      C        USB_MAIN:
   613 012FC 0DDC C        	JBC                 UsbEP0interruptflag/16,UsbEP0interruptflag%16
   614 012FD 0012 C        	RET
   615 012FE 041B C        	MOV                 A,ComuClock    ;8ms
   616 012FF 1D40 C        	SUB                 A,@0X40
   617 01300 0C03 C        	JBC                 STATUS,C
   618 01301 170C C        	JMP                 Add_TimeCount
   619 01302 0550 C        	INC                 TEMP
   620 01303 00DB C        	CLR                 ComuClock
   621 01304 0410 C        	MOV                 A,TEMP
   622 01305 1D10 C        	SUB                 A,@0X10        ;T = 0x10*0X50*ComuClock
   623 01306 0C03 C        	JBC                 STATUS,C
   624 01307 170C C        	JMP                 Add_TimeCount
   625 01308 0000 C        	NOP
   626 01309 00D0 C        	CLR                 TEMP
   627 0130A 0BDC C        	BS                  UsbEP0interruptflag/16,UsbEP0interruptflag%16
   628 0130B 0012 C        	RET
   629 0130C      C         Add_TimeCount:
   630 0130C 0000 C        	NOP
   631 0130D 10E0 C        	CALL                PAGE4BANK0
   632 0130E 0D8C C        	JBC                 RC,EP0_R       ;EP0 FIFO READED ；it is auto clear by udc and data send out finish
   633 0130F 16FC C        	JMP                 USB_MAIN
   634 01310 0CDC C        	JBC                 SetupDataStageFlag/16,SetupDataStageFlag%16    ;CHECK SETUP TRANSFER DATA STAGE
   635 01311 1211 C        	CALL                EP0_REPORT
   636 01312 0000 C        	NOP
   637 01313 16FC C        	JMP                 USB_MAIN
   638            C        
   639            C        
   640            C        
   641            C        
   642            C        ;===================================================================================
   643            C        ; ipnut data
   644            C        ;=================================================================================
   645            C        
   646            C        
   647            C        
   648            C        
   649            C        ;============================ Digital MODE=================================
   650 01314      C        EP1_Report_1st:
   651            C        ;--------------------------------------------------------------------
   652 01314 10E6 C        	CALL                PAGE4BANK2
   653 01315 0D4C C        	JBC                 RC,EP1_R         ;CHECK EP1 DATA HAS BEEN READED BY HOST
   654 01316 0012 C        	RET
   655 01317 094C C        	BC                  RC,EP1_R
   656 01318 1811 C        	MOV                 A,@0X11
   657 01319 004D C        	MOV                 RD,A		     ;EP1 POINTER&COUNTER
   658 0131A 00CE C        	CLR                 RE
   659 0131B 1801 C        	MOV                 A,@0X01
   660 0131C 004D C        	MOV                 RD,A             ;EP1 FIFO
   661            C        
   662 0131D 1801 C        	MOV                 A,@0X01
   663 0131E 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   664 0131F 0420 C        	MOV                 A,TX1_DATA1
   665 01320 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   666 01321 0421 C        	MOV                 A,TX1_DATA2
   667 01322 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   668 01323 0422 C        	MOV                 A,TX1_DATA3
   669 01324 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   670 01325 0423 C        	MOV                 A,TX1_DATA4
   671 01326 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   672 01327 0424 C        	MOV                 A,TX1_DATA5
   673 01328 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   674 01329 0425 C        	MOV                 A,TX1_DATA6
   675 0132A 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   676 0132B 0426 C        	MOV                 A,TX1_DATA7
   677 0132C 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   678            C        
   679 0132D 0B4C C        	BS                  RC,5
   680 0132E 0012 C        	RET
   681            C        
   682            C        ;------------------------------------------------------------------------
   683 0132F      C        EP1_Report_2nd:
   684 0132F 0000 C        	NOP
   685 01330 10E6 C        	CALL                PAGE4BANK2
   686 01331 0D4C C        	JBC                 RC,EP1_R    ;CHECK EP1 DATA HAS BEEN READED BY HOST
   687 01332 0012 C        	RET
   688 01333 094C C        	BC                  RC,EP1_R
   689 01334 1811 C        	MOV                 A,@0X11
   690 01335 004D C        	MOV                 RD,A		;EP1 POINTER&COUNTER
   691 01336 00CE C        	CLR                 RE
   692 01337 1801 C        	MOV                 A,@0X01
   693 01338 004D C        	MOV                 RD,A        ;EP1 FIFO
   694            C        
   695 01339 1802 C        	MOV                 A,@0X02
   696 0133A 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   697 0133B 0428 C        	MOV                 A,TX2_DATA1
   698 0133C 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   699 0133D 0429 C        	MOV                 A,TX2_DATA2
   700 0133E 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   701 0133F 042A C        	MOV                 A,TX2_DATA3
   702 01340 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   703 01341 042B C        	MOV                 A,TX2_DATA4
   704 01342 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   705 01343 042C C        	MOV                 A,TX2_DATA5
   706 01344 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   707 01345 042D C        	MOV                 A,TX2_DATA6
   708 01346 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   709 01347 042E C        	MOV                 A,TX2_DATA7
   710 01348 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   711            C        
   712 01349 0B4C C        	BS                  RC,5
   713 0134A 0012 C        	RET
   714            C        
   715            C        ;---------------------------------------------------------------------------
   716 0134B      C        EP1_Report_3rd:
   717 0134B 10E6 C        	CALL                PAGE4BANK2
   718 0134C 0D4C C        	JBC                 RC,EP1_R    ;CHECK EP1 DATA HAS BEEN READED BY HOST
   719 0134D 0012 C        	RET
   720 0134E 094C C        	BC                  RC,EP1_R
   721 0134F 1811 C        	MOV                 A,@0X11
   722 01350 004D C        	MOV                 RD,A		;EP1 POINTER&COUNTER
   723 01351 00CE C        	CLR                 RE
   724 01352 1801 C        	MOV                 A,@0X01
   725 01353 004D C        	MOV                 RD,A        ;EP1 FIFO
   726            C        
   727 01354 1803 C        	MOV                 A,@0X03
   728 01355 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   729 01356 0430 C        	MOV                 A,TX3_DATA1
   730 01357 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   731 01358 0431 C        	MOV                 A,TX3_DATA2
   732 01359 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   733 0135A 0432 C        	MOV                 A,TX3_DATA3
   734 0135B 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   735 0135C 0433 C        	MOV                 A,TX3_DATA4
   736 0135D 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   737 0135E 0434 C        	MOV                 A,TX3_DATA5
   738 0135F 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   739 01360 0435 C        	MOV                 A,TX3_DATA6
   740 01361 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   741 01362 0436 C        	MOV                 A,TX3_DATA7
   742 01363 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   743            C        
   744 01364 0B4C C        	BS                  RC,5
   745 01365 0012 C        	RET
   746            C        
   747            C        ;---------------------------------------------------------------------------
   748 01366      C        EP1_Report_4th:
   749 01366 10E6 C        	CALL                PAGE4BANK2
   750 01367 0D4C C        	JBC                 RC,EP1_R    ;CHECK EP1 DATA HAS BEEN READED BY HOST
   751 01368 0012 C        	RET
   752 01369 094C C        	BC                  RC,EP1_R
   753 0136A 1811 C        	MOV                 A,@0X11
   754 0136B 004D C        	MOV                 RD,A		;EP1 POINTER&COUNTER
   755 0136C 00CE C        	CLR                 RE
   756 0136D 1801 C        	MOV                 A,@0X01
   757 0136E 004D C        	MOV                 RD,A        ;EP1 FIFO
   758            C        
   759 0136F 1804 C        	MOV                 A,@0X04
   760 01370 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   761 01371 0438 C        	MOV                 A,TX4_DATA1
   762 01372 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   763 01373 0439 C        	MOV                 A,TX4_DATA2
   764 01374 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   765 01375 043A C        	MOV                 A,TX4_DATA3
   766 01376 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   767 01377 043B C        	MOV                 A,TX4_DATA4
   768 01378 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   769 01379 043C C        	MOV                 A,TX4_DATA5
   770 0137A 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   771 0137B 043D C        	MOV                 A,TX4_DATA6
   772 0137C 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   773 0137D 043E C        	MOV                 A,TX4_DATA7
   774 0137E 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   775            C        
   776 0137F 0B4C C        	BS                  RC,5
   777 01380 0012 C        	RET
   778            C        
   779            C        ;---------------------------------------------------------------------------
   780 01381      C        EP1_Report_5th:
   781 01381 10E9 C        	CALL                PAGE4BANK3
   782 01382 0D4C C        	JBC                 RC,EP1_R    ;CHECK EP1 DATA HAS BEEN READED BY HOST
   783 01383 0012 C        	RET
   784 01384 094C C        	BC                  RC,EP1_R
   785 01385 1811 C        	MOV                 A,@0X11
   786 01386 004D C        	MOV                 RD,A		;EP1 POINTER&COUNTER
   787 01387 00CE C        	CLR                 RE
   788 01388 1801 C        	MOV                 A,@0X01
   789 01389 004D C        	MOV                 RD,A        ;EP1 FIFO
   790            C        
   791 0138A 1805 C        	MOV                 A,@0X05
   792 0138B 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   793 0138C 0420 C        	MOV                 A,TX5_DATA1
   794 0138D 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   795 0138E 0421 C        	MOV                 A,TX5_DATA2
   796 0138F 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   797 01390 0422 C        	MOV                 A,TX5_DATA3
   798 01391 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   799 01392 0423 C        	MOV                 A,TX5_DATA4
   800 01393 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   801 01394 0424 C        	MOV                 A,TX5_DATA5
   802 01395 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   803 01396 0425 C        	MOV                 A,TX5_DATA6
   804 01397 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   805 01398 0426 C        	MOV                 A,TX5_DATA7
   806 01399 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   807            C        
   808 0139A 0B4C C        	BS                  RC,5
   809 0139B 0012 C        	RET
   810            C        
   811            C        ;---------------------------------------------------------------------------
   812 0139C      C        EP1_Report_6th:
   813 0139C 10E9 C        	CALL                PAGE4BANK3
   814 0139D 0D4C C        	JBC                 RC,EP1_R    ;CHECK EP1 DATA HAS BEEN READED BY HOST
   815 0139E 0012 C        	RET
   816 0139F 094C C        	BC                  RC,EP1_R
   817 013A0 1811 C        	MOV                 A,@0X11
   818 013A1 004D C        	MOV                 RD,A		;EP1 POINTER&COUNTER
   819 013A2 00CE C        	CLR                 RE
   820 013A3 1801 C        	MOV                 A,@0X01
   821 013A4 004D C        	MOV                 RD,A        ;EP1 FIFO
   822            C        
   823 013A5 1806 C        	MOV                 A,@0X06
   824 013A6 004E C        	MOV                 RE,A             ;BYTE1 (ID)
   825 013A7 0428 C        	MOV                 A,TX6_DATA1
   826 013A8 004E C        	MOV                 RE,A             ;BYTE2 (LX)
   827 013A9 0429 C        	MOV                 A,TX6_DATA2
   828 013AA 004E C        	MOV                 RE,A             ;BYTE3 (LY)
   829 013AB 042A C        	MOV                 A,TX6_DATA3
   830 013AC 004E C        	MOV                 RE,A             ;BYTE4 (RX)
   831 013AD 042B C        	MOV                 A,TX6_DATA4
   832 013AE 004E C        	MOV                 RE,A             ;BYTE5 (RY)
   833 013AF 042C C        	MOV                 A,TX6_DATA5
   834 013B0 004E C        	MOV                 RE,A             ;BYTE6 "A_1  B_2  C_3  D_4  L1_5  R1_6  L2_7  R2_8"
   835 013B1 042D C        	MOV                 A,TX6_DATA6
   836 013B2 004E C        	MOV                 RE,A             ;BYTE7 "SEL_9  START_10  LSW_11  RSW_12  T_13  T_14  MACRO   MODE"
   837 013B3 042E C        	MOV                 A,TX6_DATA7
   838 013B4 004E C        	MOV                 RE,A             ;BYTE8 (Hat Switch)
   839            C        
   840 013B5 0B4C C        	BS                  RC,5
   841 013B6 0012 C        	RET
   842            C        
    14            C        include "Keyscan.ASM"
     1            C        ;==================================================================
     2            C        ;  Tilte:       EM78M198810 include file		;
     3            C        ;  NAME:        EM198810_FOR_EM78M611.ASM
     4            C        ;  Description: The Definition of EM78M198810 for EM78612 Registers ;
     5            C        ;  Company:     Elan Electronic Corp.		;
     6            C        ;  Author:      YU.WEI				;
     7            C        ;  Date:        2009.02.26			;
     8            C        ;  Version:     v1.0				;
     9            C        ;  Tool:        wiceplus 2.7
    10            C        ;=========================================================================
    11            C        include "Keyscan.H"
     1            C        
    12            C        
    13            C        ifndef EM78CtrlIns.H
    14            C        include "EM78CtrlIns.H"
    15            C        endif
    16            C        ;=========================================================================
    17            C        
    18            C        
    19            C        	ORG                 0X1100 ;page 4
    20            C        ;**********************************************************************************
    21            C        ;*********************************************************************************
    22            C        ; Connect Key Scan
    23            C        ; Input:
    24            C        ; output: KEY_NUM
    25            C        ;         KeyScanStatusFlag
    26            C        ;*********************************************************************************
    27 01100      C        ConnectKey_Scan:
    28 01100 10E3 C        	CALL                PAGE4BANK1
    29 01101 0000 C        	NOP
    30 01102 0409 C        	MOV                 A,Port9                   ; Port9_2
    31 01103 1A04 C        	AND                 A,@00000100B
    32 01104 0050 C        	MOV                 TEMP,A
    33 01105 1804 C        	MOV                 A,@00000100B              ; Bit2
    34 01106 02F5 C        	AND                 KeystokeFlag_Befor,A
    35            C        
    36 01107      C        Falling_Edge_Judge:
    37 01107 0410 C        	MOV                 A,TEMP
    38 01108 0335 C        	XOR                 A,KeystokeFlag_Befor      ; bit 3, Check edge
    39 01109 0C83 C        	JBC                 STATUS,Z
    40 0110A 1515 C        	JMP                 Rising_Edge_Judge         ; no edge occur
    41 0110B 0410 C        	MOV                 A,TEMP                    ; Falling edge will change
    42 0110C 1B00 C        	XOR                 A,@00000000B
    43 0110D 0E83 C        	JBS                 STATUS,Z
    44 0110E 1515 C        	JMP                 Rising_Edge_Judge         ; no falling edge
    45 0110F 0F9F C        	JBS                 KeyScanStatusFlag/16,KeyScanStatusFlag%16        ; scan the first falling edge
    46 01110 0A37 C        	BS                  KEY_NUM,0                            ; Will into key scan, Set leader bit
    47 01111 00F6 C        	CLR                 KeystokeTimeCNT                      ; press times ,recalculate
    48 01112 095F C        	BC                  KeyStatusFlag/16,KeyStatusFlag%16    ; key status, press(0) or release(1)
    49 01113 0B9F C        	BS                  KeyScanStatusFlag/16,KeyScanStatusFlag%16	     ; into scan key status
    50 01114 1521 C        	JMP                 Edge_Judge_End
    51            C        
    52            C        ;--------------------------------------------------------------------
    53 01115      C        Rising_Edge_Judge:
    54 01115 0410 C        	MOV                 A,TEMP
    55 01116 0335 C        	XOR                 A,KeystokeFlag_Befor      ; bit 3, Check edge
    56 01117 0C83 C        	JBC                 STATUS,Z
    57 01118 1521 C        	JMP                 Edge_Judge_End
    58 01119 0410 C        	MOV                 A,TEMP                    ; rising edge will change
    59 0111A 1B04 C        	XOR                 A,@00000100B
    60 0111B 0E83 C        	JBS                 STATUS,Z
    61 0111C 1521 C        	JMP                 Edge_Judge_End
    62 0111D 0000 C        	NOP
    63 0111E 1130 C        	CALL                KeyStatus_Low_Scan        ; rising edge ,check low level time
    64 0111F 00F6 C        	CLR                 KeystokeTimeCNT           ; press times ,recalculate
    65 01120 0B5F C        	BS                  KeyStatusFlag/16,KeyStatusFlag%16
    66 01121      C        Edge_Judge_End:
    67 01121 0410 C        	MOV                 A,TEMP                    ; save currently press key status used for next judge
    68 01122 0075 C        	MOV                 KeystokeFlag_Befor,A
    69            C        
    70            C        ;------------------------------------------------------------------------------
    71 01123      C        KeystokeScan_End:                                                   ; a cycle scan end
    72 01123 0DF7 C        	JBC                 KEY_NUM,7                                   ; Count overflow
    73 01124 00F7 C        	CLR                 KEY_NUM
    74            C        
    75 01125 0436 C        	MOV                 A,KeystokeTimeCNT
    76 01126 1D46 C        	SUB                 A,@70                                       ; 70*56ms=3920ms(ComuTime=56ms)
    77 01127 0C03 C        	JBC                 STATUS,C
    78 01128 0576 C        	INC                 KeystokeTimeCNT                             ; press times ,recalculate
    79            C        
    80 01129 0436 C        	MOV                 A,KeystokeTimeCNT
    81 0112A 1B11 C        	XOR                 A,@17                                       ; 17*56ms=960ms(ComuTime=56ms)
    82 0112B 0E83 C        	JBS                 STATUS,Z                                    ;
    83 0112C 0012 C        	RET
    84 0112D 099F C        	BC                  KeyScanStatusFlag/16,KeyScanStatusFlag%16	            ; more than 800ms ,EXIT scan status
    85 0112E 0B1F C        	BS                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
    86 0112F 0012 C        	RET
    87            C        
    88            C        
    89            C        ;=========================================================================
    90 01130      C        KeyStatus_Low_Scan:     ; rising edge ,check low level time
    91 01130 0436 C        	MOV                 A,KeystokeTimeCNT
    92 01131 1D06 C        	SUB                 A,@6                       ;6*56ms=320ms(ComuTime=56ms)
    93 01132 0C03 C        	JBC                 STATUS,C                   ;
    94 01133 1535 C        	JMP                 KeyScan_Short_Press	       ;less than 510ms
    95 01134 1538 C        	JMP                 KeyScan_Lasting_Press      ;more than 510ms
    96 01135      C        KeyScan_Short_Press:
    97 01135 0803 C        	BC                  STATUS,C
    98 01136 06F7 C        	RLC                 KEY_NUM
    99 01137 0012 C        	RET
   100 01138      C        KeyScan_Lasting_Press:
   101 01138 0A03 C        	BS                  STATUS,C
   102 01139 06F7 C        	RLC                 KEY_NUM
   103 0113A 0012 C        	RET
   104            C        
   105            C        
   106            C        
    15            C        
    16            C        ifndef EM78CtrlIns.H
    17            C        include "EM78CtrlIns.H"
    18            C        endif
    19            C        
    20            C        ifndef M611rxP40M1v6V10.H
    21            C        include "M611rxP40M1v6V10.H"
    22            C        endif
    23            C        
    24            C        ifndef XX93C46_For_EM78M611.ASM
    25            C        include "XX93C46_For_EM78M611.ASM"
     1            C        ;***********************************************************************;
     2            C        ; Tilte: Em78M611 spi FOR AT93C46 Function macro Code                  ;
     3            C        ; Description:库中共包括以下七个功能宏                                  ;
     4            C        ;     1."mEWEN"  允许写/擦数据的宏。                                    ;
     5            C        ;     2."mEWDS"  禁止写/擦数据的宏 。                                   ;
     6            C        ;     3."mWRITE" 写如数据的宏，可以连续写多个字节，且写入数据可以不同   ;
     7            C        ;     4."mREAD"  读数据的宏，可以连续读多个字节。                       ;
     8            C        ;     5."mERASE" 擦除数据的宏，可以擦除多个连续字节。                   ;
     9            C        ;     6."mERAL"  擦除所有数据的宏，所有地址的内容都为"FF"。             ;
    10            C        ;     7."mWRAL"  把所有地址写入同以数据的宏。                           ;
    11            C        ; Company: Elan Corp. Inc                                               ;
    12            C        ; Author:  yu.wei                                                     ;
    13            C        ; Date:    2009.3.20                                                    ;
    14            C        ; Version: v1.0                                                         ;
    15            C        ; 说明：在使用此库时先要定义好作为通讯口的定义。                        ;
    16            C        ;***********************************************************************
    17            C        ;说明：
    18            C        ;    1. 本程式所写及读的数据都为8bit;
    19            C        ;------------------------------------------------------
    20            C        ; spi          Port Used For 93C46 Control.
    21            C        ; cs           Port Pin Tied To cs On 93C46.
    22            C        ; sk           Port Pin Tied To sk On 93C46.
    23            C        ; di           Port Pin Tied To di On 93C46.
    24            C        ; DO           Port Pin Tied To DO On 93C46.
    25            C        ; r_acc1     This Register Contains The 2 Bit 93C46
    26            C        ;              Command Is The High 2 Bit Positions And
    27            C        ;              memory Address In The Lower 6.
    28            C        ;--------------------------------------------------
    29            C        ;Instruction   SB    Op Code     Address               Data	         
    30            C        ;                               x8       x16       x8       x16	
    31            C        ;    READ       1      10 	A6 - A0  A5 - A0				
    32            C        ;    EWEN       1 	   00     11XXXXX  11XXXX 				
    33            C        ;    ERASE      1      11     A6 - A0  A5 - A0 				
    34            C        ;    WRITE      1 	   01 	A6 - A0  A5 - A0   D7 - D0  D15- D0  
    35            C        ;    ERAL       1 	   00 	10XXXXX  10XXXX 					
    36            C        ;    WRAL       1 	   00 	01XXXXX  01XXXX    D7 - D0  D15- D0  
    37            C        ;    EWDS       1 	   00 	00XXXXX  00XXXX 				
    38            C        ;=================================================================================
    39            C        XX93C46_For_EM78M611.ASM       EQU        XX93C46_For_EM78M611.ASM
    40            C        
    41            C        ifndef XX93C46_For_EM78M611.H
    42            C        include "XX93C46_For_EM78M611.H"
     1            C        ;---------------------------------------------------
     2            C        XX93C46_For_EM78M611.H         EQU        XX93C46_For_EM78M611.H
     3            C        
     4            C        ;---------------------------------------------------
     5            C        ;  93C46 INSTRUCTION  COmmAND
     6            C        ;--------------------------------------------------
     7       0080 C                READ        EQU     0X80    ;93C46 Read Command.
     8       0040 C                WRITE       EQU     0X40    ;93C46 Write Command.
     9       00C0 C                ERASE       EQU     0XC0    ;93C46 Erase Command.
    10       0030 C                EWEN        EQU     0X30    ;93C46 Erase/Write Enable Command.
    11       0000 C                EWDS        EQU     0X00    ;93C46 Erase/Write Disable Command.
    12       0020 C                ERAL        EQU     0X20    ;92C46 Erase All Command.
    13       0010 C                WRAL        EQU     0X10    ;92C46 Write All Command.
    14            C        ;--------------------------------------------------
    43            C        endif
    44            C        
    45            C        ifndef EM78CtrlIns.H
    46            C        include "EM78CtrlIns.H"
    47            C        endif
    48            C        
    49            C        
    50            C        		ORG     0X300
    51            C        ;***********************************************************************;
    52            C        ;Program name: mEWEN m,spi    m 数据的位数（8BIT或16BIT）               ;
    53            C        ;Description:  允许写/擦除操作的指令写入                                ;
    54            C        ;Input:        选择数据类型 m==8或m==16  m代表数据位数                  ;
    55            C        ;              定义好spi及其cs,sk,di,DO位                               ;
    56            C        ;Output:       使能写/擦除操作                                          ;
    57            C        ;Variable Register:None                                                 ;
    58            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    59            C        ;***********************************************************************;
    60            C        mEWEN   MACRO   
    61            C                FCALL    Start_Bit       ;load start bit
    62            C                MOV     A,@ewen         ;enable erase/write
    63            C                MOV     r_acc1,A
    64            C                ;
    65            C                MOV     A,@9
    66            C                ;
    67            C                FCALL    Rl_Comd         ;finish enable erase/write
    68            C                BC      AT93C46_CS/16,AT93C46_CS%16          ;load end bit
    69            C                BC      SPI_CLK/16,SPI_CLK%16
    70            C                BC      SPI_MOSI/16,SPI_MOSI%16
    71            C                ENDM
    72            C        ;
    73            C        ;***********************************************************************;
    74            C        ;Program name:  mEWDS m,spi    m 数据的位数（8BIT或16BIT）              ;
    75            C        ;Description:   禁止写/擦除操作的指令写入                               ;
    76            C        ;Input:         选择数据类型 m==8或m==16  m代表数据位数；               ;
    77            C        ;               定义好spi及其cs,sk,di,DO位                              ;
    78            C        ;Output:        禁止写/擦除操作                                         ;
    79            C        ;Variable Register:None                                                 ;
    80            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    81            C        ;***********************************************************************;
    82            C        mEWDS   MACRO     
    83            C                FCALL     Start_Bit       ;写入起始位
    84            C                MOV      A,@ewds         ;禁止写和擦除动作
    85            C                MOV      r_acc1,A
    86            C                ;
    87            C                MOV      A,@9
    88            C                ;
    89            C                FCALL     Rl_Comd
    90            C                BC       AT93C46_CS/16,AT93C46_CS%16
    91            C                BC       SPI_CLK/16,SPI_CLK%16
    92            C                BC       SPI_MOSI/16,SPI_MOSI%16          ;完成使能写操作指令的写入
    93            C                ENDM
    94            C        ;
    95            C        ;***********************************************************************;
    96            C        ;Program name:  mWRITE m,DataAddressInEEPROM,k,DataAddressInMCU,spi                            ;
    97            C        ;Description:   指定数据块写入到指定地址                                ;
    98            C        ;Input:         m 选择数据类型 m==8或16                                 ;
    99            C        ;               DataAddressInEEPROM  内容为要写入数据的最低位地址(93C46的地址）      ;
   100            C        ;               k 要写入数据的地址总数                                  ;
   101            C        ;               DataAddressInMCU  内容为存放数据的最低位地址（mCU的地址）         ;
   102            C        ;               spi  选择PORT作为通信口，要定义好cs,sk,di,DO相关位      ;
   103            C        ;Output:        写入指定数据块到指定地址块                              ;
   104            C        ;Variable Register:None                                                 ;
   105            C        ;Register Changed: STATUS,ACC ,
   106            C        ;                  r_acc1(0X21) ,
   107            C        ;                  r_acc2(0X22),         ;
   108            C        ;                  r_acc3(0X23)                                       ;
   109            C        ;***********************************************************************;
   110            C        mWRITE  MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   111            C                BANK    @BankSel
   112            C                MOV     A,DataAddressInMCU    ;写入数据存放的最低地址为0X24（mCU的地址）
   113            C                MOV     R4,A                   ;存放数据的间接地址
   114            C                MOV     A,@k
   115            C                MOV     r_acc3,A               ;写入93C46的字节数
   116            C        $Write_Data:
   117            C                FCALL    Start_Bit             ;写入起始位
   118            C               ;
   119            C                BC      STATUS,C
   120            C                RRCA    DataAddressInEEPROM
   121            C                ;
   122            C                OR      A,@write
   123            C                MOV     r_acc1,A               ;高二位为写命令，低六位为地址
   124            C                MOV     A,@8                   ;向93C46写一个字节，控制数
   125            C                FCALL    Rl_Comd               ;写入指令“写”和要写入数据的地址
   126            C               ;
   127            C                BC      SPI_CLK/16,SPI_CLK%16
   128            C                JBS     DataAddressInEEPROM,0        ;写入8BIT模式时的地址最低位
   129            C                BC      SPI_MOSI/16,SPI_MOSI%16
   130            C                JBC     DataAddressInEEPROM,0
   131            C                BS      SPI_MOSI/16,SPI_MOSI%16
   132            C                JMP     $+1
   133            C                BS      SPI_CLK/16,SPI_CLK%16          ;以上为写入OP和ADDRESS
   134            C                ;
   135            C                INC     DataAddressInEEPROM
   136            C        $Data_H_L:
   137            C                MOV     A,R0
   138            C                MOV     r_acc1,A      ;装入要写入的数据
   139            C                INC     R4
   140            C                MOV     A,@8
   141            C                FCALL    Rl_Comd         ;写入8BIT数据
   142            C               ;
   143            C                JMP     $+1
   144            C               ;
   145            C                BC      AT93C46_CS/16,AT93C46_CS%16
   146            C                BC      SPI_CLK/16,SPI_CLK%16          ;数据写完，写结束位
   147            C                ;BC      AT93C46_CS/16,AT93C46_CS%16
   148            C                BC      SPI_MOSI/16,SPI_MOSI%16
   149            C                JMP     $+1
   150            C                BS      SPI_CLK/16,SPI_CLK%16
   151            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;完成结束位的写入
   152            C                JBS     SPI_MISO/16,SPI_MISO%16
   153            C                JMP     $-1
   154            C                BC      AT93C46_CS/16,AT93C46_CS%16
   155            C                DJZ     r_acc3        ;多字节写入控制
   156            C                JMP     $Write_Data
   157            C                ENDM
   158            C        ;
   159            C        ;***********************************************************************;
   160            C        ;Program name:  mREAD m,DataAddressInEEPROM,k,DataAddressInMCU,spi                             ;
   161            C        ;Description:   从指定地址块（93C46）读出数据到指定地址块(CPU)          ;
   162            C        ;Input:         m 选择数据类型 m==8或16                                 ;
   163            C        ;               DataAddressInEEPROM  内容为要读出数据的最低位地址(93C46的地址）      ;
   164            C        ;               k 要写入数据的地址总数                                  ;
   165            C        ;               DataAddressInMCU  内容为存放数据的最低位地址（mCU的地址）         ;
   166            C        ;               spi  选择PORT作为通信口，要定义好cs,sk,di,DO相关位      ;
   167            C        ;Output:        指定地址读出指定数据块                                  ;
   168            C        ;Variable Register:None                                                 ;
   169            C        ;Register Changed: STATUS,ACC ,
   170            C        ;                  r_acc1(0X21) ,
   171            C        ;                  r_acc2(0X22),         ;
   172            C        ;                  r_acc3(0X23)                                       ;
   173            C        ;***********************************************************************;
   174            C        mREAD   MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   175            C                MOV     A,DataAddressInMCU              ;写入数据存放的最低地址（mCU的地址）     ;
   176            C                MOV     R4,A
   177            C                BANK    @BankSel
   178            C                MOV     A,@k
   179            C                MOV     r_acc3,A
   180            C        $Write_Data:
   181            C                FCALL    Start_Bit       ;写入起始位
   182            C               ;
   183            C                RRCA    DataAddressInEEPROM
   184            C                ;
   185            C                OR      A,@READ
   186            C                MOV     r_acc1,A      ;高二位为写命令，低六位为地址
   187            C                MOV     A,@8            ;向93C46写一个字节，控制数
   188            C                FCALL    Rl_Comd         ;写入指令“读”和要写入数据的地址
   189            C               ;
   190            C                BC      SPI_CLK/16,SPI_CLK%16
   191            C                JBS     DataAddressInEEPROM,0        ;写入8BIT模式时的地址最低位
   192            C                BC      SPI_MOSI/16,SPI_MOSI%16
   193            C                JBC     DataAddressInEEPROM,0
   194            C                BS      SPI_MOSI/16,SPI_MOSI%16
   195            C                JMP     $+1
   196            C                BS      SPI_CLK/16,SPI_CLK%16
   197            C               ;
   198            C                INC     DataAddressInEEPROM          ;地址加1
   199            C                BC      SPI_MOSI/16,SPI_MOSI%16
   200            C                JMP     $+1
   201            C                BC      SPI_CLK/16,SPI_CLK%16
   202            C                JMP     $+1
   203            C                JMP     $+1
   204            C                BS      SPI_CLK/16,SPI_CLK%16
   205            C        
   206            C        $Read_Data1:
   207            C                MOV     A,@8
   208            C                MOV     r_acc2,A
   209            C        $Read_Data2:
   210            C                BC      SPI_CLK/16,SPI_CLK%16
   211            C                NOP
   212            C                NOP
   213            C                JBC     SPI_MISO/16,SPI_MISO%16
   214            C                BS      STATUS,C
   215            C                JBS     SPI_MISO/16,SPI_MISO%16
   216            C                BC      STATUS,C
   217            C                RLC     R0
   218            C                BS      SPI_CLK/16,SPI_CLK%16
   219            C                JMP     $+1
   220            C                DJZ     r_acc2
   221            C                JMP     $Read_Data2
   222            C                INC     R4
   223            C                ;
   224            C                NOP
   225            C                ;
   226            C                BC      AT93C46_CS/16,AT93C46_CS%16
   227            C                DJZ     r_acc3
   228            C                JMP     $Write_Data
   229            C                ENDM
   230            C        ;
   231            C        ;***********************************************************************;
   232            C        ;Program name:  mERASE m,DataAddressInEEPROM,k,spi                                   ;
   233            C        ;Description:   从指定地址块擦除数据                                    ;
   234            C        ;Input:         m 选择数据类型 m==8或16                                 ;
   235            C        ;               DataAddressInEEPROM 内容为要擦除数据的最低位地址(93C46的地址）       ;
   236            C        ;               k 要擦除数据的地址总数                                  ;
   237            C        ;               spi    选择PORT作为通信口，要定义好cs,sk,di,DO相关位    ;
   238            C        ;Output:        指定地址块的数据被擦除                                  ;
   239            C        ;Variable Register:None                                                 ;
   240            C        ;Register Changed: STATUS,ACC ,
   241            C        ;                  r_acc1(0X21) ,
   242            C        ;                  r_acc2(0X22),         ;
   243            C        ;                  r_acc3(0X23)                                       ;
   244            C        ;***********************************************************************;
   245            C        mERASE  MACRO    DataAddressInEEPROM,k
   246            C                MOV     A,@k
   247            C                MOV     r_acc3,A      ;写入93C46的字节数
   248            C        $Write_Data:
   249            C                CALL    Start_Bit       ;写入起始位
   250            C               ;
   251            C                RRCA    DataAddressInEEPROM
   252            C               ;
   253            C                OR      A,@ERASE
   254            C                MOV     r_acc1,A      ;高二位为写命令，低六位为地址
   255            C                MOV     A,@8            ;向93C46写一个字节，控制数
   256            C                CALL    Rl_Comd         ;写入指令“写”和要写入数据的地址
   257            C                ;
   258            C                BC      SPI_CLK/16,SPI_CLK%16
   259            C                JBS     DataAddressInEEPROM,0        ;写入8BIT模式时的地址最低位
   260            C                BC      SPI_MOSI/16,SPI_MOSI%16
   261            C                JBC     DataAddressInEEPROM,0
   262            C                BS      SPI_MOSI/16,SPI_MOSI%16
   263            C                JMP     $+1
   264            C                BS      SPI_CLK/16,SPI_CLK%16          ;完成命令的写入
   265            C                JMP     $+1
   266            C                JMP     $+1
   267            C               ;
   268            C                INC     DataAddressInEEPROM
   269            C                BC      AT93C46_CS/16,AT93C46_CS%16
   270            C                BC      SPI_CLK/16,SPI_CLK%16
   271            C                BC      SPI_MOSI/16,SPI_MOSI%16
   272            C                JMP     $+1
   273            C                BS      SPI_CLK/16,SPI_CLK%16
   274            C                BS      AT93C46_CS/16,AT93C46_CS%16
   275            C                JBS     SPI_MISO/16,SPI_MISO%16
   276            C                JMP     $-1
   277            C                BC      AT93C46_CS/16,AT93C46_CS%16
   278            C        ;
   279            C                DJZ     r_acc3
   280            C                JMP     $Write_Data
   281            C                ENDM
   282            C        ;
   283            C        ;***********************************************************************;
   284            C        ;Program name:  mERAL m,spi                                             ;
   285            C        ;Description:   擦除所有地址的数据                                      ;
   286            C        ;Input:         m 选择数据类型 m==8或16                                 ;
   287            C        ;               spi  选择PORT作为通信口，要定义好cs,sk,di,DO相关位      ;
   288            C        ;Output:        所有地址的数据被擦除，变为“FF"                         ;
   289            C        ;Variable Register:None                                                 ;
   290            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   291            C        ;***********************************************************************
   292            C        mERAL   MACRO   
   293            C        $Write_Data:
   294            C                FCALL   Start_Bit       ;写入起始位
   295            C                MOV     A,@ERAL
   296            C                MOV     r_acc1,A      ;高二位为写命令，低六位为地址
   297            C               ;
   298            C                MOV     A,@9
   299            C               ;
   300            C                FCALL    Rl_Comd
   301            C                BC      AT93C46_CS/16,AT93C46_CS%16
   302            C                BC      SPI_CLK/16,SPI_CLK%16
   303            C                BC      SPI_MOSI/16,SPI_MOSI%16
   304            C                JMP     $+1
   305            C                BS      SPI_CLK/16,SPI_CLK%16
   306            C                BS      AT93C46_CS/16,AT93C46_CS%16
   307            C                JBS     SPI_MISO/16,SPI_MISO%16
   308            C                JMP     $-1
   309            C                BC      AT93C46_CS/16,AT93C46_CS%16
   310            C                ENDM
   311            C        ;
   312            C        ;***********************************************************************;
   313            C        ;Program name:  mWRAL m,DataAddressInMCU,spi                                      ;
   314            C        ;Description:   一个指定数据写入到所有地址                              ;
   315            C        ;Input:         m 选择数据类型 m==8或16                                 ;
   316            C        ;               spi  选择PORT作为通信口，要定义好cs,sk,di,DO相关位      ;
   317            C        ;               DataAddressInMCU  内容为存放数据的最低位地址（mCU的地址）         ;
   318            C        ;Output:        所有地址写入同一指定数据                                ;
   319            C        ;Variable Register:None                                                 ;
   320            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   321            C        ;***********************************************************************;
   322            C        mWRAL   MACRO   @DataAddressInMCU
   323            C                MOV     A,@DataAddressInMCU
   324            C                MOV     R4,A            ;存放数据的间接地址
   325            C                CALL    Start_Bit       ;写入起始位
   326            C                MOV     A,@WRAL
   327            C                MOV     r_acc1,A      ;高二位为写命令，低六位为地址
   328            C                ;
   329            C                MOV     A,@9
   330            C                ;
   331            C                CALL    Rl_Comd
   332            C        $Data_H_L:
   333            C                MOV     A,R0
   334            C                MOV     r_acc1,A      ;装入要写入的数据
   335            C                INC     R4
   336            C                MOV     A,@8
   337            C                CALL    Rl_Comd         ;写入8BIT数据
   338            C                ;
   339            C                NOP
   340            C                ;
   341            C                BC      SPI_CLK/16,SPI_CLK%16          ;数据写完，写结束位
   342            C                BC      AT93C46_CS/16,AT93C46_CS%16
   343            C                BC      SPI_MOSI/16,SPI_MOSI%16
   344            C                JMP     $+1
   345            C                BS      SPI_CLK/16,SPI_CLK%16
   346            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;完成结束位的写入
   347            C                JBS     SPI_MISO/16,SPI_MISO%16
   348            C                JMP     $-1
   349            C                BC      AT93C46_CS/16,AT93C46_CS%16
   350            C                BC      SPI_CLK/16,SPI_CLK%16
   351            C                ENDM
   352            C        
   353            C        
   354            C        
   355            C        
   356            C        ;-------------------------------------------------------
   357 00300      C        Start_Bit:
   358            C      M 		BANK    @0
       00300 09C4     1     BC  4 , 7 
       00301 0984     1     BC  4 , 6 
   359 00302 0985 C                BC      AT93C46_CS/16,AT93C46_CS%16
   360 00303 0886 C                BC      SPI_CLK/16,SPI_CLK%16
   361 00304 08C6 C                BC      SPI_MOSI/16,SPI_MOSI%16
   362 00305 1706 C                JMP     $+1
   363 00306 1707 C                JMP     $+1
   364 00307 0B85 C                BS      AT93C46_CS/16,AT93C46_CS%16
   365 00308 1709 C                JMP     $+1
   366 00309 170A C                JMP     $+1
   367 0030A 0AC6 C                BS      SPI_MOSI/16,SPI_MOSI%16       ;PORT6,SPI_MOSI;
   368 0030B 170C C                JMP     $+1
   369 0030C 170D C                JMP     $+1
   370 0030D 0A86 C                BS      SPI_CLK/16,SPI_CLK%16
   371 0030E 0012 C                RET
   372            C        
   373            C        ;--------------------------------------------------------
   374 0030F      C        Rl_Comd:
   375 0030F 0059 C        	MOV     DataShiftCounter,A
   376            C      M 	BANK    @0
       00310 09C4     1     BC  4 , 7 
       00311 0984     1     BC  4 , 6 
   377 00312      C        Rl_Comd1:
   378 00312 0886 C        	BC      SPI_CLK/16,SPI_CLK%16
   379 00313 1714 C        	JMP     $+1
   380 00314 0803 C        	bc      status,c
   381 00315 06D1 C        	RLC     r_acc1        ;要写入的数据
   382 00316 0E03 C        	JBS     STATUS,C
   383 00317 08C6 C        	BC      SPI_MOSI/16,SPI_MOSI%16
   384 00318 0C03 C        	JBC     STATUS,C
   385 00319 0AC6 C        	BS      SPI_MOSI/16,SPI_MOSI%16
   386 0031A 0000 C        	NOP
   387 0031B 0000 C        	NOP
   388 0031C 0A86 C        	BS      SPI_CLK/16,SPI_CLK%16
   389 0031D 171E C        	JMP     $+1
   390 0031E 05D9 C        	DJZ     DataShiftCounter
   391 0031F 1712 C        	JMP     Rl_Comd1
   392 00320 0012 C        	RET                   ;    return
   393            C        
   394            C        
    26            C        endif
    27            C        
    28            C        ;=========================================================================
    29            C        
    30            C        	ORG                 0X1000	;PAGE 4
    31            C        ;********************************************************************************
    32            C        ; TX data to PC
    33            C        ;********************************************************************************
    34            C        ;===================================================================
    35            C        ;Function:      setting
    36            C        ;Input:         None
    37            C        ;Output:        None
    38            C        ;====================================================================
    39 01000      C        Communicate_Usb_Function:
    40 01000 10E3 C        	CALL                PAGE4BANK1
    41 01001 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
    42 01002 1409 C        	JMP                 KeyType_Scan
    43            C        
    44 01003 0417 C        	MOV                 A,SystemTimeCNT
    45 01004 1DC8 C        	SUB                 A,@200              ; 200*1ms = 200ms
    46 01005 0C03 C        	JBC                 STATUS,C
    47 01006 1409 C        	JMP                 KeyType_Scan
    48 01007 00D7 C        	CLR                 SystemTimeCNT
    49 01008 0AC9 C        	BS                  LED1_STATUS/16,LED1_STATUS%16
    50            C        
    51            C        ;===========================================================================
    52 01009      C        KeyType_Scan:
    53 01009 1100 C        	CALL                ConnectKey_Scan
    54 0100A 0F1F C        	JBS                 KeyScanFinishFlag/16,KeyScanFinishFlag%16
    55 0100B 141A C        	JMP                 Keystoke_No_Press
    56 0100C 091F C        	BC                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
    57            C        
    58 0100D 0437 C        	MOV                 A,KEY_NUM
    59 0100E 1B02 C        	XOR                 A,@00000010B
    60 0100F 0C83 C        	JBC                 STATUS,Z
    61 01010 1431 C        	JMP                 Click_Select
    62            C        
    63 01011 0437 C        	MOV                 A,KEY_NUM
    64 01012 1B03 C        	XOR                 A,@00000011B
    65 01013 0C83 C        	JBC                 STATUS,Z
    66 01014 143F C        	JMP                 Lasting_Press_Select
    67            C        
    68 01015 0437 C        	MOV                 A,KEY_NUM
    69 01016 1B04 C        	XOR                 A,@00000100B
    70 01017 0C83 C        	JBC                 STATUS,Z
    71 01018 1442 C        	JMP                 Dblclick_Select
    72            C        
    73            C        /*
    74            C        	MOV                 A,KEY_NUM
    75            C        	XOR                 A,@00000101B
    76            C        	JBC                 STATUS,Z
    77            C        	NOP
    78            C        
    79            C        	MOV                 A,KEY_NUM
    80            C        	XOR                 A,@00000110B
    81            C        	JBC                 STATUS,Z
    82            C        	NOP
    83            C        
    84            C        	MOV                 A,KEY_NUM
    85            C        	XOR                 A,@00000111B
    86            C        	JBC                 STATUS,Z
    87            C        	NOP
    88            C        */
    89            C        
    90 01019 0000 C        	NOP
    91            C        ;===========================================================================
    92            C        
    93            C        
    94            C        ;**********************************************************************************
    95            C        ;*********************************************************************************
    96            C        ; force link check CHN_FLAG
    97            C        ;*********************************************************************************
    98 0101A      C        Keystoke_No_Press:
    99 0101A 0000 C        	NOP
   100 0101B 0D1E C        	JBC                 LinkModeFlag/16,LinkModeFlag%16
   101 0101C 14CB C        	JMP                 Cycle_Waiting_End
   102 0101D 10E3 C        	CALL                PAGE4BANK1
   103 0101E 0423 C        	MOV                 A,CHN_FLAG
   104 0101F 1B3F C        	XOR                 A,@00111111B             ; 6 Gamepads
   105 01020 0E83 C        	JBS                 STATUS,Z
   106 01021 14CB C        	JMP                 Cycle_Waiting_End
   107 01022      C        Quit_Recognise_Scan:                             ; exit ID scan
   108            C      M 	PAGE                0
       01022 09C3     1     BC  3 , 7 
       01023 0983     1     BC  3 , 6 
       01024 0943     1     BC  3 , 5 
   109 01025 1279 C        	CALL                SearchLinkMode_Set
   110            C      M 	PAGE                5
       01026 0BC3     1     BS  3 , 7 
       01027 0983     1     BC  3 , 6 
       01028 0B43     1     BS  3 , 5 
   111 01029 1287 C        	CALL                CHANGE_ADDRESS_VALUE
   112            C      M 	PAGE                4
       0102A 0BC3     1     BS  3 , 7 
       0102B 0983     1     BC  3 , 6 
       0102C 0943     1     BC  3 , 5 
   113 0102D 10E3 C        	CALL                PAGE4BANK1
   114 0102E 00E3 C        	CLR                 CHN_FLAG
   115 0102F 14CB C        	JMP                 Cycle_Waiting_End
   116 01030 0000 C        	NOP
   117            C        
   118            C        ;**********************************************************************************
   119            C        ;*********************************************************************************
   120            C        ; FCC test mode frequency index
   121            C        ;*********************************************************************************
   122 01031      C        Click_Select:
   123 01031 08C9 C        	BC                  LED1_STATUS/16,LED1_STATUS%16
   124 01032 0F9E C        	JBS                 FccTestModeFlag/16,FccTestModeFlag%16
   125 01033 143A C        	JMP                 Not_Fcc_TestMode
   126 01034 056F C        	INC                 FccFreqIndex
   127 01035 042F C        	MOV                 A,FccFreqIndex
   128 01036 1D0F C        	SUB                 A,@0X0F
   129 01037 0E03 C        	JBS                 STATUS,C
   130 01038 00EF C        	CLR                 FccFreqIndex
   131 01039 1409 C        	JMP                 KeyType_Scan
   132 0103A      C        Not_Fcc_TestMode:
   133 0103A 00F7 C        	CLR                 KEY_NUM
   134 0103B 0F5E C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   135 0103C 14CB C        	JMP                 Cycle_Waiting_End
   136 0103D 1422 C        	JMP                 Quit_Recognise_Scan
   137 0103E 0000 C        	NOP
   138            C        
   139            C        
   140            C        
   141            C        ;**********************************************************************************
   142            C        ;*********************************************************************************
   143            C        ; Into FCC mode
   144            C        ;*********************************************************************************
   145 0103F      C        Lasting_Press_Select:                                     	; Fcc Test
   146            C        	;PAGE                0
   147            C        	;CALL                NormalFccLinkMode_Set
   148            C        	;PAGE                4
   149 0103F 0B9E C        	BS                  FccTestModeFlag/16,FccTestModeFlag%16
   150 01040 14CB C        	JMP                 Cycle_Waiting_End
   151 01041 0000 C        	NOP
   152            C        
   153            C        
   154            C        ;**********************************************************************************
   155            C        ;*********************************************************************************
   156            C        ; Into force link mode
   157            C        ;*********************************************************************************
   158 01042      C        Dblclick_Select:                                            ; Into Forcelink Mode:
   159 01042 0004 C        	WDTC
   160 01043 0AC9 C        	BS                  LED1_STATUS/16,LED1_STATUS%16
   161 01044 10E3 C        	CALL                PAGE4BANK1
   162 01045 1897 C        	MOV                 A,@RX_IDH_DEFAULT                   ; SYNC ,used default 0X0DB3
   163 01046 0061 C        	MOV                 RX_IDH,A
   164 01047 183A C        	MOV                 A,@RX_IDL_DEFAULT
   165 01048 0062 C        	MOV                 RX_IDL,A
   166            C      M 	PAGE                5
       01049 0BC3     1     BS  3 , 7 
       0104A 0983     1     BC  3 , 6 
       0104B 0B43     1     BS  3 , 5 
   167 0104C 1287 C        	CALL                CHANGE_ADDRESS_VALUE
   168            C      M 	PAGE                0
       0104D 09C3     1     BC  3 , 7 
       0104E 0983     1     BC  3 , 6 
       0104F 0943     1     BC  3 , 5 
   169 01050 1287 C        	CALL                SearchForceLinkMode_Set
   170 01051 1155 C        	CALL                Rand_ID_Function
   171            C      M 	PAGE                4
       01052 0BC3     1     BS  3 , 7 
       01053 0983     1     BC  3 , 6 
       01054 0943     1     BC  3 , 5 
   172 01055 0000 C        	NOP
   173 01056      C        Write_EEprom_Task:                                          ; Write EEprom Task
   174 01056 0011 C        	DISI
   175 01057 0000 C        	NOP
   176 01058 0B06 C        	BS                  SPI_SS/16,SPI_SS%16                 ; Disable EM198810
   177            C        	;mERAL                                                  ; Clear all
   178            C      M 	mEWEN                                                   ; Enable
                      2  M  FCALL  START_BIT 
                      3  M  PAGE ( START_BIT / 1024 ),
       01059 09C3     3     BC  3 , 7 
       0105A 0983     3     BC  3 , 6 
       0105B 0943     3     BC  3 , 5 
       0105C 1300     2     CALL ( START_BIT % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       0105D 0BC3     3     BS  3 , 7 
       0105E 0983     3     BC  3 , 6 
       0105F 0943     3     BC  3 , 5 
       01060 1830     1     MOV A,@( EWEN )
       01061 0051     1     MOV  R_ACC1 ,A
       01062 1809     1     MOV A,@( 9 )
                      2  M  FCALL  RL_COMD 
                      3  M  PAGE ( RL_COMD / 1024 ),
       01063 09C3     3     BC  3 , 7 
       01064 0983     3     BC  3 , 6 
       01065 0943     3     BC  3 , 5 
       01066 130F     2     CALL ( RL_COMD % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       01067 0BC3     3     BS  3 , 7 
       01068 0983     3     BC  3 , 6 
       01069 0943     3     BC  3 , 5 
       0106A 0985     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0106B 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0106C 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   179 0106D 1800 C        	MOV                 A,@0X00
   180 0106E 0055 C        	MOV                 DataAddressInEEPROM,A
   181 0106F 1860 C        	MOV                 A,@0X60
   182 01070 0054 C        	MOV                 DataAddressInMCU,A
   183            C      M  	mWRITE              DataAddressInEEPROM,@0,DataAddressInMCU,@16
                      2  M  BANK @( 0 ),
       01071 09C4     2     BC  4 , 7 
       01072 0984     2     BC  4 , 6 
       01073 0414     1     MOV A, DATAADDRESSINMCU 
       01074 0044     1     MOV  R4 ,A
       01075 1810     1     MOV A,@( 16 )
       01076 0053     1     MOV  R_ACC3 ,A
       01077          1    ??0046$WRITE_DATA:   
                      2  M  FCALL  START_BIT 
                      3  M  PAGE ( START_BIT / 1024 ),
       01077 09C3     3     BC  3 , 7 
       01078 0983     3     BC  3 , 6 
       01079 0943     3     BC  3 , 5 
       0107A 1300     2     CALL ( START_BIT % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       0107B 0BC3     3     BS  3 , 7 
       0107C 0983     3     BC  3 , 6 
       0107D 0943     3     BC  3 , 5 
       0107E 0803     1     BC  STATUS , C 
       0107F 0615     1     RRCA  DATAADDRESSINEEPROM ,
       01080 1940     1     OR A,@( WRITE )
       01081 0051     1     MOV  R_ACC1 ,A
       01082 1808     1     MOV A,@( 8 )
                      2  M  FCALL  RL_COMD 
                      3  M  PAGE ( RL_COMD / 1024 ),
       01083 09C3     3     BC  3 , 7 
       01084 0983     3     BC  3 , 6 
       01085 0943     3     BC  3 , 5 
       01086 130F     2     CALL ( RL_COMD % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       01087 0BC3     3     BS  3 , 7 
       01088 0983     3     BC  3 , 6 
       01089 0943     3     BC  3 , 5 
       0108A 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0108B 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       0108C 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       0108D 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       0108E 0AC6     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       0108F 1490     1     JMP ( $ + 1 ),
       01090 0A86     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       01091 0555     1     INC  DATAADDRESSINEEPROM ,
       01092          1    ??0046$DATA_H_L:   
       01092 0400     1     MOV A, R0 
       01093 0051     1     MOV  R_ACC1 ,A
       01094 0544     1     INC  R4 ,
       01095 1808     1     MOV A,@( 8 )
                      2  M  FCALL  RL_COMD 
                      3  M  PAGE ( RL_COMD / 1024 ),
       01096 09C3     3     BC  3 , 7 
       01097 0983     3     BC  3 , 6 
       01098 0943     3     BC  3 , 5 
       01099 130F     2     CALL ( RL_COMD % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       0109A 0BC3     3     BS  3 , 7 
       0109B 0983     3     BC  3 , 6 
       0109C 0943     3     BC  3 , 5 
       0109D 149E     1     JMP ( $ + 1 ),
       0109E 0985     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0109F 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       010A0 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       010A1 14A2     1     JMP ( $ + 1 ),
       010A2 0A86     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       010A3 0B85     1     BS ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       010A4 0E06     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       010A5 14A4     1     JMP ( $ - 1 ),
       010A6 0985     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       010A7 05D3     1     DJZ  R_ACC3 ,
       010A8 1477     1     JMP  ??0046$WRITE_DATA ,
   184            C      M  	mEWDS                                                   ; disable
                      2  M  FCALL  START_BIT 
                      3  M  PAGE ( START_BIT / 1024 ),
       010A9 09C3     3     BC  3 , 7 
       010AA 0983     3     BC  3 , 6 
       010AB 0943     3     BC  3 , 5 
       010AC 1300     2     CALL ( START_BIT % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       010AD 0BC3     3     BS  3 , 7 
       010AE 0983     3     BC  3 , 6 
       010AF 0943     3     BC  3 , 5 
       010B0 1800     1     MOV A,@( EWDS )
       010B1 0051     1     MOV  R_ACC1 ,A
       010B2 1809     1     MOV A,@( 9 )
                      2  M  FCALL  RL_COMD 
                      3  M  PAGE ( RL_COMD / 1024 ),
       010B3 09C3     3     BC  3 , 7 
       010B4 0983     3     BC  3 , 6 
       010B5 0943     3     BC  3 , 5 
       010B6 130F     2     CALL ( RL_COMD % 1024 ),
                      3  M  PAGE ( $ / 1024 ),
       010B7 0BC3     3     BS  3 , 7 
       010B8 0983     3     BC  3 , 6 
       010B9 0943     3     BC  3 , 5 
       010BA 0985     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       010BB 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       010BC 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   185 010BD 0985 C        	BC                  AT93C46_CS/16,AT93C46_CS%16         ; Disable 93C46
   186            C        
   187 010BE 0010 C        	ENI
   188 010BF 10E3 C         	CALL                PAGE4BANK1
   189 010C0 00DF C        	CLR                 GeneralStatusFlag
   190 010C1 00E3 C        	CLR                 CHN_FLAG
   191 010C2 00F7 C        	CLR                 KEY_NUM
   192 010C3 00DE C        	CLR                 CommuStatusFlag
   193 010C4 0A1E C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16
   194 010C5 0B5E C        	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16    ;
   195            C        
   196 010C6 10E0 C        	CALL                PAGE4BANK0
   197 010C7 0985 C        	BC                  AT93C46_CS/16,AT93C46_CS%16                  ; Disable 93C46
   198 010C8 0B06 C        	BS                  SPI_SS/16,SPI_SS%16                          ; Disable EM198810
   199 010C9 14CB C        	JMP                 Cycle_Waiting_End
   200 010CA 0000 C        	NOP
   201            C        
   202            C        
   203            C        
   204            C        ;===================================================================
   205            C        ; 
   206            C        ;===================================================================
   207 010CB      C        Cycle_Waiting_End:
   208 010CB 10E3 C        	CALL                PAGE4BANK1
   209 010CC 0573 C        	INC                 CH_NO
   210            C      M 	PAGE                3
       010CD 09C3     1     BC  3 , 7 
       010CE 0B83     1     BS  3 , 6 
       010CF 0B43     1     BS  3 , 5 
   211 010D0 1275 C        	CALL                RF_FREQ_SET	
   212            C      M 	PAGE                5
       010D1 0BC3     1     BS  3 , 7 
       010D2 0983     1     BC  3 , 6 
       010D3 0B43     1     BS  3 , 5 
   213 010D4 0433 C        	MOV                 A,CH_NO
   214 010D5 1D0F C        	SUB                 A,@15
   215 010D6 0E03 C        	JBS                 STATUS,C
   216 010D7 00F3 C        	CLR                 CH_NO
   217            C        
   218 010D8 0417 C        	MOV                 A,SystemTimeCNT
   219 010D9 1DFA C        	SUB                 A,@250              ; 200*1ms = 200ms
   220 010DA 0E03 C        	JBS                 STATUS,C
   221 010DB 00D7 C        	CLR                 SystemTimeCNT
   222            C        
   223 010DC 0423 C        	MOV                 A,CHN_FLAG
   224 010DD 006E C        	MOV                 CHN_FLAG_TEMP,A
   225 010DE 0012 C        	RET
   226 010DF 0000 C        	NOP
   227            C        
   228            C        ;=====================================================================
   229            C        ; BANK exchange function
   230            C        ;=====================================================================
   231 010E0      C        PAGE4BANK0:
   232 010E0 09C4 C        	BC                  0X04,7
   233 010E1 0984 C        	BC                  0X04,6
   234 010E2 0012 C        	RET
   235 010E3      C        PAGE4BANK1:
   236 010E3 09C4 C        	BC                  0X04,7
   237 010E4 0B84 C        	BS                  0X04,6
   238 010E5 0012 C        	RET
   239 010E6      C        PAGE4BANK2:
   240 010E6 0BC4 C        	BS                  0X04,7
   241 010E7 0984 C        	BC                  0X04,6
   242 010E8 0012 C        	RET
   243 010E9      C        PAGE4BANK3:
   244 010E9 0BC4 C        	BS                  0X04,7
   245 010EA 0B84 C        	BS                  0X04,6
   246 010EB 0012 C        	RET
    21                     ;include "XX24C04.ASM"
    22                     ;include "FccTest.ASM"
    23                     
    24                     ifndef XX93C46_For_EM78M611.ASM
    25                     include "XX93C46_For_EM78M611.ASM"
    26                     endif
    27                     
    28                     ;=========================================================================
    29                     	ORG                 0X0000
    30 00000 1471          	JMP                 MCU_RESET
    31                     	ORG                 0X0001        ; TCC interrupt vector
    32                   M 	PUSH                              ; save ACC,R3,R4
       00001 0054     1     MOV  A_TEMP ,A
       00002 0754     1     SWAP  A_TEMP ,
       00003 0703     1     SWAPA  3 ,
       00004 0056     1     MOV  STATUS_TEMP ,A
       00005 0704     1     SWAPA  4 ,
       00006 0055     1     MOV  RSR_TEMP ,A
       00007 00C3     1     CLR  3 ,
    33 00008 00C4          	CLR                 RSR
    34 00009 1450          	JMP                 TCC_INT_STATE
    35                     
    36                     
    37                     ;=========================================================================
    38                     ;============================ Program Code ===============================
    39                     	ORG                 0X0050
    40 00050               TCC_INT_STATE:
    41 00050 0000          	NOP
    42 00051 0C4F          	JBC                 ISR,EP0IF
    43 00052 1461          	JMP                 USB_EP0_INT
    44 00053 0CCF          	JBC                 ISR,USBRIF
    45 00054 1467          	JMP                 USB_RESET_INT
    46 00055 0C0F          	JBC                 ISR,TCCIF
    47 00056 1459          	JMP                 RF_CYCLE_INT
    48 00057 0C8F          	JBC                 ISR,USBSIF
    49 00058 1465          	JMP                 USB_SUSPEND_INT
    50 00059               RF_CYCLE_INT:
    51 00059 18D1          	MOV                 A,@(256-47)  ; N=47,P=64,f=6MHz ==> T=1ms
    52 0005A 0041          	MOV                 TCC,A
    53 0005B 080F          	BC                  ISR,TCCIF
    54 0005C 055B          	INC                 ComuClock    ; 1ms intrrupt and the master timing
    55 0005D 0557          	INC                 SystemTimeCNT
    56 0005E 1880          	MOV                 A,@0X80      ; (test)P57 exchange when intrrupt
    57 0005F 0345          	XOR                 PORT5,A
    58 00060 146B          	JMP                 INT_RET
    59 00061               USB_EP0_INT:
    60                   M 	PAGE                4
       00061 0BC3     1     BS  3 , 7 
       00062 0983     1     BC  3 , 6 
       00063 0943     1     BC  3 , 5 
    61 00064 1550          	JMP                 READ_COMMAND ; EP0 Intrrupt flag,wating for Host'CMD
    62 00065               USB_SUSPEND_INT:                     ; USB bus terminated intrrupt
    63 00065 088F          	BC                  ISR,USBSIF
    64 00066 146B          	JMP                 INT_RET
    65 00067               USB_RESET_INT:
    66 00067 1801          	MOV                 A,@0X01
    67 00068 0079          	MOV                 PROTOCOL_TEMP,A
    68 00069 08CF          	BC                  ISR,USBRIF
    69 0006A 146B          	JMP                 INT_RET
    70 0006B               INT_RET:
    71                   M 	POP                              ; restore ACC,R3,R4
       0006B 0716     1     SWAPA  STATUS_TEMP ,
       0006C 0043     1     MOV  3 ,A
       0006D 0715     1     SWAPA  RSR_TEMP ,
       0006E 0044     1     MOV  4 ,A
       0006F 0714     1     SWAPA  A_TEMP ,
    72 00070 0013          	RETI
    73                     
    74                     ;========================= START =======================================
    75 00071               MCU_RESET:
    76 00071 0011          	DISI
    77 00072 18C8          	MOV                 A,@200          ; delay 20ms
    78                   M 	PAGE                5
       00073 0BC3     1     BS  3 , 7 
       00074 0983     1     BC  3 , 6 
       00075 0B43     1     BS  3 , 5 
    79 00076 12C0          	CALL                DELAY_X100US
    80                   M 	PAGE                0
       00077 09C3     1     BC  3 , 7 
       00078 0983     1     BC  3 , 6 
       00079 0943     1     BC  3 , 5 
    81 0007A 0000          	NOP
    82                   M 	ClrRamBank
       0007B 1810     1     MOV A,@( 16 )
       0007C 0044     1     MOV  R4 ,A
       0007D 00C0     1     CLR  R0 ,
       0007E 0544     1     INC  R4 ,
       0007F 0D84     1     JBC  R4 , 6 
       00080 0B44     1     BS  R4 , 5 
       00081 0DC4     1     JBC  R4 , 7 
       00082 0B44     1     BS  R4 , 5 
       00083 0E83     1     JBS  R3 , Z 
       00084 147D     1     JMP ( $ - 7 ),
       00085 00C4     1     CLR  R4 ,
       00086 1811     1     MOV A,@( 17 )
       00087 004D     1     MOV  RD ,A
       00088 00CE     1     CLR  RE ,
       00089 1801     1     MOV A,@( 1 )
       0008A 004D     1     MOV  RD ,A
       0008B 1800     1     MOV A,@( 0 )
       0008C 004E     1     MOV  RE ,A
       0008D 004E     1     MOV  RE ,A
       0008E 004E     1     MOV  RE ,A
       0008F 004E     1     MOV  RE ,A
       00090 004E     1     MOV  RE ,A
       00091 004E     1     MOV  RE ,A
       00092 004E     1     MOV  RE ,A
       00093 004E     1     MOV  RE ,A
       00094 0B4C     1     BS  RC , 5 
    83 00095 0000          	NOP
    84                     
    85                     ;============================ I/O CONFIG ==========================
    86 00096 1830          	MOV                 A,@00110000B    ;set P50 D+/CLOCK, P51 D-/DATA pins input
    87 00097 0007          	IOW                 IOC7
    88 00098 0000          	NOP
    89 00099 1804          	MOV                 A,@00000100B
    90 0009A 0009          	IOW                 IOC9
    91 0009B 0000          	NOP
    92 0009C 1800          	MOV                 A,@00000000B
    93 0009D 0008          	IOW                 IOC8
    94 0009E 0000          	NOP
    95 0009F 1820          	MOV                 A,@00100000B    ;SET P55 INPUT
    96 000A0 0005          	IOW                 IOC5
    97 000A1 0000          	NOP
    98 000A2 1861          	MOV                 A,@01100001B	;SPI_MISO/PKT_FLAG/FIFO_FLAG -> input port
    99 000A3 0006          	IOW                 IOC6
   100 000A4 0000          	NOP
   101 000A5 18F3          	MOV                 A,@11110011B	;PULL HIGH PORT92,PORT93
   102 000A6 000D          	IOW                 IOCD
   103 000A7 0000          	NOP
   104 000A8 18D0          	MOV                 A,@11010000B	;Disable WDT,PORT (PULL HIGH)
   105 000A9 000E          	IOW                 IOCE
   106 000AA 0000          	NOP
   107 000AB 1801          	MOV                 A,@00000001B	;USB Mode
   108 000AC 000A          	IOW                 IOCA
   109 000AD 0000          	NOP
   110                     
   111                     ;============================ Intrrupt Config ==========================
   112 000AE 1868          	MOV                 A,@01101000B		; Disable WDT, TCC clock source is Main CLK   1:64
   113 000AF 0002          	CONTW				                    ; TCC 1MS overflow
   114 000B0 00C1          	CLR                 TCC                 ; Clear TCC
   115 000B1 00CF          	CLR                 ISR                 ; interrupt flag
   116 000B2 1803          	MOV                 A,@00000011B
   117 000B3 000F          	IOW                 IMR                 ; enable EP0 interrupt / enable TCC interrupt
   118 000B4 0000          	NOP
   119                     
   120                     ;=============================== Initial Equipment ==========================
   121                   M 	PAGE                5
       000B5 0BC3     1     BS  3 , 7 
       000B6 0983     1     BC  3 , 6 
       000B7 0B43     1     BS  3 , 5 
   122 000B8 0000          	NOP
   123 000B9 10BD          	CALL                EM198850_RESET          ;initial RF
   124 000BA 0000          	NOP
   125                   M 	PAGE                0
       000BB 09C3     1     BC  3 , 7 
       000BC 0983     1     BC  3 , 6 
       000BD 0943     1     BC  3 , 5 
   126                     
   127                     ;-------------------------------------------------------------------------
   128 000BE 0B06          	BS                  SPI_SS/16,SPI_SS%16                    ; Disable RF
   129 000BF 1800          	MOV                 A,@0X00
   130 000C0 0055          	MOV                 DataAddressInEEPROM,A
   131 000C1 1860          	MOV                 A,@0X60
   132 000C2 0054          	MOV                 DataAddressInMCU,A
   133                   M 	mREAD               DataAddressInEEPROM,@0,DataAddressInMCU,@16
       000C3 0414     1     MOV A, DATAADDRESSINMCU 
       000C4 0044     1     MOV  R4 ,A
                      2  M  BANK @( 0 ),
       000C5 09C4     2     BC  4 , 7 
       000C6 0984     2     BC  4 , 6 
       000C7 1810     1     MOV A,@( 16 )
       000C8 0053     1     MOV  R_ACC3 ,A
       000C9          1    ??0062$WRITE_DATA:   
                      2  M  FCALL  START_BIT 
       000C9 1300     2     CALL  START_BIT ,
       000CA 0615     1     RRCA  DATAADDRESSINEEPROM ,
       000CB 1980     1     OR A,@( READ )
       000CC 0051     1     MOV  R_ACC1 ,A
       000CD 1808     1     MOV A,@( 8 )
                      2  M  FCALL  RL_COMD 
       000CE 130F     2     CALL  RL_COMD ,
       000CF 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000D0 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       000D1 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       000D2 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       000D3 0AC6     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       000D4 14D5     1     JMP ( $ + 1 ),
       000D5 0A86     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000D6 0555     1     INC  DATAADDRESSINEEPROM ,
       000D7 08C6     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       000D8 14D9     1     JMP ( $ + 1 ),
       000D9 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000DA 14DB     1     JMP ( $ + 1 ),
       000DB 14DC     1     JMP ( $ + 1 ),
       000DC 0A86     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000DD          1    ??0062$READ_DATA1:   
       000DD 1808     1     MOV A,@( 8 )
       000DE 0052     1     MOV  R_ACC2 ,A
       000DF          1    ??0062$READ_DATA2:   
       000DF 0886     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000E0 0000     1     NOP 
       000E1 0000     1     NOP 
       000E2 0C06     1     JBC ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       000E3 0A03     1     BS  STATUS , C 
       000E4 0E06     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       000E5 0803     1     BC  STATUS , C 
       000E6 06C0     1     RLC  R0 ,
       000E7 0A86     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       000E8 14E9     1     JMP ( $ + 1 ),
       000E9 05D2     1     DJZ  R_ACC2 ,
       000EA 14DF     1     JMP  ??0062$READ_DATA2 ,
       000EB 0544     1     INC  R4 ,
       000EC 0000     1     NOP 
       000ED 0985     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       000EE 05D3     1     DJZ  R_ACC3 ,
       000EF 14C9     1     JMP  ??0062$WRITE_DATA ,
   134 000F0 0985          	BC                  AT93C46_CS/16,AT93C46_CS%16            ; Disable 93C46
   135                     
   136 000F1 11B5          	CALL                PAGE0BANK0                             ; Save ID
   137 000F2 0421          	MOV                 A,RX_IDH_Buffer
   138 000F3 11B8          	CALL                PAGE0BANK1
   139 000F4 0061          	MOV                 RX_IDH,A
   140 000F5 11B5          	CALL                PAGE0BANK0
   141 000F6 0422          	MOV                 A,RX_IDL_Buffer
   142 000F7 11B8          	CALL                PAGE0BANK1
   143 000F8 0062          	MOV                 RX_IDL,A
   144                     
   145 000F9 11B5          	CALL                PAGE0BANK0
   146 000FA 0427          	MOV                 A,TX1_ID_Buffer
   147 000FB 11B8          	CALL                PAGE0BANK1
   148 000FC 0067          	MOV                 TX1_ID,A
   149                     
   150 000FD 11B5          	CALL                PAGE0BANK0
   151 000FE 0428          	MOV                 A,TX2_ID_Buffer
   152 000FF 11B8          	CALL                PAGE0BANK1
   153 00100 0068          	MOV                 TX2_ID,A
   154                     
   155 00101 11B5          	CALL                PAGE0BANK0
   156 00102 0429          	MOV                 A,TX3_ID_Buffer
   157 00103 11B8          	CALL                PAGE0BANK1
   158 00104 0069          	MOV                 TX3_ID,A
   159                     
   160 00105 11B5          	CALL                PAGE0BANK0
   161 00106 042A          	MOV                 A,TX4_ID_Buffer
   162 00107 11B8          	CALL                PAGE0BANK1
   163 00108 006A          	MOV                 TX4_ID,A
   164                     
   165 00109 11B5          	CALL                PAGE0BANK0
   166 0010A 042B          	MOV                 A,TX5_ID_Buffer
   167 0010B 11B8          	CALL                PAGE0BANK1
   168 0010C 006B          	MOV                 TX5_ID,A
   169                     
   170 0010D 11B5          	CALL                PAGE0BANK0
   171 0010E 042C          	MOV                 A,TX6_ID_Buffer
   172 0010F 11B8          	CALL                PAGE0BANK1
   173 00110 006C          	MOV                 TX6_ID,A
   174                     
   175                     ;===========================================================================
   176 00111 11B8          	CALL                PAGE0BANK1
   177 00112 0421          	MOV                 A,RX_IDH
   178 00113 0322          	XOR                 A,RX_IDL
   179 00114 0E83          	JBS                 STATUS,Z
   180 00115 151A          	JMP                 Run_Start  ;if RX_IDH==RX_IDL should jump
   181 00116 0422          	MOV                 A,RX_IDL
   182 00117 1BFF          	XOR                 A,@0XFF
   183 00118 0C83          	JBC                 STATUS,Z   ;if RX_IDH==RX==0xff set EEpromWRStatusFlag
   184 00119 0ADE          	BS                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   185 0011A               Run_Start:
   186 0011A 0CDE          	JBC                 EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   187 0011B 1155          	CALL                Rand_ID_Function
   188                   M 	PAGE                5
       0011C 0BC3     1     BS  3 , 7 
       0011D 0983     1     BC  3 , 6 
       0011E 0B43     1     BS  3 , 5 
   189 0011F 1287          	CALL                CHANGE_ADDRESS_VALUE
   190 00120 1275          	CALL                RF_FREQ_SET	
   191                   M 	PAGE                0
       00121 09C3     1     BC  3 , 7 
       00122 0983     1     BC  3 , 6 
       00123 0943     1     BC  3 , 5 
   192 00124 11B5          	CALL                PAGE0BANK0
   193 00125 0000          	NOP
   194                     		
   195 00126 0010          	ENI
   196 00127 00DB          	CLR                 ComuClock
   197 00128 00DE          	CLR                 CommuStatusFlag
   198 00129 00DF          	CLR                 GeneralStatusFlag
   199 0012A 00E3          	CLR                 CHN_FLAG
   200 0012B 00D0          	CLR                 TEMP
   201 0012C 11B8          	CALL                PAGE0BANK1
   202                     
   203 0012D 0B5F          	BS                  KeyStatusFlag/16,KeyStatusFlag%16
   204 0012E 18FF          	MOV                 A,@0XFF
   205 0012F 0075          	MOV                 KeystokeFlag_Befor,A
   206 00130 0076          	MOV                 KeystokeTimeCNT,A
   207 00131 08C9          	BC                  LED1_STATUS/16,LED1_STATUS%16
   208 00132 1279          	CALL                SearchLinkMode_Set
   209 00133 0808          	BC                  PORT8,0
   210                     
   211 00134 18D1           	MOV                 A,@(256-47)  ; N=94,P=64,f=6MHz ==> T=1ms
   212 00135 0041          	MOV                 TCC,A        ; TCC reload by PKT pull high
   213 00136 00DB          	CLR                 ComuClock
   214 00137 1880          	MOV                 A,@0X80      ; (test)P57 exchange when intrrupt
   215 00138 0345          	XOR                 PORT5,A
   216 00139 0000           	NOP
   217                     
   218                     ;=====================================================================
   219                     ;======================== MAIN =======================================
   220                     ;=====================================================================
   221 0013A               MAIN:
   222                     
   223 0013A 0004          	WDTC
   224                   M 	PAGE                4
       0013B 0BC3     1     BS  3 , 7 
       0013C 0983     1     BC  3 , 6 
       0013D 0943     1     BC  3 , 5 
   225 0013E 12FC          	CALL                USB_MAIN
   226                   M  	PAGE                0
       0013F 09C3     1     BC  3 , 7 
       00140 0983     1     BC  3 , 6 
       00141 0943     1     BC  3 , 5 
   227 00142 1200          	CALL                SYNC_COM_TX
   228                     	
   229                   M 	PAGE                1
       00143 09C3     1     BC  3 , 7 
       00144 0983     1     BC  3 , 6 
       00145 0B43     1     BS  3 , 5 
   230 00146 1000           	CALL                RX1_FUNCTION
   231                     	if TotalGamePads==1
   232                     	PAGE                0
   233                     	JMP                 MAIN
   234                     	endif
   235                      	
   236 00147 1077           	CALL                RX2_FUNCTION
   237                     	if TotalGamePads==2
   238                     	PAGE                0
   239                     	JMP                 MAIN
   240                     	endif
   241                      	
   242 00148 10EE           	CALL                RX3_FUNCTION
   243                     	if TotalGamePads==3
   244                     	PAGE                0
   245                     	JMP                 MAIN
   246                     	endif
   247                     
   248 00149 1163           	CALL                RX4_FUNCTION
   249                     	if TotalGamePads==4
   250                     	PAGE                0
   251                     	JMP                 MAIN
   252                     	endif
   253                     
   254                   M  	PAGE                2
       0014A 09C3     1     BC  3 , 7 
       0014B 0B83     1     BS  3 , 6 
       0014C 0943     1     BC  3 , 5 
   255 0014D 1000           	CALL                RX5_FUNCTION
   256                     	if TotalGamePads==5
   257                     	PAGE                0
   258                     	JMP                 MAIN
   259                     	endif
   260                     
   261 0014E 1076           	CALL                RX6_FUNCTION
   262                     	if TotalGamePads==6
   263                   M 	PAGE                0
       0014F 09C3     1     BC  3 , 7 
       00150 0983     1     BC  3 , 6 
       00151 0943     1     BC  3 , 5 
   264 00152 153A          	JMP                 MAIN
   265                     	endif
   266                     
   267 00153 0000          	NOP
   268 00154 153A          	JMP                 MAIN
   269                     
   270                     
   271                     ;======================================================================
   272                     ;Function:     COMMAND TX setting
   273                     ;Input:        None
   274                     ;Output:       None
   275                     ;======================================================================
   276                     ;========================================================================
   277                     ; Rand RX_ID and synthesize TX1_ID,TX2_ID...TXx_ID
   278                     ;========================================================================
   279 00155               Rand_ID_Function:
   280 00155 1802          	MOV                 A,@2
   281 00156 0051          	MOV                 TEMP1,A
   282 00157 1861          	MOV                 A,@0X61
   283 00158 0052          	MOV                 TEMP2,A
   284 00159 1190          	CALL                RAND_FUCTION  ; Creat RX_IDH,RX_IDL
   285                     
   286 0015A 11B8          	CALL                PAGE0BANK1
   287 0015B 18F0          	MOV                 A,@0XF0       ; synthesize TX_IDx
   288 0015C 02A2          	AND                 A,RX_IDL
   289 0015D 0067          	MOV                 TX1_ID,A
   290 0015E 0068          	MOV                 TX2_ID,A
   291 0015F 0069          	MOV                 TX3_ID,A
   292 00160 006A          	MOV                 TX4_ID,A
   293 00161 006B          	MOV                 TX5_ID,A
   294 00162 006C          	MOV                 TX6_ID,A
   295 00163 1801          	MOV                 A,@0X01
   296 00164 03E7          	ADD                 TX1_ID,A
   297 00165 1802          	MOV                 A,@0X02
   298 00166 03E8          	ADD                 TX2_ID,A
   299 00167 1803          	MOV                 A,@0X03
   300 00168 03E9          	ADD                 TX3_ID,A
   301 00169 1804          	MOV                 A,@0X04
   302 0016A 03EA          	ADD                 TX4_ID,A
   303 0016B 1805          	MOV                 A,@0X05
   304 0016C 03EB          	ADD                 TX5_ID,A
   305 0016D 1806          	MOV                 A,@0X06
   306 0016E 03EC          	ADD                 TX6_ID,A
   307                     
   308 0016F 11B8          	CALL                PAGE0BANK1   ; write ID to buffer
   309 00170 0421          	MOV                 A,RX_IDH
   310 00171 11B5          	CALL                PAGE0BANK0
   311 00172 0061          	MOV                 RX_IDH_Buffer,A
   312 00173 11B8          	CALL                PAGE0BANK1
   313 00174 0422          	MOV                 A,RX_IDL
   314 00175 11B5          	CALL                PAGE0BANK0
   315 00176 0062          	MOV                 RX_IDL_Buffer,A
   316                     
   317 00177 11B8          	CALL                PAGE0BANK1
   318 00178 0427          	MOV                 A,TX1_ID
   319 00179 11B5          	CALL                PAGE0BANK0
   320 0017A 0067          	MOV                 TX1_ID_Buffer,A
   321 0017B 11B8          	CALL                PAGE0BANK1
   322 0017C 0428          	MOV                 A,TX2_ID
   323 0017D 11B5          	CALL                PAGE0BANK0
   324 0017E 0068          	MOV                 TX2_ID_Buffer,A
   325 0017F 11B8          	CALL                PAGE0BANK1
   326 00180 0429          	MOV                 A,TX3_ID
   327 00181 11B5          	CALL                PAGE0BANK0
   328 00182 0069          	MOV                 TX3_ID_Buffer,A
   329 00183 11B8          	CALL                PAGE0BANK1
   330 00184 042A          	MOV                 A,TX4_ID
   331 00185 11B5          	CALL                PAGE0BANK0
   332 00186 006A          	MOV                 TX4_ID_Buffer,A
   333 00187 11B8          	CALL                PAGE0BANK1
   334 00188 042B          	MOV                 A,TX5_ID
   335 00189 11B5          	CALL                PAGE0BANK0
   336 0018A 006B          	MOV                 TX5_ID_Buffer,A
   337 0018B 11B8          	CALL                PAGE0BANK1
   338 0018C 042C          	MOV                 A,TX6_ID
   339 0018D 11B5          	CALL                PAGE0BANK0
   340 0018E 006C          	MOV                 TX6_ID_Buffer,A
   341                     
   342                     
   343 0018F 0012          	RET
   344                     
   345                     ;===================================================================
   346                     ; Rand Fuction
   347                     ; Input:       Temp1(Length)
   348                     ;              Temp2(Base address)  ;
   349                     ; output:      rang data from temp2 address base
   350                     ; description: Temp (seed [operand])
   351                     
   352                     ;===================================================================
   353 00190               RAND_FUCTION:
   354 00190 0050          	MOV                 TEMP,A
   355 00191 0412          	MOV                 A,TEMP2
   356 00192 03D0          	ADD                 TEMP,A        ; save latest data as current seed
   357                     
   358 00193 00C4          	CLR                 RSR
   359 00194                 RAND_SEED_LOOP1:
   360 00194 0400          	MOV                 A,R0
   361 00195 03D0          	ADD                 TEMP,A          ; seed
   362 00196 11A9          	CALL                ArithmeticIns
   363 00197 0544          	INC                 RSR
   364 00198 0404          	MOV                 A,RSR
   365 00199 1A40          	AND                 A,@0X40         ; adding form 0x00 to bank 0
   366 0019A 1B40          	XOR                 A,@0X40
   367 0019B 0E83          	JBS                 STATUS,Z
   368 0019C 1594          	JMP                 RAND_SEED_LOOP1
   369 0019D 0400          	MOV                 A,R0
   370 0019E 03D0          	ADD                 TEMP,A          ; next seed
   371                     	MESSAGE             "adding form 0x00 to bank 0"
***     USER MESSAGE: ADDING FORM 0X00 TO BANK 0
   372                     
   373 0019F                 RAND_DATA_LOOP1:
   374 0019F 0412          	MOV                 A,TEMP2
   375 001A0 0044          	MOV                 RSR,A
   376 001A1 0410          	MOV                 A,TEMP
   377 001A2 0040          	MOV                 R0,A
   378 001A3 11A9          	CALL                ArithmeticIns
   379 001A4 0552          	INC                 TEMP2
   380 001A5 05D1          	DJZ                 TEMP1
   381 001A6 159F          	JMP                 RAND_DATA_LOOP1:
   382 001A7 0000          	NOP
   383 001A8 0012          	RET
   384                     
   385 001A9                 ArithmeticIns:
   386 001A9 06D0          	RLC         TEMP          ; X*Y+1 MOD Z
   387 001AA 06D0          	RLC         TEMP
   388 001AB 06D0          	RLC         TEMP
   389 001AC 0550          	INC         TEMP
   390 001AD 0650          	RRC         TEMP
   391 001AE 0650          	RRC         TEMP
   392 001AF 0650          	RRC         TEMP
   393 001B0 0E03          	JBS         STATUS,C
   394 001B1 0810          	BC          TEMP,0
   395 001B2 0C03          	JBC         STATUS,C
   396 001B3 0A10          	BS          TEMP,0
   397 001B4 0012          	RET
   398                     
   399                     ;=====================================================================
   400                     ; BANK exchange function
   401                     ;=====================================================================
   402 001B5               	PAGE0BANK0:
   403 001B5 09C4          		BC              0X04,7
   404 001B6 0984          		BC              0X04,6
   405 001B7 0012          	RET
   406 001B8               	PAGE0BANK1:
   407 001B8 09C4          		BC              0X04,7
   408 001B9 0B84          		BS              0X04,6
   409 001BA 0012          	RET
   410 001BB               	PAGE0BANK2:
   411 001BB 0BC4          		BS              0X04,7
   412 001BC 0984          		BC              0X04,6
   413 001BD 0012          	RET
   414 001BE               	PAGE0BANK3:
   415 001BE 0BC4          		BS              0X04,7
   416 001BF 0B84          		BS              0X04,6
   417 001C0 0012          	RET
  0 Error(s), 0 Warning(s), 1 User Message(s)