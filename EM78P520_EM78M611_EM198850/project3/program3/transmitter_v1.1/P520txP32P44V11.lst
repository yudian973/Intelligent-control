     1                     /*****************************************************************
     2                     * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3                     * Author       :  yu.wei
     4                     * Company      :  ELAN
     5                     * VERSION      :  1.1
     6                     * CRYSTAL      :  8MHZ
     7                     * Creat date   :  2009/11/4
     8                     * tool ver.    :  WicePlus 2.7/eUIDE
     9                     * Description  :  modify for code conformity
    10                     *****************************************************************/
    11                     ;-----------------------------------------------------------------
    12                     include "D:\include\EM78xx\EM78P520.H"
     1            C        ;******************************************************;
     2            C        ;                                                      ;
     3            C        ;  Tilte:       EM78x510xx include file                ;
     4            C        ;  Description: The Definition of EM78x510xx Registers ;
     5            C        ;  Company:     Elan Electronic Corp.                  ;
     6            C        ;  Author:      hongxi.tang                            ;
     7            C        ;  Date:        24/05/2006                             ;
     8            C        ;  Version:     v1.0                                   ;
     9            C        ;                                                      ;
    10            C        ;******************************************************;
    11            C        ;
    12            C        ;======================================================;
    13            C        ; Operational Registers Define                         ;
    14            C        ;======================================================;
    15            C        EM78P520.H    EQU    EM78P520.H
    16            C        
    17            C        ;
    18            C        ;======================================================;
    19            C        ; Register R0~R4                                       ;
    20            C        ;======================================================;
    21            C        ;
    22            C        ; Indirect Addressing register
    23            C        ;
    24       0000 C         R0     ==    0x00
    25       0000 C         IAR    ==    0x00
    26            C        ;
    27            C        ; Time Clock/Counter
    28            C        ;
    29       0001 C         R1     ==    0x01
    30       0001 C         TCC    ==    0x01    ; TCC Counter Preset
    31            C        ;
    32            C        ; Program Counter
    33            C        ;
    34       0002 C         R2     ==    0X02
    35       0002 C         PC     ==    0X02
    36            C        ;
    37            C        ; Status Register and Voltage Detect
    38            C        ;
    39       0003 C         R3    ==    0X03
    40       0003 C         SR    ==    0X03
    41       0003 C         STATUS	==	0x03
    42            C        ;
    43            C             ;{
    44       0007 C             	 LVDEN	==    0x07    ; Voltage Detect Enable Bit
    45       0006 C                 LVDS1	==    0x06    ; Detect Voltage Select Bit[1]
    46       0005 C                 LVDS0	==    0x05    ; Detect Voltage Select Bit[0]
    47            C                                       ;
    48            C                                       ; |-------|-------|----------------|
    49            C                                       ; | LVDS1 | LVDS0 | Detect Voltage |
    50            C                                       ; |-------|-------|----------------|
    51            C                                       ; |   0   |   0   |      2.4V      |
    52            C                                       ; |   0   |   1   |      2.7V      |
    53            C                                       ; |   1   |   0   |      3.3V      |
    54            C                                       ; |   1   |   1   |      3.9V      |
    55            C                                       ; |-------|-------|----------------|
    56            C                                       ;
    57       0004 C                 T       ==    0x04    ; Time-Out Bit
    58       0003 C                 P       ==    0x03    ; Power Down Bit
    59       0002 C                 Z       ==    0x02    ; Zero Flag
    60       0001 C                 DC      ==    0x01    ; Auxiliary Carry Flag
    61       0000 C                 C       ==    0x00    ; Carry Flag
    62            C                                       ;
    63            C             ;}
    64            C        ;
    65            C        ; RAM Select Register (RSR)
    66            C        ;
    67       0004 C         R4     ==    0X04
    68       0004 C         RSR    ==    0X04
    69            C             ;{
    70            C                                        ; Bits 5~0 are used to select up to 64 registers in the
    71            C                                        ; indirect addressing mode.
    72            C                                        ;
    73       0007 C                 VDB	  ==    0x07    ; Voltage Detector
    74       0006 C                 BNC      ==    0x06    ; Bank Control Register
    75            C                                        ;
    76       0005 C                 RSR5     ==    0x05    ;
    77       0004 C                 RSR4     ==    0x04    ;
    78       0003 C                 RSR3     ==    0x03    ;
    79       0002 C                 RSR2     ==    0x02    ;
    80       0001 C                 RSR1     ==    0x01    ;
    81       0000 C                 RSR0     ==    0x00    ;
    82            C                                        ;
    83            C             ;}
    84            C        ;======================================================;
    85            C        ; Bank0~6 Register R5~RF                               ;
    86            C        ;======================================================;
    87            C        ;
    88            C        ; Bank0 R5(RAM Bank Select Register)
    89            C        ;
    90       0005 C         B0_R5    ==	0X05
    91       0005 C         BSR      ==    0X05
    92            C        ;
    93            C             ;{
    94            C             				    ; Bit3~7 is "0"
    95       0002 C                 BS2          ==    0x02    ; RAM Bank Select Register Bits[2]
    96       0001 C                 BS1          ==    0x01    ; RAM Bank Select Register Bits[1]
    97       0000 C                 BS0          ==    0x00    ; RAM Bank Select Register Bits[0]
    98            C             ;}
    99            C        ;
   100            C        ; Bank 0 R6(Program Page Select Register)
   101            C        ;
   102       0006 C         B0_R6    ==    0X06
   103       0006 C         PSR      ==    0X06
   104            C        ;
   105            C             ;{
   106            C             			       ; Bit3~7 is "0"
   107       0002 C                 PS2     ==    0x02    ; Program Page Select Register Bits[2]
   108       0001 C                 PS1     ==    0x01    ; Program Page Select Register Bits[1]
   109       0000 C                 PS0     ==    0x00    ; Program Page Select Register Bits[0]
   110            C             ;}
   111            C        ;
   112            C        ; Bank0 R7(Port 7 data Register)
   113            C        ;
   114       0007 C         B0_R7    ==    0X07
   115       0007 C         PORT7    ==    0X07
   116            C        ;
   117            C             ;{
   118       0007 C                 R77     ==    0x07    ; I/O data of P7.7
   119       0006 C                 R76     ==    0x06    ; I/O data of P7.6
   120       0005 C                 R75     ==    0x05    ; I/O data of P7.5
   121       0004 C                 R74     ==    0x04    ; I/O data of P7.4
   122       0003 C                 R73     ==    0x03    ; I/O data of P7.3
   123       0002 C                 R72     ==    0x02    ; I/O data of P7.2
   124       0001 C                 R71     ==    0x01    ; I/O data of P7.1
   125       0000 C                 R70     ==    0x00    ; I/O data of P7.0
   126            C             ;}
   127            C        ;
   128            C        ; Bank0 R8(Port 8 data Register)
   129            C        ;
   130       0008 C         B0_R8    ==    0X08
   131       0008 C         PORT8    ==    0X08
   132            C        ;
   133            C             ;{
   134       0007 C                 R87     ==    0x07    ; I/O data of P8.7
   135       0006 C                 R86     ==    0x06    ; I/O data of P8.6
   136       0005 C                 R85     ==    0x05    ; I/O data of P8.5
   137       0004 C                 R84     ==    0x04    ; I/O data of P8.4
   138       0003 C                 R83     ==    0x03    ; I/O data of P8.3
   139       0002 C                 R82     ==    0x02    ; I/O data of P8.2
   140       0001 C                 R81     ==    0x01    ; I/O data of P8.1
   141       0000 C                 R80     ==    0x00    ; I/O data of P8.0
   142            C             ;}
   143            C        ;
   144            C        ; Bank0 R9(PORT 9 Data Register)
   145            C        ;
   146       0009 C         B0_R9    ==    0X09
   147       0009 C         PORT9    ==    0X09
   148            C        ;
   149            C             ;{
   150       0007 C                 R97     ==    0x07    ; I/O data of P9.7
   151       0006 C                 R96     ==    0x06    ; I/O data of P9.6
   152       0005 C                 R95     ==    0x05    ; I/O data of P9.5
   153       0004 C                 R94     ==    0x04    ; I/O data of P9.4
   154       0003 C                 R93     ==    0x03    ; I/O data of P9.3
   155       0002 C                 R92     ==    0x02    ; I/O data of P9.2
   156       0001 C                 R91     ==    0x01    ; I/O data of P9.1
   157       0000 C                 R90     ==    0X00    ; I/O data of P9.0
   158            C             ;}
   159            C        ;
   160            C        ;  Bank0 RA(PORTA Data Register)
   161            C        ;
   162       000A C         B0_RA	  ==	0X0A
   163       000A C         PORTA	  ==	0X0A
   164            C        ;
   165            C        	;{
   166       0007 C        		RA7	==	0X07	; I/O Data of PA.7
   167       0006 C        		RA6	==	0X06 	; I/O Data of PA.6
   168       0005 C        		RA5	==	0X05	; I/O Data of PA.5
   169       0004 C        		RA4	==	0X04	; I/O Data of PA.4
   170       0003 C        		RA3	==	0X03	; I/O Data of PA.3
   171       0002 C        		RA2	==	0X02	; I/O Data of PA.2
   172       0001 C        		RA1	==	0X01	; I/O Data of PA.1
   173       0000 C        		RA0	==	0X00	; I/O Data of PA.0
   174            C        	;}
   175            C        ;
   176            C        ;  Bank0 RB(PORT8 Data Register)
   177            C        ;
   178       000B C         B0_RB	==	0X0B
   179       000B C         PORTB	==	0X0B
   180            C        ;
   181            C        	;{
   182       0007 C        		RB7	==	0X07	; I/O Data of PB.7
   183       0006 C        		RB6	==	0X06 	; I/O Data of PB.6
   184       0005 C        		RB5	==	0X05	; I/O Data of PB.5
   185       0004 C        		RB4	==	0X04	; I/O Data of PB.4
   186       0003 C        		RB3	==	0X03	; I/O Data of PB.3
   187       0002 C        		RB2	==	0X02	; I/O Data of PB.2
   188       0001 C        		RB1	==	0X01	; I/O Data of PB.1
   189       0000 C        		RB0	==	0X00	; I/O Data of PB.0
   190            C        	;}
   191            C        ;
   192            C        ;  Bank0 RC(System Clock Control Register)
   193            C        ;
   194       000C C         B0_RC	==	0X0C
   195       000C C         SCCR	==	0X0C
   196            C        ;
   197            C        	;{
   198            C        				 ; Bit7 is "0"
   199       0006 C        		CLK2	==  0X06 ;
   200       0005 C        		CLK1	==  0X05 ;
   201       0004 C        		CLK0	==  0X04 ; Main Clock Select Bit for PLL Mode
   202            C        				 ; |------|------|------|------------|---------------|
   203            C        				 ; | CLK2 | CLK1 | CLK0 | Main Clock | Ex:Fs=32.768k |
   204            C        				 ; |------|------|------|------------|---------------|
   205            C        				 ; |  0   |  0   |  0   |   Fs*122   |   3.997 MHz   |
   206            C        				 ; |------|------|------|------------|---------------|
   207            C        				 ; |  0   |  0   |  1   |    Fs*61   |   1.998 MHz   |
   208            C        				 ; |------|------|------|------------|---------------|
   209            C        				 ; |  0   |  1   |  0   |   Fs*61/2  |   0.999 MHz   |
   210            C        				 ; |------|------|------|------------|---------------|
   211            C        				 ; |  0   |  1   |  1   |   Fs*61/4  |   499.7 kHz   |
   212            C        				 ; |------|------|------|------------|---------------|
   213            C        				 ; |  1   |  0   |  0   |   Fs*244   |   7.995 MHz   |
   214            C        				 ; |------|------|------|------------|---------------|
   215            C        				 ; |  1   |  0   |  1   |   Fs*366   |   11.99 MHz   |
   216            C        				 ; |------|------|------|------------|---------------|
   217            C        				 ; |  1   |  1   |  X   |   Fs*488   |   15.99 MHz   |
   218            C        				 ; |------|------|------|------------|---------------|
   219       0003 C        		IDLE	==  0X03 ; Idle Mode Enable Bit.
   220            C        		 		 ; IDLE="0"+SLEP instruction=>sleep mode
   221            C        		 		 ; IDLE="1"+SLEP instruction=>idle mode
   222       0002 C        		BF1	==  0x02 ;
   223       0001 C        		BF0	==  0x01 ; LCD Booster Frequency Select Bit.
   224            C        				 ; |-----|-----|-------------------|
   225            C        				 ; | BF1 | BF0 | Booster frequency |
   226            C        				 ; |-----|-----|-------------------|
   227            C        				 ; |  0  |  0  |        Fs         |
   228            C        				 ; |-----|-----|-------------------|
   229            C        				 ; |  0  |  1  |       Fs/4        |
   230            C        				 ; |-----|-----|-------------------|
   231            C        				 ; |  1  |  0  |       Fs/8        |
   232            C        				 ; |-----|-----|-------------------|
   233            C        				 ; |  1  |  1  |       Fs/16       |
   234            C        				 ; |-----|-----|-------------------|
   235       0000 C        		CPUS	==  0x00 ; CPU Oscillator Source Select.
   236            C        				 ; 0/1=>sub-oscillator(fs)/main oscillator(fm)
   237            C        	;}
   238            C        ;
   239            C        ; Bank0 RD(TCC and WDT Timer control register)
   240            C        ;
   241       000D C         B0_RD	==	0X0D
   242       000D C         TWTCR	==	0X0D
   243            C        ;
   244            C        	;{
   245       0007 C        		WDTE	==  0X07 ; Watchdog Timer Enable.0/1=>disable/enable
   246       0006 C        		WPSR2	==  0X06
   247       0005 C        		WPSR1	==  0X05
   248       0004 C        		WPSR0	==  0X04 ; WDT Prescaler Bits
   249            C        				 ; |-----|-----|-----|-----------|
   250            C        				 ; |WPSR2|WPSR1|WPSR0| Prescaler |
   251            C        				 ; |-----|-----|-----|-----------|
   252            C        				 ; |  0  |  0  |  0  |    1:1    |
   253            C        				 ; |-----|-----|-----|-----------|
   254            C        				 ; |  0  |  0  |  1  |    1:2    |
   255            C        				 ; |-----|-----|-----|-----------|
   256            C        				 ; |  0  |  1  |  0  |    1:4    |
   257            C        				 ; |-----|-----|-----|-----------|
   258            C        				 ; |  0  |  1  |  1  |    1:8    |
   259            C        				 ; |-----|-----|-----|-----------|
   260            C        				 ; |  1  |  0  |  0  |   1:16    |
   261            C        				 ; |-----|-----|-----|-----------|
   262            C        				 ; |  1  |  0  |  1  |   1:32    |
   263            C        				 ; |-----|-----|-----|-----------|
   264            C        				 ; |  1  |  1  |  0  |   1:64    |
   265            C        				 ; |-----|-----|-----|-----------|
   266            C        				 ; |  1  |  1  |  1  |   1:128   |
   267            C        				 ; |-----|-----|-----|-----------|
   268       0003 C        		TCCS	==  0x03 ; TCC Clock Source Select Bit.0/1=>Fm/Fs
   269       0002 C        		TPSR2	==  0x02
   270       0001 C        		TPSR1	==  0X01
   271       0000 C        		TPSR0	==  0X00 ; TCC Prescaler Bits
   272            C        				 ; |-----|-----|-----|-----------|
   273            C        				 ; |TPSR2|TPSR1|TPSR0| Prescaler |
   274            C        				 ; |-----|-----|-----|-----------|
   275            C        				 ; |  0  |  0  |  0  |    1:2    |
   276            C        				 ; |-----|-----|-----|-----------|
   277            C        				 ; |  0  |  0  |  1  |    1:4    |
   278            C        				 ; |-----|-----|-----|-----------|
   279            C        				 ; |  0  |  1  |  0  |    1:8    |
   280            C        				 ; |-----|-----|-----|-----------|
   281            C        				 ; |  0  |  1  |  1  |   1:16    |
   282            C        				 ; |-----|-----|-----|-----------|
   283            C        				 ; |  1  |  0  |  0  |   1:32    |
   284            C        				 ; |-----|-----|-----|-----------|
   285            C        				 ; |  1  |  0  |  1  |   1:64    |
   286            C        				 ; |-----|-----|-----|-----------|
   287            C        				 ; |  1  |  1  |  0  |   1:128   |
   288            C        				 ; |-----|-----|-----|-----------|
   289            C        				 ; |  1  |  1  |  1  |   1:256   |
   290            C        				 ; |-----|-----|-----|-----------|
   291            C        	;}
   292            C        ;
   293            C        ; Bank0 RE (Interrupt Mask Register)
   294            C        ;
   295       000E C         B0_RE	==	0X0E
   296       000E C         RE	==	0X0E							;ADD
   297       000E C         IMR	==	0X0E
   298            C        ;
   299            C        	;{
   300       0007 C        		T1IE	==  0X07 ; Timer1 Interrupt Enable Bit
   301       0006 C        		LVDIE   ==  0X06 ; low Voltage Detect Interrupt Enable Bit
   302       0005 C        		ADIE	==  0X05 ; A/D convert Interrupt Enable Bit
   303       0004 C        		SPIE    ==  0X04 ; SPI transfer Interrupt Enable Bit
   304       0003 C        		URTIE	==  0X03 ; UART transmit Interrupt Enable Bit
   305       0002 C        		EXIE9	==  0X02 ; External interrupt 9 Enable Bit
   306       0001 C        		EXIE8	==  0X01 ; External interrupt 8 Enable Bit
   307       0000 C        		TCIE	==  0X00 ; TCC Overflow Interrupt Enable Bit
   308            C        	;}
   309            C        ;
   310            C        ;  Bank0 RF (Interrupt Status Register)
   311            C        ;
   312       000F C         B0_RF	==	0X0F
   313       000F C         RF     ==  0x0F
   314       000F C         ISR	==	0X0F
   315            C        ;
   316            C        	;{
   317       0007 C        		T1IF	==  0X07 ; interrupt flag of timer1 interrupt
   318       0006 C        		LVDIF	==  0X06 ; interrupt flag of low voltage detector interrupt
   319       0005 C        		ADIF	==  0X05 ; interrupt flag of A/D convert Complete
   320       0004 C        		SPIF	==  0X04 ; interrupt flag of SPI transfer complete
   321       0003 C        		URTIF	==  0X03 ; interrupt flag of UART transfer complete
   322       0002 C        		EXIF9	==  0X02 ; interrupt flag of external interrupt 9 Occur.
   323       0001 C        		EXIF8	==  0X01 ; interrupt flag of external interrupt 8 Occur.
   324       0000 C        		TCIF	==  0X00 ; interrupt flag of TCC Overflow
   325            C        	;}
   326            C        ;
   327            C        ;  Bank1 R5 (LCD Control Register)
   328            C        ;
   329       0005 C         B1_R5	==	0X05
   330       0005 C         LCDCR	==	0X05
   331            C        ;
   332            C        	;{
   333       0007 C        		LCDEN	==  0X07 ; lCD Enable Select Bit.0/1=>disable/enable
   334       0006 C        		LCDTYPE	==  0X06 ; LCD Drive Waveform Type Select Bit
   335       0005 C        		LBS1	==  0x05
   336       0004 C        		LBS0	==  0x04 ; LCD Bias Select Bits
   337            C        				 ; |---|---|---------------|
   338            C        				 ; |BS1|BS0|LCD Bias Select|
   339            C        				 ; |---|---|---------------|
   340            C        				 ; | 0 | 0 |   1/2 Bias    |
   341            C        				 ; |---|---|---------------|
   342            C        				 ; | 0 | 1 |   1/3 Bias    |
   343            C        				 ; |---|---|---------------|
   344            C        				 ; | 1 | X |   1/4 Bias    |
   345            C        				 ; |---|---|---------------|
   346       0003 C        		DS1	==  0x03
   347       0002 C        		DS0	==  0x02 ; LCD Duty Select Bits
   348            C        				 ; |---|---|---------------|
   349            C        				 ; |DS1|DS0|LCD Duty Select|
   350            C        				 ; |---|---|---------------|
   351            C        				 ; | 0 | 0 |    Static     |
   352            C        				 ; |---|---|---------------|
   353            C        				 ; | 0 | 1 |   1/3 Duty    |
   354            C        				 ; |---|---|---------------|
   355            C        				 ; | 1 | 0 |   1/4 Duty    |
   356            C        				 ; |---|---|---------------|
   357            C        				 ; | 1 | 1 |   1/8 Duty    |
   358            C        				 ; |---|---|---------------|
   359       0001 C        		LCDF1	==  0x01 ;
   360       0000 C        		LCDF0	==  0x00 ; LCD Frame Frequency Control Bits
   361            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   362            C        				 ; |LCDF1|LCDF0|     Static    |    1/3 Duty   |    1/4 Duty   |   1/8 Duty   |
   363            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   364            C        				 ; |  0  |  0  |Fs/(512*1)=64.0|Fs/(172*3)=63.5|Fs/(128*4)=64.0|Fs/(64*8)=64.0|
   365            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   366            C        				 ; |  0  |  1  |Fs/(560*1)=58.5|Fs/(188*3)=58.0|Fs/(140*4)=58.5|Fs/(70*8)=58.5|
   367            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   368            C        				 ; |  1  |  0  |Fs/(608*1)=53.9|Fs/(204*3)=53.5|Fs/(152*4)=53.9|Fs/(76*8)=53.9|
   369            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   370            C        				 ; |  1  |  1  |Fs/(464*1)=70.6|Fs/(156*3)=70.0|Fs/(116*4)=70.6|Fs/(58*8)=70.6|
   371            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   372            C        	;}
   373            C        ;
   374            C        ;  Bank1 R6 (LCD Address Register)
   375            C        ;
   376       0006 C         B1_R6	==    0X06
   377       0006 C         LCDAR	==    0X06
   378            C        ;
   379            C        	;{
   380            C        				 ; Bit5~7 is "0"
   381       0004 C        		LCD_A4	==  0x04 ; LCD RAM Address:00H~16H
   382       0003 C        		LCD_A3	==  0x03
   383       0002 C        		LCD_A2  ==  0x02
   384       0001 C        		LCD_A1	==  0x01
   385       0000 C        		LCD_A0	==  0x00
   386            C        	;}
   387            C        ;
   388            C        ; Bank1 R7 (LCD Data Buffer)
   389            C        ;
   390       0007 C         B1_R7	==    0X07
   391       0007 C         LCDBR	==    0X07
   392            C        ;
   393            C        	;{
   394       0007 C        		LCD_D7	==  0x07
   395       0006 C        		LCD_D6	==  0x06
   396       0005 C        		LCD_D5	==  0x05
   397       0004 C        		LCD_D4	==  0x04
   398       0003 C        		LCD_D3	==  0x03
   399       0002 C        		LCD_D2	==  0x02
   400       0001 C        		LCD_D1	==  0x01
   401       0000 C        		LCD_D0	==  0x00
   402            C        	;}
   403            C        ;
   404            C        ;  Bank1 R8 (LCD Voltage Control Register)
   405            C        ;
   406       0008 C         B1_R8	==	0x08
   407       0008 C         LCDVCR	==	0x08
   408            C        ;
   409            C        	;{
   410            C        				 ; Bit5~6 is "0"
   411       0004 C        		LCDC1	==  0x04
   412       0003 C        		LCDC0	==  0x03 ; LCD Clock
   413            C        				 ; |-----|-----|------|--------|
   414            C        				 ; |LCDC1|LCDC0|  Fm  |  Flcd  |
   415            C        				 ; |-----|-----|------|--------|
   416            C        				 ; |  0  |  0  | 16M  | Fc/2^9 |
   417            C        				 ; |-----|-----|------|--------|
   418            C        				 ; |  0  |  1  |  8M  | Fc/2^8 |
   419            C        				 ; |-----|-----|------|--------|
   420            C        				 ; |  1  |  0  |  4M  | Fc/2^7 |
   421            C        				 ; |-----|-----|------|--------|
   422            C        				 ; |  1  |  1  |  2M  | Fc/2^6 |
   423            C        				 ; |-----|-----|------|--------|
   424       0002 C        		LCDVC2	==  0x02
   425       0001 C        		LCDVC1	==  0x01
   426       0000 C        		LCDVC0	==  0x00 ; LCD Voltage Control Bits
   427            C        				 ; |------|------|------|--------------|
   428            C        				 ; |LCDVC2|LCDVC1|LCDVC0|    Output    |
   429            C        				 ; |------|------|------|--------------|
   430            C        				 ; |   0  |   0  |   0  |  0.4VDD~VDD  |
   431            C        				 ; |------|------|------|--------------|
   432            C        				 ; |   0  |   0  |   1  | 0.34VDD~VDD  |
   433            C        				 ; |------|------|------|--------------|
   434            C        				 ; |   0  |   1  |   0  | 0.26VDD~VDD  |
   435            C        				 ; |------|------|------|--------------|
   436            C        				 ; |   0  |   1  |   1  | 0.18VDD~VDD  |
   437            C        				 ; |------|------|------|--------------|
   438            C        				 ; |   1  |   0  |   0  | 0.13VDD~VDD  |
   439            C        				 ; |------|------|------|--------------|
   440            C        				 ; |   1  |   0  |   1  | 0.07VDD~VDD  |
   441            C        				 ; |------|------|------|--------------|
   442            C        				 ; |   1  |   1  |   0  | 0.04VDD~VDD  |
   443            C        				 ; |------|------|------|--------------|
   444            C        				 ; |   1  |   1  |   1  |    0V~VDD    |
   445            C        				 ; |------|------|------|--------------|
   446            C        	;}
   447            C        ;
   448            C        ;  Bank1 R9 (LCD Com Control Register)
   449            C        ;
   450       0009 C         B1_R9	==	0x09
   451       0009 C         LCDCCR	==	0x09
   452            C        ;
   453            C        	;{
   454       0007 C        		COM7	==  0x07 ; 0:I/O Function,1:LCD common driver pin.
   455       0006 C        		COM6	==  0x06
   456       0005 C        		COM5	==  0x05
   457       0004 C        		COM4	==  0x04
   458       0003 C        		COM3	==  0x03
   459       0002 C        		COM2	==  0x02
   460       0001 C        		COM1	==  0x01
   461       0000 C        		COM0	==  0x00
   462            C        	;}
   463            C        ;
   464            C        ;  Bank1 RA (LCD Segment Control Register0)
   465            C        ;
   466       000A C         B1_RA		==	0X0A
   467       000A C         LCDSCR0	==	0X0A
   468            C        ;
   469            C        	;{
   470       0007 C        		SEG7	==  0X07 ; LCD Segment7 Control Bit.0:I/O,1:LCD Driver pin.
   471       0006 C        		SEG6	==  0X06 ; LCD Segment6 Control Bit.0:I/O,1:LCD Driver pin.
   472       0005 C        		SEG5	==  0X05 ; LCD Segment5 Control Bit.0:I/O,1:LCD Driver pin.
   473       0004 C        		SEG4	==  0X04 ; LCD Segment4 Control Bit.0:I/O,1:LCD Driver pin.
   474       0003 C        		SEG3	==  0X03 ; LCD Segment3 Control Bit.0:I/O,1:LCD Driver pin.
   475       0002 C        		SEG2	==  0X02 ; LCD Segment2 Control Bit.0:I/O,1:LCD Driver pin.
   476       0001 C        		SEG1	==  0X01 ; LCD Segment1 Control Bit.0:I/O,1:LCD Driver pin.
   477       0000 C        		SEG0	==  0X00 ; LCD Segment0 Control Bit.0:I/O,1:LCD Driver pin.
   478            C        	;}
   479            C        ;
   480            C        ;  Bank1 RB (LCD Segment Control Register1)
   481            C        ;
   482       000B C         B1_RB		==	0X0B
   483       000B C         LCDSCR1	==	0X0B
   484            C        ;
   485            C        	;{
   486       0007 C        		SEG15	==  0X07 ; LCD Segment15 Control Bit.0:I/O,1:LCD Driver pin.
   487       0006 C        		SEG14	==  0X06 ; LCD Segment14 Control Bit.0:I/O,1:LCD Driver pin.
   488       0005 C        		SEG13	==  0X05 ; LCD Segment13 Control Bit.0:I/O,1:LCD Driver pin.
   489       0004 C        		SEG12	==  0X04 ; LCD Segment12 Control Bit.0:I/O,1:LCD Driver pin.
   490       0003 C        		SEG11	==  0X03 ; LCD Segment11 Control Bit.0:I/O,1:LCD Driver pin.
   491       0002 C        		SEG10	==  0X02 ; LCD Segment10 Control Bit.0:I/O,1:LCD Driver pin.
   492       0001 C        		SEG9	==  0X01 ; LCD Segment9 Control Bit.0:I/O,1:LCD Driver pin.
   493       0000 C        		SEG8	==  0X00 ; LCD Segment8 Control Bit.0:I/O,1:LCD Driver pin.
   494            C        	;}
   495            C        ;
   496            C        ;  Bank1 RC (LCD Segment Control Register2)
   497            C        ;
   498       000C C         B1_RC		==	0X0C
   499       000C C         LCDSCR2	==	0X0C
   500            C        ;
   501            C        	;{
   502            C        				 ; Bit7 not used
   503       0006 C        		SEG22	==  0X06 ; LCD Segment22 Control Bit.0:I/O,1:LCD Driver pin.
   504       0005 C        		SEG21	==  0X05 ; LCD Segment21 Control Bit.0:I/O,1:LCD Driver pin.
   505       0004 C        		SEG20	==  0X04 ; LCD Segment20 Control Bit.0:I/O,1:LCD Driver pin.
   506       0003 C        		SEG19	==  0X03 ; LCD Segment19 Control Bit.0:I/O,1:LCD Driver pin.
   507       0002 C        		SEG18	==  0X02 ; LCD Segment18 Control Bit.0:I/O,1:LCD Driver pin.
   508       0001 C        		SEG17	==  0X01 ; LCD Segment17 Control Bit.0:I/O,1:LCD Driver pin.
   509       0000 C        		SEG16	==  0X00 ; LCD Segment16 Control Bit.0:I/O,1:LCD Driver pin.
   510            C        	;}
   511            C        ;
   512            C        ;  Bank1 RE (External Interrupt Mask Register)
   513            C        ;
   514       000E C         B1_RE	==	0X0E
   515       000E C         EIMR	==	0X0E
   516            C        ;
   517            C        	;{
   518       0007 C        		EXIE7	==  0x07 ; /INT7 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   519       0006 C        		EXIE6	==  0x06 ; /INT6 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   520       0005 C        		EXIE5	==  0x05 ; /INT5 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   521       0004 C        		EXIE4	==  0x04 ; /INT4 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   522       0003 C        		EXIE3	==  0x03 ; /INT3 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   523       0002 C        		EXIE2	==  0x02 ; /INT2 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   524       0001 C        		EXIE1	==  0x01 ; /INT1 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   525       0000 C        		EXIE0	==  0x00 ; /INT0 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   526            C        	;}
   527            C        ;
   528            C        ;  Bank1 RF (External Interrupt Status Register)
   529            C        ;
   530       000F C         B1_RF	==	0X0F
   531       000F C         EISR	==	0X0F
   532            C        ;
   533            C        	;{
   534       0007 C        		EXIF7	==  0x07 ; /INT7 Interrupt Flag Bit.
   535       0006 C        		EXIF6	==  0x06 ; /INT6 Interrupt Flag Bit.
   536       0005 C        		EXIF5	==  0x05 ; /INT5 Interrupt Flag Bit.
   537       0004 C        		EXIF4	==  0x04 ; /INT4 Interrupt Flag Bit.
   538       0003 C        		EXIF3	==  0x03 ; /INT3 Interrupt Flag Bit.
   539       0002 C        		EXIF2	==  0x02 ; /INT2 Interrupt Flag Bit.
   540       0001 C        		EXIF1	==  0x01 ; /INT1 Interrupt Flag Bit.
   541       0000 C        		EXIF0	==  0x00 ; /INT0 Interrupt Flag Bit.
   542            C        	;}
   543            C        ;
   544            C        ;  Bank2 R5 (Timer1 Control Register)
   545            C        ;
   546       0005 C         B2_R5	==	0X05
   547       0005 C         T1CR	==	0X05
   548            C        ;
   549            C        	;{
   550       0007 C        		T1S1	==  0x07
   551       0006 C        		T1S0	==  0x06 ; Timer1 and Timer2 Interrupt Type Select Bits.
   552            C        				 ; |----|----|---------------------------------------|
   553            C        				 ; |T1S1|T1S0|Timer1 and Timer2 Interrupt Type Select|
   554            C        				 ; |----|----|---------------------------------------|
   555            C        				 ; |  0 |  0 |           T1PD underflow              |
   556            C        				 ; |----|----|---------------------------------------|
   557            C        				 ; |  0 |  1 |           T1TD underflow              |
   558            C        				 ; |----|----|---------------------------------------|
   559            C        				 ; |  1 |  X |      T1PD and T1TD underflow          |
   560            C        				 ; |----|----|---------------------------------------|
   561       0005 C        		T1MS2	==  0x05
   562       0004 C        		T1MS1	==  0x04
   563       0003 C        		T1MS0	==  0x03 ; Timer1 Operation Mode Select Bits
   564            C        				 ; |-----|-----|-----|-------------------------|
   565            C        				 ; |T1MS2|T1MS1|T1MS0|   Timer1 Mode Select    |
   566            C        				 ; |-----|-----|-----|-------------------------|
   567            C        				 ; |  0  |  0  |  0  |         Timer1          |
   568            C        				 ; |-----|-----|-----|-------------------------|
   569            C        				 ; |  0  |  0  |  1  |        T1OUT Mode       |
   570            C        				 ; |-----|-----|-----|-------------------------|
   571            C        				 ; |  0  |  1  |  0  |Capture Mode Rising Edge |
   572            C        				 ; |-----|-----|-----|-------------------------|
   573            C        				 ; |  0  |  1  |  1  |Capture Mode Falling Edge|
   574            C        				 ; |-----|-----|-----|-------------------------|
   575            C        				 ; |  1  |  0  |  0  |UART Baud Rate Generator |
   576            C        				 ; |-----|-----|-----|-------------------------|
   577            C        				 ; |  1  |  0  |  1  |                         |
   578            C        				 ; |-----|-----|-----|                         |
   579            C        				 ; |  1  |  1  |  0  |          PWM1           |
   580            C        				 ; |-----|-----|-----|                         |
   581            C        				 ; |  1  |  1  |  1  |                         |
   582            C        				 ; |-----|-----|-----|-------------------------|
   583       0002 C        		T1P2	==  0x02
   584       0001 C        		T1P1	==  0x01
   585       0000 C        		T1P0	==  0x00 ; Timer1 Prescaler Bits
   586            C        				 ; |-----|-----|-----|-----------------|
   587            C        				 ; | T1P2| T1P1| T1P0|   Prescalaer    |
   588            C        				 ; |-----|-----|-----|-----------------|
   589            C        				 ; |  0  |  0  |  0  |      1:2        |
   590            C        				 ; |-----|-----|-----|-----------------|
   591            C        				 ; |  0  |  0  |  1  |      1:4        |
   592            C        				 ; |-----|-----|-----|-----------------|
   593            C        				 ; |  0  |  1  |  0  |	    1:8        |
   594            C        				 ; |-----|-----|-----|-----------------|
   595            C        				 ; |  0  |  1  |  1  |      1:16       |
   596            C        				 ; |-----|-----|-----|-----------------|
   597            C        				 ; |  1  |  0  |  0  |      1:32       |
   598            C        				 ; |-----|-----|-----|-----------------|
   599            C        				 ; |  1  |  0  |  1  |      1:64       |
   600            C        				 ; |-----|-----|-----|-----------------|                         |
   601            C        				 ; |  1  |  1  |  0  |      1:128      |
   602            C        				 ; |-----|-----|-----|-----------------|
   603            C        				 ; |  1  |  1  |  1  |      1:256      |
   604            C        				 ; |-----|-----|-----|-----------------|
   605            C        	;}
   606            C        ;
   607            C        ;  Bank2 R6 (Timer Status Register)
   608            C        ;
   609       0006 C         B2_R6	==	0X06
   610       0006 C         TSR	==	0X06
   611            C        ;
   612            C        	;{
   613       0007 C        		T1MOD	==  0X07 ; Timer Operates Mode Select Bit.
   614       0006 C        		TRCB	==  0x06 ; Timer1,2 Read Control Bit.
   615       0005 C        		T1CSS1	==  0x05 ;
   616       0004 C        		T1CSS0	==  0x04 ; Timer1 Clock Source Select Bits
   617            C        				 ; |------|------|--------------------------|
   618            C        				 ; |T1CSS1|T1CSS0|Timer1 Clock Source select|
   619            C        				 ; |------|------|--------------------------|
   620            C        				 ; |  0   |  0   |            Fm            |
   621            C        				 ; |------|------|--------------------------|
   622            C        				 ; |  0   |  1   |            Fs            |
   623            C        				 ; |------|------|--------------------------|
   624            C        				 ; |  1   |  X   |           T1CK           |
   625            C        				 ; |------|------|--------------------------|
   626       0003 C        		T2CSS	==  0x03 ; Timer2 Clock Source Select Bit.0/1=>Fm/Fs.
   627       0002 C        		T1EN	==  0x02 ; Timer1 Start Bit.
   628       0001 C        		T1OMS	==  0x01 ; Timer1 Output Mode Select Bit.0/1=>repeating/on-shot.
   629       0000 C        		T1OC	==  0x00 ; Timer1 Output Flip-Flop Control Bit.
   630            C        	;}
   631            C        ;
   632            C        ;  Bank2 R7 (Timer1 Period Buffer)
   633            C        ;
   634       0007 C         B2_R7	==	0X07
   635       0007 C         T1PD	==	0X07
   636            C        ;
   637            C        ;  Bank2 R8 (Timer1 Duty Buffer)
   638            C        ;
   639       0008 C         B2_R8	==	0X08
   640       0008 C         T1TD	==	0X08
   641            C        ;
   642            C        ;  Bank2 R9 (Timer2 Control Register)
   643            C        ;
   644       0009 C         B2_R9	==	0X09
   645       0009 C         T2CR	==	0X09
   646            C        ;
   647            C        	;{
   648       0007 C        		T2IF	==  0X07 ; Interrupt Flag of Timer2 Interrupt
   649       0006 C        		T2IE	==  0X06 ; Timer2 Interrupt Mask Bit
   650       0005 C        		T2EN	==  0X05 ; Timer2 Start Bit
   651       0005 C        		T2S     ==  0x05 ;
   652       0004 C        		T2MS1	==  0X04 ;
   653       0003 C        		T2MS0	==  0X03 ; Timer2 Operation Mode Select Bits.
   654            C        				 ; |-----|-----|-----------------------|
   655            C        				 ; |T2MS1|T2MS0|   Timer2 Mode Select  |
   656            C        				 ; |-----|-----|-----------------------|
   657            C        				 ; |  0  |  0  |        Timer2         |
   658            C        				 ; |-----|-----|-----------------------|
   659            C        				 ; |  0  |  1  |SPI Baud Rate Generator|
   660            C        				 ; |-----|-----|-----------------------|
   661            C        				 ; |  1  |  0  |                       |
   662            C        				 ; |-----|-----|         PWM2          |
   663            C        				 ; |  1  |  0  |                       |
   664            C        				 ; |-----|-----|-----------------------|
   665       0002 C        		T2P2	==  0x02
   666       0001 C        		T2P1	==  0x01
   667       0000 C        		T2P0	==  0x00 ; Timer2 Prescaler Bits
   668            C        				 ; |-----|-----|-----|-----------------|
   669            C        				 ; | T2P2| T2P1| T2P0|   Prescalaer    |
   670            C        				 ; |-----|-----|-----|-----------------|
   671            C        				 ; |  0  |  0  |  0  |      1:2        |
   672            C        				 ; |-----|-----|-----|-----------------|
   673            C        				 ; |  0  |  0  |  1  |      1:4        |
   674            C        				 ; |-----|-----|-----|-----------------|
   675            C        				 ; |  0  |  1  |  0  |	    1:8        |
   676            C        				 ; |-----|-----|-----|-----------------|
   677            C        				 ; |  0  |  1  |  1  |      1:16       |
   678            C        				 ; |-----|-----|-----|-----------------|
   679            C        				 ; |  1  |  0  |  0  |      1:32       |
   680            C        				 ; |-----|-----|-----|-----------------|
   681            C        				 ; |  1  |  0  |  1  |      1:64       |
   682            C        				 ; |-----|-----|-----|-----------------|                         |
   683            C        				 ; |  1  |  1  |  0  |      1:128      |
   684            C        				 ; |-----|-----|-----|-----------------|
   685            C        				 ; |  1  |  1  |  1  |      1:256      |
   686            C        				 ; |-----|-----|-----|-----------------|
   687            C        	;}
   688            C        ;
   689            C        ;  Bank2 RA (Timer2 Period Buffer)
   690            C        ;
   691       000A C         B2_RA	==	0X0A
   692       000A C         T2PD	==	0X0A
   693            C        ;
   694            C        ; Bank2 RB (Timer Duty Buffer)
   695            C        ;
   696       000B C         B2_RB	==	0X0B
   697       000B C         T2TD	==	0X0B
   698            C        ;
   699            C        ;  Bank2 RC (SPI Status Register)
   700            C        ;
   701       000C C         B2_RC	==	0X0C
   702       000C C         SPIS	==	0X0C
   703            C        ;
   704            C        	;{
   705       0007 C        		DORD	==  0X07 ; Data Shift Control Bit.0/1=>left/right
   706       0006 C        		TD1	==  0X06 ;
   707       0005 C        		TD0	==  0X05 ; SDO Status Output Delay Times Options
   708            C        				 ; |---|---|----------|
   709            C        				 ; |TD1|TD0|Delay Time|
   710            C        				 ; |---|---|----------|
   711            C        				 ; | 0 | 0 |   8 CLK  |
   712            C        				 ; |---|---|----------|
   713            C        				 ; | 0 | 1 |  16 CLK  |
   714            C        				 ; |---|---|----------|
   715            C        				 ; | 1 | 0 |  24 CLK  |
   716            C        				 ; |---|---|----------|
   717            C        				 ; | 1 | 1 |  32 CLK  |
   718            C        				 ; |---|---|----------|
   719            C        				 ; Bit4 Reserved
   720       0003 C        		OD3	==  0X03 ; Open-Drain Control Bit
   721       0002 C        		OD4	==  0X02 ;
   722            C        				 ; Bi1 Reserved
   723       0000 C        		RIBF	==  0X00 ; Read Buffer Full Flag
   724            C        	;}
   725            C        ;
   726            C        ;  Bank2 RD (SPI Control Register)
   727            C        ;
   728       000D C         B2_RD	==	0X0D
   729       000D C         SPIC	==	0X0D
   730            C        ;
   731            C        	;{
   732       0007 C        		CES	==  0X07 ; Clock Edge Select Bit
   733       0006 C        		SPIEB	==  0X06 ; SPI Enable Bit
   734       0005 C        		SRO	==  0X05 ; SPI Read Overflow Bit
   735       0004 C        		SSE	==  0X04 ; SPI Shift Enable Bit
   736       0003 C        		SDOC	==  0X03 ; SDO Output Status Control Bit
   737       0002 C        		SBRS2	==  0X02
   738       0001 C        		SBRS1	==  0X01
   739       0000 C        		SBRS0	==  0X00 ; SPI Baud Rate Select Bits
   740            C        				 ; |-----|-----------|--------|-------------------|
   741            C        				 ; |SBRS2|SBRS1|SBRS0|  Mode  |   SPI Baud Rate   |
   742            C        				 ; |-----|-----------|--------|-------------------|
   743            C        				 ; |  0  |  0  |  0  | Master |       Fcsc/2      |
   744            C        				 ; |-----|-----------|--------|-------------------|
   745            C        				 ; |  0  |  0  |  1  | Master |       Fcsc/4      |
   746            C        				 ; |-----|-----------|--------|-------------------|
   747            C        				 ; |  0  |  1  |  0  | Master |       Fcsc/8      |
   748            C        				 ; |-----|-----------|--------|-------------------|
   749            C        				 ; |  0  |  1  |  1  | Master |      Fcsc/16      |
   750            C        				 ; |-----|-----------|--------|-------------------|
   751            C        				 ; |  1  |  0  |  0  | Master |      Fcsc/32      |
   752            C        				 ; |-----|-----------|--------|-------------------|
   753            C        				 ; |  1  |  0  |  1  | Master |       Timer2      |
   754            C        				 ; |-----|-----------|--------|-------------------|
   755            C        				 ; |  1  |  1  |  0  | Slave  |     /SS enable    |
   756            C        				 ; |-----|-----------|--------|-------------------|
   757            C        				 ; |  1  |  1  |  1  | Slave  |     /SS enable    |
   758            C        				 ; |-----|-----------|--------|-------------------|
   759            C        	;}
   760            C        ;
   761            C        ;  Bank2 RE (SPI Read Buffer)
   762            C        ;
   763       000E C         B2_RE	==	0X0E
   764       000E C         SPIR	==	0X0E
   765            C        ;
   766            C        ;  Bank2 RF (SPI Write Buffer)
   767            C        ;
   768       000F C         B2_RF	==	0X0F
   769       000F C         SPIW	==	0X0F
   770            C        ;
   771            C        ;  Bank3 R5 (UART Control Register)
   772            C        ;
   773       0005 C         B3_R5	==	0X05
   774       0005 C         URC	==	0X05
   775            C        ;
   776            C        	;{
   777       0007 C        		URTD8	==  0X07 ; Transmission Data Bit8
   778       0006 C        		UMODE1	==  0X06
   779       0005 C        		UM0DE0	==  0X05 ; UART Transmission Mode Select Bit
   780            C        				 ; |------|------|-----------|
   781            C        				 ; |UMODE1|UMODE0| UART Mode |
   782            C        				 ; |  0   |   0  |Mode1:7-Bit|
   783            C        				 ; |------|------|-----------|
   784            C        				 ; |  0   |   1  |Mode1:8-Bit|
   785            C        				 ; |------|------|-----------|
   786            C        				 ; |  1   |   0  |Mode1:9-Bit|
   787            C        				 ; |------|------|-----------|
   788            C        				 ; |  1   |   1  | Reserved  |
   789            C        				 ; |------|------|-----------|
   790       0004 C        		BRATE2	==  0X04
   791       0003 C        		BRATE1	==  0X03
   792       0002 C        		BRATE0	==  0X02 ; Transmit Baud Rate Select(Tuart=Fc/16)
   793            C        				 ; |------|------|------|-------------|-------------|
   794            C        				 ; |BRATE2|BRATE1|BRATE0|  Baud Rate  | e.g.FC=8Mhz |
   795            C        				 ; |------|------|------|-------------|-------------|
   796            C        				 ; |  0   |  0   |  0   |   Tuart/13  |    38400    |
   797            C        				 ; |------|------|------|-------------|-------------|
   798            C        				 ; |  0   |  0   |  1   |   Tuart/26  |    19200    |
   799            C        				 ; |------|------|------|-------------|-------------|
   800            C        				 ; |  0   |  1   |  0   |   Tuart/52  |     9600    |
   801            C        				 ; |------|------|------|-------------|-------------|
   802            C        				 ; |  0   |  1   |  1   |  Tuart/104  |     4800    |
   803            C        				 ; |------|------|------|-------------|-------------|
   804            C        				 ; |  1   |  0   |  0   |  Tuart/208  |     2400    |
   805            C        				 ; |------|------|------|-------------|-------------|
   806            C        				 ; |  1   |  0   |  1   |  Tuart/416  |     1200    |
   807            C        				 ; |------|------|------|---------------------------|
   808            C        				 ; |  1   |  1   |  0   |            Timer1         |
   809            C        				 ; |------|------|------|---------------------------|
   810            C        				 ; |  1   |  1   |  1   |           Reserved        |
   811            C        				 ; |------|------|------|---------------------------|
   812       0001 C        		UTBE ==  0X01
   813       0000 C        		TXE	 ==  0X00 ; Enable transmission
   814            C        	;}
   815            C        ;
   816            C        ;  Bank 3 R6 (UART Status)
   817            C        ;
   818       0006 C         B3_R6	==  0X06
   819       0006 C         URS	==  0X06
   820            C        ;
   821            C        	;{
   822       0007 C        		URRD8	==  0X07 	; Receiving Data Bit8
   823       0006 C        		EVEN	==  0X06 	; Select Parity Check
   824       0005 C        		PRE		==  0X05	; Enable Parity Check
   825       0004 C        		PRERR	==  0X04 	; Parity Error Flag
   826       0003 C        		OVERR	==  0X03 	; Over Running Error Flag
   827       0002 C        		FMERR	==  0X02 	; Framing Error Flag
   828       0001 C        		URBF	==  0X01 	; UART Read Buffer Full Flag
   829       0000 C        		RXE	==  0X00 		; Enable Receiving
   830            C        	;}
   831            C        ;
   832            C        ;  Bank3 R7 (UART_RD Data Buffer)
   833            C        ;
   834       0007 C         B3_R7	==	0X07
   835       0007 C         URRD	==	0X07
   836            C        ;
   837            C        ;  Bank3 R8 (UART_TD Data Buffer)
   838            C        ;
   839       0008 C         B3_R8	==	0X08
   840       0008 C         URTD	==	0X08
   841            C        ;
   842            C        ;  Bank3 R9 (A/D Control Register)
   843            C        ;
   844       0009 C         B3_R9	==	0X09
   845       0009 C         ADCR	==	0X09
   846            C        ;
   847            C        	;{
   848       0007 C        		ADRUN	==  0X07 ; AD Conversion Start
   849       0006 C        		ADP	==  0X06 ; A/D Power Control
   850       0005 C        		ADCK1	==  0X05
   851       0004 C        		ADCK0	==  0X04 ; A/D Input Select Bits
   852            C        				 ; |-----|-----|------------|---------------------------|
   853            C        				 ; |ADCK1|ADCK0|Clock Source|Max.Operating Frequency(Fc)|
   854            C        				 ; |-----|-----|------------|---------------------------|
   855            C        				 ; |  0	 |  0  |    Fc/4    |           1MHz            |
   856            C        				 ; |-----|-----|------------|---------------------------|
   857            C        				 ; |  0	 |  1  |   Fc/16    |           4MHz            |
   858            C        				 ; |-----|-----|------------|---------------------------|
   859            C        				 ; |  1	 |  0  |   Fc/32    |           8MHz            |
   860            C        				 ; |-----|-----|------------|---------------------------|
   861            C        				 ; |  1	 |  1  |   Fc/64    |          16MHz            |
   862            C        				 ; |-----|-----|------------|---------------------------|
   863       0003 C        		ADIS3	==  0X03
   864       0002 C        		ADIS2	==  0X02
   865       0001 C        		ADIS1	==  0X01
   866       0000 C        		ADIS0	==  0X00 ; A/D Input Select Bits
   867            C        				 ; |-----|-----|-----|----------------------|
   868            C        				 ; |ADIS3|ADIS2|ADIS1|ADIS0|Analog Input Pin|
   869            C        				 ; |-----|-----|-----|----------------------|
   870            C        				 ; |  0  |  0  |  0  |  0  |      AD0       |
   871            C        				 ; |-----|-----|-----|----------------------|
   872            C        				 ; |  0  |  0  |  0  |  1  |      AD1       |
   873            C        				 ; |-----|-----|-----|----------------------|
   874            C        				 ; |  0  |  0  |  1  |  0  |      AD2       |
   875            C        				 ; |-----|-----|-----|----------------------|
   876            C        				 ; |  0  |  0  |  1  |  1  |      AD3       |
   877            C        				 ; |-----|-----|-----|----------------------|
   878            C        				 ; |  0  |  1  |  0  |  0  |      AD4       |
   879            C        				 ; |-----|-----|-----|----------------------|
   880            C        				 ; |  0  |  1  |  0  |  1  |      AD5       |
   881            C        				 ; |-----|-----|-----|----------------------|
   882            C        				 ; |  0  |  1  |  1  |  0  |      AD6       |
   883            C        				 ; |-----|-----|-----|----------------------|
   884            C        				 ; |  0  |  1  |  1  |  1  |      AD7       |
   885            C        				 ; |-----|-----|-----|----------------------|
   886            C        				 ; |  1  |  0  |  0  |  0  |      AD8       |
   887            C        				 ; |-----|-----|-----|----------------------|
   888            C        				 ; |  1  |  0  |  0  |  1  |      AD9       |
   889            C        				 ; |-----|-----|-----|----------------------|
   890            C        				 ; |  1  |  0  |  1  |  0  |      AD10      |
   891            C        				 ; |-----|-----|-----|----------------------|
   892            C        				 ; |  1  |  0  |  1  |  1  |      AD11      |
   893            C        				 ; |-----|-----|-----|----------------------|
   894            C        	;}
   895            C        ;
   896            C        ;  Bank3 RA (A/D Input Control Register)
   897            C        ;
   898       000A C         B3_RA	==	0X0A
   899       000A C         ADICH	==	0X0A
   900            C        ;
   901            C        	;{
   902       0007 C        		CALI	==  0X07 ; Calibration Enable Bit for A/D Offset
   903       0006 C        		ADREF	==  0X06 ; AD Reference Voltage Input Select
   904            C        				 ; Bit4~5:Reserved
   905       0003 C        		ADE11	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   906       0002 C        		ADE10	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   907       0001 C        		ADE9	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   908       0000 C        		ADE8	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   909            C        	;}
   910            C        ;
   911            C        ;  Bank3 RB (A/D Input Control Register)
   912            C        ;
   913       000B C         B3_RB	==	0X0B
   914       000B C         ADICL	==	0X0B
   915            C        ;
   916            C        	;{
   917       0007 C        		ADE7	==  0X07 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   918       0006 C        		ADE6	==  0X06 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   919       0005 C        		ADE5	==  0x05 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   920       0004 C        		ADE4	==  0X04 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   921       0003 C        		ADE3	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   922       0002 C        		ADE2	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   923       0001 C        		ADE1	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   924       0000 C        		ADE0	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   925            C        	;}
   926            C        ;
   927            C        ;  Bank3 RC (A/D High 8-bits Data Buffer)
   928            C        ;
   929       000C C         B3_RC	==	0X0C
   930       000C C         ADDH	==	0X0C
   931            C        ;
   932            C        ;  Bank3 RD (A/D Low 4-bits Data Buffer)
   933            C        ;
   934       000D C         B3_RD	==	0X0D
   935       000D C         ADDL	==	0X0D
   936            C        ;
   937            C        	;{
   938       0007 C        		SIGN	==  0X07 ; Polarity Bit of Offset Voltage.0/1=>Negative/Positive
   939       0006 C        		VOF2	==  0X06
   940       0005 C        		VOF1	==  0X05
   941       0004 C        		VOF0	==  0X04 ; Offset Voltage Bits.
   942            C        				 ; |----|----|----|---------|
   943            C        				 ; |VOF2|VOF1|VOF0|EM78P510N|
   944            C        				 ; |----|----|----|---------|
   945            C        				 ; |  0 |  0 |  0 |   0LSB  |
   946            C        				 ; |----|----|----|---------|
   947            C        				 ; |  0 |  0 |  1 |   2LSB  |
   948            C        				 ; |----|----|----|---------|
   949            C        				 ; |  0 |  1 |  0 |   4LSB  |
   950            C        				 ; |----|----|----|---------|
   951            C        				 ; |  0 |  1 |  1 |   6LSB  |
   952            C        				 ; |----|----|----|---------|
   953            C        				 ; |  1 |  0 |  0 |   8LSB  |
   954            C        				 ; |----|----|----|---------|
   955            C        				 ; |  1 |  0 |  1 |  10LSB  |
   956            C        				 ; |----|----|----|---------|
   957            C        				 ; |  1 |  1 |  0 |  12LSB  |
   958            C        				 ; |----|----|----|---------|
   959            C        				 ; |  1 |  1 |  1 |  14LSB  |
   960            C        				 ; |----|----|----|---------|
   961       0003 C        		ADD3	==  0X03
   962       0002 C        		ADD2	==  0X02
   963       0001 C        		ADD1	==  0X01
   964       0000 C        		ADD0	==  0X00
   965            C        	;}
   966            C        ;
   967            C        ;  Bank3 RE (External Interrupt Edge Select Control Register High Byte)
   968            C        ;
   969       000E C         B3_RE	==	0X0E
   970       000E C         EIESH	==	0X0E
   971            C        ;
   972            C        	;{
   973       0007 C        		EIES7	==  0X07 ; External Interrupt 7 Edge Select Bit.0/1=>Falling/Rising
   974       0006 C        		EIES6	==  0X06 ; External Interrupt 6 Edge Select Bit.0/1=>Falling/Rising
   975       0005 C        		EIES5	==  0X05 ; External Interrupt 5 Edge Select Bit.0/1=>Falling/Rising
   976       0004 C        		EIES4	==  0X04 ; External Interrupt 4 Edge Select Bit.0/1=>Falling/Rising
   977       0003 C        		EIES3	==  0X03 ; External Interrupt 3 Edge Select Bit.0/1=>Falling/Rising
   978       0002 C        		EIES2	==  0X02 ; External Interrupt 2 Edge Select Bit.0/1=>Falling/Rising
   979       0001 C        		EIES1	==  0X01 ; External Interrupt 1 Edge Select Bit.0/1=>Falling/Rising
   980       0000 C        		EIES0	==  0X00 ; External Interrupt 0 Edge Select Bit.0/1=>Falling/Rising
   981            C        	;}
   982            C        ;
   983            C        ;  Bank3 RF (External Interrupt Edge Select Control Register Low Byte)
   984            C        ;
   985       000F C         B3_RF	==	0X0F
   986       000F C         EIESL	==	0X0F
   987            C        ;
   988            C        	;{
   989            C        				 ;Bit4~7 is "0"
   990       0004 C        		ADWK	==  0X04 ; A/D Converter Wake Up Function Enable Bit
   991       0003 C        		INTWK9	==  0X03 ; External Interrupt 9 Wake Up Function Enable Bit
   992       0002 C        		INTWK8	==  0X02 ; External Interrupt 8 Wake Up Function Enable Bit
   993       0001 C        		EIES9	==  0X01 ; External Interrupt 9 Edge Select Bit
   994       0000 C        		EIES8	==  0x00 ; External Interrupt 8 Edge Select Bit
   995            C        	;}
   996            C        ;
   997            C        ;  Bank4 R5 (LED Drive Control Register)
   998            C        ;
   999       0005 C         B4_R5	==	0X05
  1000       0005 C         LEDDCR	==	0X05
  1001            C        ;
  1002            C        	;{
  1003       0007 C        		LEDD7	==  0X07 ; 0:P9.7 as normal I/O,1:P9.7 as LED direct drive I/O.
  1004       0006 C        		LEDD6	==  0X06 ; 0:P9.6 as normal I/O,1:P9.6 as LED direct drive I/O.
  1005       0005 C        		LEDD5	==  0X05 ; 0:P9.5 as normal I/O,1:P9.5 as LED direct drive I/O.
  1006       0004 C        		LEDD4	==  0X04 ; 0:P9.4 as normal I/O,1:P9.4 as LED direct drive I/O.
  1007       0003 C        		LEDD3	==  0X03 ; 0:P9.3 as normal I/O,1:P9.3 as LED direct drive I/O.
  1008       0002 C        		LEDD2	==  0X02 ; 0:P9.2 as normal I/O,1:P9.2 as LED direct drive I/O.
  1009       0001 C        		LEDD1	==  0X01 ; 0:P9.1 as normal I/O,1:P9.1 as LED direct drive I/O.
  1010       0000 C        		LEDD0	==  0X00 ; 0:P9.0 as normal I/O,1:P9.0 as LED direct drive I/O.
  1011            C        	;}
  1012            C        ;
  1013            C        ;  Bank4 R6 (Watch Timer and Buzzer Control Register)
  1014            C        ;
  1015       0006 C         B4_R6	==	0X06
  1016       0006 C         WBCR	==	0X06
  1017            C        ;
  1018            C        	;{
  1019       0007 C        		WTCS	==  0X07 ; Watch Timer and Buzzer Clock Source Select Bit.
  1020       0006 C        		WTIE	==  0X06 ; Watch Timer Enable Bit and Interrupt Mask
  1021       0005 C        		WTIF	==  0X05 ; Watch Timer Interrupt Flag
  1022       0004 C        		WTSSB1	==  0X04 ;
  1023       0003 C        		WTSSB0  ==  0X03 ; Watch Timer Interval Select Bits
  1024            C        				 ; |------|------|-----------------------------------|
  1025            C        				 ; |WTSSB1|WTSSB0|Watch Timer Interval Select(WTCS=1)|
  1026            C        				 ; |  0   |   0  |                1.0S               |
  1027            C        				 ; |------|------|-----------------------------------|
  1028            C        				 ; |  0   |   1  |                0.5S               |
  1029            C        				 ; |------|------|-----------------------------------|
  1030            C        				 ; |  1   |   0  |               0.25S               |
  1031            C        				 ; |------|------|-----------------------------------|
  1032            C        				 ; |  1   |   1  |              3.91MS               |
  1033            C        				 ; |------|------|-----------------------------------|
  1034       0002 C        		BUZE	==  0X02 ; Buzzer Enable and PORT91 as Buzzer Output Pin
  1035       0001 C        		BSSB1	==  0X01
  1036       0000 C        		BSSB0	==  0X00 ; Buzzer Output Frequency Select Bits
  1037            C        				 ; |-----|-----|----------------------------|
  1038            C        				 ; |BSSB1|BSSB0|Buzzer Signal Select(WTCS=1)|
  1039            C        				 ; |-----|-----|----------------------------|
  1040            C        				 ; |  0  |  0  |           0.5KHz           |
  1041            C        				 ; |-----|-----|----------------------------|
  1042            C        				 ; |  0  |  1  |           1.0KHz           |
  1043            C        				 ; |-----|-----|----------------------------|
  1044            C        				 ; |  1  |  0  |           2.0KHz           |
  1045            C        				 ; |-----|-----|----------------------------|
  1046            C        				 ; |  1  |  1  |           4.0KHz           |
  1047            C        				 ; |-----|-----|----------------------------|
  1048            C        	;}
  1049            C        ;
  1050            C        ;  Bank4 R7 (PORT7 I/O Control Register)
  1051            C        ;
  1052       0007 C         B4_R7	==	0X07
  1053       0007 C         IOC7	==	0X07
  1054       0007 C         P7IOCR	==	0X07
  1055            C        ;
  1056            C        ;  Bank4 R8 (PORT8 I/O Control Register)
  1057            C        ;
  1058       0008 C         B4_R8	==	0X08
  1059       0008 C         IOC8	==	0X08
  1060       0008 C         P8IOCR	==	0X08
  1061            C        ;
  1062            C        ;  Bank4 R9 (PORT9 I/O Control Register)
  1063            C        ;
  1064       0009 C         B4_R9	==	0X09
  1065       0009 C         IOC9	==	0X09
  1066       0009 C         P9IOCR	==	0X09
  1067            C        ;
  1068            C        ;  Bank4 RA (PORTA I/O Control Register)
  1069            C        ;
  1070       000A C         B4_RA	==	0X0A
  1071       000A C         IOCA	==	0X0A
  1072       000A C         PAIOCR	==	0X0A
  1073            C        ;
  1074            C        ;  Bank4 RB (PORTB I/O Control Register)
  1075            C        ;
  1076       000B C         B4_RB	==	0X0B
  1077       000B C         IOCB	==	0X0B
  1078       000B C         PBIOCR	==	0X0B
  1079            C        ;
  1080            C        ;  Bank4 RC (PORTC I/O Control Register)
  1081            C        ;
  1082       000C C         B4_RC	==	0X0C
  1083       000C C         IOCC	==	0X0C
  1084       000C C         PCIOCR	==	0X0C
  1085            C        ;
  1086            C        ;  Bank4 RF (Wake Up Control Register)
  1087            C        ;
  1088       000F C         B4_RF	==	0X0F
  1089       000F C         WKCR	==	0X0F
  1090            C        ;
  1091            C        	;{
  1092       0007 C        		INTWK7	==  0X07 ; External Interrupt 7 Wake Up Function Enable Bit.
  1093       0006 C        		INTWK6	==  0X06 ; External Interrupt 6 Wake Up Function Enable Bit.
  1094       0005 C        		INTWK5	==  0X05 ; External Interrupt 5 Wake Up Function Enable Bit.
  1095       0004 C        		INTWK4	==  0X04 ; External Interrupt 4 Wake Up Function Enable Bit.
  1096       0003 C        		INTWK3	==  0X03 ; External Interrupt 3 Wake Up Function Enable Bit.
  1097       0002 C        		INTWK2	==  0X02 ; External Interrupt 2 Wake Up Function Enable Bit.
  1098       0001 C        		INTWK1	==  0X01 ; External Interrupt 1 Wake Up Function Enable Bit.
  1099       0000 C        		INTWK0	==  0X00 ; External Interrupt 0 Wake Up Function Enable Bit.
  1100            C        	;}
  1101            C        ;
  1102            C        ;  Bank4 R6 (UART Control Register 2)
  1103            C        ;
  1104       0006 C         B5_R6	==	0X06
  1105       0006 C         UARC2	==	0X06
  1106            C        ;
  1107            C        	;{
  1108       0005 C        		UARTE	==  0X05  ; UART Function Enable
  1109       0003 C        		UINVEN	==  0X03  ; Enable UART TX and RX Port Inverse Ouput
  1110            C        				  ; other Bits is "0"
  1111            C        	;}
  1112            C        ;
  1113            C        ; Bank5 R7 (PORT7 Pull High Control Register)
  1114            C        ;
  1115       0007 C         B5_R7	==	0X07
  1116       0007 C         P7PHCR	==	0X07
  1117            C        ;
  1118            C        	;{
  1119       0007 C        		PH77	==  0X07 ;
  1120       0006 C        		PH76	==  0X06 ;
  1121       0005 C        		PH75	==  0X05 ;
  1122       0004 C        		PH74	==  0X04 ;
  1123       0003 C        		PH73	==  0X03 ;
  1124       0002 C        		PH72	==  0X02 ;
  1125       0001 C        		PH71	==  0X01 ;
  1126       0000 C        		PH70	==  0X00 ;
  1127            C        	;}
  1128            C        ;
  1129            C        ; Bank5 R8 (PORT8 Pull High Control Register)
  1130            C        ;
  1131       0008 C         B5_R8	==	0X08
  1132       0008 C         P8PHCR	==	0X08
  1133            C        ;
  1134            C        	;{
  1135       0007 C        		PH87	==  0X07 ;
  1136       0006 C        		PH86	==  0X06 ;
  1137       0005 C        		PH85	==  0X05 ;
  1138       0004 C        		PH84	==  0X04 ;
  1139       0003 C        		PH83	==  0X03 ;
  1140       0002 C        		PH82	==  0X02 ;
  1141       0001 C        		PH81	==  0X01 ;
  1142       0000 C        		PH80	==  0X00 ;
  1143            C        	;}
  1144            C        ;
  1145            C        ; Bank5 R9 (PORT9 Pull High Control Register)
  1146            C        ;
  1147       0009 C         B5_R9	==	0X09
  1148       0009 C         P9PHCR	==	0X09
  1149            C        ;
  1150            C        	;{
  1151       0007 C        		PH97	==  0X07 ;
  1152       0006 C        		PH96	==  0X06 ;
  1153       0005 C        		PH95	==  0X05 ;
  1154       0004 C        		PH94	==  0X04 ;
  1155       0003 C        		PH93	==  0X03 ;
  1156       0002 C        		PH92	==  0X02 ;
  1157       0001 C        		PH91	==  0X01 ;
  1158       0000 C        		PH90	==  0X00 ;
  1159            C        	;}
  1160            C        ;
  1161            C        ; Bank5 RA (PORTA Pull High Control Register)
  1162            C        ;
  1163       000A C         B5_RA	==	0X0A
  1164       000A C         PAPHCR	==	0X0A
  1165            C        ;
  1166            C        	;{
  1167       0007 C        		PHA7	==  0X07 ;
  1168       0006 C        		PHA6	==  0X06 ;
  1169       0005 C        		PHA5	==  0X05 ;
  1170       0004 C        		PHA4	==  0X04 ;
  1171       0003 C        		PHA3	==  0X03 ;
  1172       0002 C        		PHA2	==  0X02 ;
  1173       0001 C        		PHA1	==  0X01 ;
  1174       0000 C        		PHA0	==  0X00 ;
  1175            C        	;}
  1176            C        ;
  1177            C        ; Bank5 RB (PORTB Pull High Control Register)
  1178            C        ;
  1179       000B C         B5_RB	==	0X0B
  1180       000B C         PBPHCR	==	0X0B
  1181            C        ;
  1182            C        	;{
  1183       0007 C        		PHB7	==  0X07 ;
  1184       0006 C        		PHB6	==  0X06 ;
  1185       0005 C        		PHB5	==  0X05 ;
  1186       0004 C        		PHB4	==  0X04 ;
  1187       0003 C        		PHB3	==  0X03 ;
  1188       0002 C        		PHB2	==  0X02 ;
  1189       0001 C        		PHB1	==  0X01 ;
  1190       0000 C        		PHB0	==  0X00 ;
  1191            C        	;}
  1192            C        ;
  1193            C        ; Bank5 RC (PORTC Pull High Control Register)
  1194            C        ;
  1195       000C C         B5_RC	==	0X0C
  1196       000C C         PCPHCR	==	0X0C
  1197            C        ;
  1198            C        	;{
  1199       0003 C        		PHC3	==  0X03 ;
  1200       0002 C        		PHC2	==  0X02 ;
  1201       0001 C        		PHC1	==  0X01 ;
  1202       0000 C        		PHC0	==  0X00 ;
  1203            C        				 ; Other Bits is "0"
  1204            C        	;}
  1205            C        ;
  1206            C        ;  Bank6 R6 (Low Voltage Reset Control Register)
  1207            C        ;
  1208       0006 C         B6_R6  ==  0x06
  1209       0006 C         LVRCR  ==  0x06
  1210            C        ;
  1211            C            ;{
  1212       0002 C                LVREN   ==  0x02 ;
  1213       0001 C                LVRS1   ==  0x01 ;
  1214       0000 C                LVRS0   ==  0x00 ;
  1215            C            ;}
  1216            C        
  1217            C        ;  Bank6 R7 (PORT7 Open Drain Control Reister)
  1218            C        ;
  1219       0007 C         B6_R7	==	0X07
  1220       0007 C         P7ODCR	==	0X07
  1221            C        ;
  1222            C        	;{
  1223       0007 C        		P7OD7	==  0X07 ;
  1224       0006 C        		P7OD6	==  0X06 ;
  1225       0005 C        		P7OD5	==  0X05 ;
  1226       0004 C        		P7OD4	==  0X04 ;
  1227       0003 C        		P7OD3	==  0X03 ;
  1228       0002 C        		P7OD2	==  0X02 ;
  1229       0001 C        		P7OD1	==  0X01 ;
  1230       0000 C        		P7OD0	==  0X00 ;
  1231            C        	;}
  1232            C        ;
  1233            C        ;  Bank6 R8 (PORT8 Open Drain Control Reister)
  1234            C        ;
  1235       0008 C         B6_R8	==	0X08
  1236       0008 C         P8ODCR	==	0X08
  1237            C        ;
  1238            C        	;{
  1239       0007 C        		P8OD7	==  0X07 ;
  1240       0006 C        		P8OD6	==  0X06 ;
  1241       0005 C        		P8OD5	==  0X05 ;
  1242       0004 C        		P8OD4	==  0X04 ;
  1243       0003 C        		P8OD3	==  0X03 ;
  1244       0002 C        		P8OD2	==  0X02 ;
  1245       0001 C        		P8OD1	==  0X01 ;
  1246       0000 C        		P8OD0	==  0X00 ;
  1247            C        	;}
  1248            C        ;
  1249            C        ;  Bank6 R9 (PORT9 Open Drain Control Reister)
  1250            C        ;
  1251       0009 C         B6_R9	==	0X09
  1252       0009 C         P9ODCR	==	0X09
  1253            C        ;
  1254            C        	;{
  1255       0007 C        		P9OD7	==  0X07 ;
  1256       0006 C        		P9OD6	==  0X06 ;
  1257       0005 C        		P9OD5	==  0X05 ;
  1258       0004 C        		P9OD4	==  0X04 ;
  1259       0003 C        		P9OD3	==  0X03 ;
  1260       0002 C        		P9OD2	==  0X02 ;
  1261       0001 C        		P9OD1	==  0X01 ;
  1262       0000 C        		P9OD0	==  0X00 ;
  1263            C        	;}
  1264            C        ;
  1265            C        ;  Bank6 RA (PORTA Open Drain Control Reister)
  1266            C        ;
  1267       000A C         B6_RA	==	0X0A
  1268       000A C         PAODCR	==	0X0A
  1269            C        ;
  1270            C        	;{
  1271       0007 C        		PAOD7	==  0X07 ;
  1272       0006 C        		PAOD6	==  0X06 ;
  1273       0005 C        		PAOD5	==  0X05 ;
  1274       0004 C        		PAOD4	==  0X04 ;
  1275       0003 C        		PAOD3	==  0X03 ;
  1276       0002 C        		PAOD2	==  0X02 ;
  1277       0001 C        		PAOD1	==  0X01 ;
  1278       0000 C        		PAOD0	==  0X00 ;
  1279            C        	;}
  1280            C        ;
  1281            C        ;  Bank6 RB (PORTB Open Drain Control Reister)
  1282            C        ;
  1283       000B C         B6_RB	==	0X0B
  1284       000B C         PBODCR	==	0X0B
  1285            C        ;
  1286            C        	;{
  1287       0007 C        		PBOD7	==  0X07 ;
  1288       0006 C        		PBOD6	==  0X06 ;
  1289       0005 C        		PBOD5	==  0X05 ;
  1290       0004 C        		PBOD4	==  0X04 ;
  1291       0003 C        		PBOD3	==  0X03 ;
  1292       0002 C        		PBOD2	==  0X02 ;
  1293       0001 C        		PBOD1	==  0X01 ;
  1294       0000 C        		PBOD0	==  0X00 ;
  1295            C        	;}
  1296            C        ;
  1297            C        ;  Bank6 RC (PORTC Open Drain Control Reister)
  1298            C        ;
  1299       000C C         B6_RC	==	0X0C
  1300       000C C         PCODCR	==	0X0C
  1301            C        ;
  1302            C        	;{
  1303            C        				 ; Other
  1304       0003 C        		PCOD3	==  0X03 ;
  1305       0002 C        		PCOD2	==  0X02 ;
  1306       0001 C        		PCOD1	==  0X01 ;
  1307       0000 C        		PCOD0	==  0X00 ;
  1308            C        	;}
  1309            C        ;
  1310            C        ;======================================================;
  1311            C        ; Register R10~R3F                                     ;
  1312            C        ;======================================================;
  1313            C        ;
  1314            C        ; (R10 ~ R3F): General Purpose Register
  1315            C        ;
  1316       0010 C         R10    ==    0x10
  1317       0011 C         R11    ==    0x11
  1318       0012 C         R12    ==    0x12
  1319       0013 C         R13    ==    0x13
  1320       0014 C         R14    ==    0x14
  1321       0015 C         R15    ==    0x15
  1322       0016 C         R16    ==    0x16
  1323       0017 C         R17    ==    0x17
  1324       0018 C         R18    ==    0x18
  1325       0019 C         R19    ==    0x19
  1326       001A C         R1A    ==    0x1A
  1327       001B C         R1B    ==    0x1B
  1328       001C C         R1C    ==    0x1C
  1329       001D C         R1D    ==    0x1D
  1330       001E C         R1E    ==    0x1E
  1331       001F C         R1F    ==    0x1F
  1332            C        ;
  1333       0020 C         R20    ==    0x20
  1334       0021 C         R21    ==    0x21
  1335       0022 C         R22    ==    0x22
  1336       0023 C         R23    ==    0x23
  1337       0024 C         R24    ==    0x24
  1338       0025 C         R25    ==    0x25
  1339       0026 C         R26    ==    0x26
  1340       0027 C         R27    ==    0x27
  1341       0028 C         R28    ==    0x28
  1342       0029 C         R29    ==    0x29
  1343       002A C         R2A    ==    0x2A
  1344       002B C         R2B    ==    0x2B
  1345       002C C         R2C    ==    0x2C
  1346       002D C         R2D    ==    0x2D
  1347       002E C         R2E    ==    0x2E
  1348       002F C         R2F    ==    0x2F
  1349            C        ;
  1350       0030 C         R30    ==    0x30
  1351       0031 C         R31    ==    0x31
  1352       0032 C         R32    ==    0x32
  1353       0033 C         R33    ==    0x33
  1354       0034 C         R34    ==    0x34
  1355       0035 C         R35    ==    0x35
  1356       0036 C         R36    ==    0x36
  1357       0037 C         R37    ==    0x37
  1358       0038 C         R38    ==    0x38
  1359       0039 C         R39    ==    0x39
  1360       003A C         R3A    ==    0x3A
  1361       003B C         R3B    ==    0x3B
  1362       003C C         R3C    ==    0x3C
  1363       003D C         R3D    ==    0x3D
  1364       003E C         R3E    ==    0x3E
  1365       003F C         R3F    ==    0x3F
  1366            C        
    13                     include "D:\include\EM78xx\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        ;**********************************************************************;
    18            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    19            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    20            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    21            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    22            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    23            C        ; Input:       reg_acc1                                                ;
    24            C        ; Output:      reg_acc3, reg_acc2                                      ;
    25            C        ; Variable Register:None                                               ;
    26            C        ; Register Changed: R3, 0 ;ACC                                         ;
    27            C        ;**********************************************************************;
    28            C        ;-----------------------------------------------------------------
    29            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    30            C        ;
    31            C                CLR     reg_acc2        ;clear BCD data register
    32            C                CLR     reg_acc3
    33            C                MOV     A, reg_acc1
    34            C        $Bin_Bcd1:
    35            C                ADD     A, @156         ;subtract 100 from binary that is transform
    36            C                JBS     STATUS, C       ;borrow bigit?
    37            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    38            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    39            C                JMP     $Bin_Bcd1       ;backing out
    40            C        $Bin_Bcd2:
    41            C                ADD     A, @100         ;100
    42            C                MOV     reg_acc1, A
    43            C        $Bin_Bcd3:
    44            C                ADD     A, @246         ;10
    45            C                JBS     STATUS, C       ;
    46            C                JMP     $Bin_Bcd4       ;
    47            C                INC     reg_acc2        ;BCD1
    48            C                JMP     $Bin_Bcd3
    49            C        $Bin_Bcd4:
    50            C                ADD     A, @10          ;10
    51            C                SWAP    reg_acc2        ;BCDreg_acc2
    52            C                ADD     reg_acc2, A     ;BCDreg_acc2
    53            C                ENDM
    54            C        ;
    55            C        ;**********************************************************************;
    56            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    57            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    58            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    59            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    60            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    61            C        ; Input:       reg_acc1, reg_acc2                                      ;
    62            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    63            C        ; Variable Register:reg_acc, reg_accd                                  ;
    64            C        ; Register Changed: R3, 0; ACC                                         ;
    65            C        ; Status:      1                                                       ;
    66            C        ;**********************************************************************;
    67            C        ;
    68            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    69            C        ;
    70            C                MOV     A, @16          ;(=byte*8)
    71            C                MOV     reg_acc, A
    72            C                CLR     reg_acc5        ;BCD
    73            C                CLR     reg_acc4
    74            C                CLR     reg_acc3
    75            C                BC      STATUS, C       ;R3C
    76            C        $Bin_Bcd1:
    77            C                RLC     reg_acc1        ;
    78            C                RLC     reg_acc2        ;
    79            C                RLC     reg_acc3        ;BCD
    80            C                RLC     reg_acc4
    81            C                RLC     reg_acc5        ;BCD
    82            C                DJZ     reg_acc         ;
    83            C                JMP     $Bin_Bcd2       ;BCD
    84            C                JMP     $Bin_Bcd3       ;
    85            C        $Bin_Bcd2:
    86            C                MOV     A, reg_acc3     ;reg_acc3BCD
    87            C                CALL    $bcdadj         ;BCD
    88            C                MOV     reg_acc3, A     ;
    89            C                MOV     A, reg_acc4     ;reg_acc4BCD
    90            C                CALL    $BCDADJ
    91            C                MOV     reg_acc4, A
    92            C                MOV     A, reg_acc5     ;reg_acc5BCD
    93            C                CALL    $BCDADJ
    94            C                MOV     reg_acc5, A
    95            C                JMP     $Bin_Bcd1       ;
    96            C        ;-------BCD Code Adjust Subprogram---------------
    97            C        $BCDADJ:
    98            C                ADD     A, @51
    99            C                MOV     reg_accd, A
   100            C                JBS     reg_accd, 3
   101            C                ADD     A, @253
   102            C                JBS     reg_accd, 7
   103            C                ADD     A, @208
   104            C                RET
   105            C        $Bin_Bcd3:
   106            C                ENDM
   107            C        ;
   108            C        ;**********************************************************************;
   109            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   110            C        ; Description:reg_acc7BCD                    ;
   111            C        ;             reg_acc4BCD,                     ;
   112            C        ;             reg_acc3                         ;
   113            C        ;             reg_acc1                         ;
   114            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   115            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   116            C        ; Variable Register:reg_acc, reg_accd                                  ;
   117            C        ; Register Changed: R3, 0;ACC                                          ;
   118            C        ; stack:      1                                                        ;
   119            C        ;**********************************************************************;
   120            C        ;
   121            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   122            C        ;
   123            C                MOV     A, @24          ;=byte*8)
   124            C                MOV     reg_acc, A
   125            C                CLR     reg_acc4
   126            C                CLR     reg_acc5
   127            C                CLR     reg_acc6
   128            C                CLR     reg_acc7
   129            C                BC      STATUS, C       ;R3C
   130            C        $Bin_Bcd1:
   131            C                RLC     reg_acc1        ;
   132            C                RLC     reg_acc2
   133            C                RLC     reg_acc3        ;
   134            C                RLC     reg_acc4        ;BCD
   135            C                RLC     reg_acc5
   136            C                RLC     reg_acc6
   137            C                RLC     reg_acc7        ;BCD
   138            C                DJZ     reg_acc         ;
   139            C                JMP     $Bin_Bcd2       ;BCD
   140            C                JMP     $Bin_Bcd3       ;
   141            C        $Bin_Bcd2:
   142            C                MOV     A, reg_acc4     ;reg_acc4BCD
   143            C                CALL    $BCDADJ         ;BCD
   144            C                MOV     reg_acc4, A
   145            C                MOV     A, reg_acc5     ;reg_acc5BCD
   146            C                CALL    $BCDADJ
   147            C                MOV     reg_acc5, A
   148            C                MOV     A, reg_acc6     ;reg_acc6BCD
   149            C                CALL    $BCDADJ
   150            C                MOV     reg_acc6, A
   151            C                MOV     A, reg_acc7     ;reg_acc7BCD
   152            C                CALL    $BCDADJ
   153            C                MOV     reg_acc7, A
   154            C                JMP     $Bin_Bcd1       ;
   155            C        ;-------BCD Code Adjust Subprogram---------------
   156            C        $BCDADJ:
   157            C                ADD     A, @51
   158            C                MOV     reg_accd, A
   159            C                JBS     reg_accd, 3
   160            C                ADD     A, @253
   161            C                JBS     reg_accd, 7
   162            C                ADD     A, @208
   163            C                RET
   164            C        $Bin_Bcd3:
   165            C                ENDM
   166            C        ;
   167            C        ;**********************************************************************;
   168            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   169            C        ; Description:reg_acc9BCD                    ;
   170            C        ;             reg_acc5BCD                    ;
   171            C        ;             reg_acc4                         ;
   172            C        ;             reg_acc1?                          ;
   173            C        ; Arithmetic:                                                          ;
   174            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   175            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   176            C        ; Variable Register:reg_acc, reg_accd                                  ;
   177            C        ; Register Changed: R3, 0; ACC                                         ;
   178            C        ; stack:      1                                                        ;
   179            C        ;**********************************************************************;
   180            C        ;
   181            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   182            C        ;
   183            C                MOV     A,  @32         ;(=byte*8)
   184            C                MOV     reg_acc, A
   185            C                CLR     reg_acc5        ;BCD
   186            C                CLR     reg_acc6
   187            C                CLR     reg_acc7
   188            C                CLR     reg_acc8
   189            C                CLR     reg_acc9
   190            C                BC      STATUS, C       ;R3C
   191            C        $Bin_Bcd1:
   192            C                RLC     reg_acc1        ;
   193            C                RLC     reg_acc2
   194            C                RLC     reg_acc3
   195            C                RLC     reg_acc4        ;
   196            C                RLC     reg_acc5
   197            C                RLC     reg_acc6        ;BCD
   198            C                RLC     reg_acc7
   199            C                RLC     reg_acc8
   200            C                RLC     reg_acc9        ;BCD
   201            C                DJZ     reg_acc         ;
   202            C                JMP     $Bin_Bcd2       ;BCD
   203            C                JMP     $Bin_Bcd3       ;
   204            C        $Bin_Bcd2:
   205            C                MOV     A, reg_acc5     ;reg_acc5BCD
   206            C                CALL    $BCDADJ         ;BCD
   207            C                MOV     reg_acc5, A
   208            C                MOV     A, reg_acc6     ;reg_acc6BCD
   209            C                CALL    $BCDADJ
   210            C                MOV     reg_acc6, A
   211            C                MOV     A, reg_acc7     ;reg_acc7BCD
   212            C                CALL    $BCDADJ
   213            C                MOV     reg_acc7, A
   214            C                MOV     A, reg_acc8     ;reg_acc8BCD
   215            C                CALL    $BCDADJ
   216            C                MOV     reg_acc8, A
   217            C                MOV     A, reg_acc9     ;reg_acc9BCD
   218            C                CALL    $BCDADJ
   219            C                MOV     reg_acc9, A
   220            C                JMP     $Bin_Bcd1       ;
   221            C        ;-------BCD Code Adjust Subprogram---------------
   222            C        $BCDADJ:
   223            C                ADD     A, @51
   224            C                MOV     reg_accd, A
   225            C                JBS     reg_accd, 3
   226            C                ADD     A, @253
   227            C                JBS     reg_accd, 7
   228            C                ADD     A, @208
   229            C                RET
   230            C        $Bin_Bcd3:
   231            C                ENDM
   232            C        ;**********************************************************************;
   233            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   234            C        ; Description:reg_acccBCD                      ;
   235            C        ;             reg_acc6BCD                      ;
   236            C        ;             reg_acc5                         ;
   237            C        ;             reg_acc1                         ;
   238            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   239            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   240            C        ;             reg_accb, reg_accc                                       ;
   241            C        ; Variable Register:reg_acc, reg_accd                                  ;
   242            C        ; Register Changed: R3, 0;ACC                                          ;
   243            C        ; Stack:      1                                                        ;
   244            C        ;**********************************************************************;
   245            C        ;
   246            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   247            C        ;
   248            C                MOV     A,  @40         ;(=byte*8)
   249            C                MOV     reg_acc, A
   250            C                CLR     reg_acc6        ;BCD
   251            C                CLR     reg_acc7
   252            C                CLR     reg_acc8
   253            C                CLR     reg_acc9
   254            C                CLR     reg_acca
   255            C                CLR     reg_accb
   256            C                CLR     reg_accc
   257            C                BC      STATUS, C       ;R3C
   258            C        $Bin_Bcd1:
   259            C                RLC     reg_acc1
   260            C                RLC     reg_acc2
   261            C                RLC     reg_acc3        ;
   262            C                RLC     reg_acc4        ;
   263            C                RLC     reg_acc5        ;
   264            C        ;
   265            C                RLC     reg_acc6        ;BCD
   266            C                RLC     reg_acc7
   267            C                RLC     reg_acc8
   268            C                RLC     reg_acc9
   269            C                RLC     reg_acca
   270            C                RLC     reg_accb
   271            C                RLC     reg_accc        ;BCD
   272            C                DJZ     reg_acc         ;
   273            C                JMP     $Bin_Bcd2       ;BCD
   274            C                JMP     $Bin_Bcd3       ;
   275            C        $Bin_Bcd2:
   276            C                MOV     A, reg_acc6     ;reg_acc6BCD
   277            C                CALL    $BCDADJ         ;BCD
   278            C                MOV     reg_acc6, A
   279            C                MOV     A, reg_acc7     ;reg_acc7BCD
   280            C                CALL    $BCDADJ
   281            C                MOV     reg_acc7, A
   282            C                MOV     A, reg_acc8     ;reg_acc8BCD
   283            C                CALL    $BCDADJ
   284            C                MOV     reg_acc8, A
   285            C                MOV     A, reg_acc9     ;reg_acc9BCD
   286            C                CALL    $BCDADJ
   287            C                MOV     reg_acc9, A
   288            C                MOV     A, reg_acca     ;reg_accaBCD
   289            C                CALL    $BCDADJ
   290            C                MOV     reg_acca, A
   291            C                MOV     A, reg_accb     ;reg_accbBCD
   292            C                CALL    $BCDADJ
   293            C                MOV     reg_accb, A
   294            C                MOV     A, reg_accc     ;reg_acccBCD
   295            C                CALL    $BCDADJ
   296            C                MOV     reg_accc, A
   297            C                JMP     $Bin_Bcd1       ;
   298            C        ;
   299            C        ;-------BCD Code Adjust Subprogram---------------
   300            C        $BCDADJ:
   301            C                ADD     A, @51
   302            C                MOV     reg_accd, A
   303            C                JBS     reg_accd, 3
   304            C                ADD     A, @253
   305            C                JBS     reg_accd, 7
   306            C                ADD     A, @208
   307            C                RET
   308            C        $Bin_Bcd3:
   309            C                ENDM
   310            C        ;
   311            C        ;**********************************************************************;
   312            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   313            C        ; Input:      reg_acc1(BCD code)                                       ;
   314            C        ; Output:     reg_acc2(Binary Code)                                    ;
   315            C        ; Register Changed: STATUS, C;ACC                                      ;
   316            C        ;**********************************************************************;
   317            C        ;
   318            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   319            C        ;
   320            C                CLR     reg_acc2
   321            C                SWAPA   reg_acc1        ;reg_acc1A
   322            C                AND     A, @0X0F        ;reg_acc1, 0-3bit.
   323            C                MOV     reg_acc2, A
   324            C                BC      STATUS, C
   325            C                RLC     reg_acc2        ;reg_acc2*10
   326            C                RLC     reg_acc2
   327            C                ADD     reg_acc2, A
   328            C                RLC     reg_acc2
   329            C                MOV     A, reg_acc1
   330            C                AND     A, @0X0F        ;reg_acc1, 4-7bit
   331            C                ADD     reg_acc2, A     ;bcd code10bcd code
   332            C                ENDM
   333            C        ;
   334            C        ;**********************************************************************;
   335            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   336            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   337            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   338            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   339            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   340            C        ; Register Changed: STATUS, C; ACC                                     ;
   341            C        ; Stack:     1                                                         ;
   342            C        ;**********************************************************************;
   343            C        ;
   344            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   345            C        ;
   346            C                CLR     reg_acc3        ;clear binary code register
   347            C                CLR     reg_acc4
   348            C                MOV     A, @16          ;reg_acc==byte*8)
   349            C                Mov     reg_acc, A
   350            C        $Bcd_Bin1:
   351            C                BC      STATUS, C
   352            C                RRC     reg_acc2        ;BCDBINARY
   353            C                RRC     reg_acc1
   354            C                RRC     reg_acc4
   355            C                RRC     reg_acc3
   356            C                MOV     A, reg_acc1     ;BCDBCD
   357            C                CALL    $Binadj
   358            C                MOV     reg_acc1, A
   359            C                MOV     A, reg_acc2
   360            C                CALL    $Binadj
   361            C                MOV     reg_acc2, A
   362            C                DJZ     reg_acc
   363            C                JMP     $Bcd_Bin1
   364            C                JMP     $Bcd_Bin2
   365            C        $Binadj:
   366            C                MOV     reg_accd, A
   367            C                JBC     reg_accd, 3
   368            C                ADD     A, @253
   369            C                JBC     reg_accd, 7
   370            C                ADD     A, @208
   371            C                RET
   372            C        $Bcd_Bin2:
   373            C                ENDM
   374            C        ;
   375            C        ;**********************************************************************;
   376            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   377            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   378            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   379            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   380            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   381            C        ; Register Changed: STATUS, C; ACC                                     ;
   382            C        ; Stack:     1                                                         ;
   383            C        ;**********************************************************************;
   384            C        ;
   385            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   386            C        ;
   387            C                CLR     reg_acc4
   388            C                CLR     reg_acc5
   389            C                CLR     reg_acc6
   390            C                MOV     A, @24          ;reg_acc==BYTE*8)
   391            C                MOV     reg_acc, A
   392            C        $Bcd_Bin1:
   393            C                BC      STATUS, C
   394            C                RRC     reg_acc3
   395            C                RRC     reg_acc2
   396            C                RRC     reg_acc1
   397            C                RRC     reg_acc6
   398            C                RRC     reg_acc5
   399            C                RRC     reg_acc4
   400            C                MOV     A, reg_acc1
   401            C                CALL    $Binadj
   402            C                MOV     reg_acc1, A
   403            C                MOV     A, reg_acc2
   404            C                CALL    $Binadj
   405            C                MOV     reg_acc2, A
   406            C                MOV     A, reg_acc3
   407            C                CALL    $Binadj
   408            C                MOV     reg_acc3, A
   409            C                DJZ     reg_acc
   410            C                JMP     $Bcd_Bin1
   411            C                JMP     $Bcd_Bin2
   412            C        $Binadj:
   413            C                MOV     reg_accd, A
   414            C                JBC     reg_accd, 3
   415            C                ADD     A, @253
   416            C                JBC     reg_accd, 7
   417            C                ADD     A, @208
   418            C                RET
   419            C        $Bcd_Bin2:
   420            C                ENDM
   421            C        ;
   422            C        ;**********************************************************************;
   423            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   424            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   425            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   426            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   427            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   428            C        ; Register Changed: STATUS, C;ACC                                      ;
   429            C        ; Stack:     1                                                         ;
   430            C        ;**********************************************************************;
   431            C        ;
   432            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   433            C        ;
   434            C                CLR     reg_acc5
   435            C                CLR     reg_acc6
   436            C                CLR     reg_acc7
   437            C                CLR     reg_acc8
   438            C                MOV     A, @32          ;reg_acc==BYTE*8)
   439            C                MOV     reg_acc, A
   440            C        $Bcd_Bin1:
   441            C                BC      STATUS, C
   442            C                RRC     reg_acc4
   443            C                RRC     reg_acc3
   444            C                RRC     reg_acc2
   445            C                RRC     reg_acc1
   446            C                RRC     reg_acc8
   447            C                RRC     reg_acc7
   448            C                RRC     reg_acc6
   449            C                RRC     reg_acc5
   450            C                MOV     A, reg_acc1
   451            C                CALL    $Binadj
   452            C                MOV     reg_acc1, A
   453            C                MOV     A, reg_acc2
   454            C                CALL    $Binadj
   455            C                MOV     reg_acc2, A
   456            C                MOV     A, reg_acc3
   457            C                CALL    $Binadj
   458            C                MOV     reg_acc3, A
   459            C                MOV     A, reg_acc4
   460            C                CALL    $Binadj
   461            C                MOV     reg_acc4, A
   462            C                DJZ     reg_acc
   463            C                JMP     $Bcd_Bin1
   464            C                JMP     $Bcd_Bin2
   465            C        $Binadj:
   466            C                MOV     reg_accd, A
   467            C                JBC     reg_accd, 3
   468            C                ADD     A, @253
   469            C                JBC     reg_accd, 7
   470            C                ADD     A, @208
   471            C                RET
   472            C        $Bcd_Bin2:
   473            C                ENDM
   474            C        ;
   475            C        ;**********************************************************************;
   476            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   477            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   478            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   479            C        ;            Bcd Code.                                                 ;
   480            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   481            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   482            C        ;            Of Binary Code.                                           ;
   483            C        ; Register Changed: STATUS, C; ACC                                     ;
   484            C        ; Stack:     1                                                         ;
   485            C        ;**********************************************************************;
   486            C        ;
   487            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   488            C        ;
   489            C                CLR     reg_acc6
   490            C                CLR     reg_acc7
   491            C                CLR     reg_acc8
   492            C                CLR     reg_acc9
   493            C                CLR     reg_acca
   494            C                MOV     A, @40          ;reg_acc==BYTE*8)
   495            C                MOV     reg_acc, A
   496            C        $Bcd_Bin1:
   497            C                BC      STATUS, C
   498            C                RRC     reg_acc5
   499            C                RRC     reg_acc4
   500            C                RRC     reg_acc3
   501            C                RRC     reg_acc2
   502            C                RRC     reg_acc1
   503            C                RRC     reg_acca
   504            C                RRC     reg_acc9
   505            C                RRC     reg_acc8
   506            C                RRC     reg_acc7
   507            C                RRC     reg_acc6
   508            C                MOV     A, reg_acc1
   509            C                CALL    $Binadj
   510            C                MOV     reg_acc1, A
   511            C                MOV     A, reg_acc2
   512            C                CALL    $Binadj
   513            C                MOV     reg_acc2, A
   514            C                MOV     A, reg_acc3
   515            C                CALL    $Binadj
   516            C                MOV     reg_acc3, A
   517            C                MOV     A, reg_acc4
   518            C                CALL    $Binadj
   519            C                MOV     reg_acc4, A
   520            C                MOV     A, reg_acc5
   521            C                CALL    $Binadj
   522            C                MOV     reg_acc5, A
   523            C                DJZ     reg_acc
   524            C                JMP     $Bcd_Bin1
   525            C                JMP     $Bcd_Bin2
   526            C        $Binadj:
   527            C                MOV     reg_accd, A
   528            C                JBC     reg_accd, 3
   529            C                ADD     A, @253
   530            C                JBC     reg_accd, 7
   531            C                ADD     A, @208
   532            C                RET
   533            C        $Bcd_Bin2:
   534            C                ENDM
   535            C        
   536            C        
   537            C        ;*****************************************************************
   538            C        ;Function:    Subtration
   539            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   540            C        ;Output:      reg_acc2, reg_acc1
   541            C        ;description: reg_acc2/reg_acc1 is the reslut;
   542            C        ;             reg_acc3 is a symbol:
   543            C        ;             0X00 Mean reslut is plus
   544            C        ;             0X01 Mean reslut is negative
   545            C        ;*****************************************************************
   546            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   547            C                BC      STATUS,C
   548            C                MOV     A,reg_acc3
   549            C                SUB     reg_acc1,A
   550            C                JBC     STATUS,C
   551            C                JMP     Subtration_End  
   552            C                CLR     reg_acc3
   553            C                MOV     A,@0X01
   554            C                SUB     A,reg_acc2
   555            C                JBC     STATUS,C
   556            C                DEC     reg_acc2
   557            C                JBC     STATUS,C
   558            C                INC     reg_acc3        
   559            C        Subtration_End:
   560            C                ENDM
   561            C        
   562            C        ;**********************************************************************;
   563            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   564            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   565            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   566            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   567            C        ; Variable Register:None                                               ;
   568            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   569            C        ;**********************************************************************;
   570            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   571            C        ;
   572            C                MOV     A, @8           ;Recurrence Cortrol Data
   573            C                MOV     reg_acc, A
   574            C                CLRA                    ;Check Divisor Is Zero
   575            C                OR      A, reg_acc2     ;Divisor load into A register
   576            C                JBC     STATUS, 2
   577            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   578            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin PerationThen A=1
   579            C        $_Div_Sub:
   580            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   581            C                RLC     reg_acc2
   582            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   583            C                SUB     reg_acc2, a
   584            C                JBC     STATUS, C
   585            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   586            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   587            C                ADD     reg_acc2, A     ;Revert Dividend
   588            C        $_Div_Cnt:
   589            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   590            C                JMP     $_Div_Sub
   591            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   592            C        $_Div_Out:
   593            C                ENDM
   594            C        ;
   595            C        ;**********************************************************************;
   596            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   597            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   598            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   599            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   600            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   601            C        ; Variable Register:None                                               ;
   602            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   603            C        ;**********************************************************************;
   604            C        ;
   605            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   606            C        ;
   607            C                MOV     A, @16          ;Recurrence Cortrol Data
   608            C                MOV     reg_acc, A
   609            C                CLRA                    ;Check Divisor Is Zero
   610            C                OR      A, reg_acc3     ;Divisor load into A register
   611            C                JBC     STATUS, Z
   612            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   613            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin PerationThen A=1
   614            C        $_Div_Sub:
   615            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   616            C                RLC     reg_acc2
   617            C                RLC     reg_acc3
   618            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   619            C                JBS     STATUS, C
   620            C                JMP     $_Div_S_0
   621            C                SUB     reg_acc3, A
   622            C                JMP     $_Div_Cnt
   623            C        $_Div_S_0:
   624            C                SUB     reg_acc3, A
   625            C                JBC     STATUS, C
   626            C                JMP     $_Div_Cnt
   627            C                BC      reg_acc1, 0
   628            C                ADD     reg_acc3, A
   629            C        $_Div_Cnt:
   630            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   631            C                JMP     $_Div_Sub
   632            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   633            C        $_Div_Out:
   634            C                ENDM
   635            C        ;
   636            C        ;**********************************************************************;
   637            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   638            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   639            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   640            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   641            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   642            C        ; Variable Register:None                                               ;
   643            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   644            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   645            C        ;**********************************************************************;
   646            C        ;
   647            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   648            C        ;
   649            C                CLRA
   650            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   651            C                OR      A, reg_acc4
   652            C                JBC     STATUS, Z
   653            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   654            C                MOV     A, @16          ;Recurrence Cortrol Data
   655            C                MOV     reg_acc, A
   656            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1
   657            C                CLR     reg_acc6
   658            C        $_Div_Sub:
   659            C                BC      STATUS, C       ;Clear c Flag
   660            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   661            C                RLC     reg_acc2
   662            C                RLC     reg_acc5
   663            C                RLC     reg_acc6
   664            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   665            C                SUB     A, reg_acc6     ;Check High Word  Equal
   666            C                JBS     STATUS, Z
   667            C                JMP     $_Div_Set
   668            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   669            C                SUB     A, reg_acc5
   670            C        $_Div_Set:
   671            C                JBS     STATUS, C
   672            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   673            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   674            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   675            C                SUB     reg_acc5, A     ;Save Diviso
   676            C                JBS     STATUS, C
   677            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   678            C                MOV     A, reg_acc4
   679            C                SUB     reg_acc6, A
   680            C        $_Div_S_0:
   681            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   682            C                JMP     $_Div_Sub
   683            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   684            C                MOV     reg_acc4, A
   685            C                MOV     A, reg_acc5
   686            C                MOV     reg_acc3, A
   687            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   688            C        $_Div_Out:
   689            C                ENDM
   690            C        ;
   691            C        ;**********************************************************************;
   692            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   693            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   694            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   695            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   696            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   697            C        ; Variable Register:None                                               ;
   698            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   699            C        ;**********************************************************************;
   700            C        ;
   701            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   702            C        ;
   703            C                MOV     A, @24          ;Recurrence Cortrol Data
   704            C                MOV     reg_acc, A
   705            C                CLRA                    ;Check Divisor Is Zero
   706            C                OR      A, reg_acc4     ;Divisor load into A register
   707            C                JBC     STATUS, Z
   708            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   709            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin PerationThen A=1
   710            C        $_Div_Sub:
   711            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   712            C                RLC     reg_acc2
   713            C                RLC     reg_acc3
   714            C                RLC     reg_acc4
   715            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   716            C                JBS     STATUS, C
   717            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   718            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   719            C                JMP     $_Div_Cnt
   720            C        $_Div_S_0:
   721            C                SUB     reg_acc4, A
   722            C                JBC     STATUS, C
   723            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   724            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   725            C                ADD     reg_acc4, A     ;Revert Dividend
   726            C        $_Div_Cnt:
   727            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   728            C                JMP     $_Div_Sub
   729            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   730            C        $_Div_Out:
   731            C                ENDM
   732            C        ;
   733            C        ;**********************************************************************;
   734            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   735            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   736            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   737            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   738            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   739            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   740            C        ;               Remainder reg_acc5, reg_acc4                           ;
   741            C        ; Variable Register: None                                              ;
   742            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   743            C        ;                   , reg_acc7(0x27)                                   ;
   744            C        ;**********************************************************************;
   745            C        ;
   746            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   747            C        ;
   748            C                CLRA
   749            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   750            C                OR      A, reg_acc5
   751            C                JBC     STATUS, Z
   752            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   753            C                MOV     A, @24          ;Recurrence Cortrol Data
   754            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   755            C                CLR     reg_acc6        ;clear Remainder register
   756            C                CLR     reg_acc7
   757            C        $_Div_Sub:
   758            C                BC      STATUS, C       ;Clear c Flag
   759            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   760            C                RLC     reg_acc2
   761            C                RLC     reg_acc3
   762            C                RLC     reg_acc6
   763            C                RLC     reg_acc7
   764            C                JBC     STATUS, C
   765            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   766            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   767            C                SUB     A, reg_acc7     ;Check High Word  Equal
   768            C                JBS     STATUS, Z
   769            C                JMP     $_Div_Set
   770            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   771            C                SUB     A, reg_acc6
   772            C        $_Div_Set:
   773            C                JBS     STATUS, C
   774            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   775            C        $_Div_Set_1:
   776            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   777            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   778            C                SUB     reg_acc6, A     ;Save Diviso
   779            C                JBS     STATUS, C
   780            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   781            C                MOV     A, reg_acc5
   782            C                SUB     reg_acc7, A
   783            C        $_Div_S_0:
   784            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   785            C                JMP     $_Div_Sub
   786            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   787            C                MOV     reg_acc5, A
   788            C                MOV     A, reg_acc6
   789            C                MOV     reg_acc4, A
   790            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   791            C        $_Div_Out:
   792            C                ENDM
   793            C        ;
   794            C        ;**********************************************************************;
   795            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   796            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   797            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   798            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   799            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   800            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   801            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   802            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   803            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   804            C        ; Variable Register:None                                               ;
   805            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   806            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   807            C        ;**********************************************************************;
   808            C        ;
   809            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   810            C        ;
   811            C                CLRA
   812            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   813            C                OR      A, reg_acc5
   814            C                OR      A, reg_acc6
   815            C                JBC     STATUS, Z
   816            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   817            C                MOV     A, @24          ;Recurrence Cortrol Data
   818            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   819            C                CLR     reg_acc7        ;clear Remainder register
   820            C                CLR     reg_acc8
   821            C                CLR     reg_acc9
   822            C        $_Div_Sub:
   823            C                BC      STATUS, C       ;Clear c Flag
   824            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   825            C                RLC     reg_acc2
   826            C                RLC     reg_acc3
   827            C                RLC     reg_acc7
   828            C                RLC     reg_acc8
   829            C                RLC     reg_acc9
   830            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   831            C                SUB     A, reg_acc9     ;Check High Word  Equal
   832            C                JBS     STATUS, Z
   833            C                JMP     $_Div_Set
   834            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   835            C                SUB     A, reg_acc8
   836            C                JBS     STATUS, Z
   837            C                JMP     $_Div_Set
   838            C                MOV     A, reg_acc4
   839            C                SUB     A, reg_acc7
   840            C        $_Div_Set:
   841            C                JBS     STATUS, C
   842            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   843            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   844            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   845            C                SUB     reg_acc7, A     ;Save Diviso
   846            C                JBS     STATUS, C
   847            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   848            C                MOV     A, reg_acc5
   849            C                SUB     reg_acc8, A
   850            C                JBS     STATUS, C
   851            C                DEC     reg_acc9
   852            C                MOV     A, reg_acc6
   853            C                SUB     reg_acc9, A
   854            C        $_Div_S_0:
   855            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   856            C                JMP     $_Div_Sub
   857            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   858            C                MOV     reg_acc6, A
   859            C                MOV     A, reg_acc8
   860            C                MOV     reg_acc5, A
   861            C                MOV     A, reg_acc7
   862            C                MOV     reg_acc4, A
   863            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   864            C        $_Div_Out:
   865            C                ENDM
   866            C        ;
   867            C        ;**********************************************************************;
   868            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   869            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   870            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   871            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   872            C        ;               Divisor   reg_acc5                                     ;
   873            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   874            C        ;               Remainder reg_acc5                                     ;
   875            C        ; Variable Register:None                                               ;
   876            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   877            C        ;**********************************************************************;
   878            C        ;
   879            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   880            C        ;
   881            C                MOV     A, @32          ;Recurrence Cortrol Data
   882            C                MOV     reg_acc, A
   883            C                CLRA                    ;Check Divisor Is Zero
   884            C                OR      A, reg_acc5     ;Divisor load into A register
   885            C                JBC     STATUS, Z
   886            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   887            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1.
   888            C        $_Div_Sub:
   889            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   890            C                RLC     reg_acc2
   891            C                RLC     reg_acc3
   892            C                RLC     reg_acc4
   893            C                RLC     reg_acc5
   894            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   895            C                JBS     STATUS, C
   896            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   897            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   898            C                JMP     $_Div_Cnt
   899            C        $_Div_S_0:
   900            C                SUB     reg_acc5, A
   901            C                JBC     STATUS, C
   902            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   903            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   904            C                ADD     reg_acc5, A     ;Revert Dividend
   905            C        $_Div_Cnt:
   906            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   907            C                JMP     $_Div_Sub
   908            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   909            C        $_Div_Out:
   910            C                ENDM
   911            C        ;
   912            C        ;**********************************************************************;
   913            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   914            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   915            C        ;               (reg_acc6, reg_acc5)                                   ;
   916            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   917            C        ;               --(reg_acc6, reg_acc5)                                 ;
   918            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   919            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   920            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   921            C        ;               Remainder reg_acc6, reg_acc5                           ;
   922            C        ; Variable Register:None                                               ;
   923            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   924            C        ;                   , reg_acc8(0x28)                                   ;
   925            C        ;**********************************************************************;
   926            C        ;
   927            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   928            C        ;
   929            C                CLRA
   930            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   931            C                OR      A, reg_acc5
   932            C                JBC     STATUS, Z
   933            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   934            C                MOV     A, @32          ;Recurrence Cortrol Data
   935            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   936            C                CLR     reg_acc7        ;clear Remainder register
   937            C                CLR     reg_acc8
   938            C        $_Div_Sub:
   939            C                BC      STATUS, C       ;Clear c Flag
   940            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   941            C                RLC     reg_acc2
   942            C                RLC     reg_acc3
   943            C                RLC     reg_acc4
   944            C                RLC     reg_acc7
   945            C                RLC     reg_acc8
   946            C                JBC     STATUS, C
   947            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   948            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   949            C                SUB     A, reg_acc8     ;Check High Word  Equal
   950            C                JBS     STATUS, Z
   951            C                JMP     $_Div_Set
   952            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   953            C                SUB     A, reg_acc7
   954            C        $_Div_Set:
   955            C                JBS     STATUS, C
   956            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   957            C        $_Div_Set_1:
   958            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   959            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   960            C                SUB     reg_acc7, A     ;Save Divisor
   961            C                JBS     STATUS, C
   962            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   963            C                MOV     A, reg_acc6
   964            C                SUB     reg_acc8, A
   965            C        $_Div_S_0:
   966            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   967            C                JMP     $_Div_Sub
   968            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   969            C                MOV     reg_acc6, A
   970            C                MOV     A, reg_acc7
   971            C                MOV     reg_acc5, A
   972            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   973            C        $_Div_Out:
   974            C                ENDM
   975            C        ;
   976            C        ;**********************************************************************;
   977            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   978            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   979            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   980            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   981            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   982            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   983            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   984            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   985            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   986            C        ; Variable Register:None                                               ;
   987            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   988            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   989            C        ;**********************************************************************;
   990            C        ;
   991            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   992            C        ;
   993            C                CLRA
   994            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   995            C                OR      A, reg_acc6
   996            C                OR      A, reg_acc5
   997            C                JBC     STATUS, Z
   998            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   999            C                MOV     A, @32          ;Recurrence Cortrol Data
  1000            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1001            C                CLR     reg_acc8        ;clear Remainder register
  1002            C                CLR     reg_acc9
  1003            C                CLR     reg_acca
  1004            C        $_Div_Sub:
  1005            C                BC      STATUS, 0       ;Clear c Flag
  1006            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1007            C                RLC     reg_acc2
  1008            C                RLC     reg_acc3
  1009            C                RLC     reg_acc4
  1010            C                RLC     reg_acc8
  1011            C                RLC     reg_acc9
  1012            C                RLC     reg_acca
  1013            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1014            C                JMP     $_Div_Set_1
  1015            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1016            C                SUB     A, reg_acca     ;Check High Word  Equal
  1017            C                JBS     STATUS, Z
  1018            C                JMP     $_Div_Set
  1019            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1020            C                SUB     A, reg_acc9
  1021            C                JBS     STATUS, Z
  1022            C                JMP     $_Div_Set
  1023            C                MOV     A, reg_acc5
  1024            C                SUB     A, reg_acc8
  1025            C        $_Div_Set:
  1026            C                JBS     STATUS, C
  1027            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1028            C        $_Div_Set_1:
  1029            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1030            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1031            C                SUB     reg_acc8, A     ;Save Divisor
  1032            C                JBS     STATUS, C
  1033            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1034            C                MOV     A, reg_acc6
  1035            C                SUB     reg_acc9, A
  1036            C                JBS     STATUS, C
  1037            C                DEC     reg_acca
  1038            C                MOV     A, reg_acc7
  1039            C                SUB     reg_acca, A
  1040            C        $_Div_S_0:
  1041            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1042            C                JMP     $_Div_Sub
  1043            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1044            C                MOV     reg_acc7, A
  1045            C                MOV     A, reg_acc9
  1046            C                MOV     reg_acc6, A
  1047            C                MOV     A, reg_acc8
  1048            C                MOV     reg_acc5, A
  1049            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1050            C        $_Div_Out:
  1051            C                ENDM
  1052            C        ;
  1053            C        ;**********************************************************************;
  1054            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1055            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1056            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1057            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1058            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1059            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1060            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1061            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1062            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1063            C        ; Variable Register:None                                               ;
  1064            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1065            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1066            C        ;**********************************************************************;
  1067            C        ;
  1068            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1069            C        ;
  1070            C                CLRA
  1071            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1072            C                OR      A, reg_acc7
  1073            C                OR      A, reg_acc6
  1074            C                OR      A, reg_acc5
  1075            C                JBC     STATUS, Z
  1076            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1077            C                MOV     A, @32          ;Recurrence Cortrol Data
  1078            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1079            C                CLR     reg_acc9        ;clear Remainder register
  1080            C                CLR     reg_acca
  1081            C                CLR     reg_accb
  1082            C                CLR     reg_accc
  1083            C        $_Div_Sub:
  1084            C                BC      STATUS, C       ;Clear c Flag
  1085            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1086            C                RLC     reg_acc2
  1087            C                RLC     reg_acc3
  1088            C                RLC     reg_acc4
  1089            C                RLC     reg_acc9
  1090            C                RLC     reg_acca
  1091            C                RLC     reg_accb
  1092            C                RLC     reg_accc
  1093            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1094            C                SUB     A, reg_accc     ;Check High Word  Equal
  1095            C                JBS     STATUS, Z
  1096            C                JMP     $_Div_Set
  1097            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1098            C                SUB     A, reg_accb
  1099            C                JBS     STATUS, Z
  1100            C                JMP     $_Div_Set
  1101            C                MOV     A, reg_acc6
  1102            C                SUB     A, reg_acca
  1103            C                JBS     STATUS, Z
  1104            C                JMP     $_Div_Set
  1105            C                MOV     A, reg_acc5
  1106            C                SUB     A, reg_acc9
  1107            C        $_Div_Set:
  1108            C                JBS     STATUS, C
  1109            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1110            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1111            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1112            C                SUB     reg_acc9, A     ;Save Divisor
  1113            C                JBS     STATUS, C
  1114            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1115            C                MOV     A, reg_acc6
  1116            C                SUB     reg_acca, A
  1117            C                JBS     STATUS, C
  1118            C                DEC     reg_accb
  1119            C                MOV     A, reg_acc7
  1120            C                SUB     reg_accb, A
  1121            C                JBS     STATUS, C
  1122            C                DEC     reg_accc
  1123            C                MOV     A, reg_acc8
  1124            C                SUB     reg_accc, A
  1125            C        $_Div_S_0:
  1126            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1127            C                JMP     $_Div_Sub
  1128            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1129            C                MOV     reg_acc8, A
  1130            C                MOV     A, reg_accb
  1131            C                MOV     reg_acc7, A
  1132            C                MOV     A, reg_acca
  1133            C                MOV     reg_acc6, A
  1134            C                MOV     A, reg_acc9
  1135            C                MOV     reg_acc5, A
  1136            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1137            C        $_Div_Out:
  1138            C                ENDM
  1139            C        ;
  1140            C        ;**********************************************************************;
  1141            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1142            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1143            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1144            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1145            C        ; Register change:reg_acc                                              ;
  1146            C        ;**********************************************************************;
  1147            C        ;
  1148            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1149            C        ;
  1150            C                MOV     A, @8
  1151            C                MOV     reg_acc, A
  1152            C                MOV     A, reg_acc2
  1153            C                CLR     reg_acc2
  1154            C        $Mul11_Loop:
  1155            C                BC      STATUS, C
  1156            C                JBC     reg_acc1, 0
  1157            C                ADD     reg_acc2, A
  1158            C                RRC     reg_acc2
  1159            C                RRC     reg_acc1
  1160            C        ;
  1161            C                DJZ     reg_acc
  1162            C                JMP     $Mul11_Loop
  1163            C                ENDM
  1164            C        ;
  1165            C        ;**********************************************************************;
  1166            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1167            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1168            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1169            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1170            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Register change:reg_acc                                              ;
  1172            C        ;**********************************************************************;
  1173            C        ;
  1174            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1175            C        ;
  1176            C                MOV     A, @16
  1177            C                MOV     reg_acc, A
  1178            C                MOV     A, reg_acc3
  1179            C                CLR     reg_acc3
  1180            C        $Mul12_Loop:
  1181            C                BC      STATUS, C
  1182            C                JBC     reg_acc1, 0
  1183            C                ADD     reg_acc3, A
  1184            C                RRC     reg_acc3
  1185            C                RRC     reg_acc2
  1186            C                RRC     reg_acc1
  1187            C        ;
  1188            C                DJZ     reg_acc
  1189            C                JMP     $Mul12_Loop
  1190            C                ENDM
  1191            C        ;
  1192            C        ;**********************************************************************;
  1193            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1194            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1195            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1196            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1197            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Register change:reg_acc                                              ;
  1199            C        ;**********************************************************************;
  1200            C        ;
  1201            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1202            C        ;
  1203            C                MOV     A, @24
  1204            C                MOV     reg_acc, A
  1205            C                MOV     A, reg_acc4
  1206            C                CLR     reg_acc4
  1207            C        $Mul13_Loop:
  1208            C                BC      STATUS, C
  1209            C                JBC     reg_acc1, 0
  1210            C                ADD     reg_acc4, A
  1211            C                RRC     reg_acc4
  1212            C                RRC     reg_acc3
  1213            C                RRC     reg_acc2
  1214            C                RRC     reg_acc1
  1215            C        ;
  1216            C                DJZ     reg_acc
  1217            C                JMP     $Mul13_Loop
  1218            C                ENDM
  1219            C        ;
  1220            C        ;**********************************************************************;
  1221            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1222            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1223            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1224            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1225            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Register change:reg_acc                                              ;
  1227            C        ;**********************************************************************;
  1228            C        ;
  1229            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1230            C        ;
  1231            C                MOV     A, @32
  1232            C                MOV     reg_acc, A
  1233            C                MOV     A, reg_acc5
  1234            C                CLR     reg_acc5
  1235            C        $Mul14_Loop:
  1236            C                BC      STATUS, C
  1237            C                JBC     reg_acc1, 0
  1238            C                ADD     reg_acc5, A
  1239            C                RRC     reg_acc5
  1240            C                RRC     reg_acc4
  1241            C                RRC     reg_acc3
  1242            C                RRC     reg_acc2
  1243            C                RRC     reg_acc1
  1244            C        ;
  1245            C                DJZ     reg_acc
  1246            C                JMP     $Mul14_Loop
  1247            C                ENDM
  1248            C        ;
  1249            C        ;**********************************************************************;
  1250            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1251            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1252            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1253            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1254            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1256            C        ;**********************************************************************;
  1257            C        ;
  1258            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1259            C        ;
  1260            C                MOV     A, @16
  1261            C                MOV     reg_acc, A
  1262            C                MOV     A, reg_acc4
  1263            C                MOV     reg_acc6, A
  1264            C                MOV     A, reg_acc3
  1265            C                MOV     reg_acc5, A
  1266            C                CLR     reg_acc3
  1267            C                CLR     reg_acc4
  1268            C        $Mul22_Loop:
  1269            C                BC      STATUS, C
  1270            C                JBS     reg_acc1, 0
  1271            C                JMP     $Mul22_Rs
  1272            C                MOV     A, reg_acc5
  1273            C                ADD     reg_acc3, A
  1274            C        ;--------------------------------------
  1275            C                MOV     A, reg_acc4
  1276            C                JBC     STATUS, C
  1277            C                ADD     A, @1
  1278            C                RLC     reg_acc
  1279            C                ADD     A, reg_acc6
  1280            C                MOV     reg_acc4, A
  1281            C                JBC     STATUS, C
  1282            C                BS      reg_acc, 0
  1283            C                RRC     reg_acc
  1284            C        $Mul22_Rs:
  1285            C                RRC     reg_acc4
  1286            C                RRC     reg_acc3
  1287            C                RRC     reg_acc2
  1288            C                RRC     reg_acc1
  1289            C        ;
  1290            C                BC      reg_acc, 7
  1291            C                DJZ     reg_acc
  1292            C                JMP     $Mul22_Loop
  1293            C                ENDM
  1294            C        ;
  1295            C        ;**********************************************************************;
  1296            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1297            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1298            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1299            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1300            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1302            C        ;**********************************************************************;
  1303            C        ;
  1304            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1305            C        ;
  1306            C                MOV     A, @24
  1307            C                MOV     reg_acc, A
  1308            C                MOV     A, reg_acc5
  1309            C                MOV     reg_acc7, A
  1310            C                MOV     A, reg_acc4
  1311            C                MOV     reg_acc6, A
  1312            C                CLR     reg_acc4
  1313            C                CLR     reg_acc5
  1314            C        $Mul23_Loop:
  1315            C                BC      STATUS, C
  1316            C                JBS     reg_acc1, 0
  1317            C                JMP     $Mul23_Rs
  1318            C                MOV     A, reg_acc6
  1319            C                ADD     reg_acc4, A
  1320            C        ;--------------------------------------
  1321            C                MOV     A, reg_acc5
  1322            C                JBC     STATUS, C
  1323            C                ADD     A, @1
  1324            C                RLC     reg_acc
  1325            C                ADD     A, reg_acc7
  1326            C                MOV     reg_acc5, A
  1327            C                JBC     STATUS, C
  1328            C                BS      reg_acc, 0
  1329            C                RRC     reg_acc
  1330            C        $Mul23_Rs:
  1331            C                RRC     reg_acc5
  1332            C                RRC     reg_acc4
  1333            C                RRC     reg_acc3
  1334            C                RRC     reg_acc2
  1335            C                RRC     reg_acc1
  1336            C        ;
  1337            C                BC      reg_acc, 7
  1338            C                DJZ     reg_acc
  1339            C                JMP     $Mul23_Loop
  1340            C                ENDM
  1341            C        ;
  1342            C        ;**********************************************************************;
  1343            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1344            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1345            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1346            C        ;                 , reg_acc2, reg_acc1)                                ;
  1347            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1348            C        ;                 reg_acc6                                             ;
  1349            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1350            C        ;                 reg_acc6                                             ;
  1351            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1352            C        ;**********************************************************************;
  1353            C        ;
  1354            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1355            C        ;
  1356            C                MOV     A, @32
  1357            C                MOV     reg_acc, A
  1358            C                MOV     A, reg_acc6
  1359            C                MOV     reg_acc8, A
  1360            C                MOV     A, reg_acc5
  1361            C                MOV     reg_acc7, A
  1362            C                CLR     reg_acc5
  1363            C                CLR     reg_acc6
  1364            C        $Mul24_Loop:
  1365            C                BC      STATUS, C
  1366            C                JBS     reg_acc1, 0
  1367            C                JMP     $Mul24_Rs
  1368            C                MOV     A, reg_acc7
  1369            C                ADD     reg_acc5, A
  1370            C        ;--------------------------------------
  1371            C                MOV     A, reg_acc6
  1372            C                JBC     STATUS, C
  1373            C                ADD     A, @1
  1374            C                RLC     reg_acc
  1375            C                ADD     A, reg_acc8
  1376            C                MOV     reg_acc6, A
  1377            C                JBC     STATUS, C
  1378            C                BS      reg_acc, 0
  1379            C                RRC     reg_acc
  1380            C        $Mul24_Rs:
  1381            C                RRC     reg_acc6
  1382            C                RRC     reg_acc5
  1383            C                RRC     reg_acc4
  1384            C                RRC     reg_acc3
  1385            C                RRC     reg_acc2
  1386            C                RRC     reg_acc1
  1387            C        ;
  1388            C                BC      reg_acc, 7
  1389            C                DJZ     reg_acc
  1390            C                JMP     $Mul24_Loop
  1391            C                ENDM
  1392            C        ;
  1393            C        ;**********************************************************************;
  1394            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1395            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1396            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1397            C        ;                 , reg_acc2, reg_acc1)                                ;
  1398            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1399            C        ;                 , reg_acc6                                           ;
  1400            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1401            C        ;                 , reg_acc6                                           ;
  1402            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1403            C        ;**********************************************************************;
  1404            C        ;
  1405            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1406            C        ;
  1407            C                MOV     A, @24
  1408            C                MOV     reg_acc, A
  1409            C                MOV     A, reg_acc4
  1410            C                MOV     reg_acc7, A
  1411            C                MOV     A, reg_acc5
  1412            C                MOV     reg_acc8, A
  1413            C                MOV     A, reg_acc6
  1414            C                MOV     reg_acc9, A
  1415            C                CLR     reg_acc4
  1416            C                CLR     reg_acc5
  1417            C                CLR     reg_acc6
  1418            C        $Mul33_Loop:
  1419            C                BC      STATUS, C
  1420            C                JBS     reg_acc1, 0
  1421            C                JMP     $Mul33_Rs
  1422            C                MOV     A, reg_acc7
  1423            C                ADD     reg_acc4, A
  1424            C        ;--------------------------------------
  1425            C                MOV     A, reg_acc5
  1426            C                JBC     STATUS, C
  1427            C                ADD     A, @1
  1428            C                RLC     reg_acc
  1429            C                ADD     A, reg_acc8
  1430            C                MOV     reg_acc5, A
  1431            C                JBC     STATUS, C
  1432            C                BS      reg_acc, 0
  1433            C                RRC     reg_acc
  1434            C        ;--------------------------------------
  1435            C                MOV     A, reg_acc6
  1436            C                JBC     STATUS, C
  1437            C                ADD     A, @1
  1438            C                RLC     reg_acc
  1439            C                ADD     A, reg_acc9
  1440            C                MOV     reg_acc6, A
  1441            C                JBC     STATUS, C
  1442            C                BS      reg_acc, 0
  1443            C                RRC     reg_acc
  1444            C        $Mul33_Rs:
  1445            C                RRC     reg_acc6
  1446            C                RRC     reg_acc5
  1447            C                RRC     reg_acc4
  1448            C                RRC     reg_acc3
  1449            C                RRC     reg_acc2
  1450            C                RRC     reg_acc1
  1451            C        ;
  1452            C                BC      reg_acc, 7
  1453            C                DJZ     reg_acc
  1454            C                JMP     $Mul33_Loop
  1455            C                ENDM
  1456            C        ;
  1457            C        ;**********************************************************************;
  1458            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1459            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1460            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1461            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1462            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1463            C        ;                 , reg_acc6, reg_acc7                                 ;
  1464            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1465            C        ;                 , reg_acc6, reg_acc7                                 ;
  1466            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1467            C        ;**********************************************************************;
  1468            C        ;
  1469            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1470            C        ;
  1471            C                MOV     A, @32
  1472            C                MOV     reg_acc, A
  1473            C                MOV     A, reg_acc5
  1474            C                MOV     reg_acc8, A
  1475            C                MOV     A, reg_acc6
  1476            C                MOV     reg_acc9, A
  1477            C                MOV     A, reg_acc7
  1478            C                MOV     reg_acca, A
  1479            C                CLR     reg_acc5
  1480            C                CLR     reg_acc6
  1481            C                CLR     reg_acc7
  1482            C        $Mul34_Loop:
  1483            C                BC      STATUS, C
  1484            C                JBS     reg_acc1, 0
  1485            C                JMP     $Mul34_Rs
  1486            C                MOV     A, reg_acc8
  1487            C                ADD     reg_acc5, A
  1488            C        ;--------------------------------------
  1489            C                MOV     A, reg_acc6
  1490            C                JBC     STATUS, C
  1491            C                ADD     A, @1
  1492            C                RLC     reg_acc
  1493            C                ADD     A, reg_acc9
  1494            C                MOV     reg_acc6, A
  1495            C                JBC     STATUS, C
  1496            C                BS      reg_acc, 0
  1497            C                RRC     reg_acc
  1498            C        ;--------------------------------------
  1499            C                MOV     A, reg_acc7
  1500            C                JBC     STATUS, C
  1501            C                ADD     A, @1
  1502            C                RLC     reg_acc
  1503            C                ADD     A, reg_acca
  1504            C                MOV     reg_acc7, A
  1505            C                JBC     STATUS, C
  1506            C                BS      reg_acc, 0
  1507            C                RRC     reg_acc
  1508            C        $Mul34_Rs:
  1509            C                RRC     reg_acc7
  1510            C                RRC     reg_acc6
  1511            C                RRC     reg_acc5
  1512            C                RRC     reg_acc4
  1513            C                RRC     reg_acc3
  1514            C                RRC     reg_acc2
  1515            C                RRC     reg_acc1
  1516            C        ;
  1517            C                BC      reg_acc, 7
  1518            C                DJZ     reg_acc
  1519            C                JMP     $Mul34_Loop
  1520            C                ENDM
  1521            C        ;
  1522            C        ;**********************************************************************;
  1523            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1524            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1525            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1526            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1527            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1528            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1529            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1530            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1531            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1532            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1533            C        ;**********************************************************************;
  1534            C        ;
  1535            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1536            C        ;
  1537            C                MOV     A, @32
  1538            C                MOV     reg_acc, A
  1539            C                MOV     A, reg_acc5
  1540            C                MOV     reg_acc9, A
  1541            C                MOV     A, reg_acc6
  1542            C                MOV     reg_acca, A
  1543            C                MOV     A, reg_acc7
  1544            C                MOV     reg_accb, A
  1545            C                MOV     A, reg_acc8
  1546            C                MOV     reg_accc, A
  1547            C                CLR     reg_acc5
  1548            C                CLR     reg_acc6
  1549            C                CLR     reg_acc7
  1550            C                CLR     reg_acc8
  1551            C        $Mul44_Loop:
  1552            C                BC      STATUS, C
  1553            C                JBS     reg_acc1, 0
  1554            C                JMP     $Mul44_Rs
  1555            C                MOV     A, reg_acc9
  1556            C                ADD     reg_acc5, A
  1557            C        ;--------------------------------------
  1558            C                MOV     A, reg_acc6
  1559            C                JBC     STATUS, C
  1560            C                ADD     A, @1
  1561            C                RLC     reg_acc
  1562            C                ADD     A, reg_acca
  1563            C                MOV     reg_acc6, A
  1564            C                JBC     STATUS, C
  1565            C                BS      reg_acc, 0
  1566            C                RRC     reg_acc
  1567            C        ;--------------------------------------
  1568            C                MOV     A, reg_acc7
  1569            C                JBC     STATUS, C
  1570            C                ADD     A, @1
  1571            C                RLC     reg_acc
  1572            C                ADD     A, reg_accb
  1573            C                MOV     reg_acc7, A
  1574            C                JBC     STATUS, C
  1575            C                BS      reg_acc, 0
  1576            C                RRC     reg_acc
  1577            C        ;--------------------------------------
  1578            C                MOV     A, reg_acc8
  1579            C                JBC     STATUS, C
  1580            C                ADD     A, @1
  1581            C                RLC     reg_acc
  1582            C                ADD     A, reg_accc
  1583            C                MOV     reg_acc8, A
  1584            C                JBC     STATUS, C
  1585            C                BS      reg_acc, 0
  1586            C                RRC     reg_acc
  1587            C        $Mul44_Rs:
  1588            C                RRC     reg_acc8
  1589            C                RRC     reg_acc7
  1590            C                RRC     reg_acc6
  1591            C                RRC     reg_acc5
  1592            C                RRC     reg_acc4
  1593            C                RRC     reg_acc3
  1594            C                RRC     reg_acc2
  1595            C                RRC     reg_acc1
  1596            C        ;
  1597            C                BC      reg_acc, 7
  1598            C                DJZ     reg_acc
  1599            C                JMP     $Mul44_Loop
  1600            C                ENDM
  1601            C        
  1602            C        
  1603            C        
  1604            C        ;*****************************************************************
  1605            C        ;Function:    generat random data
  1606            C        ;Input:       @banksel,@address,@length
  1607            C        ;Output:      rang by address which is the lowest address
  1608            C        ;description: used common register temp,temp1,temp2 for operation
  1609            C        ;             rand address must be in the same bank
  1610            C        ;             TEMP:  Operate Data TEMP
  1611            C        ;             TEMP1:
  1612            C        ;             TEMP2:
  1613            C        ;*****************************************************************
  1614            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1615            C        	MOV         TEMP,A
  1616            C        	BANK        @BankSel
  1617            C        	MOV         A,Address
  1618            C        	ADD         TEMP,A        ; save latest data as current seed
  1619            C        
  1620            C        	CLR         RSR
  1621            C        $_RAND_SEED_LOOP1:
  1622            C        	MOV         A,R0
  1623            C        	ADD         TEMP,A        ; seed
  1624            C        
  1625            C        	RLC         TEMP          ; x*y+1 MOD z
  1626            C        	RLC         TEMP
  1627            C        	RLC         TEMP
  1628            C        	INC         TEMP
  1629            C        	RRC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	JBS         STATUS,C
  1633            C        	BC          TEMP,0
  1634            C        	JBC         STATUS,C
  1635            C        	BS          TEMP,0
  1636            C        
  1637            C        	INC         RSR
  1638            C        	MOV         A,RSR
  1639            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1640            C        	XOR         A,@0X40
  1641            C        	JBS         STATUS,Z
  1642            C        	JMP         $_RAND_SEED_LOOP1
  1643            C        	MOV         A,R0
  1644            C        	ADD         TEMP,A          ;next seed
  1645            C        
  1646            C        	MOV         A,@length
  1647            C        	MOV         TEMP1,A
  1648            C        	MOV         A,@Address
  1649            C        	MOV         TEMP2,A
  1650            C        	MOV         RSR,A
  1651            C        	BANK        @BankSel
  1652            C        	MOV         A,RSR
  1653            C        	MOV         TEMP2,A       ; save address base
  1654            C        	MESSAGE     "adding form 0x00 to bank 0"
  1655            C        
  1656            C        $_RAND_DATA_LOOP1:
  1657            C        	MOV         A,TEMP2
  1658            C        	MOV         RSR,A
  1659            C        	MOV         A,TEMP
  1660            C        	MOV         R0,A
  1661            C        
  1662            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1663            C        	RLC         TEMP
  1664            C        	RLC         TEMP
  1665            C        	INC         TEMP
  1666            C        	RRC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	JBS         STATUS,C
  1670            C        	BC          TEMP,0
  1671            C        	JBC         STATUS,C
  1672            C        	BS          TEMP,0
  1673            C        
  1674            C        	INC         TEMP2
  1675            C        	DJZ         TEMP1
  1676            C        	JMP         $_RAND_DATA_LOOP1:
  1677            C        	NOP
  1678            C        
  1679            C        ENDM
  1680            C        
    14                     include "D:\include\EM78xx\EM78CtrlIns.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 
   284            C        ; :,ACC,R3
   285            C        ; A      -> A_TEMP
   286            C        ; RSR    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;RSR              ;SAVE RSR(R4)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;RSR              ;SAVE RSR(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;RSR,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;RSR,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;=================== EM78P520 ======================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;RSR              ;SAVE RSR(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;RSR,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ; 
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; 
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; 
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; 
   426            C        ; :NUM = ,  ADDRESS =  B
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; 
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ;
   460            C        ; :NUM = ,  ADDRESS =  B
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; 
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C        	MOV     A, @0XE0        ; RAM 
   513            C        	MOV     R4, A           ;
   514            C        	CLR     BSR
   515            C        	;INC     BSR            ; BANK 0 is used for exchange reg(FIFO)
   516            C        ;CLEAR_RAM_LOOP_P510:
   517            C        	WDTC
   518            C        	CLR     R0
   519            C        	INC     R4
   520            C        	MOV     A, R4
   521            C        	AND     A, @0X3F
   522            C        	JBS     R3, Z
   523            C        	JMP     $-5            ; CLEAR_RAM_LOOP_P510
   524            C        	INC     BSR
   525            C        	MOV     A, BSR         ; BANK0 (BSR == 0X05)
   526            C        	AND     A, @0X07
   527            C        	BS      R4, 5
   528            C        	BS      R4, 6
   529            C        	JBS     R3, 2
   530            C        	JMP     $-13           ; CLEAR_RAM_LOOP_P510
   531            C        	CLR     R4
   532            C        	CLR     BSR
   533            C        	BS      R4,6
   534            C        
   535            C        ELSEIFDEF EM78M611.H
   536            C        	CLR     RC
   537            C        	CLR     RD
   538            C        	CLR     0X10
   539            C        	MOV     A,@0X2F
   540            C        	MOV     0X10,A
   541            C        
   542            C        	MOV     A,@0X11
   543            C        	MOV     RSR,A
   544            C        ;CLRLOOPU1:
   545            C        	CLR     R0
   546            C        	INC     RSR
   547            C        	DJZ     0X10
   548            C        	JMP     $-3        ;CLRLOOPU1
   549            C            CLR     R0
   550            C        	MOV     A,@0X20
   551            C        	MOV     0X10,A
   552            C        	MOV     A,@0X60
   553            C        	MOV     RSR,A
   554            C        
   555            C        ;CLRLOOPU2:
   556            C        	CLR     R0
   557            C        	INC     RSR
   558            C        	DJZ     0X10
   559            C        	JMP     $-3             ;CLRLOOPU2
   560            C        
   561            C        	CLR     R0
   562            C        	MOV     A,@0X20
   563            C        	MOV     0X10,A
   564            C        	MOV     A,@0XA0
   565            C        	MOV     RSR,A
   566            C        
   567            C        ;CLRLOOPU3:
   568            C        	CLR     R0
   569            C        	INC     RSR
   570            C        	DJZ     0X10
   571            C        	JMP     $-3            ;CLRLOOPU3
   572            C        	CLR     R0
   573            C        
   574            C        	MOV     A,@0X11
   575            C        	MOV     RD,A
   576            C        	CLR     RE
   577            C        	MOV     A,@1
   578            C        	MOV     RD,A
   579            C        	MOV     A,@0X00
   580            C        	MOV     RE,A
   581            C        	MOV     RE,A
   582            C        	MOV     RE,A
   583            C        	MOV     RE,A
   584            C        	MOV     RE,A
   585            C        	MOV     RE,A
   586            C        	MOV     RE,A
   587            C        	MOV     RE,A
   588            C        	BS      RC,5
   589            C        
   590            C        
   591            C        ELSEIFDEF EM78P447.H
   592            C         	MOV     A,@0x10
   593            C        	MOV     R4,A
   594            C        ;CLEAR_RAM_LOOP_P447:
   595            C        	CLR     R0
   596            C        	INC     R4
   597            C        	JBC     R4,6
   598            C        	BS      R4,5
   599            C        	JBC     R4,7
   600            C        	BS      R4,5
   601            C        	JBS     R3,Z
   602            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P447:
   603            C        	CLR     R4
   604            C        
   605            C        ELSEIFDEF EM78P468.H
   606            C        	MOV     A,@0X10
   607            C        	MOV     RSR,A
   608            C        ;CLEAR_RAM_LOOP_P468:
   609            C        	CLR     R0
   610            C        	INC     RSR
   611            C        	JBC     RSR,6
   612            C        	BS      RSR,5
   613            C        	JBC     RSR,7
   614            C        	BS      RSR,5
   615            C        	JBS     STATUS,Z
   616            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P468
   617            C        	CLR     RSR
   618            C        
   619            C        ELSEIFDEF EM78P458.H
   620            C                MOV     A,@0X10
   621            C                MOV     RSR,A
   622            C        ;CLEAR_RAM_LOOP_P458:
   623            C                CLR     R0
   624            C                INC     RSR
   625            C                JBC     RSR,6
   626            C                BS      RSR,5
   627            C                JBS     RSR,7
   628            C                JMP     $-5        ; CLEAR_RAM_LOOP_P458
   629            C                CLR     RSR
   630            C        
   631            C        ELSEIFDEF EM78P451.H
   632            C                MOV     A,@0X10
   633            C                MOV     RSR,A
   634            C        ;CLEAR_RAM_LOOP_P451:
   635            C                CLR     R0
   636            C                INC     RSR
   637            C                JBC     RSR,6
   638            C                BS      RSR,5
   639            C                JBC     RSR,7
   640            C                BS      RSR,5
   641            C                JBS     STATUS,Z
   642            C                JMP     $-7        ; CLEAR_RAM_LOOP_P451
   643            C        
   644            C        ELSE
   645            C        	MOV     A,@0x10        ; clear all ram bank
   646            C        	MOV     R4,A
   647            C        ;CLEAR_RAM_LOOP:
   648            C        	CLR     R0
   649            C        	INC     R4
   650            C        	JBC     R4,6
   651            C        	BS      R4,5
   652            C        	JBC     R4,7
   653            C        	BS      R4,5
   654            C        	JBS     R3,Z
   655            C        	JMP     $-7            ; CLEAR_RAM_LOOP:
   656            C        	CLR     R4
   657            C        	MESSAGE "Clear all RAM bank"
   658            C        ENDIF
   659            C        ENDM
   660            C        
   661            C        ;*******************************************
   662            C        ; RAM clear function
   663            C        ; [ELSE]: default the MCU have four bank
   664            C        ; others: xx.h must be define in "xx.h"
   665            C        ;*******************************************
   666            C        ClrCommRamBank MACRO
   667            C        	MOV                 A, @0X10                ; RAM 
   668            C        	MOV                 R4, A
   669            C        CLEAR_10_1F_RAM_LOOP:
   670            C        	WDTC
   671            C        	CLR                 R0
   672            C        	INC                 R4
   673            C        	MOV                 A,@0B00111111
   674            C        	AND                 A,R4
   675            C        	SUB                 A,@0X1F
   676            C        	JBC                 R3,C
   677            C        	JMP                 CLEAR_10_1F_RAM_LOOP
   678            C        	CLR                 R4
   679            C        ENDM
   680            C        
   681            C        
    15                     include "config.h"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        ; Company       : ELAN
     5            C        ; VERSION       : 1.1
     6            C        ; CRYSTAL       : 8MHZ
     7            C        ; Creat date    : 2009/11/4
     8            C        ; tool ver.     : WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-------------------------------------------------------------------------
    12            C        config.h   EQU    config.h
    13            C        
    14            C        ;-------------------------------------------------------------------------
    15            C        
    16            C        
    17       0000 C        USED_PID_FUNCTION               EQU     0     ; 1:used this function; 0:not used
    18       0020 C        DataBufferBase                  EQU     0x20  ; address:0x20 ,bit6:select all bank
    19       0008 C        ComuTime                        EQU     8     ; 8ms
    20       0000 C        RetryCNT                        EQU     0     ; transmit 2 Times
    21       00C8 C        SetSleepTime                    EQU     200   ; T=(SetSleepTime+1)*2s
    22       0097 C        RX_IDH_DEFAULT                  EQU     0X97  
    23       003A C        RX_IDL_DEFAULT                  EQU     0X3A  ; Adress_default =  (RX_IDL_DEFAULT&0x0f)|0x01
    24            C        
    16                     include "P520txP32P44V11.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.1
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/4
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;  Description: PAGE0(0X0000-0X03FF): MCU initial
    12            C        ;               PAGE1(0X0400-0X07FF): searchmode
    13            C        ;               PAGE2(0X0800-0X0BFF): normalmode
    14            C        ;               PAGE3(0X0C00-0X0FFF): RF driver
    15            C        ;               PAGE4(0X1000-0X13FF): key scan driver
    16            C        ;               PAGE5(0X1400-0X17FF): CMOS driver
    17            C        ;               PAGE6(0X1800-0X1BFF): CMOS/GS driver
    18            C        ;               PAGE7(0X1C00-0X1FFF): Kalman Filter arithmetic
    19            C        
    20            C        ;========================================================================
    21            C        P520txP32P44V11.H                EQU     P520txP32P44V11.H
    22            C        
    23            C        
    24            C        
    25            C        ;========================================================================
    26       0010 C        TEMP                            EQU     0X10
    27       0011 C        TEMP1                           EQU     0X11
    28       0012 C        TEMP2                           EQU     0X12
    29       0013 C        TEMP3                           EQU     0X13
    30       0014 C        TEMP4                           EQU     0X14
    31       0015 C        TEMP5                           EQU     0X15
    32       0016 C        TEMP6                           EQU     0X16
    33            C        
    34       0017 C        ComuClock                       EQU     0X17  ;communicateion clock
    35       0018 C        ComuCycleNum                    EQU     0X18  ;communicateion time
    36       0019 C        ComuEndNum                      EQU     0X19  ;communicateion end time
    37       001A C        Databytelength                  EQU     0X1A  ;FIFO READ/WRITE DATA LENGTH
    38       001B C        DataShiftCounter                EQU     0X1B  ;data counter
    39       001C C        SleepCNT                        EQU     0X1C  ;data conunter
    40            C        
    41       001D C        GeneralStatusFlag1              EQU     0X1D
    42       01D7 C        	RFInitialFailFlag           ==      GeneralStatusFlag1*16+7 ;
    43       01D6 C        	RFInitialOKFlag             ==      GeneralStatusFlag1*16+6
    44       01D5 C        	RFTestFailFlag              ==      GeneralStatusFlag1*16+5
    45       01D1 C        	IntoSleepFlag               ==      GeneralStatusFlag1*16+1
    46       01D0 C        	ToWakeupFlag                ==      GeneralStatusFlag1*16+0
    47            C        
    48       001E C        GeneralStatusFlag2              EQU     0X1E
    49       01E7 C        	System16msFlag              ==      GeneralStatusFlag2*16+7
    50            C        	;System8msFlag               ==      GeneralStatusFlag2*16+6
    51       01E5 C        	KeyScanFinishFlag           ==      GeneralStatusFlag2*16+5
    52       01E4 C        	KeyStatusFlag               ==      GeneralStatusFlag2*16+4
    53       01E3 C        	KeyScanStatusFlag           ==      GeneralStatusFlag2*16+3
    54       01E2 C        	ReadLengthError             ==      GeneralStatusFlag2*16+2
    55            C        
    56       001F C        CommuStatusFlag                 EQU     0X1F
    57       01F7 C        	DescriptorFinishFlag        ==      CommuStatusFlag*16+7   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    58       01F6 C        	FccTestModeFlag             ==      CommuStatusFlag*16+6
    59       01F5 C        	ForceLinkModeFlag           ==      CommuStatusFlag*16+5   ; force link flag
    60       01F4 C        	LinkModeFlag                ==      CommuStatusFlag*16+4   ; link flag
    61       01F3 C        	EEpromWRStatusFlag          ==      CommuStatusFlag*16+3
    62       01F2 C        	LoseFrameStatusFlag         ==      CommuStatusFlag*16+2   ; lose frequency and search mode flag
    63       01F1 C        	NormalStatusFlag            ==      CommuStatusFlag*16+1   ; Normal mode Flag
    64       01F0 C        	SearchStatusFlag            ==      CommuStatusFlag*16+0   ; Search mode flag
    65            C        
    66            C        ;------------------------------------------------------------------
    67       0011 C        r_acc1                          EQU     TEMP1
    68       0012 C        r_acc2                          EQU     TEMP2
    69       0013 C        r_acc3                          EQU     TEMP3
    70       0014 C        DataAddressInMCU                EQU     TEMP4         ;93C46
    71       0015 C        DataAddressInEEPROM             EQU     TEMP5
    72            C        
    73       0014 C        A_TEMP                          EQU     TEMP4  ;used for PUSH1 and POP1
    74       0015 C        RSR_TEMP                        EQU     TEMP5
    75       0016 C        STATUS_TEMP                     EQU     TEMP6
    76            C        
    77            C        ;------------------------------------------------------------------
    78       0019 C        FccFreqIndex                    EQU     ComuEndNum    ;FCC TEST
    79            C        
    80            C        
    81            C        ;========================= I/O Port Define ==============================
    82       00A7 C        SPI_SS                      ==      PortA*16+7 ;PA7    EM198810/EM198850 enable select
    83       00A6 C        SPI_CLK                     ==      PortA*16+6 ;PA6
    84       00A5 C        SPI_MOSI                    ==      PortA*16+5 ;PA5
    85       00A4 C        SPI_MISO                    ==      PortA*16+4 ;PA4
    86       00A3 C        RESET_N                     ==      PortA*16+3 ;PA3
    87       00A2 C        FIFO_FLAG                   ==      PortA*16+2 ;PB1
    88       00B0 C        PKT_FLAG                    ==      PortB*16+0 ;PB0
    89            C        
    90       00A1 C        CMOS_RST                    ==      PortA*16+1 ;PA1
    91       00A0 C        CMOS_SS                     ==      PortA*16+0 ;PA0
    92            C        
    93       0073 C        AT93C46_CS                  ==      Port7*16+3 ;4  93c46 enable select
    94            C        
    95       0081 C        LED1_STATUS                 ==      PORT8*16+1 ;LED
    96       0082 C        LED2_STATUS                 ==      PORT8*16+2 ;LED
    97            C        
    98       0007 C        Reference                   ==      7          ;port87
    99       0006 C        Leakresis                   ==      6          ;port86
   100       0000 C        LeftYAxis                   ==      0          ;port90  LY
   101       0001 C        LeftXAxis                   ==      1          ;port91  LX
   102       0002 C        RightYAxis                  ==      2          ;port92  RY
   103       0003 C        RightXAxis                  ==      3          ;port93  RX
   104            C        
   105            C        
   106            C        
   107            C        
   108            C        ;======================= BANK 0 (data buffer)============================
   109            C        ; bank0 20-3f used for data exchange section
   110            C        ; such as read or write EEPROM and RF,it used for data buffer
   111            C        
   112            C        ;------------------------------------------------------------------
   113       0020 C        PID_DATA_Buffer         EQU     0X20    ; PID DATA
   114       0021 C        RX_IDH_Buffer           EQU     0X21    ; master ID
   115       0022 C        RX_IDL_Buffer           EQU     0X22
   116       0023 C        CHN_FLAG_Buffer         EQU     0X23    ; Channel flag, gamepad status
   117       0024 C        CommuStatusFlag_Buffer  EQU     0X24
   118       0025 C        DirectionCtrl_Buffer    EQU     0X25    ; Communication trsmitter direction
   119       0026 C        N_CHN_Buffer            EQU     0X26    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   120       0026 C        TX_ID_Buffer            EQU     0X26    ; repeat package data
   121            C        
   122       0027 C        TX1_ID_Buffer           EQU     0X27     ;
   123       0028 C        TX2_ID_Buffer           EQU     0X28     ;
   124       0029 C        TX3_ID_Buffer           EQU     0X29     ;
   125       002A C        TX4_ID_Buffer           EQU     0X2A     ;
   126       002B C        TX5_ID_Buffer           EQU     0X2B     ;
   127       002C C        TX6_ID_Buffer           EQU     0X2C     ;
   128            C        ;-----------------------------------------------------------------
   129       0027 C        DataA_Buffer            EQU     0X27 ;rocker, left-x(left-right) data
   130       0028 C        DataB_Buffer            EQU     0X28 ;rocker, left-y(up-down) data
   131       0029 C        DataC_Buffer            EQU     0X29 ;rocker, right-x(left-right) data
   132       002A C        DataD_Buffer            EQU     0X2A ;rocker, right-y(up-down) data
   133       002B C        DataE_Buffer            EQU     0X2B ;A,B,C,D,L1,R1,L2,R2
   134       002C C        DataF_Buffer            EQU     0X2C ;Select,start,LSW,RSW,MODE,MACRO,TEST1,TEST2
   135       002D C        DataG_Buffer            EQU     0X2D ;000:00001:45010:90011:135100:180101:225110:270111:315
   136            C        
   137            C        ;======================= BANK 1 (RF variable)============================
   138       0020 C        PID_DATA                EQU     0X20
   139       0021 C        RX_IDH                  EQU     0X21    ; master ID
   140       0022 C        RX_IDL                  EQU     0X22
   141       0023 C        CHN_FLAG                EQU     0X23    ; Channel flag, gamepad status
   142            C        ;CommuStatusFlag
   143       0025 C        DirectionCtrl           EQU     0X25    ; Communication trsmitter direction
   144       0026 C        N_CHN                   EQU     0X26    ; N_CHN= ((TotalGamepads<<4) & 0xF0)|(CH_NO & 0x0F)
   145       0026 C        TX_ID                   EQU     0X26     ;
   146       0027 C        TX1_ID                  EQU     0X27     ;
   147       0028 C        TX2_ID                  EQU     0X28     ;
   148       0029 C        TX3_ID                  EQU     0X29     ;
   149       002A C        TX4_ID                  EQU     0X2A     ;
   150       002B C        TX5_ID                  EQU     0X2B     ;
   151       002C C        TX6_ID                  EQU     0X2C     ;
   152            C        
   153            C        ;-----------------------------------------------------------------
   154       0030 C        ADDR                    EQU     0X30 ;in/out Data Address
   155       0031 C        VALUE                   EQU     0X31 ;in/out Data
   156       0032 C        CH_NO                   EQU     0X32
   157       0033 C        LossframeCNT            EQU     0X33
   158       0034 C        TABLE_INDEX             EQU     0x34  ;descriptor table's start position
   159       0035 C        RF_RSSI                 EQU     0X35
   160            C        
   161            C        
   162            C        ;======================= BANK 2 (key data)==============================
   163       0020 C        DataA                   EQU     0X20 ;rocker left-x(left-right)  RF transmitter data
   164       0021 C        DataB                   EQU     0X21 ;rocker left-y(up-down)     RF transmitter data
   165       0022 C        DataC                   EQU     0X22 ;rocker right-x(left-right) RF transmitter data
   166       0023 C        DataD                   EQU     0X23 ;rocker right-y(up-down)    RF transmitter data
   167       0024 C        DataE                   EQU     0x24 ;DataA(s10-s5):
   168            C                                ;bit7  bit6  Bit5  Bit4  Bit3  bit2  bit1  bit0
   169            C                                ;A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   170       0025 C        DataF                   EQU     0x25 ;DataB(s4-s1):
   171            C                                ;bit7      bit6      Bit5      Bit4   Bit3  bit2    bit1    bit0
   172            C                                ;SELECT_9  START_10  TEST2_14  MACRO  MODE  RSW_12  LSW_11  TEST1_13
   173            C                                ;MODE: 1:DealWithDigital  0:DealWithAnalog (default:1)
   174       0026 C        DataG                   EQU     0X26 ;bit[7..4]Hat Switch, bit[3..0]reserve.
   175            C                                ;000:00001:45010:90011:135100:180101:225110:270111:315
   176            C        
   177            C        
   178            C        
   179       0030 C        KEY_LEFT_X              EQU     0X30 ;rocker,AD convert result left-x(left-right) data
   180       0031 C        KEY_LEFT_Y              EQU     0X31 ;rocker,AD convert result left-y(up-down) data
   181       0032 C        KEY_RIGHT_X             EQU     0X32 ;rocker,AD convert result right-x(left-right) data
   182       0033 C        KEY_RIGHT_Y             EQU     0X33 ;rocker,AD convert result right-y(up-down) data
   183            C        
   184       0034 C        IOcheckTimeCNT          EQU     0X34 ;used for count check time
   185       0035 C        KeySystemTimeCNT        EQU     0x35    ;key scan time
   186       0036 C        KeystokeFlag_Befor      EQU     0X36
   187       0037 C        KeystokeTimeCNT         EQU     0X37        ;       Click                     Dblclick                    Lasting_Press
   188            C                                                    ;________    _______.__________    ______    ________.___________         ____________
   189            C                                                    ;        |__|                  |__|      |__|                    |_______|
   190       0038 C        KEY_NUM                 EQU     0X38
   191            C                                                    ;___________                       _________                              ____________
   192            C                                                    ;           |_______._____________|         |________.___________________|
   193            C        
   194            C        ;F_MODE                  EQU     0X32 ;Analog jugde falg
   195            C        ;F_MODE_BEFOR            EQU     0X33 ;Store keyboard select
   196       0039 C        KeyTempFlag             EQU     0X39 ;Store LINE4_KEY_INPUT TEMP
   197       0394 C        	ModeSelFlag         ==      KeyTempFlag*16+4 ;1:analog  0:digital(default 0)
   198       0395 C        	MacroFlag           ==      KeyTempFlag*16+5
   199       0396 C        	Test1Flag           ==      KeyTempFlag*16+6
   200       0397 C        	Test2Flag           ==      KeyTempFlag*16+7
   201            C        
   202       003A C        KeyTempBakupFlag        EQU     0X3A
   203       03A4 C        	ModeSelBakupFlag    ==      KeyTempBakupFlag*16+4 ;1:analog  0:digital(default 0)
   204       03A5 C        	MacroBakupFlag      ==      KeyTempBakupFlag*16+5
   205       03A6 C        	Test1BakupFlag      ==      KeyTempBakupFlag*16+6
   206       03A7 C        	Test2BakupFlag      ==      KeyTempBakupFlag*16+7
   207            C        
   208       003B C        LINE1_KEY_INPUT_CACHE   EQU     0X3B ;line 1,direction data
   209       003C C        LINE2_KEY_INPUT_CACHE   EQU     0X3C ;line 2,X_LINE2 output
   210       003D C        LINE3_KEY_INPUT_CACHE   EQU     0X3D ;line 3,X_LINE3 output
   211       003E C        LINE4_KEY_INPUT_CACHE   EQU     0X3E ;line 4,X_LINE4 output
   212       003F C        LINE5_KEY_INPUT_CACHE   EQU     0X3F ;line 5,X_LINE5 output
   213            C        
   214            C        ;======================= BANK 3 (reserve)===============================
   215            C        
   216            C        
   217            C        
   218            C        ;======================= BANK 4 (Push data)=============================
   219       0020 C        ATcc_TEMP               EQU     0X20  ;used for TCC and POP3
   220       0021 C        RSRTcc_TEMP             EQU     0X21
   221       0022 C        StatusTcc_TEMP          EQU     0X22
   222            C        
   223       0023 C        AExt_TEMP               EQU     0X23  ;used for External and POP3
   224       0024 C        RSRExt_TEMP             EQU     0X24
   225       0025 C        StatusExt_TEMP          EQU     0X25
   226            C        
   227       0026 C        A1_TEMP                 EQU     0X26  ;used for time1 and POP1
   228       0027 C        RSR1_TEMP               EQU     0X27
   229       0028 C        STATUS1_TEMP            EQU     0X28
   230            C        
   231       0029 C        A2_TEMP                 EQU     0X29  ;used for time2 and POP2
   232       002A C        RSR2_TEMP               EQU     0X2A
   233       002B C        STATUS2_TEMP            EQU     0X2B
   234            C        
   235            C        ;-----------------------------------------------------------
   236       0030 C        SPIS_TEMP               EQU     0X30
   237       0031 C        SPIC_TEMP               EQU     0X31
   238            C        
   239            C        ;======================= BANK 5 (CMOS Data)============================
   240       0020 C        CMOS_PARAMETER          EQU     0X20
   241       0021 C        CMOS_STATUS             EQU     0X21
   242       0210 C        	CMOSInitFlag        ==      CMOS_STATUS*16+0
   243       0211 C        	CMOSSleepFlag       ==      CMOS_STATUS*16+1
   244       0212 C        	CMOSGetDataFlag     ==      CMOS_STATUS*16+2		
   245            C        
   246       0022 C        CMOS_XPOINT_LOW         EQU     0X22
   247       0023 C        CMOS_YPOINT_LOW         EQU     0X23
   248       0024 C        CMOS_POINT_HIGH         EQU     0X24
   249            C        
   250            C        
   251            C        
   252            C        
   253            C        ;======================= BANK 6 (CMOS Data)============================
   254       0020 C        CMOS_X1_H               EQU     0X20    ; X1[9..8]
   255       0021 C        CMOS_X1_L               EQU     0X21    ; X1[7..0]
   256       0022 C        CMOS_Y1_H               EQU     0X22    ; Y1[9..8]
   257       0023 C        CMOS_Y1_L               EQU     0X23    ; Y1[7..0]
   258       0024 C        CMOS_Size1              EQU     0X24    ; Size1[3..0]
   259            C        
   260       0020 C        CMOS_X2_H               EQU     0X20    ; X1[9..8]
   261       0021 C        CMOS_X2_L               EQU     0X21    ; X1[7..0]
   262       0022 C        CMOS_Y2_H               EQU     0X22    ; Y1[9..8]
   263       0023 C        CMOS_Y2_L               EQU     0X23    ; Y1[7..0]
   264       0024 C        CMOS_Size2              EQU     0X24    ; Size1[3..0]
   265            C        
   266            C        
   267            C        ;======================= BANK 7 (GS Data)============================
   268       0020 C        GS_PARAMETER            EQU     0X20
   269       0021 C        GS_STATUS               EQU     0X21
   270       0210 C        	GSInitFlag          ==      GS_STATUS*16+0
   271       0211 C        	GSSleepFlag         ==      GS_STATUS*16+1
   272       0212 C        	GSGetDataFlag       ==      GS_STATUS*16+2
   273            C        
   274       0022 C        GS_XPOINT_LOW           EQU     0X22
   275       0023 C        GS_YPOINT_LOW           EQU     0X23
   276       0024 C        GS_ZPOINT_LOW           EQU     0X24
   277       0035 C        GS_POINT_HIGH           EQU     0X35
    17                     include "EM198850_For_EM78P520.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM198850 Driver.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL	   :  4MHZ
     7            C        * Creat date   :  2009/9/11
     8            C        * tool ver.    :  WicePlus 2.7
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ifndef EM198850_For_EM78P520.H
    12            C        include "EM198850_For_EM78P520.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL	   :  4MHZ
     7            C        * Creat date   :  2009/9/11
     8            C        * tool ver.    :  WicePlus 2.7
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        
    12            C        ;--------------------------------------------------------------------------
    13       0052 C        FIFO_PTR                EQU     82			;FIFO POINTER CONTROL=REG 82
    14       0080 C        CLR_W_PTR               EQU     0X80		;CLR POINTER MARK VALUE
    15       0050 C        FIFO_REG                EQU     80			;FIFO POINTER=REG 80
    16       0080 C        READ_MASK               EQU     0X80		;READ REG,MSB SET TO 1
    17       0080 C        RX_MASK                 EQU     0X80		;ENABLE RX
    18            C        
    19       0010 C        PKT_LEN                 EQU     0X10        ;DataByteLength = 16
    20       0000 C        TXADDRL                 EQU     0X00
    21       0011 C        TXADDRH                 EQU     0X11
    22       0060 C        RX_BUF                  EQU     0B01100000
    23       0060 C        TX_BUF                  EQU     0B01100000
    24            C        
    25            C        
    26            C        
    27            C        
    28            C        
    29            C        ;==================================================================
    30            C        
    13            C        endif
    14            C        
    15            C        
    16            C        ;-------------------------------------------------------------
    17            C        
    18            C        	ORG     0X0C00    ;PAGE 3
    19            C        ;**************************************************
    20            C        ;LOOKUP TABLE
    21            C        ;Famer Register initial value(Reg48~57)
    22            C        ;**************************************************
    23 00C00      C        FRAME_TABLE:
    24 00C00 03C2 C        	ADD                 PC,A
    25 00C01 1C4E C        	RETL                @0X4E		;1		01---16M
    26 00C02 1C02 C        	RETL                @0X02		;2		10---24M
    27            C        
    28 00C03 1C4D C        	RETL                @0X4D		;3		RESET FIFO
    29 00C04 1C01 C        	RETL                @0X01		;4
    30            C        
    31 00C05 1C42 C        	RETL                @0X42		;5		24M/1MBPS
    32 00C06 1C98 C        	RETL                @0X98		;6
    33            C        
    34 00C07 1C43 C        	RETL                @0X43		;7
    35 00C08 1CC8 C        	RETL                @0XC8 		;8		;default:C4  Set sync word lengthCRC count
    36            C        
    37 00C09 1C44 C        	RETL                @0X44		;9		PKT_LEN
    38 00C0A 1C10 C        	RETL                @PKT_LEN	;10		24 DATA
    39            C        
    40 00C0B 1C45 C        	RETL                @0X45		;11		PKTCNT
    41 00C0C 1C10 C        	RETL                @0X10		;12		1 packet
    42            C        
    43 00C0D 1C46 C        	RETL                @0X46		;13		BIT3~5	TX AMPLIFIER DELAY 10+5X
    44 00C0E 1C09 C        	RETL                @0X09		;14		BIT0~2	PLL DELAY 120+20X
    45            C        
    46 00C0F 1C47 C        	RETL                @0X47		;15		BIT4~7  RETRY CNT
    47 00C10 1C11 C        	RETL                @0X11		;16		BIT0~3	SLOT TIME UNIT 10US
    48            C        
    49 00C11 1C48 C        	RETL                @0X48		;17		SLOT
    50 00C12 1C01 C        	RETL                @0X01		;18
    51            C        
    52 00C13 1C49 C        	RETL                @0X49		;19		ACKTOSLOT
    53 00C14 1C14 C        	RETL                @0X14 		;20     default: 0X8A
    54            C        
    55 00C15 1C4A C        	RETL                @0X4A		;21		RSSITH
    56 00C16 1C27 C        	RETL                @0X27		;22
    57            C        
    58 00C17 1C4B C        	RETL                @0X4B		;23		RF_RSSI
    59 00C18 1C00 C        	RETL                @0X00		;24
    60            C        
    61 00C19 1C4C C        	RETL                @0X4C		;25		TD_PLL	IN UNIT 10US
    62 00C1A 1C06 C        	RETL                @0X06		;26
    63            C        
    64 00C1B 1C50 C        	RETL                @0X50		;27		TXADDR
    65 00C1C 1C00 C        	RETL                @TXADDRL	;28
    66            C        
    67 00C1D 1C51 C        	RETL                @0X51		;29		TX ADDR
    68 00C1E 1C11 C        	RETL                @TXADDRH	;30
    69            C        
    70 00C1F 1C52 C        	RETL                @0X52		;31		RX	ADDR1
    71 00C20 1C22 C        	RETL                @0X22		;32
    72            C        
    73 00C21 1C53 C        	RETL                @0X53		;33		RX	ADDR2
    74 00C22 1C33 C        	RETL                @0X33		;34
    75            C        
    76 00C23 1C54 C        	RETL                @0X54		;35		RX	ADDR3
    77 00C24 1C44 C        	RETL                @0X44		;36
    78            C        
    79 00C25 1C55 C        	RETL                @0X55		;37		RX	ADDR4
    80 00C26 1C55 C        	RETL                @0X55		;38
    81            C        
    82 00C27 1C56 C        	RETL                @0X56		;39		RX	ADDR5
    83 00C28 1C66 C        	RETL                @0X66		;40
    84            C        
    85 00C29 1C57 C        	RETL                @0X57		;41		RX	ADDR6
    86 00C2A 1C77 C        	RETL                @0X77		;42
    87            C        
    88 00C2B 1C58 C        	RETL                @0X58		;43
    89 00C2C 1C08 C        	RETL                @0X08		;44
    90            C        
    91            C        ;-----------------------------------------------------------
    92 00C2D 1C00 C        	RETL                @0X00		;45
    93 00C2E 1CE5 C        	RETL                @0XE5		;46
    94            C        
    95 00C2F 1C01 C        	RETL                @0X01		;47
    96 00C30 1C84 C        	RETL                @0X84		;48
    97            C        
    98 00C31 1C02 C        	RETL                @0X02		;49
    99 00C32 1C00 C        	RETL                @0X00		;50		CHANNEL
   100            C        
   101 00C33 1C03 C        	RETL                @0X03		;51
   102 00C34 1CC6 C        	RETL                @0XC6		;52
   103            C        
   104 00C35 1C04 C        	RETL                @0X04		;53
   105 00C36 1C00 C        	RETL                @0X00		;54
   106            C        
   107 00C37 1C05 C        	RETL                @0X05		;55
   108 00C38 1C40 C        	RETL                @0X40		;56
   109            C        
   110 00C39 1C06 C        	RETL                @0X06		;57
   111 00C3A 1C5D C        	RETL                @0X5D		;58
   112            C        
   113 00C3B 1C07 C        	RETL                @0X07		;59
   114 00C3C 1C18 C        	RETL                @0X18		;60
   115            C        
   116 00C3D 1C08 C        	RETL                @0X08		;61
   117 00C3E 1C40 C        	RETL                @0X40		;62
   118            C        
   119 00C3F 1C09 C        	RETL                @0X09		;63
   120 00C40 1C18 C        	RETL                @0X18		;64
   121            C        
   122 00C41 1C0A C        	RETL                @0X0A		;65
   123 00C42 1C47 C        	RETL                @0X47		;66
   124            C        
   125 00C43 1C0B C        	RETL                @0X0B		;67
   126 00C44 1C0B C        	RETL                @0X0B		;68
   127            C        
   128 00C45 1C0C C        	RETL                @0X0C		;69
   129 00C46 1CE0 C        	RETL                @0XE0		;70
   130            C        
   131 00C47 1C0D C        	RETL                @0X0D		;71
   132 00C48 1C4F C        	RETL                @0X4F		;72
   133            C        
   134 00C49 1C0E C        	RETL                @0X0E		;73
   135 00C4A 1C11 C        	RETL                @0X11		;74
   136            C        
   137 00C4B 1C0F C        	RETL                @0X0F		;75
   138 00C4C 1C1C C        	RETL                @0X1C		;76
   139            C        
   140 00C4D 1C20 C        	RETL                @0X20		;77
   141 00C4E 1CAD C        	RETL                @0XAD		;78
   142            C        
   143 00C4F 1C21 C        	RETL                @0X21		;79
   144 00C50 1C64 C        	RETL                @0X64		;80
   145            C        
   146 00C51 1C22 C        	RETL                @0X22		;81
   147 00C52 1C00 C        	RETL                @0X00		;82
   148            C        
   149 00C53 1C23 C        	RETL                @0X23		;83
   150 00C54 1CC3 C        	RETL                @0XC3		;84
   151            C        
   152 00C55 1C24 C        	RETL                @0X24		;85
   153 00C56 1CBD C        	RETL                @0XBD		;86
   154            C        
   155 00C57 1C25 C        	RETL                @0X25		;87
   156 00C58 1CA2 C        	RETL                @0XA2		;88
   157            C        
   158 00C59 1C26 C        	RETL                @0X26		;89
   159 00C5A 1C1A C        	RETL                @0X1A		;90
   160            C        
   161 00C5B 1C27 C        	RETL                @0X27		;91
   162 00C5C 1C09 C        	RETL                @0X09		;92
   163            C        
   164 00C5D 1C28 C        	RETL                @0X28		;93
   165 00C5E 1C00 C        	RETL                @0X00		;94
   166            C        
   167 00C5F 1C29 C        	RETL                @0X29		;95
   168 00C60 1CB8 C        	RETL                @0XB8		;96
   169            C        
   170 00C61 1C2A C        	RETL                @0X2A		;97
   171 00C62 1C71 C        	RETL                @0X71		;98
   172            C        
   173 00C63 1C2B C        	RETL                @0X2B		;99
   174 00C64 1C06 C        	RETL                @0X06		;100
   175            C        
   176 00C65 1C2C C        	RETL                @0X2C		;101
   177 00C66 1C80 C        	RETL                @0X80		;102
   178            C        
   179 00C67 1C2D C        	RETL                @0X2D		;103
   180 00C68 1C1A C        	RETL                @0X1A		;104
   181            C        
   182 00C69 1C2E C        	RETL                @0X2E		;105
   183 00C6A 1C09 C        	RETL                @0X09;03		;106
   184            C        
   185 00C6B 1C2F C        	RETL                @0X2F		;107
   186 00C6C 1C64 C        	RETL                @0X64		;108
   187            C        
   188 00C6D 1C30 C        	RETL                @0X30		;109
   189 00C6E 1CC0 C        	RETL                @0XC0		;110
   190            C        
   191 00C6F 1C31 C        	RETL                @0X31		;111
   192 00C70 1C00 C        	RETL                @0X00		;112
   193            C        
   194 00C71 1C32 C        	RETL                @0X32		;113
   195 00C72 1C40 C        	RETL                @0X40		;114
   196            C        
   197 00C73 1C33 C        	RETL                @0X33		;115
   198 00C74 1C3B C        	RETL                @0X3B		;116
   199            C        
   200 00C75 1C00 C        	RETL                @0X00		;117
   201 00C76 1CA7 C        	RETL                @0XA7		;118
   202            C        
   203 00C77 1C32 C        	RETL                @0X32		;119
   204 00C78 1C4A C        	RETL                @0X4A		;120
   205            C        
   206 00C79 1C00 C        	RETL                @0X00		;121
   207 00C7A 1CE5 C        	RETL                @0XE5		;122
   208            C        
   209 00C7B 1C0E C        	RETL                @0X0E		;123
   210 00C7C 1C91 C        	RETL                @0X91		;124
   211            C        
   212 00C7D 1C40 C        	RETL                @0X40		;125
   213 00C7E 1C51 C        	RETL                @0X51		;126
   214            C        
   215 00C7F 1C41 C        	RETL                @0X41		;127
   216 00C80 1CBF C        	RETL                @0XBF		;128
   217            C        
   218 00C81 1C0C C        	RETL                @0X0C		;129
   219 00C82 1CC0 C        	RETL                @0XC0		;130
   220            C        
   221 00C83 1C02 C        	RETL                @0X02		;131
   222 00C84 1C80 C        	RETL                @0X80		;132
   223            C        
   224 00C85 1C04 C        	RETL                @0X04		;133
   225 00C86 1C4A C        	RETL                @0X4A		;134
   226            C        
   227 00C87 1C05 C        	RETL                @0X05		;135
   228 00C88 1CDA C        	RETL                @0XDA		;136
   229            C        
   230 00C89 1C06 C        	RETL                @0X06		;137
   231 00C8A 1CFA C        	RETL                @0XFA		;138
   232            C        
   233 00C8B 1CFF C        	RETL                @0XFF
   234            C        
   235            C        ;===========================================================
   236 00C8C      C        RF_TABLE:			;LENGTH 30
   237 00C8C 03C2 C        	ADD                 PC,A
   238 00C8D 1C4E C        	RETL                @0X4E
   239 00C8E 1C02 C        	RETL                @0X02
   240            C        
   241 00C8F 1C43 C        	RETL                @0X43
   242 00C90 1CC8 C        	RETL                @0XC8
   243            C        
   244 00C91 1C44 C        	RETL                @0X44
   245 00C92 1C10 C        	RETL                @PKT_LEN
   246            C        
   247 00C93 1C45 C        	RETL                @0X45
   248 00C94 1C10 C        	RETL                @0X10
   249            C        
   250 00C95 1C48 C        	RETL                @0X48
   251 00C96 1C01 C        	RETL                @0X01
   252            C        
   253 00C97 1C4C C        	RETL                @0X4C
   254 00C98 1C06 C         	RETL                @0X06
   255            C        
   256 00C99 1C50 C        	RETL                @0X50
   257 00C9A 1C00 C        	RETL                @TXADDRL
   258            C        
   259 00C9B 1C51 C        	RETL                @0X51
   260 00C9C 1C11 C        	RETL                @TXADDRH
   261            C        
   262 00C9D 1C52 C        	RETL                @0X52
   263 00C9E 1C22 C        	RETL                @0X22
   264            C        
   265 00C9F 1C53 C        	RETL                @0X53
   266 00CA0 1C33 C        	RETL                @0X33
   267            C        
   268 00CA1 1C54 C        	RETL                @0X54
   269 00CA2 1C44 C        	RETL                @0X44
   270            C        
   271 00CA3 1C55 C        	RETL                @0X55
   272 00CA4 1C55 C        	RETL                @0X55
   273            C        
   274 00CA5 1C56 C        	RETL                @0X56
   275 00CA6 1C66 C        	RETL                @0X66
   276            C        
   277 00CA7 1C57 C        	RETL                @0X57
   278 00CA8 1C77 C        	RETL                @0X77
   279            C        
   280 00CA9 1C58 C        	RETL                @0X58
   281 00CAA 1C08 C        	RETL                @0X08
   282            C        
   283 00CAB 1CFF C        	RETL                @0XFF
   284            C        ;===========================================================
   285 00CAC      C        CH_TABLE:
   286 00CAC 03C2 C        	ADD                 PC,A
   287 00CAD 1C1D C        	RETL                @29        ;freq:2431 ;@0X1D
   288 00CAE 1C04 C        	RETL                @4         ;freq:2406 ;@0X04
   289 00CAF 1C43 C        	RETL                @67        ;freq:2469 ;@0X43
   290 00CB0 1C20 C        	RETL                @32        ;freq:2434 ;@0X20
   291            C        
   292 00CB1 1C07 C        	RETL                @7         ;freq:2409 ;@0X07
   293 00CB2 1C41 C        	RETL                @65        ;freq:2467 ;@0X41
   294 00CB3 1C24 C        	RETL                @36        ;freq:2438 ;@0X24
   295 00CB4 1C0A C        	RETL                @10        ;freq:2412 ;@0X0A
   296            C        
   297 00CB5 1C3E C        	RETL                @62        ;freq:2464 ;@0X3E
   298 00CB6 1C26 C        	RETL                @38        ;freq:2440 ;@0X26
   299 00CB7 1C08 C        	RETL                @8         ;freq:2410 ;@0X08
   300 00CB8 1C3B C        	RETL                @59        ;freq:2461 ;@0X3B
   301            C        
   302 00CB9 1C2D C        	RETL                @45        ;freq:2447 ;@0X2D
   303 00CBA 1C0C C        	RETL                @12        ;freq:2414 ;@0X0C
   304 00CBB 1C4C C        	RETL                @76        ;freq:2478 ;@0X4C
   305 00CBC 1C28 C        	RETL                @40        ;freq:2442 ;@0X28
   306            C        
   307            C        ;===========================================================
   308            C        ; RF Initialize SubRoutine
   309            C        ;===========================================================
   310 00CBD      C        EM198850_RESET:
   311 00CBD 0004 C        	WDTC
   312 00CBE 1E00 C        	BANK                0
   313 00CBF 08CA C        	BC                  RESET_N/16,RESET_N%16
   314 00CC0 180A C        	MOV                 A,@10                         ; wating 3ms
   315 00CC1 12E4 C        	CALL                DELAY_X100US
   316 00CC2 0ACA C        	BS                  RESET_N/16,RESET_N%16          ; RESET=1
   317 00CC3 1864 C        	MOV                 A,@100                          ; wating 10ms
   318 00CC4 12E4 C        	CALL                DELAY_X100US
   319 00CC5 0000 C        	NOP
   320            C        
   321 00CC6 095D C        	BC                  RFTestfailFlag/16,RFTestfailFlag%16
   322 00CC7 10D2 C        	CALL                INIT_FRAMEREG                  ; load	FRAMER TABLE send
   323 00CC8 1805 C        	MOV                 A,@5
   324 00CC9 12E4 C        	CALL                DELAY_X100US
   325 00CCA 10E5 C        	CALL                INIT_RSSI_CALIBRATION
   326 00CCB 0000 C        	NOP
   327 00CCC 12ED C        	CALL                TEST_INITIAL_RF
   328 00CCD 0D5D C        	JBC                 RFTestfailFlag/16,RFTestfailFlag%16
   329 00CCE 14BD C        	JMP                 EM198850_RESET
   330            C        
   331 00CCF 125A C        	CALL                Enter_StandbyII_Mode
   332 00CD0 0B9D C        	BS                  RFInitialOKflag/16,RFInitialOKflag%16
   333            C        
   334 00CD1 0012 C        	RET
   335            C        
   336            C        ;===============================================
   337 00CD2      C        INIT_FRAMEREG:
   338 00CD2 1E01 C        	BANK                1
   339 00CD3 00F4 C        	CLR                 TABLE_INDEX
   340 00CD4      C          Set_FrameReg:
   341 00CD4 0434 C        	MOV                 A,TABLE_INDEX
   342 00CD5 1000 C        	CALL                FRAME_TABLE
   343 00CD6 0070 C        	MOV                 ADDR,A
   344 00CD7 1BFF C        	XOR                 A,@0XFF
   345 00CD8 0C83 C        	JBC                 STATUS,Z
   346 00CD9 14E3 C        	JMP                 Set_Framereg_End
   347 00CDA 0574 C        	INC                 TABLE_INDEX
   348 00CDB 0434 C        	MOV                 A,TABLE_INDEX
   349 00CDC 1000 C        	CALL                FRAME_TABLE
   350 00CDD 0000 C        	NOP
   351 00CDE 0071 C        	MOV                 VALUE,A
   352 00CDF 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   353 00CE0 0000 C        	NOP
   354 00CE1 0574 C        	INC                 TABLE_INDEX
   355 00CE2 14D4 C        	JMP                 Set_FrameReg
   356 00CE3      C          Set_Framereg_End:
   357 00CE3 0000 C        	NOP
   358 00CE4 0012 C        	RET
   359            C        
   360            C        ;=================================================
   361 00CE5      C        INIT_RSSI_CALIBRATION:
   362 00CE5 1E01 C        	BANK                1
   363 00CE6 1805 C        	MOV                 A,@0X05
   364 00CE7 005A C        	MOV                 DataByteLength,A
   365 00CE8 00F5 C        	CLR                 RF_RSSI
   366 00CE9      C          Repeat_Read_RSSI:
   367 00CE9 184B C        	MOV                 A,@0X4B
   368 00CEA 0070 C        	MOV                 ADDR,A
   369 00CEB 1120 C        	CALL                READ_SPI_REG
   370 00CEC 0000 C        	NOP
   371 00CED 0435 C        	MOV                 A,RF_RSSI
   372 00CEE 0131 C        	SUB                 A,VALUE
   373 00CEF 0E03 C        	JBS                 STATUS,C
   374 00CF0 14F3 C        	JMP                 $+3
   375 00CF1 0431 C        	MOV                 A,VALUE
   376 00CF2 0075 C        	MOV                 RF_RSSI,A
   377 00CF3 05DA C        	DJZ                 DataByteLength
   378 00CF4 14E9 C        	JMP                 Repeat_Read_RSSI
   379            C        
   380 00CF5 1804 C        	MOV                 A,@0X04
   381 00CF6 0175 C        	SUB                 RF_RSSI,A
   382 00CF7 0435 C        	MOV                 A,RF_RSSI
   383 00CF8 0071 C        	MOV                 VALUE,A
   384 00CF9 184A C        	MOV                 A,@0X4A
   385 00CFA 0070 C        	MOV                 ADDR,A
   386 00CFB 1110 C        	CALL                WRITE_SPI_REG
   387 00CFC 0000 C        	NOP
   388 00CFD 1805 C        	MOV                 A,@0X05
   389 00CFE 0070 C        	MOV                 ADDR,A
   390 00CFF 1840 C        	MOV                 A,@0X40
   391 00D00 0071 C        	MOV                 VALUE,A
   392 00D01 1110 C        	CALL                WRITE_SPI_REG
   393 00D02 0000 C        	NOP
   394 00D03 1802 C        	MOV                 A,@0X02
   395 00D04 0070 C        	MOV                 ADDR,A
   396 00D05 1800 C        	MOV                 A,@0X00
   397 00D06 0071 C        	MOV                 VALUE,A
   398 00D07 1110 C        	CALL                WRITE_SPI_REG
   399 00D08 0000 C        	NOP
   400 00D09 180C C        	MOV                 A,@0X0C
   401 00D0A 0070 C        	MOV                 ADDR,A
   402 00D0B 18E0 C        	MOV                 A,@0XE0
   403 00D0C 0071 C        	MOV                 VALUE,A
   404 00D0D 1110 C        	CALL                WRITE_SPI_REG
   405 00D0E 0000 C        	NOP
   406 00D0F 0012 C        	RET
   407            C        
   408            C        ;===========================================================
   409            C        ; RF Initialize End
   410            C        ;===========================================================
   411            C        ;===============================================
   412            C        ; Function: Write SPI Register
   413            C        ; Input:    ADDR,VALUE
   414            C        ; Output:   None
   415            C        ;===============================================
   416 00D10      C        WRITE_SPI_REG:
   417 00D10 1E00 C        	BANK                0
   418 00D11 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;	/SS	=0
   419 00D12 1E01 C        	BANK                1
   420 00D13 0430 C        	MOV                 A,ADDR
   421 00D14 1134 C        	CALL                SIM_SPI_WRITE
   422 00D15 0431 C        	MOV                 A,VALUE
   423 00D16 1134 C        	CALL                SIM_SPI_WRITE
   424            C        
   425 00D17 1E02 C        	BANK                2
   426 00D18 098D C        	BC                  SPIC,SPIEB
   427 00D19 1E00 C        	BANK                0
   428 00D1A 098A C        	BC                  SPI_CLK/16,SPI_CLK%16
   429 00D1B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   430 00D1C 1E02 C        	BANK                2
   431 00D1D 0B8D C        	BS                  SPIC,SPIEB
   432 00D1E 1E01 C        	BANK                1
   433            C        
   434 00D1F 0012 C        	RET
   435            C        
   436            C        ;===============================================
   437            C        ; Function: Read SPI Register
   438            C        ; Input:   SPIWB
   439            C        ; Output:  SPIRB
   440            C        ;===============================================
   441 00D20      C        READ_SPI_REG:
   442 00D20 1E00 C        	BANK                0
   443 00D21 09CA C        	BC                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   444 00D22 1E01 C        	BANK                1
   445 00D23 0430 C        	MOV                 A,ADDR
   446 00D24 1980 C        	OR                  A,@0X80
   447 00D25 1134 C        	CALL                SIM_SPI_WRITE
   448 00D26 0000 C        	NOP
   449 00D27 113D C        	CALL                SIM_SPI_READ
   450 00D28 0071 C        	MOV                 VALUE,A
   451            C        
   452 00D29 1E02 C        	BANK                2
   453 00D2A 098D C        	BC                  SPIC,SPIEB
   454 00D2B 1E00 C        	BANK                0
   455 00D2C 098A C        	BC                  SPI_CLK/16,SPI_CLK%16
   456 00D2D 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;	/SS	=0
   457 00D2E 1E02 C        	BANK                2
   458 00D2F 0B8D C        	BS                  SPIC,SPIEB
   459 00D30 1E01 C        	BANK                1
   460            C        
   461 00D31 0000 C        	NOP
   462 00D32 0000 C        	NOP
   463 00D33 0012 C        	RET
   464            C        
   465            C        ;===============================================
   466            C        ; Function: Write SPI communication subroutine rising edge
   467            C        ; Input:    ACC
   468            C        ; Output:   None
   469            C        ;===============================================
   470 00D34      C        SIM_SPI_WRITE:
   471 00D34 1E02 C        	BANK                2
   472 00D35 00CC C        	CLR                 SPIS
   473 00D36 00CE C        	CLR                 SPIR
   474 00D37 004F C        	MOV                 SPIW,A         ; Write data to buffer
   475 00D38 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   476 00D39 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   477 00D3A 1539 C        	JMP                 $-1
   478 00D3B 1E01 C        	BANK                1
   479 00D3C 0012 C        	RET
   480            C        
   481            C        ;===============================================
   482            C        ; Function: Read SPI communication subroutine rising edge
   483            C        ; Input:    None
   484            C        ; Output:   SPI Data
   485            C        ;===============================================
   486 00D3D      C        SIM_SPI_READ:
   487 00D3D 1E02 C        	BANK                2
   488 00D3E 00CC C        	CLR                 SPIS
   489 00D3F 00CE C        	CLR                 SPIR
   490 00D40 00CF C        	CLR                 SPIW            ; Write data to buffer
   491 00D41 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   492 00D42 0000 C        	NOP
   493 00D43 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   494 00D44 1542 C        	JMP                 $-2
   495 00D45 040E C        	MOV                 A,SPIR
   496 00D46 1E01 C        	BANK                1
   497 00D47 0012 C           	RET
   498            C        
   499            C        ;==========================================================
   500            C        ; Read/Write subroutine
   501            C        ;==========================================================
   502 00D48      C        SIM_SPI_READ_WRITE:
   503 00D48 1E02 C        	BANK                2
   504 00D49 00CC C        	CLR                 SPIS
   505 00D4A 00CE C        	CLR                 SPIR
   506 00D4B 004F C        	MOV                 SPIW,A            ; Write data to buffer
   507 00D4C 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
   508 00D4D 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
   509 00D4E 154D C        	JMP                 $-1
   510 00D4F 040E C        	MOV                 A,SPIR
   511 00D50 1E01 C        	BANK                1
   512 00D51 0012 C           	RET
   513            C        
   514            C        
   515            C        ;===============================================
   516            C        ; Function: Read FIFO RAM
   517            C        ; Input:    None
   518            C        ; Output:   RX_BUF	,Receive_Error
   519            C        ;===============================================
   520 00D52      C        READ_FIFO_RAM:
   521 00D52 1E00 C        	BANK                0
   522 00D53 1860 C        	MOV                 A,@RX_BUF					;READ DATA START Address
   523 00D54 0044 C        	MOV                 RSR,A
   524 00D55 0000 C        	NOP
   525 00D56 0000 C        	NOP
   526 00D57 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;/SS=0
   527 00D58 18FF C        	MOV                 A,@0XFF						;0X7F||0X80 FIFO ADDRESS
   528 00D59 1134 C        	CALL                SIM_SPI_WRITE
   529 00D5A 0000 C        	NOP
   530 00D5B 0000 C        	NOP
   531 00D5C 1810 C        	MOV                 A,@PKT_LEN
   532 00D5D 005A C        	MOV                 DataByteLength,A
   533 00D5E      C          Read_FIFO_Loop:
   534 00D5E 113D C        	CALL                SIM_SPI_READ	 					;Packet & Device	ID
   535 00D5F 1E00 C        	BANK                0
   536 00D60 0040 C        	MOV                 R0, A
   537 00D61 0544 C        	INC                 RSR
   538 00D62 05DA C        	DJZ                 DataByteLength
   539 00D63 155E C        	JMP                 Read_FIFO_Loop
   540 00D64 0000 C        	NOP
   541 00D65 0BCA C        	BS                  SPI_SS/16,SPI_SS%16				;/SS=1
   542 00D66 1E01 C        	BANK                1
   543 00D67 0012 C        	RET
   544            C        
   545            C        
   546            C        ;===============================================
   547            C        ; Function: Write FIFO RAM
   548            C        ; Input:    None
   549            C        ; Output:   RX_Buf	,Receive_Error%16
   550            C        ;===============================================
   551 00D68      C        WRITE_FIFO_RAM:
   552 00D68 1E00 C        	BANK                0
   553 00D69 09CA C        	BC                  SPI_SS/16,SPI_SS%16				;/SS=1
   554 00D6A 187F C        	MOV                 A,@0X7F						;reg0X7F	SET
   555 00D6B 1134 C        	CALL                SIM_SPI_WRITE
   556 00D6C 1E00 C        	BANK                0
   557 00D6D 1810 C        	MOV                 A,@PKT_LEN
   558 00D6E 005A C        	MOV                 DataByteLength,A
   559 00D6F 1860 C        	MOV                 A,@TX_BUF					;Write DATA START Address
   560 00D70 0044 C        	MOV                 RSR, A
   561            C        
   562 00D71      C          Write_FIFO_Loop:
   563 00D71 0400 C        	MOV                 A,R0
   564 00D72 1134 C        	CALL                SIM_SPI_WRITE
   565 00D73 1E00 C        	BANK                0
   566 00D74 0544 C        	INC                 RSR
   567 00D75 05DA C        	DJZ                 DataByteLength
   568 00D76 1571 C        	JMP                 Write_FIFO_Loop
   569 00D77 0BCA C        	BS                  SPI_SS/16,SPI_SS%16				;/SS=1
   570 00D78 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16
   571 00D79 1578 C        	JMP                 $-1
   572 00D7A 1E01 C        	BANK                1
   573 00D7B 0012 C        	RET
   574            C        
   575            C        
   576            C        ;===============================================
   577            C        ; Function: Reset RF FIFO
   578            C        ; Input:    None
   579            C        ; Output:   None
   580            C        ;===============================================
   581 00D7C      C        RESET_RF_FIFO:
   582 00D7C 1E00 C        	BANK                0
   583 00D7D 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=0
   584 00D7E 1E01 C        	BANK                1
   585 00D7F 184D C        	MOV                 A,@0X4D
   586 00D80 0070 C        	MOV                 ADDR,A					;ADDR=0X4D
   587 00D81 1801 C        	MOV                 A,@0X01
   588 00D82 0071 C        	MOV                 VALUE,A
   589 00D83 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   590 00D84 1802 C        	MOV                 A,@0X02
   591 00D85 12E4 C        	CALL                DELAY_X100US
   592 00D86 0012 C        	RET
   593            C        
   594            C        
   595            C        ;***********************************************************
   596            C        ; Function: Enter TX Buffered ACK
   597            C        ; Input:    None
   598            C        ; Output:   None
   599            C        ;***********************************************************
   600 00D87      C        ENTER_TX_BUFFER_ACK:
   601 00D87 1E00 C        	BANK                0
   602 00D88 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   603 00D89 1E01 C        	BANK                1
   604 00D8A 1800 C        	MOV                 A,@0X00
   605 00D8B 0070 C        	MOV                 ADDR,A
   606 00D8C 18E5 C        	MOV                 A,@0XE5
   607 00D8D 0071 C        	MOV                 VALUE,A
   608 00D8E 1110 C        	CALL                WRITE_SPI_REG
   609 00D8F 1801 C        	MOV                 A,@0X01
   610 00D90 0070 C        	MOV                 ADDR,A
   611 00D91 1884 C        	MOV                 A,@0X84
   612 00D92 0071 C        	MOV                 VALUE,A
   613 00D93 1110 C        	CALL                WRITE_SPI_REG
   614 00D94 1841 C        	MOV                 A,@0X41
   615 00D95 0070 C        	MOV                 ADDR,A
   616 00D96 18BF C        	MOV                 A,@0XBF
   617 00D97 0071 C        	MOV                 VALUE,A
   618 00D98 1110 C        	CALL                WRITE_SPI_REG
   619 00D99 1840 C        	MOV                 A,@0X40
   620 00D9A 0070 C        	MOV                 ADDR,A
   621 00D9B 185E C        	MOV                 A,@0X5E
   622            C        	if                  USED_PID_FUNCTION
   623            C        		OR              A,@0X80
   624            C        	endif
   625 00D9C 0071 C        	MOV                 VALUE,A
   626 00D9D 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   627 00D9E 0012 C        	RET
   628            C        
   629            C        
   630            C        ;***********************************************************
   631            C        ; Function: Enter TX Buffered NACK
   632            C        ; Input:    None
   633            C        ; Output:   None
   634            C        ;***********************************************************
   635 00D9F      C        Enter_TX_Buffer_NACK:
   636 00D9F 1E00 C        	BANK                0
   637 00DA0 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   638 00DA1 1E01 C        	BANK                1
   639 00DA2 1800 C        	MOV                 A,@0X00
   640 00DA3 0070 C        	MOV                 ADDR,A
   641 00DA4 18E5 C        	MOV                 A,@0XE5
   642 00DA5 0071 C        	MOV                 VALUE,A
   643 00DA6 1110 C        	CALL                WRITE_SPI_REG
   644 00DA7 1801 C        	MOV                 A,@0X01
   645 00DA8 0070 C        	MOV                 ADDR,A
   646 00DA9 1884 C        	MOV                 A,@0X84
   647 00DAA 0071 C        	MOV                 VALUE,A
   648 00DAB 1110 C        	CALL                WRITE_SPI_REG
   649 00DAC 1841 C        	MOV                 A,@0X41
   650 00DAD 0070 C        	MOV                 ADDR,A
   651 00DAE 18BF C        	MOV                 A,@0XBF
   652 00DAF 0071 C        	MOV                 VALUE,A
   653 00DB0 1110 C        	CALL                WRITE_SPI_REG
   654 00DB1 1840 C        	MOV                 A,@0X40
   655 00DB2 0070 C        	MOV                 ADDR,A
   656 00DB3 1856 C        	MOV                 A,@0X56
   657            C        	if                  USED_PID_FUNCTION
   658            C        		OR              A,@0X80
   659            C        	endif
   660 00DB4 0071 C        	MOV                 VALUE,A
   661 00DB5 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   662 00DB6 0012 C        	RET
   663            C        
   664            C        
   665            C        ;***********************************************************
   666            C        ; Function: Enter TX Direct ACK
   667            C        ; Input:    None
   668            C        ; Output:   None
   669            C        ;***********************************************************
   670 00DB7      C        Enter_TX_Direct_ACK:
   671 00DB7 1E00 C        	BANK                0
   672 00DB8 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   673 00DB9 1E01 C        	BANK                1
   674 00DBA 1800 C        	MOV                 A,@0X00
   675 00DBB 0070 C        	MOV                 ADDR,A
   676 00DBC 1885 C        	MOV                 A,@0X85
   677 00DBD 0071 C        	MOV                 VALUE,A
   678 00DBE 1110 C        	CALL                WRITE_SPI_REG
   679 00DBF 1801 C        	MOV                 A,@0X01
   680 00DC0 0070 C        	MOV                 ADDR,A
   681 00DC1 1884 C        	MOV                 A,@0X84
   682 00DC2 0071 C        	MOV                 VALUE,A
   683 00DC3 1110 C        	CALL                WRITE_SPI_REG
   684 00DC4 1841 C        	MOV                 A,@0X41
   685 00DC5 0070 C        	MOV                 ADDR,A
   686 00DC6 18BF C        	MOV                 A,@0XBF
   687 00DC7 0071 C        	MOV                 VALUE,A
   688 00DC8 1110 C        	CALL                WRITE_SPI_REG
   689 00DC9 1840 C        	MOV                 A,@0X40
   690 00DCA 0070 C        	MOV                 ADDR,A
   691 00DCB 185E C        	MOV                 A,@0X5E
   692            C        	if                  USED_PID_FUNCTION
   693            C        		OR              A,@0X80
   694            C        	endif
   695 00DCC 0071 C        	MOV                 VALUE,A
   696 00DCD 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   697 00DCE 0012 C        	RET
   698            C        
   699            C        
   700            C        ;***********************************************************
   701            C        ; Function: Enter TX Direct NACK
   702            C        ; Input:    None
   703            C        ; Output:   None
   704            C        ;***********************************************************
   705 00DCF      C        Enter_TX_Direct_NACK:
   706 00DCF 1E00 C        	BANK                0
   707 00DD0 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   708 00DD1 1E01 C        	BANK                1
   709 00DD2 1800 C        	MOV                 A,@0X00
   710 00DD3 0070 C        	MOV                 ADDR,A
   711 00DD4 1885 C        	MOV                 A,@0X85
   712 00DD5 0071 C        	MOV                 VALUE,A
   713 00DD6 1110 C        	CALL                WRITE_SPI_REG
   714 00DD7 1801 C        	MOV                 A,@0X01
   715 00DD8 0070 C        	MOV                 ADDR,A
   716 00DD9 1884 C        	MOV                 A,@0X84
   717 00DDA 0071 C        	MOV                 VALUE,A
   718 00DDB 1110 C        	CALL                WRITE_SPI_REG
   719 00DDC 1841 C        	MOV                 A,@0X41
   720 00DDD 0070 C        	MOV                 ADDR,A
   721 00DDE 18BF C        	MOV                 A,@0XBF
   722 00DDF 0071 C        	MOV                 VALUE,A
   723 00DE0 1110 C        	CALL                WRITE_SPI_REG
   724 00DE1 1840 C        	MOV                 A,@0X40
   725 00DE2 0070 C        	MOV                 ADDR,A
   726 00DE3 1856 C        	MOV                 A,@0X56
   727            C        	if                  USED_PID_FUNCTION
   728            C        		OR              A,@0X80
   729            C        	endif
   730 00DE4 0071 C        	MOV                 VALUE,A
   731 00DE5 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   732 00DE6 0012 C        	RET
   733            C        
   734            C        
   735            C        ;***********************************************************
   736            C        ; Function: Enter RX Buffered ACK
   737            C        ; Input:    None
   738            C        ; Output:   None
   739            C        ;***********************************************************
   740 00DE7      C        Enter_RX_Buffer_ACK:
   741 00DE7 1E00 C        	BANK                0
   742 00DE8 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   743 00DE9 1E01 C        	BANK                1
   744 00DEA 1800 C        	MOV                 A,@0X00
   745 00DEB 0070 C        	MOV                 ADDR,A
   746 00DEC 18E5 C        	MOV                 A,@0XE5
   747 00DED 0071 C        	MOV                 VALUE,A
   748 00DEE 1110 C        	CALL                WRITE_SPI_REG
   749 00DEF 1801 C        	MOV                 A,@0X01
   750 00DF0 0070 C        	MOV                 ADDR,A
   751 00DF1 1884 C        	MOV                 A,@0X84
   752 00DF2 0071 C        	MOV                 VALUE,A
   753 00DF3 1110 C        	CALL                WRITE_SPI_REG
   754 00DF4 1841 C        	MOV                 A,@0X41
   755 00DF5 0070 C        	MOV                 ADDR,A
   756 00DF6 18BF C        	MOV                 A,@0XBF
   757 00DF7 0071 C        	MOV                 VALUE,A
   758 00DF8 1110 C        	CALL                WRITE_SPI_REG
   759 00DF9 1840 C        	MOV                 A,@0X40
   760 00DFA 0070 C        	MOV                 ADDR,A
   761 00DFB 185D C        	MOV                 A,@0X5D
   762            C        	if                  USED_PID_FUNCTION
   763            C        		OR              A,@0X80
   764            C        	endif
   765 00DFC 0071 C        	MOV                 VALUE,A
   766 00DFD 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   767 00DFE 0012 C        	RET
   768            C        
   769            C        
   770            C        ;**********************************************************
   771            C        ; Function: Enter RX Buffered NACK
   772            C        ; Input:    None
   773            C        ; Output:   None
   774            C        ;***********************************************************
   775 00DFF      C        Enter_RX_Buffer_NACK:
   776 00DFF 1E00 C        	BANK                0
   777 00E00 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   778 00E01 1E01 C        	BANK                1
   779 00E02 1800 C        	MOV                 A,@0X00
   780 00E03 0070 C        	MOV                 ADDR,A
   781 00E04 18E5 C        	MOV                 A,@0XE5
   782 00E05 0071 C        	MOV                 VALUE,A
   783 00E06 1110 C        	CALL                WRITE_SPI_REG
   784 00E07 1801 C        	MOV                 A,@0X01
   785 00E08 0070 C        	MOV                 ADDR,A
   786 00E09 1884 C        	MOV                 A,@0X84
   787 00E0A 0071 C        	MOV                 VALUE,A
   788 00E0B 1110 C        	CALL                WRITE_SPI_REG
   789 00E0C 1841 C        	MOV                 A,@0X41
   790 00E0D 0070 C        	MOV                 ADDR,A
   791 00E0E 18BF C        	MOV                 A,@0XBF
   792 00E0F 0071 C        	MOV                 VALUE,A
   793 00E10 1110 C        	CALL                WRITE_SPI_REG
   794 00E11 1840 C        	MOV                 A,@0X40
   795 00E12 0070 C        	MOV                 ADDR,A
   796 00E13 1855 C        	MOV                 A,@0X55
   797            C        	if                  USED_PID_FUNCTION
   798            C        		OR              A,@0X80
   799            C        	endif
   800 00E14 0071 C        	MOV                 VALUE,A
   801 00E15 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   802 00E16 0012 C        	RET
   803            C        
   804            C        
   805            C        ;***********************************************************
   806            C        ; Function: Enter RX Direct ACK
   807            C        ; Input:    None
   808            C        ; Output:   None
   809            C        ;***********************************************************
   810 00E17      C        Enter_RX_Direct_ACK:
   811 00E17 1E00 C        	BANK                0
   812 00E18 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   813 00E19 1E01 C        	BANK                1
   814 00E1A 1800 C        	MOV                 A,@0X00
   815 00E1B 0070 C        	MOV                 ADDR,A
   816 00E1C 1885 C        	MOV                 A,@0X85
   817 00E1D 0071 C        	MOV                 VALUE,A
   818 00E1E 1110 C        	CALL                WRITE_SPI_REG
   819 00E1F 1801 C        	MOV                 A,@0X01
   820 00E20 0070 C        	MOV                 ADDR,A
   821 00E21 1884 C        	MOV                 A,@0X84
   822 00E22 0071 C        	MOV                 VALUE,A
   823 00E23 1110 C        	CALL                WRITE_SPI_REG
   824 00E24 1841 C        	MOV                 A,@0X41
   825 00E25 0070 C        	MOV                 ADDR,A
   826 00E26 18BF C        	MOV                 A,@0XBF
   827 00E27 0071 C        	MOV                 VALUE,A
   828 00E28 1110 C        	CALL                WRITE_SPI_REG
   829 00E29 1840 C        	MOV                 A,@0X40
   830 00E2A 0070 C        	MOV                 ADDR,A
   831 00E2B 185D C        	MOV                 A,@0X5D
   832            C        	if                  USED_PID_FUNCTION
   833            C        		OR              A,@0X80
   834            C        	endif
   835 00E2C 0071 C        	MOV                 VALUE,A
   836 00E2D 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   837 00E2E 0012 C        	RET
   838            C        
   839            C        
   840            C        ;**********************************************************
   841            C        ; Function: Enter RX Direct NACK
   842            C        ; Input:    None
   843            C        ; Output:   None
   844            C        ;***********************************************************
   845 00E2F      C        Enter_RX_Direct_NACK:
   846 00E2F 1E00 C        	BANK                0
   847 00E30 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   848 00E31 1E01 C        	BANK                1
   849 00E32 1800 C        	MOV                 A,@0X00
   850 00E33 0070 C        	MOV                 ADDR,A
   851 00E34 1885 C        	MOV                 A,@0X85
   852 00E35 0071 C        	MOV                 VALUE,A
   853 00E36 1110 C        	CALL                WRITE_SPI_REG
   854 00E37 1801 C        	MOV                 A,@0X01
   855 00E38 0070 C        	MOV                 ADDR,A
   856 00E39 1884 C        	MOV                 A,@0X84
   857 00E3A 0071 C        	MOV                 VALUE,A
   858 00E3B 1110 C        	CALL                WRITE_SPI_REG
   859 00E3C 1841 C        	MOV                 A,@0X41
   860 00E3D 0070 C        	MOV                 ADDR,A
   861 00E3E 18BF C        	MOV                 A,@0XBF
   862 00E3F 0071 C        	MOV                 VALUE,A
   863 00E40 1110 C        	CALL                WRITE_SPI_REG
   864 00E41 1840 C        	MOV                 A,@0X40
   865 00E42 0070 C        	MOV                 ADDR,A
   866 00E43 1855 C        	MOV                 A,@0X55
   867            C        	if                  USED_PID_FUNCTION
   868            C        		OR              A,@0X80
   869            C        	endif
   870 00E44 0071 C        	MOV                 VALUE,A
   871 00E45 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   872 00E46 0012 C        	RET
   873            C        
   874            C        
   875            C        ;***********************************************************
   876            C        ; Function: Enter StandbyI Mode
   877            C        ; Input:    None
   878            C        ; Output:   None
   879            C        ; description:
   880            C        ;***********************************************************
   881 00E47      C        Enter_StandbyI_Mode:
   882 00E47 1E00 C        	BANK                0
   883 00E48 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   884 00E49 1E01 C        	BANK                1
   885 00E4A 1800 C        	MOV                 A,@0X00
   886 00E4B 0070 C        	MOV                 ADDR,A
   887 00E4C 1865 C        	MOV                 A,@0X65
   888 00E4D 0071 C        	MOV                 VALUE,A
   889 00E4E 1110 C        	CALL                WRITE_SPI_REG
   890 00E4F 1801 C        	MOV                 A,@0X01
   891 00E50 0070 C        	MOV                 ADDR,A
   892 00E51 188C C        	MOV                 A,@0X8C
   893 00E52 0071 C        	MOV                 VALUE,A
   894 00E53 1110 C        	CALL                WRITE_SPI_REG
   895 00E54 1840 C        	MOV                 A,@0X40
   896 00E55 0070 C        	MOV                 ADDR,A
   897 00E56 1850 C        	MOV                 A,@0X50
   898            C        	if                  USED_PID_FUNCTION
   899            C        		OR              A,@0X80
   900            C        	endif
   901 00E57 0071 C        	MOV                 VALUE,A
   902 00E58 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   903 00E59 0012 C        	RET
   904            C        
   905            C        
   906            C        ;***********************************************************
   907            C        ; Function: Enter StandbyII Mode
   908            C        ; Input:    None
   909            C        ; Output:   None
   910            C        ; description: auto enter
   911            C        ;***********************************************************
   912 00E5A      C        Enter_StandbyII_Mode:
   913 00E5A 1E00 C        	BANK                0
   914 00E5B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=0
   915 00E5C 1E01 C        	BANK                1
   916 00E5D 1800 C        	MOV                 A,@0X00
   917 00E5E 0070 C        	MOV                 ADDR,A
   918 00E5F 18E5 C        	MOV                 A,@0XE5
   919 00E60 0071 C        	MOV                 VALUE,A
   920 00E61 1110 C        	CALL                WRITE_SPI_REG
   921 00E62 1801 C        	MOV                 A,@0X01
   922 00E63 0070 C        	MOV                 ADDR,A
   923 00E64 1884 C        	MOV                 A,@0X84
   924 00E65 0071 C        	MOV                 VALUE,A
   925 00E66 1110 C        	CALL                WRITE_SPI_REG
   926 00E67 1841 C        	MOV                 A,@0X41
   927 00E68 0070 C        	MOV                 ADDR,A
   928 00E69 18BF C        	MOV                 A,@0XBF
   929 00E6A 0071 C        	MOV                 VALUE,A
   930 00E6B 1110 C        	CALL                WRITE_SPI_REG
   931 00E6C 1840 C        	MOV                 A,@0X40
   932 00E6D 0070 C        	MOV                 ADDR,A
   933 00E6E 1852 C        	MOV                 A,@0X52
   934            C        	if                  USED_PID_FUNCTION
   935            C        		OR              A,@0X80
   936            C        	endif
   937 00E6F 0071 C        	MOV                 VALUE,A
   938 00E70 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   939 00E71 0012 C        	RET
   940            C        
   941            C        
   942            C        ;===============================================
   943            C        ; Function: Enter Idle Mode
   944            C        ; Input:    None
   945            C        ; Output:   None
   946            C        ;===============================================
   947 00E72      C        ENTER_IDLE_MODE:
   948 00E72 1E00 C        	BANK                0
   949 00E73 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   950 00E74 1E01 C        	BANK                1
   951 00E75 1800 C        	MOV                 A,@0X00
   952 00E76 0070 C        	MOV                 ADDR,A
   953 00E77 18C0 C        	MOV                 A,@0XC0
   954 00E78 0071 C        	MOV                 VALUE,A
   955 00E79 1110 C        	CALL                WRITE_SPI_REG				;send SPI data to EM198810
   956 00E7A 1801 C        	MOV                 A,@0X01
   957 00E7B 0070 C        	MOV                 ADDR,A
   958 00E7C 188A C        	MOV                 A,@0X8A
   959 00E7D 0071 C        	MOV                 VALUE,A
   960 00E7E 1110 C        	CALL                WRITE_SPI_REG
   961 00E7F 1E00 C        	BANK                0
   962 00E80 08CA C        	BC                  RESET_N/16,RESET_N%16
   963 00E81 1E01 C        	BANK                1
   964 00E82 0012 C        	RET
   965            C        
   966            C        ;===============================================
   967            C        ; Function: EXIT Idle Mode
   968            C        ; Input:    None
   969            C        ; Output:   None
   970            C        ;===============================================
   971 00E83      C        EXIT_IDLE_MODE:
   972 00E83 1E00 C        	BANK                0
   973 00E84 0ACA C        	BS		            RESET_N/16,RESET_N%16
   974 00E85 1E01 C        	BANK                1
   975 00E86 1832 C        	MOV                 A,@50                          ; wating 10ms
   976 00E87 12E4 C        	CALL                DELAY_X100US	
   977 00E88 125A C        	CALL                Enter_StandbyII_Mode
   978 00E89 0012 C        	RET
   979            C        
   980            C        ;===============================================
   981            C        ; Function: RF Enter Sleep Mode
   982            C        ; Input:    ADDR,VALUE
   983            C        ; Output:   None
   984            C        ;===============================================
   985 00E8A      C        RF_SLEEP:
   986 00E8A 1E00 C        	BANK                0
   987 00E8B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
   988 00E8C 1E01 C        	BANK                1
   989 00E8D 1800 C        	MOV                 A,@0X00
   990 00E8E 0070 C        	MOV                 ADDR,A
   991 00E8F 18E5 C        	MOV                 A,@0XE5
   992 00E90 0071 C        	MOV                 VALUE,A
   993 00E91 1110 C        	CALL                WRITE_SPI_REG
   994 00E92 0000 C        	NOP
   995 00E93 1E00 C        	BANK                0
   996 00E94 08CA C        	BC                  RESET_N/16,RESET_N%16
   997 00E95 1E01 C        	BANK                1
   998 00E96 0012 C        	RET
   999            C        
  1000            C        
  1001            C        ;===============================================
  1002            C        ; Function: RF Wake Up
  1003            C        ; Input:    None
  1004            C        ; Output:   None
  1005            C        ;===============================================
  1006 00E97      C        RF_WAKEUP:
  1007 00E97 1E00 C        	BANK                0
  1008 00E98 0ACA C        	BS                  RESET_N/16,RESET_N%16
  1009 00E99 1819 C        	MOV                 A,@25
  1010 00E9A 12E4 C        	CALL                DELAY_X100US
  1011 00E9B 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1012 00E9C 1E01 C        	BANK                1
  1013 00E9D 1800 C        	MOV                 A,@0X00
  1014 00E9E 0070 C        	MOV                 ADDR,A
  1015 00E9F 18E5 C        	MOV                 A,@0XE5
  1016 00EA0 0071 C        	MOV                 VALUE,A
  1017 00EA1 1110 C        	CALL                WRITE_SPI_REG
  1018 00EA2 0012 C        	RET
  1019            C        
  1020            C        
  1021            C        ;===============================================
  1022            C        ; Function: RF Channel Frequency Set
  1023            C        ; Input:    TABLE_INDEX
  1024            C        ; Output:   None
  1025            C        ;===============================================
  1026 00EA3      C        RF_FREQ_SET:
  1027 00EA3 1E00 C        	BANK                0
  1028 00EA4 0BCA C        	BS                  SPI_SS/16,SPI_SS%16			;/SS=1
  1029 00EA5 1E01 C        	BANK                1
  1030 00EA6 1802 C        	MOV                 A,@0X02
  1031 00EA7 0070 C        	MOV                 ADDR,A
  1032 00EA8 0432 C        	MOV                 A,CH_NO
  1033 00EA9 10AC C        	CALL                CH_TABLE
  1034 00EAA 0071 C        	MOV                 VALUE,A
  1035 00EAB 1110 C        	CALL                WRITE_SPI_REG
  1036 00EAC 0000 C        	NOP
  1037 00EAD 0012 C        	RET
  1038            C        
  1039            C        
  1040            C        ;===============================================
  1041            C        ; Function: Read PKT Lost Count
  1042            C        ; Input:    None
  1043            C        ; Output:   PKT_Lost_Count
  1044            C        ;===============================================
  1045 00EAE      C        Read_PKT_LOST_CNT:
  1046 00EAE 184F C        	MOV                 A,@0X4F
  1047 00EAF 0070 C        	MOV                 ADDR,A
  1048 00EB0 1120 C        	CALL                READ_SPI_REG
  1049 00EB1 0012 C        	RET
  1050            C        
  1051            C        
  1052            C        ;===============================================
  1053            C        ; Function: Clr PKT Lost Count
  1054            C        ; Input:    Zero
  1055            C        ; Output:   None
  1056            C        ;===============================================
  1057 00EB2      C        CLR_PKT_LOST_CNT:
  1058 00EB2 184F C        	MOV                 A,@0X4F
  1059 00EB3 0070 C        	MOV                 ADDR,A
  1060 00EB4 1800 C        	MOV                 A,@0X00
  1061 00EB5 0071 C        	MOV                 VALUE,A
  1062 00EB6 1110 C        	CALL                WRITE_SPI_REG
  1063 00EB7 0012 C        	RET
  1064            C        
  1065            C        ;===============================================
  1066            C        ; Function: Address change function
  1067            C        ; Input:    RX_IDH,RX_IDL
  1068            C        ; Output:   None
  1069            C        ;===============================================
  1070 00EB8      C        CHANGE_ADDRESS_VALUE:
  1071 00EB8 1E01 C        	BANK                1
  1072 00EB9 1841 C        	MOV                 A,@0X41
  1073 00EBA 0070 C        	MOV                 ADDR,A
  1074 00EBB 18BF C        	MOV                 A,@0B10111111
  1075 00EBC 0071 C        	MOV                 VALUE,A
  1076 00EBD 1110 C        	CALL                WRITE_SPI_REG    ; Enalbe 6 TX
  1077            C        
  1078 00EBE 1851 C        	MOV                 A,@0X51
  1079 00EBF 0070 C        	MOV                 ADDR,A
  1080 00EC0 0421 C        	MOV                 A,RX_IDH
  1081 00EC1 0071 C        	MOV                 VALUE,A
  1082 00EC2 1110 C        	CALL                WRITE_SPI_REG
  1083            C        
  1084 00EC3 1853 C        	MOV                 A,@0X53
  1085 00EC4 0070 C        	MOV                 ADDR,A
  1086 00EC5 0421 C        	MOV                 A,RX_IDH
  1087 00EC6 0071 C        	MOV                 VALUE,A
  1088 00EC7 1110 C        	CALL                WRITE_SPI_REG
  1089            C        
  1090 00EC8 0422 C        	MOV                 A,RX_IDL
  1091 00EC9 1AF0 C        	AND                 A,@0B11110000
  1092 00ECA 0071 C        	MOV                 VALUE,A
  1093            C        
  1094 00ECB 1850 C        	MOV                 A,@0X50
  1095 00ECC 0070 C        	MOV                 ADDR,A
  1096 00ECD 0571 C        	INC                 VALUE         ; TX_ID1=(RX_IDL&0XF0)|0X01
  1097 00ECE 1110 C        	CALL                WRITE_SPI_REG
  1098            C        
  1099 00ECF 1852 C        	MOV                 A,@0X52
  1100 00ED0 0070 C        	MOV                 ADDR,A
  1101 00ED1 0571 C        	INC                 VALUE         ; TX_ID2=(RX_IDL&0XF0)|0X02
  1102 00ED2 1110 C        	CALL                WRITE_SPI_REG
  1103            C        
  1104 00ED3 1854 C        	MOV                 A,@0X54
  1105 00ED4 0070 C        	MOV                 ADDR,A
  1106 00ED5 0571 C        	INC                 VALUE         ; TX_ID3=(RX_IDL&0XF0)|0X03
  1107 00ED6 1110 C        	CALL                WRITE_SPI_REG
  1108            C        
  1109 00ED7 1855 C        	MOV                 A,@0X55
  1110 00ED8 0070 C        	MOV                 ADDR,A
  1111 00ED9 0571 C        	INC                 VALUE         ; TX_ID4=(RX_IDL&0XF0)|0X04
  1112 00EDA 1110 C        	CALL                WRITE_SPI_REG
  1113            C        
  1114 00EDB 1856 C        	MOV                 A,@0X56
  1115 00EDC 0070 C        	MOV                 ADDR,A
  1116 00EDD 0571 C        	INC                 VALUE         ; TX_ID5=(RX_IDL&0XF0)|0X05
  1117 00EDE 1110 C        	CALL                WRITE_SPI_REG
  1118            C        
  1119 00EDF 1857 C        	MOV                 A,@0X57
  1120 00EE0 0070 C        	MOV                 ADDR,A
  1121 00EE1 0571 C        	INC                 VALUE         ; TX_ID6=(RX_IDL&0XF0)|0X06
  1122 00EE2 1110 C        	CALL                WRITE_SPI_REG
  1123 00EE3 0012 C        	RET
  1124            C        
  1125            C        
  1126            C        ;===============================================
  1127            C        ; Function: Delay 100us
  1128            C        ; Input:    None
  1129            C        ; Output:   None
  1130            C        ;===============================================
  1131 00EE4      C        DELAY_X100US:
  1132 00EE4 0051 C        	MOV                 TEMP1,A
  1133 00EE5      C          Delay_Loop:
  1134 00EE5 1850 C        	MOV                 A,@0X50      ;
  1135 00EE6 0052 C        	MOV                 TEMP2,A
  1136 00EE7      C          Waiting:
  1137 00EE7 0000 C        	NOP
  1138 00EE8 05D2 C        	DJZ                 TEMP2
  1139 00EE9 16E7 C        	JMP                 Waiting
  1140 00EEA 05D1 C        	DJZ                 TEMP1
  1141 00EEB 16E5 C        	JMP                 Delay_Loop
  1142 00EEC 0012 C        	RET
  1143            C        
  1144            C        
  1145            C        ;===============================================
  1146            C        ;test RF Register, if read==write test pass
  1147            C        ;===============================================
  1148 00EED      C        TEST_INITIAL_RF:
  1149 00EED      C        Analog_Reg_Test:
  1150 00EED 1807 C        	MOV                 A,@0X07
  1151 00EEE 0070 C        	MOV                 ADDR,A
  1152 00EEF 1858 C        	MOV                 A,@0X58						;R7[6]=1
  1153 00EF0 0071 C        	MOV                 VALUE,A
  1154 00EF1 1110 C        	CALL                WRITE_SPI_REG
  1155 00EF2 0000 C        	NOP
  1156 00EF3 180E C        	MOV                 A,@0X0E
  1157 00EF4 0070 C        	MOV                 ADDR,A
  1158 00EF5 1811 C        	MOV                 A,@0X11						;RE[7]=0
  1159 00EF6 0071 C        	MOV                 VALUE,A
  1160 00EF7 1110 C        	CALL                WRITE_SPI_REG
  1161 00EF8 0000 C        	NOP
  1162 00EF9 182E C        	MOV                 A,@0X2E
  1163 00EFA 0070 C        	MOV                 ADDR,A
  1164 00EFB 1823 C        	MOV                 A,@0X23						;R2E[5]=1
  1165 00EFC 0071 C        	MOV                 VALUE,A
  1166 00EFD 1110 C        	CALL                WRITE_SPI_REG
  1167 00EFE 0000 C        	NOP
  1168 00EFF 180E C        	MOV                 A,@0X0E
  1169 00F00 0070 C        	MOV                 ADDR,A
  1170 00F01 1891 C        	MOV                 A,@0X91						;RE[7]=1
  1171 00F02 0071 C        	MOV                 VALUE,A
  1172 00F03 1110 C        	CALL                WRITE_SPI_REG
  1173 00F04 0000 C        	NOP
  1174 00F05 11E7 C        	CALL                Enter_RX_Buffer_ACK
  1175 00F06 0000 C        	NOP
  1176 00F07 1808 C        	MOV                 A,@8
  1177 00F08 12E4 C        	CALL                DELAY_X100US
  1178 00F09 0000 C        	NOP
  1179 00F0A 184B C        	MOV                 A,@0X4B
  1180 00F0B 0070 C        	MOV                 ADDR,A
  1181 00F0C 1120 C        	CALL                READ_SPI_REG
  1182 00F0D 0000 C        	NOP
  1183 00F0E 0C31 C        	JBC                 VALUE,0					;R4B[0]:LD=1,Analog Reg Initial is OK
  1184 00F0F 1712 C        	JMP                 Digit_Reg_Test
  1185 00F10 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1186 00F11 1727 C        	JMP                 RF_TEST_RET
  1187 00F12      C          Digit_Reg_Test:
  1188 00F12 00F4 C        	CLR                 TABLE_INDEX
  1189 00F13      C          Check_Digit_Reg:
  1190 00F13 0434 C        	MOV                 A,TABLE_INDEX
  1191 00F14 108C C        	CALL                RF_TABLE
  1192 00F15 0000 C        	NOP
  1193 00F16 0070 C        	MOV                 ADDR,A
  1194 00F17 1BFF C        	XOR                 A, @0XFF
  1195 00F18 0C83 C        	JBC                 STATUS,Z
  1196 00F19 1727 C        	JMP                 RF_TEST_RET
  1197 00F1A 1120 C        	CALL                READ_SPI_REG
  1198 00F1B 0000 C        	NOP
  1199 00F1C 0574 C        	INC                 TABLE_INDEX
  1200 00F1D 0434 C        	MOV                 A,TABLE_INDEX
  1201 00F1E 108C C        	CALL                RF_TABLE
  1202 00F1F 0000 C        	NOP
  1203 00F20 0331 C        	XOR                 A,VALUE
  1204 00F21 0C83 C        	JBC                 STATUS,Z
  1205 00F22 1725 C        	JMP                 RF_TABLE_INC
  1206 00F23 0B5D C        	BS                  RFTestfailFlag/16,RFTestfailFlag%16
  1207 00F24 1727 C        	JMP                 RF_TEST_RET
  1208 00F25      C          RF_TABLE_INC:
  1209 00F25 0574 C        	INC                 TABLE_INDEX
  1210 00F26 1713 C        	JMP                 Check_Digit_Reg
  1211 00F27      C          RF_TEST_RET:
  1212 00F27 0012 C        	RET
  1213            C        
    18                     include "P520SkipFreqFun.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78P520_32PIN44PIN_TX.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.1
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/4
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ifndef EM78CtrlIns.H
    12            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    13            C        endif
    14            C        
    15            C        ifndef keyscan.asm
    16            C        include "keyscan.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.1
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : eUIDE
    10            C        ; descripition  : FOR_EM78P520,
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        
    14            C        ;---------------------------------------------------
    15            C        keyscan.asm             EQU       keyscan.asm
    16            C        include "keyscan.H"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.1
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : eUIDE
    10            C        ; descripition  : FOR_EM78P520,
    11            C        ;=============================================================================
    12            C        
    13            C        
    14            C        keyscan.h           EQU        keyscan.h
    15            C        
    16            C        ;KeystokePort        EQU        0b00100000
    17       0032 C        LeakresisTimeCNT    EQU        50
    18            C        
    19            C        ;======================= key scan port define =========================
    20       0007 C        X_KeyLine           EQU        PORT7
    21       0074 C        X_LINE1             EQU        X_KeyLine*16+4		;R74
    22       0075 C        X_LINE2             EQU        X_KeyLine*16+5		;R73
    23       0076 C        X_LINE3             EQU        X_KeyLine*16+6		;R72
    24       0077 C        X_LINE4             EQU        X_KeyLine*16+7		;R71
    25            C        
    26       0009 C        X_Keyrow            EQU        PORT9
    27       0097 C        X_ROW1              EQU        X_Keyrow*16+7		;R97
    28       0096 C        X_ROW2              EQU        X_Keyrow*16+6		;R96
    29       0095 C        X_ROW3              EQU        X_Keyrow*16+5		;R95
    30       0094 C        X_ROW4              EQU        X_Keyrow*16+4		;R94
    31            C        
    32            C        ;------------------------ Define form SCH ---------------------------- 
    33       0005 C        _UP                 EQU        5    ;Port85
    34       0004 C        _RIGHT              EQU        4    ;Port84
    35       0002 C        _DOWN               EQU        2    ;Port82
    36       0001 C        _LEFT               EQU        1    ;Port81
    37            C        
    38       0007 C        _A                  EQU        7    ;Port97
    39       0006 C        _B                  EQU        6    ;Port96
    40       0005 C        _C                  EQU        5    ;Port95
    41       0004 C        _D                  EQU        4    ;Port94
    42            C        
    43       0007 C        _L1                 EQU        7    ;Port97
    44       0006 C        _R1                 EQU        6    ;Port96
    45       0005 C        _L2                 EQU        5    ;Port95
    46       0004 C        _R2                 EQU        4    ;Port94
    47            C        
    48       0007 C        _SELECT             EQU        7    ;Port97
    49       0006 C        _START              EQU        6    ;Port96
    50       0007 C        _LSW                EQU        7    ;Port97
    51       0004 C        _RSW                EQU        4    ;Port94
    52            C         
    53       0005 C        _MODE               EQU        5    ;Port95
    54       0004 C        _MACRO              EQU        4    ;Port94
    55       0006 C        _TEST1              EQU        6    ;Port96
    56       0005 C        _TEST2              EQU        5    ;Port95
    57            C        
    58            C        ;---------------------------------------------------------
    59            C        
    60       0000 C        A_1                 EQU        0    ;DataE
    61       0001 C        B_2                 EQU        1
    62       0002 C        C_3                 EQU        2
    63       0003 C        D_4                 EQU        3
    64       0004 C        L1_5                EQU        4
    65       0005 C        R1_6                EQU        5
    66       0006 C        L2_7                EQU        6
    67       0007 C        R2_8                EQU        7
    68            C        
    69       0000 C        SELECT_9            EQU        0    ;DataF
    70       0001 C        START_10            EQU        1
    71       0002 C        LSW_11              EQU        2
    72       0003 C        RSW_12              EQU        3
    73       0004 C        MODE_13             EQU        4
    74       0005 C        MACRO_14            EQU        5
    75       0006 C        TEST1_15            EQU        6
    76       0007 C        TEST2_16            EQU        7
    77            C        
    78            C        
    79            C        ;=============== Connect key scan ======================
    80       00B4 C        KeyPressTime        EQU        180
    81       003C C        KeyScanTime         EQU        60
    82       001E C        CrossingTime        EQU        30
    83            C        
    84            C        
    85            C        
    86            C        
    87            C        
    88            C        
    17            C        
    18            C        ifndef EM78CtrlIns.H
    19            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    20            C        endif
    21            C        ;----------------------------------------------------
    22            C        	ORG                 0x1100    ;PAGE 4
    23 01100      C        Key_Scan:
    24            C        ;=============================== I/O config ================================
    25 01100 1E05 C        	BANK                5
    26 01101 1837 C        	MOV                 A,@00110111B
    27 01102 004B C        	MOV                 PBPHCR,A	    	;PB0 PB1 PB2 PB4 PB5 ENABLE PULL HIGH
    28 01103 18F0 C         	MOV                 A,@11110000B
    29 01104 0049 C         	MOV                 P9PHCR,A		    ;SET PULL UP
    30            C         ;===========================================================================
    31            C         ;Setting LED Status
    32            C         ;===========================================================================
    33 01105 1E02 C        	BANK                2
    34 01106 0F25 C        	JBS                 DataF,MODE_13    ; 1:analog  0:digital(default 0),LED light
    35 01107 1509 C        	JMP                 SET_VR_STATUS_0
    36 01108 150D C        	JMP                 SET_VR_STATUS_1
    37 01109      C          SET_VR_STATUS_0:
    38 01109 0000 C        	NOP
    39 0110A 1E00 C        	BANK                0
    40 0110B 0848 C        	BC                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    41 0110C 1511 C        	JMP                 SET_VR_STATUS_END
    42 0110D      C          SET_VR_STATUS_1:
    43 0110D 0000 C        	NOP
    44 0110E 1E00 C        	BANK                0
    45 0110F 0A48 C        	BS                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    46 01110 1511 C        	JMP                 SET_VR_STATUS_END
    47 01111      C          SET_VR_STATUS_END:
    48 01111 1E02 C        	BANK                2
    49 01112 0000 C         	NOP
    50            C        
    51            C        ;================================================================================
    52            C        ;Keyscan Main
    53            C        ;================================================================================
    54 01113 116B C        	CALL                KeyPort_Check
    55 01114 0000 C        	NOP
    56            C        ;--------------------- Judge mode status ------------------------
    57 01115 0D39 C        	JBC                 ModeSelFlag/16,ModeSelFlag%16
    58 01116 151D C        	JMP                 MODE_NOCHANGE
    59 01117 0F3A C        	JBS                 ModeSelBakupFlag/16,ModeSelBakupFlag%16
    60 01118 151D C        	JMP                 MODE_NOCHANGE
    61 01119 0000 C        	NOP
    62            C      M 	COM                 DataF,MODE_13
       0111A 1810     1     MOV A,@( 16 )
       0111B 0365     1     XOR  DATAF ,A
    63 0111C 0000 C        	NOP
    64 0111D      C          MODE_NOCHANGE:
    65            C      M 	MOVB                KeyTempBakupFlag,MODE_13,KeyTempFlag,MODE_13
       0111D 0F39     1     JBS  KEYTEMPFLAG , MODE_13 
       0111E 093A     1     BC  KEYTEMPBAKUPFLAG , MODE_13 
       0111F 0D39     1     JBC  KEYTEMPFLAG , MODE_13 
       01120 0B3A     1     BS  KEYTEMPBAKUPFLAG , MODE_13 
    66 01121 0939 C        	BC                  ModeSelFlag/16,ModeSelFlag%16
    67            C        
    68            C        ;----------------deal with DataA/DataB/DataC/DataD/DataG-----------------
    69 01122 0000 C        	NOP
    70 01123 1235 C        	CALL                ADC_Rocker_KeyScan
    71 01124 0000 C        	NOP
    72            C        	;CALL                IO_Rocker_KeyScan
    73 01125 0000 C        	NOP
    74 01126 125F C        	CALL                Rocker_KeyScan
    75 01127 0000 C        	NOP
    76 01128 11A6 C        	CALL                Direction_KeyCheck
    77            C        
    78            C        ;-----------------------deal with DataE------------------------------------------
    79            C        ; bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0
    80            C        ; A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
    81            C        ;--------------------------------------------------------------------------------
    82 01129 00D0 C        	CLR                 TEMP
    83            C      M 	MOVB                TEMP,A_1,LINE2_KEY_INPUT_CACHE,_A
       0112A 0FFC     1     JBS  LINE2_KEY_INPUT_CACHE , _A 
       0112B 0810     1     BC  TEMP , A_1 
       0112C 0DFC     1     JBC  LINE2_KEY_INPUT_CACHE , _A 
       0112D 0A10     1     BS  TEMP , A_1 
    84            C      M 	MOVB                TEMP,B_2,LINE3_KEY_INPUT_CACHE,_B
       0112E 0FBD     1     JBS  LINE3_KEY_INPUT_CACHE , _B 
       0112F 0850     1     BC  TEMP , B_2 
       01130 0DBD     1     JBC  LINE3_KEY_INPUT_CACHE , _B 
       01131 0A50     1     BS  TEMP , B_2 
    85            C      M 	MOVB                TEMP,C_3,LINE4_KEY_INPUT_CACHE,_C
       01132 0F7E     1     JBS  LINE4_KEY_INPUT_CACHE , _C 
       01133 0890     1     BC  TEMP , C_3 
       01134 0D7E     1     JBC  LINE4_KEY_INPUT_CACHE , _C 
       01135 0A90     1     BS  TEMP , C_3 
    86            C      M 	MOVB                TEMP,D_4,LINE5_KEY_INPUT_CACHE,_D
       01136 0F3F     1     JBS  LINE5_KEY_INPUT_CACHE , _D 
       01137 08D0     1     BC  TEMP , D_4 
       01138 0D3F     1     JBC  LINE5_KEY_INPUT_CACHE , _D 
       01139 0AD0     1     BS  TEMP , D_4 
    87            C      M 	MOVB                TEMP,L1_5,LINE3_KEY_INPUT_CACHE,_L1
       0113A 0FFD     1     JBS  LINE3_KEY_INPUT_CACHE , _L1 
       0113B 0910     1     BC  TEMP , L1_5 
       0113C 0DFD     1     JBC  LINE3_KEY_INPUT_CACHE , _L1 
       0113D 0B10     1     BS  TEMP , L1_5 
    88            C      M 	MOVB                TEMP,R1_6,LINE4_KEY_INPUT_CACHE,_R1
       0113E 0FBE     1     JBS  LINE4_KEY_INPUT_CACHE , _R1 
       0113F 0950     1     BC  TEMP , R1_6 
       01140 0DBE     1     JBC  LINE4_KEY_INPUT_CACHE , _R1 
       01141 0B50     1     BS  TEMP , R1_6 
    89            C      M 	MOVB                TEMP,L2_7,LINE2_KEY_INPUT_CACHE,_L2
       01142 0F7C     1     JBS  LINE2_KEY_INPUT_CACHE , _L2 
       01143 0990     1     BC  TEMP , L2_7 
       01144 0D7C     1     JBC  LINE2_KEY_INPUT_CACHE , _L2 
       01145 0B90     1     BS  TEMP , L2_7 
    90            C      M 	MOVB                TEMP,R2_8,LINE3_KEY_INPUT_CACHE,_R2
       01146 0F3D     1     JBS  LINE3_KEY_INPUT_CACHE , _R2 
       01147 09D0     1     BC  TEMP , R2_8 
       01148 0D3D     1     JBC  LINE3_KEY_INPUT_CACHE , _R2 
       01149 0BD0     1     BS  TEMP , R2_8 
    91 0114A 0410 C        	MOV                 A,TEMP
    92 0114B 0264 C        	OR                  DataE,A
    93            C        
    94            C        ;-----------------------deal with DataF------------------------------------------
    95            C        ; bit0      bit1      bit2     bit3     bit4     bit5      bit6      bit7
    96            C        ; Select_9  Start_10  LSW_11   RSW_12   MODE_13  MACRO_14  TEST1_15  TEST2_16
    97            C        ;--------------------------------------------------------------------------------
    98            C        	;CLR                 DataF
    99            C      M 	MOVB                DataF,SELECT_9,LINE4_KEY_INPUT_CACHE,_Select
       0114C 0FFE     1     JBS  LINE4_KEY_INPUT_CACHE , _SELECT 
       0114D 0825     1     BC  DATAF , SELECT_9 
       0114E 0DFE     1     JBC  LINE4_KEY_INPUT_CACHE , _SELECT 
       0114F 0A25     1     BS  DATAF , SELECT_9 
   100            C      M 	MOVB                DataF,Start_10,LINE5_KEY_INPUT_CACHE,_Start
       01150 0FBF     1     JBS  LINE5_KEY_INPUT_CACHE , _START 
       01151 0865     1     BC  DATAF , START_10 
       01152 0DBF     1     JBC  LINE5_KEY_INPUT_CACHE , _START 
       01153 0A65     1     BS  DATAF , START_10 
   101            C      M 	MOVB                DataF,LSW_11,LINE5_KEY_INPUT_CACHE,_LSW
       01154 0FFF     1     JBS  LINE5_KEY_INPUT_CACHE , _LSW 
       01155 08A5     1     BC  DATAF , LSW_11 
       01156 0DFF     1     JBC  LINE5_KEY_INPUT_CACHE , _LSW 
       01157 0AA5     1     BS  DATAF , LSW_11 
   102            C      M 	MOVB                DataF,RSW_12,LINE2_KEY_INPUT_CACHE,_RSW
       01158 0F3C     1     JBS  LINE2_KEY_INPUT_CACHE , _RSW 
       01159 08E5     1     BC  DATAF , RSW_12 
       0115A 0D3C     1     JBC  LINE2_KEY_INPUT_CACHE , _RSW 
       0115B 0AE5     1     BS  DATAF , RSW_12 
   103            C        	;MOVB                DataF,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE
   104            C      M 	MOVB                DataF,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO
       0115C 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       0115D 0965     1     BC  DATAF , MACRO_14 
       0115E 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       0115F 0B65     1     BS  DATAF , MACRO_14 
   105            C      M 	MOVB                DataF,TEST1_15,LINE2_KEY_INPUT_CACHE,_TEST1
       01160 0FBC     1     JBS  LINE2_KEY_INPUT_CACHE , _TEST1 
       01161 09A5     1     BC  DATAF , TEST1_15 
       01162 0DBC     1     JBC  LINE2_KEY_INPUT_CACHE , _TEST1 
       01163 0BA5     1     BS  DATAF , TEST1_15 
   106            C      M 	MOVB                DataF,TEST2_16,LINE5_KEY_INPUT_CACHE,_TEST2
       01164 0F7F     1     JBS  LINE5_KEY_INPUT_CACHE , _TEST2 
       01165 09E5     1     BC  DATAF , TEST2_16 
       01166 0D7F     1     JBC  LINE5_KEY_INPUT_CACHE , _TEST2 
       01167 0BE5     1     BS  DATAF , TEST2_16 
   107            C        
   108 01168 0000 C        	NOP
   109 01169 0012 C        	RET
   110 0116A 0000 C        	NOP
   111            C        
   112            C        ;===========================================================================
   113            C        ;Scan data form keyboard port
   114            C        ;===========================================================================
   115 0116B      C        KeyPort_Check:
   116            C        ;LINE1:	read direct data from PortB to LINE1_KEY_INPUT
   117 0116B 1E00 C        	BANK                0
   118 0116C 040B C        	MOV                 A,PORTB		;PortB = 00110110
   119 0116D 1E02 C        	BANK                2
   120 0116E 007B C        	MOV                 LINE1_KEY_INPUT_CACHE,A
   121 0116F 04FB C        	COM                 LINE1_KEY_INPUT_CACHE
   122 01170 1836 C        	MOV                 A,@0B00110110
   123 01171 02FB C        	AND                 LINE1_KEY_INPUT_CACHE,A
   124            C        
   125            C        ;LINE2:	;SET P77=1 P76=1 P75=1 P74=0
   126 01172 1E00 C        	BANK                0
   127 01173 18E8 C        	MOV                 A,@11101000B
   128 01174 0047 C        	MOV                 PORT7,A
   129 01175 122C C        	CALL                KEY_DELAY
   130 01176 0409 C        	MOV                 A,PORT9
   131 01177 1E02 C        	BANK                2
   132 01178 007C C        	MOV                 LINE2_KEY_INPUT_CACHE,A
   133 01179 04FC C        	COM                 LINE2_KEY_INPUT_CACHE
   134 0117A 18F0 C        	MOV                 A,@0XF0
   135 0117B 02FC C        	AND                 LINE2_KEY_INPUT_CACHE,A
   136            C        
   137            C        ;LINE3:	;SET P77=1 P76=1 P75=0 P74=1
   138 0117C 1E00 C        	BANK                0
   139 0117D 18D8 C        	MOV                 A,@11011000B
   140 0117E 0047 C        	MOV                 PORT7,A
   141 0117F 122C C        	CALL                KEY_DELAY
   142 01180 0409 C        	MOV                 A,PORT9
   143 01181 1E02 C        	BANK                2
   144 01182 007D C        	MOV                 LINE3_KEY_INPUT_CACHE,A
   145 01183 04FD C        	COM                 LINE3_KEY_INPUT_CACHE
   146 01184 18F0 C        	MOV                 A,@0XF0
   147 01185 02FD C        	AND                 LINE3_KEY_INPUT_CACHE,A
   148            C        
   149            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   150 01186 1E00 C        	BANK                0
   151 01187 18B8 C        	MOV                 A,@10111000B
   152 01188 0047 C        	MOV                 PORT7,A
   153 01189 122C C        	CALL                KEY_DELAY
   154 0118A 0409 C        	MOV                 A,PORT9
   155 0118B 1E02 C        	BANK                2
   156 0118C 007E C        	MOV                 LINE4_KEY_INPUT_CACHE,A
   157 0118D 04FE C        	COM                 LINE4_KEY_INPUT_CACHE
   158 0118E 18F0 C        	MOV                 A,@0XF0
   159 0118F 02FE C        	AND                 LINE4_KEY_INPUT_CACHE,A
   160            C        
   161            C        ;LINE5:	;SET P77=0 P76=1 P75=1 P74=1
   162 01190 1E00 C        	BANK                0
   163 01191 1878 C        	MOV                 A,@01111000B
   164 01192 0047 C        	MOV                 PORT7,A
   165 01193 122C C        	CALL                KEY_DELAY
   166 01194 0409 C        	MOV                 A,PORT9
   167 01195 1E02 C        	BANK                2
   168 01196 007F C        	MOV                 LINE5_KEY_INPUT_CACHE,A
   169 01197 04FF C        	COM                 LINE5_KEY_INPUT_CACHE
   170 01198 18F0 C        	MOV                 A,@0XF0
   171 01199 02FF C        	AND                 LINE5_KEY_INPUT_CACHE,A
   172 0119A 0000 C        	NOP
   173            C        
   174            C        ;----------------------------------------------------------------
   175            C      M 	MOVB                KeyTempFlag,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE  ;save MODE FLAG
       0119B 0F7D     1     JBS  LINE3_KEY_INPUT_CACHE , _MODE 
       0119C 0939     1     BC  KEYTEMPFLAG , MODE_13 
       0119D 0D7D     1     JBC  LINE3_KEY_INPUT_CACHE , _MODE 
       0119E 0B39     1     BS  KEYTEMPFLAG , MODE_13 
   176            C      M 	MOVB                KeyTempFlag,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO ;save MACRO FLAG
       0119F 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       011A0 0979     1     BC  KEYTEMPFLAG , MACRO_14 
       011A1 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       011A2 0B79     1     BS  KEYTEMPFLAG , MACRO_14 
   177 011A3 0000 C        	NOP
   178 011A4 0012 C        	RET
   179 011A5 0000 C        	NOP
   180            C        
   181            C        ;==============================================================================
   182            C        ;=======================Direction key board scan===============================
   183            C        ;==============================================================================
   184            C        ;------------------------deal with DataA/DataB---------------------------------
   185            C        ;DataA	left-right: left=0x00, right=0xff, no-left-right=0x7f
   186            C        ;DataB	up-down:    down=0x00, up=0xff,    no-left-right=0x7f
   187            C        ;DataG  000:00 001:45 010:90 011:135 100:180 101:225 110:270 111:315
   188            C        ;------------------------------------------------------------------------------
   189 011A6      C        Direction_KeyCheck:
   190 011A6 0000 C        	NOP
   191 011A7 0F25 C        	JBS                 DataF,MODE_13
   192 011A8 15AA C        	JMP                 DealWith_Direction_Digital
   193 011A9 15E9 C        	JMP                 DealWith_HatSwitch_Analog
   194            C        
   195 011AA      C        DealWith_Direction_Digital:
   196 011AA      C        LEFT_RIGHT_KEY:
   197 011AA 0D3B C        	JBC                 LINE1_KEY_INPUT_CACHE,_RIGHT   ;judge right
   198 011AB 15AF C        	JMP                 JudgeRight
   199 011AC 0C7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_LEFT    ;judeg left
   200 011AD 15BA C        	JMP                 JudgeLeft
   201 011AE 15C4 C        	JMP                 Left_Right_Finsh
   202 011AF      C          JudgeRight:
   203 011AF 1800 C        	MOV                 A,@0X00
   204 011B0 0320 C        	XOR                 A,DataA
   205 011B1 0E83 C        	JBS                 STATUS,Z
   206 011B2 15B4 C        	JMP                 JudgeRight_1
   207 011B3 15B6 C        	JMP                 JudgeRight_2
   208 011B4      C          JudgeRight_1:
   209 011B4 18FF C        	MOV                 A,@0XFF
   210 011B5 15B8 C        	JMP                 JudgeRight_End
   211 011B6      C          JudgeRight_2:
   212 011B6 187F C        	MOV                 A,@0X7F
   213 011B7 15B8 C        	JMP                 JudgeRight_End
   214 011B8      C          JudgeRight_End:
   215 011B8 0060 C        	MOV                 DataA,A
   216 011B9 15C4 C        	JMP                 Left_Right_Finsh
   217            C        
   218 011BA      C          JudgeLeft:
   219 011BA 18FF C        	MOV                 A,@0XFF
   220 011BB 0320 C        	XOR                 A,DataA
   221 011BC 0E83 C        	JBS                 STATUS,Z
   222 011BD 15BF C        	JMP                 JudgeLeft_1  ;Z=0,sameness
   223 011BE 15C1 C        	JMP                 JudgeLeft_2  ;Z=1,reverse
   224 011BF      C          JudgeLeft_1:
   225 011BF 1800 C        	MOV                 A,@0X00
   226 011C0 15C3 C        	JMP                 JudgeLeft_End
   227 011C1      C          JudgeLeft_2:
   228 011C1 187F C        	MOV                 A,@0X7F
   229 011C2 15C3 C        	JMP                 JudgeLeft_End
   230 011C3      C          JudgeLeft_End:
   231 011C3 0060 C        	MOV                 DataA,A
   232 011C4      C          Left_Right_Finsh:
   233 011C4 0000 C        	NOP
   234            C        ;--------------------------------------------------------------
   235 011C5      C        UP_DOWN_KEY:
   236 011C5 0D7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_UP     ;judge up(0X00)
   237 011C6 15D5 C        	JMP                 JudgeDown
   238 011C7 0CBB C        	JBC                 LINE1_KEY_INPUT_CACHE,_DOWN   ;judeg down(0XFF)
   239 011C8 15CA C        	JMP                 JudgeUp
   240 011C9 15E0 C        	JMP                 UP_DOWN_Finsh
   241 011CA      C          JudgeUp:
   242 011CA 1800 C        	MOV                 A,@0X00
   243 011CB 0321 C        	XOR                 A,DataB
   244 011CC 0E83 C        	JBS                 STATUS,Z
   245 011CD 15CF C        	JMP                 JudgeUp_1
   246 011CE 15D1 C        	JMP                 JudgeUp_2
   247 011CF      C          JudgeUp_1:
   248 011CF 18FF C        	MOV                 A,@0XFF
   249 011D0 15D3 C        	JMP                 JudgeUp_End
   250 011D1      C          JudgeUp_2:
   251 011D1 187F C        	MOV                 A,@0X7F
   252 011D2 15D3 C        	JMP                 JudgeUp_End
   253 011D3      C          JudgeUp_End:
   254 011D3 0061 C        	MOV                 DataB,A
   255 011D4 15E0 C        	JMP                 UP_DOWN_Finsh
   256            C        
   257 011D5      C          JudgeDown:
   258 011D5 18FF C        	MOV                 A,@0XFF
   259 011D6 0321 C        	XOR                 A,DataB
   260 011D7 0E83 C        	JBS                 STATUS,Z
   261 011D8 15DA C        	JMP                 JudgeDown_1
   262 011D9 15DC C        	JMP                 JudgeDown_2
   263 011DA      C          JudgeDown_1:
   264 011DA 1800 C        	MOV                 A,@0X00
   265 011DB 15DE C        	JMP                 JudgeDown_End
   266 011DC      C          JudgeDown_2:
   267 011DC 187F C        	MOV                 A,@0X7F
   268 011DD 15DE C        	JMP                 JudgeDown_End
   269 011DE      C          JudgeDown_End:
   270 011DE 0061 C        	MOV                 DataB,A
   271 011DF 15E0 C        	JMP                 UP_DOWN_Finsh
   272 011E0      C          UP_DOWN_Finsh:
   273 011E0 0000 C        	NOP
   274 011E1 187F C        	MOV                 A,@0X7F
   275 011E2 0062 C        	MOV                 DataC,A
   276 011E3 0063 C        	MOV                 DataD,A
   277 011E4 180F C          	MOV                 A,@0X0F
   278 011E5 0066 C          	MOV                 DataG,A
   279 011E6 0000 C        	NOP
   280 011E7 0012 C        	RET
   281 011E8 0000 C        	NOP
   282            C        
   283            C        ;----------------------------------------------------
   284 011E9      C        DealWith_HatSwitch_Analog:
   285 011E9 00E4 C        	CLR                 DataE
   286 011EA 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   287 011EB 1B00 C        	XOR                 A,@0B00000000
   288 011EC 0E83 C        	JBS                 STATUS,Z
   289 011ED 15F1 C        	JMP                 DATAG_0
   290            C      M 	MOV                 DataG,@0X0F          ;none
       011EE 180F     1     MOV A,@( 15 )
       011EF 0066     1     MOV  DATAG ,A
   291 011F0 1629 C        	JMP                 HAT_SWITCH_END
   292 011F1      C          DataG_0:
   293 011F1 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   294 011F2 1B20 C        	XOR                 A,@0B00100000
   295 011F3 0E83 C        	JBS                 STATUS,Z
   296 011F4 15F8 C        	JMP                 DataG_45
   297            C      M 	MOV                 DataG,@0X00          ;0
       011F5 1800     1     MOV A,@( 0 )
       011F6 0066     1     MOV  DATAG ,A
   298 011F7 1629 C        	JMP                 HAT_SWITCH_END
   299 011F8      C          DataG_45:
   300 011F8 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   301 011F9 1B30 C        	XOR                 A,@0B00110000
   302 011FA 0E83 C        	JBS                 STATUS,Z
   303 011FB 15FF C        	JMP                 DataG_90
   304            C      M 	MOV                 DataG,@0X01          ;45
       011FC 1801     1     MOV A,@( 1 )
       011FD 0066     1     MOV  DATAG ,A
   305 011FE 1629 C        	JMP                 HAT_SWITCH_END
   306 011FF      C          DataG_90:
   307 011FF 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   308 01200 1B10 C        	XOR                 A,@0B00010000
   309 01201 0E83 C        	JBS                 STATUS,Z
   310 01202 1606 C        	JMP                 DataG_135
   311            C      M 	MOV                 DataG,@0X02          ;90
       01203 1802     1     MOV A,@( 2 )
       01204 0066     1     MOV  DATAG ,A
   312 01205 1629 C        	JMP                 HAT_SWITCH_END
   313 01206      C          DataG_135:
   314 01206 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   315 01207 1B14 C        	XOR                 A,@0B00010100
   316 01208 0E83 C        	JBS                 STATUS,Z
   317 01209 160D C        	JMP                 DataG_180
   318            C      M 	MOV                 DataG,@0X03          ;135
       0120A 1803     1     MOV A,@( 3 )
       0120B 0066     1     MOV  DATAG ,A
   319 0120C 1629 C        	JMP                 HAT_SWITCH_END
   320 0120D      C          DataG_180:
   321 0120D 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   322 0120E 1B04 C        	XOR                 A,@0B00000100
   323 0120F 0E83 C        	JBS                 STATUS,Z
   324 01210 1614 C        	JMP                 DataG_225
   325            C      M 	MOV                 DataG,@0X04          ;180
       01211 1804     1     MOV A,@( 4 )
       01212 0066     1     MOV  DATAG ,A
   326 01213 1629 C        	JMP                 HAT_SWITCH_END
   327 01214      C          DataG_225:
   328 01214 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   329 01215 1B06 C        	XOR                 A,@0B00000110
   330 01216 0E83 C        	JBS                 STATUS,Z
   331 01217 161B C        	JMP                 DataG_270
   332            C      M 	MOV                 DataG,@0X05          ;225
       01218 1805     1     MOV A,@( 5 )
       01219 0066     1     MOV  DATAG ,A
   333 0121A 1629 C        	JMP                 HAT_SWITCH_END
   334 0121B      C          DataG_270:
   335 0121B 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   336 0121C 1B02 C        	XOR                 A,@0B00000010
   337 0121D 0E83 C        	JBS                 STATUS,Z
   338 0121E 1622 C        	JMP                 DataG_315
   339            C      M 	MOV                 DataG,@0X06          ;270
       0121F 1806     1     MOV A,@( 6 )
       01220 0066     1     MOV  DATAG ,A
   340 01221 1629 C        	JMP                 HAT_SWITCH_END
   341 01222      C          DataG_315:
   342 01222 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   343 01223 1B22 C        	XOR                 A,@0B00100010
   344 01224 0E83 C        	JBS                 STATUS,Z
   345 01225 1629 C        	JMP                 HAT_SWITCH_END
   346            C      M 	MOV                 DataG,@0X07          ;315
       01226 1807     1     MOV A,@( 7 )
       01227 0066     1     MOV  DATAG ,A
   347 01228 1629 C        	JMP                 HAT_SWITCH_END
   348            C        
   349 01229      C          HAT_SWITCH_END:
   350 01229 0000 C        	NOP
   351 0122A 0012 C        	RET
   352 0122B 0000 C        	NOP
   353            C        
   354            C        ;===================================================================
   355            C        ; Delay function
   356            C        ;===================================================================
   357 0122C      C        KEY_DELAY:
   358 0122C 0000 C        	NOP
   359 0122D 0000 C        	NOP
   360 0122E 0000 C        	NOP
   361 0122F 0000 C        	NOP
   362 01230 0000 C        	NOP
   363 01231 0000 C        	NOP
   364 01232 0000 C        	NOP
   365 01233 0012 C        	RET
   366 01234 0000 C        	NOP
   367            C        
   368            C        
   369            C        ;============================================================================
   370            C        ;file name:     ADC 3D Rocker KeyScan
   371            C        ;INPUT PORT:
   372            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   373            C        ;TIME:          1050uS
   374            C        ;Descrition:    Use for check AD rocker data
   375            C        ;============================================================================
   376 01235      C        ADC_Rocker_KeyScan:
   377 01235 0000 C        	NOP
   378 01236 12E1 C        	CALL                 SUB_RINIT
   379 01237 12CF C        	CALL                 SUB_ADJ
   380 01238 1E03 C        	BANK                 3
   381 01239 1880 C        	MOV                  A,@0X80             ;SELECT ADE0/P93.Rx
   382 0123A 0249 C        	OR                   ADCR, A
   383 0123B 12EB C        	CALL                 SUB_ADC
   384 0123C 040C C        	MOV                  A, ADDH
   385 0123D 1E02 C        	BANK                 2
   386 0123E 0072 C        	MOV                  KEY_RIGHT_X,A
   387            C        
   388 0123F 12E1 C        	CALL                 SUB_RINIT
   389 01240 12CF C        	CALL                 SUB_ADJ
   390 01241 1E03 C        	BANK                 3
   391 01242 1881 C        	MOV                  A,@0X81             ;SELECT ADE1/P92.Ry
   392 01243 0249 C        	OR                   ADCR, A
   393 01244 12EB C        	CALL                 SUB_ADC
   394 01245 040C C        	MOV                  A, ADDH
   395 01246 1E02 C        	BANK                 2
   396 01247 0073 C        	MOV                  KEY_RIGHT_Y,A
   397 01248 04F3 C        	COM                  KEY_RIGHT_Y
   398            C        
   399 01249 12E1 C        	CALL                 SUB_RINIT
   400 0124A 12CF C        	CALL                 SUB_ADJ
   401 0124B 1E03 C        	BANK                 3
   402 0124C 1882 C        	MOV                  A,@0X82             ;SELECT ADE2/P91.Lx
   403 0124D 0249 C        	OR                   ADCR,A
   404 0124E 12EB C        	CALL                 SUB_ADC
   405 0124F 040C C        	MOV                  A,ADDH
   406 01250 1E02 C        	BANK                 2
   407 01251 0070 C        	MOV                  KEY_LEFT_X,A
   408            C        
   409 01252 12E1 C        	CALL                 SUB_RINIT
   410 01253 12CF C        	CALL                 SUB_ADJ
   411 01254 1E03 C        	BANK                 3
   412 01255 1883 C        	MOV                  A,@0X83             ;SELECT ADE3/P90.Ly
   413 01256 0249 C        	OR                   ADCR, A
   414 01257 12EB C        	CALL                 SUB_ADC
   415 01258 040C C        	MOV                  A,ADDH
   416 01259 1E02 C        	BANK                 2
   417 0125A 0071 C        	MOV                  KEY_LEFT_Y,A
   418 0125B 04F1 C        	COM                  KEY_LEFT_Y
   419 0125C 0000 C        	NOP
   420 0125D 0012 C        	RET
   421 0125E 0000 C        	NOP
   422            C        
   423 0125F      C        Rocker_KeyScan:
   424            C        ;======================== jugde rocker signal select ==========================
   425 0125F 0F25 C        	JBS                 DataF,MODE_13       ;select digital or analog
   426 01260 1662 C        	JMP                 DealWith_ADC_Digital
   427 01261 1678 C        	JMP                 DealWith_ADC_Analog
   428            C        
   429 01262      C          DealWith_ADC_Digital:
   430 01262 00E0 C        	CLR                 DataA
   431 01263 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   432 01264 0051 C        	MOV                 TEMP1,A
   433 01265 1284 C        	CALL                AreaJudge_direction
   434 01266 0060 C        	MOV                 DataA,A
   435            C        
   436 01267 00E1 C        	CLR                 DataB
   437 01268 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   438 01269 0051 C        	MOV                 TEMP1,A
   439 0126A 1284 C        	CALL                AreaJudge_direction
   440 0126B 0061 C        	MOV                 DataB,A
   441            C        
   442 0126C 187F C        	MOV                 A,@0X7F
   443 0126D 0062 C        	MOV                 DataC,A
   444 0126E 0063 C        	MOV                 DataD,A
   445            C        
   446 0126F 00E4 C        	CLR                 DataE
   447 01270 0432 C        	MOV                 A,KEY_RIGHT_X		;A,B,C,D,
   448 01271 0052 C        	MOV                 TEMP2,A
   449 01272 0433 C        	MOV                 A,KEY_RIGHT_Y
   450 01273 0053 C        	MOV                 TEMP3,A
   451 01274 1298 C        	CALL                AreaJudge_Button
   452 01275 0410 C        	MOV                 A,TEMP
   453 01276 0064 C        	MOV                 DataE,A
   454 01277 1681 C        	JMP                 RockerCheakFinish
   455            C        
   456 01278      C          DealWith_ADC_Analog:
   457 01278 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   458 01279 0060 C        	MOV                 DataA,A
   459 0127A 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   460 0127B 0061 C        	MOV                 DataB,A
   461 0127C 0432 C        	MOV                 A,KEY_RIGHT_X		;R-left_right
   462 0127D 0062 C        	MOV                 DataC,A
   463 0127E 0433 C        	MOV                 A,KEY_RIGHT_Y		;R-up_down
   464 0127F 0063 C        	MOV                 DataD,A
   465 01280 1681 C        	JMP                 RockerCheakFinish
   466            C        
   467 01281      C          RockerCheakFinish:
   468 01281 0000 C        	NOP
   469 01282 0012 C        	RET
   470 01283 0000 C        	NOP
   471            C        
   472            C        ;=============================jugde the direction=====================================
   473            C        ;Input:      TEMP1
   474            C        ;output:     A
   475            C        ;=====================================================================================
   476 01284      C        AreaJudge_direction:
   477 01284 1E02 C        	BANK                2
   478 01285 0411 C        	MOV                 A,TEMP1     ;Store
   479 01286 1DBF C        	SUB                 A,@0XBF
   480 01287 0E03 C        	JBS                 R3,0        ;R3,bit0(C)
   481 01288 168A C        	JMP                 CheakTop_Left
   482 01289 168C C        	JMP                 CheakMiddle_Left
   483 0128A      C          CheakTop_Left:
   484 0128A 18FF C        	MOV                 A,@0XFF   ;up
   485 0128B 1694 C        	JMP                 CheakAreaFinish_Left
   486 0128C      C          CheakMiddle_Left:
   487 0128C 0411 C        	MOV                 A,TEMP1
   488 0128D 1D40 C        	SUB                 A,@0X40
   489 0128E 0C03 C        	JBC                 R3,0
   490 0128F 1692 C        	JMP                 CheakBottom_Left
   491 01290 187F C        	MOV                 A,@0X7F
   492 01291 1694 C        	JMP                 CheakAreaFinish_Left
   493 01292      C          CheakBottom_Left:
   494 01292 1800 C        	MOV                 A,@0X00   ;down
   495 01293 1694 C        	JMP                 CheakAreaFinish_Left
   496 01294      C          CheakAreaFinish_Left:
   497 01294 0000 C        	NOP
   498 01295 0000 C        	NOP
   499 01296 0012 C        	RET
   500 01297 0000 C        	NOP
   501            C        
   502            C        ;============================jugde what button press============================
   503            C        ;input:     TEMP2,TEMP3
   504            C        ;output:    TEMP
   505            C        ;===============================================================================
   506 01298      C        AreaJudge_Button:
   507 01298 1E02 C        	BANK                2
   508 01299 0412 C        	MOV                 A,TEMP2    ;KEY_RIGHT_Y
   509 0129A 1DD0 C        	SUB                 A,@0XD0
   510 0129B 0E03 C        	JBS                 R3,C	     ;R3,bit0(C)
   511 0129C 169E C        	JMP                 CheakTop_Right_y
   512 0129D 16A0 C        	JMP                 CheakMiddle_Right_y
   513            C        
   514 0129E      C          CheakTop_Right_y:
   515 0129E 18FF C        	MOV                 A,@0XFF  ;up
   516 0129F 16A8 C        	JMP                 CheakAreaFinish_Right_y
   517 012A0      C          CheakMiddle_Right_y:
   518 012A0 0412 C        	MOV                 A,TEMP2
   519 012A1 1D25 C        	SUB                 A,@0X25
   520 012A2 0E03 C        	JBS                 R3,C
   521 012A3 16A6 C        	JMP                 CheakBottom_Right_y
   522 012A4 1800 C        	MOV                 A,@0X00  ;dwon
   523 012A5 16A8 C        	JMP                 CheakAreaFinish_Right_y
   524 012A6      C          CheakBottom_Right_y:
   525 012A6 187F C        	MOV                 A,@0X7F
   526 012A7 16A8 C        	JMP                 CheakAreaFinish_Right_y
   527 012A8      C          CheakAreaFinish_Right_y:
   528 012A8 0052 C        	MOV                 TEMP2,A
   529 012A9 0000 C        	NOP
   530            C        ;---------------------------------------------------
   531 012AA 1E02 C        	BANK                2
   532 012AB 0413 C        	MOV                 A,TEMP3    ;KEY_RIGHT_Y
   533 012AC 1DD0 C        	SUB                 A,@0XD0
   534 012AD 0E03 C        	JBS                 R3,C       ;R3,bit0(C)
   535 012AE 16B0 C        	JMP                 CheakTop_Right_x
   536 012AF 16B2 C        	JMP                 CheakMiddle_Right_x
   537 012B0      C          CheakTop_Right_x:
   538 012B0 18FF C        	MOV                 A,@0XFF   ;right
   539 012B1 16BA C        	JMP                 CheakAreaFinish_Right_x
   540 012B2      C          CheakMiddle_Right_x:
   541 012B2 0413 C        	MOV                 A,TEMP3
   542 012B3 1D25 C        	SUB                 A,@0X25
   543 012B4 0E03 C        	JBS                 R3,0
   544 012B5 16B8 C        	JMP                 CheakBottom_Right_x
   545 012B6 1800 C        	MOV                 A,@0X00   ;left
   546 012B7 16BA C        	JMP                 CheakAreaFinish_Right_x
   547 012B8      C          CheakBottom_Right_x:
   548 012B8 187F C        	MOV                 A,@0X7F
   549 012B9 16BA C        	JMP                 CheakAreaFinish_Right_x
   550 012BA      C          CheakAreaFinish_Right_x:
   551 012BA 0053 C        	MOV                 TEMP3,A
   552 012BB 0000 C        	NOP
   553            C        
   554            C        ;-----------------------------------------------------
   555 012BC 00D0 C        	CLR                 TEMP
   556 012BD 0412 C        	MOV                 A,TEMP2      ;left
   557 012BE 1B00 C        	XOR                 A,@0X00
   558 012BF 0C83 C        	JBC                 STATUS,Z
   559 012C0 0A10 C        	BS                  TEMP,A_1
   560            C        
   561 012C1 0412 C        	MOV                 A,TEMP2      ;right
   562 012C2 1BFF C        	XOR                 A,@0XFF
   563 012C3 0C83 C        	JBC                 STATUS,Z
   564 012C4 0A90 C        	BS                  TEMP,C_3
   565            C        
   566 012C5 0413 C        	MOV                 A,TEMP3      ;down
   567 012C6 1BFF C        	XOR                 A,@0XFF
   568 012C7 0C83 C        	JBC                 STATUS,Z
   569 012C8 0AD0 C        	BS                  TEMP,D_4
   570            C        
   571 012C9 0413 C        	MOV                 A,TEMP3      ;up
   572 012CA 1B00 C        	XOR                 A,@0X00
   573 012CB 0C83 C        	JBC                 STATUS,Z
   574 012CC 0A50 C        	BS                  TEMP,B_2
   575 012CD 0012 C        	RET
   576 012CE 0000 C        	NOP
   577            C        
   578            C        ;-----------------------------------------------------------------
   579 012CF      C        SUB_ADJ:
   580 012CF 1E03 C        	BANK                3
   581 012D0 0BCA C        	BS                  ADICH,CALI    ;ENABLE CALIBRATION
   582 012D1      C          ADCJUDGE_LOOP:
   583 012D1 0BC9 C        	BS                  ADCR,ADRUN
   584 012D2 0DC9 C        	JBC                 ADCR,ADRUN
   585 012D3 16D2 C        	JMP                 $-1
   586            C        
   587 012D4 040D C        	MOV                 A,ADDL
   588 012D5 1A0F C        	AND                 A,@0X0F
   589 012D6 0E83 C        	JBS                 R3,Z
   590 012D7 16DE C        	JMP                 ADCJUDGE_DONE
   591 012D8 040C C        	MOV                 A,ADDH
   592 012D9 0E83 C        	JBS                 R3,Z
   593 012DA 16DE C        	JMP                 ADCJUDGE_DONE
   594 012DB 1810 C        	MOV                 A,@0X10
   595 012DC 03CD C        	ADD                 ADDL,A
   596 012DD 16D1 C        	JMP                 ADCJUDGE_LOOP
   597 012DE      C          ADCJUDGE_DONE:
   598 012DE 09CA C        	BC                  ADICH,CALI
   599 012DF 1E00 C        	BANK                0
   600 012E0 0012 C        	RET
   601            C        
   602 012E1      C          SUB_RINIT:
   603 012E1 1E05 C         	BANK                5
   604 012E2 1800 C         	MOV                 A,@00000000B
   605 012E3 0049 C         	MOV                 P9PHCR,A      ;SET PULL LOW
   606 012E4 1E03 C        	BANK                3
   607 012E5 180F C        	MOV                 A,@0X0F
   608 012E6 004B C        	MOV                 ADICL,A      ;SELECT ADE0~ ADE3 AS ANALOG INPUT
   609 012E7 00CA C        	CLR                 ADICH         ;VREFS==VDD
   610 012E8 1860 C        	MOV                 A,@0X60
   611 012E9 0049 C        	MOV                 ADCR,A       ;SELECT  AD0,SELECT ADCKR1/ADCKR0=1:0,ADP=1
   612 012EA 0012 C        	RET
   613 012EB      C          SUB_ADC:
   614 012EB 1E03 C        	BANK                3
   615 012EC 0BC9 C        	BS                  ADCR,ADRUN
   616 012ED 0DC9 C        	JBC                 ADCR,ADRUN
   617 012EE 16ED C        	JMP                 $-1
   618 012EF 0000 C        	NOP
   619 012F0 0012 C        	RET
   620 012F1 0000 C        	NOP
   621            C        
   622            C        
   623            C        
   624            C        ;============================================================================
   625            C        ;file name:     IO 3D Rocker KeyScan
   626            C        ;INPUT PORT:
   627            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   628            C        ;TIME:
   629            C        ;Descrition:    Use for check AD rocker data
   630            C        ;============================================================================
   631 012F2      C        IO_Rocker_KeyScan:
   632 012F2 0000 C        	NOP
   633 012F3 0B49 C        	BS                  T2CR,T2EN          ; START
   634            C        	;CALL                Discharge
   635            C        	;CALL                SampingRefTiming
   636 012F4 1304 C        	CALL                Discharge
   637 012F5 1324 C        	CALL                SampingLyTiming    ; Ly
   638 012F6 0000 C        	NOP
   639 012F7 1304 C        	CALL                Discharge
   640 012F8 1338 C        	CALL                SampingLxTiming    ; Lx
   641 012F9 0000 C        	NOP
   642 012FA 1304 C        	CALL                Discharge
   643 012FB 134C C        	CALL                SampingRyTiming    ; Ry
   644 012FC 0000 C        	NOP
   645 012FD 1304 C        	CALL                Discharge
   646 012FE 1360 C        	CALL                SampingRxTiming    ; Rx
   647 012FF 0949 C        	BC                  T2CR,T2EN          ; Disable
   648 01300 0000 C        	NOP
   649 01301 0000 C        	NOP
   650 01302 0012 C        	RET
   651 01303 0000 C        	NOP
   652            C        
   653            C        ;---------------------------------------------------------------
   654 01304      C        Discharge:
   655 01304 1E04 C        	BANK                4
   656 01305 18FF C        	MOV                 A,@0B11111111
   657 01306 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   658            C        	;BS                  P8IOCR,Reference    ; Input  P87
   659            C        	;BC                  P8IOCR,Leakresis    ; Output P86
   660 01307 0408 C        	MOV                 A,P8IOCR
   661 01308 1A3F C        	AND                 A,@0B00111111
   662 01309 1980 C        	OR                  A,@0B10000000
   663 0130A 0048 C        	MOV                 P8IOCR,A            ;Set P87->Input,P86->Output
   664 0130B 1E00 C        	BANK                0
   665            C        	;BS                  PORT9,LeftYAxis
   666            C        	;BS                  PORT9,LeftXAxis
   667            C        	;BS                  PORT9,RightYAxis
   668            C        	;BS                  PORT9,RightXAxis
   669            C        	;BS                  PORT8,Reference    ; Set P87 Pull High
   670 0130C 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   671            C        
   672 0130D 1E02 C        	BANK                2
   673 0130E 00F4 C        	CLR                 IOcheckTimeCNT
   674 0130F 0434 C        	MOV                 A,IOcheckTimeCNT
   675 01310 1D32 C        	SUB                 A,@LeakresisTimeCNT
   676 01311 0C03 C        	JBC                 STATUS,C
   677 01312 170F C        	JMP                 $-3
   678 01313 0012 C        	RET
   679            C        
   680            C        ;---------------------------------------------------------------
   681 01314      C        SampingRefTiming:
   682 01314 1E04 C        	BANK                4
   683            C        	;MOV                 A,@0B11111111
   684            C        	;MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   685            C        	;BS                  P8IOCR,Leakresis    ; Input  P86
   686            C        	;BC                  P8IOCR,Reference    ; Output P87
   687 01315 0408 C        	MOV                 A,P8IOCR
   688 01316 1A3F C        	AND                 A,@0B00111111
   689 01317 1940 C        	OR                  A,@0B01000000
   690 01318 0048 C        	MOV                 P8IOCR,A             ;Set P87->Output,P86->Input
   691 01319 1E00 C        	BANK                0
   692            C        	;BS                  PORT9,LeftYAxis
   693            C        	;BS                  PORT9,LeftXAxis
   694            C        	;BS                  PORT9,RightYAxis
   695            C        	;BS                  PORT9,RightXAxis
   696 0131A 0BC8 C        	BS                  PORT8,Reference    ; Set P87 High
   697            C        	;BS                  PORT8,Leakresis    ; Set P86
   698            C        
   699 0131B 1E02 C        	BANK                2
   700 0131C 00F4 C        	CLR                 IOcheckTimeCNT
   701 0131D 1E00 C        	BANK                0
   702 0131E 0F88 C        	JBS                 PORT8,Leakresis
   703 0131F 171E C        	JMP                 $-1
   704 01320 1E02 C        	BANK                2
   705 01321 0434 C        	MOV                 A,IOcheckTimeCNT
   706 01322 0050 C        	MOV                 TEMP,A
   707 01323 0012 C        	RET
   708            C        
   709            C        ;---------------------------------------------------------------
   710 01324      C        SampingLyTiming:
   711 01324 1E04 C        	BANK                4
   712 01325 18FE C        	MOV                 A,@0B11111110
   713 01326 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   714            C        	;BS                  P8IOCR,Leakresis    ; input
   715            C        	;BS                  P8IOCR,Reference    ; output
   716 01327 0408 C        	MOV                 A,P8IOCR
   717 01328 1A3F C        	AND                 A,@0B00111111
   718 01329 19C0 C        	OR                  A,@0B11000000
   719 0132A 0048 C        	MOV                 P8IOCR,A
   720 0132B 1E00 C        	BANK                0
   721 0132C 0A09 C        	BS                  PORT9,LeftYAxis    ; Set P90
   722            C        	;BS                  PORT9,LeftXAxis
   723            C        	;BS                  PORT9,RightYAxis
   724            C        	;BS                  PORT9,RightXAxis
   725            C        	;BC                  PORT8,Reference    ; Set P87
   726            C        	;BS                  PORT8,Leakresis    ; Set P86
   727            C        
   728 0132D 1E02 C        	BANK                2
   729 0132E 00F4 C        	CLR                 IOcheckTimeCNT
   730 0132F 1E00 C        	BANK                0
   731 01330 0F88 C        	JBS                 PORT8,Leakresis
   732 01331 1730 C        	JMP                 $-1
   733 01332 1E02 C        	BANK                2
   734 01333 0434 C        	MOV                 A,IOcheckTimeCNT
   735 01334 0071 C        	MOV                 KEY_LEFT_Y,A        ; Left y Axis
   736 01335 0000 C        	NOP
   737 01336 0000 C        	NOP
   738 01337 0012 C        	RET
   739            C        
   740            C        ;---------------------------------------------------------------
   741 01338      C        SampingLxTiming:
   742 01338 1E04 C        	BANK                4
   743 01339 18FD C        	MOV                 A,@0B11111101
   744 0133A 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   745            C        	;BS                  P8IOCR,Leakresis    ; input
   746            C        	;BS                  P8IOCR,Reference    ; output
   747 0133B 0408 C        	MOV                 A,P8IOCR
   748 0133C 1A3F C        	AND                 A,@0B00111111
   749 0133D 19C0 C        	OR                  A,@0B11000000
   750 0133E 0048 C        	MOV                 P8IOCR,A
   751 0133F 1E00 C        	BANK                0
   752            C        	;BS                  PORT9,LeftYAxis
   753 01340 0A49 C        	BS                  PORT9,LeftXAxis    ; Set P91
   754            C        	;BS                  PORT9,RightYAxis
   755            C        	;BS                  PORT9,RightXAxis
   756            C        	;BC                  PORT8,Reference    ; Set P87
   757            C        	;BS                  PORT8,Leakresis    ; Set P86
   758            C        
   759 01341 1E02 C        	BANK                2
   760 01342 00F4 C        	CLR                 IOcheckTimeCNT
   761 01343 1E00 C        	BANK                0
   762 01344 0F88 C        	JBS                 PORT8,Leakresis
   763 01345 1744 C        	JMP                 $-1
   764 01346 1E02 C        	BANK                2
   765 01347 0434 C        	MOV                 A,IOcheckTimeCNT
   766 01348 0070 C        	MOV                 KEY_LEFT_X,A        ; Left x Axis
   767 01349 0000 C        	NOP
   768 0134A 0000 C        	NOP
   769 0134B 0012 C        	RET
   770            C        
   771            C        ;---------------------------------------------------------------
   772 0134C      C        SampingRyTiming:
   773 0134C 1E04 C        	BANK                4
   774 0134D 18FB C        	MOV                 A,@0B11111011
   775 0134E 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   776            C        	;BS                  P8IOCR,Leakresis    ; input
   777            C        	;BS                  P8IOCR,Reference    ; output
   778 0134F 0408 C        	MOV                 A,P8IOCR
   779 01350 1A3F C        	AND                 A,@0B00111111
   780 01351 19C0 C        	OR                  A,@0B11000000
   781 01352 0048 C        	MOV                 P8IOCR,A
   782 01353 1E00 C        	BANK                0
   783            C        	;BS                  PORT9,LeftYAxis
   784            C        	;BS                  PORT9,LeftXAxis
   785 01354 0A89 C        	BS                  PORT9,RightYAxis
   786            C        	;BS                  PORT9,RightXAxis
   787            C        	;BC                  PORT8,Reference    ; Set P87
   788            C        	;BS                  PORT8,Leakresis    ; Set P86
   789            C        
   790 01355 1E02 C        	BANK                2
   791 01356 00F4 C        	CLR                 IOcheckTimeCNT
   792 01357 1E00 C        	BANK                0
   793 01358 0F88 C        	JBS                 PORT8,Leakresis
   794 01359 1758 C        	JMP                 $-1
   795 0135A 1E02 C        	BANK                2
   796 0135B 0434 C        	MOV                 A,IOcheckTimeCNT
   797 0135C 0073 C        	MOV                 KEY_RIGHT_Y,A        ; right y Axis
   798 0135D 0000 C        	NOP
   799 0135E 0000 C        	NOP
   800 0135F 0012 C        	RET
   801            C        
   802            C        ;---------------------------------------------------------------
   803 01360      C        SampingRxTiming:
   804 01360 1E04 C        	BANK                4
   805 01361 18F7 C        	MOV                 A,@0B11110111
   806 01362 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   807            C        	;BS                  P8IOCR,Leakresis    ; input
   808            C        	;BS                  P8IOCR,Reference    ; output
   809 01363 0408 C        	MOV                 A,P8IOCR
   810 01364 1A3F C        	AND                 A,@0B00111111
   811 01365 19C0 C        	OR                  A,@0B11000000
   812 01366 0048 C        	MOV                 P8IOCR,A
   813 01367 1E00 C        	BANK                0
   814            C        	;BS                  PORT9,LeftYAxis
   815            C        	;BS                  PORT9,LeftXAxis
   816            C        	;BS                  PORT9,RightYAxis
   817 01368 0AC9 C        	BS                  PORT9,RightXAxis
   818            C        	;BC                  PORT8,Reference    ; Set P87
   819            C        	;BS                  PORT8,Leakresis    ; Set P86
   820            C        
   821 01369 1E02 C        	BANK                2
   822 0136A 00F4 C        	CLR                 IOcheckTimeCNT
   823 0136B 1E00 C        	BANK                0
   824 0136C 0F88 C        	JBS                 PORT8,Leakresis
   825 0136D 176C C        	JMP                 $-1
   826 0136E 1E02 C        	BANK                2
   827 0136F 0434 C        	MOV                 A,IOcheckTimeCNT
   828 01370 0072 C        	MOV                 KEY_RIGHT_X,A       ; right x Axis
   829 01371 0000 C        	NOP
   830 01372 0000 C        	NOP
   831 01373 0012 C        	RET
   832            C        
   833            C        
   834            C        ;**********************************************************************************
   835            C        ;*********************************************************************************
   836            C        ; Connect Key Scan
   837            C        ; Input:
   838            C        ; output: KEY_NUM
   839            C        ;         KeyScanStatusFlag
   840            C        ; change: temp,KeystokeFlag_Befor(INITIAL)
   841            C        ;*********************************************************************************
   842 01374      C        ConnectKey_Scan:
   843            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   844 01374 1E00 C        	BANK                0
   845 01375 18B8 C        	MOV                 A,@10111000B
   846 01376 0047 C        	MOV                 PORT7,A
   847 01377 122C C        	CALL                KEY_DELAY
   848 01378 0409 C        	MOV                 A,PORT9                ;(Slect,Start,MODE,MACRO(Connect),x,x,x,x)
   849 01379 1E02 C        	BANK                2
   850 0137A 1A10 C        	AND                 A,@00010000B           ;
   851 0137B 0050 C        	MOV                 TEMP,A
   852 0137C 1810 C        	MOV                 A,@00010000B           ; Bit4
   853 0137D 02F6 C        	AND                 KeystokeFlag_Befor,A
   854            C        
   855            C        
   856            C        ;---------------------------------------------------------------------
   857 0137E      C          Falling_Edge_Judge:
   858 0137E 0410 C        	MOV                 A,TEMP
   859 0137F 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
   860 01380 0C83 C        	JBC                 STATUS,Z
   861 01381 178C C        	JMP                 Rising_Edge_Judge         ; no edge occur
   862 01382 0410 C        	MOV                 A,TEMP                    ; Falling edge will change
   863 01383 1B00 C        	XOR                 A,@00000000B
   864 01384 0E83 C        	JBS                 STATUS,Z
   865 01385 178C C        	JMP                 Rising_Edge_Judge         ; no falling edge
   866 01386 0EDE C        	JBS                 KeyScanStatusFlag/16,KeyScanStatusFlag%16        ; scan the first falling edge
   867 01387 0A38 C        	BS                  KEY_NUM,0                            ; Will into key scan, Set leader bit
   868 01388 00F7 C        	CLR                 KeystokeTimeCNT                      ; press times ,recalculate
   869 01389 091E C        	BC                  KeyStatusFlag/16,KeyStatusFlag%16    ; key status, press(0) or release(1)
   870 0138A 0ADE C        	BS                  KeyScanStatusFlag/16,KeyScanStatusFlag%16	     ; into scan key status
   871 0138B 1798 C        	JMP                 Edge_Judge_End
   872            C        
   873            C        ;--------------------------------------------------------------------
   874 0138C      C          Rising_Edge_Judge:
   875 0138C 0410 C        	MOV                 A,TEMP
   876 0138D 0336 C        	XOR                 A,KeystokeFlag_Befor      ; bit 4, Check edge
   877 0138E 0C83 C        	JBC                 STATUS,Z
   878 0138F 1798 C        	JMP                 Edge_Judge_End
   879 01390 0410 C        	MOV                 A,TEMP                    ; rising edge will change
   880 01391 1B10 C        	XOR                 A,@00010000B
   881 01392 0E83 C        	JBS                 STATUS,Z
   882 01393 1798 C        	JMP                 Edge_Judge_End
   883 01394 0000 C        	NOP
   884 01395 13AA C        	CALL                KeyStatus_Low_Scan        ; rising edge ,check low level time
   885 01396 00F7 C        	CLR                 KeystokeTimeCNT           ; press times ,recalculate
   886 01397 0B1E C        	BS                  KeyStatusFlag/16,KeyStatusFlag%16
   887 01398      C          Edge_Judge_End:
   888 01398 0410 C        	MOV                 A,TEMP                    ; save currently press key status used for next judge
   889 01399 0076 C        	MOV                 KeystokeFlag_Befor,A
   890            C        
   891            C        ;------------------------------------------------------------------------------
   892 0139A      C          KeystokeScan_End:                                                ; a cycle scan end
   893 0139A 0EDE C        	JBS                 KeyScanStatusFlag/16,KeyScanStatusFlag%16
   894 0139B 00F8 C        	CLR                 KEY_NUM
   895 0139C 0DF8 C        	JBC                 KEY_NUM,7                                  ; Count overflow
   896 0139D 00F8 C        	CLR                 KEY_NUM
   897 0139E 09DE C        	BC                  System16msFlag/16,System16msFlag%16
   898            C        
   899 0139F 0437 C        	MOV                 A,KeystokeTimeCNT
   900 013A0 1DB4 C        	SUB                 A,@KeyPressTime                            ; KeyPressTime*16ms=3600ms(ComuTime=56ms)
   901 013A1 0C03 C        	JBC                 STATUS,C
   902 013A2 0577 C        	INC                 KeystokeTimeCNT                            ; press times ,recalculate
   903            C        
   904 013A3 0437 C        	MOV                 A,KeystokeTimeCNT
   905 013A4 1D3C C        	SUB                 A,@KeyScanTime                                      ; 60*16ms=960ms(ComuTime=56ms)
   906 013A5 0C03 C        	JBC                 STATUS,C                                   ; Scan finish edge
   907 013A6 0012 C        	RET
   908 013A7 08DE C        	BC                  KeyScanStatusFlag/16,KeyScanStatusFlag%16  ; more than 60*16ms=960ms ,EXIT scan status
   909 013A8 0B5E C        	BS                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
   910 013A9 0012 C        	RET
   911            C        
   912            C        ;=========================================================================
   913 013AA      C        KeyStatus_Low_Scan:     ; rising edge ,check low level time
   914 013AA 0437 C        	MOV                 A,KeystokeTimeCNT
   915 013AB 1D1E C        	SUB                 A,@CrossingTime                      ;30*16ms=400ms(ComuTime=56ms)
   916 013AC 0C03 C        	JBC                 STATUS,C                   ;
   917 013AD 17AF C        	JMP                 KeyScan_Short_Press	       ;less than 400ms
   918 013AE 17B2 C        	JMP                 KeyScan_Lasting_Press      ;more than 400ms
   919 013AF      C          KeyScan_Short_Press:
   920 013AF 0803 C        	BC                  STATUS,C
   921 013B0 06F8 C        	RLC                 KEY_NUM
   922 013B1 0012 C        	RET
   923 013B2      C          KeyScan_Lasting_Press:
   924 013B2 0A03 C        	BS                  STATUS,C
   925 013B3 06F8 C        	RLC                 KEY_NUM
   926 013B4 0012 C        	RET
   927            C        
   928            C        
    17            C        endif
    18            C        
    19            C        ;---------------------------------------------------------
    20            C        
    21            C        
    22            C        
    23            C        	ORG                 0X400    ; PAGE 1
    24            C        ;***************************************************************
    25            C        ; Search mode
    26            C        ;***************************************************************
    27 00400      C        Search_Equipment:
    28 00400 0004 C        	WDTC
    29 00401 1E00 C        	BANK                0
    30            C        	;MOV                 A,@0x07               ; N=250,P=256,f=8MHz ==> T=8ms
    31            C        	;MOV                 TWTCR,A
    32 00402 1806 C        	MOV                 A,@(256-250)           ; load initial value
    33 00403 0041 C        	MOV                 TCC,A
    34 00404 1EA0 C        	LCALL               Enter_StandbyII_Mode
    34 00405 0E5A C        	LCALL               Enter_StandbyII_Mode
    35 00406 1EA0 C        	LCALL               RESET_RF_FIFO
    35 00407 0D7C C        	LCALL               RESET_RF_FIFO
    36 00408 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
    36 00409 0DFF C        	LCALL               ENTER_RX_BUFFER_NACK
    37 0040A 0000 C        	NOP
    38            C        
    39 0040B      C        Detected_Connect_Key:
    40            C        ;--------------------------------------------------------
    41 0040B      C        SearchSleep_Status_Judge:
    42 0040B 0E5D C        	JBS                 IntoSleepFlag/16,IntoSleepFlag%16
    43 0040C 142C C        	JMP                 SearchSleep_Status_Judge_End
    44 0040D      C        Wakeup_status_judeg:
    45 0040D 0011 C        	DISI
    46 0040E 1EA0 C        	LCALL               RF_SLEEP
    46 0040F 0E8A C        	LCALL               RF_SLEEP
    47 00410 1EA0 C        	LCALL               MCU_EnterSleep_Set
    47 00411 02B0 C        	LCALL               MCU_EnterSleep_Set
    48 00412 1E00 C        	BANK                0
    49 00413 0848 C        	BC                  LED1_STATUS/16,LED1_STATUS%16
    50 00414 0010 C        	ENI
    51 00415 0000 C        	NOP
    52 00416 0003 C        	SLEP                                                 ; enter Sleep mode
    53 00417 0000 C        	NOP
    54 00418 1EA0 C        	LCALL               MCU_WakeUp_Set
    54 00419 02C2 C        	LCALL               MCU_WakeUp_Set
    55            C        ;-------------------- initial --------------------------------------
    56 0041A 1E00 C        	BANK                0
    57 0041B 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16      ; Disable 93C46
    58 0041C 0BCA C        	BS                  SPI_SS/16,SPI_SS%16              ; Disable EM198810
    59            C        ;-------------------------------------------------------------
    60            C        	;CALL                SearchLinkMode_Set
    61 0041D 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
    62 0041E 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
    63 0041F 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
    64 00420 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
    65 00421 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
    66 00422 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
    67            C        ;-------------------------------------------------------------
    68 00423 1EA0 C        	LCALL               EM198850_RESET
    68 00424 0CBD C        	LCALL               EM198850_RESET
    69 00425 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
    69 00426 0EB8 C        	LCALL               CHANGE_ADDRESS_VALUE
    70 00427 1EA0 C        	LCALL               RESET_RF_FIFO
    70 00428 0D7C C        	LCALL               RESET_RF_FIFO
    71 00429 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
    71 0042A 0DFF C        	LCALL               ENTER_RX_BUFFER_NACK
    72 0042B 0000 C        	NOP
    73 0042C      C        SearchSleep_Status_Judge_End:
    74 0042C 085D C        	BC                  IntoSleepFlag/16,IntoSleepFlag%16
    75            C        
    76            C        ;------------------------------------------------------------------
    77            C        	;BANK                0
    78            C        	;MOV                 A,@0x07                ; N=32,P=256,f=8MHz ==> T=1ms
    79            C        	;MOV                 TWTCR,A
    80 0042D 0DDE C        	JBC                 System16msFlag/16,System16msFlag%16
    81 0042E 1EA0 C        	LCALL               ConnectKey_Scan
    81 0042F 1374 C        	LCALL               ConnectKey_Scan
    82 00430 0F5E C        	JBS                 KeyScanFinishFlag/16,KeyScanFinishFlag%16
    83 00431 143F C        	JMP                 Keystoke_No_Press
    84            C        
    85 00432 0438 C        	MOV                 A,KEY_NUM
    86 00433 1B02 C        	XOR                 A,@00000010B
    87 00434 0C83 C        	JBC                 STATUS,Z
    88 00435 150B C        	JMP                 Click_Select                  ;Click Select
    89            C        
    90 00436 0438 C        	MOV                 A,KEY_NUM
    91 00437 1B03 C        	XOR                 A,@00000011B
    92 00438 0C83 C        	JBC                 STATUS,Z
    93 00439 1514 C        	JMP                 Lasting_Press_Select          ;Lasting_Press Select
    94            C        
    95 0043A 0438 C        	MOV                 A,KEY_NUM
    96 0043B 1B04 C        	XOR                 A,@00000100B
    97 0043C 0C83 C        	JBC                 STATUS,Z
    98 0043D 1518 C        	JMP                 Dblclick_Select               ;Dblclick Select
    99            C        
   100 0043E 095E C        	BC                  KeyScanFinishFlag/16,KeyScanFinishFlag%16
   101            C        ;-------------------------------------------------------------------------
   102 0043F      C        Keystoke_No_Press:
   103 0043F 1E00 C        	BANK                0
   104 00440      C        Waiting_For_SearchData_Arrive:
   105 00440 0417 C        	MOV                 A,ComuClock                  ; 8ms Interrupt ,8ms*112=896ms
   106 00441 1B70 C        	XOR                 A,@112
   107 00442 0C83 C        	JBC                 STATUS,Z
   108 00443 14E5 C        	JMP                 Search_Detect_Timeout        ; RX1  ; Timeout but have not received TX data
   109 00444 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	     ; 1:TX data receive finished  0:wating PKT pull high
   110 00445 140B C        	JMP                 Detected_Connect_Key
   111            C        ;-----------------------------------------------------------------------------------
   112 00446 0000 C        	NOP
   113            C        	;LCALL               LoseFrameLinkMode_Set
   114 00447 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   115 00448 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   116 00449 0A9F C        	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   117            C        
   118 0044A 1E00 C        	BANK                0
   119            C        	;MOV                 A,@0x07                      ; N=32,P=256,f=8MHz ==> T=1ms
   120            C        	;MOV                 TWTCR,A
   121 0044B 18E0 C        	MOV                 A,@(256-32)                 ; Rload TCC value
   122 0044C 0041 C        	MOV                 TCC,A
   123 0044D 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   124 0044E 0348 C        	XOR                 PORT8,A
   125            C        
   126 0044F 00D7 C        	CLR                 ComuClock
   127 00450 1EA0 C        	LCALL               Enter_StandbyII_Mode
   127 00451 0E5A C        	LCALL               Enter_StandbyII_Mode
   128 00452 0000 C        	NOP
   129 00453 0000 C        	NOP
   130            C        ;-----------------------------------------------------------------------------------
   131 00454 1EA0 C        	LCALL               READ_FIFO_RAM
   131 00455 0D52 C        	LCALL               READ_FIFO_RAM
   132 00456 0000 C        	NOP
   133 00457 0000 C        	NOP
   134 00458 0C9E C        	JBC                 ReadLengthError/16,ReadLengthError%16
   135 00459 14E5 C        	JMP                 Search_Detect_Timeout
   136 0045A 0D5F C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   137 0045B 14CE C        	JMP                 ForceLink_Mode_Task
   138 0045C 00D8 C        	CLR                 ComuCycleNum
   139 0045D 00D9 C        	CLR                 ComuEndNum
   140            C        
   141            C        ;------------------- check sync imformation ---------------------
   142 0045E 1E01 C        	BANK                1
   143 0045F 0421 C        	MOV                 A,RX_IDH
   144 00460 1E00 C        	BANK                0
   145 00461 0361 C        	XOR                 RX_IDH_Buffer,A
   146 00462 0E83 C        	JBS                 STATUS,Z
   147 00463 1400 C        	JMP                 Search_Equipment      ;RX_ID_ERROR
   148 00464 1E01 C        	BANK                1
   149 00465 0422 C        	MOV                 A,RX_IDL
   150 00466 1E00 C        	BANK                0
   151 00467 0362 C        	XOR                 RX_IDL_Buffer,A
   152 00468 0E83 C        	JBS                 STATUS,Z
   153 00469 1400 C        	JMP                 Search_Equipment      ;RX_ID_ERROR
   154            C        ;---------------------------------------------------------------------------
   155 0046A 00D2 C        	CLR                 TEMP2                 ;CHN_FLAG TEMP
   156 0046B 1E01 C        	BANK                1
   157 0046C 0426 C        	MOV                 A,TX_ID               ;
   158 0046D 1A0F C        	AND                 A,@0X0F
   159 0046E 0050 C        	MOV                 TEMP,A
   160            C        
   161 0046F 0A03 C        	BS                  STATUS,C
   162 00470 06D2 C        	RLC                 TEMP2
   163 00471 05D0 C        	DJZ                 TEMP
   164 00472 1470 C        	JMP                 $-2
   165 00473 0412 C        	MOV                 A,TEMP2
   166 00474 0063 C        	MOV                 CHN_FLAG,A            ;repeat used channel
   167 00475 1E00 C        	BANK                0
   168 00476 0063 C        	MOV                 CHN_FLAG_Buffer,A
   169            C        
   170            C        ;------------------------------------------------------------------
   171            C        	MESSAGE             "TX_ID = (RX_IDL&0XF0)|N (N=1,2,3,4...)"
***     USER MESSAGE: TX_ID = (RX_IDL&0XF0)|N (N=1,2,3,4...)
   172 00477      C        SearchComu_Cycle_work:
   173 00477 1E01 C        	BANK                1
   174 00478 00D8 C        	CLR                 ComuCycleNum
   175 00479 0426 C        	MOV                 A,TX_ID
   176 0047A 1A0F C        	AND                 A,@0X0F
   177 0047B 005B C        	MOV                 DataShiftCounter,A        ;decode ComuCycleNum by TX_ID
   178 0047C 01DB C        	DEC                 DataShiftCounter
   179 0047D 0C83 C        	JBC                 STATUS,Z
   180 0047E 1483 C        	JMP                 ComuCycleNum_End
   181 0047F      C        ComuCycleNum_Loop:
   182 0047F 1808 C        	MOV                 A,@ComuTime
   183 00480 03D8 C        	ADD                 ComuCycleNum,A
   184 00481 05DB C        	DJZ                 DataShiftCounter
   185 00482 147F C        	JMP                 ComuCycleNum_Loop
   186 00483      C        ComuCycleNum_End:
   187 00483 0000 C        	NOP
   188            C        
   189 00484 1E00 C        	BANK                0
   190 00485 0726 C        	SWAPA               N_CHN_Buffer          ;decode ComuEndNum  by N_CHN
   191 00486 1A0F C        	AND                 A,@0X0F
   192 00487 005B C        	MOV                 DataShiftCounter,A          ;End communicate cycle
   193 00488      C        ComuEndNum_Loop:
   194 00488 1808 C        	MOV                 A,@ComuTime
   195 00489 03D9 C        	ADD                 ComuEndNum,A
   196 0048A 05DB C        	DJZ                 DataShiftCounter
   197 0048B 1488 C        	JMP                 ComuEndNum_Loop
   198            C        
   199            C        ;-------------------------------------------------------------------------------
   200 0048C 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   201 0048D 0118 C        	SUB                 A,ComuCycleNum
   202 0048E 0C03 C        	JBC                 STATUS,C
   203 0048F 148C C        	JMP                 $-3
   204            C        ;-------------------------------------------------------------------------------
   205            C            ;MOV                 A,@16                 ; Transmitter data ,SYNC HEAD = 7 byte
   206            C            ;MOV                 Databytelength,A
   207 00490 0000 C        	NOP
   208 00491 1E01 C            BANK                1
   209 00492 0420 C            MOV                 A,PID_DATA
   210 00493 1E00 C            BANK                0
   211 00494 0060 C            MOV                 PID_DATA_Buffer,A
   212 00495 1E01 C            BANK                1
   213 00496 0421 C            MOV                 A,RX_IDH
   214 00497 1E00 C            BANK                0
   215 00498 0061 C            MOV                 RX_IDH_Buffer,A
   216 00499 1E01 C            BANK                1
   217 0049A 0422 C            MOV                 A,RX_IDL
   218 0049B 1E00 C            BANK                0
   219 0049C 0062 C            MOV                 RX_IDL_Buffer,A
   220 0049D 1E01 C            BANK                1
   221 0049E 0423 C            MOV                 A,CHN_FLAG
   222 0049F 1E00 C            BANK                0
   223 004A0 0063 C            MOV                 CHN_FLAG_Buffer,A
   224 004A1 041F C            MOV                 A,CommuStatusFlag
   225 004A2 0064 C            MOV                 CommuStatusFlag_Buffer,A
   226 004A3 1E01 C            BANK                1
   227 004A4 0425 C            MOV                 A,DirectionCtrl
   228 004A5 1E00 C            BANK                0
   229 004A6 0065 C            MOV                 DirectionCtrl_Buffer,A
   230 004A7 1E01 C            BANK                1
   231 004A8 0426 C            MOV                 A,TX_ID
   232 004A9 1E00 C            BANK                0
   233 004AA 0066 C            MOV                 TX_ID_Buffer,A
   234            C        
   235 004AB 1E00 C        	BANK                0
   236 004AC 187F C        	MOV                 A,@0X7F
   237 004AD 0067 C        	MOV                 DataA_Buffer,A
   238 004AE 0068 C        	MOV                 DataB_Buffer,A
   239 004AF 0069 C        	MOV                 DataC_Buffer,A
   240 004B0 006A C        	MOV                 DataD_Buffer,A
   241 004B1 00EB C        	CLR                 DataE_Buffer
   242 004B2 00EC C        	CLR                 DataF_Buffer
   243 004B3 180F C        	MOV                 A,@0X0F
   244 004B4 006D C        	MOV                 DataG_Buffer,A
   245            C        
   246 004B5 1EA0 C        	LCALL               RESET_RF_FIFO
   246 004B6 0D7C C        	LCALL               RESET_RF_FIFO
   247 004B7 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   247 004B8 0D87 C        	LCALL               Enter_TX_Buffer_ACK
   248 004B9 1EA0 C        	LCALL               WRITE_FIFO_RAM
   248 004BA 0D68 C        	LCALL               WRITE_FIFO_RAM
   249            C        
   250 004BB 1E01 C        	BANK                1
   251 004BC 0D5F C        	JBC                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   252 004BD 1525 C        	JMP                 Write_EEprom_Task
   253 004BE 00F3 C        	CLR                 LossframeCNT
   254            C        ;-------------------------------------------------------------------------------
   255            C        
   256 004BF 1EA0 C        	LCALL               Key_Scan
   256 004C0 1100 C        	LCALL               Key_Scan
   257            C        ;-------------------------------------------------
   258            C        	;LCALL               NormalLinkMode_Set
   259 004C1 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   260 004C2 0A5F C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   261 004C3 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   262 004C4 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   263 004C5 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   264 004C6 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   265            C        
   266            C        ;-------------------------------------------------------------------------------
   267 004C7 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   268 004C8 0319 C        	XOR                 A,ComuEndNum
   269 004C9 0E83 C        	JBS                 STATUS,Z
   270 004CA 14C7 C        	JMP                 $-3
   271            C        ;-------------------------------------------------------------------------------
   272 004CB 0000 C        	NOP
   273 004CC 0000 C        	NOP
   274 004CD 0012 C        	RET
   275            C        
   276            C        
   277 004CE      C        ForceLink_Mode_Task:
   278 004CE 1E00 C        	BANK                0
   279 004CF 00D1 C        	CLR                 TEMP1                 ;TEMP COUNTER
   280 004D0 0423 C        	MOV                 A,CHN_FLAG_Buffer     ;READ CHN_FLAG FROM BUFFER
   281 004D1 0050 C        	MOV                 TEMP,A
   282 004D2 0803 C        	BC                  STATUS,C
   283 004D3 0650 C        	RRC                 TEMP
   284 004D4 0551 C        	INC                 TEMP1
   285 004D5 0C03 C        	JBC                 STATUS,C               ;CHN_FLAG: 00,01,03,07,0F,1F,3F,7F
   286 004D6 14D3 C        	JMP                 $-3                    ;TX_ID   :  1  2  3  4  5  6  7  8
   287 004D7 0411 C        	MOV                 A,TEMP1
   288 004D8 1E01 C        	BANK                1
   289 004D9 0066 C        	MOV                 TX_ID,A
   290            C        
   291 004DA 1E00 C            BANK                0
   292 004DB 0421 C        	MOV                 A,RX_IDH_Buffer        ;RX_IDH
   293 004DC 1E01 C        	BANK                1
   294 004DD 0061 C        	MOV                 RX_IDH,A
   295 004DE 1E00 C        	BANK                0
   296 004DF 0422 C        	MOV                 A,RX_IDL_Buffer
   297 004E0 1E01 C        	BANK                1
   298 004E1 0062 C        	MOV                 RX_IDL,A
   299 004E2 1AF0 C        	AND                 A,@0XF0
   300 004E3 0266 C        	OR                  TX_ID,A                ; TX_ID = (RX_IDL & OXF0) | (TX_ID & 0X0F)
   301 004E4 1477 C        	JMP                 SearchComu_Cycle_work
   302            C        
   303 004E5      C        Search_Detect_Timeout:
   304            C        	;LCALL               SearchLinkMode_Set
   305 004E5 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   306 004E6 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   307 004E7 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   308            C        
   309 004E8 1E01 C        	BANK                1
   310 004E9 0432 C        	MOV                 A,CH_NO
   311 004EA 1D0F C        	SUB                 A,@15
   312 004EB 0E03 C        	JBS                 STATUS,C
   313 004EC 00F2 C        	CLR                 CH_NO
   314 004ED 00D7 C        	CLR                 ComuClock
   315 004EE 1EA0 C        	LCALL               RF_FREQ_SET
   315 004EF 0EA3 C        	LCALL               RF_FREQ_SET
   316 004F0 0572 C        	INC                 CH_NO
   317            C        	;BANK                0
   318            C        	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   319            C        	;XOR                 PORT8,A
   320 004F1 0000 C        	NOP
   321 004F2 1E00 C        	BANK                0
   322            C        
   323            C        ;---------------------------- LED CONTROL --------------------------------
   324 004F3 0F5F C        	JBS                 ForceLinkModeFlag/16,ForceLinkModeFlag%16
   325 004F4 14F6 C        	JMP                 LED_NormalSearch
   326 004F5 14F9 C        	JMP                 LED_ForcelinkSearch
   327 004F6      C        LED_NormalSearch:
   328 004F6 1802 C        	MOV                 A,@00000010B      ; P81 exchange when Timeout
   329 004F7 0348 C        	XOR                 PORT8,A
   330 004F8 14FA C        	JMP                 LED_End_Control
   331 004F9      C        LED_ForcelinkSearch:
   332 004F9 0A48 C        	BS                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
   333 004FA      C        LED_End_Control:
   334 004FA 0000 C        	NOP
   335            C        ;--------------------------------------------------------------------------
   336            C        
   337 004FB 089E C        	BC                  ReadLengthError/16,ReadLengthError%16
   338 004FC 00DA C        	CLR                 Databytelength
   339 004FD 00E1 C        	CLR                 RX_IDH_Buffer
   340 004FE 00E2 C        	CLR                 RX_IDL_Buffer
   341 004FF 00E3 C        	CLR                 CHN_FLAG_Buffer
   342 00500 00E6 C        	CLR                 N_CHN_Buffer
   343 00501 00E6 C        	CLR                 TX_ID_Buffer
   344 00502 1EA0 C        	LCALL               Enter_StandbyII_Mode
   344 00503 0E5A C        	LCALL               Enter_StandbyII_Mode
   345 00504 1EA0 C        	LCALL               RESET_RF_FIFO		         ; REGISTER=82  INITIAL=0X80 CLEAR TX POINT
   345 00505 0D7C C        	LCALL               RESET_RF_FIFO		         ; REGISTER=82  INITIAL=0X80 CLEAR TX POINT
   346 00506 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   346 00507 0DFF C        	LCALL               ENTER_RX_BUFFER_NACK
   347 00508 0000 C        	NOP
   348 00509 0000 C        	NOP
   349 0050A 140B C        	JMP                 Detected_Connect_Key
   350            C        
   351            C        
   352            C        
   353            C        
   354            C        ;**********************************************************************************
   355            C        ;*********************************************************************************
   356            C        ; FCC test mode frequency index
   357            C        ;*********************************************************************************
   358 0050B      C        Click_Select:
   359 0050B 0000 C        	NOP
   360 0050C 0F9F C        	JBS                 FccTestModeFlag/16,FccTestModeFlag%16
   361 0050D 143F C        	JMP                 Keystoke_No_Press
   362 0050E 0559 C        	INC                 FccFreqIndex
   363 0050F 0419 C        	MOV                 A,FccFreqIndex
   364 00510 1D0F C        	SUB                 A,@0X0F
   365 00511 0E03 C        	JBS                 STATUS,C
   366 00512 00D9 C        	CLR                 FccFreqIndex
   367 00513 143F C        	JMP                 Keystoke_No_Press
   368            C        
   369            C        
   370            C        
   371            C        ;**********************************************************************************
   372            C        ;*********************************************************************************
   373            C        ; Into FCC mode
   374            C        ;*********************************************************************************
   375 00514      C        Lasting_Press_Select:
   376 00514 0000 C        	NOP
   377            C        	;LCALL               FccSearchLinkMode_Set
   378            C        	;BC                  LinkModeFlag/16,LinkModeFlag%16
   379            C        	;BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   380 00515 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   381 00516 0000 C        	NOP
   382 00517 140B C        	JMP                 Detected_Connect_Key
   383            C        
   384            C        
   385            C        ;**********************************************************************************
   386            C        ;*********************************************************************************
   387            C        ; Into force link mode
   388            C        ;*********************************************************************************
   389 00518      C        Dblclick_Select:                                  ; Into Forcelink Mode:
   390 00518 0000 C        	NOP
   391 00519 1E01 C        	BANK                1
   392            C        	;LCALL               SearchForceLinkMode_Set
   393 0051A 091F C        	BC                  LinkModeFlag/16,LinkModeFlag%16
   394 0051B 0B5F C        	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   395 0051C 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   396            C        
   397 0051D 1897 C        	MOV                 A,@RX_IDH_DEFAULT         ; Address , default value 0X0DB3
   398 0051E 0061 C        	MOV                 RX_IDH,A
   399 0051F 183A C        	MOV                 A,@RX_IDL_DEFAULT
   400 00520 0062 C        	MOV                 RX_IDL,A
   401 00521 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   401 00522 0EB8 C        	LCALL               CHANGE_ADDRESS_VALUE
   402 00523 0000 C        	NOP
   403 00524 143F C        	JMP                 Keystoke_No_Press
   404            C        
   405            C        ;---------------------------------------------------------------
   406 00525      C        Write_EEprom_Task:
   407 00525 0011 C        	DISI
   408 00526 0000 C        	NOP
   409 00527 1E00 C        	BANK                0
   410 00528 0421 C        	MOV                 A,RX_IDH_Buffer         ; Read ID
   411 00529 1E01 C        	BANK                1
   412 0052A 0061 C        	MOV                 RX_IDH,A
   413 0052B 1E00 C        	BANK                0
   414 0052C 0422 C        	MOV                 A,RX_IDL_Buffer
   415 0052D 1E01 C        	BANK                1
   416 0052E 0062 C        	MOV                 RX_IDL,A
   417 0052F 1E00 C        	BANK                0
   418 00530 0426 C        	MOV                 A,TX_ID_Buffer
   419 00531 1E01 C        	BANK                1
   420 00532 0066 C        	MOV                 TX_ID,A
   421 00533 1E00 C        	BANK                0
   422 00534 0426 C        	MOV                 A,N_CHN_Buffer
   423 00535 1E01 C        	BANK                1
   424 00536 0066 C        	MOV                 N_CHN,A
   425 00537 0000 C        	NOP
   426            C        
   427 00538 1EA0 C        	LCALL               IO_93C46_INITIAL
   427 00539 101F C        	LCALL               IO_93C46_INITIAL
   428            C      M 	mEWEN                                      ; Enable
       0053A 1EA0     1     LCALL  START_BIT ,
       0053B 1000     1     LCALL  START_BIT ,
       0053C 1830     1     MOV A,@( EWEN )
       0053D 0051     1     MOV  R_ACC1 ,A
       0053E 1809     1     MOV A,@( 9 )
       0053F 1EA0     1     LCALL  RL_COMD ,
       00540 100E     1     LCALL  RL_COMD ,
       00541 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00542 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00543 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   429 00544 0000 C        	NOP
   430 00545 1800 C        	MOV                 A,@0X00
   431 00546 0055 C        	MOV                 DataAddressInEEPROM,A
   432 00547 1860 C        	MOV                 A,@0X60
   433 00548 0054 C        	MOV                 DataAddressInMCU,A
   434            C      M  	mWRITE              DataAddressInEEPROM,@0,DataAddressInMCU,@16
       00549 1E00     1     BANK @( 0 ),
       0054A 0414     1     MOV A, DATAADDRESSINMCU 
       0054B 0044     1     MOV  R4 ,A
       0054C 1810     1     MOV A,@( 16 )
       0054D 0053     1     MOV  R_ACC3 ,A
       0054E          1    ??002B$WRITE_DATA:   
       0054E 1EA0     1     LCALL  START_BIT ,
       0054F 1000     1     LCALL  START_BIT ,
       00550 0803     1     BC  STATUS , C 
       00551 0615     1     RRCA  DATAADDRESSINEEPROM ,
       00552 1940     1     OR A,@( WRITE )
       00553 0051     1     MOV  R_ACC1 ,A
       00554 1808     1     MOV A,@( 8 )
       00555 1EA0     1     LCALL  RL_COMD ,
       00556 100E     1     LCALL  RL_COMD ,
       00557 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00558 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       00559 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       0055A 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       0055B 0B4A     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       0055C 155D     1     JMP ( $ + 1 ),
       0055D 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0055E 0555     1     INC  DATAADDRESSINEEPROM ,
       0055F          1    ??002B$DATA_H_L:   
       0055F 0400     1     MOV A, R0 
       00560 0051     1     MOV  R_ACC1 ,A
       00561 0544     1     INC  R4 ,
       00562 1808     1     MOV A,@( 8 )
       00563 1EA0     1     LCALL  RL_COMD ,
       00564 100E     1     LCALL  RL_COMD ,
       00565 1566     1     JMP ( $ + 1 ),
       00566 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00567 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00568 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       00569 156A     1     JMP ( $ + 1 ),
       0056A 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0056B 0AC7     1     BS ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0056C 0F0A     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       0056D 156C     1     JMP ( $ - 1 ),
       0056E 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0056F 05D3     1     DJZ  R_ACC3 ,
       00570 154E     1     JMP  ??002B$WRITE_DATA ,
   435            C      M  	mEWDS                                      ; disable
       00571 1EA0     1     LCALL  START_BIT ,
       00572 1000     1     LCALL  START_BIT ,
       00573 1800     1     MOV A,@( EWDS )
       00574 0051     1     MOV  R_ACC1 ,A
       00575 1809     1     MOV A,@( 9 )
       00576 1EA0     1     LCALL  RL_COMD ,
       00577 100E     1     LCALL  RL_COMD ,
       00578 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00579 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0057A 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   436 0057B 1EA0 C         	LCALL               IO_93C46_QUIT
   436 0057C 102A C         	LCALL               IO_93C46_QUIT
   437 0057D 1E00 C         	BANK                0
   438            C        	;MOV                 A,@0x07
   439            C        	;MOV                 TWTCR,A
   440 0057E 1EA0 C        	LCALL               CHANGE_ADDRESS_VALUE
   440 0057F 0EB8 C        	LCALL               CHANGE_ADDRESS_VALUE
   441 00580 0000 C        	NOP
   442 00581 0010 C        	ENI
   443 00582 00D7 C        	CLR                 ComuClock
   444 00583 00D8 C        	CLR                 ComuCycleNum
   445 00584 00D9 C        	CLR                 ComuEndNum
   446 00585 00DF C        	CLR                 CommuStatusFlag
   447 00586 00DD C        	CLR                 GeneralStatusFlag1
   448 00587 00DE C        	CLR                 GeneralStatusFlag2
   449 00588 00E3 C        	CLR                 CHN_FLAG
   450            C        	;LCALL               SearchLinkMode_Set
   451 00589 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   452 0058A 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   453 0058B 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   454 0058C 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   455 0058D 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   456 0058E 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   457            C        
   458 0058F 1E00 C        	BANK                0
   459 00590 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16    ; Disable 93C46
   460 00591 0BCA C        	BS                  SPI_SS/16,SPI_SS%16            ; Disable EM198810
   461 00592 140B C        	JMP                 Detected_Connect_Key
   462            C        
   463            C        
   464            C        
   465            C        
   466            C        ;**********************************************************************************
   467            C        ;*************************************************************************
   468            C        ; Normal communicate
   469            C        ;*************************************************************************
   470            C        	ORG                 0X800   ; PAGE 2
   471 00800      C        Normal_Communicate:
   472 00800      C        Lossframe_Communicate:
   473 00800 0004 C        	WDTC
   474 00801 00D7 C        	CLR                 ComuClock
   475 00802 1E01 C        	BANK                1
   476 00803 0572 C        	INC                 CH_NO
   477 00804 0432 C        	MOV                 A,CH_NO
   478 00805 1D0F C        	SUB                 A,@15
   479 00806 0E03 C        	JBS                 STATUS,C
   480 00807 00F2 C        	CLR                 CH_NO
   481 00808 1EA0 C        	LCALL               Enter_StandbyII_Mode
   481 00809 0E5A C        	LCALL               Enter_StandbyII_Mode
   482 0080A 1EA0 C        	LCALL               RF_FREQ_SET
   482 0080B 0EA3 C        	LCALL               RF_FREQ_SET
   483 0080C 1EA0 C        	LCALL               RESET_RF_FIFO
   483 0080D 0D7C C        	LCALL               RESET_RF_FIFO
   484 0080E 1EA0 C        	LCALL               ENTER_RX_BUFFER_NACK
   484 0080F 0DFF C        	LCALL               ENTER_RX_BUFFER_NACK
   485 00810 1E00 C        	BANK                0
   486            C        
   487 00811      C        Waiting_For_NormalData_arrive:
   488 00811 0417 C        	MOV                 A,ComuClock                    ; "T=ComuTime" a cycle ,
   489 00812 1B08 C        	XOR                 A,@ComuTime                    ; CMD time, "T=ComuTime"
   490 00813 0C83 C        	JBC                 STATUS,Z                       ; Sync Timing no recive any data
   491 00814 14A3 C        	JMP                 LoseFrameStatus_Timeout        ; RX1  ; Timeout but have not received TX data
   492 00815 0E0B C        	JBS                 PKT_FLAG/16,PKT_FLAG%16	       ; 1:TX data receive finished  0:wating PKT pull high
   493 00816 1411 C        	JMP                 Waiting_For_NormalData_arrive
   494            C        ;-----------------------------------------------------------------------------------
   495 00817 1E00 C        	BANK                0
   496            C        	;MOV                 A,@0x07                ; N=32,P=256,f=8MHz ==> T=1ms
   497            C        	;MOV                 TWTCR,A
   498 00818 18E0 C        	MOV                 A,@(256-32)           ;Rload TCC value
   499 00819 0041 C        	MOV                 TCC,A                  ;adjust time by PKT sync
   500 0081A 00D7 C        	CLR                 ComuClock
   501 0081B 1820 C        	MOV                 A,@0X20               ; (test)P85 exchange when intrrupt
   502 0081C 0348 C        	XOR                 PORT8,A
   503            C        
   504 0081D 1EA0 C        	LCALL               READ_FIFO_RAM
   504 0081E 0D52 C        	LCALL               READ_FIFO_RAM
   505 0081F 1EA0 C        	LCALL               Enter_StandbyII_Mode
   505 00820 0E5A C        	LCALL               Enter_StandbyII_Mode
   506 00821 0C9E C        	JBC                 ReadLengthError/16,ReadLengthError%16
   507 00822 14A3 C        	JMP                 LoseFrameStatus_Timeout
   508            C        
   509            C        ;------------------- check sync imformation ---------------------
   510 00823 1E01 C        	BANK                1
   511 00824 0421 C        	MOV                 A,RX_IDH
   512 00825 1E00 C        	BANK                0
   513 00826 0361 C        	XOR                 RX_IDH_Buffer,A
   514 00827 0E83 C        	JBS                 STATUS,Z
   515 00828 14A3 C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   516 00829 1E01 C        	BANK                1
   517 0082A 0422 C        	MOV                 A,RX_IDL
   518 0082B 1E00 C        	BANK                0
   519 0082C 0362 C        	XOR                 RX_IDL_Buffer,A
   520 0082D 0E83 C        	JBS                 STATUS,Z
   521 0082E 14A3 C        	JMP                 LoseFrameStatus_Timeout         ;host computer ID error
   522            C        ;------------------------------------------------------------------
   523 0082F 1E01 C        	BANK                1
   524            C        	;LCALL               NormalLinkMode_Set
   525 00830 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   526 00831 0A5F C        	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   527 00832 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   528 00833 0B1F C        	BS                  LinkModeFlag/16,LinkModeFlag%16
   529 00834 095F C        	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   530 00835 099F C        	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   531 00836 00F3 C        	CLR                 LossframeCNT
   532            C        
   533 00837 0619 C        	RRCA                ComuEndNum
   534 00838 0050 C        	MOV                 TEMP,A
   535 00839 0418 C        	MOV                 A,ComuCycleNum
   536 0083A 0110 C        	SUB                 A,TEMP
   537 0083B 0E03 C        	JBS                 STATUS,C
   538 0083C 10C6 C        	CALL               Sampling_Task
   539            C        ;-------------------------------------------------------------------------------
   540 0083D 0417 C        	MOV                 A,ComuClock           ; wait the communicate time arrive
   541 0083E 0118 C        	SUB                 A,ComuCycleNum
   542 0083F 0C03 C        	JBC                 STATUS,C
   543 00840 143D C        	JMP                 $-3
   544            C        ;-------------------------------------------------------------------------------
   545 00841 0619 C        	RRCA                ComuEndNum
   546 00842 0050 C        	MOV                 TEMP,A
   547 00843 0418 C        	MOV                 A,ComuCycleNum
   548 00844 0110 C        	SUB                 A,TEMP
   549 00845 0C03 C        	JBC                 STATUS,C
   550 00846 10C6 C        	CALL               Sampling_Task
   551            C        
   552            C        ;------------------ sleep status judge --------------------------
   553 00847      C        NormalSleep_Status_Judge:
   554 00847 1E02 C        	BANK                2
   555 00848 0420 C        	MOV                 A,DataA
   556 00849 1B7F C        	XOR                 A,@0X7F
   557 0084A 0E83 C        	JBS                 STATUS,Z
   558 0084B 1460 C        	JMP                 NormalSleep_Status_Judge_End1
   559 0084C 0421 C        	MOV                 A,DataB
   560 0084D 1B7F C        	XOR                 A,@0X7F
   561 0084E 0E83 C        	JBS                 STATUS,Z
   562 0084F 1460 C        	JMP                 NormalSleep_Status_Judge_End1
   563            C        	;MOV                 A,DataC
   564            C        	;XOR                 A,@0X7F
   565            C        	;JBS                 STATUS,Z
   566            C        	;JMP                 NormalSleep_Status_Judge_End1
   567            C        	;MOV                 A,DataD
   568            C        	;XOR                 A,@0X7F
   569            C        	;JBS                 STATUS,Z
   570            C        	;JMP                 NormalSleep_Status_Judge_End1
   571 00850 0424 C        	MOV                 A,DataE
   572 00851 1B00 C        	XOR                 A,@0X00
   573 00852 0E83 C        	JBS                 STATUS,Z
   574 00853 1460 C        	JMP                 NormalSleep_Status_Judge_End1
   575            C        	;MOV                 A,DataF
   576            C        	;XOR                 A,@0X7F
   577            C        	;JBS                 STATUS,Z
   578            C        	;JMP                 NormalSleep_Status_Judge_End1
   579 00854 0426 C        	MOV                 A,DataG
   580 00855 1B0F C        	XOR                 A,@0X0F
   581 00856 0E83 C        	JBS                 STATUS,Z
   582 00857 1460 C        	JMP                 NormalSleep_Status_Judge_End1
   583            C        
   584 00858 0E5D C        	JBS                 IntoSleepFlag/16,IntoSleepFlag%16
   585 00859 1461 C        	JMP                 NormalSleep_Status_Judge_End2
   586            C        	;LCALL               SearchLinkMode_Set
   587 0085A 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   588 0085B 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   589 0085C 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   590 0085D 00D7 C        	CLR                 ComuClock
   591 0085E 00F2 C        	CLR                 CH_NO
   592 0085F 0012 C        	RET
   593 00860      C        NormalSleep_Status_Judge_End1:
   594 00860 00DC C        	CLR                 SleepCNT
   595 00861      C        NormalSleep_Status_Judge_End2:
   596 00861 0000 C        	NOP
   597            C        
   598            C        ;===================================================================
   599 00862 180E C            MOV                 A,@14                         ;Transmitter data ,7 byte
   600 00863 005A C            MOV                 Databytelength,A
   601 00864 1E01 C            BANK                1
   602 00865 0421 C            MOV                 A,RX_IDH                     ;sync header
   603 00866 1E00 C            BANK                0
   604 00867 0061 C            MOV                 RX_IDH_Buffer,A
   605 00868 1E01 C            BANK                1
   606 00869 0422 C            MOV                 A,RX_IDL
   607 0086A 1E00 C            BANK                0
   608 0086B 0062 C            MOV                 RX_IDL_Buffer,A
   609 0086C 1E01 C            BANK                1
   610 0086D 0423 C            MOV                 A,CHN_FLAG
   611 0086E 1E00 C            BANK                0
   612 0086F 0063 C            MOV                 CHN_FLAG_Buffer,A
   613            C        
   614 00870 041F C            MOV                 A,CommuStatusFlag
   615 00871 0064 C            MOV                 CommuStatusFlag_Buffer,A
   616            C        
   617 00872 1E01 C            BANK                1
   618 00873 0425 C            MOV                 A,DirectionCtrl
   619 00874 1E00 C            BANK                0
   620 00875 0065 C            MOV                 DirectionCtrl_Buffer,A
   621            C        
   622 00876 1E01 C            BANK                1
   623 00877 0426 C            MOV                 A,TX_ID
   624 00878 1E00 C            BANK                0
   625 00879 0066 C            MOV                 TX_ID_Buffer,A
   626 0087A 1E02 C            BANK                2                            ;Data output
   627 0087B 0420 C            MOV                 A,DataA
   628 0087C 1E00 C            BANK                0
   629 0087D 0067 C            MOV                 DataA_Buffer,A
   630 0087E 1E02 C            BANK                2
   631 0087F 0421 C            MOV                 A,DataB
   632 00880 1E00 C            BANK                0
   633 00881 0068 C            MOV                 DataB_Buffer,A
   634 00882 1E02 C            BANK                2
   635 00883 0422 C            MOV                 A,DataC
   636 00884 1E00 C            BANK                0
   637 00885 0069 C            MOV                 DataC_Buffer,A
   638 00886 1E02 C        	BANK                2
   639 00887 0423 C            MOV                 A,DataD
   640 00888 1E00 C            BANK                0
   641 00889 006A C            MOV                 DataD_Buffer,A
   642 0088A 1E02 C            BANK                2
   643 0088B 0424 C            MOV                 A,DataE
   644 0088C 1E00 C            BANK                0
   645 0088D 006B C            MOV                 DataE_Buffer,A
   646 0088E 1E02 C            BANK                2
   647 0088F 0425 C            MOV                 A,DataF
   648 00890 1E00 C            BANK                0
   649 00891 006C C            MOV                 DataF_Buffer,A
   650 00892 1E02 C            BANK                2
   651 00893 0426 C            MOV                 A,DataG
   652 00894 1E00 C            BANK                0
   653 00895 006D C            MOV                 DataG_Buffer,A
   654            C        
   655 00896 1EA0 C        	LCALL               Enter_TX_Buffer_ACK
   655 00897 0D87 C        	LCALL               Enter_TX_Buffer_ACK
   656 00898 1EA0 C        	LCALL               RESET_RF_FIFO
   656 00899 0D7C C        	LCALL               RESET_RF_FIFO
   657 0089A 1EA0 C        	LCALL               Write_FIFO_RAM
   657 0089B 0D68 C        	LCALL               Write_FIFO_RAM
   658 0089C 0000 C        	NOP
   659            C        
   660            C        ;--------------------------- Wating a cycle end --------------------------------------
   661 0089D 0417 C        	MOV                 A,ComuClock           ;wait the manage time arrive
   662 0089E 0319 C        	XOR                 A,ComuEndNum
   663 0089F 0E83 C        	JBS                 STATUS,Z
   664 008A0 149D C        	JMP                 $-3
   665            C        ;--------------------------------------------------------------------------------------
   666 008A1 0000 C        	NOP
   667 008A2 1400 C        	JMP                 Normal_Communicate    ; a cycle End
   668            C        
   669            C        
   670            C        
   671            C        ;============================================================================================
   672 008A3      C        LoseFrameStatus_Timeout:
   673 008A3 00D7 C        	CLR                 ComuClock
   674 008A4 0419 C        	MOV                 A,ComuEndNum
   675 008A5 0317 C        	XOR                 A,ComuClock                       ;2ms a cycle ,
   676 008A6 0E83 C        	JBS                 STATUS,Z
   677 008A7 14A4 C        	JMP                 $-3
   678 008A8 0000 C        	NOP
   679 008A9      C        LoseFrameStatus_RXID_Error:
   680 008A9 1E00 C        	BANK                0
   681 008AA 089E C        	BC                  ReadLengthError/16,ReadLengthError%16
   682 008AB 00DA C        	CLR                 Databytelength
   683 008AC 00E1 C        	CLR                 RX_IDH_Buffer
   684 008AD 00E2 C        	CLR                 RX_IDL_Buffer
   685 008AE 00E3 C        	CLR                 CHN_FLAG_Buffer
   686 008AF 00E6 C        	CLR                 N_CHN_Buffer
   687 008B0 00E6 C        	CLR                 TX_ID_Buffer
   688 008B1 1E01 C        	BANK                1
   689            C        	;LCALL               LoseFrameLinkMode_Set
   690 008B2 081F C        	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   691 008B3 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   692 008B4 0A9F C        	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   693 008B5 0433 C        	MOV                 A,LossframeCNT                    ;LossframeCNT>10 stand for loss frequency
   694 008B6 1D05 C        	SUB                 A,@5
   695 008B7 0E03 C        	JBS                 STATUS,C
   696 008B8 14BB C        	JMP                 LoseFreqStatus_Timeout
   697 008B9 0573 C        	INC                 LossframeCNT
   698 008BA 1400 C        	JMP                 Lossframe_Communicate
   699            C        
   700 008BB      C        LoseFreqStatus_Timeout:
   701            C        	;LCALL               SearchLinkMode_Set
   702 008BB 0A1F C        	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   703 008BC 085F C        	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   704 008BD 089F C        	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
   705 008BE 1E01 C        	BANK                1
   706 008BF 00D7 C        	CLR                 ComuClock
   707 008C0 00D8 C        	CLR                 ComuCycleNum
   708 008C1 00D9 C        	CLR                 ComuEndNum
   709 008C2 00F3 C        	CLR                 LossframeCNT
   710 008C3 00E3 C        	CLR                 CHN_FLAG
   711 008C4 0012 C        	RET                                                ;return to search status
   712 008C5 0000 C        	NOP
   713            C        
   714            C        ;==========================================================================
   715            C        ; data Sampling function
   716            C        ;==========================================================================
   717 008C6      C        Sampling_Task:
   718 008C6 1EA0 C        	LCALL               Key_Scan              ;get key data
   718 008C7 1100 C        	LCALL               Key_Scan              ;get key data
   719 008C8 1EA0 C        	LCALL               CmosSensor_Function
   719 008C9 1C01 C        	LCALL               CmosSensor_Function
   720            C        	;LCALL               GS_Sensor
   721 008CA 0000 C        	NOP
   722 008CB 0012 C        	RET
   723            C        ;==========================================================================
   724            C        
   725            C        
   726            C        
   727            C        
   728            C        
    19                     include "XX93C46_For_EM78P520.ASM"
     1            C        ;***********************************************************************;
     2            C        ; Tilte: Em78x510x spi FOR AT93C46 Function macro Code                  ;
     3            C        ; Description:                                  ;
     4            C        ;     1."mEWEN"  /                                    ;
     5            C        ;     2."mEWDS"  /                                    ;
     6            C        ;     3."mWRITE"    ;
     7            C        ;     4."mREAD"                         ;
     8            C        ;     5."mERASE"                    ;
     9            C        ;     6."mERAL"  "FF"             ;
    10            C        ;     7."mWRAL"                             ;
    11            C        ; Company: Elan Corp. Inc                                               ;
    12            C        ; Author:  yu.wei                                                     ;
    13            C        ; Date:    2009.3.20                                                    ;
    14            C        ; Version: v1.0                                                         ;
    15            C        ;                         ;
    16            C        ;***********************************************************************
    17            C        ;
    18            C        ;    1. 8bit;
    19            C        ;------------------------------------------------------
    20            C        ; spi          Port Used For 93C46 Control.
    21            C        ; cs           Port Pin Tied To cs On 93C46.
    22            C        ; sk           Port Pin Tied To sk On 93C46.
    23            C        ; di           Port Pin Tied To di On 93C46.
    24            C        ; DO           Port Pin Tied To DO On 93C46.
    25            C        ; r_acc1     This Register Contains The 2 Bit 93C46
    26            C        ;              Command Is The High 2 Bit Positions And
    27            C        ;              memory Address In The Lower 6.
    28            C        ;--------------------------------------------------
    29            C        ;Instruction   SB    Op Code     Address               Data
    30            C        ;                               x8       x16       x8       x16
    31            C        ;    READ       1      10 	A6 - A0  A5 - A0
    32            C        ;    EWEN       1 	   00     11XXXXX  11XXXX
    33            C        ;    ERASE      1      11     A6 - A0  A5 - A0
    34            C        ;    WRITE      1 	   01 	A6 - A0  A5 - A0   D7 - D0  D15- D0
    35            C        ;    ERAL       1 	   00 	10XXXXX  10XXXX
    36            C        ;    WRAL       1 	   00 	01XXXXX  01XXXX    D7 - D0  D15- D0
    37            C        ;    EWDS       1 	   00 	00XXXXX  00XXXX
    38            C        ;=================================================================================
    39            C        
    40            C        XX93C46_For_EM78P520.ASM       EQU        XX93C46_For_EM78P510.ASM
    41            C        include "XX93C46_For_EM78P520.H"
     1            C        ;---------------------------------------------------
     2            C        XX93C46_For_EM78P510.H       EQU        XX93C46_For_EM78P510.H
     3            C        
     4            C        ;---------------------------------------------------
     5            C        ;  93C46 INSTRUCTION  COmmAND
     6            C        ;--------------------------------------------------
     7       0080 C                READ        EQU     0X80    ;93C46 Read Command.
     8       0040 C                WRITE       EQU     0X40    ;93C46 Write Command.
     9       00C0 C                ERASE       EQU     0XC0    ;93C46 Erase Command.
    10       0030 C                EWEN        EQU     0X30    ;93C46 Erase/Write Enable Command.
    11       0000 C                EWDS        EQU     0X00    ;93C46 Erase/Write Disable Command.
    12       0020 C                ERAL        EQU     0X20    ;92C46 Erase All Command.
    13       0010 C                WRAL        EQU     0X10    ;92C46 Write All Command.
    14            C        ;--------------------------------------------------
    42            C        
    43            C        ifndef EM78CtrlIns.H
    44            C        include "EM78CtrlIns.H"
    45            C        endif
    46            C        ;--------------------------------------------------
    47            C        
    48            C                ORG     0X1000
    49            C        ;***********************************************************************;
    50            C        ;Program name: mEWEN m,spi    m 8BIT16BIT               ;
    51            C        ;Description:  /                                ;
    52            C        ;Input:         m==8m==16  m                  ;
    53            C        ;              spics,sk,di,DO                               ;
    54            C        ;Output:       /                                          ;
    55            C        ;Variable Register:None                                                 ;
    56            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    57            C        ;***********************************************************************;
    58            C        mEWEN   MACRO
    59            C                LCALL   Start_Bit       ;load start bit
    60            C                MOV     A,@ewen         ;enable erase/write
    61            C                MOV     r_acc1,A
    62            C                ;
    63            C                MOV     A,@9
    64            C                ;
    65            C                LCALL    Rl_Comd         ;finish enable erase/write
    66            C                BC      AT93C46_CS/16,AT93C46_CS%16          ;load end bit
    67            C                BC      SPI_CLK/16,SPI_CLK%16
    68            C                BC      SPI_MOSI/16,SPI_MOSI%16
    69            C                ENDM
    70            C        ;
    71            C        ;***********************************************************************;
    72            C        ;Program name:  mEWDS m,spi    m 8BIT16BIT              ;
    73            C        ;Description:   /                               ;
    74            C        ;Input:          m==8m==16  m               ;
    75            C        ;               spics,sk,di,DO                              ;
    76            C        ;Output:        /                                         ;
    77            C        ;Variable Register:None                                                 ;
    78            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
    79            C        ;***********************************************************************;
    80            C        mEWDS   MACRO
    81            C                LCALL    Start_Bit       ;
    82            C                MOV      A,@ewds         ;
    83            C                MOV      r_acc1,A
    84            C                ;
    85            C                MOV      A,@9
    86            C                ;
    87            C                LCALL    Rl_Comd
    88            C                BC       AT93C46_CS/16,AT93C46_CS%16
    89            C                BC       SPI_CLK/16,SPI_CLK%16
    90            C                BC       SPI_MOSI/16,SPI_MOSI%16          ;
    91            C                ENDM
    92            C        ;
    93            C        ;***********************************************************************;
    94            C        ;Program name:  mWRITE m,DataAddressInEEPROM,k,DataAddressInMCU,spi                            ;
    95            C        ;Description:                                   ;
    96            C        ;Input:         m  m==816                                 ;
    97            C        ;               DataAddressInEEPROM  (93C46      ;
    98            C        ;               k                                   ;
    99            C        ;               DataAddressInMCU  mCU         ;
   100            C        ;               spi  PORTcs,sk,di,DO      ;
   101            C        ;Output:                                      ;
   102            C        ;Variable Register:None                                                 ;
   103            C        ;Register Changed: STATUS,ACC ,
   104            C        ;                  r_acc1(0X21) ,
   105            C        ;                  r_acc2(0X22),         ;
   106            C        ;                  r_acc3(0X23)                                       ;
   107            C        ;***********************************************************************;
   108            C        mWRITE  MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   109            C                BANK    @BankSel
   110            C                MOV     A,DataAddressInMCU    ;0X24mCU
   111            C                MOV     R4,A                   ;
   112            C                MOV     A,@k
   113            C                MOV     r_acc3,A               ;93C46
   114            C        $Write_Data:
   115            C                LCALL    Start_Bit             ;
   116            C               ;
   117            C                BC      STATUS,C
   118            C                RRCA    DataAddressInEEPROM
   119            C                ;
   120            C                OR      A,@write
   121            C                MOV     r_acc1,A               ;
   122            C                MOV     A,@8                   ;93C46
   123            C                LCALL    Rl_Comd               ;
   124            C               ;
   125            C                BC      SPI_CLK/16,SPI_CLK%16
   126            C                JBS     DataAddressInEEPROM,0        ;8BIT
   127            C                BC      SPI_MOSI/16,SPI_MOSI%16
   128            C                JBC     DataAddressInEEPROM,0
   129            C                BS      SPI_MOSI/16,SPI_MOSI%16
   130            C                JMP     $+1
   131            C                BS      SPI_CLK/16,SPI_CLK%16          ;OPADDRESS
   132            C                ;
   133            C                INC     DataAddressInEEPROM
   134            C        $Data_H_L:
   135            C                MOV     A,R0
   136            C                MOV     r_acc1,A      ;
   137            C                INC     R4
   138            C                MOV     A,@8
   139            C                LCALL    Rl_Comd         ;8BIT
   140            C               ;
   141            C                JMP     $+1
   142            C               ;
   143            C                BC      AT93C46_CS/16,AT93C46_CS%16
   144            C                BC      SPI_CLK/16,SPI_CLK%16          ;
   145            C                ;BC      AT93C46_CS/16,AT93C46_CS%16
   146            C                BC      SPI_MOSI/16,SPI_MOSI%16
   147            C                JMP     $+1
   148            C                BS      SPI_CLK/16,SPI_CLK%16
   149            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;
   150            C                JBS     SPI_MISO/16,SPI_MISO%16
   151            C                JMP     $-1
   152            C                BC      AT93C46_CS/16,AT93C46_CS%16
   153            C                DJZ     r_acc3        ;
   154            C                JMP     $Write_Data
   155            C                ENDM
   156            C        ;
   157            C        ;***********************************************************************;
   158            C        ;Program name:  mREAD m,DataAddressInEEPROM,k,DataAddressInMCU,spi                             ;
   159            C        ;Description:   93C46(CPU)          ;
   160            C        ;Input:         m  m==816                                 ;
   161            C        ;               DataAddressInEEPROM  (93C46      ;
   162            C        ;               k                                   ;
   163            C        ;               DataAddressInMCU  mCU         ;
   164            C        ;               spi  PORTcs,sk,di,DO      ;
   165            C        ;Output:                                          ;
   166            C        ;Variable Register:None                                                 ;
   167            C        ;Register Changed: STATUS,ACC ,
   168            C        ;                  r_acc1(0X21) ,
   169            C        ;                  r_acc2(0X22),         ;
   170            C        ;                  r_acc3(0X23)                                       ;
   171            C        ;***********************************************************************;
   172            C        mREAD   MACRO   DataAddressInEEPROM,@BankSel,DataAddressInMCU,@k
   173            C                BANK    @BankSel
   174            C                MOV     A,DataAddressInMCU              ;mCU     ;
   175            C                MOV     R4,A
   176            C                MOV     A,@k
   177            C                MOV     r_acc3,A
   178            C        $Write_Data:
   179            C                LCALL    Start_Bit       ;
   180            C               ;
   181            C                RRCA    DataAddressInEEPROM
   182            C                ;
   183            C                OR      A,@READ
   184            C                MOV     r_acc1,A      ;
   185            C                MOV     A,@8            ;93C46
   186            C                LCALL    Rl_Comd         ;
   187            C               ;
   188            C                BC      SPI_CLK/16,SPI_CLK%16
   189            C                JBS     DataAddressInEEPROM,0        ;8BIT
   190            C                BC      SPI_MOSI/16,SPI_MOSI%16
   191            C                JBC     DataAddressInEEPROM,0
   192            C                BS      SPI_MOSI/16,SPI_MOSI%16
   193            C                JMP     $+1
   194            C                BS      SPI_CLK/16,SPI_CLK%16
   195            C               ;
   196            C                INC     DataAddressInEEPROM          ;1
   197            C                BC      SPI_MOSI/16,SPI_MOSI%16
   198            C                JMP     $+1
   199            C                BC      SPI_CLK/16,SPI_CLK%16
   200            C                JMP     $+1
   201            C                JMP     $+1
   202            C                BS      SPI_CLK/16,SPI_CLK%16
   203            C        
   204            C        $Read_Data1:
   205            C                MOV     A,@8
   206            C                MOV     r_acc2,A
   207            C        $Read_Data2:
   208            C                BC      SPI_CLK/16,SPI_CLK%16
   209            C                NOP
   210            C                NOP
   211            C                JBC     SPI_MISO/16,SPI_MISO%16
   212            C                BS      STATUS,C
   213            C                JBS     SPI_MISO/16,SPI_MISO%16
   214            C                BC      STATUS,C
   215            C                RLC     R0
   216            C                BS      SPI_CLK/16,SPI_CLK%16
   217            C                JMP     $+1
   218            C                DJZ     r_acc2
   219            C                JMP     $Read_Data2
   220            C                INC     R4
   221            C                ;
   222            C                NOP
   223            C                ;
   224            C                BC      AT93C46_CS/16,AT93C46_CS%16
   225            C                DJZ     r_acc3
   226            C                JMP     $Write_Data
   227            C                ENDM
   228            C        ;
   229            C        ;***********************************************************************;
   230            C        ;Program name:  mERASE m,DataAddressInEEPROM,k,spi                                   ;
   231            C        ;Description:                                       ;
   232            C        ;Input:         m  m==816                                 ;
   233            C        ;               DataAddressInEEPROM (93C46       ;
   234            C        ;               k                                   ;
   235            C        ;               spi    PORTcs,sk,di,DO    ;
   236            C        ;Output:                                          ;
   237            C        ;Variable Register:None                                                 ;
   238            C        ;Register Changed: STATUS,ACC ,
   239            C        ;                  r_acc1(0X21) ,
   240            C        ;                  r_acc2(0X22),         ;
   241            C        ;                  r_acc3(0X23)                                       ;
   242            C        ;***********************************************************************;
   243            C        mERASE  MACRO    DataAddressInEEPROM,k
   244            C                MOV     A,@k
   245            C                MOV     r_acc3,A      ;93C46
   246            C        $Write_Data:
   247            C                LCALL    Start_Bit       ;
   248            C               ;
   249            C                RRCA    DataAddressInEEPROM
   250            C               ;
   251            C                OR      A,@ERASE
   252            C                MOV     r_acc1,A      ;
   253            C                MOV     A,@8            ;93C46
   254            C                LCALL    Rl_Comd         ;
   255            C                ;
   256            C                BC      SPI_CLK/16,SPI_CLK%16
   257            C                JBS     DataAddressInEEPROM,0        ;8BIT
   258            C                BC      SPI_MOSI/16,SPI_MOSI%16
   259            C                JBC     DataAddressInEEPROM,0
   260            C                BS      SPI_MOSI/16,SPI_MOSI%16
   261            C                JMP     $+1
   262            C                BS      SPI_CLK/16,SPI_CLK%16          ;
   263            C                JMP     $+1
   264            C                JMP     $+1
   265            C               ;
   266            C                INC     DataAddressInEEPROM
   267            C                BC      AT93C46_CS/16,AT93C46_CS%16
   268            C                BC      SPI_CLK/16,SPI_CLK%16
   269            C                BC      SPI_MOSI/16,SPI_MOSI%16
   270            C                JMP     $+1
   271            C                BS      SPI_CLK/16,SPI_CLK%16
   272            C                BS      AT93C46_CS/16,AT93C46_CS%16
   273            C                JBS     SPI_MISO/16,SPI_MISO%16
   274            C                JMP     $-1
   275            C                BC      AT93C46_CS/16,AT93C46_CS%16
   276            C        ;
   277            C                DJZ     r_acc3
   278            C                JMP     $Write_Data
   279            C                ENDM
   280            C        ;
   281            C        ;***********************************************************************;
   282            C        ;Program name:  mERAL m,spi                                             ;
   283            C        ;Description:                                         ;
   284            C        ;Input:         m  m==816                                 ;
   285            C        ;               spi  PORTcs,sk,di,DO      ;
   286            C        ;Output:        FF"                         ;
   287            C        ;Variable Register:None                                                 ;
   288            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   289            C        ;***********************************************************************
   290            C        mERAL   MACRO
   291            C        $Write_Data:
   292            C                LCALL   Start_Bit       ;
   293            C                MOV     A,@ERAL
   294            C                MOV     r_acc1,A      ;
   295            C               ;
   296            C                MOV     A,@9
   297            C               ;
   298            C                LCALL    Rl_Comd
   299            C                BC      AT93C46_CS/16,AT93C46_CS%16
   300            C                BC      SPI_CLK/16,SPI_CLK%16
   301            C                BC      SPI_MOSI/16,SPI_MOSI%16
   302            C                JMP     $+1
   303            C                BS      SPI_CLK/16,SPI_CLK%16
   304            C                BS      AT93C46_CS/16,AT93C46_CS%16
   305            C                JBS     SPI_MISO/16,SPI_MISO%16
   306            C                JMP     $-1
   307            C                BC      AT93C46_CS/16,AT93C46_CS%16
   308            C                ENDM
   309            C        ;
   310            C        ;***********************************************************************;
   311            C        ;Program name:  mWRAL m,DataAddressInMCU,spi                                      ;
   312            C        ;Description:                                 ;
   313            C        ;Input:         m  m==816                                 ;
   314            C        ;               spi  PORTcs,sk,di,DO      ;
   315            C        ;               DataAddressInMCU  mCU         ;
   316            C        ;Output:                                        ;
   317            C        ;Variable Register:None                                                 ;
   318            C        ;Register Changed: STATUS,ACC ,r_acc1(0X21) , r_acc2(0X22)          ;
   319            C        ;***********************************************************************;
   320            C        mWRAL   MACRO   @DataAddressInMCU
   321            C                MOV     A,@DataAddressInMCU
   322            C                MOV     R4,A            ;
   323            C                LCALL    Start_Bit       ;
   324            C                MOV     A,@WRAL
   325            C                MOV     r_acc1,A      ;
   326            C                ;
   327            C                MOV     A,@9
   328            C                ;
   329            C                LCALL    Rl_Comd
   330            C        $Data_H_L:
   331            C                MOV     A,R0
   332            C                MOV     r_acc1,A      ;
   333            C                INC     R4
   334            C                MOV     A,@8
   335            C                LCALL    Rl_Comd         ;8BIT
   336            C                ;
   337            C                NOP
   338            C                ;
   339            C                BC      SPI_CLK/16,SPI_CLK%16          ;
   340            C                BC      AT93C46_CS/16,AT93C46_CS%16
   341            C                BC      SPI_MOSI/16,SPI_MOSI%16
   342            C                JMP     $+1
   343            C                BS      SPI_CLK/16,SPI_CLK%16
   344            C                BS      AT93C46_CS/16,AT93C46_CS%16          ;
   345            C                JBS     SPI_MISO/16,SPI_MISO%16
   346            C                JMP     $-1
   347            C                BC      AT93C46_CS/16,AT93C46_CS%16
   348            C                BC      SPI_CLK/16,SPI_CLK%16
   349            C                ENDM
   350            C        
   351            C        
   352            C        ;-------------------------------------------------------
   353 01000      C        Start_Bit:
   354 01000 1E00 C        		BANK    @0
   355 01001 08C7 C                BC      AT93C46_CS/16,AT93C46_CS%16
   356 01002 098A C                BC      SPI_CLK/16,SPI_CLK%16
   357 01003 094A C                BC      SPI_MOSI/16,SPI_MOSI%16
   358 01004 1405 C                JMP     $+1
   359 01005 1406 C                JMP     $+1
   360 01006 0AC7 C                BS      AT93C46_CS/16,AT93C46_CS%16
   361 01007 1408 C                JMP     $+1
   362 01008 1409 C                JMP     $+1
   363 01009 0B4A C                BS      SPI_MOSI/16,SPI_MOSI%16       ;PORT6,SPI_MOSI;
   364 0100A 140B C                JMP     $+1
   365 0100B 140C C                JMP     $+1
   366 0100C 0B8A C                BS      SPI_CLK/16,SPI_CLK%16
   367 0100D 0012 C                RET
   368            C        
   369            C        ;--------------------------------------------------------
   370 0100E      C        Rl_Comd:
   371 0100E 005B C        	MOV     DataShiftCounter,A
   372 0100F 1E00 C        	BANK    @0
   373 01010      C        Rl_Comd1:
   374 01010 098A C        	BC      SPI_CLK/16,SPI_CLK%16
   375 01011 1412 C        	JMP     $+1
   376 01012 0803 C        	bc      status,c
   377 01013 06D1 C        	RLC     r_acc1        ;
   378 01014 0E03 C        	JBS     STATUS,C
   379 01015 094A C        	BC      SPI_MOSI/16,SPI_MOSI%16
   380 01016 0C03 C        	JBC     STATUS,C
   381 01017 0B4A C        	BS      SPI_MOSI/16,SPI_MOSI%16
   382 01018 0000 C        	NOP
   383 01019 0000 C        	NOP
   384 0101A 0B8A C        	BS      SPI_CLK/16,SPI_CLK%16
   385 0101B 141C C        	JMP     $+1
   386 0101C 05DB C        	DJZ     DataShiftCounter
   387 0101D 1410 C        	JMP     Rl_Comd1
   388 0101E 0012 C        	RET                   ;    return
   389            C        
   390            C        ;=============== SPI Config for EM78P510====================
   391 0101F      C        IO_93C46_INITIAL:
   392 0101F 1E00 C        	BANK                0
   393 01020 0BCA C        	BS                  SPI_SS/16,SPI_SS%16          ; Disable EM198810
   394 01021 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16        ; Disable CMOS
   395 01022 0AC7 C        	BS                 AT93C46_CS/16,AT93C46_CS%16   ; Enable 93C46
   396            C        
   397 01023 1E02 C        	BANK                2
   398 01024 040D C        	MOV                 A,SPIC
   399 01025 1E04 C        	BANK                4
   400 01026 0071 C        	MOV                 SPIC_TEMP,A
   401 01027 1E02 C        	BANK                2
   402 01028 00CD C        	CLR                 SPIC
   403 01029 0012 C        	RET
   404            C        
   405 0102A      C        IO_93C46_QUIT:
   406 0102A 1E00 C        	BANK                0
   407            C        	;BS                 SPI_SS/16,SPI_SS%16           ; Disable EM198810
   408            C        	;BS                 CMOS_SS/16,CMOS_SS%16         ; Disable CMOS
   409 0102B 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   410            C        
   411 0102C 1E04 C        	BANK                4
   412 0102D 0431 C        	MOV                 A,SPIC_TEMP
   413 0102E 1E02 C        	BANK                2
   414 0102F 004D C        	MOV                 SPIC,A
   415 01030 0012 C        	RET
    20                     include "CmosSensor.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  CmosSensorMM0200.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/9
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;---------------------------------------------------------------
    12            C        CmosSensorMM0200.ASM        EQU       CmosSensorMM0200.ASM
    13            C        
    14            C        include "CmosSensor.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  CmosSensor.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/11/9
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-----------------------------------------------------------------
    12            C        CmosSensorMM0200.H      EQU       CmosSensorMM0200.H
    13            C        
    14            C        
    15            C        
    16            C        
    17            C        ;-----------------------------------------------------------------
    18       0000 C        CmosSensorTypeSelect    EQU       0  ; select type,Default=0(MM0200DA)
    19            C                                             ; 0: MM0200DA (SPI Interface)
    20            C                                             ; 1: MM0200BA (I2C Interface)
    21            C                                             ; 2: MM0200FA   
    22            C                                             ; 3: MM0200CA         
    23            C                                             	
    24            C                                             	                                                                   
    15            C        include "D:\include\lib\Arithmetic\KalmanFilter.ASM"
     1            C        /*****************************************************************
     2            C        * Filename     :  filter file
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * Version      :  1.0
     6            C        * Creat date   :  2009-11-11 14:06:33
     7            C        * tool ver.    :  WicePlus 2.7/eUIDE
     8            C        * Description  :  build for cmos sensor samping filter
     9            C        *****************************************************************/
    10            C        ;--------------------------------------------------------------
    11            C        KalmanFilter.ASM     EQU    KalmanFilter.ASM
    12            C        
    13            C        include "D:\include\lib\Arithmetic\KalmanFilter.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  filter file
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * Version      :  1.0
     6            C        * Creat date   :  2009/11/10
     7            C        * tool ver.    :  WicePlus 2.7/eUIDE
     8            C        * Description  :  build for cmos sensor samping filter
     9            C        *****************************************************************/
    10            C        ;--------------------------------------------------------------
    11            C        KalmanFilter.H     EQU    KalmanFilter.H
    14            C        
    15            C        ifndef EM78CtrlIns.H
    16            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    17            C        endif
    18            C        
    19            C        ifndef EM78Math.H
    20            C        include "D:\include\EM78xx\EM78Math.H"
    21            C        endif
    22            C        
    23            C        ;--------------------------------------------------------------
    24            C        
    25            C        	ORG    0X1C00    ;(PAGE7)
    26            C        	MESSAGE "define 'KalmanFilter.ASM' ROM address "
***     USER MESSAGE: DEFINE 'KALMANFILTER.ASM' ROM ADDRESS 
    27            C        ;====================================================================
    28            C        ; Kalman Filter arithmetic
    29            C        ; input:       
    30            C        ; output:      
    31            C        ; description: 
    32            C        ; date:        
    33            C        ;====================================================================
    34 01C00      C        KalmanFilter:
    35            C        	
    36            C        	
    37            C        	
    38 01C00 0012 C        	RET
    16            C        
    17            C        ifndef EM78CtrlIns.H
    18            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    19            C        endif
    20            C        
    21            C        ;---------------------------------------------------------------
    22            C        
    23            C        ;******************************************************************
    24            C        if     CmosSensorTypeSelect == 1
    25            C        ;******************************************************************
    26            C        ; Cmos Sensor MM0200BA
    27            C        ;******************************************************************
    28            C        CmosSensor_Function:
    29            C        
    30            C        	RET
    31            C        
    32            C        
    33            C        ;******************************************************************
    34            C        elseif CmosSensorTypeSelect == 2
    35            C        ;******************************************************************
    36            C        ; Cmos Sensor MM0200FA
    37            C        ;******************************************************************
    38            C        CmosSensor_Function:
    39            C        
    40            C        	RET
    41            C        
    42            C        
    43            C        ;******************************************************************
    44            C        elseif CmosSensorTypeSelect == 3
    45            C        ;******************************************************************
    46            C        ; Cmos Sensor MM0200CA
    47            C        ;******************************************************************
    48            C        CmosSensor_Function:
    49            C        
    50            C        	RET
    51            C        
    52            C        
    53            C        ;******************************************************************
    54            C        else
    55            C        ;******************************************************************
    56            C        ; Cmos Sensor MM0200DA(Default) Driver
    57            C        ;******************************************************************
    58            C        ;==========================================================================
    59            C        ;input:       CMOS_PARAMETER[0:init; 1:sleep; 2:get data]
    60            C        ;output:      CMOS_STATUS,
    61            C        ;             CMOS_XPOINT_LOW,
    62            C        ;             CMOS_YPOINT_LOW,
    63            C        ;             CMOS_POINT_HIGH,
    64            C        ;Description: CMOS Function Program
    65            C        ;==========================================================================
    66 01C01      C        CmosSensor_Function:
    67 01C01 1E04 C        	BANK                4
    68 01C02 0B0A C        	BS                  PAIOCR,4
    69 01C03 1E05 C        	BANK                5
    70 01C04 0B0A C        	BS                  PAPHCR,4
    71 01C05 1E00 C        	BANK                0
    72 01C06 0BCA C        	BS                  SPI_SS/16,SPI_SS%16           ; Disable EM198810
    73 01C07 08C7 C        	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
    74 01C08 080A C        	BC                  CMOS_SS/16,CMOS_SS%16         ; Enable CMOS
    75            C        
    76 01C09 1E02 C        	BANK                2
    77 01C0A 040C C        	MOV                 A,SPIS
    78 01C0B 1E04 C        	BANK                4
    79 01C0C 0070 C        	MOV                 SPIS_TEMP,A
    80 01C0D 1E02 C        	BANK                2
    81 01C0E 1800 C        	MOV                 A,@00000000B  ; Shift left, SDO delay time: 16clk,
    82 01C0F 004C C        	MOV                 SPIS,A       ; disable open-drain
    83            C        
    84 01C10 1E02 C        	BANK                2
    85 01C11 040D C        	MOV                 A,SPIC
    86 01C12 1E04 C        	BANK                4
    87 01C13 0071 C        	MOV                 SPIC_TEMP,A
    88 01C14 1E02 C        	BANK                2
    89 01C15 18CC C        	MOV                 A,@11001100B  ; Rising edge read data
    90 01C16 004D C        	MOV                 SPIC,A
    91            C        
    92 01C17 1E05 C        	BANK                5
    93 01C18 18C0 C        	MOV                 A,@11000000B
    94 01C19 0244 C        	OR                  RSR,A
    95 01C1A 0CA0 C        	JBC                 CMOS_PARAMETER,2
    96 01C1B 145E C        	JMP                 Get_CMOS_Data
    97 01C1C 0C20 C        	JBC                 CMOS_PARAMETER,0
    98 01C1D 1429 C        	JMP                 CMOS_Init
    99 01C1E 0C60 C        	JBC                 CMOS_PARAMETER,1
   100 01C1F 143C C        	JMP                 CMOS_Power_Down
   101 01C20 144F C        	JMP                 CMOS_WakeUP
   102 01C21      C          EXIT_CMOS_FUNCTION:
   103 01C21 1E04 C        	BANK                4
   104 01C22 0431 C        	MOV                 A,SPIC_TEMP  ;falling edge read data
   105 01C23 1E02 C        	BANK                2
   106 01C24 004D C        	MOV                 SPIC,A
   107 01C25 0000 C        	NOP
   108 01C26 0000 C        	NOP
   109 01C27 0012 C        	RET
   110 01C28 0000 C        	NOP
   111            C        
   112            C        ;==========================================================================
   113            C        ;input:       CMOS_PARAMETER
   114            C        ;output:      CMOS_STATUS
   115            C        ;Description: CMOS Initialize
   116            C        ;==========================================================================
   117 01C29      C        CMOS_Init:
   118 01C29 1E05 C        	BANK                5
   119 01C2A 0C21 C        	JBC                 CMOSInitFlag/16,CMOSInitFlag%16
   120 01C2B 143A C        	JMP                 CMOS_Init_Exit
   121 01C2C 1E00 C        	BANK                0
   122 01C2D 080A C        	BC                  CMOS_SS/16,CMOS_SS%16
   123 01C2E      C          Set_Init:
   124 01C2E 1888 C        	MOV                 A,@0X88
   125 01C2F 1EA0 C        	LCALL               SIM_SPI_WRITE
   125 01C30 0D34 C        	LCALL               SIM_SPI_WRITE
   126 01C31 1BFF C        	XOR                 A,@0XFF
   127 01C32 0C83 C        	JBC                 STATUS,Z          ; R3,2
   128 01C33 143A C        	JMP                 CMOS_Init_Exit
   129            C        	;MOV                A,@0XFE           ; Sensitivity 1
   130            C        	;MOV                A,@0XB4           ; Sensitivity 2
   131 01C34 1864 C        	MOV                 A,@0X64           ; Sensitivity 3
   132            C        	;MOV                A,@0X36           ; Sensitivity 4
   133            C        	;MOV                A,@0X20           ; Sensitivity 5
   134 01C35 1EA0 C        	LCALL               SIM_SPI_WRITE
   134 01C36 0D34 C        	LCALL               SIM_SPI_WRITE
   135 01C37 0A21 C        	BS                  CMOSInitFlag/16,CMOSInitFlag%16
   136 01C38 1E00 C        	BANK                0
   137 01C39 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16
   138 01C3A      C          CMOS_Init_Exit:
   139 01C3A 1421 C        	JMP                 EXIT_CMOS_FUNCTION
   140 01C3B 0000 C        	NOP
   141            C        
   142            C        ;==========================================================================
   143            C        ;input:       CMOS_PARAMETER
   144            C        ;output:      CMOS_STATUS
   145            C        ;Description: CMOS Power Down
   146            C        ;==========================================================================
   147 01C3C      C        CMOS_Power_Down:
   148 01C3C 1E05 C        	BANK                5
   149 01C3D 0C61 C        	JBC                 CMOSSleepFlag/16,CMOSSleepFlag%16
   150 01C3E 144D C        	JMP                 CMOS_Sleep_Exit
   151 01C3F 1E00 C        	BANK                0
   152 01C40 080A C        	BC                  CMOS_SS/16,CMOS_SS%16
   153 01C41      C          Set_Power_Down:
   154 01C41 18FF C        	MOV                 A,@0XFF
   155 01C42 1EA0 C        	LCALL               SIM_SPI_WRITE
   155 01C43 0D34 C        	LCALL               SIM_SPI_WRITE
   156 01C44 1BFF C        	XOR                 A,@0XFF
   157 01C45 0C83 C        	JBC                 STATUS,Z          ; R3,2
   158 01C46 144D C        	JMP                 CMOS_Sleep_Exit
   159 01C47 1801 C        	MOV                 A,@0X01
   160 01C48 1EA0 C        	LCALL               SIM_SPI_WRITE
   160 01C49 0D34 C        	LCALL               SIM_SPI_WRITE
   161 01C4A 0A61 C        	BS                  CMOSSleepFlag/16,CMOSSleepFlag%16
   162 01C4B 1E00 C        	BANK                0
   163 01C4C 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16
   164 01C4D      C          CMOS_Sleep_Exit:
   165 01C4D 1421 C        	JMP                 EXIT_CMOS_FUNCTION
   166 01C4E 0000 C        	NOP
   167            C        
   168            C        ;;==========================================================================
   169            C        ;input:       CMOS_PARAMETER
   170            C        ;output:      CMOS_STATUS
   171            C        ;Description: CMOS Wake Up -- SS pull low 5us
   172            C        ;==========================================================================
   173 01C4F      C        CMOS_WakeUP:
   174 01C4F 1E05 C        	BANK                5
   175 01C50 0E61 C        	JBS                 CMOSSleepFlag/16,CMOSSleepFlag%16
   176 01C51 145A C        	JMP                 CMOS_WakeUp_Exit
   177 01C52 1E00 C        	BANK                0
   178 01C53 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16
   179 01C54 0000 C        	NOP
   180 01C55 0000 C        	NOP
   181 01C56 080A C        	BC                  CMOS_SS/16,CMOS_SS%16
   182 01C57 10B0 C        	CALL                DELAY_X10US
   183 01C58 1E00 C        	BANK                0
   184 01C59 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16
   185 01C5A      C          CMOS_WakeUp_Exit:
   186 01C5A 1E05 C        	BANK                5
   187 01C5B 0861 C        	BC                  CMOSSleepFlag/16,CMOSSleepFlag%16
   188 01C5C 1421 C        	JMP                 EXIT_CMOS_FUNCTION
   189 01C5D 0000 C        	NOP
   190            C        
   191            C        ;***********************************************************
   192            C        ;input:       CMOS_PARAMETER[0:init; 1:sleep; 2:get data]
   193            C        ;output:      CMOS_STATUS,
   194            C        ;             CMOS_XPOINT_LOW,
   195            C        ;             CMOS_YPOINT_LOW,
   196            C        ;             CMOS_POINT_HIGH
   197            C        ;Description: Get CMOS Data
   198            C        ;***********************************************************
   199 01C5E      C        Get_CMOS_Data:                      ; Read CMOS Data
   200 01C5E 1E00 C        	BANK                0
   201 01C5F 080A C        	BC                  CMOS_SS/16,CMOS_SS%16
   202 01C60 10B0 C        	CALL                DELAY_X10US
   203 01C61 0000 C        	NOP
   204 01C62      C          Set_Read_Command:
   205 01C62 1837 C        	MOV                 A,@0X37
   206 01C63 1EA0 C        	LCALL               SIM_SPI_WRITE
   206 01C64 0D34 C        	LCALL               SIM_SPI_WRITE
   207 01C65 0000 C        	NOP
   208 01C66 1BFF C        	XOR                 A,@0XFF
   209 01C67 0C83 C        	JBC                 R3,2
   210 01C68 14A8 C        	JMP                 Read_Exit
   211            C        	
   212 01C69 10B0 C        	CALL                DELAY_X10US
   213 01C6A 1EA0 C        	LCALL               SIM_SPI_READ
   213 01C6B 0D3D C        	LCALL               SIM_SPI_READ
   214 01C6C 1E06 C        	BANK                6
   215 01C6D 0061 C        	MOV                 CMOS_X1_L,A
   216 01C6E 10B0 C        	CALL                DELAY_X10US
   217 01C6F 1EA0 C        	LCALL               SIM_SPI_READ
   217 01C70 0D3D C        	LCALL               SIM_SPI_READ
   218 01C71 1E06 C        	BANK                6
   219 01C72 0063 C        	MOV                 CMOS_Y1_L,A
   220 01C73 10B0 C        	CALL                DELAY_X10US
   221 01C74 1EA0 C        	LCALL               SIM_SPI_READ
   221 01C75 0D3D C        	LCALL               SIM_SPI_READ
   222 01C76 1E06 C        	BANK                6
   223 01C77 0064 C        	MOV                 CMOS_Size1,A
   224            C        
   225 01C78 10B0 C        	CALL                DELAY_X10US
   226 01C79      C        	CALL                SIM_SPI_READ
***     error A037:The operand value can not be calculated.
   227 01C7A 1E05 C        	BANK                5
   228 01C7B 0061 C        	MOV                 CMOS_X2_L,A
   229 01C7C 10B0 C        	CALL                DELAY_X10US
   230 01C7D      C        	CALL                SIM_SPI_READ
***     error A037:The operand value can not be calculated.
   231 01C7E 1E05 C        	BANK                5
   232 01C7F 0063 C        	MOV                 CMOS_Y2_L,A
   233 01C80 10B0 C        	CALL                DELAY_X10US
   234 01C81      C        	CALL                SIM_SPI_READ
***     error A037:The operand value can not be calculated.
   235 01C82 1E05 C        	BANK                5
   236 01C83 0064 C        	MOV                 CMOS_Size2,A
   237 01C84 1806 C        	MOV                 A,@0X06
   238 01C85 0040 C        	MOV                 Receive_CMOS_Count,A
***     error A010:The symbol RECEIVE_CMOS_COUNT is not defined.
   239 01C86      C          Read_Receive_CMOS:
   240 01C86 10B0 C        	CALL                DELAY_X10US
   241 01C87      C        	CALL                SIM_SPI_READ
***     error A037:The operand value can not be calculated.
   242 01C88 1E05 C        	BANK                5
   243 01C89 0040 C        	MOV                 Receive_CMOS_Data,A
***     error A010:The symbol RECEIVE_CMOS_DATA is not defined.
   244 01C8A 05C0 C        	DJZ                 Receive_CMOS_Count
***     error A010:The symbol RECEIVE_CMOS_COUNT is not defined.
   245 01C8B 1486 C        	JMP                 Read_Receive_CMOS
   246 01C8C 1E00 C        	BANK                0
   247 01C8D 0A00 C        	BS                  SPI_BUS,F_CMOS_SS
***     error A010:The symbol F_CMOS_SS is not defined.
***     error A010:The symbol SPI_BUS is not defined.
   248 01C8E 1E05 C        	BANK                5
   249 01C8F 0724 C        	SWAPA               CMOS_Size1
   250 01C90 1A0C C        	AND                 A,@0X0C
   251 01C91 0040 C        	MOV                 CMOS_Size_BAK,A
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   252 01C92 0803 C        	BC                  R3,0
   253 01C93 0640 C        	RRC                 CMOS_Size_BAK
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   254 01C94 0600 C        	RRCA                CMOS_Size_BAK
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   255 01C95 0062 C        	MOV                 CMOS_Y1_H,A
   256 01C96 0724 C        	SWAPA               CMOS_Size1
   257 01C97 1A03 C        	AND                 A,@0X03
   258 01C98 0060 C        	MOV                 CMOS_X1_H,A
   259 01C99 180F C        	MOV                 A,@0X0F
   260 01C9A 02E4 C        	AND                 CMOS_Size1,A
   261            C        
   262 01C9B 0724 C        	SWAPA               CMOS_Size2
   263 01C9C 1A0C C        	AND                 A,@0X0C
   264 01C9D 0040 C        	MOV                 CMOS_Size_BAK,A
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   265 01C9E 0803 C        	BC                  R3,0
   266 01C9F 0640 C        	RRC                 CMOS_Size_BAK
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   267 01CA0 0600 C        	RRCA                CMOS_Size_BAK
***     error A010:The symbol CMOS_SIZE_BAK is not defined.
   268 01CA1 0062 C        	MOV                 CMOS_Y2_H,A
   269 01CA2 0724 C        	SWAPA               CMOS_Size2
   270 01CA3 1A03 C        	AND                 A,@0X03
   271 01CA4 0060 C        	MOV                 CMOS_X2_H,A
   272 01CA5 180F C        	MOV                 A,@0X0F
   273 01CA6 02E4 C        	AND                 CMOS_Size2,A
   274 01CA7 1400 C        	JMP                 CMOS_Data_Handle
***     error A010:The symbol CMOS_DATA_HANDLE is not defined.
   275            C        	
   276            C        	
   277 01CA8      C          Read_Exit:
   278 01CA8 1E00 C        	BANK                0
   279 01CA9 0A0A C        	BS                  CMOS_SS/16,CMOS_SS%16
   280 01CAA 1E05 C        	BANK                5
   281 01CAB 08A1 C        	BC                  CMOSGetDataFlag/16,CMOSGetDataFlag%16
   282 01CAC 0000 C        	NOP
   283 01CAD 0000 C        	NOP
   284 01CAE 1421 C        	JMP                 EXIT_CMOS_FUNCTION
   285 01CAF 0000 C        	NOP
   286            C        
   287            C        
   288            C        
   289            C        ;***********************************************************
   290            C        ;input:       None
   291            C        ;output:      None
   292            C        ;Description: Delay About 10us
   293            C        ;***********************************************************
   294 01CB0      C        DELAY_X10US:
   295 01CB0 180F C        	MOV                 A,@0X0F
   296 01CB1 005B C        	MOV                 DataShiftCounter,A
   297 01CB2      C          X10US_DELAY_LOOP:
   298 01CB2 05DB C        	DJZ                 DataShiftCounter
   299 01CB3 14B2 C        	JMP                 X10US_DELAY_LOOP
   300 01CB4 0000 C        	NOP
   301 01CB5 0012 C        	RET
   302 01CB6 0000 C        	NOP
   303            C        
   304            C        
   305            C        endif
   306            C        
   307            C        
   308            C        
   309            C        
   310            C        
   311            C        
   312            C        
   313            C        
   314            C        
    21                     ;include "FccTest.asm"
    22                     
    23                     ;-----------------------------------------------------------------
    24                     
    25                     
    26                     
    27                     ;--------------------------MAIN PROGRAM---------------------------
    28                     	ORG                 0X00
    29 00000 1EB0          	LJMP                INITIAL
    29 00001 01A1          	LJMP                INITIAL
***     Warning A053:The lcall/ljmp address is not over page (1K).
    30                     	ORG                 0X03
    31 00003 1EB0          	LJMP                TCC_INT
    31 00004 0100          	LJMP                TCC_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    32                     	ORG                 0X06
    33 00006 1EB0          	LJMP                EXTERNAL_INT
    33 00007 0139          	LJMP                EXTERNAL_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    34                     	ORG                 0X09
    35 00009 1EB0          	LJMP                WDT_INT
    35 0000A 0156          	LJMP                WDT_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    36                     	ORG                 0X0C
    37 0000C 1EB0          	LJMP                TIMER1_INT
    37 0000D 0158          	LJMP                TIMER1_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    38                     	ORG                 0X0F
    39 0000F 1EB0          	LJMP                TIMER2_INT
    39 00010 0180          	LJMP                TIMER2_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    40                     	ORG                 0X12
    41 00012 1EB0          	LJMP                AD_INT
    41 00013 0157          	LJMP                AD_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    42                     	ORG                 0X15
    43 00015 1EB0          	LJMP                UART_INT
    43 00016 019E          	LJMP                UART_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    44                     	ORG                 0X18
    45 00018 1EB0          	LJMP                SPI_INT
    45 00019 019F          	LJMP                SPI_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    46                     	ORG                 0X1B
    47 0001B 1EB0          	LJMP                LVD_INT
    47 0001C 01A0          	LJMP                LVD_INT
***     Warning A053:The lcall/ljmp address is not over page (1K).
    48                     
    49                     
    50                     	ORG                 0X100
    51                     ;========================= TCC Interrupt Service ==================================
    52 00100               TCC_INT:
    53                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTCC_Temp,RSRTcc_TEMP
       00100 0054     1     MOV  A_TEMP ,A
       00101 0754     1     SWAP  A_TEMP ,
       00102 0703     1     SWAPA  3 ,
       00103 0056     1     MOV  STATUS_TEMP ,A
       00104 0705     1     SWAPA  5 ,
       00105 0055     1     MOV  RSR_TEMP ,A
       00106 00C3     1     CLR  3 ,
       00107 1E04     1     BANK @( 4 ),
       00108 0414     1     MOV A, A_TEMP 
       00109 0060     1     MOV  ATCC_TEMP ,A
       0010A 0416     1     MOV A, STATUS_TEMP 
       0010B 0062     1     MOV  STATUSTCC_TEMP ,A
       0010C 0415     1     MOV A, RSR_TEMP 
       0010D 0061     1     MOV  RSRTCC_TEMP ,A
    54 0010E 1E00          	BANK                0
    55 0010F 080F          	BC                  ISR,TCIF               ;clear TCC interrupt flag
    56 00110 0C1F          	JBC                 SearchStatusFlag/16,SearchStatusFlag%16
    57 00111 151A          	JMP                 Search_Status_Mode
    58 00112 0C9F          	JBC                 LoseFrameStatusFlag/16,LoseFrameStatusFlag%16
    59 00113 1525          	JMP                 LoseFrame_Status_Mode
    60 00114 0C5F          	JBC                 NormalStatusFlag/16,NormalStatusFlag%16
    61 00115 1517          	JMP                 Normal_Status_Mode
    62 00116 1528          	JMP                 TCC_INT_END
    63                     ;---------------------------------------------------------------------------
    64 00117               	Normal_Status_Mode:
    65                     		;MOV             A,@0x07                ; N=250,P=32,f=8MHz ==> T=1ms
    66                     		;MOV             TWTCR,A
    67 00117 18E0          		MOV             A,@(256-32)           ; load initial value
    68 00118 0041          		MOV             TCC,A
    69 00119 1528          		JMP             TCC_INT_END
    70                     ;-------------------------------------------------------------------
    71 0011A               	Search_Status_Mode:
    72                     		;MOV             A,@0X07                ; N=250,P=256,f=8MHz ==> T=8ms
    73                     		;MOV             TWTCR,A
    74 0011A 1806          		MOV             A,@(256-250)           ; load initial value
    75 0011B 0041          		MOV             TCC,A
    76 0011C 1E02          		BANK            2
    77 0011D 0575          		INC             KeySystemTimeCNT
    78 0011E 0435          		MOV             A,KeySystemTimeCNT
    79 0011F 1D01          		SUB             A,@1                   ; Control key scan clock
    80 00120 0C03          		JBC             STATUS,C
    81 00121 1528          		JMP             TCC_INT_END
    82 00122 0BDE          		BS              System16msFlag/16,System16msFlag%16
    83 00123 00F5          		CLR             KeySystemTimeCNT
    84                     		;BANK            0
    85                     		;MOV             A,@0B00100000          ; (test)P85 exchange when intrrupt
    86                     		;XOR             PORT8,A
    87 00124 1528          		JMP             TCC_INT_END
    88                     ;-------------------------------------------------------------------
    89 00125               	LoseFrame_Status_Mode:
    90                     		;MOV             A,@0x07                ; N=32,P=256,f=8MHz ==> T=1ms
    91                     		;MOV             TWTCR,A
    92 00125 18E0          		MOV             A,@(256-32)           ; load initial value
    93 00126 0041          		MOV             TCC,A
    94 00127 1528          		JMP             TCC_INT_END
    95 00128               TCC_INT_END:
    96 00128 1E00          	BANK                0
    97 00129 1820          	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    98 0012A 0348          	XOR                 PORT8,A	
    99 0012B 0557          	INC                 ComuClock
   100                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTcc_Temp,RSRTcc_TEMP
       0012C 1E04     1     BANK @( 4 ),
       0012D 0420     1     MOV A, ATCC_TEMP 
       0012E 0054     1     MOV  A_TEMP ,A
       0012F 0422     1     MOV A, STATUSTCC_TEMP 
       00130 0056     1     MOV  STATUS_TEMP ,A
       00131 0415     1     MOV A, RSR_TEMP 
       00132 0061     1     MOV  RSRTCC_TEMP ,A
       00133 0716     1     SWAPA  STATUS_TEMP ,
       00134 0043     1     MOV  3 ,A
       00135 0715     1     SWAPA  RSR_TEMP ,
       00136 0045     1     MOV  5 ,A
       00137 0714     1     SWAPA  A_TEMP ,
   101 00138 0013          	RETI
   102                     
   103 00139               EXTERNAL_INT:
   104                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,STATUSExt_Temp,RSRExt_Temp
       00139 0054     1     MOV  A_TEMP ,A
       0013A 0754     1     SWAP  A_TEMP ,
       0013B 0703     1     SWAPA  3 ,
       0013C 0056     1     MOV  STATUS_TEMP ,A
       0013D 0705     1     SWAPA  5 ,
       0013E 0055     1     MOV  RSR_TEMP ,A
       0013F 00C3     1     CLR  3 ,
       00140 1E04     1     BANK @( 4 ),
       00141 0414     1     MOV A, A_TEMP 
       00142 0063     1     MOV  AEXT_TEMP ,A
       00143 0416     1     MOV A, STATUS_TEMP 
       00144 0065     1     MOV  STATUSEXT_TEMP ,A
       00145 0415     1     MOV A, RSR_TEMP 
       00146 0064     1     MOV  RSREXT_TEMP ,A
   105 00147 1E01          	BANK                1
   106 00148 00CF          	CLR                 EISR               ;clear the external interrupt flag
   107                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,StatusExt_Temp,RSRExt_Temp
       00149 1E04     1     BANK @( 4 ),
       0014A 0423     1     MOV A, AEXT_TEMP 
       0014B 0054     1     MOV  A_TEMP ,A
       0014C 0425     1     MOV A, STATUSEXT_TEMP 
       0014D 0056     1     MOV  STATUS_TEMP ,A
       0014E 0415     1     MOV A, RSR_TEMP 
       0014F 0064     1     MOV  RSREXT_TEMP ,A
       00150 0716     1     SWAPA  STATUS_TEMP ,
       00151 0043     1     MOV  3 ,A
       00152 0715     1     SWAPA  RSR_TEMP ,
       00153 0045     1     MOV  5 ,A
       00154 0714     1     SWAPA  A_TEMP ,
   108 00155 0013          	RETI
   109                     
   110 00156               WDT_INT:
   111 00156 0013          	RETI
   112                     
   113 00157               AD_INT:
   114 00157 0013          	RETI
   115                     
   116 00158               TIMER1_INT:
   117                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,Status1_Temp,RSR1_Temp
       00158 0054     1     MOV  A_TEMP ,A
       00159 0754     1     SWAP  A_TEMP ,
       0015A 0703     1     SWAPA  3 ,
       0015B 0056     1     MOV  STATUS_TEMP ,A
       0015C 0705     1     SWAPA  5 ,
       0015D 0055     1     MOV  RSR_TEMP ,A
       0015E 00C3     1     CLR  3 ,
       0015F 1E04     1     BANK @( 4 ),
       00160 0414     1     MOV A, A_TEMP 
       00161 0066     1     MOV  A1_TEMP ,A
       00162 0416     1     MOV A, STATUS_TEMP 
       00163 0068     1     MOV  STATUS1_TEMP ,A
       00164 0415     1     MOV A, RSR_TEMP 
       00165 0067     1     MOV  RSR1_TEMP ,A
   118 00166 1E00          	BANK                0
   119 00167 09CF          	BC                  ISR,T1IF               ;clear Timer1 interrupt flag
   120                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   121                     	;XOR                 PORT8,A	
   122 00168 1E02          	BANK                2
   123 00169 18FF          	MOV                 A,@255           ; N=256, Auto reload
   124 0016A 0047          	MOV                 T1PD,A
   125 0016B 055C          	INC                 SleepCNT               ; 2s  at a time
   126 0016C 041C          	MOV                 A,SleepCNT
   127 0016D 1DC8          	SUB                 A,@SetSleepTime        ;
   128 0016E 0C03          	JBC                 STATUS,C
   129 0016F 1572          	JMP                 TIMER1_INT_END
   130 00170 0A5D          	BS                  IntoSleepFlag/16,IntoSleepFlag%16
   131                     	;BANK                0
   132                     	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   133                     	;XOR                 PORT8,A	
   134 00171 00DC          	CLR                 SleepCNT
   135 00172                 TIMER1_INT_END:
   136 00172 0000          	NOP
   137                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,STATUS1_Temp,RSR1_Temp
       00173 1E04     1     BANK @( 4 ),
       00174 0426     1     MOV A, A1_TEMP 
       00175 0054     1     MOV  A_TEMP ,A
       00176 0428     1     MOV A, STATUS1_TEMP 
       00177 0056     1     MOV  STATUS_TEMP ,A
       00178 0415     1     MOV A, RSR_TEMP 
       00179 0067     1     MOV  RSR1_TEMP ,A
       0017A 0716     1     SWAPA  STATUS_TEMP ,
       0017B 0043     1     MOV  3 ,A
       0017C 0715     1     SWAPA  RSR_TEMP ,
       0017D 0045     1     MOV  5 ,A
       0017E 0714     1     SWAPA  A_TEMP ,
   138 0017F 0013          	RETI
   139                     
   140 00180               TIMER2_INT:
   141                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
       00180 0054     1     MOV  A_TEMP ,A
       00181 0754     1     SWAP  A_TEMP ,
       00182 0703     1     SWAPA  3 ,
       00183 0056     1     MOV  STATUS_TEMP ,A
       00184 0705     1     SWAPA  5 ,
       00185 0055     1     MOV  RSR_TEMP ,A
       00186 00C3     1     CLR  3 ,
       00187 1E04     1     BANK @( 4 ),
       00188 0414     1     MOV A, A_TEMP 
       00189 0069     1     MOV  A2_TEMP ,A
       0018A 0416     1     MOV A, STATUS_TEMP 
       0018B 006B     1     MOV  STATUS2_TEMP ,A
       0018C 0415     1     MOV A, RSR_TEMP 
       0018D 006A     1     MOV  RSR2_TEMP ,A
   142 0018E 1E02          	BANK                2
   143 0018F 09C9          	BC                  T2CR,T2IF              ; clear Timer2 interrupt flag
   144 00190 0574          	INC                 IOcheckTimeCNT
   145                     	;BANK                0
   146                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
   147                     	;XOR                 PORT8,A	
   148                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
       00191 1E04     1     BANK @( 4 ),
       00192 0429     1     MOV A, A2_TEMP 
       00193 0054     1     MOV  A_TEMP ,A
       00194 042B     1     MOV A, STATUS2_TEMP 
       00195 0056     1     MOV  STATUS_TEMP ,A
       00196 0415     1     MOV A, RSR_TEMP 
       00197 006A     1     MOV  RSR2_TEMP ,A
       00198 0716     1     SWAPA  STATUS_TEMP ,
       00199 0043     1     MOV  3 ,A
       0019A 0715     1     SWAPA  RSR_TEMP ,
       0019B 0045     1     MOV  5 ,A
       0019C 0714     1     SWAPA  A_TEMP ,
   149 0019D 0013          	RETI
   150 0019E               UART_INT:
   151 0019E 0013          	RETI
   152 0019F               SPI_INT:
   153 0019F 0013          	RETI
   154 001A0               LVD_INT:
   155 001A0 0013          	RETI
   156                     ;=======================================================================
   157                     ;============================ Begin Program ============================
   158 001A1               INITIAL:
   159 001A1 0000          	NOP
   160 001A2 0000          	NOP
   161 001A3 0000          	NOP
   162 001A4 0000          	NOP
   163 001A5 0000          	NOP
   164 001A6 0000          	NOP
   165 001A7 0000          	NOP
   166 001A8 0000          	NOP
   167 001A9 0000          	NOP
   168 001AA 0011          	DISI
   169 001AB 0000          	NOP
   170 001AC 0000          	NOP
   171 001AD 0000          	NOP
   172 001AE 0011          	DISI
   173 001AF 0000          	NOP
   174 001B0 0000          	NOP
   175 001B1 0000          	NOP
   176 001B2 0011          	DISI
   177 001B3 0000          	NOP
   178 001B4 0004          	WDTC
   179                   M 	ClrCommRamBank
       001B5 1810     1     MOV A,@( 16 )
       001B6 0044     1     MOV  R4 ,A
       001B7          1    CLEAR_10_1F_RAM_LOOP:   
       001B7 0004     1     WDTC 
       001B8 00C0     1     CLR  R0 ,
       001B9 0544     1     INC  R4 ,
       001BA 183F     1     MOV A,@( 63 )
       001BB 0284     1     AND A, R4 
       001BC 1D1F     1     SUB A,@( 31 )
       001BD 0C03     1     JBC  R3 , C 
       001BE 15B7     1     JMP  CLEAR_10_1F_RAM_LOOP ,
       001BF 00C4     1     CLR  R4 ,
   180 001C0 0000          	NOP
   181                   M 	ClrRamBank
       001C1 18E0     1     MOV A,@( 224 )
       001C2 0044     1     MOV  R4 ,A
       001C3 00C5     1     CLR  BSR ,
       001C4 0004     1     WDTC 
       001C5 00C0     1     CLR  R0 ,
       001C6 0544     1     INC  R4 ,
       001C7 0404     1     MOV A, R4 
       001C8 1A3F     1     AND A,@( 63 )
       001C9 0E83     1     JBS  R3 , Z 
       001CA 15C5     1     JMP ( $ - 5 ),
       001CB 0545     1     INC  BSR ,
       001CC 0405     1     MOV A, BSR 
       001CD 1A07     1     AND A,@( 7 )
       001CE 0B44     1     BS  R4 , 5 
       001CF 0B84     1     BS  R4 , 6 
       001D0 0E83     1     JBS  R3 , 2 
       001D1 15C4     1     JMP ( $ - 13 ),
       001D2 00C4     1     CLR  R4 ,
       001D3 00C5     1     CLR  BSR ,
       001D4 0B84     1     BS  R4 , 6 
   182 001D5 0000          	NOP
   183 001D6 1266          	CALL                IO_INITIAL
   184 001D7 0000          	NOP
   185 001D8 1E00          	BANK                0
   186 001D9 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16      ; Disable 93C46
   187 001DA 0BCA          	BS                  SPI_SS/16,SPI_SS%16              ; Disable EM198810
   188 001DB 1EA0          	LCALL               EM198850_RESET
   188 001DC 0CBD          	LCALL               EM198850_RESET
   189 001DD 0000          	NOP
   190 001DE 0000          	NOP
   191                     
   192                     ;==============================================================================
   193 001DF 1EA0          	LCALL               IO_93C46_INITIAL    ; Set I/O
   193 001E0 101F          	LCALL               IO_93C46_INITIAL    ; Set I/O
   194 001E1 1E00          	BANK                0
   195 001E2 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16     ; Disable 93C46
   196 001E3 0BCA          	BS                  SPI_SS/16,SPI_SS%16             ; Disable EM198810
   197 001E4 1800          	MOV                 A,@0X00
   198 001E5 0055          	MOV                 DataAddressInEEPROM,A
   199 001E6 1860          	MOV                 A,@0X60
   200 001E7 0054          	MOV                 DataAddressInMCU,A
   201                   M 	mREAD               DataAddressInEEPROM,@0,DataAddressInMCU,@16
       001E8 1E00     1     BANK @( 0 ),
       001E9 0414     1     MOV A, DATAADDRESSINMCU 
       001EA 0044     1     MOV  R4 ,A
       001EB 1810     1     MOV A,@( 16 )
       001EC 0053     1     MOV  R_ACC3 ,A
       001ED          1    ??0028$WRITE_DATA:   
       001ED 1EA0     1     LCALL  START_BIT ,
       001EE 1000     1     LCALL  START_BIT ,
       001EF 0615     1     RRCA  DATAADDRESSINEEPROM ,
       001F0 1980     1     OR A,@( READ )
       001F1 0051     1     MOV  R_ACC1 ,A
       001F2 1808     1     MOV A,@( 8 )
       001F3 1EA0     1     LCALL  RL_COMD ,
       001F4 100E     1     LCALL  RL_COMD ,
       001F5 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001F6 0E15     1     JBS  DATAADDRESSINEEPROM , 0 
       001F7 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001F8 0C15     1     JBC  DATAADDRESSINEEPROM , 0 
       001F9 0B4A     1     BS ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001FA 15FB     1     JMP ( $ + 1 ),
       001FB 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       001FC 0555     1     INC  DATAADDRESSINEEPROM ,
       001FD 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
       001FE 15FF     1     JMP ( $ + 1 ),
       001FF 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00200 1601     1     JMP ( $ + 1 ),
       00201 1602     1     JMP ( $ + 1 ),
       00202 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00203          1    ??0028$READ_DATA1:   
       00203 1808     1     MOV A,@( 8 )
       00204 0052     1     MOV  R_ACC2 ,A
       00205          1    ??0028$READ_DATA2:   
       00205 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       00206 0000     1     NOP 
       00207 0000     1     NOP 
       00208 0D0A     1     JBC ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       00209 0A03     1     BS  STATUS , C 
       0020A 0F0A     1     JBS ( SPI_MISO / 16 ),( SPI_MISO % 16 )
       0020B 0803     1     BC  STATUS , C 
       0020C 06C0     1     RLC  R0 ,
       0020D 0B8A     1     BS ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0020E 160F     1     JMP ( $ + 1 ),
       0020F 05D2     1     DJZ  R_ACC2 ,
       00210 1605     1     JMP  ??0028$READ_DATA2 ,
       00211 0544     1     INC  R4 ,
       00212 0000     1     NOP 
       00213 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       00214 05D3     1     DJZ  R_ACC3 ,
       00215 15ED     1     JMP  ??0028$WRITE_DATA ,
   202                   M 	mEWDS
       00216 1EA0     1     LCALL  START_BIT ,
       00217 1000     1     LCALL  START_BIT ,
       00218 1800     1     MOV A,@( EWDS )
       00219 0051     1     MOV  R_ACC1 ,A
       0021A 1809     1     MOV A,@( 9 )
       0021B 1EA0     1     LCALL  RL_COMD ,
       0021C 100E     1     LCALL  RL_COMD ,
       0021D 08C7     1     BC ( AT93C46_CS / 16 ),( AT93C46_CS % 16 )
       0021E 098A     1     BC ( SPI_CLK / 16 ),( SPI_CLK % 16 )
       0021F 094A     1     BC ( SPI_MOSI / 16 ),( SPI_MOSI % 16 )
   203 00220 1EA0          	LCALL               IO_93C46_QUIT       ; Set I/O
   203 00221 102A          	LCALL               IO_93C46_QUIT       ; Set I/O
   204 00222 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16     ; Disable 93C46
   205 00223 0BCA          	BS                  SPI_SS/16,SPI_SS%16             ; Disable EM198810
   206                     
   207 00224 1E00          	BANK                0
   208 00225 0421          	MOV                 A,RX_IDH_Buffer     ; Read ID
   209 00226 1E01          	BANK                1
   210 00227 0061          	MOV                 RX_IDH,A
   211 00228 1E00          	BANK                0
   212 00229 0422          	MOV                 A,RX_IDL_Buffer
   213 0022A 1E01          	BANK                1
   214 0022B 0062          	MOV                 RX_IDL,A
   215 0022C 1E00          	BANK                0
   216 0022D 0426          	MOV                 A,TX_ID_Buffer
   217 0022E 1E01          	BANK                1
   218 0022F 0066          	MOV                 TX_ID,A
   219 00230 1E00          	BANK                0
   220 00231 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16        ; Disable 93C46
   221 00232 0BCA          	BS                  SPI_SS/16,SPI_SS%16                ; Disable EM198810
   222                     
   223 00233 1E01          	BANK                1
   224 00234 18FF          	MOV                 A,@0XFF             ; judge RX_ID,TX_ID
   225 00235 0321          	XOR                 A,RX_IDH
   226 00236 0C83          	JBC                 STATUS,Z
   227 00237 163D          	JMP                 Used_Default_Sync
   228 00238 18FF          	MOV                 A,@0XFF
   229 00239 0322          	XOR                 A,RX_IDL
   230 0023A 0C83          	JBC                 STATUS,Z
   231 0023B 163D          	JMP                 Used_Default_Sync
   232 0023C 1641          	JMP                 Start_Up
   233 0023D               Used_Default_Sync:
   234 0023D 1880          	MOV                 A,@0X80             ; SYNC ,used default 0X0DB3
   235 0023E 0061          	MOV                 RX_IDH,A
   236 0023F 1816          	MOV                 A,@0X16
   237 00240 0062          	MOV                 RX_IDL,A
   238                     
   239                     ;==============================================================================
   240 00241               Start_Up:
   241 00241 1EA0          	LCALL               CHANGE_ADDRESS_VALUE
   241 00242 0EB8          	LCALL               CHANGE_ADDRESS_VALUE
   242 00243 00F2          	CLR                 CH_NO
   243 00244 1EA0          	LCALL               RF_FREQ_SET
   243 00245 0EA3          	LCALL               RF_FREQ_SET
   244                     
   245 00246 0010          	ENI
   246 00247 1E00          	BANK                0
   247 00248 00D7          	CLR                 ComuClock
   248 00249 00D8          	CLR                 ComuCycleNum
   249 0024A 00D9          	CLR                 ComuEndNum
   250 0024B 0A48          	BS                  LED1_STATUS/16,LED1_STATUS%16		     ; PORT81,LED
   251 0024C 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16              ; Disable 93C46
   252 0024D 0BCA          	BS                  SPI_SS/16,SPI_SS%16                      ; Disable EM198810
   253                     
   254 0024E 00DC          	CLR                 SleepCNT
   255 0024F 00DF          	CLR                 CommuStatusFlag
   256 00250 00DD          	CLR                 GeneralStatusFlag1
   257 00251 00DE          	CLR                 GeneralStatusFlag2
   258 00252 00E3          	CLR                 CHN_FLAG
   259                     
   260 00253 1E02          	BANK                2
   261 00254 18FF          	MOV                 A,@0XFF
   262 00255 0076          	MOV                 KeystokeFlag_Befor,A
   263 00256 0077          	MOV                 KeystokeTimeCNT,A
   264                     ;-----------------------------------------------------------------
   265                     	;CALL                SearchLinkMode_Set
   266 00257 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   267 00258 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   268 00259 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   269 0025A 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   270 0025B 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   271 0025C 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   272 0025D 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16	
   273                     ;-----------------------------------------------------------------	
   274 0025E 0000          	NOP
   275                     
   276                     
   277                     ;=============================================================================
   278 0025F               MAIN:
   279                     /*
   280                     	LCALL               Search_Equipment
   281                     	BANK                0
   282                     	BC                  LED1_STATUS/16,LED1_STATUS%16
   283                     	LCALL               Normal_Communicate
   284                     */
   285 0025F 1E05          	BANK                5
   286 00260 1804          	MOV                 A,@0B00000100
   287 00261 0060          	MOV                 GS_PARAMETER,A	
   288 00262 1EA0          	LCALL               CmosSensor_Function
   288 00263 1C01          	LCALL               CmosSensor_Function
   289                     	;LCALL               Key_Scan
   290                     	;LCALL               IO_Rocker_KeyScan
   291 00264 0000          	NOP
   292 00265 165F          	JMP                 MAIN
   293                     
   294                     
   295                     ;*****************************************************************
   296                     ;Function:    IO INITIAL SET
   297                     ;Input:       None
   298                     ;Output:      None
   299                     ;*****************************************************************
   300 00266               IO_INITIAL:
   301                     ;============================ TCC config ====================================
   302 00266 1E00          	BANK                0
   303 00267 1807          	MOV                 A,@0X07         ; N=250,P=256,f=8MHz ==> T=8ms
   304 00268 004D          	MOV                 TWTCR,A
   305 00269 1806          	MOV                 A,@(256-250)    ; load initial value
   306 0026A 0041          	MOV                 TCC,A
   307 0026B 0A0E          	BS                  IMR,TCIE        ;set   TCIE=1  tcc enable interrupt
   308 0026C 00CF          	CLR                 ISR             ;clear interrupt flag
   309 0026D 1E01          	BANK                1
   310 0026E 00CF          	CLR                 EISR            	;Clear External Interrupt Status Register
   311 0026F 00CE          	CLR                 EIMR            	;Clear External Interrupt Mask  Register
   312                     
   313                     ;============================ Timer 1 config ===================================
   314 00270 1E00          	BANK                0
   315 00271 0BCE          	BS                  IMR,T1IE         ; Enable Timier1
   316 00272 09CF          	BC                  ISR,T1IF         ; Clear timer1 intrrupt flag
   317 00273 1E02          	BANK                2
   318 00274 1807          	MOV                 A,@0B00000111    ; N=256, P=256, T=2s
   319 00275 0045          	MOV                 T1CR,A
   320 00276 18FF          	MOV                 A,@255           ; N=256, Auto reload
   321 00277 0047          	MOV                 T1PD,A
   322 00278 1814          	MOV                 A,@0B00010100    ; 8 bit counter ,f=32.768KHz
   323 00279 0046          	MOV                 TSR,A
   324 0027A 0A85          	BS                  T1CR,T1EN
   325                     
   326                     ;============================ Timer 2 config ===================================
   327 0027B 1E00          	BANK                0
   328 0027C 0B89          	BS                  T2CR,T2IE        ; Enable Timier2
   329 0027D 09C9          	BC                  T2CR,T2IF        ; Clear timer1 intrrupt flag
   330 0027E 1E02          	BANK                2
   331 0027F 1840          	MOV                 A,@0B01000000    ; N=25, P=2, T=50us
   332 00280 0249          	OR                  T2CR,A
   333 00281 1832          	MOV                 A,@50            ; N=25, Auto reload
   334 00282 004A          	MOV                 T2PD,A
   335 00283 08C6          	BC                  TSR,T2CSS       ; Set Timer2 Clock Source(Fm)
   336 00284 09C6          	BC                  TSR,T1MOD       ; Set 8 Bit Timer
   337 00285 0949          	BC                  T2CR,T2EN       ; Disable
   338                     
   339                     ;==============================PORT A/B======================================
   340 00286 1E04          	BANK                4		        ; Power On Disable PA PB Pull High
   341 00287 1810          	MOV                 A,@00010000B	; Set PA4 (MISO) as input pin
   342 00288 004A          	MOV                 PAIOCR,A       ; SO,SCK output pin
   343 00289 1810          	MOV                 A,@00010000B    ; PA4 PULL HIGH
   344 0028A 004A          	MOV                 PAPHCR,A
   345 0028B 1837          	MOV                 A,@00110111B	; PB0 PB1 PB2 PB4 PB5 PB1AS INPUT
   346 0028C 004B          	MOV                 PBIOCR,A       	; PKT FIFO Output Pin
   347 0028D 1E05          	BANK                5
   348 0028E 1837          	MOV                 A,@00110111B
   349 0028F 004B          	MOV                 PBPHCR,A	    	;PB0 PB2 Enable Pull High
   350 00290 1E00          	BANK                0
   351 00291 00CA          	CLR                 PORTA           ; PortA output logic "0"
   352                     	;CLR                 PORTB           ; PortB output logic "0"
   353                     ;---------------------------------------------------------
   354 00292 1E02          	BANK                2
   355 00293 1800          	MOV                 A,@00000000B   ; Shift left, SDO delay time: 16clk,
   356 00294 004C          	MOV                 SPIS, A        ; disable open-drain
   357 00295 18C9          	MOV                 A,@11001001B   ; Data shift out rising edge, is on hold during low
   358 00296 004D          	MOV                 SPIC,A         ; Enable SPI mode, after data output SDO remain low
   359                                                            ; SPI Baud Rate: 001->Fosc/4
   360                     ;==========================PORT 7/8/9 INITIAL===============================
   361 00297 1E04           	BANK                4
   362 00298 18F0           	MOV                 A,@11110000B
   363 00299 0049           	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Ouput
   364 0029A 1800           	MOV                 A,@00000000B
   365 0029B 0047           	MOV                 IOC7,A          ;Set Output
   366 0029C 1800           	MOV                 A,@00000000B
   367 0029D 0048           	MOV                 IOC8,A          ;Set Output
   368 0029E 1E05           	BANK                5
   369 0029F 18F0           	MOV                 A,@11110000B
   370 002A0 0049           	MOV                 P9PHCR,A		;SET PULL UP
   371 002A1 1E06           	BANK                6
   372 002A2 00C7           	CLR                 P7ODCR          ;Disable Open Drain
   373 002A3 00C8           	CLR                 P8ODCR
   374 002A4 00C9           	CLR                 P9ODCR 	
   375 002A5 1E01           	BANK                1
   376 002A6 1800           	MOV                 A,@00000000B	;Disable LCD common dirver pin
   377 002A7 02CA           	AND                 LCDSCR0,A
   378 002A8 02CB           	AND                 LCDSCR1,A
   379 002A9 02CC           	AND                 LCDSCR2,A
   380 002AA 1E00          	BANK                0
   381 002AB 00C7          	CLR                 PORT7           ; Port7 output logic "0"
   382 002AC 00C8          	CLR                 PORT8           ; Port8 output logic "0"
   383                     	;CLR                 PORT9           ; Port9 output logic "0"
   384 002AD 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   385 002AE 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   386 002AF 0012          	RET
   387                     
   388                     ;*****************************************************************
   389                     ;Function:    MCU SLEEP SET
   390                     ;Input:       None
   391                     ;Output:      None
   392                     ;*****************************************************************
   393 002B0               MCU_EnterSleep_Set:
   394 002B0 1E00          	BANK                0
   395 002B1 00CE          	CLR                 IMR               ;Disable Timier1/TCC
   396 002B2 00CF          	CLR                 ISR
   397 002B3 1E03          	BANK                3
   398 002B4 00CE          	CLR                 EIESH             ;SET Falling Edge
   399 002B5 1E01          	BANK                1
   400 002B6 1860          	MOV                 A,@0B01100000     ;Enable EX6(PB2)/EX5(PB1) Interrupt
   401 002B7 004E          	MOV                 EIMR,A
   402 002B8 00CF          	CLR                 EISR
   403 002B9 1E04          	BANK                4
   404 002BA 1860          	MOV                 A,@0B01100000
   405 002BB 004F          	MOV                 WKCR,A            ;enable EX6(PB2)/EX5(PB1) wake up
   406 002BC 08CC          	BC                  SCCR,IDLE         ;Set IDLE=0(SLEEP MODE)
   407 002BD 1E00          	BANK                0
   408 002BE 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   409 002BF 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   410 002C0 0000          	NOP
   411 002C1 0012          	RET
   412                     
   413                     ;*****************************************************************
   414                     ;Function:    MCU wakeup SET
   415                     ;Input:       None
   416                     ;Output:      None
   417                     ;*****************************************************************
   418 002C2               MCU_WakeUp_Set:
   419 002C2 1E03          	BANK                3
   420 002C3 00CE          	CLR                 EIESH             ; SET Falling Edge
   421 002C4 1E01          	BANK                1
   422 002C5 1800          	MOV                 A,@0B00000000     ; Disable EX6(PB2)/EX5(PB1) Interrupt
   423 002C6 004E          	MOV                 EIMR,A
   424 002C7 00CF          	CLR                 EISR
   425 002C8 1E04          	BANK                4
   426 002C9 1800          	MOV                 A,@0B00000000
   427 002CA 004F          	MOV                 WKCR,A            ; Disable EX6(PB2)/EX5(PB1) wake up
   428 002CB 0000          	NOP
   429 002CC 1E00          	BANK                0
   430 002CD 1881          	MOV                 A,@0B10000001
   431 002CE 004E          	MOV                 IMR,A             ; Enable Timier1/TCC
   432 002CF 00CF          	CLR                 ISR	
   433 002D0 08C7          	BC                  AT93C46_CS/16,AT93C46_CS%16   ; Disable 93C46
   434 002D1 0BCA          	BS                  SPI_SS/16,SPI_SS%16           ; disable EM198810
   435 002D2 0012          	RET
   436                     
   437                     ;*****************************************************************
   438                     ;Function:    mode select
   439                     ;Input:
   440                     ;Output:      None
   441                     ;desciption:  set timing and select mode
   442                     ;*****************************************************************
   443 002D3               SearchLinkMode_Set:         ;0X11
   444 002D3 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   445 002D4 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   446 002D5 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   447 002D6 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   448 002D7 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   449 002D8 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   450 002D9 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   451 002DA 0012          	RET
   452                     
   453 002DB               SearchForceLinkMode_Set:    ;0X24
   454 002DB 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   455 002DC 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   456 002DD 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   457 002DE 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   458 002DF 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   459 002E0 0B5F          	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   460 002E1 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   461 002E2 0012          	RET
   462                     
   463 002E3               NormalLinkMode_Set:         ;0X12
   464 002E3 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   465 002E4 0A5F          	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   466 002E5 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   467 002E6 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   468 002E7 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   469 002E8 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   470 002E9 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   471 002EA 0012          	RET
   472                     
   473 002EB               LoseFrameLinkMode_Set:      ;0X16
   474 002EB 081F          	BC                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   475 002EC 0A5F          	BS                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   476 002ED 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   477 002EE 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   478 002EF 0B1F          	BS                  LinkModeFlag/16,LinkModeFlag%16
   479 002F0 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   480 002F1 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   481 002F2 0012          	RET
   482                     
   483 002F3               LoseFrameForceLinkMode_Set: ;0X25
   484 002F3 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;Clear search status
   485 002F4 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;set normal mode
   486 002F5 0A9F          	BS                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   487 002F6 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   488 002F7 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   489 002F8 0B5F          	BS                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   490 002F9 099F          	BC                  FccTestModeFlag/16,FccTestModeFlag%16
   491 002FA 0012          	RET
   492                     
   493 002FB               FccSearchLinkMode_Set:      ;0X41
   494 002FB 0A1F          	BS                  SearchStatusFlag/16,SearchStatusFlag%16            ;set search mode
   495 002FC 085F          	BC                  NormalStatusFlag/16,NormalStatusFlag%16            ;Clear normal mode
   496 002FD 089F          	BC                  LoseFrameStatusFlag/16,LoseFrameStatusFlag%16      ;Clear LoseFreq mode
   497 002FE 08DF          	BC                  EEpromWRStatusFlag/16,EEpromWRStatusFlag%16
   498 002FF 091F          	BC                  LinkModeFlag/16,LinkModeFlag%16
   499 00300 095F          	BC                  ForceLinkModeFlag/16,ForceLinkModeFlag%16
   500 00301 0B9F          	BS                  FccTestModeFlag/16,FccTestModeFlag%16
   501 00302 0012          	RET
   502                     
   503                     
  16 Error(s), 10 Warning(s), 2 User Message(s)