     1                     /*****************************************************************
     2                     * Filename     :  P520KSP44.ASM
     3                     * Author       :  yu.wei
     4                     * Company      :  ELAN
     5                     * VERSION      :  1.1
     6                     * CRYSTAL      :  8MHZ
     7                     * Creat date   :  2009/11/4
     8                     * tool ver.    :  WicePlus 2.7/eUIDE v1.01.01
     9                     * Description  :  modify for code conformity
    10                     *****************************************************************/
    11                     ;-----------------------------------------------------------------
    12                     include "D:\include\EM78xx\inc\EM78P520.H"
     1            C        ;******************************************************;
     2            C        ;                                                      ;
     3            C        ;  Tilte:       EM78x510xx include file                ;
     4            C        ;  Description: The Definition of EM78x510xx Registers ;
     5            C        ;  Company:     Elan Electronic Corp.                  ;
     6            C        ;  Author:      hongxi.tang                            ;
     7            C        ;  Date:        24/05/2006                             ;
     8            C        ;  Version:     v1.0                                   ;
     9            C        ;                                                      ;
    10            C        ;******************************************************;
    11            C        ;
    12            C        ;======================================================;
    13            C        ; Operational Registers Define                         ;
    14            C        ;======================================================;
    15            C        EM78P510.H    EQU    EM78P510.H
    16            C        EM78P520.H    EQU    EM78P520.H
    17            C        
    18            C        ;
    19            C        ;======================================================;
    20            C        ; Register R0~R4                                       ;
    21            C        ;======================================================;
    22            C        ;
    23            C        ; Indirect Addressing register
    24            C        ;
    25       0000 C         R0     ==    0x00
    26       0000 C         IAR    ==    0x00
    27            C        ;
    28            C        ; Time Clock/Counter
    29            C        ;
    30       0001 C         R1     ==    0x01
    31       0001 C         TCC    ==    0x01    ; TCC Counter Preset
    32            C        ;
    33            C        ; Program Counter
    34            C        ;
    35       0002 C         R2     ==    0X02
    36       0002 C         PC     ==    0X02
    37            C        ;
    38            C        ; Status Register and Voltage Detect
    39            C        ;
    40       0003 C         R3    ==    0X03
    41       0003 C         SR    ==    0X03
    42       0003 C         STATUS	==	0x03
    43            C        ;
    44            C             ;{
    45       0007 C             	 LVDEN	==    0x07    ; Voltage Detect Enable Bit
    46       0006 C                 LVDS1	==    0x06    ; Detect Voltage Select Bit[1]
    47       0005 C                 LVDS0	==    0x05    ; Detect Voltage Select Bit[0]
    48            C                                       ;
    49            C                                       ; |-------|-------|----------------|
    50            C                                       ; | LVDS1 | LVDS0 | Detect Voltage |
    51            C                                       ; |-------|-------|----------------|
    52            C                                       ; |   0   |   0   |      2.4V      |
    53            C                                       ; |   0   |   1   |      2.7V      |
    54            C                                       ; |   1   |   0   |      3.3V      |
    55            C                                       ; |   1   |   1   |      3.9V      |
    56            C                                       ; |-------|-------|----------------|
    57            C                                       ;
    58       0004 C                 T       ==    0x04    ; Time-Out Bit
    59       0003 C                 P       ==    0x03    ; Power Down Bit
    60       0002 C                 Z       ==    0x02    ; Zero Flag
    61       0001 C                 DC      ==    0x01    ; Auxiliary Carry Flag
    62       0000 C                 C       ==    0x00    ; Carry Flag
    63            C                                       ;
    64            C             ;}
    65            C        ;
    66            C        ; RAM Select Register (RSR)
    67            C        ;
    68       0004 C         R4     ==    0X04
    69       0004 C         RSR    ==    0X04
    70            C             ;{
    71            C                                        ; Bits 5~0 are used to select up to 64 registers in the
    72            C                                        ; indirect addressing mode.
    73            C                                        ;
    74       0007 C                 VDB	  ==    0x07    ; Voltage Detector
    75       0006 C                 BNC      ==    0x06    ; Bank Control Register
    76            C                                        ;
    77       0005 C                 RSR5     ==    0x05    ;
    78       0004 C                 RSR4     ==    0x04    ;
    79       0003 C                 RSR3     ==    0x03    ;
    80       0002 C                 RSR2     ==    0x02    ;
    81       0001 C                 RSR1     ==    0x01    ;
    82       0000 C                 RSR0     ==    0x00    ;
    83            C                                        ;
    84            C             ;}
    85            C        ;======================================================;
    86            C        ; Bank0~6 Register R5~RF                               ;
    87            C        ;======================================================;
    88            C        ;
    89            C        ; Bank0 R5(RAM Bank Select Register)
    90            C        ;
    91       0005 C         B0_R5    ==	0X05
    92       0005 C         BSR      ==    0X05
    93            C        ;
    94            C             ;{
    95            C             				    ; Bit3~7 is "0"
    96       0002 C                 BS2          ==    0x02    ; RAM Bank Select Register Bits[2]
    97       0001 C                 BS1          ==    0x01    ; RAM Bank Select Register Bits[1]
    98       0000 C                 BS0          ==    0x00    ; RAM Bank Select Register Bits[0]
    99            C             ;}
   100            C        ;
   101            C        ; Bank 0 R6(Program Page Select Register)
   102            C        ;
   103       0006 C         B0_R6    ==    0X06
   104       0006 C         PSR      ==    0X06
   105            C        ;
   106            C             ;{
   107            C             			       ; Bit3~7 is "0"
   108       0002 C                 PS2     ==    0x02    ; Program Page Select Register Bits[2]
   109       0001 C                 PS1     ==    0x01    ; Program Page Select Register Bits[1]
   110       0000 C                 PS0     ==    0x00    ; Program Page Select Register Bits[0]
   111            C             ;}
   112            C        ;
   113            C        ; Bank0 R7(Port 7 data Register)
   114            C        ;
   115       0007 C         B0_R7    ==    0X07
   116       0007 C         PORT7    ==    0X07
   117            C        ;
   118            C             ;{
   119       0007 C                 R77     ==    0x07    ; I/O data of P7.7
   120       0006 C                 R76     ==    0x06    ; I/O data of P7.6
   121       0005 C                 R75     ==    0x05    ; I/O data of P7.5
   122       0004 C                 R74     ==    0x04    ; I/O data of P7.4
   123       0003 C                 R73     ==    0x03    ; I/O data of P7.3
   124       0002 C                 R72     ==    0x02    ; I/O data of P7.2
   125       0001 C                 R71     ==    0x01    ; I/O data of P7.1
   126       0000 C                 R70     ==    0x00    ; I/O data of P7.0
   127            C             ;}
   128            C        ;
   129            C        ; Bank0 R8(Port 8 data Register)
   130            C        ;
   131       0008 C         B0_R8    ==    0X08
   132       0008 C         PORT8    ==    0X08
   133            C        ;
   134            C             ;{
   135       0007 C                 R87     ==    0x07    ; I/O data of P8.7
   136       0006 C                 R86     ==    0x06    ; I/O data of P8.6
   137       0005 C                 R85     ==    0x05    ; I/O data of P8.5
   138       0004 C                 R84     ==    0x04    ; I/O data of P8.4
   139       0003 C                 R83     ==    0x03    ; I/O data of P8.3
   140       0002 C                 R82     ==    0x02    ; I/O data of P8.2
   141       0001 C                 R81     ==    0x01    ; I/O data of P8.1
   142       0000 C                 R80     ==    0x00    ; I/O data of P8.0
   143            C             ;}
   144            C        ;
   145            C        ; Bank0 R9(PORT 9 Data Register)
   146            C        ;
   147       0009 C         B0_R9    ==    0X09
   148       0009 C         PORT9    ==    0X09
   149            C        ;
   150            C             ;{
   151       0007 C                 R97     ==    0x07    ; I/O data of P9.7
   152       0006 C                 R96     ==    0x06    ; I/O data of P9.6
   153       0005 C                 R95     ==    0x05    ; I/O data of P9.5
   154       0004 C                 R94     ==    0x04    ; I/O data of P9.4
   155       0003 C                 R93     ==    0x03    ; I/O data of P9.3
   156       0002 C                 R92     ==    0x02    ; I/O data of P9.2
   157       0001 C                 R91     ==    0x01    ; I/O data of P9.1
   158       0000 C                 R90     ==    0X00    ; I/O data of P9.0
   159            C             ;}
   160            C        ;
   161            C        ;  Bank0 RA(PORTA Data Register)
   162            C        ;
   163       000A C         B0_RA	  ==	0X0A
   164       000A C         PORTA	  ==	0X0A
   165            C        ;
   166            C        	;{
   167       0007 C        		RA7	==	0X07	; I/O Data of PA.7
   168       0006 C        		RA6	==	0X06 	; I/O Data of PA.6
   169       0005 C        		RA5	==	0X05	; I/O Data of PA.5
   170       0004 C        		RA4	==	0X04	; I/O Data of PA.4
   171       0003 C        		RA3	==	0X03	; I/O Data of PA.3
   172       0002 C        		RA2	==	0X02	; I/O Data of PA.2
   173       0001 C        		RA1	==	0X01	; I/O Data of PA.1
   174       0000 C        		RA0	==	0X00	; I/O Data of PA.0
   175            C        	;}
   176            C        ;
   177            C        ;  Bank0 RB(PORT8 Data Register)
   178            C        ;
   179       000B C         B0_RB	==	0X0B
   180       000B C         PORTB	==	0X0B
   181            C        ;
   182            C        	;{
   183       0007 C        		RB7	==	0X07	; I/O Data of PB.7
   184       0006 C        		RB6	==	0X06 	; I/O Data of PB.6
   185       0005 C        		RB5	==	0X05	; I/O Data of PB.5
   186       0004 C        		RB4	==	0X04	; I/O Data of PB.4
   187       0003 C        		RB3	==	0X03	; I/O Data of PB.3
   188       0002 C        		RB2	==	0X02	; I/O Data of PB.2
   189       0001 C        		RB1	==	0X01	; I/O Data of PB.1
   190       0000 C        		RB0	==	0X00	; I/O Data of PB.0
   191            C        	;}
   192            C        ;
   193            C        ;  Bank0 RC(System Clock Control Register)
   194            C        ;
   195       000C C         B0_RC	==	0X0C
   196       000C C         SCCR	==	0X0C
   197            C        ;
   198            C        	;{
   199            C        				 ; Bit7 is "0"
   200       0006 C        		CLK2	==  0X06 ;
   201       0005 C        		CLK1	==  0X05 ;
   202       0004 C        		CLK0	==  0X04 ; Main Clock Select Bit for PLL Mode
   203            C        				 ; |------|------|------|------------|---------------|
   204            C        				 ; | CLK2 | CLK1 | CLK0 | Main Clock | Ex:Fs=32.768k |
   205            C        				 ; |------|------|------|------------|---------------|
   206            C        				 ; |  0   |  0   |  0   |   Fs*122   |   3.997 MHz   |
   207            C        				 ; |------|------|------|------------|---------------|
   208            C        				 ; |  0   |  0   |  1   |    Fs*61   |   1.998 MHz   |
   209            C        				 ; |------|------|------|------------|---------------|
   210            C        				 ; |  0   |  1   |  0   |   Fs*61/2  |   0.999 MHz   |
   211            C        				 ; |------|------|------|------------|---------------|
   212            C        				 ; |  0   |  1   |  1   |   Fs*61/4  |   499.7 kHz   |
   213            C        				 ; |------|------|------|------------|---------------|
   214            C        				 ; |  1   |  0   |  0   |   Fs*244   |   7.995 MHz   |
   215            C        				 ; |------|------|------|------------|---------------|
   216            C        				 ; |  1   |  0   |  1   |   Fs*366   |   11.99 MHz   |
   217            C        				 ; |------|------|------|------------|---------------|
   218            C        				 ; |  1   |  1   |  X   |   Fs*488   |   15.99 MHz   |
   219            C        				 ; |------|------|------|------------|---------------|
   220       0003 C        		IDLE	==  0X03 ; Idle Mode Enable Bit.
   221            C        		 		 ; IDLE="0"+SLEP instruction=>sleep mode
   222            C        		 		 ; IDLE="1"+SLEP instruction=>idle mode
   223       0002 C        		BF1	==  0x02 ;
   224       0001 C        		BF0	==  0x01 ; LCD Booster Frequency Select Bit.
   225            C        				 ; |-----|-----|-------------------|
   226            C        				 ; | BF1 | BF0 | Booster frequency |
   227            C        				 ; |-----|-----|-------------------|
   228            C        				 ; |  0  |  0  |        Fs         |
   229            C        				 ; |-----|-----|-------------------|
   230            C        				 ; |  0  |  1  |       Fs/4        |
   231            C        				 ; |-----|-----|-------------------|
   232            C        				 ; |  1  |  0  |       Fs/8        |
   233            C        				 ; |-----|-----|-------------------|
   234            C        				 ; |  1  |  1  |       Fs/16       |
   235            C        				 ; |-----|-----|-------------------|
   236       0000 C        		CPUS	==  0x00 ; CPU Oscillator Source Select.
   237            C        				 ; 0/1=>sub-oscillator(fs)/main oscillator(fm)
   238            C        	;}
   239            C        ;
   240            C        ; Bank0 RD(TCC and WDT Timer control register)
   241            C        ;
   242       000D C         B0_RD	==	0X0D
   243       000D C         TWTCR	==	0X0D
   244            C        ;
   245            C        	;{
   246       0007 C        		WDTE	==  0X07 ; Watchdog Timer Enable.0/1=>disable/enable
   247       0006 C        		WPSR2	==  0X06
   248       0005 C        		WPSR1	==  0X05
   249       0004 C        		WPSR0	==  0X04 ; WDT Prescaler Bits
   250            C        				 ; |-----|-----|-----|-----------|
   251            C        				 ; |WPSR2|WPSR1|WPSR0| Prescaler |
   252            C        				 ; |-----|-----|-----|-----------|
   253            C        				 ; |  0  |  0  |  0  |    1:1    |
   254            C        				 ; |-----|-----|-----|-----------|
   255            C        				 ; |  0  |  0  |  1  |    1:2    |
   256            C        				 ; |-----|-----|-----|-----------|
   257            C        				 ; |  0  |  1  |  0  |    1:4    |
   258            C        				 ; |-----|-----|-----|-----------|
   259            C        				 ; |  0  |  1  |  1  |    1:8    |
   260            C        				 ; |-----|-----|-----|-----------|
   261            C        				 ; |  1  |  0  |  0  |   1:16    |
   262            C        				 ; |-----|-----|-----|-----------|
   263            C        				 ; |  1  |  0  |  1  |   1:32    |
   264            C        				 ; |-----|-----|-----|-----------|
   265            C        				 ; |  1  |  1  |  0  |   1:64    |
   266            C        				 ; |-----|-----|-----|-----------|
   267            C        				 ; |  1  |  1  |  1  |   1:128   |
   268            C        				 ; |-----|-----|-----|-----------|
   269       0003 C        		TCCS	==  0x03 ; TCC Clock Source Select Bit.0/1=>Fm/Fs
   270       0002 C        		TPSR2	==  0x02
   271       0001 C        		TPSR1	==  0X01
   272       0000 C        		TPSR0	==  0X00 ; TCC Prescaler Bits
   273            C        				 ; |-----|-----|-----|-----------|
   274            C        				 ; |TPSR2|TPSR1|TPSR0| Prescaler |
   275            C        				 ; |-----|-----|-----|-----------|
   276            C        				 ; |  0  |  0  |  0  |    1:2    |
   277            C        				 ; |-----|-----|-----|-----------|
   278            C        				 ; |  0  |  0  |  1  |    1:4    |
   279            C        				 ; |-----|-----|-----|-----------|
   280            C        				 ; |  0  |  1  |  0  |    1:8    |
   281            C        				 ; |-----|-----|-----|-----------|
   282            C        				 ; |  0  |  1  |  1  |   1:16    |
   283            C        				 ; |-----|-----|-----|-----------|
   284            C        				 ; |  1  |  0  |  0  |   1:32    |
   285            C        				 ; |-----|-----|-----|-----------|
   286            C        				 ; |  1  |  0  |  1  |   1:64    |
   287            C        				 ; |-----|-----|-----|-----------|
   288            C        				 ; |  1  |  1  |  0  |   1:128   |
   289            C        				 ; |-----|-----|-----|-----------|
   290            C        				 ; |  1  |  1  |  1  |   1:256   |
   291            C        				 ; |-----|-----|-----|-----------|
   292            C        	;}
   293            C        ;
   294            C        ; Bank0 RE (Interrupt Mask Register)
   295            C        ;
   296       000E C         B0_RE	==	0X0E
   297       000E C         RE	==	0X0E							;ADD
   298       000E C         IMR	==	0X0E
   299            C        ;
   300            C        	;{
   301       0007 C        		T1IE	==  0X07 ; Timer1 Interrupt Enable Bit
   302       0006 C        		LVDIE   ==  0X06 ; low Voltage Detect Interrupt Enable Bit
   303       0005 C        		ADIE	==  0X05 ; A/D convert Interrupt Enable Bit
   304       0004 C        		SPIE    ==  0X04 ; SPI transfer Interrupt Enable Bit
   305       0003 C        		URTIE	==  0X03 ; UART transmit Interrupt Enable Bit
   306       0002 C        		EXIE9	==  0X02 ; External interrupt 9 Enable Bit
   307       0001 C        		EXIE8	==  0X01 ; External interrupt 8 Enable Bit
   308       0000 C        		TCIE	==  0X00 ; TCC Overflow Interrupt Enable Bit
   309            C        	;}
   310            C        ;
   311            C        ;  Bank0 RF (Interrupt Status Register)
   312            C        ;
   313       000F C         B0_RF	==	0X0F
   314       000F C         RF     ==  0x0F
   315       000F C         ISR	==	0X0F
   316            C        ;
   317            C        	;{
   318       0007 C        		T1IF	==  0X07 ; interrupt flag of timer1 interrupt
   319       0006 C        		LVDIF	==  0X06 ; interrupt flag of low voltage detector interrupt
   320       0005 C        		ADIF	==  0X05 ; interrupt flag of A/D convert Complete
   321       0004 C        		SPIF	==  0X04 ; interrupt flag of SPI transfer complete
   322       0003 C        		URTIF	==  0X03 ; interrupt flag of UART transfer complete
   323       0002 C        		EXIF9	==  0X02 ; interrupt flag of external interrupt 9 Occur.
   324       0001 C        		EXIF8	==  0X01 ; interrupt flag of external interrupt 8 Occur.
   325       0000 C        		TCIF	==  0X00 ; interrupt flag of TCC Overflow
   326            C        	;}
   327            C        ;
   328            C        ;  Bank1 R5 (LCD Control Register)
   329            C        ;
   330       0005 C         B1_R5	==	0X05
   331       0005 C         LCDCR	==	0X05
   332            C        ;
   333            C        	;{
   334       0007 C        		LCDEN	==  0X07 ; lCD Enable Select Bit.0/1=>disable/enable
   335       0006 C        		LCDTYPE	==  0X06 ; LCD Drive Waveform Type Select Bit
   336       0005 C        		LBS1	==  0x05
   337       0004 C        		LBS0	==  0x04 ; LCD Bias Select Bits
   338            C        				 ; |---|---|---------------|
   339            C        				 ; |BS1|BS0|LCD Bias Select|
   340            C        				 ; |---|---|---------------|
   341            C        				 ; | 0 | 0 |   1/2 Bias    |
   342            C        				 ; |---|---|---------------|
   343            C        				 ; | 0 | 1 |   1/3 Bias    |
   344            C        				 ; |---|---|---------------|
   345            C        				 ; | 1 | X |   1/4 Bias    |
   346            C        				 ; |---|---|---------------|
   347       0003 C        		DS1	==  0x03
   348       0002 C        		DS0	==  0x02 ; LCD Duty Select Bits
   349            C        				 ; |---|---|---------------|
   350            C        				 ; |DS1|DS0|LCD Duty Select|
   351            C        				 ; |---|---|---------------|
   352            C        				 ; | 0 | 0 |    Static     |
   353            C        				 ; |---|---|---------------|
   354            C        				 ; | 0 | 1 |   1/3 Duty    |
   355            C        				 ; |---|---|---------------|
   356            C        				 ; | 1 | 0 |   1/4 Duty    |
   357            C        				 ; |---|---|---------------|
   358            C        				 ; | 1 | 1 |   1/8 Duty    |
   359            C        				 ; |---|---|---------------|
   360       0001 C        		LCDF1	==  0x01 ;
   361       0000 C        		LCDF0	==  0x00 ; LCD Frame Frequency Control Bits
   362            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   363            C        				 ; |LCDF1|LCDF0|     Static    |    1/3 Duty   |    1/4 Duty   |   1/8 Duty   |
   364            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   365            C        				 ; |  0  |  0  |Fs/(512*1)=64.0|Fs/(172*3)=63.5|Fs/(128*4)=64.0|Fs/(64*8)=64.0|
   366            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   367            C        				 ; |  0  |  1  |Fs/(560*1)=58.5|Fs/(188*3)=58.0|Fs/(140*4)=58.5|Fs/(70*8)=58.5|
   368            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   369            C        				 ; |  1  |  0  |Fs/(608*1)=53.9|Fs/(204*3)=53.5|Fs/(152*4)=53.9|Fs/(76*8)=53.9|
   370            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   371            C        				 ; |  1  |  1  |Fs/(464*1)=70.6|Fs/(156*3)=70.0|Fs/(116*4)=70.6|Fs/(58*8)=70.6|
   372            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   373            C        	;}
   374            C        ;
   375            C        ;  Bank1 R6 (LCD Address Register)
   376            C        ;
   377       0006 C         B1_R6	==    0X06
   378       0006 C         LCDAR	==    0X06
   379            C        ;
   380            C        	;{
   381            C        				 ; Bit5~7 is "0"
   382       0004 C        		LCD_A4	==  0x04 ; LCD RAM Address:00H~16H
   383       0003 C        		LCD_A3	==  0x03
   384       0002 C        		LCD_A2  ==  0x02
   385       0001 C        		LCD_A1	==  0x01
   386       0000 C        		LCD_A0	==  0x00
   387            C        	;}
   388            C        ;
   389            C        ; Bank1 R7 (LCD Data Buffer)
   390            C        ;
   391       0007 C         B1_R7	==    0X07
   392       0007 C         LCDBR	==    0X07
   393            C        ;
   394            C        	;{
   395       0007 C        		LCD_D7	==  0x07
   396       0006 C        		LCD_D6	==  0x06
   397       0005 C        		LCD_D5	==  0x05
   398       0004 C        		LCD_D4	==  0x04
   399       0003 C        		LCD_D3	==  0x03
   400       0002 C        		LCD_D2	==  0x02
   401       0001 C        		LCD_D1	==  0x01
   402       0000 C        		LCD_D0	==  0x00
   403            C        	;}
   404            C        ;
   405            C        ;  Bank1 R8 (LCD Voltage Control Register)
   406            C        ;
   407       0008 C         B1_R8	==	0x08
   408       0008 C         LCDVCR	==	0x08
   409            C        ;
   410            C        	;{
   411            C        				 ; Bit5~6 is "0"
   412       0004 C        		LCDC1	==  0x04
   413       0003 C        		LCDC0	==  0x03 ; LCD Clock
   414            C        				 ; |-----|-----|------|--------|
   415            C        				 ; |LCDC1|LCDC0|  Fm  |  Flcd  |
   416            C        				 ; |-----|-----|------|--------|
   417            C        				 ; |  0  |  0  | 16M  | Fc/2^9 |
   418            C        				 ; |-----|-----|------|--------|
   419            C        				 ; |  0  |  1  |  8M  | Fc/2^8 |
   420            C        				 ; |-----|-----|------|--------|
   421            C        				 ; |  1  |  0  |  4M  | Fc/2^7 |
   422            C        				 ; |-----|-----|------|--------|
   423            C        				 ; |  1  |  1  |  2M  | Fc/2^6 |
   424            C        				 ; |-----|-----|------|--------|
   425       0002 C        		LCDVC2	==  0x02
   426       0001 C        		LCDVC1	==  0x01
   427       0000 C        		LCDVC0	==  0x00 ; LCD Voltage Control Bits
   428            C        				 ; |------|------|------|--------------|
   429            C        				 ; |LCDVC2|LCDVC1|LCDVC0|    Output    |
   430            C        				 ; |------|------|------|--------------|
   431            C        				 ; |   0  |   0  |   0  |  0.4VDD~VDD  |
   432            C        				 ; |------|------|------|--------------|
   433            C        				 ; |   0  |   0  |   1  | 0.34VDD~VDD  |
   434            C        				 ; |------|------|------|--------------|
   435            C        				 ; |   0  |   1  |   0  | 0.26VDD~VDD  |
   436            C        				 ; |------|------|------|--------------|
   437            C        				 ; |   0  |   1  |   1  | 0.18VDD~VDD  |
   438            C        				 ; |------|------|------|--------------|
   439            C        				 ; |   1  |   0  |   0  | 0.13VDD~VDD  |
   440            C        				 ; |------|------|------|--------------|
   441            C        				 ; |   1  |   0  |   1  | 0.07VDD~VDD  |
   442            C        				 ; |------|------|------|--------------|
   443            C        				 ; |   1  |   1  |   0  | 0.04VDD~VDD  |
   444            C        				 ; |------|------|------|--------------|
   445            C        				 ; |   1  |   1  |   1  |    0V~VDD    |
   446            C        				 ; |------|------|------|--------------|
   447            C        	;}
   448            C        ;
   449            C        ;  Bank1 R9 (LCD Com Control Register)
   450            C        ;
   451       0009 C         B1_R9	==	0x09
   452       0009 C         LCDCCR	==	0x09
   453            C        ;
   454            C        	;{
   455       0007 C        		COM7	==  0x07 ; 0:I/O Function,1:LCD common driver pin.
   456       0006 C        		COM6	==  0x06
   457       0005 C        		COM5	==  0x05
   458       0004 C        		COM4	==  0x04
   459       0003 C        		COM3	==  0x03
   460       0002 C        		COM2	==  0x02
   461       0001 C        		COM1	==  0x01
   462       0000 C        		COM0	==  0x00
   463            C        	;}
   464            C        ;
   465            C        ;  Bank1 RA (LCD Segment Control Register0)
   466            C        ;
   467       000A C         B1_RA		==	0X0A
   468       000A C         LCDSCR0	==	0X0A
   469            C        ;
   470            C        	;{
   471       0007 C        		SEG7	==  0X07 ; LCD Segment7 Control Bit.0:I/O,1:LCD Driver pin.
   472       0006 C        		SEG6	==  0X06 ; LCD Segment6 Control Bit.0:I/O,1:LCD Driver pin.
   473       0005 C        		SEG5	==  0X05 ; LCD Segment5 Control Bit.0:I/O,1:LCD Driver pin.
   474       0004 C        		SEG4	==  0X04 ; LCD Segment4 Control Bit.0:I/O,1:LCD Driver pin.
   475       0003 C        		SEG3	==  0X03 ; LCD Segment3 Control Bit.0:I/O,1:LCD Driver pin.
   476       0002 C        		SEG2	==  0X02 ; LCD Segment2 Control Bit.0:I/O,1:LCD Driver pin.
   477       0001 C        		SEG1	==  0X01 ; LCD Segment1 Control Bit.0:I/O,1:LCD Driver pin.
   478       0000 C        		SEG0	==  0X00 ; LCD Segment0 Control Bit.0:I/O,1:LCD Driver pin.
   479            C        	;}
   480            C        ;
   481            C        ;  Bank1 RB (LCD Segment Control Register1)
   482            C        ;
   483       000B C         B1_RB		==	0X0B
   484       000B C         LCDSCR1	==	0X0B
   485            C        ;
   486            C        	;{
   487       0007 C        		SEG15	==  0X07 ; LCD Segment15 Control Bit.0:I/O,1:LCD Driver pin.
   488       0006 C        		SEG14	==  0X06 ; LCD Segment14 Control Bit.0:I/O,1:LCD Driver pin.
   489       0005 C        		SEG13	==  0X05 ; LCD Segment13 Control Bit.0:I/O,1:LCD Driver pin.
   490       0004 C        		SEG12	==  0X04 ; LCD Segment12 Control Bit.0:I/O,1:LCD Driver pin.
   491       0003 C        		SEG11	==  0X03 ; LCD Segment11 Control Bit.0:I/O,1:LCD Driver pin.
   492       0002 C        		SEG10	==  0X02 ; LCD Segment10 Control Bit.0:I/O,1:LCD Driver pin.
   493       0001 C        		SEG9	==  0X01 ; LCD Segment9 Control Bit.0:I/O,1:LCD Driver pin.
   494       0000 C        		SEG8	==  0X00 ; LCD Segment8 Control Bit.0:I/O,1:LCD Driver pin.
   495            C        	;}
   496            C        ;
   497            C        ;  Bank1 RC (LCD Segment Control Register2)
   498            C        ;
   499       000C C         B1_RC		==	0X0C
   500       000C C         LCDSCR2	==	0X0C
   501            C        ;
   502            C        	;{
   503            C        				 ; Bit7 not used
   504       0006 C        		SEG22	==  0X06 ; LCD Segment22 Control Bit.0:I/O,1:LCD Driver pin.
   505       0005 C        		SEG21	==  0X05 ; LCD Segment21 Control Bit.0:I/O,1:LCD Driver pin.
   506       0004 C        		SEG20	==  0X04 ; LCD Segment20 Control Bit.0:I/O,1:LCD Driver pin.
   507       0003 C        		SEG19	==  0X03 ; LCD Segment19 Control Bit.0:I/O,1:LCD Driver pin.
   508       0002 C        		SEG18	==  0X02 ; LCD Segment18 Control Bit.0:I/O,1:LCD Driver pin.
   509       0001 C        		SEG17	==  0X01 ; LCD Segment17 Control Bit.0:I/O,1:LCD Driver pin.
   510       0000 C        		SEG16	==  0X00 ; LCD Segment16 Control Bit.0:I/O,1:LCD Driver pin.
   511            C        	;}
   512            C        ;
   513            C        ;  Bank1 RE (External Interrupt Mask Register)
   514            C        ;
   515       000E C         B1_RE	==	0X0E
   516       000E C         EIMR	==	0X0E
   517            C        ;
   518            C        	;{
   519       0007 C        		EXIE7	==  0x07 ; /INT7 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   520       0006 C        		EXIE6	==  0x06 ; /INT6 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   521       0005 C        		EXIE5	==  0x05 ; /INT5 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   522       0004 C        		EXIE4	==  0x04 ; /INT4 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   523       0003 C        		EXIE3	==  0x03 ; /INT3 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   524       0002 C        		EXIE2	==  0x02 ; /INT2 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   525       0001 C        		EXIE1	==  0x01 ; /INT1 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   526       0000 C        		EXIE0	==  0x00 ; /INT0 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   527            C        	;}
   528            C        ;
   529            C        ;  Bank1 RF (External Interrupt Status Register)
   530            C        ;
   531       000F C         B1_RF	==	0X0F
   532       000F C         EISR	==	0X0F
   533            C        ;
   534            C        	;{
   535       0007 C        		EXIF7	==  0x07 ; /INT7 Interrupt Flag Bit.
   536       0006 C        		EXIF6	==  0x06 ; /INT6 Interrupt Flag Bit.
   537       0005 C        		EXIF5	==  0x05 ; /INT5 Interrupt Flag Bit.
   538       0004 C        		EXIF4	==  0x04 ; /INT4 Interrupt Flag Bit.
   539       0003 C        		EXIF3	==  0x03 ; /INT3 Interrupt Flag Bit.
   540       0002 C        		EXIF2	==  0x02 ; /INT2 Interrupt Flag Bit.
   541       0001 C        		EXIF1	==  0x01 ; /INT1 Interrupt Flag Bit.
   542       0000 C        		EXIF0	==  0x00 ; /INT0 Interrupt Flag Bit.
   543            C        	;}
   544            C        ;
   545            C        ;  Bank2 R5 (Timer1 Control Register)
   546            C        ;
   547       0005 C         B2_R5	==	0X05
   548       0005 C         T1CR	==	0X05
   549            C        ;
   550            C        	;{
   551       0007 C        		T1S1	==  0x07
   552       0006 C        		T1S0	==  0x06 ; Timer1 and Timer2 Interrupt Type Select Bits.
   553            C        				 ; |----|----|---------------------------------------|
   554            C        				 ; |T1S1|T1S0|Timer1 and Timer2 Interrupt Type Select|
   555            C        				 ; |----|----|---------------------------------------|
   556            C        				 ; |  0 |  0 |           T1PD underflow              |
   557            C        				 ; |----|----|---------------------------------------|
   558            C        				 ; |  0 |  1 |           T1TD underflow              |
   559            C        				 ; |----|----|---------------------------------------|
   560            C        				 ; |  1 |  X |      T1PD and T1TD underflow          |
   561            C        				 ; |----|----|---------------------------------------|
   562       0005 C        		T1MS2	==  0x05
   563       0004 C        		T1MS1	==  0x04
   564       0003 C        		T1MS0	==  0x03 ; Timer1 Operation Mode Select Bits
   565            C        				 ; |-----|-----|-----|-------------------------|
   566            C        				 ; |T1MS2|T1MS1|T1MS0|   Timer1 Mode Select    |
   567            C        				 ; |-----|-----|-----|-------------------------|
   568            C        				 ; |  0  |  0  |  0  |         Timer1          |
   569            C        				 ; |-----|-----|-----|-------------------------|
   570            C        				 ; |  0  |  0  |  1  |        T1OUT Mode       |
   571            C        				 ; |-----|-----|-----|-------------------------|
   572            C        				 ; |  0  |  1  |  0  |Capture Mode Rising Edge |
   573            C        				 ; |-----|-----|-----|-------------------------|
   574            C        				 ; |  0  |  1  |  1  |Capture Mode Falling Edge|
   575            C        				 ; |-----|-----|-----|-------------------------|
   576            C        				 ; |  1  |  0  |  0  |UART Baud Rate Generator |
   577            C        				 ; |-----|-----|-----|-------------------------|
   578            C        				 ; |  1  |  0  |  1  |                         |
   579            C        				 ; |-----|-----|-----|                         |
   580            C        				 ; |  1  |  1  |  0  |          PWM1           |
   581            C        				 ; |-----|-----|-----|                         |
   582            C        				 ; |  1  |  1  |  1  |                         |
   583            C        				 ; |-----|-----|-----|-------------------------|
   584       0002 C        		T1P2	==  0x02
   585       0001 C        		T1P1	==  0x01
   586       0000 C        		T1P0	==  0x00 ; Timer1 Prescaler Bits
   587            C        				 ; |-----|-----|-----|-----------------|
   588            C        				 ; | T1P2| T1P1| T1P0|   Prescalaer    |
   589            C        				 ; |-----|-----|-----|-----------------|
   590            C        				 ; |  0  |  0  |  0  |      1:2        |
   591            C        				 ; |-----|-----|-----|-----------------|
   592            C        				 ; |  0  |  0  |  1  |      1:4        |
   593            C        				 ; |-----|-----|-----|-----------------|
   594            C        				 ; |  0  |  1  |  0  |	    1:8        |
   595            C        				 ; |-----|-----|-----|-----------------|
   596            C        				 ; |  0  |  1  |  1  |      1:16       |
   597            C        				 ; |-----|-----|-----|-----------------|
   598            C        				 ; |  1  |  0  |  0  |      1:32       |
   599            C        				 ; |-----|-----|-----|-----------------|
   600            C        				 ; |  1  |  0  |  1  |      1:64       |
   601            C        				 ; |-----|-----|-----|-----------------|                         |
   602            C        				 ; |  1  |  1  |  0  |      1:128      |
   603            C        				 ; |-----|-----|-----|-----------------|
   604            C        				 ; |  1  |  1  |  1  |      1:256      |
   605            C        				 ; |-----|-----|-----|-----------------|
   606            C        	;}
   607            C        ;
   608            C        ;  Bank2 R6 (Timer Status Register)
   609            C        ;
   610       0006 C         B2_R6	==	0X06
   611       0006 C         TSR	==	0X06
   612            C        ;
   613            C        	;{
   614       0007 C        		T1MOD	==  0X07 ; Timer Operates Mode Select Bit.
   615       0006 C        		TRCB	==  0x06 ; Timer1,2 Read Control Bit.
   616       0005 C        		T1CSS1	==  0x05 ;
   617       0004 C        		T1CSS0	==  0x04 ; Timer1 Clock Source Select Bits
   618            C        				 ; |------|------|--------------------------|
   619            C        				 ; |T1CSS1|T1CSS0|Timer1 Clock Source select|
   620            C        				 ; |------|------|--------------------------|
   621            C        				 ; |  0   |  0   |            Fm            |
   622            C        				 ; |------|------|--------------------------|
   623            C        				 ; |  0   |  1   |            Fs            |
   624            C        				 ; |------|------|--------------------------|
   625            C        				 ; |  1   |  X   |           T1CK           |
   626            C        				 ; |------|------|--------------------------|
   627       0003 C        		T2CSS	==  0x03 ; Timer2 Clock Source Select Bit.0/1=>Fm/Fs.
   628       0002 C        		T1EN	==  0x02 ; Timer1 Start Bit.
   629       0001 C        		T1OMS	==  0x01 ; Timer1 Output Mode Select Bit.0/1=>repeating/on-shot.
   630       0000 C        		T1OC	==  0x00 ; Timer1 Output Flip-Flop Control Bit.
   631            C        	;}
   632            C        ;
   633            C        ;  Bank2 R7 (Timer1 Period Buffer)
   634            C        ;
   635       0007 C         B2_R7	==	0X07
   636       0007 C         T1PD	==	0X07
   637            C        ;
   638            C        ;  Bank2 R8 (Timer1 Duty Buffer)
   639            C        ;
   640       0008 C         B2_R8	==	0X08
   641       0008 C         T1TD	==	0X08
   642            C        ;
   643            C        ;  Bank2 R9 (Timer2 Control Register)
   644            C        ;
   645       0009 C         B2_R9	==	0X09
   646       0009 C         T2CR	==	0X09
   647            C        ;
   648            C        	;{
   649       0007 C        		T2IF	==  0X07 ; Interrupt Flag of Timer2 Interrupt
   650       0006 C        		T2IE	==  0X06 ; Timer2 Interrupt Mask Bit
   651       0005 C        		T2EN	==  0X05 ; Timer2 Start Bit
   652       0005 C        		T2S     ==  0x05 ;
   653       0004 C        		T2MS1	==  0X04 ;
   654       0003 C        		T2MS0	==  0X03 ; Timer2 Operation Mode Select Bits.
   655            C        				 ; |-----|-----|-----------------------|
   656            C        				 ; |T2MS1|T2MS0|   Timer2 Mode Select  |
   657            C        				 ; |-----|-----|-----------------------|
   658            C        				 ; |  0  |  0  |        Timer2         |
   659            C        				 ; |-----|-----|-----------------------|
   660            C        				 ; |  0  |  1  |SPI Baud Rate Generator|
   661            C        				 ; |-----|-----|-----------------------|
   662            C        				 ; |  1  |  0  |                       |
   663            C        				 ; |-----|-----|         PWM2          |
   664            C        				 ; |  1  |  0  |                       |
   665            C        				 ; |-----|-----|-----------------------|
   666       0002 C        		T2P2	==  0x02
   667       0001 C        		T2P1	==  0x01
   668       0000 C        		T2P0	==  0x00 ; Timer2 Prescaler Bits
   669            C        				 ; |-----|-----|-----|-----------------|
   670            C        				 ; | T2P2| T2P1| T2P0|   Prescalaer    |
   671            C        				 ; |-----|-----|-----|-----------------|
   672            C        				 ; |  0  |  0  |  0  |      1:2        |
   673            C        				 ; |-----|-----|-----|-----------------|
   674            C        				 ; |  0  |  0  |  1  |      1:4        |
   675            C        				 ; |-----|-----|-----|-----------------|
   676            C        				 ; |  0  |  1  |  0  |	    1:8        |
   677            C        				 ; |-----|-----|-----|-----------------|
   678            C        				 ; |  0  |  1  |  1  |      1:16       |
   679            C        				 ; |-----|-----|-----|-----------------|
   680            C        				 ; |  1  |  0  |  0  |      1:32       |
   681            C        				 ; |-----|-----|-----|-----------------|
   682            C        				 ; |  1  |  0  |  1  |      1:64       |
   683            C        				 ; |-----|-----|-----|-----------------|                         |
   684            C        				 ; |  1  |  1  |  0  |      1:128      |
   685            C        				 ; |-----|-----|-----|-----------------|
   686            C        				 ; |  1  |  1  |  1  |      1:256      |
   687            C        				 ; |-----|-----|-----|-----------------|
   688            C        	;}
   689            C        ;
   690            C        ;  Bank2 RA (Timer2 Period Buffer)
   691            C        ;
   692       000A C         B2_RA	==	0X0A
   693       000A C         T2PD	==	0X0A
   694            C        ;
   695            C        ; Bank2 RB (Timer Duty Buffer)
   696            C        ;
   697       000B C         B2_RB	==	0X0B
   698       000B C         T2TD	==	0X0B
   699            C        ;
   700            C        ;  Bank2 RC (SPI Status Register)
   701            C        ;
   702       000C C         B2_RC	==	0X0C
   703       000C C         SPIS	==	0X0C
   704            C        ;
   705            C        	;{
   706       0007 C        		DORD	==  0X07 ; Data Shift Control Bit.0/1=>left/right
   707       0006 C        		TD1	==  0X06 ;
   708       0005 C        		TD0	==  0X05 ; SDO Status Output Delay Times Options
   709            C        				 ; |---|---|----------|
   710            C        				 ; |TD1|TD0|Delay Time|
   711            C        				 ; |---|---|----------|
   712            C        				 ; | 0 | 0 |   8 CLK  |
   713            C        				 ; |---|---|----------|
   714            C        				 ; | 0 | 1 |  16 CLK  |
   715            C        				 ; |---|---|----------|
   716            C        				 ; | 1 | 0 |  24 CLK  |
   717            C        				 ; |---|---|----------|
   718            C        				 ; | 1 | 1 |  32 CLK  |
   719            C        				 ; |---|---|----------|
   720            C        				 ; Bit4 Reserved
   721       0003 C        		OD3	==  0X03 ; Open-Drain Control Bit
   722       0002 C        		OD4	==  0X02 ;
   723            C        				 ; Bi1 Reserved
   724       0000 C        		RIBF	==  0X00 ; Read Buffer Full Flag
   725            C        	;}
   726            C        ;
   727            C        ;  Bank2 RD (SPI Control Register)
   728            C        ;
   729       000D C         B2_RD	==	0X0D
   730       000D C         SPIC	==	0X0D
   731            C        ;
   732            C        	;{
   733       0007 C        		CES	==  0X07 ; Clock Edge Select Bit
   734       0006 C        		SPIEB	==  0X06 ; SPI Enable Bit
   735       0005 C        		SRO	==  0X05 ; SPI Read Overflow Bit
   736       0004 C        		SSE	==  0X04 ; SPI Shift Enable Bit
   737       0003 C        		SDOC	==  0X03 ; SDO Output Status Control Bit
   738       0002 C        		SBRS2	==  0X02
   739       0001 C        		SBRS1	==  0X01
   740       0000 C        		SBRS0	==  0X00 ; SPI Baud Rate Select Bits
   741            C        				 ; |-----|-----------|--------|-------------------|
   742            C        				 ; |SBRS2|SBRS1|SBRS0|  Mode  |   SPI Baud Rate   |
   743            C        				 ; |-----|-----------|--------|-------------------|
   744            C        				 ; |  0  |  0  |  0  | Master |       Fcsc/2      |
   745            C        				 ; |-----|-----------|--------|-------------------|
   746            C        				 ; |  0  |  0  |  1  | Master |       Fcsc/4      |
   747            C        				 ; |-----|-----------|--------|-------------------|
   748            C        				 ; |  0  |  1  |  0  | Master |       Fcsc/8      |
   749            C        				 ; |-----|-----------|--------|-------------------|
   750            C        				 ; |  0  |  1  |  1  | Master |      Fcsc/16      |
   751            C        				 ; |-----|-----------|--------|-------------------|
   752            C        				 ; |  1  |  0  |  0  | Master |      Fcsc/32      |
   753            C        				 ; |-----|-----------|--------|-------------------|
   754            C        				 ; |  1  |  0  |  1  | Master |       Timer2      |
   755            C        				 ; |-----|-----------|--------|-------------------|
   756            C        				 ; |  1  |  1  |  0  | Slave  |     /SS enable    |
   757            C        				 ; |-----|-----------|--------|-------------------|
   758            C        				 ; |  1  |  1  |  1  | Slave  |     /SS enable    |
   759            C        				 ; |-----|-----------|--------|-------------------|
   760            C        	;}
   761            C        ;
   762            C        ;  Bank2 RE (SPI Read Buffer)
   763            C        ;
   764       000E C         B2_RE	==	0X0E
   765       000E C         SPIR	==	0X0E
   766            C        ;
   767            C        ;  Bank2 RF (SPI Write Buffer)
   768            C        ;
   769       000F C         B2_RF	==	0X0F
   770       000F C         SPIW	==	0X0F
   771            C        ;
   772            C        ;  Bank3 R5 (UART Control Register)
   773            C        ;
   774       0005 C         B3_R5	==	0X05
   775       0005 C         URC	==	0X05
   776            C        ;
   777            C        	;{
   778       0007 C        		URTD8	==  0X07 ; Transmission Data Bit8
   779       0006 C        		UMODE1	==  0X06
   780       0005 C        		UM0DE0	==  0X05 ; UART Transmission Mode Select Bit
   781            C        				 ; |------|------|-----------|
   782            C        				 ; |UMODE1|UMODE0| UART Mode |
   783            C        				 ; |  0   |   0  |Mode1:7-Bit|
   784            C        				 ; |------|------|-----------|
   785            C        				 ; |  0   |   1  |Mode1:8-Bit|
   786            C        				 ; |------|------|-----------|
   787            C        				 ; |  1   |   0  |Mode1:9-Bit|
   788            C        				 ; |------|------|-----------|
   789            C        				 ; |  1   |   1  | Reserved  |
   790            C        				 ; |------|------|-----------|
   791       0004 C        		BRATE2	==  0X04
   792       0003 C        		BRATE1	==  0X03
   793       0002 C        		BRATE0	==  0X02 ; Transmit Baud Rate Select(Tuart=Fc/16)
   794            C        				 ; |------|------|------|-------------|-------------|
   795            C        				 ; |BRATE2|BRATE1|BRATE0|  Baud Rate  | e.g.FC=8Mhz |
   796            C        				 ; |------|------|------|-------------|-------------|
   797            C        				 ; |  0   |  0   |  0   |   Tuart/13  |    38400    |
   798            C        				 ; |------|------|------|-------------|-------------|
   799            C        				 ; |  0   |  0   |  1   |   Tuart/26  |    19200    |
   800            C        				 ; |------|------|------|-------------|-------------|
   801            C        				 ; |  0   |  1   |  0   |   Tuart/52  |     9600    |
   802            C        				 ; |------|------|------|-------------|-------------|
   803            C        				 ; |  0   |  1   |  1   |  Tuart/104  |     4800    |
   804            C        				 ; |------|------|------|-------------|-------------|
   805            C        				 ; |  1   |  0   |  0   |  Tuart/208  |     2400    |
   806            C        				 ; |------|------|------|-------------|-------------|
   807            C        				 ; |  1   |  0   |  1   |  Tuart/416  |     1200    |
   808            C        				 ; |------|------|------|---------------------------|
   809            C        				 ; |  1   |  1   |  0   |            Timer1         |
   810            C        				 ; |------|------|------|---------------------------|
   811            C        				 ; |  1   |  1   |  1   |           Reserved        |
   812            C        				 ; |------|------|------|---------------------------|
   813       0001 C        		UTBE ==  0X01
   814       0000 C        		TXE	 ==  0X00 ; Enable transmission
   815            C        	;}
   816            C        ;
   817            C        ;  Bank 3 R6 (UART Status)
   818            C        ;
   819       0006 C         B3_R6	==  0X06
   820       0006 C         URS	==  0X06
   821            C        ;
   822            C        	;{
   823       0007 C        		URRD8	==  0X07 	; Receiving Data Bit8
   824       0006 C        		EVEN	==  0X06 	; Select Parity Check
   825       0005 C        		PRE		==  0X05	; Enable Parity Check
   826       0004 C        		PRERR	==  0X04 	; Parity Error Flag
   827       0003 C        		OVERR	==  0X03 	; Over Running Error Flag
   828       0002 C        		FMERR	==  0X02 	; Framing Error Flag
   829       0001 C        		URBF	==  0X01 	; UART Read Buffer Full Flag
   830       0000 C        		RXE	==  0X00 		; Enable Receiving
   831            C        	;}
   832            C        ;
   833            C        ;  Bank3 R7 (UART_RD Data Buffer)
   834            C        ;
   835       0007 C         B3_R7	==	0X07
   836       0007 C         URRD	==	0X07
   837            C        ;
   838            C        ;  Bank3 R8 (UART_TD Data Buffer)
   839            C        ;
   840       0008 C         B3_R8	==	0X08
   841       0008 C         URTD	==	0X08
   842            C        ;
   843            C        ;  Bank3 R9 (A/D Control Register)
   844            C        ;
   845       0009 C         B3_R9	==	0X09
   846       0009 C         ADCR	==	0X09
   847            C        ;
   848            C        	;{
   849       0007 C        		ADRUN	==  0X07 ; AD Conversion Start
   850       0006 C        		ADP	==  0X06 ; A/D Power Control
   851       0005 C        		ADCK1	==  0X05
   852       0004 C        		ADCK0	==  0X04 ; A/D Input Select Bits
   853            C        				 ; |-----|-----|------------|---------------------------|
   854            C        				 ; |ADCK1|ADCK0|Clock Source|Max.Operating Frequency(Fc)|
   855            C        				 ; |-----|-----|------------|---------------------------|
   856            C        				 ; |  0	 |  0  |    Fc/4    |           1MHz            |
   857            C        				 ; |-----|-----|------------|---------------------------|
   858            C        				 ; |  0	 |  1  |   Fc/16    |           4MHz            |
   859            C        				 ; |-----|-----|------------|---------------------------|
   860            C        				 ; |  1	 |  0  |   Fc/32    |           8MHz            |
   861            C        				 ; |-----|-----|------------|---------------------------|
   862            C        				 ; |  1	 |  1  |   Fc/64    |          16MHz            |
   863            C        				 ; |-----|-----|------------|---------------------------|
   864       0003 C        		ADIS3	==  0X03
   865       0002 C        		ADIS2	==  0X02
   866       0001 C        		ADIS1	==  0X01
   867       0000 C        		ADIS0	==  0X00 ; A/D Input Select Bits
   868            C        				 ; |-----|-----|-----|----------------------|
   869            C        				 ; |ADIS3|ADIS2|ADIS1|ADIS0|Analog Input Pin|
   870            C        				 ; |-----|-----|-----|----------------------|
   871            C        				 ; |  0  |  0  |  0  |  0  |      AD0       |
   872            C        				 ; |-----|-----|-----|----------------------|
   873            C        				 ; |  0  |  0  |  0  |  1  |      AD1       |
   874            C        				 ; |-----|-----|-----|----------------------|
   875            C        				 ; |  0  |  0  |  1  |  0  |      AD2       |
   876            C        				 ; |-----|-----|-----|----------------------|
   877            C        				 ; |  0  |  0  |  1  |  1  |      AD3       |
   878            C        				 ; |-----|-----|-----|----------------------|
   879            C        				 ; |  0  |  1  |  0  |  0  |      AD4       |
   880            C        				 ; |-----|-----|-----|----------------------|
   881            C        				 ; |  0  |  1  |  0  |  1  |      AD5       |
   882            C        				 ; |-----|-----|-----|----------------------|
   883            C        				 ; |  0  |  1  |  1  |  0  |      AD6       |
   884            C        				 ; |-----|-----|-----|----------------------|
   885            C        				 ; |  0  |  1  |  1  |  1  |      AD7       |
   886            C        				 ; |-----|-----|-----|----------------------|
   887            C        				 ; |  1  |  0  |  0  |  0  |      AD8       |
   888            C        				 ; |-----|-----|-----|----------------------|
   889            C        				 ; |  1  |  0  |  0  |  1  |      AD9       |
   890            C        				 ; |-----|-----|-----|----------------------|
   891            C        				 ; |  1  |  0  |  1  |  0  |      AD10      |
   892            C        				 ; |-----|-----|-----|----------------------|
   893            C        				 ; |  1  |  0  |  1  |  1  |      AD11      |
   894            C        				 ; |-----|-----|-----|----------------------|
   895            C        	;}
   896            C        ;
   897            C        ;  Bank3 RA (A/D Input Control Register)
   898            C        ;
   899       000A C         B3_RA	==	0X0A
   900       000A C         ADICH	==	0X0A
   901            C        ;
   902            C        	;{
   903       0007 C        		CALI	==  0X07 ; Calibration Enable Bit for A/D Offset
   904       0006 C        		ADREF	==  0X06 ; AD Reference Voltage Input Select
   905            C        				 ; Bit4~5:Reserved
   906       0003 C        		ADE11	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   907       0002 C        		ADE10	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   908       0001 C        		ADE9	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   909       0000 C        		ADE8	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   910            C        	;}
   911            C        ;
   912            C        ;  Bank3 RB (A/D Input Control Register)
   913            C        ;
   914       000B C         B3_RB	==	0X0B
   915       000B C         ADICL	==	0X0B
   916            C        ;
   917            C        	;{
   918       0007 C        		ADE7	==  0X07 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   919       0006 C        		ADE6	==  0X06 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   920       0005 C        		ADE5	==  0x05 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   921       0004 C        		ADE4	==  0X04 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   922       0003 C        		ADE3	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   923       0002 C        		ADE2	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   924       0001 C        		ADE1	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   925       0000 C        		ADE0	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   926            C        	;}
   927            C        ;
   928            C        ;  Bank3 RC (A/D High 8-bits Data Buffer)
   929            C        ;
   930       000C C         B3_RC	==	0X0C
   931       000C C         ADDH	==	0X0C
   932            C        ;
   933            C        ;  Bank3 RD (A/D Low 4-bits Data Buffer)
   934            C        ;
   935       000D C         B3_RD	==	0X0D
   936       000D C         ADDL	==	0X0D
   937            C        ;
   938            C        	;{
   939       0007 C        		SIGN	==  0X07 ; Polarity Bit of Offset Voltage.0/1=>Negative/Positive
   940       0006 C        		VOF2	==  0X06
   941       0005 C        		VOF1	==  0X05
   942       0004 C        		VOF0	==  0X04 ; Offset Voltage Bits.
   943            C        				 ; |----|----|----|---------|
   944            C        				 ; |VOF2|VOF1|VOF0|EM78P510N|
   945            C        				 ; |----|----|----|---------|
   946            C        				 ; |  0 |  0 |  0 |   0LSB  |
   947            C        				 ; |----|----|----|---------|
   948            C        				 ; |  0 |  0 |  1 |   2LSB  |
   949            C        				 ; |----|----|----|---------|
   950            C        				 ; |  0 |  1 |  0 |   4LSB  |
   951            C        				 ; |----|----|----|---------|
   952            C        				 ; |  0 |  1 |  1 |   6LSB  |
   953            C        				 ; |----|----|----|---------|
   954            C        				 ; |  1 |  0 |  0 |   8LSB  |
   955            C        				 ; |----|----|----|---------|
   956            C        				 ; |  1 |  0 |  1 |  10LSB  |
   957            C        				 ; |----|----|----|---------|
   958            C        				 ; |  1 |  1 |  0 |  12LSB  |
   959            C        				 ; |----|----|----|---------|
   960            C        				 ; |  1 |  1 |  1 |  14LSB  |
   961            C        				 ; |----|----|----|---------|
   962       0003 C        		ADD3	==  0X03
   963       0002 C        		ADD2	==  0X02
   964       0001 C        		ADD1	==  0X01
   965       0000 C        		ADD0	==  0X00
   966            C        	;}
   967            C        ;
   968            C        ;  Bank3 RE (External Interrupt Edge Select Control Register High Byte)
   969            C        ;
   970       000E C         B3_RE	==	0X0E
   971       000E C         EIESH	==	0X0E
   972            C        ;
   973            C        	;{
   974       0007 C        		EIES7	==  0X07 ; External Interrupt 7 Edge Select Bit.0/1=>Falling/Rising
   975       0006 C        		EIES6	==  0X06 ; External Interrupt 6 Edge Select Bit.0/1=>Falling/Rising
   976       0005 C        		EIES5	==  0X05 ; External Interrupt 5 Edge Select Bit.0/1=>Falling/Rising
   977       0004 C        		EIES4	==  0X04 ; External Interrupt 4 Edge Select Bit.0/1=>Falling/Rising
   978       0003 C        		EIES3	==  0X03 ; External Interrupt 3 Edge Select Bit.0/1=>Falling/Rising
   979       0002 C        		EIES2	==  0X02 ; External Interrupt 2 Edge Select Bit.0/1=>Falling/Rising
   980       0001 C        		EIES1	==  0X01 ; External Interrupt 1 Edge Select Bit.0/1=>Falling/Rising
   981       0000 C        		EIES0	==  0X00 ; External Interrupt 0 Edge Select Bit.0/1=>Falling/Rising
   982            C        	;}
   983            C        ;
   984            C        ;  Bank3 RF (External Interrupt Edge Select Control Register Low Byte)
   985            C        ;
   986       000F C         B3_RF	==	0X0F
   987       000F C         EIESL	==	0X0F
   988            C        ;
   989            C        	;{
   990            C        				 ;Bit4~7 is "0"
   991       0004 C        		ADWK	==  0X04 ; A/D Converter Wake Up Function Enable Bit
   992       0003 C        		INTWK9	==  0X03 ; External Interrupt 9 Wake Up Function Enable Bit
   993       0002 C        		INTWK8	==  0X02 ; External Interrupt 8 Wake Up Function Enable Bit
   994       0001 C        		EIES9	==  0X01 ; External Interrupt 9 Edge Select Bit
   995       0000 C        		EIES8	==  0x00 ; External Interrupt 8 Edge Select Bit
   996            C        	;}
   997            C        ;
   998            C        ;  Bank4 R5 (LED Drive Control Register)
   999            C        ;
  1000       0005 C         B4_R5	==	0X05
  1001       0005 C         LEDDCR	==	0X05
  1002            C        ;
  1003            C        	;{
  1004       0007 C        		LEDD7	==  0X07 ; 0:P9.7 as normal I/O,1:P9.7 as LED direct drive I/O.
  1005       0006 C        		LEDD6	==  0X06 ; 0:P9.6 as normal I/O,1:P9.6 as LED direct drive I/O.
  1006       0005 C        		LEDD5	==  0X05 ; 0:P9.5 as normal I/O,1:P9.5 as LED direct drive I/O.
  1007       0004 C        		LEDD4	==  0X04 ; 0:P9.4 as normal I/O,1:P9.4 as LED direct drive I/O.
  1008       0003 C        		LEDD3	==  0X03 ; 0:P9.3 as normal I/O,1:P9.3 as LED direct drive I/O.
  1009       0002 C        		LEDD2	==  0X02 ; 0:P9.2 as normal I/O,1:P9.2 as LED direct drive I/O.
  1010       0001 C        		LEDD1	==  0X01 ; 0:P9.1 as normal I/O,1:P9.1 as LED direct drive I/O.
  1011       0000 C        		LEDD0	==  0X00 ; 0:P9.0 as normal I/O,1:P9.0 as LED direct drive I/O.
  1012            C        	;}
  1013            C        ;
  1014            C        ;  Bank4 R6 (Watch Timer and Buzzer Control Register)
  1015            C        ;
  1016       0006 C         B4_R6	==	0X06
  1017       0006 C         WBCR	==	0X06
  1018            C        ;
  1019            C        	;{
  1020       0007 C        		WTCS	==  0X07 ; Watch Timer and Buzzer Clock Source Select Bit.
  1021       0006 C        		WTIE	==  0X06 ; Watch Timer Enable Bit and Interrupt Mask
  1022       0005 C        		WTIF	==  0X05 ; Watch Timer Interrupt Flag
  1023       0004 C        		WTSSB1	==  0X04 ;
  1024       0003 C        		WTSSB0  ==  0X03 ; Watch Timer Interval Select Bits
  1025            C        				 ; |------|------|-----------------------------------|
  1026            C        				 ; |WTSSB1|WTSSB0|Watch Timer Interval Select(WTCS=1)|
  1027            C        				 ; |  0   |   0  |                1.0S               |
  1028            C        				 ; |------|------|-----------------------------------|
  1029            C        				 ; |  0   |   1  |                0.5S               |
  1030            C        				 ; |------|------|-----------------------------------|
  1031            C        				 ; |  1   |   0  |               0.25S               |
  1032            C        				 ; |------|------|-----------------------------------|
  1033            C        				 ; |  1   |   1  |              3.91MS               |
  1034            C        				 ; |------|------|-----------------------------------|
  1035       0002 C        		BUZE	==  0X02 ; Buzzer Enable and PORT91 as Buzzer Output Pin
  1036       0001 C        		BSSB1	==  0X01
  1037       0000 C        		BSSB0	==  0X00 ; Buzzer Output Frequency Select Bits
  1038            C        				 ; |-----|-----|----------------------------|
  1039            C        				 ; |BSSB1|BSSB0|Buzzer Signal Select(WTCS=1)|
  1040            C        				 ; |-----|-----|----------------------------|
  1041            C        				 ; |  0  |  0  |           0.5KHz           |
  1042            C        				 ; |-----|-----|----------------------------|
  1043            C        				 ; |  0  |  1  |           1.0KHz           |
  1044            C        				 ; |-----|-----|----------------------------|
  1045            C        				 ; |  1  |  0  |           2.0KHz           |
  1046            C        				 ; |-----|-----|----------------------------|
  1047            C        				 ; |  1  |  1  |           4.0KHz           |
  1048            C        				 ; |-----|-----|----------------------------|
  1049            C        	;}
  1050            C        ;
  1051            C        ;  Bank4 R7 (PORT7 I/O Control Register)
  1052            C        ;
  1053       0007 C         B4_R7	==	0X07
  1054       0007 C         IOC7	==	0X07
  1055       0007 C         P7IOCR	==	0X07
  1056            C        ;
  1057            C        ;  Bank4 R8 (PORT8 I/O Control Register)
  1058            C        ;
  1059       0008 C         B4_R8	==	0X08
  1060       0008 C         IOC8	==	0X08
  1061       0008 C         P8IOCR	==	0X08
  1062            C        ;
  1063            C        ;  Bank4 R9 (PORT9 I/O Control Register)
  1064            C        ;
  1065       0009 C         B4_R9	==	0X09
  1066       0009 C         IOC9	==	0X09
  1067       0009 C         P9IOCR	==	0X09
  1068            C        ;
  1069            C        ;  Bank4 RA (PORTA I/O Control Register)
  1070            C        ;
  1071       000A C         B4_RA	==	0X0A
  1072       000A C         IOCA	==	0X0A
  1073       000A C         PAIOCR	==	0X0A
  1074            C        ;
  1075            C        ;  Bank4 RB (PORTB I/O Control Register)
  1076            C        ;
  1077       000B C         B4_RB	==	0X0B
  1078       000B C         IOCB	==	0X0B
  1079       000B C         PBIOCR	==	0X0B
  1080            C        ;
  1081            C        ;  Bank4 RC (PORTC I/O Control Register)
  1082            C        ;
  1083       000C C         B4_RC	==	0X0C
  1084       000C C         IOCC	==	0X0C
  1085       000C C         PCIOCR	==	0X0C
  1086            C        ;
  1087            C        ;  Bank4 RF (Wake Up Control Register)
  1088            C        ;
  1089       000F C         B4_RF	==	0X0F
  1090       000F C         WKCR	==	0X0F
  1091            C        ;
  1092            C        	;{
  1093       0007 C        		INTWK7	==  0X07 ; External Interrupt 7 Wake Up Function Enable Bit.
  1094       0006 C        		INTWK6	==  0X06 ; External Interrupt 6 Wake Up Function Enable Bit.
  1095       0005 C        		INTWK5	==  0X05 ; External Interrupt 5 Wake Up Function Enable Bit.
  1096       0004 C        		INTWK4	==  0X04 ; External Interrupt 4 Wake Up Function Enable Bit.
  1097       0003 C        		INTWK3	==  0X03 ; External Interrupt 3 Wake Up Function Enable Bit.
  1098       0002 C        		INTWK2	==  0X02 ; External Interrupt 2 Wake Up Function Enable Bit.
  1099       0001 C        		INTWK1	==  0X01 ; External Interrupt 1 Wake Up Function Enable Bit.
  1100       0000 C        		INTWK0	==  0X00 ; External Interrupt 0 Wake Up Function Enable Bit.
  1101            C        	;}
  1102            C        ;
  1103            C        ;  Bank4 R6 (UART Control Register 2)
  1104            C        ;
  1105       0006 C         B5_R6	==	0X06
  1106       0006 C         UARC2	==	0X06
  1107            C        ;
  1108            C        	;{
  1109       0005 C        		UARTE	==  0X05  ; UART Function Enable
  1110       0003 C        		UINVEN	==  0X03  ; Enable UART TX and RX Port Inverse Ouput
  1111            C        				  ; other Bits is "0"
  1112            C        	;}
  1113            C        ;
  1114            C        ; Bank5 R7 (PORT7 Pull High Control Register)
  1115            C        ;
  1116       0007 C         B5_R7	==	0X07
  1117       0007 C         P7PHCR	==	0X07
  1118            C        ;
  1119            C        	;{
  1120       0007 C        		PH77	==  0X07 ;
  1121       0006 C        		PH76	==  0X06 ;
  1122       0005 C        		PH75	==  0X05 ;
  1123       0004 C        		PH74	==  0X04 ;
  1124       0003 C        		PH73	==  0X03 ;
  1125       0002 C        		PH72	==  0X02 ;
  1126       0001 C        		PH71	==  0X01 ;
  1127       0000 C        		PH70	==  0X00 ;
  1128            C        	;}
  1129            C        ;
  1130            C        ; Bank5 R8 (PORT8 Pull High Control Register)
  1131            C        ;
  1132       0008 C         B5_R8	==	0X08
  1133       0008 C         P8PHCR	==	0X08
  1134            C        ;
  1135            C        	;{
  1136       0007 C        		PH87	==  0X07 ;
  1137       0006 C        		PH86	==  0X06 ;
  1138       0005 C        		PH85	==  0X05 ;
  1139       0004 C        		PH84	==  0X04 ;
  1140       0003 C        		PH83	==  0X03 ;
  1141       0002 C        		PH82	==  0X02 ;
  1142       0001 C        		PH81	==  0X01 ;
  1143       0000 C        		PH80	==  0X00 ;
  1144            C        	;}
  1145            C        ;
  1146            C        ; Bank5 R9 (PORT9 Pull High Control Register)
  1147            C        ;
  1148       0009 C         B5_R9	==	0X09
  1149       0009 C         P9PHCR	==	0X09
  1150            C        ;
  1151            C        	;{
  1152       0007 C        		PH97	==  0X07 ;
  1153       0006 C        		PH96	==  0X06 ;
  1154       0005 C        		PH95	==  0X05 ;
  1155       0004 C        		PH94	==  0X04 ;
  1156       0003 C        		PH93	==  0X03 ;
  1157       0002 C        		PH92	==  0X02 ;
  1158       0001 C        		PH91	==  0X01 ;
  1159       0000 C        		PH90	==  0X00 ;
  1160            C        	;}
  1161            C        ;
  1162            C        ; Bank5 RA (PORTA Pull High Control Register)
  1163            C        ;
  1164       000A C         B5_RA	==	0X0A
  1165       000A C         PAPHCR	==	0X0A
  1166            C        ;
  1167            C        	;{
  1168       0007 C        		PHA7	==  0X07 ;
  1169       0006 C        		PHA6	==  0X06 ;
  1170       0005 C        		PHA5	==  0X05 ;
  1171       0004 C        		PHA4	==  0X04 ;
  1172       0003 C        		PHA3	==  0X03 ;
  1173       0002 C        		PHA2	==  0X02 ;
  1174       0001 C        		PHA1	==  0X01 ;
  1175       0000 C        		PHA0	==  0X00 ;
  1176            C        	;}
  1177            C        ;
  1178            C        ; Bank5 RB (PORTB Pull High Control Register)
  1179            C        ;
  1180       000B C         B5_RB	==	0X0B
  1181       000B C         PBPHCR	==	0X0B
  1182            C        ;
  1183            C        	;{
  1184       0007 C        		PHB7	==  0X07 ;
  1185       0006 C        		PHB6	==  0X06 ;
  1186       0005 C        		PHB5	==  0X05 ;
  1187       0004 C        		PHB4	==  0X04 ;
  1188       0003 C        		PHB3	==  0X03 ;
  1189       0002 C        		PHB2	==  0X02 ;
  1190       0001 C        		PHB1	==  0X01 ;
  1191       0000 C        		PHB0	==  0X00 ;
  1192            C        	;}
  1193            C        ;
  1194            C        ; Bank5 RC (PORTC Pull High Control Register)
  1195            C        ;
  1196       000C C         B5_RC	==	0X0C
  1197       000C C         PCPHCR	==	0X0C
  1198            C        ;
  1199            C        	;{
  1200       0003 C        		PHC3	==  0X03 ;
  1201       0002 C        		PHC2	==  0X02 ;
  1202       0001 C        		PHC1	==  0X01 ;
  1203       0000 C        		PHC0	==  0X00 ;
  1204            C        				 ; Other Bits is "0"
  1205            C        	;}
  1206            C        ;
  1207            C        ;  Bank6 R6 (Low Voltage Reset Control Register)
  1208            C        ;
  1209       0006 C         B6_R6  ==  0x06
  1210       0006 C         LVRCR  ==  0x06
  1211            C        ;
  1212            C            ;{
  1213       0002 C                LVREN   ==  0x02 ;
  1214       0001 C                LVRS1   ==  0x01 ;
  1215       0000 C                LVRS0   ==  0x00 ;
  1216            C            ;}
  1217            C        
  1218            C        ;  Bank6 R7 (PORT7 Open Drain Control Reister)
  1219            C        ;
  1220       0007 C         B6_R7	==	0X07
  1221       0007 C         P7ODCR	==	0X07
  1222            C        ;
  1223            C        	;{
  1224       0007 C        		P7OD7	==  0X07 ;
  1225       0006 C        		P7OD6	==  0X06 ;
  1226       0005 C        		P7OD5	==  0X05 ;
  1227       0004 C        		P7OD4	==  0X04 ;
  1228       0003 C        		P7OD3	==  0X03 ;
  1229       0002 C        		P7OD2	==  0X02 ;
  1230       0001 C        		P7OD1	==  0X01 ;
  1231       0000 C        		P7OD0	==  0X00 ;
  1232            C        	;}
  1233            C        ;
  1234            C        ;  Bank6 R8 (PORT8 Open Drain Control Reister)
  1235            C        ;
  1236       0008 C         B6_R8	==	0X08
  1237       0008 C         P8ODCR	==	0X08
  1238            C        ;
  1239            C        	;{
  1240       0007 C        		P8OD7	==  0X07 ;
  1241       0006 C        		P8OD6	==  0X06 ;
  1242       0005 C        		P8OD5	==  0X05 ;
  1243       0004 C        		P8OD4	==  0X04 ;
  1244       0003 C        		P8OD3	==  0X03 ;
  1245       0002 C        		P8OD2	==  0X02 ;
  1246       0001 C        		P8OD1	==  0X01 ;
  1247       0000 C        		P8OD0	==  0X00 ;
  1248            C        	;}
  1249            C        ;
  1250            C        ;  Bank6 R9 (PORT9 Open Drain Control Reister)
  1251            C        ;
  1252       0009 C         B6_R9	==	0X09
  1253       0009 C         P9ODCR	==	0X09
  1254            C        ;
  1255            C        	;{
  1256       0007 C        		P9OD7	==  0X07 ;
  1257       0006 C        		P9OD6	==  0X06 ;
  1258       0005 C        		P9OD5	==  0X05 ;
  1259       0004 C        		P9OD4	==  0X04 ;
  1260       0003 C        		P9OD3	==  0X03 ;
  1261       0002 C        		P9OD2	==  0X02 ;
  1262       0001 C        		P9OD1	==  0X01 ;
  1263       0000 C        		P9OD0	==  0X00 ;
  1264            C        	;}
  1265            C        ;
  1266            C        ;  Bank6 RA (PORTA Open Drain Control Reister)
  1267            C        ;
  1268       000A C         B6_RA	==	0X0A
  1269       000A C         PAODCR	==	0X0A
  1270            C        ;
  1271            C        	;{
  1272       0007 C        		PAOD7	==  0X07 ;
  1273       0006 C        		PAOD6	==  0X06 ;
  1274       0005 C        		PAOD5	==  0X05 ;
  1275       0004 C        		PAOD4	==  0X04 ;
  1276       0003 C        		PAOD3	==  0X03 ;
  1277       0002 C        		PAOD2	==  0X02 ;
  1278       0001 C        		PAOD1	==  0X01 ;
  1279       0000 C        		PAOD0	==  0X00 ;
  1280            C        	;}
  1281            C        ;
  1282            C        ;  Bank6 RB (PORTB Open Drain Control Reister)
  1283            C        ;
  1284       000B C         B6_RB	==	0X0B
  1285       000B C         PBODCR	==	0X0B
  1286            C        ;
  1287            C        	;{
  1288       0007 C        		PBOD7	==  0X07 ;
  1289       0006 C        		PBOD6	==  0X06 ;
  1290       0005 C        		PBOD5	==  0X05 ;
  1291       0004 C        		PBOD4	==  0X04 ;
  1292       0003 C        		PBOD3	==  0X03 ;
  1293       0002 C        		PBOD2	==  0X02 ;
  1294       0001 C        		PBOD1	==  0X01 ;
  1295       0000 C        		PBOD0	==  0X00 ;
  1296            C        	;}
  1297            C        ;
  1298            C        ;  Bank6 RC (PORTC Open Drain Control Reister)
  1299            C        ;
  1300       000C C         B6_RC	==	0X0C
  1301       000C C         PCODCR	==	0X0C
  1302            C        ;
  1303            C        	;{
  1304            C        				 ; Other
  1305       0003 C        		PCOD3	==  0X03 ;
  1306       0002 C        		PCOD2	==  0X02 ;
  1307       0001 C        		PCOD1	==  0X01 ;
  1308       0000 C        		PCOD0	==  0X00 ;
  1309            C        	;}
  1310            C        ;
  1311            C        ;======================================================;
  1312            C        ; Register R10~R3F                                     ;
  1313            C        ;======================================================;
  1314            C        ;
  1315            C        ; (R10 ~ R3F): General Purpose Register
  1316            C        ;
  1317       0010 C         R10    ==    0x10
  1318       0011 C         R11    ==    0x11
  1319       0012 C         R12    ==    0x12
  1320       0013 C         R13    ==    0x13
  1321       0014 C         R14    ==    0x14
  1322       0015 C         R15    ==    0x15
  1323       0016 C         R16    ==    0x16
  1324       0017 C         R17    ==    0x17
  1325       0018 C         R18    ==    0x18
  1326       0019 C         R19    ==    0x19
  1327       001A C         R1A    ==    0x1A
  1328       001B C         R1B    ==    0x1B
  1329       001C C         R1C    ==    0x1C
  1330       001D C         R1D    ==    0x1D
  1331       001E C         R1E    ==    0x1E
  1332       001F C         R1F    ==    0x1F
  1333            C        ;
  1334       0020 C         R20    ==    0x20
  1335       0021 C         R21    ==    0x21
  1336       0022 C         R22    ==    0x22
  1337       0023 C         R23    ==    0x23
  1338       0024 C         R24    ==    0x24
  1339       0025 C         R25    ==    0x25
  1340       0026 C         R26    ==    0x26
  1341       0027 C         R27    ==    0x27
  1342       0028 C         R28    ==    0x28
  1343       0029 C         R29    ==    0x29
  1344       002A C         R2A    ==    0x2A
  1345       002B C         R2B    ==    0x2B
  1346       002C C         R2C    ==    0x2C
  1347       002D C         R2D    ==    0x2D
  1348       002E C         R2E    ==    0x2E
  1349       002F C         R2F    ==    0x2F
  1350            C        ;
  1351       0030 C         R30    ==    0x30
  1352       0031 C         R31    ==    0x31
  1353       0032 C         R32    ==    0x32
  1354       0033 C         R33    ==    0x33
  1355       0034 C         R34    ==    0x34
  1356       0035 C         R35    ==    0x35
  1357       0036 C         R36    ==    0x36
  1358       0037 C         R37    ==    0x37
  1359       0038 C         R38    ==    0x38
  1360       0039 C         R39    ==    0x39
  1361       003A C         R3A    ==    0x3A
  1362       003B C         R3B    ==    0x3B
  1363       003C C         R3C    ==    0x3C
  1364       003D C         R3D    ==    0x3D
  1365       003E C         R3E    ==    0x3E
  1366       003F C         R3F    ==    0x3F
  1367            C        
    13                     include "D:\include\EM78xx\inc\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        ;**********************************************************************;
    18            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    19            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    20            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    21            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    22            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    23            C        ; Input:       reg_acc1                                                ;
    24            C        ; Output:      reg_acc3, reg_acc2                                      ;
    25            C        ; Variable Register:None                                               ;
    26            C        ; Register Changed: R3, 0 ;ACC                                         ;
    27            C        ;**********************************************************************;
    28            C        ;-----------------------------------------------------------------
    29            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    30            C        ;
    31            C                CLR     reg_acc2        ;clear BCD data register
    32            C                CLR     reg_acc3
    33            C                MOV     A, reg_acc1
    34            C        $Bin_Bcd1:
    35            C                ADD     A, @156         ;subtract 100 from binary that is transform
    36            C                JBS     STATUS, C       ;borrow bigit?
    37            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    38            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    39            C                JMP     $Bin_Bcd1       ;backing out
    40            C        $Bin_Bcd2:
    41            C                ADD     A, @100         ;100
    42            C                MOV     reg_acc1, A
    43            C        $Bin_Bcd3:
    44            C                ADD     A, @246         ;10
    45            C                JBS     STATUS, C       ;
    46            C                JMP     $Bin_Bcd4       ;
    47            C                INC     reg_acc2        ;BCD1
    48            C                JMP     $Bin_Bcd3
    49            C        $Bin_Bcd4:
    50            C                ADD     A, @10          ;10
    51            C                SWAP    reg_acc2        ;BCDreg_acc2
    52            C                ADD     reg_acc2, A     ;BCDreg_acc2
    53            C                ENDM
    54            C        ;
    55            C        ;**********************************************************************;
    56            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    57            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    58            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    59            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    60            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    61            C        ; Input:       reg_acc1, reg_acc2                                      ;
    62            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    63            C        ; Variable Register:reg_acc, reg_accd                                  ;
    64            C        ; Register Changed: R3, 0; ACC                                         ;
    65            C        ; Status:      1                                                       ;
    66            C        ;**********************************************************************;
    67            C        ;
    68            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    69            C        ;
    70            C                MOV     A, @16          ;(=byte*8)
    71            C                MOV     reg_acc, A
    72            C                CLR     reg_acc5        ;BCD
    73            C                CLR     reg_acc4
    74            C                CLR     reg_acc3
    75            C                BC      STATUS, C       ;R3C
    76            C        $Bin_Bcd1:
    77            C                RLC     reg_acc1        ;
    78            C                RLC     reg_acc2        ;
    79            C                RLC     reg_acc3        ;BCD
    80            C                RLC     reg_acc4
    81            C                RLC     reg_acc5        ;BCD
    82            C                DJZ     reg_acc         ;
    83            C                JMP     $Bin_Bcd2       ;BCD
    84            C                JMP     $Bin_Bcd3       ;
    85            C        $Bin_Bcd2:
    86            C                MOV     A, reg_acc3     ;reg_acc3BCD
    87            C                CALL    $bcdadj         ;BCD
    88            C                MOV     reg_acc3, A     ;
    89            C                MOV     A, reg_acc4     ;reg_acc4BCD
    90            C                CALL    $BCDADJ
    91            C                MOV     reg_acc4, A
    92            C                MOV     A, reg_acc5     ;reg_acc5BCD
    93            C                CALL    $BCDADJ
    94            C                MOV     reg_acc5, A
    95            C                JMP     $Bin_Bcd1       ;
    96            C        ;-------BCD Code Adjust Subprogram---------------
    97            C        $BCDADJ:
    98            C                ADD     A, @51
    99            C                MOV     reg_accd, A
   100            C                JBS     reg_accd, 3
   101            C                ADD     A, @253
   102            C                JBS     reg_accd, 7
   103            C                ADD     A, @208
   104            C                RET
   105            C        $Bin_Bcd3:
   106            C                ENDM
   107            C        ;
   108            C        ;**********************************************************************;
   109            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   110            C        ; Description:reg_acc7BCD                    ;
   111            C        ;             reg_acc4BCD,                     ;
   112            C        ;             reg_acc3                         ;
   113            C        ;             reg_acc1                         ;
   114            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   115            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   116            C        ; Variable Register:reg_acc, reg_accd                                  ;
   117            C        ; Register Changed: R3, 0;ACC                                          ;
   118            C        ; stack:      1                                                        ;
   119            C        ;**********************************************************************;
   120            C        ;
   121            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   122            C        ;
   123            C                MOV     A, @24          ;=byte*8)
   124            C                MOV     reg_acc, A
   125            C                CLR     reg_acc4
   126            C                CLR     reg_acc5
   127            C                CLR     reg_acc6
   128            C                CLR     reg_acc7
   129            C                BC      STATUS, C       ;R3C
   130            C        $Bin_Bcd1:
   131            C                RLC     reg_acc1        ;
   132            C                RLC     reg_acc2
   133            C                RLC     reg_acc3        ;
   134            C                RLC     reg_acc4        ;BCD
   135            C                RLC     reg_acc5
   136            C                RLC     reg_acc6
   137            C                RLC     reg_acc7        ;BCD
   138            C                DJZ     reg_acc         ;
   139            C                JMP     $Bin_Bcd2       ;BCD
   140            C                JMP     $Bin_Bcd3       ;
   141            C        $Bin_Bcd2:
   142            C                MOV     A, reg_acc4     ;reg_acc4BCD
   143            C                CALL    $BCDADJ         ;BCD
   144            C                MOV     reg_acc4, A
   145            C                MOV     A, reg_acc5     ;reg_acc5BCD
   146            C                CALL    $BCDADJ
   147            C                MOV     reg_acc5, A
   148            C                MOV     A, reg_acc6     ;reg_acc6BCD
   149            C                CALL    $BCDADJ
   150            C                MOV     reg_acc6, A
   151            C                MOV     A, reg_acc7     ;reg_acc7BCD
   152            C                CALL    $BCDADJ
   153            C                MOV     reg_acc7, A
   154            C                JMP     $Bin_Bcd1       ;
   155            C        ;-------BCD Code Adjust Subprogram---------------
   156            C        $BCDADJ:
   157            C                ADD     A, @51
   158            C                MOV     reg_accd, A
   159            C                JBS     reg_accd, 3
   160            C                ADD     A, @253
   161            C                JBS     reg_accd, 7
   162            C                ADD     A, @208
   163            C                RET
   164            C        $Bin_Bcd3:
   165            C                ENDM
   166            C        ;
   167            C        ;**********************************************************************;
   168            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   169            C        ; Description:reg_acc9BCD                    ;
   170            C        ;             reg_acc5BCD                    ;
   171            C        ;             reg_acc4                         ;
   172            C        ;             reg_acc1?                          ;
   173            C        ; Arithmetic:                                                          ;
   174            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   175            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   176            C        ; Variable Register:reg_acc, reg_accd                                  ;
   177            C        ; Register Changed: R3, 0; ACC                                         ;
   178            C        ; stack:      1                                                        ;
   179            C        ;**********************************************************************;
   180            C        ;
   181            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   182            C        ;
   183            C                MOV     A,  @32         ;(=byte*8)
   184            C                MOV     reg_acc, A
   185            C                CLR     reg_acc5        ;BCD
   186            C                CLR     reg_acc6
   187            C                CLR     reg_acc7
   188            C                CLR     reg_acc8
   189            C                CLR     reg_acc9
   190            C                BC      STATUS, C       ;R3C
   191            C        $Bin_Bcd1:
   192            C                RLC     reg_acc1        ;
   193            C                RLC     reg_acc2
   194            C                RLC     reg_acc3
   195            C                RLC     reg_acc4        ;
   196            C                RLC     reg_acc5
   197            C                RLC     reg_acc6        ;BCD
   198            C                RLC     reg_acc7
   199            C                RLC     reg_acc8
   200            C                RLC     reg_acc9        ;BCD
   201            C                DJZ     reg_acc         ;
   202            C                JMP     $Bin_Bcd2       ;BCD
   203            C                JMP     $Bin_Bcd3       ;
   204            C        $Bin_Bcd2:
   205            C                MOV     A, reg_acc5     ;reg_acc5BCD
   206            C                CALL    $BCDADJ         ;BCD
   207            C                MOV     reg_acc5, A
   208            C                MOV     A, reg_acc6     ;reg_acc6BCD
   209            C                CALL    $BCDADJ
   210            C                MOV     reg_acc6, A
   211            C                MOV     A, reg_acc7     ;reg_acc7BCD
   212            C                CALL    $BCDADJ
   213            C                MOV     reg_acc7, A
   214            C                MOV     A, reg_acc8     ;reg_acc8BCD
   215            C                CALL    $BCDADJ
   216            C                MOV     reg_acc8, A
   217            C                MOV     A, reg_acc9     ;reg_acc9BCD
   218            C                CALL    $BCDADJ
   219            C                MOV     reg_acc9, A
   220            C                JMP     $Bin_Bcd1       ;
   221            C        ;-------BCD Code Adjust Subprogram---------------
   222            C        $BCDADJ:
   223            C                ADD     A, @51
   224            C                MOV     reg_accd, A
   225            C                JBS     reg_accd, 3
   226            C                ADD     A, @253
   227            C                JBS     reg_accd, 7
   228            C                ADD     A, @208
   229            C                RET
   230            C        $Bin_Bcd3:
   231            C                ENDM
   232            C        ;**********************************************************************;
   233            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   234            C        ; Description:reg_acccBCD                      ;
   235            C        ;             reg_acc6BCD                      ;
   236            C        ;             reg_acc5                         ;
   237            C        ;             reg_acc1                         ;
   238            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   239            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   240            C        ;             reg_accb, reg_accc                                       ;
   241            C        ; Variable Register:reg_acc, reg_accd                                  ;
   242            C        ; Register Changed: R3, 0;ACC                                          ;
   243            C        ; Stack:      1                                                        ;
   244            C        ;**********************************************************************;
   245            C        ;
   246            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   247            C        ;
   248            C                MOV     A,  @40         ;(=byte*8)
   249            C                MOV     reg_acc, A
   250            C                CLR     reg_acc6        ;BCD
   251            C                CLR     reg_acc7
   252            C                CLR     reg_acc8
   253            C                CLR     reg_acc9
   254            C                CLR     reg_acca
   255            C                CLR     reg_accb
   256            C                CLR     reg_accc
   257            C                BC      STATUS, C       ;R3C
   258            C        $Bin_Bcd1:
   259            C                RLC     reg_acc1
   260            C                RLC     reg_acc2
   261            C                RLC     reg_acc3        ;
   262            C                RLC     reg_acc4        ;
   263            C                RLC     reg_acc5        ;
   264            C        ;
   265            C                RLC     reg_acc6        ;BCD
   266            C                RLC     reg_acc7
   267            C                RLC     reg_acc8
   268            C                RLC     reg_acc9
   269            C                RLC     reg_acca
   270            C                RLC     reg_accb
   271            C                RLC     reg_accc        ;BCD
   272            C                DJZ     reg_acc         ;
   273            C                JMP     $Bin_Bcd2       ;BCD
   274            C                JMP     $Bin_Bcd3       ;
   275            C        $Bin_Bcd2:
   276            C                MOV     A, reg_acc6     ;reg_acc6BCD
   277            C                CALL    $BCDADJ         ;BCD
   278            C                MOV     reg_acc6, A
   279            C                MOV     A, reg_acc7     ;reg_acc7BCD
   280            C                CALL    $BCDADJ
   281            C                MOV     reg_acc7, A
   282            C                MOV     A, reg_acc8     ;reg_acc8BCD
   283            C                CALL    $BCDADJ
   284            C                MOV     reg_acc8, A
   285            C                MOV     A, reg_acc9     ;reg_acc9BCD
   286            C                CALL    $BCDADJ
   287            C                MOV     reg_acc9, A
   288            C                MOV     A, reg_acca     ;reg_accaBCD
   289            C                CALL    $BCDADJ
   290            C                MOV     reg_acca, A
   291            C                MOV     A, reg_accb     ;reg_accbBCD
   292            C                CALL    $BCDADJ
   293            C                MOV     reg_accb, A
   294            C                MOV     A, reg_accc     ;reg_acccBCD
   295            C                CALL    $BCDADJ
   296            C                MOV     reg_accc, A
   297            C                JMP     $Bin_Bcd1       ;
   298            C        ;
   299            C        ;-------BCD Code Adjust Subprogram---------------
   300            C        $BCDADJ:
   301            C                ADD     A, @51
   302            C                MOV     reg_accd, A
   303            C                JBS     reg_accd, 3
   304            C                ADD     A, @253
   305            C                JBS     reg_accd, 7
   306            C                ADD     A, @208
   307            C                RET
   308            C        $Bin_Bcd3:
   309            C                ENDM
   310            C        ;
   311            C        ;**********************************************************************;
   312            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   313            C        ; Input:      reg_acc1(BCD code)                                       ;
   314            C        ; Output:     reg_acc2(Binary Code)                                    ;
   315            C        ; Register Changed: STATUS, C;ACC                                      ;
   316            C        ;**********************************************************************;
   317            C        ;
   318            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   319            C        ;
   320            C                CLR     reg_acc2
   321            C                SWAPA   reg_acc1        ;reg_acc1A
   322            C                AND     A, @0X0F        ;reg_acc1, 0-3bit.
   323            C                MOV     reg_acc2, A
   324            C                BC      STATUS, C
   325            C                RLC     reg_acc2        ;reg_acc2*10
   326            C                RLC     reg_acc2
   327            C                ADD     reg_acc2, A
   328            C                RLC     reg_acc2
   329            C                MOV     A, reg_acc1
   330            C                AND     A, @0X0F        ;reg_acc1, 4-7bit
   331            C                ADD     reg_acc2, A     ;bcd code10bcd code
   332            C                ENDM
   333            C        ;
   334            C        ;**********************************************************************;
   335            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   336            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   337            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   338            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   339            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   340            C        ; Register Changed: STATUS, C; ACC                                     ;
   341            C        ; Stack:     1                                                         ;
   342            C        ;**********************************************************************;
   343            C        ;
   344            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   345            C        ;
   346            C                CLR     reg_acc3        ;clear binary code register
   347            C                CLR     reg_acc4
   348            C                MOV     A, @16          ;reg_acc==byte*8)
   349            C                Mov     reg_acc, A
   350            C        $Bcd_Bin1:
   351            C                BC      STATUS, C
   352            C                RRC     reg_acc2        ;BCDBINARY
   353            C                RRC     reg_acc1
   354            C                RRC     reg_acc4
   355            C                RRC     reg_acc3
   356            C                MOV     A, reg_acc1     ;BCDBCD
   357            C                CALL    $Binadj
   358            C                MOV     reg_acc1, A
   359            C                MOV     A, reg_acc2
   360            C                CALL    $Binadj
   361            C                MOV     reg_acc2, A
   362            C                DJZ     reg_acc
   363            C                JMP     $Bcd_Bin1
   364            C                JMP     $Bcd_Bin2
   365            C        $Binadj:
   366            C                MOV     reg_accd, A
   367            C                JBC     reg_accd, 3
   368            C                ADD     A, @253
   369            C                JBC     reg_accd, 7
   370            C                ADD     A, @208
   371            C                RET
   372            C        $Bcd_Bin2:
   373            C                ENDM
   374            C        ;
   375            C        ;**********************************************************************;
   376            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   377            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   378            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   379            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   380            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   381            C        ; Register Changed: STATUS, C; ACC                                     ;
   382            C        ; Stack:     1                                                         ;
   383            C        ;**********************************************************************;
   384            C        ;
   385            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   386            C        ;
   387            C                CLR     reg_acc4
   388            C                CLR     reg_acc5
   389            C                CLR     reg_acc6
   390            C                MOV     A, @24          ;reg_acc==BYTE*8)
   391            C                MOV     reg_acc, A
   392            C        $Bcd_Bin1:
   393            C                BC      STATUS, C
   394            C                RRC     reg_acc3
   395            C                RRC     reg_acc2
   396            C                RRC     reg_acc1
   397            C                RRC     reg_acc6
   398            C                RRC     reg_acc5
   399            C                RRC     reg_acc4
   400            C                MOV     A, reg_acc1
   401            C                CALL    $Binadj
   402            C                MOV     reg_acc1, A
   403            C                MOV     A, reg_acc2
   404            C                CALL    $Binadj
   405            C                MOV     reg_acc2, A
   406            C                MOV     A, reg_acc3
   407            C                CALL    $Binadj
   408            C                MOV     reg_acc3, A
   409            C                DJZ     reg_acc
   410            C                JMP     $Bcd_Bin1
   411            C                JMP     $Bcd_Bin2
   412            C        $Binadj:
   413            C                MOV     reg_accd, A
   414            C                JBC     reg_accd, 3
   415            C                ADD     A, @253
   416            C                JBC     reg_accd, 7
   417            C                ADD     A, @208
   418            C                RET
   419            C        $Bcd_Bin2:
   420            C                ENDM
   421            C        ;
   422            C        ;**********************************************************************;
   423            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   424            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   425            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   426            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   427            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   428            C        ; Register Changed: STATUS, C;ACC                                      ;
   429            C        ; Stack:     1                                                         ;
   430            C        ;**********************************************************************;
   431            C        ;
   432            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   433            C        ;
   434            C                CLR     reg_acc5
   435            C                CLR     reg_acc6
   436            C                CLR     reg_acc7
   437            C                CLR     reg_acc8
   438            C                MOV     A, @32          ;reg_acc==BYTE*8)
   439            C                MOV     reg_acc, A
   440            C        $Bcd_Bin1:
   441            C                BC      STATUS, C
   442            C                RRC     reg_acc4
   443            C                RRC     reg_acc3
   444            C                RRC     reg_acc2
   445            C                RRC     reg_acc1
   446            C                RRC     reg_acc8
   447            C                RRC     reg_acc7
   448            C                RRC     reg_acc6
   449            C                RRC     reg_acc5
   450            C                MOV     A, reg_acc1
   451            C                CALL    $Binadj
   452            C                MOV     reg_acc1, A
   453            C                MOV     A, reg_acc2
   454            C                CALL    $Binadj
   455            C                MOV     reg_acc2, A
   456            C                MOV     A, reg_acc3
   457            C                CALL    $Binadj
   458            C                MOV     reg_acc3, A
   459            C                MOV     A, reg_acc4
   460            C                CALL    $Binadj
   461            C                MOV     reg_acc4, A
   462            C                DJZ     reg_acc
   463            C                JMP     $Bcd_Bin1
   464            C                JMP     $Bcd_Bin2
   465            C        $Binadj:
   466            C                MOV     reg_accd, A
   467            C                JBC     reg_accd, 3
   468            C                ADD     A, @253
   469            C                JBC     reg_accd, 7
   470            C                ADD     A, @208
   471            C                RET
   472            C        $Bcd_Bin2:
   473            C                ENDM
   474            C        ;
   475            C        ;**********************************************************************;
   476            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   477            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   478            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   479            C        ;            Bcd Code.                                                 ;
   480            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   481            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   482            C        ;            Of Binary Code.                                           ;
   483            C        ; Register Changed: STATUS, C; ACC                                     ;
   484            C        ; Stack:     1                                                         ;
   485            C        ;**********************************************************************;
   486            C        ;
   487            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   488            C        ;
   489            C                CLR     reg_acc6
   490            C                CLR     reg_acc7
   491            C                CLR     reg_acc8
   492            C                CLR     reg_acc9
   493            C                CLR     reg_acca
   494            C                MOV     A, @40          ;reg_acc==BYTE*8)
   495            C                MOV     reg_acc, A
   496            C        $Bcd_Bin1:
   497            C                BC      STATUS, C
   498            C                RRC     reg_acc5
   499            C                RRC     reg_acc4
   500            C                RRC     reg_acc3
   501            C                RRC     reg_acc2
   502            C                RRC     reg_acc1
   503            C                RRC     reg_acca
   504            C                RRC     reg_acc9
   505            C                RRC     reg_acc8
   506            C                RRC     reg_acc7
   507            C                RRC     reg_acc6
   508            C                MOV     A, reg_acc1
   509            C                CALL    $Binadj
   510            C                MOV     reg_acc1, A
   511            C                MOV     A, reg_acc2
   512            C                CALL    $Binadj
   513            C                MOV     reg_acc2, A
   514            C                MOV     A, reg_acc3
   515            C                CALL    $Binadj
   516            C                MOV     reg_acc3, A
   517            C                MOV     A, reg_acc4
   518            C                CALL    $Binadj
   519            C                MOV     reg_acc4, A
   520            C                MOV     A, reg_acc5
   521            C                CALL    $Binadj
   522            C                MOV     reg_acc5, A
   523            C                DJZ     reg_acc
   524            C                JMP     $Bcd_Bin1
   525            C                JMP     $Bcd_Bin2
   526            C        $Binadj:
   527            C                MOV     reg_accd, A
   528            C                JBC     reg_accd, 3
   529            C                ADD     A, @253
   530            C                JBC     reg_accd, 7
   531            C                ADD     A, @208
   532            C                RET
   533            C        $Bcd_Bin2:
   534            C                ENDM
   535            C        
   536            C        
   537            C        ;*****************************************************************
   538            C        ;Function:    Subtration
   539            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   540            C        ;Output:      reg_acc2, reg_acc1
   541            C        ;description: reg_acc2/reg_acc1 is the reslut;
   542            C        ;             reg_acc3 is a symbol:
   543            C        ;             0X00 Mean reslut is plus
   544            C        ;             0X01 Mean reslut is negative
   545            C        ;*****************************************************************
   546            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   547            C                BC      STATUS,C
   548            C                MOV     A,reg_acc3
   549            C                SUB     reg_acc1,A
   550            C                JBC     STATUS,C
   551            C                JMP     Subtration_End  
   552            C                CLR     reg_acc3
   553            C                MOV     A,@0X01
   554            C                SUB     A,reg_acc2
   555            C                JBC     STATUS,C
   556            C                DEC     reg_acc2
   557            C                JBC     STATUS,C
   558            C                INC     reg_acc3        
   559            C        Subtration_End:
   560            C                ENDM
   561            C        
   562            C        ;**********************************************************************;
   563            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   564            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   565            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   566            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   567            C        ; Variable Register:None                                               ;
   568            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   569            C        ;**********************************************************************;
   570            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   571            C        ;
   572            C                MOV     A, @8           ;Recurrence Cortrol Data
   573            C                MOV     reg_acc, A
   574            C                CLRA                    ;Check Divisor Is Zero
   575            C                OR      A, reg_acc2     ;Divisor load into A register
   576            C                JBC     STATUS, 2
   577            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   578            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin PerationThen A=1
   579            C        $_Div_Sub:
   580            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   581            C                RLC     reg_acc2
   582            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   583            C                SUB     reg_acc2, a
   584            C                JBC     STATUS, C
   585            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   586            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   587            C                ADD     reg_acc2, A     ;Revert Dividend
   588            C        $_Div_Cnt:
   589            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   590            C                JMP     $_Div_Sub
   591            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   592            C        $_Div_Out:
   593            C                ENDM
   594            C        ;
   595            C        ;**********************************************************************;
   596            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   597            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   598            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   599            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   600            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   601            C        ; Variable Register:None                                               ;
   602            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   603            C        ;**********************************************************************;
   604            C        ;
   605            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   606            C        ;
   607            C                MOV     A, @16          ;Recurrence Cortrol Data
   608            C                MOV     reg_acc, A
   609            C                CLRA                    ;Check Divisor Is Zero
   610            C                OR      A, reg_acc3     ;Divisor load into A register
   611            C                JBC     STATUS, Z
   612            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   613            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin PerationThen A=1
   614            C        $_Div_Sub:
   615            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   616            C                RLC     reg_acc2
   617            C                RLC     reg_acc3
   618            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   619            C                JBS     STATUS, C
   620            C                JMP     $_Div_S_0
   621            C                SUB     reg_acc3, A
   622            C                JMP     $_Div_Cnt
   623            C        $_Div_S_0:
   624            C                SUB     reg_acc3, A
   625            C                JBC     STATUS, C
   626            C                JMP     $_Div_Cnt
   627            C                BC      reg_acc1, 0
   628            C                ADD     reg_acc3, A
   629            C        $_Div_Cnt:
   630            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   631            C                JMP     $_Div_Sub
   632            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   633            C        $_Div_Out:
   634            C                ENDM
   635            C        ;
   636            C        ;**********************************************************************;
   637            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   638            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   639            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   640            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   641            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   642            C        ; Variable Register:None                                               ;
   643            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   644            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   645            C        ;**********************************************************************;
   646            C        ;
   647            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   648            C        ;
   649            C                CLRA
   650            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   651            C                OR      A, reg_acc4
   652            C                JBC     STATUS, Z
   653            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   654            C                MOV     A, @16          ;Recurrence Cortrol Data
   655            C                MOV     reg_acc, A
   656            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1
   657            C                CLR     reg_acc6
   658            C        $_Div_Sub:
   659            C                BC      STATUS, C       ;Clear c Flag
   660            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   661            C                RLC     reg_acc2
   662            C                RLC     reg_acc5
   663            C                RLC     reg_acc6
   664            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   665            C                SUB     A, reg_acc6     ;Check High Word  Equal
   666            C                JBS     STATUS, Z
   667            C                JMP     $_Div_Set
   668            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   669            C                SUB     A, reg_acc5
   670            C        $_Div_Set:
   671            C                JBS     STATUS, C
   672            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   673            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   674            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   675            C                SUB     reg_acc5, A     ;Save Diviso
   676            C                JBS     STATUS, C
   677            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   678            C                MOV     A, reg_acc4
   679            C                SUB     reg_acc6, A
   680            C        $_Div_S_0:
   681            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   682            C                JMP     $_Div_Sub
   683            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   684            C                MOV     reg_acc4, A
   685            C                MOV     A, reg_acc5
   686            C                MOV     reg_acc3, A
   687            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   688            C        $_Div_Out:
   689            C                ENDM
   690            C        ;
   691            C        ;**********************************************************************;
   692            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   693            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   694            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   695            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   696            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   697            C        ; Variable Register:None                                               ;
   698            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   699            C        ;**********************************************************************;
   700            C        ;
   701            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   702            C        ;
   703            C                MOV     A, @24          ;Recurrence Cortrol Data
   704            C                MOV     reg_acc, A
   705            C                CLRA                    ;Check Divisor Is Zero
   706            C                OR      A, reg_acc4     ;Divisor load into A register
   707            C                JBC     STATUS, Z
   708            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   709            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin PerationThen A=1
   710            C        $_Div_Sub:
   711            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   712            C                RLC     reg_acc2
   713            C                RLC     reg_acc3
   714            C                RLC     reg_acc4
   715            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   716            C                JBS     STATUS, C
   717            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   718            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   719            C                JMP     $_Div_Cnt
   720            C        $_Div_S_0:
   721            C                SUB     reg_acc4, A
   722            C                JBC     STATUS, C
   723            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   724            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   725            C                ADD     reg_acc4, A     ;Revert Dividend
   726            C        $_Div_Cnt:
   727            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   728            C                JMP     $_Div_Sub
   729            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   730            C        $_Div_Out:
   731            C                ENDM
   732            C        ;
   733            C        ;**********************************************************************;
   734            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   735            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   736            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   737            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   738            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   739            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   740            C        ;               Remainder reg_acc5, reg_acc4                           ;
   741            C        ; Variable Register: None                                              ;
   742            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   743            C        ;                   , reg_acc7(0x27)                                   ;
   744            C        ;**********************************************************************;
   745            C        ;
   746            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   747            C        ;
   748            C                CLRA
   749            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   750            C                OR      A, reg_acc5
   751            C                JBC     STATUS, Z
   752            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   753            C                MOV     A, @24          ;Recurrence Cortrol Data
   754            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   755            C                CLR     reg_acc6        ;clear Remainder register
   756            C                CLR     reg_acc7
   757            C        $_Div_Sub:
   758            C                BC      STATUS, C       ;Clear c Flag
   759            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   760            C                RLC     reg_acc2
   761            C                RLC     reg_acc3
   762            C                RLC     reg_acc6
   763            C                RLC     reg_acc7
   764            C                JBC     STATUS, C
   765            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   766            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   767            C                SUB     A, reg_acc7     ;Check High Word  Equal
   768            C                JBS     STATUS, Z
   769            C                JMP     $_Div_Set
   770            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   771            C                SUB     A, reg_acc6
   772            C        $_Div_Set:
   773            C                JBS     STATUS, C
   774            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   775            C        $_Div_Set_1:
   776            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   777            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   778            C                SUB     reg_acc6, A     ;Save Diviso
   779            C                JBS     STATUS, C
   780            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   781            C                MOV     A, reg_acc5
   782            C                SUB     reg_acc7, A
   783            C        $_Div_S_0:
   784            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   785            C                JMP     $_Div_Sub
   786            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   787            C                MOV     reg_acc5, A
   788            C                MOV     A, reg_acc6
   789            C                MOV     reg_acc4, A
   790            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   791            C        $_Div_Out:
   792            C                ENDM
   793            C        ;
   794            C        ;**********************************************************************;
   795            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   796            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   797            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   798            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   799            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   800            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   801            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   802            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   803            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   804            C        ; Variable Register:None                                               ;
   805            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   806            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   807            C        ;**********************************************************************;
   808            C        ;
   809            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   810            C        ;
   811            C                CLRA
   812            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   813            C                OR      A, reg_acc5
   814            C                OR      A, reg_acc6
   815            C                JBC     STATUS, Z
   816            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   817            C                MOV     A, @24          ;Recurrence Cortrol Data
   818            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   819            C                CLR     reg_acc7        ;clear Remainder register
   820            C                CLR     reg_acc8
   821            C                CLR     reg_acc9
   822            C        $_Div_Sub:
   823            C                BC      STATUS, C       ;Clear c Flag
   824            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   825            C                RLC     reg_acc2
   826            C                RLC     reg_acc3
   827            C                RLC     reg_acc7
   828            C                RLC     reg_acc8
   829            C                RLC     reg_acc9
   830            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   831            C                SUB     A, reg_acc9     ;Check High Word  Equal
   832            C                JBS     STATUS, Z
   833            C                JMP     $_Div_Set
   834            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   835            C                SUB     A, reg_acc8
   836            C                JBS     STATUS, Z
   837            C                JMP     $_Div_Set
   838            C                MOV     A, reg_acc4
   839            C                SUB     A, reg_acc7
   840            C        $_Div_Set:
   841            C                JBS     STATUS, C
   842            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   843            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   844            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   845            C                SUB     reg_acc7, A     ;Save Diviso
   846            C                JBS     STATUS, C
   847            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   848            C                MOV     A, reg_acc5
   849            C                SUB     reg_acc8, A
   850            C                JBS     STATUS, C
   851            C                DEC     reg_acc9
   852            C                MOV     A, reg_acc6
   853            C                SUB     reg_acc9, A
   854            C        $_Div_S_0:
   855            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   856            C                JMP     $_Div_Sub
   857            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   858            C                MOV     reg_acc6, A
   859            C                MOV     A, reg_acc8
   860            C                MOV     reg_acc5, A
   861            C                MOV     A, reg_acc7
   862            C                MOV     reg_acc4, A
   863            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   864            C        $_Div_Out:
   865            C                ENDM
   866            C        ;
   867            C        ;**********************************************************************;
   868            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   869            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   870            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   871            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   872            C        ;               Divisor   reg_acc5                                     ;
   873            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   874            C        ;               Remainder reg_acc5                                     ;
   875            C        ; Variable Register:None                                               ;
   876            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   877            C        ;**********************************************************************;
   878            C        ;
   879            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   880            C        ;
   881            C                MOV     A, @32          ;Recurrence Cortrol Data
   882            C                MOV     reg_acc, A
   883            C                CLRA                    ;Check Divisor Is Zero
   884            C                OR      A, reg_acc5     ;Divisor load into A register
   885            C                JBC     STATUS, Z
   886            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   887            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1.
   888            C        $_Div_Sub:
   889            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   890            C                RLC     reg_acc2
   891            C                RLC     reg_acc3
   892            C                RLC     reg_acc4
   893            C                RLC     reg_acc5
   894            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   895            C                JBS     STATUS, C
   896            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   897            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   898            C                JMP     $_Div_Cnt
   899            C        $_Div_S_0:
   900            C                SUB     reg_acc5, A
   901            C                JBC     STATUS, C
   902            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   903            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   904            C                ADD     reg_acc5, A     ;Revert Dividend
   905            C        $_Div_Cnt:
   906            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   907            C                JMP     $_Div_Sub
   908            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   909            C        $_Div_Out:
   910            C                ENDM
   911            C        ;
   912            C        ;**********************************************************************;
   913            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   914            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   915            C        ;               (reg_acc6, reg_acc5)                                   ;
   916            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   917            C        ;               --(reg_acc6, reg_acc5)                                 ;
   918            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   919            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   920            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   921            C        ;               Remainder reg_acc6, reg_acc5                           ;
   922            C        ; Variable Register:None                                               ;
   923            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   924            C        ;                   , reg_acc8(0x28)                                   ;
   925            C        ;**********************************************************************;
   926            C        ;
   927            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   928            C        ;
   929            C                CLRA
   930            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   931            C                OR      A, reg_acc5
   932            C                JBC     STATUS, Z
   933            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   934            C                MOV     A, @32          ;Recurrence Cortrol Data
   935            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   936            C                CLR     reg_acc7        ;clear Remainder register
   937            C                CLR     reg_acc8
   938            C        $_Div_Sub:
   939            C                BC      STATUS, C       ;Clear c Flag
   940            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   941            C                RLC     reg_acc2
   942            C                RLC     reg_acc3
   943            C                RLC     reg_acc4
   944            C                RLC     reg_acc7
   945            C                RLC     reg_acc8
   946            C                JBC     STATUS, C
   947            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   948            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   949            C                SUB     A, reg_acc8     ;Check High Word  Equal
   950            C                JBS     STATUS, Z
   951            C                JMP     $_Div_Set
   952            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   953            C                SUB     A, reg_acc7
   954            C        $_Div_Set:
   955            C                JBS     STATUS, C
   956            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   957            C        $_Div_Set_1:
   958            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   959            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   960            C                SUB     reg_acc7, A     ;Save Divisor
   961            C                JBS     STATUS, C
   962            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   963            C                MOV     A, reg_acc6
   964            C                SUB     reg_acc8, A
   965            C        $_Div_S_0:
   966            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   967            C                JMP     $_Div_Sub
   968            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   969            C                MOV     reg_acc6, A
   970            C                MOV     A, reg_acc7
   971            C                MOV     reg_acc5, A
   972            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   973            C        $_Div_Out:
   974            C                ENDM
   975            C        ;
   976            C        ;**********************************************************************;
   977            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   978            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   979            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   980            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   981            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   982            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   983            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   984            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   985            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   986            C        ; Variable Register:None                                               ;
   987            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   988            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   989            C        ;**********************************************************************;
   990            C        ;
   991            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   992            C        ;
   993            C                CLRA
   994            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   995            C                OR      A, reg_acc6
   996            C                OR      A, reg_acc5
   997            C                JBC     STATUS, Z
   998            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   999            C                MOV     A, @32          ;Recurrence Cortrol Data
  1000            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1001            C                CLR     reg_acc8        ;clear Remainder register
  1002            C                CLR     reg_acc9
  1003            C                CLR     reg_acca
  1004            C        $_Div_Sub:
  1005            C                BC      STATUS, 0       ;Clear c Flag
  1006            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1007            C                RLC     reg_acc2
  1008            C                RLC     reg_acc3
  1009            C                RLC     reg_acc4
  1010            C                RLC     reg_acc8
  1011            C                RLC     reg_acc9
  1012            C                RLC     reg_acca
  1013            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1014            C                JMP     $_Div_Set_1
  1015            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1016            C                SUB     A, reg_acca     ;Check High Word  Equal
  1017            C                JBS     STATUS, Z
  1018            C                JMP     $_Div_Set
  1019            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1020            C                SUB     A, reg_acc9
  1021            C                JBS     STATUS, Z
  1022            C                JMP     $_Div_Set
  1023            C                MOV     A, reg_acc5
  1024            C                SUB     A, reg_acc8
  1025            C        $_Div_Set:
  1026            C                JBS     STATUS, C
  1027            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1028            C        $_Div_Set_1:
  1029            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1030            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1031            C                SUB     reg_acc8, A     ;Save Divisor
  1032            C                JBS     STATUS, C
  1033            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1034            C                MOV     A, reg_acc6
  1035            C                SUB     reg_acc9, A
  1036            C                JBS     STATUS, C
  1037            C                DEC     reg_acca
  1038            C                MOV     A, reg_acc7
  1039            C                SUB     reg_acca, A
  1040            C        $_Div_S_0:
  1041            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1042            C                JMP     $_Div_Sub
  1043            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1044            C                MOV     reg_acc7, A
  1045            C                MOV     A, reg_acc9
  1046            C                MOV     reg_acc6, A
  1047            C                MOV     A, reg_acc8
  1048            C                MOV     reg_acc5, A
  1049            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1050            C        $_Div_Out:
  1051            C                ENDM
  1052            C        ;
  1053            C        ;**********************************************************************;
  1054            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1055            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1056            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1057            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1058            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1059            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1060            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1061            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1062            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1063            C        ; Variable Register:None                                               ;
  1064            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1065            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1066            C        ;**********************************************************************;
  1067            C        ;
  1068            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1069            C        ;
  1070            C                CLRA
  1071            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1072            C                OR      A, reg_acc7
  1073            C                OR      A, reg_acc6
  1074            C                OR      A, reg_acc5
  1075            C                JBC     STATUS, Z
  1076            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1077            C                MOV     A, @32          ;Recurrence Cortrol Data
  1078            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1079            C                CLR     reg_acc9        ;clear Remainder register
  1080            C                CLR     reg_acca
  1081            C                CLR     reg_accb
  1082            C                CLR     reg_accc
  1083            C        $_Div_Sub:
  1084            C                BC      STATUS, C       ;Clear c Flag
  1085            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1086            C                RLC     reg_acc2
  1087            C                RLC     reg_acc3
  1088            C                RLC     reg_acc4
  1089            C                RLC     reg_acc9
  1090            C                RLC     reg_acca
  1091            C                RLC     reg_accb
  1092            C                RLC     reg_accc
  1093            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1094            C                SUB     A, reg_accc     ;Check High Word  Equal
  1095            C                JBS     STATUS, Z
  1096            C                JMP     $_Div_Set
  1097            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1098            C                SUB     A, reg_accb
  1099            C                JBS     STATUS, Z
  1100            C                JMP     $_Div_Set
  1101            C                MOV     A, reg_acc6
  1102            C                SUB     A, reg_acca
  1103            C                JBS     STATUS, Z
  1104            C                JMP     $_Div_Set
  1105            C                MOV     A, reg_acc5
  1106            C                SUB     A, reg_acc9
  1107            C        $_Div_Set:
  1108            C                JBS     STATUS, C
  1109            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1110            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1111            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1112            C                SUB     reg_acc9, A     ;Save Divisor
  1113            C                JBS     STATUS, C
  1114            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1115            C                MOV     A, reg_acc6
  1116            C                SUB     reg_acca, A
  1117            C                JBS     STATUS, C
  1118            C                DEC     reg_accb
  1119            C                MOV     A, reg_acc7
  1120            C                SUB     reg_accb, A
  1121            C                JBS     STATUS, C
  1122            C                DEC     reg_accc
  1123            C                MOV     A, reg_acc8
  1124            C                SUB     reg_accc, A
  1125            C        $_Div_S_0:
  1126            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1127            C                JMP     $_Div_Sub
  1128            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1129            C                MOV     reg_acc8, A
  1130            C                MOV     A, reg_accb
  1131            C                MOV     reg_acc7, A
  1132            C                MOV     A, reg_acca
  1133            C                MOV     reg_acc6, A
  1134            C                MOV     A, reg_acc9
  1135            C                MOV     reg_acc5, A
  1136            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1137            C        $_Div_Out:
  1138            C                ENDM
  1139            C        ;
  1140            C        ;**********************************************************************;
  1141            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1142            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1143            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1144            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1145            C        ; Register change:reg_acc                                              ;
  1146            C        ;**********************************************************************;
  1147            C        ;
  1148            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1149            C        ;
  1150            C                MOV     A, @8
  1151            C                MOV     reg_acc, A
  1152            C                MOV     A, reg_acc2
  1153            C                CLR     reg_acc2
  1154            C        $Mul11_Loop:
  1155            C                BC      STATUS, C
  1156            C                JBC     reg_acc1, 0
  1157            C                ADD     reg_acc2, A
  1158            C                RRC     reg_acc2
  1159            C                RRC     reg_acc1
  1160            C        ;
  1161            C                DJZ     reg_acc
  1162            C                JMP     $Mul11_Loop
  1163            C                ENDM
  1164            C        ;
  1165            C        ;**********************************************************************;
  1166            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1167            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1168            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1169            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1170            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Register change:reg_acc                                              ;
  1172            C        ;**********************************************************************;
  1173            C        ;
  1174            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1175            C        ;
  1176            C                MOV     A, @16
  1177            C                MOV     reg_acc, A
  1178            C                MOV     A, reg_acc3
  1179            C                CLR     reg_acc3
  1180            C        $Mul12_Loop:
  1181            C                BC      STATUS, C
  1182            C                JBC     reg_acc1, 0
  1183            C                ADD     reg_acc3, A
  1184            C                RRC     reg_acc3
  1185            C                RRC     reg_acc2
  1186            C                RRC     reg_acc1
  1187            C        ;
  1188            C                DJZ     reg_acc
  1189            C                JMP     $Mul12_Loop
  1190            C                ENDM
  1191            C        ;
  1192            C        ;**********************************************************************;
  1193            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1194            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1195            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1196            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1197            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Register change:reg_acc                                              ;
  1199            C        ;**********************************************************************;
  1200            C        ;
  1201            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1202            C        ;
  1203            C                MOV     A, @24
  1204            C                MOV     reg_acc, A
  1205            C                MOV     A, reg_acc4
  1206            C                CLR     reg_acc4
  1207            C        $Mul13_Loop:
  1208            C                BC      STATUS, C
  1209            C                JBC     reg_acc1, 0
  1210            C                ADD     reg_acc4, A
  1211            C                RRC     reg_acc4
  1212            C                RRC     reg_acc3
  1213            C                RRC     reg_acc2
  1214            C                RRC     reg_acc1
  1215            C        ;
  1216            C                DJZ     reg_acc
  1217            C                JMP     $Mul13_Loop
  1218            C                ENDM
  1219            C        ;
  1220            C        ;**********************************************************************;
  1221            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1222            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1223            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1224            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1225            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Register change:reg_acc                                              ;
  1227            C        ;**********************************************************************;
  1228            C        ;
  1229            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1230            C        ;
  1231            C                MOV     A, @32
  1232            C                MOV     reg_acc, A
  1233            C                MOV     A, reg_acc5
  1234            C                CLR     reg_acc5
  1235            C        $Mul14_Loop:
  1236            C                BC      STATUS, C
  1237            C                JBC     reg_acc1, 0
  1238            C                ADD     reg_acc5, A
  1239            C                RRC     reg_acc5
  1240            C                RRC     reg_acc4
  1241            C                RRC     reg_acc3
  1242            C                RRC     reg_acc2
  1243            C                RRC     reg_acc1
  1244            C        ;
  1245            C                DJZ     reg_acc
  1246            C                JMP     $Mul14_Loop
  1247            C                ENDM
  1248            C        ;
  1249            C        ;**********************************************************************;
  1250            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1251            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1252            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1253            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1254            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1256            C        ;**********************************************************************;
  1257            C        ;
  1258            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1259            C        ;
  1260            C                MOV     A, @16
  1261            C                MOV     reg_acc, A
  1262            C                MOV     A, reg_acc4
  1263            C                MOV     reg_acc6, A
  1264            C                MOV     A, reg_acc3
  1265            C                MOV     reg_acc5, A
  1266            C                CLR     reg_acc3
  1267            C                CLR     reg_acc4
  1268            C        $Mul22_Loop:
  1269            C                BC      STATUS, C
  1270            C                JBS     reg_acc1, 0
  1271            C                JMP     $Mul22_Rs
  1272            C                MOV     A, reg_acc5
  1273            C                ADD     reg_acc3, A
  1274            C        ;--------------------------------------
  1275            C                MOV     A, reg_acc4
  1276            C                JBC     STATUS, C
  1277            C                ADD     A, @1
  1278            C                RLC     reg_acc
  1279            C                ADD     A, reg_acc6
  1280            C                MOV     reg_acc4, A
  1281            C                JBC     STATUS, C
  1282            C                BS      reg_acc, 0
  1283            C                RRC     reg_acc
  1284            C        $Mul22_Rs:
  1285            C                RRC     reg_acc4
  1286            C                RRC     reg_acc3
  1287            C                RRC     reg_acc2
  1288            C                RRC     reg_acc1
  1289            C        ;
  1290            C                BC      reg_acc, 7
  1291            C                DJZ     reg_acc
  1292            C                JMP     $Mul22_Loop
  1293            C                ENDM
  1294            C        ;
  1295            C        ;**********************************************************************;
  1296            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1297            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1298            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1299            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1300            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1302            C        ;**********************************************************************;
  1303            C        ;
  1304            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1305            C        ;
  1306            C                MOV     A, @24
  1307            C                MOV     reg_acc, A
  1308            C                MOV     A, reg_acc5
  1309            C                MOV     reg_acc7, A
  1310            C                MOV     A, reg_acc4
  1311            C                MOV     reg_acc6, A
  1312            C                CLR     reg_acc4
  1313            C                CLR     reg_acc5
  1314            C        $Mul23_Loop:
  1315            C                BC      STATUS, C
  1316            C                JBS     reg_acc1, 0
  1317            C                JMP     $Mul23_Rs
  1318            C                MOV     A, reg_acc6
  1319            C                ADD     reg_acc4, A
  1320            C        ;--------------------------------------
  1321            C                MOV     A, reg_acc5
  1322            C                JBC     STATUS, C
  1323            C                ADD     A, @1
  1324            C                RLC     reg_acc
  1325            C                ADD     A, reg_acc7
  1326            C                MOV     reg_acc5, A
  1327            C                JBC     STATUS, C
  1328            C                BS      reg_acc, 0
  1329            C                RRC     reg_acc
  1330            C        $Mul23_Rs:
  1331            C                RRC     reg_acc5
  1332            C                RRC     reg_acc4
  1333            C                RRC     reg_acc3
  1334            C                RRC     reg_acc2
  1335            C                RRC     reg_acc1
  1336            C        ;
  1337            C                BC      reg_acc, 7
  1338            C                DJZ     reg_acc
  1339            C                JMP     $Mul23_Loop
  1340            C                ENDM
  1341            C        ;
  1342            C        ;**********************************************************************;
  1343            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1344            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1345            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1346            C        ;                 , reg_acc2, reg_acc1)                                ;
  1347            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1348            C        ;                 reg_acc6                                             ;
  1349            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1350            C        ;                 reg_acc6                                             ;
  1351            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1352            C        ;**********************************************************************;
  1353            C        ;
  1354            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1355            C        ;
  1356            C                MOV     A, @32
  1357            C                MOV     reg_acc, A
  1358            C                MOV     A, reg_acc6
  1359            C                MOV     reg_acc8, A
  1360            C                MOV     A, reg_acc5
  1361            C                MOV     reg_acc7, A
  1362            C                CLR     reg_acc5
  1363            C                CLR     reg_acc6
  1364            C        $Mul24_Loop:
  1365            C                BC      STATUS, C
  1366            C                JBS     reg_acc1, 0
  1367            C                JMP     $Mul24_Rs
  1368            C                MOV     A, reg_acc7
  1369            C                ADD     reg_acc5, A
  1370            C        ;--------------------------------------
  1371            C                MOV     A, reg_acc6
  1372            C                JBC     STATUS, C
  1373            C                ADD     A, @1
  1374            C                RLC     reg_acc
  1375            C                ADD     A, reg_acc8
  1376            C                MOV     reg_acc6, A
  1377            C                JBC     STATUS, C
  1378            C                BS      reg_acc, 0
  1379            C                RRC     reg_acc
  1380            C        $Mul24_Rs:
  1381            C                RRC     reg_acc6
  1382            C                RRC     reg_acc5
  1383            C                RRC     reg_acc4
  1384            C                RRC     reg_acc3
  1385            C                RRC     reg_acc2
  1386            C                RRC     reg_acc1
  1387            C        ;
  1388            C                BC      reg_acc, 7
  1389            C                DJZ     reg_acc
  1390            C                JMP     $Mul24_Loop
  1391            C                ENDM
  1392            C        ;
  1393            C        ;**********************************************************************;
  1394            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1395            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1396            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1397            C        ;                 , reg_acc2, reg_acc1)                                ;
  1398            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1399            C        ;                 , reg_acc6                                           ;
  1400            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1401            C        ;                 , reg_acc6                                           ;
  1402            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1403            C        ;**********************************************************************;
  1404            C        ;
  1405            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1406            C        ;
  1407            C                MOV     A, @24
  1408            C                MOV     reg_acc, A
  1409            C                MOV     A, reg_acc4
  1410            C                MOV     reg_acc7, A
  1411            C                MOV     A, reg_acc5
  1412            C                MOV     reg_acc8, A
  1413            C                MOV     A, reg_acc6
  1414            C                MOV     reg_acc9, A
  1415            C                CLR     reg_acc4
  1416            C                CLR     reg_acc5
  1417            C                CLR     reg_acc6
  1418            C        $Mul33_Loop:
  1419            C                BC      STATUS, C
  1420            C                JBS     reg_acc1, 0
  1421            C                JMP     $Mul33_Rs
  1422            C                MOV     A, reg_acc7
  1423            C                ADD     reg_acc4, A
  1424            C        ;--------------------------------------
  1425            C                MOV     A, reg_acc5
  1426            C                JBC     STATUS, C
  1427            C                ADD     A, @1
  1428            C                RLC     reg_acc
  1429            C                ADD     A, reg_acc8
  1430            C                MOV     reg_acc5, A
  1431            C                JBC     STATUS, C
  1432            C                BS      reg_acc, 0
  1433            C                RRC     reg_acc
  1434            C        ;--------------------------------------
  1435            C                MOV     A, reg_acc6
  1436            C                JBC     STATUS, C
  1437            C                ADD     A, @1
  1438            C                RLC     reg_acc
  1439            C                ADD     A, reg_acc9
  1440            C                MOV     reg_acc6, A
  1441            C                JBC     STATUS, C
  1442            C                BS      reg_acc, 0
  1443            C                RRC     reg_acc
  1444            C        $Mul33_Rs:
  1445            C                RRC     reg_acc6
  1446            C                RRC     reg_acc5
  1447            C                RRC     reg_acc4
  1448            C                RRC     reg_acc3
  1449            C                RRC     reg_acc2
  1450            C                RRC     reg_acc1
  1451            C        ;
  1452            C                BC      reg_acc, 7
  1453            C                DJZ     reg_acc
  1454            C                JMP     $Mul33_Loop
  1455            C                ENDM
  1456            C        ;
  1457            C        ;**********************************************************************;
  1458            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1459            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1460            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1461            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1462            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1463            C        ;                 , reg_acc6, reg_acc7                                 ;
  1464            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1465            C        ;                 , reg_acc6, reg_acc7                                 ;
  1466            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1467            C        ;**********************************************************************;
  1468            C        ;
  1469            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1470            C        ;
  1471            C                MOV     A, @32
  1472            C                MOV     reg_acc, A
  1473            C                MOV     A, reg_acc5
  1474            C                MOV     reg_acc8, A
  1475            C                MOV     A, reg_acc6
  1476            C                MOV     reg_acc9, A
  1477            C                MOV     A, reg_acc7
  1478            C                MOV     reg_acca, A
  1479            C                CLR     reg_acc5
  1480            C                CLR     reg_acc6
  1481            C                CLR     reg_acc7
  1482            C        $Mul34_Loop:
  1483            C                BC      STATUS, C
  1484            C                JBS     reg_acc1, 0
  1485            C                JMP     $Mul34_Rs
  1486            C                MOV     A, reg_acc8
  1487            C                ADD     reg_acc5, A
  1488            C        ;--------------------------------------
  1489            C                MOV     A, reg_acc6
  1490            C                JBC     STATUS, C
  1491            C                ADD     A, @1
  1492            C                RLC     reg_acc
  1493            C                ADD     A, reg_acc9
  1494            C                MOV     reg_acc6, A
  1495            C                JBC     STATUS, C
  1496            C                BS      reg_acc, 0
  1497            C                RRC     reg_acc
  1498            C        ;--------------------------------------
  1499            C                MOV     A, reg_acc7
  1500            C                JBC     STATUS, C
  1501            C                ADD     A, @1
  1502            C                RLC     reg_acc
  1503            C                ADD     A, reg_acca
  1504            C                MOV     reg_acc7, A
  1505            C                JBC     STATUS, C
  1506            C                BS      reg_acc, 0
  1507            C                RRC     reg_acc
  1508            C        $Mul34_Rs:
  1509            C                RRC     reg_acc7
  1510            C                RRC     reg_acc6
  1511            C                RRC     reg_acc5
  1512            C                RRC     reg_acc4
  1513            C                RRC     reg_acc3
  1514            C                RRC     reg_acc2
  1515            C                RRC     reg_acc1
  1516            C        ;
  1517            C                BC      reg_acc, 7
  1518            C                DJZ     reg_acc
  1519            C                JMP     $Mul34_Loop
  1520            C                ENDM
  1521            C        ;
  1522            C        ;**********************************************************************;
  1523            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1524            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1525            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1526            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1527            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1528            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1529            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1530            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1531            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1532            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1533            C        ;**********************************************************************;
  1534            C        ;
  1535            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1536            C        ;
  1537            C                MOV     A, @32
  1538            C                MOV     reg_acc, A
  1539            C                MOV     A, reg_acc5
  1540            C                MOV     reg_acc9, A
  1541            C                MOV     A, reg_acc6
  1542            C                MOV     reg_acca, A
  1543            C                MOV     A, reg_acc7
  1544            C                MOV     reg_accb, A
  1545            C                MOV     A, reg_acc8
  1546            C                MOV     reg_accc, A
  1547            C                CLR     reg_acc5
  1548            C                CLR     reg_acc6
  1549            C                CLR     reg_acc7
  1550            C                CLR     reg_acc8
  1551            C        $Mul44_Loop:
  1552            C                BC      STATUS, C
  1553            C                JBS     reg_acc1, 0
  1554            C                JMP     $Mul44_Rs
  1555            C                MOV     A, reg_acc9
  1556            C                ADD     reg_acc5, A
  1557            C        ;--------------------------------------
  1558            C                MOV     A, reg_acc6
  1559            C                JBC     STATUS, C
  1560            C                ADD     A, @1
  1561            C                RLC     reg_acc
  1562            C                ADD     A, reg_acca
  1563            C                MOV     reg_acc6, A
  1564            C                JBC     STATUS, C
  1565            C                BS      reg_acc, 0
  1566            C                RRC     reg_acc
  1567            C        ;--------------------------------------
  1568            C                MOV     A, reg_acc7
  1569            C                JBC     STATUS, C
  1570            C                ADD     A, @1
  1571            C                RLC     reg_acc
  1572            C                ADD     A, reg_accb
  1573            C                MOV     reg_acc7, A
  1574            C                JBC     STATUS, C
  1575            C                BS      reg_acc, 0
  1576            C                RRC     reg_acc
  1577            C        ;--------------------------------------
  1578            C                MOV     A, reg_acc8
  1579            C                JBC     STATUS, C
  1580            C                ADD     A, @1
  1581            C                RLC     reg_acc
  1582            C                ADD     A, reg_accc
  1583            C                MOV     reg_acc8, A
  1584            C                JBC     STATUS, C
  1585            C                BS      reg_acc, 0
  1586            C                RRC     reg_acc
  1587            C        $Mul44_Rs:
  1588            C                RRC     reg_acc8
  1589            C                RRC     reg_acc7
  1590            C                RRC     reg_acc6
  1591            C                RRC     reg_acc5
  1592            C                RRC     reg_acc4
  1593            C                RRC     reg_acc3
  1594            C                RRC     reg_acc2
  1595            C                RRC     reg_acc1
  1596            C        ;
  1597            C                BC      reg_acc, 7
  1598            C                DJZ     reg_acc
  1599            C                JMP     $Mul44_Loop
  1600            C                ENDM
  1601            C        
  1602            C        
  1603            C        
  1604            C        ;*****************************************************************
  1605            C        ;Function:    generat random data
  1606            C        ;Input:       @banksel,@address,@length
  1607            C        ;Output:      rang by address which is the lowest address
  1608            C        ;description: used common register temp,temp1,temp2 for operation
  1609            C        ;             rand address must be in the same bank
  1610            C        ;             TEMP:  Operate Data TEMP
  1611            C        ;             TEMP1:
  1612            C        ;             TEMP2:
  1613            C        ;*****************************************************************
  1614            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1615            C        	MOV         TEMP,A
  1616            C        	BANK        @BankSel
  1617            C        	MOV         A,Address
  1618            C        	ADD         TEMP,A        ; save latest data as current seed
  1619            C        
  1620            C        	CLR         RSR
  1621            C        $_RAND_SEED_LOOP1:
  1622            C        	MOV         A,R0
  1623            C        	ADD         TEMP,A        ; seed
  1624            C        
  1625            C        	RLC         TEMP          ; x*y+1 MOD z
  1626            C        	RLC         TEMP
  1627            C        	RLC         TEMP
  1628            C        	INC         TEMP
  1629            C        	RRC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	JBS         STATUS,C
  1633            C        	BC          TEMP,0
  1634            C        	JBC         STATUS,C
  1635            C        	BS          TEMP,0
  1636            C        
  1637            C        	INC         RSR
  1638            C        	MOV         A,RSR
  1639            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1640            C        	XOR         A,@0X40
  1641            C        	JBS         STATUS,Z
  1642            C        	JMP         $_RAND_SEED_LOOP1
  1643            C        	MOV         A,R0
  1644            C        	ADD         TEMP,A          ;next seed
  1645            C        
  1646            C        	MOV         A,@length
  1647            C        	MOV         TEMP1,A
  1648            C        	MOV         A,@Address
  1649            C        	MOV         TEMP2,A
  1650            C        	MOV         RSR,A
  1651            C        	BANK        @BankSel
  1652            C        	MOV         A,RSR
  1653            C        	MOV         TEMP2,A       ; save address base
  1654            C        	MESSAGE     "adding form 0x00 to bank 0"
  1655            C        
  1656            C        $_RAND_DATA_LOOP1:
  1657            C        	MOV         A,TEMP2
  1658            C        	MOV         RSR,A
  1659            C        	MOV         A,TEMP
  1660            C        	MOV         R0,A
  1661            C        
  1662            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1663            C        	RLC         TEMP
  1664            C        	RLC         TEMP
  1665            C        	INC         TEMP
  1666            C        	RRC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	JBS         STATUS,C
  1670            C        	BC          TEMP,0
  1671            C        	JBC         STATUS,C
  1672            C        	BS          TEMP,0
  1673            C        
  1674            C        	INC         TEMP2
  1675            C        	DJZ         TEMP1
  1676            C        	JMP         $_RAND_DATA_LOOP1:
  1677            C        	NOP
  1678            C        
  1679            C        ENDM
  1680            C        
    14                     include "D:\include\EM78xx\inc\EM78CtrlIns.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 
   284            C        ; :,ACC,R3
   285            C        ; A      -> A_TEMP
   286            C        ; R4    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;R4              ;SAVE R4(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;R4,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;R4,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;========================== EM78P520 =================================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;R4,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ; 
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; 
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; 
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; 
   426            C        ; :NUM = ,  ADDRESS =  B
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; 
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ;
   460            C        ; :NUM = ,  ADDRESS =  B
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; 
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611E.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C        	MOV     A, @0XE0        ; RAM 
   513            C        	MOV     R4, A           ;
   514            C        	CLR     BSR
   515            C        	;INC     BSR            ; BANK 0 is used for exchange reg(FIFO)
   516            C        ;CLEAR_RAM_LOOP_P510:
   517            C        	WDTC
   518            C        	CLR     R0
   519            C        	INC     R4
   520            C        	MOV     A,R4
   521            C        	AND     A,@0X3F
   522            C        	JBS     R3,Z
   523            C        	JMP     $-5            ; CLEAR_RAM_LOOP_P510
   524            C        	INC     BSR
   525            C        	MOV     A,BSR         ; BANK0 (BSR == 0X05)
   526            C        	AND     A,@0X07
   527            C        	BS      R4,5
   528            C        	BS      R4,6
   529            C        	JBS     R3,2
   530            C        	JMP     $-13           ; CLEAR_RAM_LOOP_P510
   531            C        	CLR     R4
   532            C        	CLR     BSR
   533            C        	BS      R4,6
   534            C        	
   535            C        ELSEIFDEF EM78M611E.H
   536            C         	MOV     A,@0x10
   537            C        	MOV     R4,A
   538            C        ;CLEAR_RAM_LOOP_M611:
   539            C        	CLR     R0
   540            C        	INC     R4
   541            C        	JBC     R4,6
   542            C        	BS      R4,5
   543            C        	JBC     R4,7
   544            C        	BS      R4,5
   545            C        	JBS     R3,Z
   546            C        	JMP     $-7            ; CLEAR_RAM_LOOP_M611:
   547            C        	CLR     R4
   548            C        
   549            C        	MOV     A,@0X11
   550            C        	MOV     RD,A
   551            C        	CLR     RE
   552            C        	MOV     A,@1
   553            C        	MOV     RD,A
   554            C        	MOV     A,@0X00
   555            C        	MOV     RE,A
   556            C        	MOV     RE,A
   557            C        	MOV     RE,A
   558            C        	MOV     RE,A
   559            C        	MOV     RE,A
   560            C        	MOV     RE,A
   561            C        	MOV     RE,A
   562            C        	MOV     RE,A
   563            C        	BS      RC,5
   564            C        
   565            C        ELSEIFDEF EM78P447.H
   566            C         	MOV     A,@0x10
   567            C        	MOV     R4,A
   568            C        ;CLEAR_RAM_LOOP_P447:
   569            C        	CLR     R0
   570            C        	INC     R4
   571            C        	JBC     R4,6
   572            C        	BS      R4,5
   573            C        	JBC     R4,7
   574            C        	BS      R4,5
   575            C        	JBS     R3,Z
   576            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P447:
   577            C        	CLR     R4
   578            C        
   579            C        ELSEIFDEF EM78P468.H
   580            C        	MOV     A,@0X10
   581            C        	MOV     R4,A
   582            C        ;CLEAR_RAM_LOOP_P468:
   583            C        	CLR     R0
   584            C        	INC     R4
   585            C        	JBC     R4,6
   586            C        	BS      R4,5
   587            C        	JBC     R4,7
   588            C        	BS      R4,5
   589            C        	JBS     STATUS,Z
   590            C        	JMP     $-7            ; CLEAR_RAM_LOOP_P468
   591            C        	CLR     R4
   592            C        
   593            C        ELSEIFDEF EM78P458.H
   594            C                MOV     A,@0X10
   595            C                MOV     R4,A
   596            C        ;CLEAR_RAM_LOOP_P458:
   597            C                CLR     R0
   598            C                INC     R4
   599            C                JBC     R4,6
   600            C                BS      R4,5
   601            C                JBS     R4,7
   602            C                JMP     $-5        ; CLEAR_RAM_LOOP_P458
   603            C                CLR     R4
   604            C        
   605            C        ELSEIFDEF EM78P451.H
   606            C                MOV     A,@0X10
   607            C                MOV     R4,A
   608            C        ;CLEAR_RAM_LOOP_P451:
   609            C                CLR     R0
   610            C                INC     R4
   611            C                JBC     R4,6
   612            C                BS      R4,5
   613            C                JBC     R4,7
   614            C                BS      R4,5
   615            C                JBS     STATUS,Z
   616            C                JMP     $-7        ; CLEAR_RAM_LOOP_P451
   617            C        
   618            C        ELSE
   619            C        	MOV     A,@0x10        ; clear all ram bank
   620            C        	MOV     R4,A
   621            C        ;CLEAR_RAM_LOOP:
   622            C        	CLR     R0
   623            C        	INC     R4
   624            C        	JBC     R4,6
   625            C        	BS      R4,5
   626            C        	JBC     R4,7
   627            C        	BS      R4,5
   628            C        	JBS     R3,Z
   629            C        	JMP     $-7            ; CLEAR_RAM_LOOP:
   630            C        	CLR     R4
   631            C        	MESSAGE "Clear all RAM bank"
   632            C        ENDIF
   633            C        ENDM
   634            C        
   635            C        ;*******************************************
   636            C        ; RAM clear function
   637            C        ; [ELSE]: default the MCU have four bank
   638            C        ; others: xx.h must be define in "xx.h"
   639            C        ;*******************************************
   640            C        ClrCommRamBank MACRO
   641            C        	MOV                 A, @0X10        ; RAM 
   642            C        	MOV                 R4, A
   643            C        ;CLEAR_10_1F_RAM_LOOP:
   644            C        	WDTC
   645            C        	CLR                 R0
   646            C        	INC                 R4
   647            C        	MOV                 A,@0B00111111
   648            C        	AND                 A,R4
   649            C        	SUB                 A,@0X1F
   650            C        	JBC                 R3,C
   651            C        	JMP                 $-7             ; CLEAR_10_1F_RAM_LOOP
   652            C        	CLR                 R4
   653            C        ENDM
   654            C        
   655            C        ;********************************************************************
   656            C        ;********************************************************************
   657            C        Clearbuffer MACRO
   658            C          ifdef EM78P520.H
   659            C        	MOV                 A,@0B11100000   ; clear bank0 ram
   660            C        	MOV                 R4,A
   661            C        	BANK                0               ; R5=0
   662            C        ;CLEAR_BANK0_LOOP:
   663            C        	WDTC
   664            C        	CLR                 R0
   665            C        	INC                 R4
   666            C        	MOV                 A,@0B00111111
   667            C        	AND                 A,R4
   668            C        	XOR                 A,@0X3F
   669            C        	JBS                 R3,Z
   670            C        	JMP                 $-7             ; CLEAR_BANK0_LOOP
   671            C        	CLR                 R0
   672            C        	MOV                 A,@0B11000000
   673            C        	MOV                 R4,A
   674            C        
   675            C          elseifdef EM78M611E.H
   676            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   677            C        	MOV                 R4,A
   678            C        ;CLEAR_BANK0_LOOP:
   679            C        	WDTC
   680            C        	CLR                 R0
   681            C        	INC                 R4
   682            C        	MOV                 A,@0B00111111
   683            C        	AND                 A,R4
   684            C        	XOR                 A,@0X3F
   685            C        	JBS                 R3,Z
   686            C        	JMP                 $-7             ; CLEAR_BANK0_LOOP
   687            C        	CLR                 R0
   688            C        	CLR                 R4
   689            C        
   690            C          else
   691            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   692            C        	MOV                 R4,A
   693            C        ;CLEAR_BANK0_LOOP:
   694            C        	WDTC
   695            C        	CLR                 R0
   696            C        	INC                 R4
   697            C        	MOV                 A,@0B00111111
   698            C        	AND                 A,R4
   699            C        	XOR                 A,@0X3F
   700            C        	JBS                 R3,Z
   701            C        	JMP                 $-7             ; CLEAR_BANK0_LOOP
   702            C        	CLR                 R4
   703            C          endif
   704            C        ENDM
   705            C        
   706            C        
    15                     include "config.h"
     1            C        /*****************************************************************
     2            C        * Filename     :  CONFIG.ASM
     3            C        * Author       :  yu.wei
     4            C        ; Company       : ELAN
     5            C        ; VERSION       : 1.1
     6            C        ; CRYSTAL       : 8MHZ
     7            C        ; Creat date    : 2009/12/3
     8            C        ; tool ver.     : WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-------------------------------------------------------------------------
    12            C        config.h     EQU     config.h
    13            C        
    14            C        ;-------------------------------------------------------------------------
    15       00FA C        SetSleepTime            EQU     250   ; Into sleep Time=(SetSleepTime+1)*2s. default:250
    16       0001 C        ADC_FUNCTION            EQU     1    ; 0 -> IO_FUNCTION(default:0)
    17            C                                             ; 1 -> ADC_FUNCTION
    18            C        
    16                     include "P520ksP44.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  P520ksP44.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/13/3
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;  Description: PAGE0(0X0000-0X03FF): MCU initial
    12            C        ;               PAGE1(0X0400-0X07FF): searchmode
    13            C        ;               PAGE2(0X0800-0X0BFF): normalmode
    14            C        ;               PAGE3(0X0C00-0X0FFF): RF driver
    15            C        ;               PAGE4(0X1000-0X13FF): key scan driver
    16            C        ;               PAGE5(0X1400-0X17FF): CMOS driver
    17            C        ;               PAGE6(0X1800-0X1BFF): CMOS/GS driver
    18            C        ;               PAGE7(0X1C00-0X1FFF): Kalman Filter arithmetic
    19            C        
    20            C        ;========================================================================
    21            C        P520ksP44.H     EQU     P520ksP44.H
    22            C        
    23            C        
    24            C        
    25            C        ;========================================================================
    26       0010 C        TEMP                            EQU     0X10
    27       0011 C        TEMP1                           EQU     0X11
    28       0012 C        TEMP2                           EQU     0X12
    29       0013 C        TEMP3                           EQU     0X13
    30       0014 C        TEMP4                           EQU     0X14
    31       0015 C        TEMP5                           EQU     0X15
    32       0016 C        TEMP6                           EQU     0X16
    33            C        
    34       0017 C        ComuClock                       EQU     0X17  ;communicateion clock
    35       0018 C        ComuCycleNum                    EQU     0X18  ;communicateion time
    36       0019 C        ComuEndNum                      EQU     0X19  ;communicateion end time
    37       001A C        Databytelength                  EQU     0X1A  ;FIFO READ/WRITE DATA LENGTH
    38       001B C        DataShiftCounter                EQU     0X1B  ;data counter
    39       001C C        SleepCNT                        EQU     0X1C  ;data conunter
    40            C        
    41       001D C        GeneralStatusFlag1              EQU     0X1D
    42       01D7 C        	RFInitialFailFlag           ==      GeneralStatusFlag1*16+7 ;
    43       01D6 C        	RFInitialOKFlag             ==      GeneralStatusFlag1*16+6
    44       01D5 C        	RFTestFailFlag              ==      GeneralStatusFlag1*16+5
    45       01D2 C        	ReadLengthError             ==      GeneralStatusFlag1*16+2	
    46       01D1 C        	IntoSleepFlag               ==      GeneralStatusFlag1*16+1
    47       01D0 C        	ToWakeupFlag                ==      GeneralStatusFlag1*16+0
    48            C        
    49       001E C        GeneralStatusFlag2              EQU     0X1E
    50            C        	;System2sFlag                ==      GeneralStatusFlag2*16+7	
    51       01E6 C        	System16msFlag              ==      GeneralStatusFlag2*16+6
    52       01E5 C        	System8msFlag               ==      GeneralStatusFlag2*16+5
    53       01E3 C        	KeyScanFinishFlag           ==      GeneralStatusFlag2*16+3
    54       01E2 C        	KeyStatusFlag               ==      GeneralStatusFlag2*16+2
    55       01E1 C        	KeyScanStatusFlag           ==      GeneralStatusFlag2*16+1
    56       01E0 C        	KeyScanInitFlag             ==      GeneralStatusFlag2*16+0
    57            C        
    58       001F C        CommuStatusFlag                 EQU     0X1F
    59       01F7 C        	DescriptorFinishFlag        ==      CommuStatusFlag*16+7   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    60       01F6 C        	FccTestModeFlag             ==      CommuStatusFlag*16+6
    61       01F5 C        	ForceLinkModeFlag           ==      CommuStatusFlag*16+5   ; force link flag
    62       01F4 C        	LinkModeFlag                ==      CommuStatusFlag*16+4   ; link flag
    63       01F3 C        	EEpromWRStatusFlag          ==      CommuStatusFlag*16+3
    64       01F2 C        	LoseFrameStatusFlag         ==      CommuStatusFlag*16+2   ; lose frequency and search mode flag
    65       01F1 C        	NormalStatusFlag            ==      CommuStatusFlag*16+1   ; Normal mode Flag
    66       01F0 C        	SearchStatusFlag            ==      CommuStatusFlag*16+0   ; Search mode flag
    67            C        
    68            C        ;------------------------------------------------------------------
    69            C        
    70       0014 C        A_TEMP                          EQU     TEMP4  ;used for PUSH1 and POP1
    71       0015 C        RSR_TEMP                        EQU     TEMP5
    72       0016 C        STATUS_TEMP                     EQU     TEMP6
    73            C        
    74            C        ;------------------------------------------------------------------
    75            C        
    76            C        
    77            C        ;========================= I/O Port Define ==============================
    78       0081 C        LED1_STATUS                 ==      PORT8*16+1 ;LED
    79       0082 C        LED2_STATUS                 ==      PORT8*16+2 ;LED
    80            C        
    81            C        
    82            C        
    83            C        ;======================= BANK 0 (data buffer)============================
    84            C        ; bank0 20-3f used for data exchange section
    85            C        ; such as read or write EEPROM and RF,it used for data buffer
    86            C        
    87            C        ;-----------------------------------------------------------------
    88            C        
    89            C        
    90            C        ;======================= BANK 1 (RF variable)============================
    91            C        
    92            C        
    93            C        
    94            C        ;======================= BANK 2 (key data)==============================
    95       0020 C        DataA                   EQU     0X20 ;rocker left-x(left-right)  RF transmitter data
    96       0021 C        DataB                   EQU     0X21 ;rocker left-y(up-down)     RF transmitter data
    97       0022 C        DataC                   EQU     0X22 ;rocker right-x(left-right) RF transmitter data
    98       0023 C        DataD                   EQU     0X23 ;rocker right-y(up-down)    RF transmitter data
    99       0024 C        DataE                   EQU     0x24 ;DataA(s10-s5):
   100            C                                ;bit7  bit6  Bit5  Bit4  Bit3  bit2  bit1  bit0
   101            C                                ;A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   102       0025 C        DataF                   EQU     0x25 ;DataB(s4-s1):
   103            C                                ;bit7      bit6      Bit5      Bit4   Bit3  bit2    bit1    bit0
   104            C                                ;SELECT_9  START_10  TEST2_14  MACRO  MODE  RSW_12  LSW_11  TEST1_13
   105            C                                ;MODE: 1:DealWithDigital  0:DealWithAnalog (default:1)
   106       0026 C        DataG                   EQU     0X26 ;bit[7..4]Hat Switch, bit[3..0]reserve.
   107            C                                ;000:00001:45010:90011:135100:180101:225110:270111:315
   108            C        
   109       002A C        IOcheckRefValue         EQU     0X2A    ; used for Store refrence value
   110       002B C        KeyCheckBakup           EQU     0X2B
   111       002C C        ComSystemTimeCNT        EQU     0X2C
   112       002D C        IOcheckTimeCNT          EQU     0X2D    ; used for count check time
   113       002E C        KeySystemTimeCNT        EQU     0x2E    ; key scan time
   114       002F C        LEDSystemTimeCNT        EQU     0X2F
   115            C        
   116       0030 C        KEY_LEFT_X              EQU     0X30 ;rocker,AD convert result left-x(left-right) data
   117       0031 C        KEY_LEFT_Y              EQU     0X31 ;rocker,AD convert result left-y(up-down) data
   118       0032 C        KEY_RIGHT_X             EQU     0X32 ;rocker,AD convert result right-x(left-right) data
   119       0033 C        KEY_RIGHT_Y             EQU     0X33 ;rocker,AD convert result right-y(up-down) data
   120       0036 C        KeystokeFlag_Befor      EQU     0X36
   121       0037 C        KeystokeTimeCNT         EQU     0X37        ;       Click                     Dblclick                    Lasting_Press
   122            C                                                    ;________    _______.__________    ______    ________.___________         ____________
   123            C                                                    ;        |__|                  |__|      |__|                    |_______|
   124       0038 C        KEY_NUM                 EQU     0X38
   125            C                                                    ;___________                       _________                              ____________
   126            C                                                    ;           |_______._____________|         |________.___________________|
   127            C        
   128            C        ;F_MODE                  EQU     0X32 ;Analog jugde falg
   129            C        ;F_MODE_BEFOR            EQU     0X33 ;Store keyboard select
   130       0039 C        KeyTempFlag             EQU     0X39 ;Store LINE4_KEY_INPUT TEMP
   131       0394 C        	ModeSelFlag         ==      KeyTempFlag*16+4 ;1:analog  0:digital(default 0)
   132       0395 C        	MacroFlag           ==      KeyTempFlag*16+5
   133       0396 C        	Test1Flag           ==      KeyTempFlag*16+6
   134       0397 C        	Test2Flag           ==      KeyTempFlag*16+7
   135            C        
   136       003A C        KeyTempBakupFlag        EQU     0X3A
   137       03A4 C        	ModeSelBakupFlag    ==      KeyTempBakupFlag*16+4 ;1:analog  0:digital(default 0)
   138       03A5 C        	MacroBakupFlag      ==      KeyTempBakupFlag*16+5
   139       03A6 C        	Test1BakupFlag      ==      KeyTempBakupFlag*16+6
   140       03A7 C        	Test2BakupFlag      ==      KeyTempBakupFlag*16+7
   141            C        
   142       003B C        LINE1_KEY_INPUT_CACHE   EQU     0X3B ;line 1,direction data
   143       003C C        LINE2_KEY_INPUT_CACHE   EQU     0X3C ;line 2,X_LINE2 output
   144       003D C        LINE3_KEY_INPUT_CACHE   EQU     0X3D ;line 3,X_LINE3 output
   145       003E C        LINE4_KEY_INPUT_CACHE   EQU     0X3E ;line 4,X_LINE4 output
   146       003F C        LINE5_KEY_INPUT_CACHE   EQU     0X3F ;line 5,X_LINE5 output
   147            C        
   148            C        ;======================= BANK 3 (reserve)===============================
   149            C        
   150            C        
   151            C        
   152            C        ;======================= BANK 4 (Push data)=============================
   153       0020 C        ATcc_TEMP               EQU     0X20  ;used for TCC and POP3
   154       0021 C        RSRTcc_TEMP             EQU     0X21
   155       0022 C        StatusTcc_TEMP          EQU     0X22
   156            C        
   157       0023 C        AExt_TEMP               EQU     0X23  ;used for External and POP3
   158       0024 C        RSRExt_TEMP             EQU     0X24
   159       0025 C        StatusExt_TEMP          EQU     0X25
   160            C        
   161       0026 C        A1_TEMP                 EQU     0X26  ;used for time1 and POP1
   162       0027 C        RSR1_TEMP               EQU     0X27
   163       0028 C        STATUS1_TEMP            EQU     0X28
   164            C        
   165       0029 C        A2_TEMP                 EQU     0X29  ;used for time2 and POP2
   166       002A C        RSR2_TEMP               EQU     0X2A
   167       002B C        STATUS2_TEMP            EQU     0X2B
   168            C        
   169            C        ;-----------------------------------------------------------
   170       0030 C        SPIS_TEMP               EQU     0X30
   171       0031 C        SPIC_TEMP               EQU     0X31
   172            C        
   173            C        ;======================= BANK 5 (CMOS Data)============================
   174            C        
   175            C        
   176            C        
   177            C        ;======================= BANK 6 (CMOS Data)============================
   178            C        
   179            C        
   180            C        
   181            C        ;======================= BANK 7 (GS Data)============================
   182            C        
    17                     include "uartcomu.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : uartcomu.h
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.2
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/12/3
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,used for airui
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        uartcomu.asm     EQU     uartcomu.asm
    14            C        
    15            C        include "uartcomu.h"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : uartcomu.h
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.2
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/12/3
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,used for airui
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        uartcomu.h     EQU     uartcomu.h
    14            C        
    15            C        
    16            C        
    17            C        ;-----------------------------------------------------------------------
    18       0001 C        COM_DEBUG               EQU     1      ; 1:uart delay debug,enable, 0:disable
    19       0001 C        COM_T_DEBUG             EQU     1      ; 1:Time Test port enable, 0: disable
    20       0000 C        KeyScanTimeCtrl         EQU     0      ; T=(KeyScanTimeCtrl+1)*8ms             KeyScanTimeCtrl0
    21       0000 C        UartTimeCtrl            EQU     0      ; T=(ComTimeCtrl+1)*8ms, (default:180,Value=0 do the fastest)  
    22            C        
    16            C        include "keyscan.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.2
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/12/3
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,used for airui
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        
    14            C        ;---------------------------------------------------
    15            C        keyscan.asm             EQU       keyscan.asm
    16            C        include "keyscan.H"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.1
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : eUIDE
    10            C        ; descripition  : FOR_EM78P520,
    11            C        ;=============================================================================
    12            C        keyscan.h           EQU        keyscan.h
    13            C        
    14            C        
    15            C        ;----------------------------------------------------------------
    16       0000 C        IOtoADC_T_DEBUG     EQU        0
    17       0005 C        Kr                  EQU        5    ; Kr=5k/10k
    18       000A C        LeakresisTimeCNT    EQU        10     ; Leakresis time(default:4).T = LeakresisTimeCNT*[interrupt Time]
    19       0003 C        IOCheckRate         EQU        3   ; timer2 counter. Check IO when Time arrive (default:3)
    20       001B C        reg_acc             EQU        DataShiftCounter
    21            C        
    22            C        
    23            C        
    24            C        ;======================= key scan port define =========================
    25       0007 C        X_KeyLine           EQU        PORT7
    26       0074 C        X_LINE1             ==         X_KeyLine*16+4		;R74
    27       0075 C        X_LINE2             ==         X_KeyLine*16+5		;R73
    28       0076 C        X_LINE3             ==         X_KeyLine*16+6		;R72
    29       0077 C        X_LINE4             ==         X_KeyLine*16+7		;R71
    30            C        
    31       0009 C        X_Keyrow            EQU        PORT9
    32       0097 C        X_ROW1              ==         X_Keyrow*16+7		;R97
    33       0096 C        X_ROW2              ==         X_Keyrow*16+6		;R96
    34       0095 C        X_ROW3              ==         X_Keyrow*16+5		;R95
    35       0094 C        X_ROW4              ==         X_Keyrow*16+4		;R94
    36            C        
    37            C        ;
    38       0007 C        Reference           ==         7          ;port87
    39       0006 C        Leakresis           ==         6          ;port86
    40       0000 C        LeftYAxis           ==         0          ;port90  LY
    41       0001 C        LeftXAxis           ==         1          ;port91  LX
    42       0002 C        RightYAxis          ==         2          ;port92  RY
    43       0003 C        RightXAxis          ==         3          ;port93  RX
    44            C        
    45            C        ;------------------------ Define form SCH ----------------------------
    46       000F C        _Directions         EQU        0B00001111 ;Port83 Port82 Port81 Port80
    47            C        
    48       0003 C        _UP                 ==         3    ;Port83
    49       0002 C        _DOWN               ==         2    ;Port82
    50       0001 C        _LEFT               ==         1    ;Port81
    51       0000 C        _RIGHT              ==         0    ;Port80
    52            C        
    53            C        ;--------------------------------------------------
    54       0007 C        _A                  ==         7    ;Port97
    55       0006 C        _B                  ==         6    ;Port96
    56       0005 C        _C                  ==         5    ;Port95
    57       0004 C        _D                  ==         4    ;Port94
    58            C        
    59       0007 C        _L1                 ==         7    ;Port97
    60       0006 C        _R1                 ==         6    ;Port96
    61       0005 C        _L2                 ==         5    ;Port95
    62       0004 C        _R2                 ==         4    ;Port94
    63            C        
    64       0007 C        _SELECT             ==         7    ;Port97
    65       0006 C        _START              ==         6    ;Port96
    66       0007 C        _LSW                ==         7    ;Port97
    67       0004 C        _RSW                ==         4    ;Port94
    68            C        
    69       0005 C        _MODE               ==         5    ;Port95
    70       0004 C        _MACRO              ==         4    ;Port94
    71       0006 C        _TEST1              ==         6    ;Port96
    72       0005 C        _TEST2              ==         5    ;Port95
    73            C        
    74            C        ;----------------- Define by data -------------------
    75       0000 C        A_1                 ==         0    ;DataE
    76       0001 C        B_2                 ==         1
    77       0002 C        C_3                 ==         2
    78       0003 C        D_4                 ==         3
    79       0004 C        L1_5                ==         4
    80       0005 C        R1_6                ==         5
    81       0006 C        L2_7                ==         6
    82       0007 C        R2_8                ==         7
    83            C        
    84       0000 C        SELECT_9            ==         0    ;DataF
    85       0001 C        START_10            ==         1
    86       0002 C        LSW_11              ==         2
    87       0003 C        RSW_12              ==         3
    88       0004 C        MODE_13             ==         4
    89       0005 C        MACRO_14            ==         5
    90       0006 C        TEST1_15            ==         6
    91       0007 C        TEST2_16            ==         7
    92            C        
    93            C        
    94            C        ;=============== Connect key scan ======================
    95       00B4 C        KeyPressTime                EQU    180
    96       003C C        KeyScanTime                 EQU    60
    97       001E C        CrossingTime                EQU    30
    98       0002 C        KeyScanTimeCNT_default      EQU    2     
    99            C        
   100            C        
   101            C        
   102            C        
   103            C        
    17            C        
    18            C        ifndef EM78CtrlIns.H
    19            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    20            C        endif
    21            C        
    22            C        ifndef EM78Math.H
    23            C        include "D:\include\EM78xx\EM78Math.H"
    24            C        endif
    25            C        
    26            C        
    27            C        ;----------------------------------------------------
    28            C        
    29            C        	ORG                 0x10B0    ;PAGE 4
    30            C        	MESSAGE "define 'keyscan.asm' ROM address"
***     USER MESSAGE: DEFINE 'KEYSCAN.ASM' ROM ADDRESS
    31 010B0      C        Key_Scan:
    32            C        
    33 010B0 0C1E C        	JBC                 KeyScanInitFlag/16,KeyScanInitFlag%16
    34 010B1 14C3 C        	JMP                 Key_Scan_startup
    35 010B2 0A1E C        	BS                  KeyScanInitFlag/16,KeyScanInitFlag%16
    36 010B3 1E02 C        	BANK                2
    37            C        		
    38            C        ;========================== Iinitial config ================================
    39            C          if ADC_FUNCTION == 1
    40 010B4 1E04 C        	BANK                4
    41 010B5 1800 C        	MOV                 A,@00000000B
    42 010B6 0047 C        	MOV                 IOC7,A        ; Set Output
    43 010B7 18FF C        	MOV                 A,@11111111B
    44 010B8 0049 C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Input(Default IO)
    45 010B9 180F C        	MOV                 A,@0B00001111   ; PB0 PB1 PB2 PB3 As Input
    46 010BA 004B C        	MOV                 PBIOCR,A       	;
    47 010BB 1E05 C        	BANK                5
    48 010BC 18F0 C        	MOV                 A,@11110000B
    49 010BD 0049 C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    50 010BE 180F C        	MOV                 A,@00001111B
    51 010BF 004B C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    52            C        
    53 010C0 12AF C        	CALL                SUB_RINIT
    54 010C1 129D C        	CALL                SUB_ADJ
    55            C        
    56            C          else
    57            C        	BANK                4
    58            C        	MOV                 A,@00000000B
    59            C        	MOV                 IOC7,A        ; Set Output
    60            C        	MOV                 A,@11110000B
    61            C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Output(Default IO)
    62            C        	MOV                 A,@0B00001111   ; PB0 PB1 PB2 PB3 As Input
    63            C        	MOV                 PBIOCR,A       	;
    64            C        	BANK                5
    65            C        	MOV                 A,@11110000B
    66            C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    67            C        	MOV                 A,@00001111B
    68            C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    69            C        
    70            C        	CALL               Pre_Discharge
    71            C        	CALL               SampingRefTiming
    72            C        
    73            C          endif
    74 010C2 0000 C        	NOP
    75            C        
    76 010C3      C        Key_Scan_startup:
    77            C         ;===========================================================================
    78            C         ;Setting LED Status
    79            C         ;===========================================================================
    80 010C3 1E02 C        	BANK                2
    81 010C4 0F25 C        	JBS                 DataF,MODE_13    ; 1:analog  0:digital(default 0),LED light
    82 010C5 14C7 C        	JMP                 SET_VR_STATUS_0
    83 010C6 14CB C        	JMP                 SET_VR_STATUS_1
    84 010C7      C          SET_VR_STATUS_0:
    85 010C7 0000 C        	NOP
    86 010C8 1E00 C        	BANK                0
    87 010C9 0848 C        	BC                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    88 010CA 14CF C        	JMP                 SET_VR_STATUS_END
    89 010CB      C          SET_VR_STATUS_1:
    90 010CB 0000 C        	NOP
    91 010CC 1E00 C        	BANK                0
    92 010CD 0A48 C        	BS                  LED1_STATUS/16,LED1_STATUS%16		;PORT81
    93 010CE 14CF C        	JMP                 SET_VR_STATUS_END
    94 010CF      C          SET_VR_STATUS_END:
    95 010CF 1E02 C        	BANK                2
    96 010D0 0000 C         	NOP
    97            C        
    98            C        ;================================================================================
    99            C        ;Keyscan Main
   100            C        ;================================================================================
   101 010D1 1129 C        	CALL                KeyPort_Check
   102 010D2 0000 C        	NOP
   103            C        ;--------------------- Judge mode status ------------------------
   104 010D3 0D39 C        	JBC                 ModeSelFlag/16,ModeSelFlag%16
   105 010D4 14DB C        	JMP                 MODE_NOCHANGE
   106 010D5 0F3A C        	JBS                 ModeSelBakupFlag/16,ModeSelBakupFlag%16
   107 010D6 14DB C        	JMP                 MODE_NOCHANGE
   108 010D7 0000 C        	NOP
   109            C      M 	COM                 DataF,MODE_13
       010D8 1810     1     MOV A,@( 16 )
       010D9 0365     1     XOR  DATAF ,A
   110 010DA 0000 C        	NOP
   111 010DB      C          MODE_NOCHANGE:
   112            C      M 	MOVB                KeyTempBakupFlag,MODE_13,KeyTempFlag,MODE_13
       010DB 0F39     1     JBS  KEYTEMPFLAG , MODE_13 
       010DC 093A     1     BC  KEYTEMPBAKUPFLAG , MODE_13 
       010DD 0D39     1     JBC  KEYTEMPFLAG , MODE_13 
       010DE 0B3A     1     BS  KEYTEMPBAKUPFLAG , MODE_13 
   113 010DF 0939 C        	BC                  ModeSelFlag/16,ModeSelFlag%16
   114            C        
   115            C        ;---------------- Deal with DataA/DataB/DataC/DataD/DataG-----------------
   116            C          if ADC_FUNCTION == 1
   117 010E0 0000 C        	NOP
   118 010E1 11F4 C        	CALL                ADC_Rocker_KeyScan
   119 010E2 0000 C        	NOP
   120            C          else
   121            C        	NOP
   122            C        	CALL                IO_Rocker_KeyScan
   123            C        	NOP
   124            C          endif
   125            C        
   126 010E3 0000 C        	NOP
   127 010E4 122C C        	CALL                Rocker_KeyScan
   128 010E5 0000 C        	NOP
   129 010E6 1165 C        	CALL                Direction_KeyCheck
   130            C        
   131            C        ;-----------------------deal with DataE------------------------------------------
   132            C        ; bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0
   133            C        ; A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   134            C        ;--------------------------------------------------------------------------------
   135 010E7 00D0 C        	CLR                 TEMP
   136            C      M 	MOVB                TEMP,A_1,LINE2_KEY_INPUT_CACHE,_A
       010E8 0FFC     1     JBS  LINE2_KEY_INPUT_CACHE , _A 
       010E9 0810     1     BC  TEMP , A_1 
       010EA 0DFC     1     JBC  LINE2_KEY_INPUT_CACHE , _A 
       010EB 0A10     1     BS  TEMP , A_1 
   137            C      M 	MOVB                TEMP,B_2,LINE3_KEY_INPUT_CACHE,_B
       010EC 0FBD     1     JBS  LINE3_KEY_INPUT_CACHE , _B 
       010ED 0850     1     BC  TEMP , B_2 
       010EE 0DBD     1     JBC  LINE3_KEY_INPUT_CACHE , _B 
       010EF 0A50     1     BS  TEMP , B_2 
   138            C      M 	MOVB                TEMP,C_3,LINE4_KEY_INPUT_CACHE,_C
       010F0 0F7E     1     JBS  LINE4_KEY_INPUT_CACHE , _C 
       010F1 0890     1     BC  TEMP , C_3 
       010F2 0D7E     1     JBC  LINE4_KEY_INPUT_CACHE , _C 
       010F3 0A90     1     BS  TEMP , C_3 
   139            C      M 	MOVB                TEMP,D_4,LINE5_KEY_INPUT_CACHE,_D
       010F4 0F3F     1     JBS  LINE5_KEY_INPUT_CACHE , _D 
       010F5 08D0     1     BC  TEMP , D_4 
       010F6 0D3F     1     JBC  LINE5_KEY_INPUT_CACHE , _D 
       010F7 0AD0     1     BS  TEMP , D_4 
   140            C      M 	MOVB                TEMP,L1_5,LINE3_KEY_INPUT_CACHE,_L1
       010F8 0FFD     1     JBS  LINE3_KEY_INPUT_CACHE , _L1 
       010F9 0910     1     BC  TEMP , L1_5 
       010FA 0DFD     1     JBC  LINE3_KEY_INPUT_CACHE , _L1 
       010FB 0B10     1     BS  TEMP , L1_5 
   141            C      M 	MOVB                TEMP,R1_6,LINE4_KEY_INPUT_CACHE,_R1
       010FC 0FBE     1     JBS  LINE4_KEY_INPUT_CACHE , _R1 
       010FD 0950     1     BC  TEMP , R1_6 
       010FE 0DBE     1     JBC  LINE4_KEY_INPUT_CACHE , _R1 
       010FF 0B50     1     BS  TEMP , R1_6 
   142            C      M 	MOVB                TEMP,L2_7,LINE2_KEY_INPUT_CACHE,_L2
       01100 0F7C     1     JBS  LINE2_KEY_INPUT_CACHE , _L2 
       01101 0990     1     BC  TEMP , L2_7 
       01102 0D7C     1     JBC  LINE2_KEY_INPUT_CACHE , _L2 
       01103 0B90     1     BS  TEMP , L2_7 
   143            C      M 	MOVB                TEMP,R2_8,LINE3_KEY_INPUT_CACHE,_R2
       01104 0F3D     1     JBS  LINE3_KEY_INPUT_CACHE , _R2 
       01105 09D0     1     BC  TEMP , R2_8 
       01106 0D3D     1     JBC  LINE3_KEY_INPUT_CACHE , _R2 
       01107 0BD0     1     BS  TEMP , R2_8 
   144 01108 0410 C        	MOV                 A,TEMP
   145 01109 0264 C        	OR                  DataE,A
   146            C        
   147            C        ;-----------------------deal with DataF------------------------------------------
   148            C        ; bit0      bit1      bit2     bit3     bit4     bit5      bit6      bit7
   149            C        ; Select_9  Start_10  LSW_11   RSW_12   MODE_13  MACRO_14  TEST1_15  TEST2_16
   150            C        ;--------------------------------------------------------------------------------
   151            C        	;CLR                 DataF
   152            C      M 	MOVB                DataF,SELECT_9,LINE4_KEY_INPUT_CACHE,_Select
       0110A 0FFE     1     JBS  LINE4_KEY_INPUT_CACHE , _SELECT 
       0110B 0825     1     BC  DATAF , SELECT_9 
       0110C 0DFE     1     JBC  LINE4_KEY_INPUT_CACHE , _SELECT 
       0110D 0A25     1     BS  DATAF , SELECT_9 
   153            C      M 	MOVB                DataF,Start_10,LINE5_KEY_INPUT_CACHE,_Start
       0110E 0FBF     1     JBS  LINE5_KEY_INPUT_CACHE , _START 
       0110F 0865     1     BC  DATAF , START_10 
       01110 0DBF     1     JBC  LINE5_KEY_INPUT_CACHE , _START 
       01111 0A65     1     BS  DATAF , START_10 
   154            C      M 	MOVB                DataF,LSW_11,LINE5_KEY_INPUT_CACHE,_LSW
       01112 0FFF     1     JBS  LINE5_KEY_INPUT_CACHE , _LSW 
       01113 08A5     1     BC  DATAF , LSW_11 
       01114 0DFF     1     JBC  LINE5_KEY_INPUT_CACHE , _LSW 
       01115 0AA5     1     BS  DATAF , LSW_11 
   155            C      M 	MOVB                DataF,RSW_12,LINE2_KEY_INPUT_CACHE,_RSW
       01116 0F3C     1     JBS  LINE2_KEY_INPUT_CACHE , _RSW 
       01117 08E5     1     BC  DATAF , RSW_12 
       01118 0D3C     1     JBC  LINE2_KEY_INPUT_CACHE , _RSW 
       01119 0AE5     1     BS  DATAF , RSW_12 
   156            C        	;MOVB                DataF,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE
   157            C      M 	MOVB                DataF,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO
       0111A 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       0111B 0965     1     BC  DATAF , MACRO_14 
       0111C 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       0111D 0B65     1     BS  DATAF , MACRO_14 
   158            C      M 	MOVB                DataF,TEST1_15,LINE2_KEY_INPUT_CACHE,_TEST1
       0111E 0FBC     1     JBS  LINE2_KEY_INPUT_CACHE , _TEST1 
       0111F 09A5     1     BC  DATAF , TEST1_15 
       01120 0DBC     1     JBC  LINE2_KEY_INPUT_CACHE , _TEST1 
       01121 0BA5     1     BS  DATAF , TEST1_15 
   159            C      M 	MOVB                DataF,TEST2_16,LINE5_KEY_INPUT_CACHE,_TEST2
       01122 0F7F     1     JBS  LINE5_KEY_INPUT_CACHE , _TEST2 
       01123 09E5     1     BC  DATAF , TEST2_16 
       01124 0D7F     1     JBC  LINE5_KEY_INPUT_CACHE , _TEST2 
       01125 0BE5     1     BS  DATAF , TEST2_16 
   160            C        
   161 01126 0000 C        	NOP
   162 01127 0012 C        	RET
   163 01128 0000 C        	NOP
   164            C        
   165            C        ;===========================================================================
   166            C        ;Scan data form keyboard port
   167            C        ;===========================================================================
   168 01129      C        KeyPort_Check:
   169            C        ;LINE1:	read direct data from PortB to LINE1_KEY_INPUT
   170 01129 1E00 C        	BANK                0
   171 0112A 040B C        	MOV                 A,PORTB		;PortB = 00110110
   172 0112B 1E02 C        	BANK                2
   173 0112C 007B C        	MOV                 LINE1_KEY_INPUT_CACHE,A
   174 0112D 04FB C        	COM                 LINE1_KEY_INPUT_CACHE
   175 0112E 180F C        	MOV                 A,@_Directions
   176 0112F 02FB C        	AND                 LINE1_KEY_INPUT_CACHE,A
   177            C        
   178            C        ;LINE2:	;SET P77=1 P76=1 P75=1 P74=0
   179 01130 1E00 C        	BANK                0
   180 01131 18E8 C        	MOV                 A,@11101000B
   181 01132 0047 C        	MOV                 PORT7,A
   182 01133 11EB C        	CALL                KEY_DELAY
   183 01134 0409 C        	MOV                 A,PORT9
   184 01135 1E02 C        	BANK                2
   185 01136 007C C        	MOV                 LINE2_KEY_INPUT_CACHE,A
   186 01137 04FC C        	COM                 LINE2_KEY_INPUT_CACHE
   187 01138 18F0 C        	MOV                 A,@0XF0
   188 01139 02FC C        	AND                 LINE2_KEY_INPUT_CACHE,A
   189            C        
   190            C        ;LINE3:	;SET P77=1 P76=1 P75=0 P74=1
   191 0113A 1E00 C        	BANK                0
   192 0113B 18D8 C        	MOV                 A,@11011000B
   193 0113C 0047 C        	MOV                 PORT7,A
   194 0113D 11EB C        	CALL                KEY_DELAY
   195 0113E 0409 C        	MOV                 A,PORT9
   196 0113F 1E02 C        	BANK                2
   197 01140 007D C        	MOV                 LINE3_KEY_INPUT_CACHE,A
   198 01141 04FD C        	COM                 LINE3_KEY_INPUT_CACHE
   199 01142 18F0 C        	MOV                 A,@0XF0
   200 01143 02FD C        	AND                 LINE3_KEY_INPUT_CACHE,A
   201            C        
   202            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   203 01144 1E00 C        	BANK                0
   204 01145 18B8 C        	MOV                 A,@10111000B
   205 01146 0047 C        	MOV                 PORT7,A
   206 01147 11EB C        	CALL                KEY_DELAY
   207 01148 0409 C        	MOV                 A,PORT9
   208 01149 1E02 C        	BANK                2
   209 0114A 007E C        	MOV                 LINE4_KEY_INPUT_CACHE,A
   210 0114B 04FE C        	COM                 LINE4_KEY_INPUT_CACHE
   211 0114C 18F0 C        	MOV                 A,@0XF0
   212 0114D 02FE C        	AND                 LINE4_KEY_INPUT_CACHE,A
   213            C        
   214            C        ;LINE5:	;SET P77=0 P76=1 P75=1 P74=1
   215 0114E 1E00 C        	BANK                0
   216 0114F 1878 C        	MOV                 A,@01111000B
   217 01150 0047 C        	MOV                 PORT7,A
   218 01151 11EB C        	CALL                KEY_DELAY
   219 01152 0409 C        	MOV                 A,PORT9
   220 01153 1E02 C        	BANK                2
   221 01154 007F C        	MOV                 LINE5_KEY_INPUT_CACHE,A
   222 01155 04FF C        	COM                 LINE5_KEY_INPUT_CACHE
   223 01156 18F0 C        	MOV                 A,@0XF0
   224 01157 02FF C        	AND                 LINE5_KEY_INPUT_CACHE,A
   225 01158 0000 C        	NOP
   226            C        
   227            C        ;----------------------------------------------------------------
   228            C      M 	MOVB                KeyTempFlag,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE  ;save MODE FLAG
       01159 0F7D     1     JBS  LINE3_KEY_INPUT_CACHE , _MODE 
       0115A 0939     1     BC  KEYTEMPFLAG , MODE_13 
       0115B 0D7D     1     JBC  LINE3_KEY_INPUT_CACHE , _MODE 
       0115C 0B39     1     BS  KEYTEMPFLAG , MODE_13 
   229            C      M 	MOVB                KeyTempFlag,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO ;save MACRO FLAG
       0115D 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       0115E 0979     1     BC  KEYTEMPFLAG , MACRO_14 
       0115F 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       01160 0B79     1     BS  KEYTEMPFLAG , MACRO_14 
   230 01161 0000 C        	NOP
   231 01162 0000 C        	NOP
   232 01163 0012 C        	RET
   233 01164 0000 C        	NOP
   234            C        
   235            C        ;==============================================================================
   236            C        ;=======================Direction key board scan===============================
   237            C        ;==============================================================================
   238            C        ;------------------------deal with DataA/DataB---------------------------------
   239            C        ;DataA	left-right: left=0x00, right=0xff, no-left-right=0x7f
   240            C        ;DataB	up-down:    down=0x00, up=0xff,    no-left-right=0x7f
   241            C        ;DataG  000:00 001:45 010:90 011:135 100:180 101:225 110:270 111:315
   242            C        ;------------------------------------------------------------------------------
   243 01165      C        Direction_KeyCheck:
   244 01165 0000 C        	NOP
   245 01166 0F25 C        	JBS                 DataF,MODE_13
   246 01167 1569 C        	JMP                 DealWith_Direction_Digital
   247 01168 15A8 C        	JMP                 DealWith_HatSwitch_Analog
   248            C        
   249 01169      C        DealWith_Direction_Digital:
   250 01169      C        LEFT_RIGHT_KEY:
   251 01169 0C3B C        	JBC                 LINE1_KEY_INPUT_CACHE,_RIGHT   ;judge right
   252 0116A 156E C        	JMP                 JudgeRight
   253 0116B 0C7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_LEFT    ;judeg left
   254 0116C 1579 C        	JMP                 JudgeLeft
   255 0116D 1583 C        	JMP                 Left_Right_Finsh
   256 0116E      C          JudgeRight:
   257 0116E 1800 C        	MOV                 A,@0X00
   258 0116F 0320 C        	XOR                 A,DataA
   259 01170 0E83 C        	JBS                 STATUS,Z
   260 01171 1573 C        	JMP                 JudgeRight_1
   261 01172 1575 C        	JMP                 JudgeRight_2
   262 01173      C          JudgeRight_1:
   263 01173 18FF C        	MOV                 A,@0XFF
   264 01174 1577 C        	JMP                 JudgeRight_End
   265 01175      C          JudgeRight_2:
   266 01175 187F C        	MOV                 A,@0X7F
   267 01176 1577 C        	JMP                 JudgeRight_End
   268 01177      C          JudgeRight_End:
   269 01177 0060 C        	MOV                 DataA,A
   270 01178 1583 C        	JMP                 Left_Right_Finsh
   271            C        
   272 01179      C          JudgeLeft:
   273 01179 18FF C        	MOV                 A,@0XFF
   274 0117A 0320 C        	XOR                 A,DataA
   275 0117B 0E83 C        	JBS                 STATUS,Z
   276 0117C 157E C        	JMP                 JudgeLeft_1  ;Z=0,sameness
   277 0117D 1580 C        	JMP                 JudgeLeft_2  ;Z=1,reverse
   278 0117E      C          JudgeLeft_1:
   279 0117E 1800 C        	MOV                 A,@0X00
   280 0117F 1582 C        	JMP                 JudgeLeft_End
   281 01180      C          JudgeLeft_2:
   282 01180 187F C        	MOV                 A,@0X7F
   283 01181 1582 C        	JMP                 JudgeLeft_End
   284 01182      C          JudgeLeft_End:
   285 01182 0060 C        	MOV                 DataA,A
   286 01183      C          Left_Right_Finsh:
   287 01183 0000 C        	NOP
   288            C        ;--------------------------------------------------------------
   289 01184      C        UP_DOWN_KEY:
   290 01184 0CFB C        	JBC                 LINE1_KEY_INPUT_CACHE,_UP     ;judge up(0X00)
   291 01185 1594 C        	JMP                 JudgeDown
   292 01186 0CBB C        	JBC                 LINE1_KEY_INPUT_CACHE,_DOWN   ;judeg down(0XFF)
   293 01187 1589 C        	JMP                 JudgeUp
   294 01188 159F C        	JMP                 UP_DOWN_Finsh
   295 01189      C          JudgeUp:
   296 01189 1800 C        	MOV                 A,@0X00
   297 0118A 0321 C        	XOR                 A,DataB
   298 0118B 0E83 C        	JBS                 STATUS,Z
   299 0118C 158E C        	JMP                 JudgeUp_1
   300 0118D 1590 C        	JMP                 JudgeUp_2
   301 0118E      C          JudgeUp_1:
   302 0118E 18FF C        	MOV                 A,@0XFF
   303 0118F 1592 C        	JMP                 JudgeUp_End
   304 01190      C          JudgeUp_2:
   305 01190 187F C        	MOV                 A,@0X7F
   306 01191 1592 C        	JMP                 JudgeUp_End
   307 01192      C          JudgeUp_End:
   308 01192 0061 C        	MOV                 DataB,A
   309 01193 159F C        	JMP                 UP_DOWN_Finsh
   310            C        
   311 01194      C          JudgeDown:
   312 01194 18FF C        	MOV                 A,@0XFF
   313 01195 0321 C        	XOR                 A,DataB
   314 01196 0E83 C        	JBS                 STATUS,Z
   315 01197 1599 C        	JMP                 JudgeDown_1
   316 01198 159B C        	JMP                 JudgeDown_2
   317 01199      C          JudgeDown_1:
   318 01199 1800 C        	MOV                 A,@0X00
   319 0119A 159D C        	JMP                 JudgeDown_End
   320 0119B      C          JudgeDown_2:
   321 0119B 187F C        	MOV                 A,@0X7F
   322 0119C 159D C        	JMP                 JudgeDown_End
   323 0119D      C          JudgeDown_End:
   324 0119D 0061 C        	MOV                 DataB,A
   325 0119E 159F C        	JMP                 UP_DOWN_Finsh
   326 0119F      C          UP_DOWN_Finsh:
   327 0119F 0000 C        	NOP
   328 011A0 187F C        	MOV                 A,@0X7F
   329 011A1 0062 C        	MOV                 DataC,A
   330 011A2 0063 C        	MOV                 DataD,A
   331 011A3 180F C          	MOV                 A,@0X0F
   332 011A4 0066 C          	MOV                 DataG,A
   333 011A5 0000 C        	NOP
   334 011A6 0012 C        	RET
   335 011A7 0000 C        	NOP
   336            C        
   337            C        ;----------------------------------------------------
   338 011A8      C        DealWith_HatSwitch_Analog:
   339 011A8 00E4 C        	CLR                 DataE
   340 011A9 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   341 011AA 1B00 C        	XOR                 A,@0B00000000
   342 011AB 0E83 C        	JBS                 STATUS,Z
   343 011AC 15B0 C        	JMP                 DATAG_0
   344            C      M 	MOV                 DataG,@0X0F          ;none
       011AD 180F     1     MOV A,@( 15 )
       011AE 0066     1     MOV  DATAG ,A
   345 011AF 15E8 C        	JMP                 HAT_SWITCH_END
   346 011B0      C          DataG_0:
   347 011B0 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   348 011B1 1B20 C        	XOR                 A,@0B00100000
   349 011B2 0E83 C        	JBS                 STATUS,Z
   350 011B3 15B7 C        	JMP                 DataG_45
   351            C      M 	MOV                 DataG,@0X00          ;0
       011B4 1800     1     MOV A,@( 0 )
       011B5 0066     1     MOV  DATAG ,A
   352 011B6 15E8 C        	JMP                 HAT_SWITCH_END
   353 011B7      C          DataG_45:
   354 011B7 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   355 011B8 1B30 C        	XOR                 A,@0B00110000
   356 011B9 0E83 C        	JBS                 STATUS,Z
   357 011BA 15BE C        	JMP                 DataG_90
   358            C      M 	MOV                 DataG,@0X01          ;45
       011BB 1801     1     MOV A,@( 1 )
       011BC 0066     1     MOV  DATAG ,A
   359 011BD 15E8 C        	JMP                 HAT_SWITCH_END
   360 011BE      C          DataG_90:
   361 011BE 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   362 011BF 1B10 C        	XOR                 A,@0B00010000
   363 011C0 0E83 C        	JBS                 STATUS,Z
   364 011C1 15C5 C        	JMP                 DataG_135
   365            C      M 	MOV                 DataG,@0X02          ;90
       011C2 1802     1     MOV A,@( 2 )
       011C3 0066     1     MOV  DATAG ,A
   366 011C4 15E8 C        	JMP                 HAT_SWITCH_END
   367 011C5      C          DataG_135:
   368 011C5 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   369 011C6 1B14 C        	XOR                 A,@0B00010100
   370 011C7 0E83 C        	JBS                 STATUS,Z
   371 011C8 15CC C        	JMP                 DataG_180
   372            C      M 	MOV                 DataG,@0X03          ;135
       011C9 1803     1     MOV A,@( 3 )
       011CA 0066     1     MOV  DATAG ,A
   373 011CB 15E8 C        	JMP                 HAT_SWITCH_END
   374 011CC      C          DataG_180:
   375 011CC 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   376 011CD 1B04 C        	XOR                 A,@0B00000100
   377 011CE 0E83 C        	JBS                 STATUS,Z
   378 011CF 15D3 C        	JMP                 DataG_225
   379            C      M 	MOV                 DataG,@0X04          ;180
       011D0 1804     1     MOV A,@( 4 )
       011D1 0066     1     MOV  DATAG ,A
   380 011D2 15E8 C        	JMP                 HAT_SWITCH_END
   381 011D3      C          DataG_225:
   382 011D3 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   383 011D4 1B06 C        	XOR                 A,@0B00000110
   384 011D5 0E83 C        	JBS                 STATUS,Z
   385 011D6 15DA C        	JMP                 DataG_270
   386            C      M 	MOV                 DataG,@0X05          ;225
       011D7 1805     1     MOV A,@( 5 )
       011D8 0066     1     MOV  DATAG ,A
   387 011D9 15E8 C        	JMP                 HAT_SWITCH_END
   388 011DA      C          DataG_270:
   389 011DA 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   390 011DB 1B02 C        	XOR                 A,@0B00000010
   391 011DC 0E83 C        	JBS                 STATUS,Z
   392 011DD 15E1 C        	JMP                 DataG_315
   393            C      M 	MOV                 DataG,@0X06          ;270
       011DE 1806     1     MOV A,@( 6 )
       011DF 0066     1     MOV  DATAG ,A
   394 011E0 15E8 C        	JMP                 HAT_SWITCH_END
   395 011E1      C          DataG_315:
   396 011E1 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   397 011E2 1B22 C        	XOR                 A,@0B00100010
   398 011E3 0E83 C        	JBS                 STATUS,Z
   399 011E4 15E8 C        	JMP                 HAT_SWITCH_END
   400            C      M 	MOV                 DataG,@0X07          ;315
       011E5 1807     1     MOV A,@( 7 )
       011E6 0066     1     MOV  DATAG ,A
   401 011E7 15E8 C        	JMP                 HAT_SWITCH_END
   402            C        
   403 011E8      C          HAT_SWITCH_END:
   404 011E8 0000 C        	NOP
   405 011E9 0012 C        	RET
   406 011EA 0000 C        	NOP
   407            C        
   408            C        ;===================================================================
   409            C        ; Delay function
   410            C        ;===================================================================
   411 011EB      C        KEY_DELAY:
   412 011EB 0000 C        	NOP
   413 011EC 0000 C        	NOP
   414 011ED 0000 C        	NOP
   415 011EE 0000 C        	NOP
   416 011EF 0000 C        	NOP
   417 011F0 0000 C        	NOP
   418 011F1 0000 C        	NOP
   419 011F2 0012 C        	RET
   420 011F3 0000 C        	NOP
   421            C        
   422            C        
   423            C        ;============================================================================
   424            C        ;file name:     ADC 3D Rocker KeyScan
   425            C        ;INPUT PORT:
   426            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   427            C        ;TIME:          1050uS
   428            C        ;Descrition:    Use for check AD rocker data
   429            C        ;============================================================================
   430 011F4      C        ADC_Rocker_KeyScan:
   431            C        
   432 011F4 0000 C        	NOP
   433 011F5 1E03 C        	BANK                 3
   434 011F6 0B89 C        	BS                   ADCR,ADP
   435 011F7 00CC C        	CLR                  ADDH
   436 011F8 0409 C        	MOV                  A,ADCR
   437 011F9 1AF0 C        	AND                  A,@0B11110000
   438 011FA 1980 C        	OR                   A,@0B10000000
   439 011FB 0049 C        	MOV                  ADCR,A              ;Select ADE0/P93.Rx
   440 011FC 12B7 C        	CALL                 SUB_ADC
   441 011FD 040C C        	MOV                  A,ADDH
   442 011FE 1E02 C        	BANK                 2
   443 011FF 0072 C        	MOV                  KEY_RIGHT_X,A
   444            C        
   445 01200 1E03 C        	BANK                 3
   446 01201 00CC C        	CLR                  ADDH
   447 01202 0409 C        	MOV                  A,ADCR
   448 01203 1AF0 C        	AND                  A,@0B11110000
   449 01204 1901 C        	OR                   A,@0B00000001
   450 01205 0049 C        	MOV                  ADCR,A              ;Select ADE1/P92.Ry
   451 01206 1805 C        	MOV                  A,@5
   452 01207 1EA0 C        	LCALL                DELAY_X10US
   452 01208 042D C        	LCALL                DELAY_X10US
   453 01209 12B7 C        	CALL                 SUB_ADC
   454 0120A 040C C        	MOV                  A,ADDH
   455 0120B 1E02 C        	BANK                 2
   456 0120C 0073 C        	MOV                  KEY_RIGHT_Y,A
   457            C        	;COM                  KEY_RIGHT_Y
   458            C        
   459 0120D 1E03 C        	BANK                 3
   460 0120E 00CC C        	CLR                  ADDH
   461 0120F 0409 C        	MOV                  A,ADCR
   462 01210 1AF0 C        	AND                  A,@0B11110000
   463 01211 1902 C        	OR                   A,@0B00000010
   464 01212 0049 C        	MOV                  ADCR,A              ;Select ADE2/P91.Lx
   465 01213 1805 C        	MOV                  A,@5
   466 01214 1EA0 C        	LCALL                DELAY_X10US
   466 01215 042D C        	LCALL                DELAY_X10US
   467 01216 12B7 C        	CALL                 SUB_ADC
   468 01217 040C C        	MOV                  A,ADDH
   469 01218 1E02 C        	BANK                 2
   470 01219 0070 C        	MOV                  KEY_LEFT_X,A
   471            C        
   472 0121A 1E03 C        	BANK                 3
   473 0121B 00CC C        	CLR                  ADDH
   474 0121C 0409 C        	MOV                  A,ADCR
   475 0121D 1AF0 C        	AND                  A,@0B11110000
   476 0121E 1903 C        	OR                   A,@0B00000011
   477 0121F 0049 C        	MOV                  ADCR,A              ;Select ADE3/P90.Ly
   478 01220 1805 C        	MOV                  A,@5
   479 01221 1EA0 C        	LCALL                DELAY_X10US
   479 01222 042D C        	LCALL                DELAY_X10US
   480 01223 12B7 C        	CALL                 SUB_ADC
   481 01224 040C C        	MOV                  A,ADDH
   482 01225 1E02 C        	BANK                 2
   483 01226 0071 C        	MOV                  KEY_LEFT_Y,A
   484            C        	;COM                  KEY_LEFT_Y
   485 01227 1E03 C        	BANK                 3
   486 01228 0989 C        	BC                   ADCR,ADP
   487            C        
   488            C        	;bank                 2
   489            C        	;mov                  a,@0x7f
   490            C        	;mov                  key_right_x,a
   491            C        	;mov                  key_right_y,a
   492            C        	;mov                  key_left_x,a
   493            C        	;mov                  key_left_y,a
   494            C        
   495 01229 0000 C        	NOP
   496 0122A 0012 C        	RET
   497 0122B 0000 C        	NOP
   498            C        
   499 0122C      C        Rocker_KeyScan:
   500            C        ;======================== jugde rocker signal select ==========================
   501 0122C 1E02 C        	BANK                2
   502 0122D 0F25 C        	JBS                 DataF,MODE_13       ;select digital or analog
   503 0122E 1630 C        	JMP                 DealWith_ADC_Digital
   504 0122F 1646 C        	JMP                 DealWith_ADC_Analog
   505            C        
   506 01230      C          DealWith_ADC_Digital:
   507 01230 00E0 C        	CLR                 DataA
   508 01231 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   509 01232 0051 C        	MOV                 TEMP1,A
   510 01233 1252 C        	CALL                AreaJudge_direction
   511 01234 0060 C        	MOV                 DataA,A
   512            C        
   513 01235 00E1 C        	CLR                 DataB
   514 01236 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   515 01237 0051 C        	MOV                 TEMP1,A
   516 01238 1252 C        	CALL                AreaJudge_direction
   517 01239 0061 C        	MOV                 DataB,A
   518            C        
   519 0123A 187F C        	MOV                 A,@0X7F
   520 0123B 0062 C        	MOV                 DataC,A
   521 0123C 0063 C        	MOV                 DataD,A
   522            C        
   523 0123D 00E4 C        	CLR                 DataE
   524 0123E 0432 C        	MOV                 A,KEY_RIGHT_X		;A,B,C,D,
   525 0123F 0052 C        	MOV                 TEMP2,A
   526 01240 0433 C        	MOV                 A,KEY_RIGHT_Y
   527 01241 0053 C        	MOV                 TEMP3,A
   528 01242 1266 C        	CALL                AreaJudge_Button
   529 01243 0410 C        	MOV                 A,TEMP
   530 01244 0064 C        	MOV                 DataE,A
   531 01245 164F C        	JMP                 RockerCheakFinish
   532            C        
   533 01246      C          DealWith_ADC_Analog:
   534 01246 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   535 01247 0060 C        	MOV                 DataA,A
   536 01248 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   537 01249 0061 C        	MOV                 DataB,A
   538 0124A 0432 C        	MOV                 A,KEY_RIGHT_X		;R-left_right
   539 0124B 0062 C        	MOV                 DataC,A
   540 0124C 0433 C        	MOV                 A,KEY_RIGHT_Y		;R-up_down
   541 0124D 0063 C        	MOV                 DataD,A
   542 0124E 164F C        	JMP                 RockerCheakFinish
   543            C        
   544 0124F      C          RockerCheakFinish:
   545 0124F 0000 C        	NOP
   546 01250 0012 C        	RET
   547 01251 0000 C        	NOP
   548            C        
   549            C        ;=============================jugde the direction=====================================
   550            C        ;Input:      TEMP1
   551            C        ;output:     A
   552            C        ;=====================================================================================
   553 01252      C        AreaJudge_direction:
   554 01252 1E02 C        	BANK                2
   555 01253 0411 C        	MOV                 A,TEMP1     ;Store
   556 01254 1DBF C        	SUB                 A,@0XBF
   557 01255 0E03 C        	JBS                 R3,0        ;R3,bit0(C)
   558 01256 1658 C        	JMP                 CheakTop_Left
   559 01257 165A C        	JMP                 CheakMiddle_Left
   560 01258      C          CheakTop_Left:
   561 01258 18FF C        	MOV                 A,@0XFF   ;up
   562 01259 1662 C        	JMP                 CheakAreaFinish_Left
   563 0125A      C          CheakMiddle_Left:
   564 0125A 0411 C        	MOV                 A,TEMP1
   565 0125B 1D40 C        	SUB                 A,@0X40
   566 0125C 0C03 C        	JBC                 R3,0
   567 0125D 1660 C        	JMP                 CheakBottom_Left
   568 0125E 187F C        	MOV                 A,@0X7F
   569 0125F 1662 C        	JMP                 CheakAreaFinish_Left
   570 01260      C          CheakBottom_Left:
   571 01260 1800 C        	MOV                 A,@0X00   ;down
   572 01261 1662 C        	JMP                 CheakAreaFinish_Left
   573 01262      C          CheakAreaFinish_Left:
   574 01262 0000 C        	NOP
   575 01263 0000 C        	NOP
   576 01264 0012 C        	RET
   577 01265 0000 C        	NOP
   578            C        
   579            C        ;============================jugde what button press============================
   580            C        ;input:     TEMP2,TEMP3
   581            C        ;output:    TEMP
   582            C        ;===============================================================================
   583 01266      C        AreaJudge_Button:
   584 01266 1E02 C        	BANK                2
   585 01267 0412 C        	MOV                 A,TEMP2    ;KEY_RIGHT_Y
   586 01268 1DD0 C        	SUB                 A,@0XD0
   587 01269 0E03 C        	JBS                 R3,C	     ;R3,bit0(C)
   588 0126A 166C C        	JMP                 CheakTop_Right_y
   589 0126B 166E C        	JMP                 CheakMiddle_Right_y
   590            C        
   591 0126C      C          CheakTop_Right_y:
   592 0126C 18FF C        	MOV                 A,@0XFF  ;up
   593 0126D 1676 C        	JMP                 CheakAreaFinish_Right_y
   594 0126E      C          CheakMiddle_Right_y:
   595 0126E 0412 C        	MOV                 A,TEMP2
   596 0126F 1D25 C        	SUB                 A,@0X25
   597 01270 0E03 C        	JBS                 R3,C
   598 01271 1674 C        	JMP                 CheakBottom_Right_y
   599 01272 1800 C        	MOV                 A,@0X00  ;dwon
   600 01273 1676 C        	JMP                 CheakAreaFinish_Right_y
   601 01274      C          CheakBottom_Right_y:
   602 01274 187F C        	MOV                 A,@0X7F
   603 01275 1676 C        	JMP                 CheakAreaFinish_Right_y
   604 01276      C          CheakAreaFinish_Right_y:
   605 01276 0052 C        	MOV                 TEMP2,A
   606 01277 0000 C        	NOP
   607            C        ;---------------------------------------------------
   608 01278 1E02 C        	BANK                2
   609 01279 0413 C        	MOV                 A,TEMP3    ;KEY_RIGHT_Y
   610 0127A 1DD0 C        	SUB                 A,@0XD0
   611 0127B 0E03 C        	JBS                 R3,C       ;R3,bit0(C)
   612 0127C 167E C        	JMP                 CheakTop_Right_x
   613 0127D 1680 C        	JMP                 CheakMiddle_Right_x
   614 0127E      C          CheakTop_Right_x:
   615 0127E 18FF C        	MOV                 A,@0XFF   ;right
   616 0127F 1688 C        	JMP                 CheakAreaFinish_Right_x
   617 01280      C          CheakMiddle_Right_x:
   618 01280 0413 C        	MOV                 A,TEMP3
   619 01281 1D25 C        	SUB                 A,@0X25
   620 01282 0E03 C        	JBS                 R3,0
   621 01283 1686 C        	JMP                 CheakBottom_Right_x
   622 01284 1800 C        	MOV                 A,@0X00   ;left
   623 01285 1688 C        	JMP                 CheakAreaFinish_Right_x
   624 01286      C          CheakBottom_Right_x:
   625 01286 187F C        	MOV                 A,@0X7F
   626 01287 1688 C        	JMP                 CheakAreaFinish_Right_x
   627 01288      C          CheakAreaFinish_Right_x:
   628 01288 0053 C        	MOV                 TEMP3,A
   629 01289 0000 C        	NOP
   630            C        
   631            C        ;-----------------------------------------------------
   632 0128A 00D0 C        	CLR                 TEMP
   633 0128B 0412 C        	MOV                 A,TEMP2      ;left
   634 0128C 1B00 C        	XOR                 A,@0X00
   635 0128D 0C83 C        	JBC                 STATUS,Z
   636 0128E 0A10 C        	BS                  TEMP,A_1
   637            C        
   638 0128F 0412 C        	MOV                 A,TEMP2      ;right
   639 01290 1BFF C        	XOR                 A,@0XFF
   640 01291 0C83 C        	JBC                 STATUS,Z
   641 01292 0A90 C        	BS                  TEMP,C_3
   642            C        
   643 01293 0413 C        	MOV                 A,TEMP3      ;down
   644 01294 1BFF C        	XOR                 A,@0XFF
   645 01295 0C83 C        	JBC                 STATUS,Z
   646 01296 0AD0 C        	BS                  TEMP,D_4
   647            C        
   648 01297 0413 C        	MOV                 A,TEMP3      ;up
   649 01298 1B00 C        	XOR                 A,@0X00
   650 01299 0C83 C        	JBC                 STATUS,Z
   651 0129A 0A50 C        	BS                  TEMP,B_2
   652 0129B 0012 C        	RET
   653 0129C 0000 C        	NOP
   654            C        
   655            C        ;===================================================================
   656 0129D      C        SUB_ADJ:
   657 0129D 1E03 C        	BANK                3
   658 0129E 0BCA C        	BS                  ADICH,CALI    ;ENABLE CALIBRATION
   659 0129F      C          ADCJUDGE_LOOP:
   660 0129F 0BC9 C        	BS                  ADCR,ADRUN
   661 012A0 0DC9 C        	JBC                 ADCR,ADRUN
   662 012A1 16A0 C        	JMP                 $-1
   663            C        
   664 012A2 040D C        	MOV                 A,ADDL
   665 012A3 1A0F C        	AND                 A,@0X0F
   666 012A4 0E83 C        	JBS                 R3,Z
   667 012A5 16AC C        	JMP                 ADCJUDGE_DONE
   668 012A6 040C C        	MOV                 A,ADDH
   669 012A7 0E83 C        	JBS                 R3,Z
   670 012A8 16AC C        	JMP                 ADCJUDGE_DONE
   671 012A9 1810 C        	MOV                 A,@0X10
   672 012AA 03CD C        	ADD                 ADDL,A
   673 012AB 169F C        	JMP                 ADCJUDGE_LOOP
   674 012AC      C          ADCJUDGE_DONE:
   675 012AC 09CA C        	BC                  ADICH,CALI
   676 012AD 0012 C        	RET
   677 012AE 0000 C        	NOP
   678            C        
   679            C        ;===================================================================
   680 012AF      C        SUB_RINIT:
   681 012AF 1E03 C        	BANK                3
   682 012B0 180F C        	MOV                 A,@0X0F
   683 012B1 004B C        	MOV                 ADICL,A      ;SELECT ADE0~ ADE3 AS ANALOG INPUT
   684 012B2 00CA C        	CLR                 ADICH         ;VREFS==VDD
   685 012B3 1860 C        	MOV                 A,@0B01100000
   686 012B4 0049 C        	MOV                 ADCR,A       ;SELECT  AD0,SELECT ADCKR1/ADCKR0=1:0,ADP=1
   687 012B5 0012 C        	RET
   688 012B6 0000 C        	NOP
   689            C        
   690            C        ;===================================================================
   691 012B7      C        SUB_ADC:
   692 012B7 1E03 C        	BANK                3
   693 012B8 0BC9 C        	BS                  ADCR,ADRUN
   694 012B9 0DC9 C        	JBC                 ADCR,ADRUN
   695 012BA 16B9 C        	JMP                 $-1
   696 012BB 0000 C        	NOP
   697 012BC 0012 C        	RET
   698 012BD 0000 C        	NOP
   699            C        
   700            C        
   701            C        
   702            C        ;============================================================================
   703            C        ;file name:     IO 3D Rocker KeyScan
   704            C        ;INPUT PORT:
   705            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   706            C        ;TIME:
   707            C        ;Descrition:    Use for check AD rocker data
   708            C        ;============================================================================
   709 012BE      C        IO_Rocker_KeyScan:
   710 012BE 0000 C        	NOP
   711 012BF 0000 C        	NOP
   712 012C0 12DD C        	CALL                Pre_Discharge
   713 012C1 130B C        	CALL                SampingRefTiming   ; Ref
   714 012C2 12DD C        	CALL                Pre_Discharge
   715 012C3 1322 C        	CALL                SampingLxTiming    ; Lx
   716 012C4 12DD C        	CALL                Pre_Discharge
   717 012C5 1339 C        	CALL                SampingLyTiming    ; Ly
   718 012C6 12DD C        	CALL                Pre_Discharge
   719 012C7 1350 C        	CALL                SampingRxTiming    ; Rx
   720 012C8 12DD C        	CALL                Pre_Discharge
   721 012C9 1367 C        	CALL                SampingRyTiming    ; Ry
   722 012CA 12FA C        	CALL                Back_Discharge
   723 012CB 0000 C        	NOP
   724            C        
   725 012CC 1E02 C        	BANK                2
   726 012CD 0430 C        	MOV                 A,KEY_LEFT_X
   727 012CE 137F C        	CALL                Conversion_Data
   728 012CF 0070 C        	MOV                 KEY_LEFT_X,A        ; Left x Axis
   729 012D0 0431 C        	MOV                 A,KEY_LEFT_Y
   730 012D1 137F C        	CALL                Conversion_Data
   731 012D2 0071 C        	MOV                 KEY_LEFT_Y,A        ; Left y Axis
   732 012D3 0432 C        	MOV                 A,KEY_RIGHT_X
   733 012D4 137F C        	CALL                Conversion_Data
   734 012D5 0072 C        	MOV                 KEY_RIGHT_X,A       ; right x Axis
   735 012D6 0433 C        	MOV                 A,KEY_RIGHT_Y
   736 012D7 137F C        	CALL                Conversion_Data
   737 012D8 0073 C        	MOV                 KEY_RIGHT_Y,A       ; right y Axis
   738            C        
   739 012D9 0000 C        	NOP
   740 012DA 0000 C        	NOP
   741 012DB 0012 C        	RET
   742 012DC 0000 C        	NOP
   743            C        
   744            C        ;---------------------------------------------------------------
   745 012DD      C        Pre_Discharge:
   746 012DD 1E04 C        	BANK                4
   747 012DE 18FF C        	MOV                 A,@0B11111111
   748 012DF 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   749            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   750            C        	;BS                  P8IOCR,Reference     ; Input P87
   751 012E0 0408 C        	MOV                 A,P8IOCR
   752 012E1 1A3F C        	AND                 A,@0B00111111
   753 012E2 19C0 C        	OR                  A,@0B11000000
   754 012E3 0048 C        	MOV                 P8IOCR,A             ; Set P87->Input,P86->Input
   755            C        
   756 012E4 18F0 C        	MOV                 A,@0B11110000
   757 012E5 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   758 012E6 0988 C        	BC                  P8IOCR,Leakresis     ; Output P86
   759 012E7 09C8 C        	BC                  P8IOCR,Reference     ; Output P87
   760            C        	;MOV                 A,P8IOCR
   761            C        	;AND                 A,@0B00111111
   762            C        	;OR                  A,@0B00000000
   763            C        	;MOV                 P8IOCR,A            ; Set P87->Output,P86->Output
   764 012E8 1E00 C        	BANK                0
   765 012E9 00C9 C        	CLR                 PORT9
   766            C        	;BC                  PORT9,LeftYAxis
   767            C        	;BC                  PORT9,LeftXAxis
   768            C        	;BC                  PORT9,RightYAxis
   769            C        	;BC                  PORT9,RightXAxis
   770 012EA 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   771 012EB 09C8 C        	BC                  PORT8,Reference     ; Set P87 Low
   772            C        
   773 012EC 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   774            C        ;  if IOtoADC_T_DEBUG ==1
   775            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   776            C        ;	XOR                 PORT8,A
   777            C        ;  endif
   778 012ED 1E02 C        	BANK                2
   779 012EE 0B49 C        	BS                  T2CR,T2EN          ; START
   780 012EF 00ED C        	CLR                 IOcheckTimeCNT
   781 012F0 042D C        	MOV                 A,IOcheckTimeCNT
   782 012F1 1D0A C        	SUB                 A,@LeakresisTimeCNT
   783 012F2 0C03 C        	JBC                 STATUS,C
   784 012F3 16F0 C        	JMP                 $-3
   785 012F4 0949 C        	BC                  T2CR,T2EN          ; Disable
   786 012F5 1E00 C        	BANK                0
   787            C        ;  if IOtoADC_T_DEBUG ==1
   788            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   789            C        ;	XOR                 PORT8,A
   790            C        ;  endif
   791 012F6 1881 C        	MOV                 A,@0B10000001
   792 012F7 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   793 012F8 0012 C        	RET
   794 012F9 0000 C        	NOP
   795            C        
   796 012FA      C        Back_Discharge:
   797 012FA 1E04 C        	BANK                4
   798 012FB 18FF C        	MOV                 A,@0B11111111
   799 012FC 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   800            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   801            C        	;BS                  P8IOCR,Reference     ; Input P87
   802 012FD 0408 C        	MOV                 A,P8IOCR
   803 012FE 1A3F C        	AND                 A,@0B00111111
   804 012FF 19C0 C        	OR                  A,@0B11000000
   805 01300 0048 C        	MOV                 P8IOCR,A            ; Set P87->Input,P86->Input
   806            C        
   807 01301 18F0 C        	MOV                 A,@0B11110000
   808 01302 0049 C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   809 01303 0988 C        	BC                  P8IOCR,Leakresis     ; Output P86
   810 01304 09C8 C        	BC                  P8IOCR,Reference     ; Output P87
   811            C        	;MOV                 A,P8IOCR
   812            C        	;AND                 A,@0B00111111
   813            C        	;OR                  A,@0B10000000
   814            C        	;MOV                 P8IOCR,A            ; Set P87->Input,P86->Output
   815 01305 1E00 C        	BANK                0
   816 01306 00C9 C        	CLR                 PORT9
   817            C        	;BC                  PORT9,LeftYAxis
   818            C        	;BC                  PORT9,LeftXAxis
   819            C        	;BC                  PORT9,RightYAxis
   820            C        	;BC                  PORT9,RightXAxis
   821 01307 0988 C        	BC                  PORT8,Leakresis     ; Set P86 Low
   822 01308 09C8 C        	BC                  PORT8,Reference     ; Set P87 Low
   823 01309 0012 C        	RET
   824 0130A 0000 C        	NOP
   825            C        
   826            C        ;---------------------------------------------------------------
   827 0130B      C        SampingRefTiming:
   828 0130B 1E04 C        	BANK                4
   829 0130C 18FF C        	MOV                 A,@0B11111111
   830 0130D 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   831 0130E 0B88 C        	BS                  P8IOCR,Leakresis    ; Input  P86
   832 0130F 09C8 C        	BC                  P8IOCR,Reference    ; Output P87
   833            C        	;MOV                 A,P8IOCR
   834            C        	;AND                 A,@0B00111111
   835            C        	;OR                  A,@0B01000000
   836            C        	;MOV                 P8IOCR,A           ; Set P87->Output,P86->Input
   837 01310 1E00 C        	BANK                0
   838            C        	;BS                  PORT9,LeftYAxis
   839            C        	;BS                  PORT9,LeftXAxis
   840            C        	;BS                  PORT9,RightYAxis
   841            C        	;BS                  PORT9,RightXAxis
   842            C        	;BS                  PORT8,Leakresis    ; Set P86
   843 01311 0BC8 C        	BS                  PORT8,Reference     ; Set P87 High
   844            C        
   845 01312 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   846            C        ;  if IOtoADC_T_DEBUG ==1
   847            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   848            C        ;	XOR                 PORT8,A
   849            C        ;  endif
   850 01313 1E02 C        	BANK                2
   851            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   852            C        	;MOV                 T2PD,A
   853 01314 0B49 C        	BS                  T2CR,T2EN          ; START
   854 01315 00ED C        	CLR                 IOcheckTimeCNT
   855 01316 1E00 C        	BANK                0
   856 01317 0F88 C        	JBS                 PORT8,Leakresis
   857 01318 1717 C        	JMP                 $-1
   858            C        	;MOV                 A,@0B10000001
   859            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   860            C        ;  if IOtoADC_T_DEBUG ==1
   861            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   862            C        ;	XOR                 PORT8,A
   863            C        ;  endif
   864 01319 1E02 C        	BANK                2
   865 0131A 0949 C        	BC                  T2CR,T2EN          ; Disable
   866 0131B 042D C        	MOV                 A,IOcheckTimeCNT
   867 0131C 006A C        	MOV                 IOcheckRefValue,A
   868 0131D 1E00 C        	BANK                0
   869 0131E 1881 C        	MOV                 A,@0B10000001
   870 0131F 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   871 01320 0012 C        	RET
   872 01321 0000 C        	NOP
   873            C        
   874            C        
   875            C        
   876            C        ;---------------------------------------------------------------
   877 01322      C        SampingLxTiming:
   878 01322 1E04 C        	BANK                4
   879 01323 18FD C        	MOV                 A,@0B11111101
   880 01324 0049 C        	MOV                 P9IOCR,A            ; P97-P92:Input; P91:output; P90:Input
   881 01325 0B88 C        	BS                  P8IOCR,Leakresis    ; input
   882 01326 0BC8 C        	BS                  P8IOCR,Reference    ; input
   883            C        	;MOV                 A,P8IOCR
   884            C        	;AND                 A,@0B00111111
   885            C        	;OR                  A,@0B11000000
   886            C        	;MOV                 P8IOCR,A
   887 01327 1E00 C        	BANK                0
   888            C        	;BS                  PORT9,LeftYAxis
   889 01328 0A49 C        	BS                  PORT9,LeftXAxis     ; Set P91 HIGH
   890            C        	;BS                  PORT9,RightYAxis
   891            C        	;BS                  PORT9,RightXAxis
   892            C        	;BS                  PORT8,Reference    ; Set P87
   893            C        	;BS                  PORT8,Leakresis    ; Set P86
   894            C        
   895 01329 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   896            C        ;  if IOtoADC_T_DEBUG ==1
   897            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   898            C        ;	XOR                 PORT8,A
   899            C        ;  endif
   900 0132A 1E02 C        	BANK                2
   901            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   902            C        	;MOV                 T2PD,A
   903 0132B 0B49 C        	BS                  T2CR,T2EN          ; START
   904 0132C 00ED C        	CLR                 IOcheckTimeCNT
   905 0132D 1E00 C        	BANK                0
   906 0132E 0F88 C        	JBS                 PORT8,Leakresis
   907 0132F 172E C        	JMP                 $-1
   908            C        	;MOV                 A,@0B10000001
   909            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   910            C        ;  if IOtoADC_T_DEBUG ==1
   911            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   912            C        ;	XOR                 PORT8,A
   913            C        ;  endif
   914 01330 1E02 C        	BANK                2
   915 01331 0949 C        	BC                  T2CR,T2EN           ; Disable
   916 01332 042D C        	MOV                 A,IOcheckTimeCNT
   917 01333 0070 C        	MOV                 KEY_LEFT_X,A
   918 01334 1E00 C        	BANK                0
   919 01335 1881 C        	MOV                 A,@0B10000001
   920 01336 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   921 01337 0012 C        	RET
   922 01338 0000 C        	NOP
   923            C        
   924            C        ;---------------------------------------------------------------
   925 01339      C        SampingLyTiming:
   926 01339 1E04 C        	BANK                4
   927 0133A 18FE C        	MOV                 A,@0B11111110
   928 0133B 0049 C        	MOV                 P9IOCR,A            ; P97-P91:Input; P90:output
   929 0133C 0B88 C        	BS                  P8IOCR,Leakresis    ; input P86
   930 0133D 0BC8 C        	BS                  P8IOCR,Reference    ; input P87
   931            C        	;MOV                 A,P8IOCR
   932            C        	;AND                 A,@0B00111111
   933            C        	;OR                  A,@0B11000000
   934            C        	;MOV                 P8IOCR,A
   935 0133E 1E00 C        	BANK                0
   936 0133F 0A09 C        	BS                  PORT9,LeftYAxis     ; Set P90 HIGH
   937            C        	;BS                  PORT9,LeftXAxis
   938            C        	;BS                  PORT9,RightYAxis
   939            C        	;BS                  PORT9,RightXAxis
   940            C        	;BS                  PORT8,Reference    ; Set P87
   941            C        	;BS                  PORT8,Leakresis    ; Set P86
   942            C        
   943 01340 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   944            C        ;  if IOtoADC_T_DEBUG ==1
   945            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   946            C        ;	XOR                 PORT8,A
   947            C        ;  endif
   948 01341 1E02 C        	BANK                2
   949            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   950            C        	;MOV                 T2PD,A
   951 01342 0B49 C        	BS                  T2CR,T2EN          ; START
   952 01343 00ED C        	CLR                 IOcheckTimeCNT
   953 01344 1E00 C        	BANK                0
   954 01345 0F88 C        	JBS                 PORT8,Leakresis
   955 01346 1745 C        	JMP                 $-1
   956            C        	;MOV                 A,@0B10000001
   957            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   958            C        ;  if IOtoADC_T_DEBUG ==1
   959            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   960            C        ;	XOR                 PORT8,A
   961            C        ;  endif
   962 01347 1E02 C        	BANK                2
   963 01348 0949 C        	BC                  T2CR,T2EN           ; Disable
   964 01349 042D C        	MOV                 A,IOcheckTimeCNT
   965 0134A 0071 C        	MOV                 KEY_LEFT_Y,A
   966 0134B 1E00 C        	BANK                0
   967 0134C 1881 C        	MOV                 A,@0B10000001
   968 0134D 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
   969 0134E 0012 C        	RET
   970 0134F 0000 C        	NOP
   971            C        
   972            C        ;---------------------------------------------------------------
   973 01350      C        SampingRxTiming:
   974 01350 1E04 C        	BANK                4
   975 01351 18F7 C        	MOV                 A,@0B11110111
   976 01352 0049 C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93:output; P92-P90:Input
   977 01353 0B88 C        	BS                  P8IOCR,Leakresis    ; input
   978 01354 0BC8 C        	BS                  P8IOCR,Reference    ; input
   979            C        	;MOV                 A,P8IOCR
   980            C        	;AND                 A,@0B00111111
   981            C        	;OR                  A,@0B11000000
   982            C        	;MOV                 P8IOCR,A
   983 01355 1E00 C        	BANK                0
   984            C        	;BS                  PORT9,LeftYAxis
   985            C        	;BS                  PORT9,LeftXAxis
   986            C        	;BS                  PORT9,RightYAxis
   987 01356 0AC9 C        	BS                  PORT9,RightXAxis    ; Set P93 HIGH
   988            C        	;BS                  PORT8,Reference    ; Set P87
   989            C        	;BS                  PORT8,Leakresis    ; Set P86
   990            C        
   991 01357 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
   992            C        ;  if IOtoADC_T_DEBUG ==1
   993            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   994            C        ;	XOR                 PORT8,A
   995            C        ;  endif
   996 01358 1E02 C        	BANK                2
   997            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   998            C        	;MOV                 T2PD,A
   999 01359 0B49 C        	BS                  T2CR,T2EN          ; START
  1000 0135A 00ED C        	CLR                 IOcheckTimeCNT
  1001 0135B 1E00 C        	BANK                0
  1002 0135C 0F88 C        	JBS                 PORT8,Leakresis
  1003 0135D 175C C        	JMP                 $-1
  1004            C        	;MOV                 A,@0B10000001
  1005            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1006            C        ;  if IOtoADC_T_DEBUG ==1
  1007            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1008            C        ;	XOR                 PORT8,A
  1009            C        ;  endif
  1010 0135E 1E02 C        	BANK                2
  1011 0135F 0949 C        	BC                  T2CR,T2EN           ; Disable
  1012 01360 042D C        	MOV                 A,IOcheckTimeCNT
  1013 01361 0072 C        	MOV                 KEY_RIGHT_X,A
  1014 01362 1E00 C        	BANK                0
  1015 01363 1881 C        	MOV                 A,@0B10000001
  1016 01364 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1017 01365 0012 C        	RET
  1018 01366 0000 C        	NOP
  1019            C        
  1020            C        ;---------------------------------------------------------------
  1021 01367      C        SampingRyTiming:
  1022 01367 1E04 C        	BANK                4
  1023 01368 18FB C        	MOV                 A,@0B11111011
  1024 01369 0049 C        	MOV                 P9IOCR,A            ; P97-P93:Input; P92:output; P91-P90:Input
  1025 0136A 0B88 C        	BS                  P8IOCR,Leakresis    ; input
  1026 0136B 0BC8 C        	BS                  P8IOCR,Reference    ; input
  1027            C        	;MOV                 A,P8IOCR
  1028            C        	;AND                 A,@0B00111111
  1029            C        	;OR                  A,@0B11000000
  1030            C        	;MOV                 P8IOCR,A
  1031 0136C 1E00 C        	BANK                0
  1032            C        	;BS                  PORT9,LeftYAxis
  1033            C        	;BS                  PORT9,LeftXAxis
  1034 0136D 0A89 C        	BS                  PORT9,RightYAxis    ; Set P92 HIGH
  1035            C        	;BS                  PORT9,RightXAxis
  1036            C        	;BS                  PORT8,Reference    ; Set P87
  1037            C        	;BS                  PORT8,Leakresis    ; Set P86
  1038            C        
  1039 0136E 00CE C        	CLR                 IMR                ; Disable Timier1/TCC
  1040            C        ;  if IOtoADC_T_DEBUG ==1
  1041            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1042            C        ;	XOR                 PORT8,A
  1043            C        ;  endif
  1044 0136F 1E02 C        	BANK                2
  1045            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
  1046            C        	;MOV                 T2PD,A
  1047 01370 0B49 C        	BS                  T2CR,T2EN          ; START
  1048 01371 00ED C        	CLR                 IOcheckTimeCNT
  1049 01372 1E00 C        	BANK                0
  1050 01373 0F88 C        	JBS                 PORT8,Leakresis
  1051 01374 1773 C        	JMP                 $-1
  1052            C        	;MOV                 A,@0B10000001
  1053            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1054            C        ;  if IOtoADC_T_DEBUG ==1
  1055            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1056            C        ;	XOR                 PORT8,A
  1057            C        ;  endif
  1058 01375 1E02 C        	BANK                2
  1059 01376 0949 C        	BC                  T2CR,T2EN          ; START
  1060 01377 042D C        	MOV                 A,IOcheckTimeCNT
  1061 01378 0073 C        	MOV                 KEY_RIGHT_Y,A
  1062            C        	;COM                 KEY_RIGHT_Y
  1063 01379 1E00 C        	BANK                0
  1064 0137A 1881 C        	MOV                 A,@0B10000001
  1065 0137B 004E C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1066 0137C 0000 C        	NOP
  1067 0137D 0012 C        	RET
  1068 0137E 0000 C        	NOP
  1069            C        
  1070            C        ;=======================================================================
  1071            C        ; input:        ACC
  1072            C        ; output:       ACC
  1073            C        ; registor:     TEMP, TEMP1, TEMP2
  1074            C        ; descripition: Operate io data change to anylize data. Kr=0x80(2^7)
  1075            C        ;=======================================================================
  1076 0137F      C        Conversion_Data:
  1077 0137F 00D1 C        	CLR                 TEMP1
  1078 01380 00D2 C        	CLR                 TEMP2
  1079            C          if Kr == 5
  1080 01381 0052 C        	MOV                 TEMP2,A
  1081 01382 0803 C        	BC                  STATUS,C
  1082 01383 0652 C        	RRC                 TEMP2
  1083 01384 0651 C        	RRC                 TEMP1
  1084 01385 042A C        	MOV                 A,IOcheckRefValue
  1085 01386 0050 C        	MOV                 TEMP,A
  1086            C          elseif Kr == 10
  1087            C        	MOV                 TEMP2,A
  1088            C        	;BC                  STATUS,C
  1089            C        	;RRC                 TEMP2
  1090            C        	;RRC                 TEMP1
  1091            C        	MOV                 A,IOcheckRefValue
  1092            C        	MOV                 TEMP,A
  1093            C          endif
  1094            C        
  1095            C      M 	mDIV2_1             TEMP2,TEMP1,TEMP
       01387 1810     1     MOV A,@( 16 )
       01388 005B     1     MOV  REG_ACC ,A
       01389 0080     1     CLRA 
       0138A 0210     1     OR A, TEMP 
       0138B 0C83     1     JBC  STATUS , Z 
       0138C 179E     1     JMP  ??001D$_DIV_OUT ,
       0138D 00D0     1     CLR  TEMP ,
       0138E          1    ??001D$_DIV_SUB:   
       0138E 06D1     1     RLC  TEMP1 ,
       0138F 06D2     1     RLC  TEMP2 ,
       01390 06D0     1     RLC  TEMP ,
       01391 0A11     1     BS  TEMP1 , 0 
       01392 0E03     1     JBS  STATUS , C 
       01393 1796     1     JMP  ??001D$_DIV_S_0 ,
       01394 0150     1     SUB  TEMP ,A
       01395 179B     1     JMP  ??001D$_DIV_CNT ,
       01396          1    ??001D$_DIV_S_0:   
       01396 0150     1     SUB  TEMP ,A
       01397 0C03     1     JBC  STATUS , C 
       01398 179B     1     JMP  ??001D$_DIV_CNT ,
       01399 0811     1     BC  TEMP1 , 0 
       0139A 03D0     1     ADD  TEMP ,A
       0139B          1    ??001D$_DIV_CNT:   
       0139B 05DB     1     DJZ  REG_ACC ,
       0139C 178E     1     JMP  ??001D$_DIV_SUB ,
       0139D 1801     1     MOV A,@( 1 )
       0139E          1    ??001D$_DIV_OUT:   
  1096 0139E 0411 C        	MOV                 A,TEMP1
  1097 0139F 0000 C        	NOP
  1098 013A0 0012 C        	RET
  1099 013A1 0000 C        	NOP
  1100            C        
    17            C        
    18            C        ;-----------------------------------------------------------------------
    19            C        
    20            C        
    21            C        	ORG                 0x0400    ;PAGE 1
    22            C        	MESSAGE "define 'uartcomu.asm' ROM address"
***     USER MESSAGE: DEFINE 'UARTCOMU.ASM' ROM ADDRESS
    23 00400      C        Uart_Commucation:
    24 00400 0000 C        	NOP
    25 00401 1E02 C        	BANK                2
    26 00402 0F5E C        	JBS                 System8msFlag/16,System8msFlag%16
    27 00403 1411 C        	JMP                 Uart_Transmit
    28 00404 095E C        	BC                  System8msFlag/16,System8msFlag%16
    29 00405 056E C        	INC                 KeySystemTimeCNT
    30 00406 056C C        	INC                 ComSystemTimeCNT
    31 00407 042E C        	MOV                 A,KeySystemTimeCNT
    32 00408 1D00 C        	SUB                 A,@KeyScanTimeCtrl
    33 00409 0C03 C        	JBC                 STATUS,C
    34 0040A 1411 C        	JMP                 Uart_Transmit
    35 0040B 00EE C        	CLR                 KeySystemTimeCNT
    36 0040C 1EA0 C        	LCALL               Key_Scan
    36 0040D 10B0 C        	LCALL               Key_Scan
    37            C        
    38            C          if COM_T_DEBUG == 1
    39 0040E 1E00 C        	BANK                0
    40 0040F 1820 C        	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    41 00410 0348 C        	XOR                 PORT8,A
    42            C          endif
    43            C        
    44            C        ;----------------------------------------------------------------------
    45 00411      C          Uart_Transmit:
    46            C          if COM_DEBUG == 1
    47 00411 042C C        	MOV                 A,ComSystemTimeCNT
    48 00412 1D00 C        	SUB                 A,@UartTimeCtrl
    49 00413 0C03 C        	JBC                 STATUS,C
    50 00414 0012 C        	RET
    51 00415 00EC C        	CLR                 ComSystemTimeCNT
    52            C          endif
    53            C        
    54            C          if COM_T_DEBUG == 1
    55 00416 1E00 C        	BANK                0
    56 00417 1808 C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
    57 00418 0348 C        	XOR                 PORT8,A
    58            C          endif
    59            C        
    60 00419 18E0 C        	MOV                 A,@0XE0
    61 0041A 0044 C        	MOV                 R4,A
    62 0041B      C          Uart_Transmit_Loop:
    63 0041B 1E02 C        	BANK                2
    64 0041C 0400 C        	MOV                 A,R0
    65 0041D 1E03 C        	BANK                3
    66 0041E 0A05 C        	BS                  URC,TXE        ; Enable transmission
    67 0041F 0000 C        	NOP
    68 00420 0000 C        	NOP
    69 00421 0000 C        	NOP
    70 00422 0048 C        	MOV                 URTD,A
    71 00423 0000 C        	NOP
    72 00424 0544 C        	INC                 R4
    73 00425 0E45 C        	JBS                 URC,UTBE
    74 00426 1425 C        	JMP                 $-1
    75 00427 0404 C        	MOV                 A,R4
    76 00428 1BE7 C        	XOR                 A,@0XE7        ; Uart Data, bank2: 0X20-0X26
    77 00429 0E83 C        	JBS                 STATUS,Z
    78 0042A 141B C        	JMP                 Uart_Transmit_Loop
    79 0042B 0000 C        	NOP
    80            C        
    81 0042C 0012 C        	RET
    82            C        
    83            C        
    84            C        
    85            C        
    86            C        
    87            C        
    88            C        ;===============================================
    89            C        ; Function: Delay 20us
    90            C        ; Input:    None
    91            C        ; Output:   None
    92            C        ;===============================================
    93 0042D      C        DELAY_X10US:
    94 0042D 0051 C        	MOV                 TEMP1,A
    95 0042E      C          Delay_Loop_X10US:
    96 0042E 1808 C        	MOV                 A,@8      ;
    97 0042F 0052 C        	MOV                 TEMP2,A
    98 00430      C          Waiting_X10US:
    99 00430 05D2 C        	DJZ                 TEMP2
   100 00431 1430 C        	JMP                 Waiting_X10US
   101 00432 05D1 C        	DJZ                 TEMP1
   102 00433 142E C        	JMP                 Delay_Loop_X10US
   103 00434 0012 C        	RET
   104 00435 0000 C        	NOP
   105            C        
   106            C        ;===============================================
   107            C        ; Function: Delay 100us
   108            C        ; Input:    None
   109            C        ; Output:   None
   110            C        ;===============================================
   111 00436      C        DELAY_X100US:
   112 00436 0051 C        	MOV                 TEMP1,A
   113 00437      C          Delay_Loop:
   114 00437 1850 C        	MOV                 A,@0X50      ;
   115 00438 0052 C        	MOV                 TEMP2,A
   116 00439      C          Waiting:
   117 00439 0000 C        	NOP
   118 0043A 05D2 C        	DJZ                 TEMP2
   119 0043B 1439 C        	JMP                 Waiting
   120 0043C 05D1 C        	DJZ                 TEMP1
   121 0043D 1437 C        	JMP                 Delay_Loop
   122 0043E 0012 C        	RET
   123 0043F 0000 C        	NOP
    18                     
    19                     ;-----------------------------------------------------------------
    20                     
    21                     
    22                     
    23                     ;=================== MAIN PROGRAM =================================
    24                     	ORG                 0X00
    25 00000 1EB0          	LJMP                INITIAL
    25 00001 0178          	LJMP                INITIAL
***     Warning A053:The call/jmp address is not over page.
    26                     	ORG                 0X03
    27 00003 1EB0          	LJMP                TCC_INT
    27 00004 0100          	LJMP                TCC_INT
***     Warning A053:The call/jmp address is not over page.
    28                     	ORG                 0X06
    29 00006 1EB0          	LJMP                EXTERNAL_INT
    29 00007 0120          	LJMP                EXTERNAL_INT
***     Warning A053:The call/jmp address is not over page.
    30                     	ORG                 0X09
    31 00009 1EB0          	LJMP                WDT_INT
    31 0000A 013D          	LJMP                WDT_INT
***     Warning A053:The call/jmp address is not over page.
    32                     	ORG                 0X0C
    33 0000C 1EB0          	LJMP                TIMER1_INT
    33 0000D 013F          	LJMP                TIMER1_INT
***     Warning A053:The call/jmp address is not over page.
    34                     	ORG                 0X0F
    35 0000F 1EB0          	LJMP                TIMER2_INT
    35 00010 0162          	LJMP                TIMER2_INT
***     Warning A053:The call/jmp address is not over page.
    36                     	ORG                 0X12
    37 00012 1EB0          	LJMP                AD_INT
    37 00013 013E          	LJMP                AD_INT
***     Warning A053:The call/jmp address is not over page.
    38                     	ORG                 0X15
    39 00015 1EB0          	LJMP                UART_INT
    39 00016 0175          	LJMP                UART_INT
***     Warning A053:The call/jmp address is not over page.
    40                     	ORG                 0X18
    41 00018 1EB0          	LJMP                SPI_INT
    41 00019 0176          	LJMP                SPI_INT
***     Warning A053:The call/jmp address is not over page.
    42                     	ORG                 0X1B
    43 0001B 1EB0          	LJMP                LVD_INT
    43 0001C 0177          	LJMP                LVD_INT
***     Warning A053:The call/jmp address is not over page.
    44                     
    45                     
    46                     	ORG                 0X100
    47                     ;========================= TCC Interrupt Service ==================================
    48 00100               TCC_INT:
    49                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTCC_Temp,RSRTcc_TEMP
       00100 0054     1     MOV  A_TEMP ,A
       00101 0754     1     SWAP  A_TEMP ,
       00102 0703     1     SWAPA  3 ,
       00103 0056     1     MOV  STATUS_TEMP ,A
       00104 0705     1     SWAPA  5 ,
       00105 0055     1     MOV  RSR_TEMP ,A
       00106 00C3     1     CLR  3 ,
       00107 1E04     1     BANK @( 4 ),
       00108 0414     1     MOV A, A_TEMP 
       00109 0060     1     MOV  ATCC_TEMP ,A
       0010A 0416     1     MOV A, STATUS_TEMP 
       0010B 0062     1     MOV  STATUSTCC_TEMP ,A
       0010C 0415     1     MOV A, RSR_TEMP 
       0010D 0061     1     MOV  RSRTCC_TEMP ,A
    50 0010E 1E00          	BANK                0
    51 0010F 080F          	BC                  ISR,TCIF               ;clear TCC interrupt flag
    52                     	;MOV                 A,@0B00001101        ; N=4,P=64,f=32.768K ==> T=8ms
    53                     	;MOV                 TWTCR,A
    54 00110 18FC          	MOV                 A,@(256-4)           ; reload initial value
    55 00111 0041          	MOV                 TCC,A
    56 00112 0B5E          	BS                  System8msFlag/16,System8msFlag%16
    57                     	;BANK                0
    58                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    59                     	;XOR                 PORT8,A
    60                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,ATcc_Temp,StatusTcc_Temp,RSRTcc_TEMP
       00113 1E04     1     BANK @( 4 ),
       00114 0420     1     MOV A, ATCC_TEMP 
       00115 0054     1     MOV  A_TEMP ,A
       00116 0422     1     MOV A, STATUSTCC_TEMP 
       00117 0056     1     MOV  STATUS_TEMP ,A
       00118 0415     1     MOV A, RSR_TEMP 
       00119 0061     1     MOV  RSRTCC_TEMP ,A
       0011A 0716     1     SWAPA  STATUS_TEMP ,
       0011B 0043     1     MOV  3 ,A
       0011C 0715     1     SWAPA  RSR_TEMP ,
       0011D 0045     1     MOV  5 ,A
       0011E 0714     1     SWAPA  A_TEMP ,
    61 0011F 0013          	RETI
    62                     
    63 00120               EXTERNAL_INT:
    64                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,STATUSExt_Temp,RSRExt_Temp
       00120 0054     1     MOV  A_TEMP ,A
       00121 0754     1     SWAP  A_TEMP ,
       00122 0703     1     SWAPA  3 ,
       00123 0056     1     MOV  STATUS_TEMP ,A
       00124 0705     1     SWAPA  5 ,
       00125 0055     1     MOV  RSR_TEMP ,A
       00126 00C3     1     CLR  3 ,
       00127 1E04     1     BANK @( 4 ),
       00128 0414     1     MOV A, A_TEMP 
       00129 0063     1     MOV  AEXT_TEMP ,A
       0012A 0416     1     MOV A, STATUS_TEMP 
       0012B 0065     1     MOV  STATUSEXT_TEMP ,A
       0012C 0415     1     MOV A, RSR_TEMP 
       0012D 0064     1     MOV  RSREXT_TEMP ,A
    65 0012E 1E01          	BANK                1
    66 0012F 00CF          	CLR                 EISR               ;clear the external interrupt flag
    67                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,AExt_Temp,StatusExt_Temp,RSRExt_Temp
       00130 1E04     1     BANK @( 4 ),
       00131 0423     1     MOV A, AEXT_TEMP 
       00132 0054     1     MOV  A_TEMP ,A
       00133 0425     1     MOV A, STATUSEXT_TEMP 
       00134 0056     1     MOV  STATUS_TEMP ,A
       00135 0415     1     MOV A, RSR_TEMP 
       00136 0064     1     MOV  RSREXT_TEMP ,A
       00137 0716     1     SWAPA  STATUS_TEMP ,
       00138 0043     1     MOV  3 ,A
       00139 0715     1     SWAPA  RSR_TEMP ,
       0013A 0045     1     MOV  5 ,A
       0013B 0714     1     SWAPA  A_TEMP ,
    68 0013C 0013          	RETI
    69                     
    70 0013D               WDT_INT:
    71 0013D 0013          	RETI
    72                     
    73 0013E               AD_INT:
    74 0013E 0013          	RETI
    75                     
    76 0013F               TIMER1_INT:
    77                   M 	PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,Status1_Temp,RSR1_Temp
       0013F 0054     1     MOV  A_TEMP ,A
       00140 0754     1     SWAP  A_TEMP ,
       00141 0703     1     SWAPA  3 ,
       00142 0056     1     MOV  STATUS_TEMP ,A
       00143 0705     1     SWAPA  5 ,
       00144 0055     1     MOV  RSR_TEMP ,A
       00145 00C3     1     CLR  3 ,
       00146 1E04     1     BANK @( 4 ),
       00147 0414     1     MOV A, A_TEMP 
       00148 0066     1     MOV  A1_TEMP ,A
       00149 0416     1     MOV A, STATUS_TEMP 
       0014A 0068     1     MOV  STATUS1_TEMP ,A
       0014B 0415     1     MOV A, RSR_TEMP 
       0014C 0067     1     MOV  RSR1_TEMP ,A
    78 0014D 1E00          	BANK                0
    79 0014E 09CF          	BC                  ISR,T1IF               ; clear Timer1 interrupt flag
    80 0014F 1820          	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    81 00150 0348          	XOR                 PORT8,A
    82 00151 1E02          	BANK                2
    83 00152 18FF          	MOV                 A,@255                ; N=256, Auto reload
    84 00153 0047          	MOV                 T1PD,A
    85 00154 055C          	INC                 SleepCNT               ; 2s  at a time
    86                     
    87 00155                 TIMER1_INT_END:
    88                   M 	POP A_Temp,STATUS_Temp,RSR_Temp,@4,A1_Temp,STATUS1_Temp,RSR1_Temp
       00155 1E04     1     BANK @( 4 ),
       00156 0426     1     MOV A, A1_TEMP 
       00157 0054     1     MOV  A_TEMP ,A
       00158 0428     1     MOV A, STATUS1_TEMP 
       00159 0056     1     MOV  STATUS_TEMP ,A
       0015A 0415     1     MOV A, RSR_TEMP 
       0015B 0067     1     MOV  RSR1_TEMP ,A
       0015C 0716     1     SWAPA  STATUS_TEMP ,
       0015D 0043     1     MOV  3 ,A
       0015E 0715     1     SWAPA  RSR_TEMP ,
       0015F 0045     1     MOV  5 ,A
       00160 0714     1     SWAPA  A_TEMP ,
    89 00161 0013          	RETI
    90                     
    91 00162               TIMER2_INT:
    92                     	;PUSH A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
    93                   M 	PUSH
       00162 0054     1     MOV  A_TEMP ,A
       00163 0754     1     SWAP  A_TEMP ,
       00164 0703     1     SWAPA  3 ,
       00165 0056     1     MOV  STATUS_TEMP ,A
       00166 0705     1     SWAPA  5 ,
       00167 0055     1     MOV  RSR_TEMP ,A
       00168 00C3     1     CLR  3 ,
    94 00169 1E02          	BANK                2
    95 0016A 09C9          	BC                  T2CR,T2IF              ; clear Timer2 interrupt flag
    96 0016B 056D          	INC                 IOcheckTimeCNT
    97 0016C 1E00          	BANK                0
    98 0016D 1820          	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    99 0016E 0348          	XOR                 PORT8,A
   100                     	;POP A_Temp,STATUS_Temp,RSR_Temp,@4,A2_Temp,STATUS2_Temp,RSR2_Temp
   101                   M 	POP
       0016F 0716     1     SWAPA  STATUS_TEMP ,
       00170 0043     1     MOV  3 ,A
       00171 0715     1     SWAPA  RSR_TEMP ,
       00172 0045     1     MOV  5 ,A
       00173 0714     1     SWAPA  A_TEMP ,
   102 00174 0013          	RETI
   103 00175               UART_INT:
   104 00175 0013          	RETI
   105 00176               SPI_INT:
   106 00176 0013          	RETI
   107 00177               LVD_INT:
   108 00177 0013          	RETI
   109                     
   110                     
   111                     ;=======================================================================
   112                     ;============================ Begin Program ============================
   113 00178               INITIAL:
   114 00178 0000          	NOP
   115 00179 0000          	NOP
   116 0017A 0000          	NOP
   117 0017B 0000          	NOP
   118 0017C 0000          	NOP
   119 0017D 0000          	NOP
   120 0017E 0000          	NOP
   121 0017F 0000          	NOP
   122 00180 0000          	NOP
   123 00181 0011          	DISI
   124 00182 0000          	NOP
   125 00183 0000          	NOP
   126 00184 0000          	NOP
   127 00185 0011          	DISI
   128 00186 0000          	NOP
   129 00187 0000          	NOP
   130 00188 0000          	NOP
   131 00189 0011          	DISI
   132 0018A 0000          	NOP
   133 0018B 0004          	WDTC
   134                   M 	ClrCommRamBank
       0018C 1810     1     MOV A,@( 16 )
       0018D 0044     1     MOV  R4 ,A
       0018E 0004     1     WDTC 
       0018F 00C0     1     CLR  R0 ,
       00190 0544     1     INC  R4 ,
       00191 183F     1     MOV A,@( 63 )
       00192 0284     1     AND A, R4 
       00193 1D1F     1     SUB A,@( 31 )
       00194 0C03     1     JBC  R3 , C 
       00195 158E     1     JMP ( $ - 7 ),
       00196 00C4     1     CLR  R4 ,
   135 00197 0000          	NOP
   136                   M 	ClrRamBank
       00198 18E0     1     MOV A,@( 224 )
       00199 0044     1     MOV  R4 ,A
       0019A 00C5     1     CLR  BSR ,
       0019B 0004     1     WDTC 
       0019C 00C0     1     CLR  R0 ,
       0019D 0544     1     INC  R4 ,
       0019E 0404     1     MOV A, R4 
       0019F 1A3F     1     AND A,@( 63 )
       001A0 0E83     1     JBS  R3 , Z 
       001A1 159C     1     JMP ( $ - 5 ),
       001A2 0545     1     INC  BSR ,
       001A3 0405     1     MOV A, BSR 
       001A4 1A07     1     AND A,@( 7 )
       001A5 0B44     1     BS  R4 , 5 
       001A6 0B84     1     BS  R4 , 6 
       001A7 0E83     1     JBS  R3 , 2 
       001A8 159B     1     JMP ( $ - 13 ),
       001A9 00C4     1     CLR  R4 ,
       001AA 00C5     1     CLR  BSR ,
       001AB 0B84     1     BS  R4 , 6 
   137 001AC 0000          	NOP
   138 001AD 0000          	NOP
   139 001AE 11E7          	CALL                IO_INITIAL
   140 001AF 0000          	NOP
   141 001B0 0010          	ENI
   142 001B1 0000          	NOP
   143                     
   144 001B2 1E00          	BANK                0
   145 001B3 0A48          	BS                  LED1_STATUS/16,LED1_STATUS%16		     ; PORT81,LED
   146 001B4 00DC          	CLR                 SleepCNT
   147 001B5 00DF          	CLR                 CommuStatusFlag
   148 001B6 00DD          	CLR                 GeneralStatusFlag1
   149 001B7 00DE          	CLR                 GeneralStatusFlag2
   150                     
   151 001B8 1E02          	BANK                2
   152 001B9 00EE          	CLR                 KeySystemTimeCNT
   153 001BA 18FF          	MOV                 A,@0XFF
   154 001BB 0076          	MOV                 KeystokeFlag_Befor,A
   155 001BC 0077          	MOV                 KeystokeTimeCNT,A
   156 001BD 0000          	NOP
   157                     
   158                     ;=============================================================================
   159 001BE               MAIN:
   160                     
   161                     ;---------------------------------------------------------------
   162 001BE               Key_Status_Judge:
   163 001BE 1E02          	BANK                2
   164 001BF 0420          	MOV                 A,DataA
   165 001C0 0321          	XOR                 A,DataB
   166 001C1 0322          	XOR                 A,DataC
   167 001C2 0323          	XOR                 A,DataD
   168 001C3 0324          	XOR                 A,DataE
   169 001C4 0325          	XOR                 A,DataF
   170 001C5 0326          	XOR                 A,DataG
   171 001C6 0050          	MOV                 TEMP,A
   172 001C7 032B          	XOR                 A,KeyCheckBakup
   173 001C8 0E83          	JBS                 STATUS,Z
   174 001C9 15CF          	JMP                 Sleep_Status_Judge_End1
   175                     
   176 001CA 041C          	MOV                 A,SleepCNT
   177 001CB 1DFA          	SUB                 A,@SetSleepTime        ;
   178 001CC 0C03          	JBC                 STATUS,C
   179 001CD 15D0          	JMP                 Sleep_Status_Judge_End2
   180 001CE 0A5D          	BS                  IntoSleepFlag/16,IntoSleepFlag%16
   181                     
   182 001CF                 Sleep_Status_Judge_End1:
   183 001CF 00DC          	CLR                 SleepCNT
   184 001D0                 Sleep_Status_Judge_End2:
   185 001D0 0410          	MOV                 A,TEMP
   186 001D1 006B          	MOV                 KeyCheckBakup,A
   187                     
   188                     ;-----------------------------------------------------------------
   189 001D2 0E5D          	JBS                 IntoSleepFlag/16,IntoSleepFlag%16
   190 001D3 15E0          	JMP                 Sleep_Status_Judge_End
   191 001D4 0000          	NOP
   192 001D5               Sleep_Status_Judeg:
   193 001D5 0011          	DISI
   194 001D6 1243          	CALL                MCU_EnterSleep_Set
   195 001D7 1E00          	BANK                0
   196 001D8 0848          	BC                  LED1_STATUS/16,LED1_STATUS%16
   197 001D9 0010          	ENI
   198 001DA 0000          	NOP
   199 001DB 0003          	SLEP                                                 ; enter Sleep mode
   200 001DC 0000          	NOP
   201 001DD 1286          	CALL                MCU_WakeUp_Set
   202 001DE 11E7          	CALL                IO_INITIAL
   203 001DF 0000          	NOP
   204 001E0                 Sleep_Status_Judge_End:
   205 001E0 085D          	BC                  IntoSleepFlag/16,IntoSleepFlag%16
   206                     ;-----------------------------------------------------------------
   207 001E1 1EA0          	LCALL               Uart_Commucation
   207 001E2 0400          	LCALL               Uart_Commucation
   208                     
   209                     
   210                     ;-------------------- test ----------------------
   211                     	;BANK                0
   212                     	;MOV                 A,@0B00000000
   213                     	;MOV                 IMR,A             ; Disable Timier1/TCC
   214                     	;BANK                2
   215                     	;BS                  T2CR,T2EN          ; START
   216                     
   217                     	;LCALL               IO_Rocker_KeyScan
   218                     ;-----------------------------------------------------
   219                     
   220 001E3 0000          	NOP
   221 001E4 0000          	NOP
   222 001E5 0000          	NOP
   223 001E6 15BE          	JMP                 MAIN
   224                     
   225                     
   226                     ;*****************************************************************
   227                     ;Function:    IO INITIAL SET
   228                     ;Input:       None
   229                     ;Output:      None
   230                     ;*****************************************************************
   231 001E7               IO_INITIAL:
   232                     ;============================ TCC config ====================================
   233 001E7 1E00          	BANK                0
   234 001E8 180D          	MOV                 A,@0B00001101        ; N=4,P=64,f=32.768K ==> T=8ms
   235 001E9 004D          	MOV                 TWTCR,A
   236 001EA 18FC          	MOV                 A,@(256-4)    ; load initial value
   237 001EB 0041          	MOV                 TCC,A
   238 001EC 0A0E          	BS                  IMR,TCIE        ; set   TCIE=1  tcc enable interrupt
   239 001ED 00CF          	CLR                 ISR             ; clear interrupt flag
   240 001EE 1E01          	BANK                1
   241 001EF 00CF          	CLR                 EISR            ; Clear External Interrupt Status Register
   242 001F0 00CE          	CLR                 EIMR            ; Clear External Interrupt Mask  Register
   243                     
   244                     ;============================ Timer 1 config ===================================
   245 001F1 1E00          	BANK                0
   246 001F2 0BCE          	BS                  IMR,T1IE         ; Enable Timier1
   247 001F3 09CF          	BC                  ISR,T1IF         ; Clear timer1 intrrupt flag
   248 001F4 1E02          	BANK                2
   249 001F5 1807          	MOV                 A,@0B00000111    ; N=255, P=128, T=1s
   250 001F6 0045          	MOV                 T1CR,A
   251 001F7 18FF          	MOV                 A,@255           ; N=255, Auto reload
   252 001F8 0047          	MOV                 T1PD,A
   253 001F9 1814          	MOV                 A,@0B00010100    ; 8 bit counter, f=32.768KHz
   254 001FA 0046          	MOV                 TSR,A
   255 001FB 0A85          	BS                  T1CR,T1EN
   256                     
   257                     ;============================ Timer 2 config ===================================
   258 001FC 1E00          	BANK                0
   259 001FD 0B89          	BS                  T2CR,T2IE        ; Enable Timier2
   260 001FE 09C9          	BC                  T2CR,T2IF        ; Clear timer1 intrrupt flag
   261 001FF 1E02          	BANK                2
   262 00200 1843          	MOV                 A,@0B01000011    ; N=2, P=16, T=4us
   263 00201 0249          	OR                  T2CR,A
   264 00202 1803          	MOV                 A,@IOCheckRate   ; N=, Auto reload
   265 00203 004A          	MOV                 T2PD,A
   266 00204 08C6          	BC                  TSR,T2CSS       ; Set Timer2 Clock Source f=8MHz
   267 00205 09C6          	BC                  TSR,T1MOD       ; Set 8 Bit Timer
   268 00206 0949          	BC                  T2CR,T2EN       ; Disable
   269                     
   270                     ;==========================PORT 7/8/9 INITIAL===============================
   271 00207 1E06          	BANK                6
   272 00208 00C7          	CLR                 P7ODCR          ;Disable Open Drain
   273 00209 00C8          	CLR                 P8ODCR
   274 0020A 00C9          	CLR                 P9ODCR
   275 0020B 1E04          	BANK                4
   276 0020C 18FF          	MOV                 A,@0B11111111
   277 0020D 0047          	MOV                 IOC7,A          ;Set Input
   278 0020E 18FF          	MOV                 A,@0B11111111
   279 0020F 0048          	MOV                 IOC8,A          ;Set Input
   280 00210 18FF          	MOV                 A,@0B11111111
   281 00211 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Input
   282 00212 1E05          	BANK                5
   283 00213 1800          	MOV                 A,@0B00000000
   284 00214 0047          	MOV                 P7PHCR,A		;Disable PULL UP
   285 00215 1800          	MOV                 A,@0B00000000
   286 00216 0048          	MOV                 P8PHCR,A		;Disable PULL UP
   287 00217 18F0          	MOV                 A,@0B11110000
   288 00218 0049          	MOV                 P9PHCR,A		;SET PULL UP
   289 00219 1E04          	BANK                4
   290 0021A 1800          	MOV                 A,@0B00000000
   291 0021B 0047          	MOV                 IOC7,A          ;Set Output
   292 0021C 1800          	MOV                 A,@0B00000000
   293 0021D 0048          	MOV                 IOC8,A          ;Set Output
   294 0021E 18F0          	MOV                 A,@0B11110000
   295 0021F 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Output
   296                     
   297 00220 1E01          	BANK                1
   298 00221 1800          	MOV                 A,@0B00000000	;Disable LCD common dirver pin
   299 00222 004A          	MOV                 LCDSCR0,A
   300 00223 004B          	MOV                 LCDSCR1,A
   301 00224 004C          	MOV                 LCDSCR2,A
   302 00225 1E00          	BANK                0
   303 00226 00C7          	CLR                 PORT7           ; Port7 output logic "0"
   304 00227 00C8          	CLR                 PORT8           ; Port8 output logic "0"
   305 00228 00C9          	CLR                 PORT9
   306                     
   307                     ;==============================PORT A/B======================================
   308 00229 1E04          	BANK                4               ;
   309 0022A 18FF          	MOV                 A,@0B11111111   ; PA As Input
   310 0022B 004A          	MOV                 PAIOCR,A        ;
   311 0022C 18FF          	MOV                 A,@0B11111111   ; PB As Input
   312 0022D 004B          	MOV                 PBIOCR,A       	;
   313                     
   314 0022E 1800          	MOV                 A,@00000000B    ; PA As output
   315 0022F 004A          	MOV                 PAIOCR,A        ;
   316 00230 180F          	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 As Input
   317 00231 004B          	MOV                 PBIOCR,A       	;
   318 00232 1E05          	BANK                5
   319 00233 1800          	MOV                 A,@00000000B    ; Disable PA Pull High
   320 00234 004A          	MOV                 PAPHCR,A        ;
   321 00235 180F          	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 Enable Pull High
   322 00236 004B          	MOV                 PBPHCR,A        ;
   323 00237 1E00          	BANK                0
   324 00238 00CA          	CLR                 PORTA           ; PortA output logic "0"
   325 00239 00CB          	CLR                 PORTB           ; PortB output logic "0"
   326                     ;------------------------------------------------------------------
   327 0023A 1E03          	BANK                3
   328 0023B 1820          	MOV                 A,@0B00100000   ; 8-Bit Mode,Fc=8MHz,Baud=38400
   329 0023C 0045          	MOV                 URC,A           ; Disable TXE
   330 0023D 1800          	MOV                 A,@0B00000000
   331 0023E 0046          	MOV                 URS,A           ; disable parity, Odd parity
   332 0023F 1E05          	BANK                5
   333 00240 1820          	MOV                 A,@0B00100000   ; Enable uart function
   334 00241 0046          	MOV                 UARC2,A
   335 00242 0012          	RET
   336                     
   337                     
   338                     ;*****************************************************************
   339                     ;Function:    MCU SLEEP SET
   340                     ;Input:       None
   341                     ;Output:      None
   342                     ;*****************************************************************
   343 00243               MCU_EnterSleep_Set:
   344                     ;========================== Set Timers ==================================
   345 00243 1E00          	BANK                0
   346 00244 00CE          	CLR                 IMR             ; Disable Timier1/TCC
   347 00245 00C9          	CLR                 T2CR            ; Disable Timeer2
   348 00246 00CF          	CLR                 ISR
   349 00247 0004          	WDTC
   350 00248 09CD          	BC                  TWTCR,WDTE      ; Disable WDT function
   351 00249 1877          	MOV                 A,@0B01110111   ;
   352 0024A 024D          	OR                  TWTCR,A         ; Set Max Prescale
   353                     
   354                     ;======================== Set Port 7/8/9 ===============================
   355 0024B 1E06          	BANK                6
   356 0024C 00C7          	CLR                 P7ODCR          ;Disable Open Drain
   357 0024D 00C8          	CLR                 P8ODCR
   358 0024E 00C9          	CLR                 P9ODCR
   359 0024F 1E04          	BANK                4
   360 00250 18FF          	MOV                 A,@0B11111111
   361 00251 0047          	MOV                 IOC7,A          ;Set Input
   362 00252 180F          	MOV                 A,@0B00001111
   363 00253 0048          	MOV                 IOC8,A          ;Set Input
   364 00254 18FF          	MOV                 A,@0B11111111
   365 00255 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Input
   366 00256 1E05          	BANK                5
   367 00257 18F0          	MOV                 A,@0B11110000
   368 00258 0047          	MOV                 P7PHCR,A		;Disable P77/P76/P75/P74 pull high
   369 00259 1800          	MOV                 A,@0B00000000
   370 0025A 0048          	MOV                 P8PHCR,A		;Disable P8 pull high
   371 0025B 1800          	MOV                 A,@0B00000000
   372 0025C 0049          	MOV                 P9PHCR,A		;Disable P9 pull high
   373 0025D 1E04          	BANK                4
   374 0025E 18F0          	MOV                 A,@0B11110000
   375 0025F 0047          	MOV                 IOC7,A          ;Set P77/P76/P75/P74 Output
   376 00260 1800          	MOV                 A,@0B00000000
   377 00261 0048          	MOV                 IOC8,A          ;Set Output
   378 00262 1800          	MOV                 A,@0B00000000
   379 00263 0049          	MOV                 IOC9,A          ;P97-P94:Ouput; P93-P90:Ouput
   380 00264 1E00          	BANK                0
   381 00265 00C7          	CLR                 PORT7
   382 00266 00C8          	CLR                 PORT8
   383 00267 00C9          	CLR                 PORT9
   384                     
   385                     ;======================== Set Port A/B===================================
   386 00268 1E04          	BANK                4               ;
   387 00269 18FF          	MOV                 A,@0B11111111   ; PA As Input
   388 0026A 004A          	MOV                 PAIOCR,A        ;
   389 0026B 18FF          	MOV                 A,@0B11111111   ; PB As Input
   390 0026C 004B          	MOV                 PBIOCR,A       	;
   391                     
   392 0026D 1800          	MOV                 A,@0B00000000   ; PA As output
   393 0026E 004A          	MOV                 PAIOCR,A        ;
   394 0026F 180F          	MOV                 A,@0B00001111   ; PB0 PB1 PB2 PB3 As Input
   395 00270 004B          	MOV                 PBIOCR,A       	;
   396 00271 1E05          	BANK                5
   397 00272 1800          	MOV                 A,@0B00000000   ; Disable PA Pull High
   398 00273 004A          	MOV                 PAPHCR,A        ;
   399 00274 180F          	MOV                 A,@0B00001111   ; PB0 PB1 PB2 PB3 Enable Pull High
   400 00275 004B          	MOV                 PBPHCR,A
   401 00276 1E00          	BANK                0
   402 00277 00CA          	CLR                 PORTA           ; PortA output logic "0"
   403 00278 00CB          	CLR                 PORTB           ; PortB output logic "0"
   404                     
   405                     
   406                     ;======================== set Sleep Mode ==============================
   407 00279 1E03          	BANK                3
   408 0027A 0989          	BC                  ADCR,ADP          ; Disable ADC
   409 0027B 00CE          	CLR                 EIESH             ; Set Falling Edge
   410 0027C 1E01          	BANK                1
   411 0027D 18FF          	MOV                 A,@0B11111111     ; Enable EX7(PB3)/EX6(PB2)/EX5(PB1)/EX4(PB0) Interrupt
   412 0027E 004E          	MOV                 EIMR,A            ; Enable EX3(P77)/EX2(P76)/EX1(P75)/EX0(P74) Interrupt
   413 0027F 00CF          	CLR                 EISR
   414 00280 1E04          	BANK                4
   415 00281 18FF          	MOV                 A,@0B11111111
   416 00282 004F          	MOV                 WKCR,A            ; Enable EX7/EX6/EX5/EX4/EX3/EX2/EX1/EX0 wake up
   417 00283 08CC          	BC                  SCCR,IDLE         ; Set IDLE=0(SLEEP MODE)
   418 00284 0000          	NOP
   419 00285 0012          	RET
   420                     
   421                     ;*****************************************************************
   422                     ;Function:    MCU wakeup SET
   423                     ;Input:       None
   424                     ;Output:      None
   425                     ;*****************************************************************
   426 00286               MCU_WakeUp_Set:
   427 00286 1E03          	BANK                3
   428 00287 00CE          	CLR                 EIESH             ; SET Falling Edge
   429 00288 1E01          	BANK                1
   430 00289 1800          	MOV                 A,@0B00000000     ; Disable EX7(PB3)/EX6(PB2)/EX5(PB1)/EX4(PB0) Interrupt
   431 0028A 004E          	MOV                 EIMR,A            ; Disable EX3(P77)/EX2(P76)/EX1(P75)/EX0(P74) Interrupt
   432 0028B 00CF          	CLR                 EISR
   433 0028C 1E04          	BANK                4
   434 0028D 1800          	MOV                 A,@0B00000000
   435 0028E 004F          	MOV                 WKCR,A            ; Disable EX6(PB2)/EX5(PB1) wake up
   436 0028F 0000          	NOP
   437 00290 0012          	RET
   438                     
   439                     
   440                     
   441                     
   442                     
  0 Error(s), 10 Warning(s), 2 User Message(s)