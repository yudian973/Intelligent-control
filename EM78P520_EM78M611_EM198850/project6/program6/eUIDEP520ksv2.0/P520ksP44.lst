     1                     /*****************************************************************
     2                     * Filename     :  P520KSP44.ASM
     3                     * Author       :  yu.wei
     4                     * Company      :  ELAN
     5                     * VERSION      :  1.1
     6                     *              :  v1.2 modify for totuch roker 2010-5-12 15:38:51
     7                     * CRYSTAL      :  8MHZ
     8                     * Creat date   :  2009/11/4
     9                     * tool ver.    :  WicePlus 2.7/eUIDE v1.01.01
    10                     * Description  :  modify for code conformity
    11                     *****************************************************************/
    12                     ;-----------------------------------------------------------------
    13                     include "D:\include\EM78xx\inc\EM78P520.H"
     1            C        ;******************************************************;
     2            C        ;                                                      ;
     3            C        ;  Tilte:       EM78x510xx include file                ;
     4            C        ;  Description: The Definition of EM78x510xx Registers ;
     5            C        ;  Company:     Elan Electronic Corp.                  ;
     6            C        ;  Author:      hongxi.tang                            ;
     7            C        ;  Date:        24/05/2006                             ;
     8            C        ;  Version:     v1.0                                   ;
     9            C        ;                                                      ;
    10            C        ;******************************************************;
    11            C        ;
    12            C        ;======================================================;
    13            C        ; Operational Registers Define                         ;
    14            C        ;======================================================;
    15            C        EM78P510.H    EQU    EM78P510.H
    16            C        EM78P520.H    EQU    EM78P520.H
    17            C        
    18            C        ;
    19            C        ;======================================================;
    20            C        ; Register R0~R4                                       ;
    21            C        ;======================================================;
    22            C        ;
    23            C        ; Indirect Addressing register
    24            C        ;
    25       0000 C         R0     ==    0x00
    26       0000 C         IAR    ==    0x00
    27            C        ;
    28            C        ; Time Clock/Counter
    29            C        ;
    30       0001 C         R1     ==    0x01
    31       0001 C         TCC    ==    0x01    ; TCC Counter Preset
    32            C        ;
    33            C        ; Program Counter
    34            C        ;
    35       0002 C         R2     ==    0X02
    36       0002 C         PC     ==    0X02
    37            C        ;
    38            C        ; Status Register and Voltage Detect
    39            C        ;
    40       0003 C         R3    ==    0X03
    41       0003 C         SR    ==    0X03
    42       0003 C         STATUS	==	0x03
    43            C        ;
    44            C             ;{
    45       0007 C             	 LVDEN	==    0x07    ; Voltage Detect Enable Bit
    46       0006 C                 LVDS1	==    0x06    ; Detect Voltage Select Bit[1]
    47       0005 C                 LVDS0	==    0x05    ; Detect Voltage Select Bit[0]
    48            C                                       ;
    49            C                                       ; |-------|-------|----------------|
    50            C                                       ; | LVDS1 | LVDS0 | Detect Voltage |
    51            C                                       ; |-------|-------|----------------|
    52            C                                       ; |   0   |   0   |      2.4V      |
    53            C                                       ; |   0   |   1   |      2.7V      |
    54            C                                       ; |   1   |   0   |      3.3V      |
    55            C                                       ; |   1   |   1   |      3.9V      |
    56            C                                       ; |-------|-------|----------------|
    57            C                                       ;
    58       0004 C                 T       ==    0x04    ; Time-Out Bit
    59       0003 C                 P       ==    0x03    ; Power Down Bit
    60       0002 C                 Z       ==    0x02    ; Zero Flag
    61       0001 C                 DC      ==    0x01    ; Auxiliary Carry Flag
    62       0000 C                 C       ==    0x00    ; Carry Flag
    63            C                                       ;
    64            C             ;}
    65            C        ;
    66            C        ; RAM Select Register (RSR)
    67            C        ;
    68       0004 C         R4     ==    0X04
    69       0004 C         RSR    ==    0X04
    70            C             ;{
    71            C                                        ; Bits 5~0 are used to select up to 64 registers in the
    72            C                                        ; indirect addressing mode.
    73            C                                        ;
    74       0007 C                 VDB	  ==    0x07    ; Voltage Detector
    75       0006 C                 BNC      ==    0x06    ; Bank Control Register
    76            C                                        ;
    77       0005 C                 RSR5     ==    0x05    ;
    78       0004 C                 RSR4     ==    0x04    ;
    79       0003 C                 RSR3     ==    0x03    ;
    80       0002 C                 RSR2     ==    0x02    ;
    81       0001 C                 RSR1     ==    0x01    ;
    82       0000 C                 RSR0     ==    0x00    ;
    83            C                                        ;
    84            C             ;}
    85            C        ;======================================================;
    86            C        ; Bank0~6 Register R5~RF                               ;
    87            C        ;======================================================;
    88            C        ;
    89            C        ; Bank0 R5(RAM Bank Select Register)
    90            C        ;
    91       0005 C         B0_R5    ==	0X05
    92       0005 C         BSR      ==    0X05
    93            C        ;
    94            C             ;{
    95            C             				    ; Bit3~7 is "0"
    96       0002 C                 BS2          ==    0x02    ; RAM Bank Select Register Bits[2]
    97       0001 C                 BS1          ==    0x01    ; RAM Bank Select Register Bits[1]
    98       0000 C                 BS0          ==    0x00    ; RAM Bank Select Register Bits[0]
    99            C             ;}
   100            C        ;
   101            C        ; Bank 0 R6(Program Page Select Register)
   102            C        ;
   103       0006 C         B0_R6    ==    0X06
   104       0006 C         PSR      ==    0X06
   105            C        ;
   106            C             ;{
   107            C             			       ; Bit3~7 is "0"
   108       0002 C                 PS2     ==    0x02    ; Program Page Select Register Bits[2]
   109       0001 C                 PS1     ==    0x01    ; Program Page Select Register Bits[1]
   110       0000 C                 PS0     ==    0x00    ; Program Page Select Register Bits[0]
   111            C             ;}
   112            C        ;
   113            C        ; Bank0 R7(Port 7 data Register)
   114            C        ;
   115       0007 C         B0_R7    ==    0X07
   116       0007 C         PORT7    ==    0X07
   117            C        ;
   118            C             ;{
   119       0007 C                 R77     ==    0x07    ; I/O data of P7.7
   120       0006 C                 R76     ==    0x06    ; I/O data of P7.6
   121       0005 C                 R75     ==    0x05    ; I/O data of P7.5
   122       0004 C                 R74     ==    0x04    ; I/O data of P7.4
   123       0003 C                 R73     ==    0x03    ; I/O data of P7.3
   124       0002 C                 R72     ==    0x02    ; I/O data of P7.2
   125       0001 C                 R71     ==    0x01    ; I/O data of P7.1
   126       0000 C                 R70     ==    0x00    ; I/O data of P7.0
   127            C             ;}
   128            C        ;
   129            C        ; Bank0 R8(Port 8 data Register)
   130            C        ;
   131       0008 C         B0_R8    ==    0X08
   132       0008 C         PORT8    ==    0X08
   133            C        ;
   134            C             ;{
   135       0007 C                 R87     ==    0x07    ; I/O data of P8.7
   136       0006 C                 R86     ==    0x06    ; I/O data of P8.6
   137       0005 C                 R85     ==    0x05    ; I/O data of P8.5
   138       0004 C                 R84     ==    0x04    ; I/O data of P8.4
   139       0003 C                 R83     ==    0x03    ; I/O data of P8.3
   140       0002 C                 R82     ==    0x02    ; I/O data of P8.2
   141       0001 C                 R81     ==    0x01    ; I/O data of P8.1
   142       0000 C                 R80     ==    0x00    ; I/O data of P8.0
   143            C             ;}
   144            C        ;
   145            C        ; Bank0 R9(PORT 9 Data Register)
   146            C        ;
   147       0009 C         B0_R9    ==    0X09
   148       0009 C         PORT9    ==    0X09
   149            C        ;
   150            C             ;{
   151       0007 C                 R97     ==    0x07    ; I/O data of P9.7
   152       0006 C                 R96     ==    0x06    ; I/O data of P9.6
   153       0005 C                 R95     ==    0x05    ; I/O data of P9.5
   154       0004 C                 R94     ==    0x04    ; I/O data of P9.4
   155       0003 C                 R93     ==    0x03    ; I/O data of P9.3
   156       0002 C                 R92     ==    0x02    ; I/O data of P9.2
   157       0001 C                 R91     ==    0x01    ; I/O data of P9.1
   158       0000 C                 R90     ==    0X00    ; I/O data of P9.0
   159            C             ;}
   160            C        ;
   161            C        ;  Bank0 RA(PORTA Data Register)
   162            C        ;
   163       000A C         B0_RA	  ==	0X0A
   164       000A C         PORTA	  ==	0X0A
   165            C        ;
   166            C        	;{
   167       0007 C        		RA7	==	0X07	; I/O Data of PA.7
   168       0006 C        		RA6	==	0X06 	; I/O Data of PA.6
   169       0005 C        		RA5	==	0X05	; I/O Data of PA.5
   170       0004 C        		RA4	==	0X04	; I/O Data of PA.4
   171       0003 C        		RA3	==	0X03	; I/O Data of PA.3
   172       0002 C        		RA2	==	0X02	; I/O Data of PA.2
   173       0001 C        		RA1	==	0X01	; I/O Data of PA.1
   174       0000 C        		RA0	==	0X00	; I/O Data of PA.0
   175            C        	;}
   176            C        ;
   177            C        ;  Bank0 RB(PORT8 Data Register)
   178            C        ;
   179       000B C         B0_RB	==	0X0B
   180       000B C         PORTB	==	0X0B
   181            C        ;
   182            C        	;{
   183       0007 C        		RB7	==	0X07	; I/O Data of PB.7
   184       0006 C        		RB6	==	0X06 	; I/O Data of PB.6
   185       0005 C        		RB5	==	0X05	; I/O Data of PB.5
   186       0004 C        		RB4	==	0X04	; I/O Data of PB.4
   187       0003 C        		RB3	==	0X03	; I/O Data of PB.3
   188       0002 C        		RB2	==	0X02	; I/O Data of PB.2
   189       0001 C        		RB1	==	0X01	; I/O Data of PB.1
   190       0000 C        		RB0	==	0X00	; I/O Data of PB.0
   191            C        	;}
   192            C        ;
   193            C        ;  Bank0 RC(System Clock Control Register)
   194            C        ;
   195       000C C         B0_RC	==	0X0C
   196       000C C         SCCR	==	0X0C
   197            C        ;
   198            C        	;{
   199            C        				 ; Bit7 is "0"
   200       0006 C        		CLK2	==  0X06 ;
   201       0005 C        		CLK1	==  0X05 ;
   202       0004 C        		CLK0	==  0X04 ; Main Clock Select Bit for PLL Mode
   203            C        				 ; |------|------|------|------------|---------------|
   204            C        				 ; | CLK2 | CLK1 | CLK0 | Main Clock | Ex:Fs=32.768k |
   205            C        				 ; |------|------|------|------------|---------------|
   206            C        				 ; |  0   |  0   |  0   |   Fs*122   |   3.997 MHz   |
   207            C        				 ; |------|------|------|------------|---------------|
   208            C        				 ; |  0   |  0   |  1   |    Fs*61   |   1.998 MHz   |
   209            C        				 ; |------|------|------|------------|---------------|
   210            C        				 ; |  0   |  1   |  0   |   Fs*61/2  |   0.999 MHz   |
   211            C        				 ; |------|------|------|------------|---------------|
   212            C        				 ; |  0   |  1   |  1   |   Fs*61/4  |   499.7 kHz   |
   213            C        				 ; |------|------|------|------------|---------------|
   214            C        				 ; |  1   |  0   |  0   |   Fs*244   |   7.995 MHz   |
   215            C        				 ; |------|------|------|------------|---------------|
   216            C        				 ; |  1   |  0   |  1   |   Fs*366   |   11.99 MHz   |
   217            C        				 ; |------|------|------|------------|---------------|
   218            C        				 ; |  1   |  1   |  X   |   Fs*488   |   15.99 MHz   |
   219            C        				 ; |------|------|------|------------|---------------|
   220       0003 C        		IDLE	==  0X03 ; Idle Mode Enable Bit.
   221            C        		 		 ; IDLE="0"+SLEP instruction=>sleep mode
   222            C        		 		 ; IDLE="1"+SLEP instruction=>idle mode
   223       0002 C        		BF1	==  0x02 ;
   224       0001 C        		BF0	==  0x01 ; LCD Booster Frequency Select Bit.
   225            C        				 ; |-----|-----|-------------------|
   226            C        				 ; | BF1 | BF0 | Booster frequency |
   227            C        				 ; |-----|-----|-------------------|
   228            C        				 ; |  0  |  0  |        Fs         |
   229            C        				 ; |-----|-----|-------------------|
   230            C        				 ; |  0  |  1  |       Fs/4        |
   231            C        				 ; |-----|-----|-------------------|
   232            C        				 ; |  1  |  0  |       Fs/8        |
   233            C        				 ; |-----|-----|-------------------|
   234            C        				 ; |  1  |  1  |       Fs/16       |
   235            C        				 ; |-----|-----|-------------------|
   236       0000 C        		CPUS	==  0x00 ; CPU Oscillator Source Select.
   237            C        				 ; 0/1=>sub-oscillator(fs)/main oscillator(fm)
   238            C        	;}
   239            C        ;
   240            C        ; Bank0 RD(TCC and WDT Timer control register)
   241            C        ;
   242       000D C         B0_RD	==	0X0D
   243       000D C         TWTCR	==	0X0D
   244            C        ;
   245            C        	;{
   246       0007 C        		WDTE	==  0X07 ; Watchdog Timer Enable.0/1=>disable/enable
   247       0006 C        		WPSR2	==  0X06
   248       0005 C        		WPSR1	==  0X05
   249       0004 C        		WPSR0	==  0X04 ; WDT Prescaler Bits
   250            C        				 ; |-----|-----|-----|-----------|
   251            C        				 ; |WPSR2|WPSR1|WPSR0| Prescaler |
   252            C        				 ; |-----|-----|-----|-----------|
   253            C        				 ; |  0  |  0  |  0  |    1:1    |
   254            C        				 ; |-----|-----|-----|-----------|
   255            C        				 ; |  0  |  0  |  1  |    1:2    |
   256            C        				 ; |-----|-----|-----|-----------|
   257            C        				 ; |  0  |  1  |  0  |    1:4    |
   258            C        				 ; |-----|-----|-----|-----------|
   259            C        				 ; |  0  |  1  |  1  |    1:8    |
   260            C        				 ; |-----|-----|-----|-----------|
   261            C        				 ; |  1  |  0  |  0  |   1:16    |
   262            C        				 ; |-----|-----|-----|-----------|
   263            C        				 ; |  1  |  0  |  1  |   1:32    |
   264            C        				 ; |-----|-----|-----|-----------|
   265            C        				 ; |  1  |  1  |  0  |   1:64    |
   266            C        				 ; |-----|-----|-----|-----------|
   267            C        				 ; |  1  |  1  |  1  |   1:128   |
   268            C        				 ; |-----|-----|-----|-----------|
   269       0003 C        		TCCS	==  0x03 ; TCC Clock Source Select Bit.0/1=>Fm/Fs
   270       0002 C        		TPSR2	==  0x02
   271       0001 C        		TPSR1	==  0X01
   272       0000 C        		TPSR0	==  0X00 ; TCC Prescaler Bits
   273            C        				 ; |-----|-----|-----|-----------|
   274            C        				 ; |TPSR2|TPSR1|TPSR0| Prescaler |
   275            C        				 ; |-----|-----|-----|-----------|
   276            C        				 ; |  0  |  0  |  0  |    1:2    |
   277            C        				 ; |-----|-----|-----|-----------|
   278            C        				 ; |  0  |  0  |  1  |    1:4    |
   279            C        				 ; |-----|-----|-----|-----------|
   280            C        				 ; |  0  |  1  |  0  |    1:8    |
   281            C        				 ; |-----|-----|-----|-----------|
   282            C        				 ; |  0  |  1  |  1  |   1:16    |
   283            C        				 ; |-----|-----|-----|-----------|
   284            C        				 ; |  1  |  0  |  0  |   1:32    |
   285            C        				 ; |-----|-----|-----|-----------|
   286            C        				 ; |  1  |  0  |  1  |   1:64    |
   287            C        				 ; |-----|-----|-----|-----------|
   288            C        				 ; |  1  |  1  |  0  |   1:128   |
   289            C        				 ; |-----|-----|-----|-----------|
   290            C        				 ; |  1  |  1  |  1  |   1:256   |
   291            C        				 ; |-----|-----|-----|-----------|
   292            C        	;}
   293            C        ;
   294            C        ; Bank0 RE (Interrupt Mask Register)
   295            C        ;
   296       000E C         B0_RE	==	0X0E
   297       000E C         RE	==	0X0E							;ADD
   298       000E C         IMR	==	0X0E
   299            C        ;
   300            C        	;{
   301       0007 C        		T1IE	==  0X07 ; Timer1 Interrupt Enable Bit
   302       0006 C        		LVDIE   ==  0X06 ; low Voltage Detect Interrupt Enable Bit
   303       0005 C        		ADIE	==  0X05 ; A/D convert Interrupt Enable Bit
   304       0004 C        		SPIE    ==  0X04 ; SPI transfer Interrupt Enable Bit
   305       0003 C        		URTIE	==  0X03 ; UART transmit Interrupt Enable Bit
   306       0002 C        		EXIE9	==  0X02 ; External interrupt 9 Enable Bit
   307       0001 C        		EXIE8	==  0X01 ; External interrupt 8 Enable Bit
   308       0000 C        		TCIE	==  0X00 ; TCC Overflow Interrupt Enable Bit
   309            C        	;}
   310            C        ;
   311            C        ;  Bank0 RF (Interrupt Status Register)
   312            C        ;
   313       000F C         B0_RF	==	0X0F
   314       000F C         RF     ==  0x0F
   315       000F C         ISR	==	0X0F
   316            C        ;
   317            C        	;{
   318       0007 C        		T1IF	==  0X07 ; interrupt flag of timer1 interrupt
   319       0006 C        		LVDIF	==  0X06 ; interrupt flag of low voltage detector interrupt
   320       0005 C        		ADIF	==  0X05 ; interrupt flag of A/D convert Complete
   321       0004 C        		SPIF	==  0X04 ; interrupt flag of SPI transfer complete
   322       0003 C        		URTIF	==  0X03 ; interrupt flag of UART transfer complete
   323       0002 C        		EXIF9	==  0X02 ; interrupt flag of external interrupt 9 Occur.
   324       0001 C        		EXIF8	==  0X01 ; interrupt flag of external interrupt 8 Occur.
   325       0000 C        		TCIF	==  0X00 ; interrupt flag of TCC Overflow
   326            C        	;}
   327            C        ;
   328            C        ;  Bank1 R5 (LCD Control Register)
   329            C        ;
   330       0005 C         B1_R5	==	0X05
   331       0005 C         LCDCR	==	0X05
   332            C        ;
   333            C        	;{
   334       0007 C        		LCDEN	==  0X07 ; lCD Enable Select Bit.0/1=>disable/enable
   335       0006 C        		LCDTYPE	==  0X06 ; LCD Drive Waveform Type Select Bit
   336       0005 C        		LBS1	==  0x05
   337       0004 C        		LBS0	==  0x04 ; LCD Bias Select Bits
   338            C        				 ; |---|---|---------------|
   339            C        				 ; |BS1|BS0|LCD Bias Select|
   340            C        				 ; |---|---|---------------|
   341            C        				 ; | 0 | 0 |   1/2 Bias    |
   342            C        				 ; |---|---|---------------|
   343            C        				 ; | 0 | 1 |   1/3 Bias    |
   344            C        				 ; |---|---|---------------|
   345            C        				 ; | 1 | X |   1/4 Bias    |
   346            C        				 ; |---|---|---------------|
   347       0003 C        		DS1	==  0x03
   348       0002 C        		DS0	==  0x02 ; LCD Duty Select Bits
   349            C        				 ; |---|---|---------------|
   350            C        				 ; |DS1|DS0|LCD Duty Select|
   351            C        				 ; |---|---|---------------|
   352            C        				 ; | 0 | 0 |    Static     |
   353            C        				 ; |---|---|---------------|
   354            C        				 ; | 0 | 1 |   1/3 Duty    |
   355            C        				 ; |---|---|---------------|
   356            C        				 ; | 1 | 0 |   1/4 Duty    |
   357            C        				 ; |---|---|---------------|
   358            C        				 ; | 1 | 1 |   1/8 Duty    |
   359            C        				 ; |---|---|---------------|
   360       0001 C        		LCDF1	==  0x01 ;
   361       0000 C        		LCDF0	==  0x00 ; LCD Frame Frequency Control Bits
   362            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   363            C        				 ; |LCDF1|LCDF0|     Static    |    1/3 Duty   |    1/4 Duty   |   1/8 Duty   |
   364            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   365            C        				 ; |  0  |  0  |Fs/(512*1)=64.0|Fs/(172*3)=63.5|Fs/(128*4)=64.0|Fs/(64*8)=64.0|
   366            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   367            C        				 ; |  0  |  1  |Fs/(560*1)=58.5|Fs/(188*3)=58.0|Fs/(140*4)=58.5|Fs/(70*8)=58.5|
   368            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   369            C        				 ; |  1  |  0  |Fs/(608*1)=53.9|Fs/(204*3)=53.5|Fs/(152*4)=53.9|Fs/(76*8)=53.9|
   370            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   371            C        				 ; |  1  |  1  |Fs/(464*1)=70.6|Fs/(156*3)=70.0|Fs/(116*4)=70.6|Fs/(58*8)=70.6|
   372            C        				 ; |-----|-----|---------------|---------------|---------------|--------------|
   373            C        	;}
   374            C        ;
   375            C        ;  Bank1 R6 (LCD Address Register)
   376            C        ;
   377       0006 C         B1_R6	==    0X06
   378       0006 C         LCDAR	==    0X06
   379            C        ;
   380            C        	;{
   381            C        				 ; Bit5~7 is "0"
   382       0004 C        		LCD_A4	==  0x04 ; LCD RAM Address:00H~16H
   383       0003 C        		LCD_A3	==  0x03
   384       0002 C        		LCD_A2  ==  0x02
   385       0001 C        		LCD_A1	==  0x01
   386       0000 C        		LCD_A0	==  0x00
   387            C        	;}
   388            C        ;
   389            C        ; Bank1 R7 (LCD Data Buffer)
   390            C        ;
   391       0007 C         B1_R7	==    0X07
   392       0007 C         LCDBR	==    0X07
   393            C        ;
   394            C        	;{
   395       0007 C        		LCD_D7	==  0x07
   396       0006 C        		LCD_D6	==  0x06
   397       0005 C        		LCD_D5	==  0x05
   398       0004 C        		LCD_D4	==  0x04
   399       0003 C        		LCD_D3	==  0x03
   400       0002 C        		LCD_D2	==  0x02
   401       0001 C        		LCD_D1	==  0x01
   402       0000 C        		LCD_D0	==  0x00
   403            C        	;}
   404            C        ;
   405            C        ;  Bank1 R8 (LCD Voltage Control Register)
   406            C        ;
   407       0008 C         B1_R8	==	0x08
   408       0008 C         LCDVCR	==	0x08
   409            C        ;
   410            C        	;{
   411            C        				 ; Bit5~6 is "0"
   412       0004 C        		LCDC1	==  0x04
   413       0003 C        		LCDC0	==  0x03 ; LCD Clock
   414            C        				 ; |-----|-----|------|--------|
   415            C        				 ; |LCDC1|LCDC0|  Fm  |  Flcd  |
   416            C        				 ; |-----|-----|------|--------|
   417            C        				 ; |  0  |  0  | 16M  | Fc/2^9 |
   418            C        				 ; |-----|-----|------|--------|
   419            C        				 ; |  0  |  1  |  8M  | Fc/2^8 |
   420            C        				 ; |-----|-----|------|--------|
   421            C        				 ; |  1  |  0  |  4M  | Fc/2^7 |
   422            C        				 ; |-----|-----|------|--------|
   423            C        				 ; |  1  |  1  |  2M  | Fc/2^6 |
   424            C        				 ; |-----|-----|------|--------|
   425       0002 C        		LCDVC2	==  0x02
   426       0001 C        		LCDVC1	==  0x01
   427       0000 C        		LCDVC0	==  0x00 ; LCD Voltage Control Bits
   428            C        				 ; |------|------|------|--------------|
   429            C        				 ; |LCDVC2|LCDVC1|LCDVC0|    Output    |
   430            C        				 ; |------|------|------|--------------|
   431            C        				 ; |   0  |   0  |   0  |  0.4VDD~VDD  |
   432            C        				 ; |------|------|------|--------------|
   433            C        				 ; |   0  |   0  |   1  | 0.34VDD~VDD  |
   434            C        				 ; |------|------|------|--------------|
   435            C        				 ; |   0  |   1  |   0  | 0.26VDD~VDD  |
   436            C        				 ; |------|------|------|--------------|
   437            C        				 ; |   0  |   1  |   1  | 0.18VDD~VDD  |
   438            C        				 ; |------|------|------|--------------|
   439            C        				 ; |   1  |   0  |   0  | 0.13VDD~VDD  |
   440            C        				 ; |------|------|------|--------------|
   441            C        				 ; |   1  |   0  |   1  | 0.07VDD~VDD  |
   442            C        				 ; |------|------|------|--------------|
   443            C        				 ; |   1  |   1  |   0  | 0.04VDD~VDD  |
   444            C        				 ; |------|------|------|--------------|
   445            C        				 ; |   1  |   1  |   1  |    0V~VDD    |
   446            C        				 ; |------|------|------|--------------|
   447            C        	;}
   448            C        ;
   449            C        ;  Bank1 R9 (LCD Com Control Register)
   450            C        ;
   451       0009 C         B1_R9	==	0x09
   452       0009 C         LCDCCR	==	0x09
   453            C        ;
   454            C        	;{
   455       0007 C        		COM7	==  0x07 ; 0:I/O Function,1:LCD common driver pin.
   456       0006 C        		COM6	==  0x06
   457       0005 C        		COM5	==  0x05
   458       0004 C        		COM4	==  0x04
   459       0003 C        		COM3	==  0x03
   460       0002 C        		COM2	==  0x02
   461       0001 C        		COM1	==  0x01
   462       0000 C        		COM0	==  0x00
   463            C        	;}
   464            C        ;
   465            C        ;  Bank1 RA (LCD Segment Control Register0)
   466            C        ;
   467       000A C         B1_RA		==	0X0A
   468       000A C         LCDSCR0	==	0X0A
   469            C        ;
   470            C        	;{
   471       0007 C        		SEG7	==  0X07 ; LCD Segment7 Control Bit.0:I/O,1:LCD Driver pin.
   472       0006 C        		SEG6	==  0X06 ; LCD Segment6 Control Bit.0:I/O,1:LCD Driver pin.
   473       0005 C        		SEG5	==  0X05 ; LCD Segment5 Control Bit.0:I/O,1:LCD Driver pin.
   474       0004 C        		SEG4	==  0X04 ; LCD Segment4 Control Bit.0:I/O,1:LCD Driver pin.
   475       0003 C        		SEG3	==  0X03 ; LCD Segment3 Control Bit.0:I/O,1:LCD Driver pin.
   476       0002 C        		SEG2	==  0X02 ; LCD Segment2 Control Bit.0:I/O,1:LCD Driver pin.
   477       0001 C        		SEG1	==  0X01 ; LCD Segment1 Control Bit.0:I/O,1:LCD Driver pin.
   478       0000 C        		SEG0	==  0X00 ; LCD Segment0 Control Bit.0:I/O,1:LCD Driver pin.
   479            C        	;}
   480            C        ;
   481            C        ;  Bank1 RB (LCD Segment Control Register1)
   482            C        ;
   483       000B C         B1_RB		==	0X0B
   484       000B C         LCDSCR1	==	0X0B
   485            C        ;
   486            C        	;{
   487       0007 C        		SEG15	==  0X07 ; LCD Segment15 Control Bit.0:I/O,1:LCD Driver pin.
   488       0006 C        		SEG14	==  0X06 ; LCD Segment14 Control Bit.0:I/O,1:LCD Driver pin.
   489       0005 C        		SEG13	==  0X05 ; LCD Segment13 Control Bit.0:I/O,1:LCD Driver pin.
   490       0004 C        		SEG12	==  0X04 ; LCD Segment12 Control Bit.0:I/O,1:LCD Driver pin.
   491       0003 C        		SEG11	==  0X03 ; LCD Segment11 Control Bit.0:I/O,1:LCD Driver pin.
   492       0002 C        		SEG10	==  0X02 ; LCD Segment10 Control Bit.0:I/O,1:LCD Driver pin.
   493       0001 C        		SEG9	==  0X01 ; LCD Segment9 Control Bit.0:I/O,1:LCD Driver pin.
   494       0000 C        		SEG8	==  0X00 ; LCD Segment8 Control Bit.0:I/O,1:LCD Driver pin.
   495            C        	;}
   496            C        ;
   497            C        ;  Bank1 RC (LCD Segment Control Register2)
   498            C        ;
   499       000C C         B1_RC		==	0X0C
   500       000C C         LCDSCR2	==	0X0C
   501            C        ;
   502            C        	;{
   503            C        				 ; Bit7 not used
   504       0006 C        		SEG22	==  0X06 ; LCD Segment22 Control Bit.0:I/O,1:LCD Driver pin.
   505       0005 C        		SEG21	==  0X05 ; LCD Segment21 Control Bit.0:I/O,1:LCD Driver pin.
   506       0004 C        		SEG20	==  0X04 ; LCD Segment20 Control Bit.0:I/O,1:LCD Driver pin.
   507       0003 C        		SEG19	==  0X03 ; LCD Segment19 Control Bit.0:I/O,1:LCD Driver pin.
   508       0002 C        		SEG18	==  0X02 ; LCD Segment18 Control Bit.0:I/O,1:LCD Driver pin.
   509       0001 C        		SEG17	==  0X01 ; LCD Segment17 Control Bit.0:I/O,1:LCD Driver pin.
   510       0000 C        		SEG16	==  0X00 ; LCD Segment16 Control Bit.0:I/O,1:LCD Driver pin.
   511            C        	;}
   512            C        ;
   513            C        ;  Bank1 RE (External Interrupt Mask Register)
   514            C        ;
   515       000E C         B1_RE	==	0X0E
   516       000E C         EIMR	==	0X0E
   517            C        ;
   518            C        	;{
   519       0007 C        		EXIE7	==  0x07 ; /INT7 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   520       0006 C        		EXIE6	==  0x06 ; /INT6 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   521       0005 C        		EXIE5	==  0x05 ; /INT5 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   522       0004 C        		EXIE4	==  0x04 ; /INT4 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   523       0003 C        		EXIE3	==  0x03 ; /INT3 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   524       0002 C        		EXIE2	==  0x02 ; /INT2 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   525       0001 C        		EXIE1	==  0x01 ; /INT1 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   526       0000 C        		EXIE0	==  0x00 ; /INT0 Interrupt Enable Control Bit.0/1=>Disalbe/Enable.
   527            C        	;}
   528            C        ;
   529            C        ;  Bank1 RF (External Interrupt Status Register)
   530            C        ;
   531       000F C         B1_RF	==	0X0F
   532       000F C         EISR	==	0X0F
   533            C        ;
   534            C        	;{
   535       0007 C        		EXIF7	==  0x07 ; /INT7 Interrupt Flag Bit.
   536       0006 C        		EXIF6	==  0x06 ; /INT6 Interrupt Flag Bit.
   537       0005 C        		EXIF5	==  0x05 ; /INT5 Interrupt Flag Bit.
   538       0004 C        		EXIF4	==  0x04 ; /INT4 Interrupt Flag Bit.
   539       0003 C        		EXIF3	==  0x03 ; /INT3 Interrupt Flag Bit.
   540       0002 C        		EXIF2	==  0x02 ; /INT2 Interrupt Flag Bit.
   541       0001 C        		EXIF1	==  0x01 ; /INT1 Interrupt Flag Bit.
   542       0000 C        		EXIF0	==  0x00 ; /INT0 Interrupt Flag Bit.
   543            C        	;}
   544            C        ;
   545            C        ;  Bank2 R5 (Timer1 Control Register)
   546            C        ;
   547       0005 C         B2_R5	==	0X05
   548       0005 C         T1CR	==	0X05
   549            C        ;
   550            C        	;{
   551       0007 C        		T1S1	==  0x07
   552       0006 C        		T1S0	==  0x06 ; Timer1 and Timer2 Interrupt Type Select Bits.
   553            C        				 ; |----|----|---------------------------------------|
   554            C        				 ; |T1S1|T1S0|Timer1 and Timer2 Interrupt Type Select|
   555            C        				 ; |----|----|---------------------------------------|
   556            C        				 ; |  0 |  0 |           T1PD underflow              |
   557            C        				 ; |----|----|---------------------------------------|
   558            C        				 ; |  0 |  1 |           T1TD underflow              |
   559            C        				 ; |----|----|---------------------------------------|
   560            C        				 ; |  1 |  X |      T1PD and T1TD underflow          |
   561            C        				 ; |----|----|---------------------------------------|
   562       0005 C        		T1MS2	==  0x05
   563       0004 C        		T1MS1	==  0x04
   564       0003 C        		T1MS0	==  0x03 ; Timer1 Operation Mode Select Bits
   565            C        				 ; |-----|-----|-----|-------------------------|
   566            C        				 ; |T1MS2|T1MS1|T1MS0|   Timer1 Mode Select    |
   567            C        				 ; |-----|-----|-----|-------------------------|
   568            C        				 ; |  0  |  0  |  0  |         Timer1          |
   569            C        				 ; |-----|-----|-----|-------------------------|
   570            C        				 ; |  0  |  0  |  1  |        T1OUT Mode       |
   571            C        				 ; |-----|-----|-----|-------------------------|
   572            C        				 ; |  0  |  1  |  0  |Capture Mode Rising Edge |
   573            C        				 ; |-----|-----|-----|-------------------------|
   574            C        				 ; |  0  |  1  |  1  |Capture Mode Falling Edge|
   575            C        				 ; |-----|-----|-----|-------------------------|
   576            C        				 ; |  1  |  0  |  0  |UART Baud Rate Generator |
   577            C        				 ; |-----|-----|-----|-------------------------|
   578            C        				 ; |  1  |  0  |  1  |                         |
   579            C        				 ; |-----|-----|-----|                         |
   580            C        				 ; |  1  |  1  |  0  |          PWM1           |
   581            C        				 ; |-----|-----|-----|                         |
   582            C        				 ; |  1  |  1  |  1  |                         |
   583            C        				 ; |-----|-----|-----|-------------------------|
   584       0002 C        		T1P2	==  0x02
   585       0001 C        		T1P1	==  0x01
   586       0000 C        		T1P0	==  0x00 ; Timer1 Prescaler Bits
   587            C        				 ; |-----|-----|-----|-----------------|
   588            C        				 ; | T1P2| T1P1| T1P0|   Prescalaer    |
   589            C        				 ; |-----|-----|-----|-----------------|
   590            C        				 ; |  0  |  0  |  0  |      1:2        |
   591            C        				 ; |-----|-----|-----|-----------------|
   592            C        				 ; |  0  |  0  |  1  |      1:4        |
   593            C        				 ; |-----|-----|-----|-----------------|
   594            C        				 ; |  0  |  1  |  0  |	    1:8        |
   595            C        				 ; |-----|-----|-----|-----------------|
   596            C        				 ; |  0  |  1  |  1  |      1:16       |
   597            C        				 ; |-----|-----|-----|-----------------|
   598            C        				 ; |  1  |  0  |  0  |      1:32       |
   599            C        				 ; |-----|-----|-----|-----------------|
   600            C        				 ; |  1  |  0  |  1  |      1:64       |
   601            C        				 ; |-----|-----|-----|-----------------|                         |
   602            C        				 ; |  1  |  1  |  0  |      1:128      |
   603            C        				 ; |-----|-----|-----|-----------------|
   604            C        				 ; |  1  |  1  |  1  |      1:256      |
   605            C        				 ; |-----|-----|-----|-----------------|
   606            C        	;}
   607            C        ;
   608            C        ;  Bank2 R6 (Timer Status Register)
   609            C        ;
   610       0006 C         B2_R6	==	0X06
   611       0006 C         TSR	==	0X06
   612            C        ;
   613            C        	;{
   614       0007 C        		T1MOD	==  0X07 ; Timer Operates Mode Select Bit.
   615       0006 C        		TRCB	==  0x06 ; Timer1,2 Read Control Bit.
   616       0005 C        		T1CSS1	==  0x05 ;
   617       0004 C        		T1CSS0	==  0x04 ; Timer1 Clock Source Select Bits
   618            C        				 ; |------|------|--------------------------|
   619            C        				 ; |T1CSS1|T1CSS0|Timer1 Clock Source select|
   620            C        				 ; |------|------|--------------------------|
   621            C        				 ; |  0   |  0   |            Fm            |
   622            C        				 ; |------|------|--------------------------|
   623            C        				 ; |  0   |  1   |            Fs            |
   624            C        				 ; |------|------|--------------------------|
   625            C        				 ; |  1   |  X   |           T1CK           |
   626            C        				 ; |------|------|--------------------------|
   627       0003 C        		T2CSS	==  0x03 ; Timer2 Clock Source Select Bit.0/1=>Fm/Fs.
   628       0002 C        		T1EN	==  0x02 ; Timer1 Start Bit.
   629       0001 C        		T1OMS	==  0x01 ; Timer1 Output Mode Select Bit.0/1=>repeating/on-shot.
   630       0000 C        		T1OC	==  0x00 ; Timer1 Output Flip-Flop Control Bit.
   631            C        	;}
   632            C        ;
   633            C        ;  Bank2 R7 (Timer1 Period Buffer)
   634            C        ;
   635       0007 C         B2_R7	==	0X07
   636       0007 C         T1PD	==	0X07
   637            C        ;
   638            C        ;  Bank2 R8 (Timer1 Duty Buffer)
   639            C        ;
   640       0008 C         B2_R8	==	0X08
   641       0008 C         T1TD	==	0X08
   642            C        ;
   643            C        ;  Bank2 R9 (Timer2 Control Register)
   644            C        ;
   645       0009 C         B2_R9	==	0X09
   646       0009 C         T2CR	==	0X09
   647            C        ;
   648            C        	;{
   649       0007 C        		T2IF	==  0X07 ; Interrupt Flag of Timer2 Interrupt
   650       0006 C        		T2IE	==  0X06 ; Timer2 Interrupt Mask Bit
   651       0005 C        		T2EN	==  0X05 ; Timer2 Start Bit
   652       0005 C        		T2S     ==  0x05 ;
   653       0004 C        		T2MS1	==  0X04 ;
   654       0003 C        		T2MS0	==  0X03 ; Timer2 Operation Mode Select Bits.
   655            C        				 ; |-----|-----|-----------------------|
   656            C        				 ; |T2MS1|T2MS0|   Timer2 Mode Select  |
   657            C        				 ; |-----|-----|-----------------------|
   658            C        				 ; |  0  |  0  |        Timer2         |
   659            C        				 ; |-----|-----|-----------------------|
   660            C        				 ; |  0  |  1  |SPI Baud Rate Generator|
   661            C        				 ; |-----|-----|-----------------------|
   662            C        				 ; |  1  |  0  |                       |
   663            C        				 ; |-----|-----|         PWM2          |
   664            C        				 ; |  1  |  0  |                       |
   665            C        				 ; |-----|-----|-----------------------|
   666       0002 C        		T2P2	==  0x02
   667       0001 C        		T2P1	==  0x01
   668       0000 C        		T2P0	==  0x00 ; Timer2 Prescaler Bits
   669            C        				 ; |-----|-----|-----|-----------------|
   670            C        				 ; | T2P2| T2P1| T2P0|   Prescalaer    |
   671            C        				 ; |-----|-----|-----|-----------------|
   672            C        				 ; |  0  |  0  |  0  |      1:2        |
   673            C        				 ; |-----|-----|-----|-----------------|
   674            C        				 ; |  0  |  0  |  1  |      1:4        |
   675            C        				 ; |-----|-----|-----|-----------------|
   676            C        				 ; |  0  |  1  |  0  |	    1:8        |
   677            C        				 ; |-----|-----|-----|-----------------|
   678            C        				 ; |  0  |  1  |  1  |      1:16       |
   679            C        				 ; |-----|-----|-----|-----------------|
   680            C        				 ; |  1  |  0  |  0  |      1:32       |
   681            C        				 ; |-----|-----|-----|-----------------|
   682            C        				 ; |  1  |  0  |  1  |      1:64       |
   683            C        				 ; |-----|-----|-----|-----------------|                         |
   684            C        				 ; |  1  |  1  |  0  |      1:128      |
   685            C        				 ; |-----|-----|-----|-----------------|
   686            C        				 ; |  1  |  1  |  1  |      1:256      |
   687            C        				 ; |-----|-----|-----|-----------------|
   688            C        	;}
   689            C        ;
   690            C        ;  Bank2 RA (Timer2 Period Buffer)
   691            C        ;
   692       000A C         B2_RA	==	0X0A
   693       000A C         T2PD	==	0X0A
   694            C        ;
   695            C        ; Bank2 RB (Timer Duty Buffer)
   696            C        ;
   697       000B C         B2_RB	==	0X0B
   698       000B C         T2TD	==	0X0B
   699            C        ;
   700            C        ;  Bank2 RC (SPI Status Register)
   701            C        ;
   702       000C C         B2_RC	==	0X0C
   703       000C C         SPIS	==	0X0C
   704            C        ;
   705            C        	;{
   706       0007 C        		DORD	==  0X07 ; Data Shift Control Bit.0/1=>left/right
   707       0006 C        		TD1	==  0X06 ;
   708       0005 C        		TD0	==  0X05 ; SDO Status Output Delay Times Options
   709            C        				 ; |---|---|----------|
   710            C        				 ; |TD1|TD0|Delay Time|
   711            C        				 ; |---|---|----------|
   712            C        				 ; | 0 | 0 |   8 CLK  |
   713            C        				 ; |---|---|----------|
   714            C        				 ; | 0 | 1 |  16 CLK  |
   715            C        				 ; |---|---|----------|
   716            C        				 ; | 1 | 0 |  24 CLK  |
   717            C        				 ; |---|---|----------|
   718            C        				 ; | 1 | 1 |  32 CLK  |
   719            C        				 ; |---|---|----------|
   720            C        				 ; Bit4 Reserved
   721       0003 C        		OD3	==  0X03 ; Open-Drain Control Bit
   722       0002 C        		OD4	==  0X02 ;
   723            C        				 ; Bi1 Reserved
   724       0000 C        		RIBF	==  0X00 ; Read Buffer Full Flag
   725            C        	;}
   726            C        ;
   727            C        ;  Bank2 RD (SPI Control Register)
   728            C        ;
   729       000D C         B2_RD	==	0X0D
   730       000D C         SPIC	==	0X0D
   731            C        ;
   732            C        	;{
   733       0007 C        		CES	==  0X07 ; Clock Edge Select Bit
   734       0006 C        		SPIEB	==  0X06 ; SPI Enable Bit
   735       0005 C        		SRO	==  0X05 ; SPI Read Overflow Bit
   736       0004 C        		SSE	==  0X04 ; SPI Shift Enable Bit
   737       0003 C        		SDOC	==  0X03 ; SDO Output Status Control Bit
   738       0002 C        		SBRS2	==  0X02
   739       0001 C        		SBRS1	==  0X01
   740       0000 C        		SBRS0	==  0X00 ; SPI Baud Rate Select Bits
   741            C        				 ; |-----|-----------|--------|-------------------|
   742            C        				 ; |SBRS2|SBRS1|SBRS0|  Mode  |   SPI Baud Rate   |
   743            C        				 ; |-----|-----------|--------|-------------------|
   744            C        				 ; |  0  |  0  |  0  | Master |       Fcsc/2      |
   745            C        				 ; |-----|-----------|--------|-------------------|
   746            C        				 ; |  0  |  0  |  1  | Master |       Fcsc/4      |
   747            C        				 ; |-----|-----------|--------|-------------------|
   748            C        				 ; |  0  |  1  |  0  | Master |       Fcsc/8      |
   749            C        				 ; |-----|-----------|--------|-------------------|
   750            C        				 ; |  0  |  1  |  1  | Master |      Fcsc/16      |
   751            C        				 ; |-----|-----------|--------|-------------------|
   752            C        				 ; |  1  |  0  |  0  | Master |      Fcsc/32      |
   753            C        				 ; |-----|-----------|--------|-------------------|
   754            C        				 ; |  1  |  0  |  1  | Master |       Timer2      |
   755            C        				 ; |-----|-----------|--------|-------------------|
   756            C        				 ; |  1  |  1  |  0  | Slave  |     /SS enable    |
   757            C        				 ; |-----|-----------|--------|-------------------|
   758            C        				 ; |  1  |  1  |  1  | Slave  |     /SS enable    |
   759            C        				 ; |-----|-----------|--------|-------------------|
   760            C        	;}
   761            C        ;
   762            C        ;  Bank2 RE (SPI Read Buffer)
   763            C        ;
   764       000E C         B2_RE	==	0X0E
   765       000E C         SPIR	==	0X0E
   766            C        ;
   767            C        ;  Bank2 RF (SPI Write Buffer)
   768            C        ;
   769       000F C         B2_RF	==	0X0F
   770       000F C         SPIW	==	0X0F
   771            C        ;
   772            C        ;  Bank3 R5 (UART Control Register)
   773            C        ;
   774       0005 C         B3_R5	==	0X05
   775       0005 C         URC	==	0X05
   776            C        ;
   777            C        	;{
   778       0007 C        		URTD8	==  0X07 ; Transmission Data Bit8
   779       0006 C        		UMODE1	==  0X06
   780       0005 C        		UM0DE0	==  0X05 ; UART Transmission Mode Select Bit
   781            C        				 ; |------|------|-----------|
   782            C        				 ; |UMODE1|UMODE0| UART Mode |
   783            C        				 ; |  0   |   0  |Mode1:7-Bit|
   784            C        				 ; |------|------|-----------|
   785            C        				 ; |  0   |   1  |Mode1:8-Bit|
   786            C        				 ; |------|------|-----------|
   787            C        				 ; |  1   |   0  |Mode1:9-Bit|
   788            C        				 ; |------|------|-----------|
   789            C        				 ; |  1   |   1  | Reserved  |
   790            C        				 ; |------|------|-----------|
   791       0004 C        		BRATE2	==  0X04
   792       0003 C        		BRATE1	==  0X03
   793       0002 C        		BRATE0	==  0X02 ; Transmit Baud Rate Select(Tuart=Fc/16)
   794            C        				 ; |------|------|------|-------------|-------------|
   795            C        				 ; |BRATE2|BRATE1|BRATE0|  Baud Rate  | e.g.FC=8Mhz |
   796            C        				 ; |------|------|------|-------------|-------------|
   797            C        				 ; |  0   |  0   |  0   |   Tuart/13  |    38400    |
   798            C        				 ; |------|------|------|-------------|-------------|
   799            C        				 ; |  0   |  0   |  1   |   Tuart/26  |    19200    |
   800            C        				 ; |------|------|------|-------------|-------------|
   801            C        				 ; |  0   |  1   |  0   |   Tuart/52  |     9600    |
   802            C        				 ; |------|------|------|-------------|-------------|
   803            C        				 ; |  0   |  1   |  1   |  Tuart/104  |     4800    |
   804            C        				 ; |------|------|------|-------------|-------------|
   805            C        				 ; |  1   |  0   |  0   |  Tuart/208  |     2400    |
   806            C        				 ; |------|------|------|-------------|-------------|
   807            C        				 ; |  1   |  0   |  1   |  Tuart/416  |     1200    |
   808            C        				 ; |------|------|------|---------------------------|
   809            C        				 ; |  1   |  1   |  0   |            Timer1         |
   810            C        				 ; |------|------|------|---------------------------|
   811            C        				 ; |  1   |  1   |  1   |           Reserved        |
   812            C        				 ; |------|------|------|---------------------------|
   813       0001 C        		UTBE ==  0X01
   814       0000 C        		TXE	 ==  0X00 ; Enable transmission
   815            C        	;}
   816            C        ;
   817            C        ;  Bank 3 R6 (UART Status)
   818            C        ;
   819       0006 C         B3_R6	==  0X06
   820       0006 C         URS	==  0X06
   821            C        ;
   822            C        	;{
   823       0007 C        		URRD8	==  0X07 	; Receiving Data Bit8
   824       0006 C        		EVEN	==  0X06 	; Select Parity Check
   825       0005 C        		PRE		==  0X05	; Enable Parity Check
   826       0004 C        		PRERR	==  0X04 	; Parity Error Flag
   827       0003 C        		OVERR	==  0X03 	; Over Running Error Flag
   828       0002 C        		FMERR	==  0X02 	; Framing Error Flag
   829       0001 C        		URBF	==  0X01 	; UART Read Buffer Full Flag
   830       0000 C        		RXE	==  0X00 		; Enable Receiving
   831            C        	;}
   832            C        ;
   833            C        ;  Bank3 R7 (UART_RD Data Buffer)
   834            C        ;
   835       0007 C         B3_R7	==	0X07
   836       0007 C         URRD	==	0X07
   837            C        ;
   838            C        ;  Bank3 R8 (UART_TD Data Buffer)
   839            C        ;
   840       0008 C         B3_R8	==	0X08
   841       0008 C         URTD	==	0X08
   842            C        ;
   843            C        ;  Bank3 R9 (A/D Control Register)
   844            C        ;
   845       0009 C         B3_R9	==	0X09
   846       0009 C         ADCR	==	0X09
   847            C        ;
   848            C        	;{
   849       0007 C        		ADRUN	==  0X07 ; AD Conversion Start
   850       0006 C        		ADP	==  0X06 ; A/D Power Control
   851       0005 C        		ADCK1	==  0X05
   852       0004 C        		ADCK0	==  0X04 ; A/D Input Select Bits
   853            C        				 ; |-----|-----|------------|---------------------------|
   854            C        				 ; |ADCK1|ADCK0|Clock Source|Max.Operating Frequency(Fc)|
   855            C        				 ; |-----|-----|------------|---------------------------|
   856            C        				 ; |  0	 |  0  |    Fc/4    |           1MHz            |
   857            C        				 ; |-----|-----|------------|---------------------------|
   858            C        				 ; |  0	 |  1  |   Fc/16    |           4MHz            |
   859            C        				 ; |-----|-----|------------|---------------------------|
   860            C        				 ; |  1	 |  0  |   Fc/32    |           8MHz            |
   861            C        				 ; |-----|-----|------------|---------------------------|
   862            C        				 ; |  1	 |  1  |   Fc/64    |          16MHz            |
   863            C        				 ; |-----|-----|------------|---------------------------|
   864       0003 C        		ADIS3	==  0X03
   865       0002 C        		ADIS2	==  0X02
   866       0001 C        		ADIS1	==  0X01
   867       0000 C        		ADIS0	==  0X00 ; A/D Input Select Bits
   868            C        				 ; |-----|-----|-----|----------------------|
   869            C        				 ; |ADIS3|ADIS2|ADIS1|ADIS0|Analog Input Pin|
   870            C        				 ; |-----|-----|-----|----------------------|
   871            C        				 ; |  0  |  0  |  0  |  0  |      AD0       |
   872            C        				 ; |-----|-----|-----|----------------------|
   873            C        				 ; |  0  |  0  |  0  |  1  |      AD1       |
   874            C        				 ; |-----|-----|-----|----------------------|
   875            C        				 ; |  0  |  0  |  1  |  0  |      AD2       |
   876            C        				 ; |-----|-----|-----|----------------------|
   877            C        				 ; |  0  |  0  |  1  |  1  |      AD3       |
   878            C        				 ; |-----|-----|-----|----------------------|
   879            C        				 ; |  0  |  1  |  0  |  0  |      AD4       |
   880            C        				 ; |-----|-----|-----|----------------------|
   881            C        				 ; |  0  |  1  |  0  |  1  |      AD5       |
   882            C        				 ; |-----|-----|-----|----------------------|
   883            C        				 ; |  0  |  1  |  1  |  0  |      AD6       |
   884            C        				 ; |-----|-----|-----|----------------------|
   885            C        				 ; |  0  |  1  |  1  |  1  |      AD7       |
   886            C        				 ; |-----|-----|-----|----------------------|
   887            C        				 ; |  1  |  0  |  0  |  0  |      AD8       |
   888            C        				 ; |-----|-----|-----|----------------------|
   889            C        				 ; |  1  |  0  |  0  |  1  |      AD9       |
   890            C        				 ; |-----|-----|-----|----------------------|
   891            C        				 ; |  1  |  0  |  1  |  0  |      AD10      |
   892            C        				 ; |-----|-----|-----|----------------------|
   893            C        				 ; |  1  |  0  |  1  |  1  |      AD11      |
   894            C        				 ; |-----|-----|-----|----------------------|
   895            C        	;}
   896            C        ;
   897            C        ;  Bank3 RA (A/D Input Control Register)
   898            C        ;
   899       000A C         B3_RA	==	0X0A
   900       000A C         ADICH	==	0X0A
   901            C        ;
   902            C        	;{
   903       0007 C        		CALI	==  0X07 ; Calibration Enable Bit for A/D Offset
   904       0006 C        		ADREF	==  0X06 ; AD Reference Voltage Input Select
   905            C        				 ; Bit4~5:Reserved
   906       0003 C        		ADE11	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   907       0002 C        		ADE10	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   908       0001 C        		ADE9	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   909       0000 C        		ADE8	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   910            C        	;}
   911            C        ;
   912            C        ;  Bank3 RB (A/D Input Control Register)
   913            C        ;
   914       000B C         B3_RB	==	0X0B
   915       000B C         ADICL	==	0X0B
   916            C        ;
   917            C        	;{
   918       0007 C        		ADE7	==  0X07 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   919       0006 C        		ADE6	==  0X06 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   920       0005 C        		ADE5	==  0x05 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   921       0004 C        		ADE4	==  0X04 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   922       0003 C        		ADE3	==  0X03 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   923       0002 C        		ADE2	==  0X02 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   924       0001 C        		ADE1	==  0x01 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   925       0000 C        		ADE0	==  0X00 ; AD Input Pin Enalbe Control.0//1=>I/O//Analog.
   926            C        	;}
   927            C        ;
   928            C        ;  Bank3 RC (A/D High 8-bits Data Buffer)
   929            C        ;
   930       000C C         B3_RC	==	0X0C
   931       000C C         ADDH	==	0X0C
   932            C        ;
   933            C        ;  Bank3 RD (A/D Low 4-bits Data Buffer)
   934            C        ;
   935       000D C         B3_RD	==	0X0D
   936       000D C         ADDL	==	0X0D
   937            C        ;
   938            C        	;{
   939       0007 C        		SIGN	==  0X07 ; Polarity Bit of Offset Voltage.0/1=>Negative/Positive
   940       0006 C        		VOF2	==  0X06
   941       0005 C        		VOF1	==  0X05
   942       0004 C        		VOF0	==  0X04 ; Offset Voltage Bits.
   943            C        				 ; |----|----|----|---------|
   944            C        				 ; |VOF2|VOF1|VOF0|EM78P510N|
   945            C        				 ; |----|----|----|---------|
   946            C        				 ; |  0 |  0 |  0 |   0LSB  |
   947            C        				 ; |----|----|----|---------|
   948            C        				 ; |  0 |  0 |  1 |   2LSB  |
   949            C        				 ; |----|----|----|---------|
   950            C        				 ; |  0 |  1 |  0 |   4LSB  |
   951            C        				 ; |----|----|----|---------|
   952            C        				 ; |  0 |  1 |  1 |   6LSB  |
   953            C        				 ; |----|----|----|---------|
   954            C        				 ; |  1 |  0 |  0 |   8LSB  |
   955            C        				 ; |----|----|----|---------|
   956            C        				 ; |  1 |  0 |  1 |  10LSB  |
   957            C        				 ; |----|----|----|---------|
   958            C        				 ; |  1 |  1 |  0 |  12LSB  |
   959            C        				 ; |----|----|----|---------|
   960            C        				 ; |  1 |  1 |  1 |  14LSB  |
   961            C        				 ; |----|----|----|---------|
   962       0003 C        		ADD3	==  0X03
   963       0002 C        		ADD2	==  0X02
   964       0001 C        		ADD1	==  0X01
   965       0000 C        		ADD0	==  0X00
   966            C        	;}
   967            C        ;
   968            C        ;  Bank3 RE (External Interrupt Edge Select Control Register High Byte)
   969            C        ;
   970       000E C         B3_RE	==	0X0E
   971       000E C         EIESH	==	0X0E
   972            C        ;
   973            C        	;{
   974       0007 C        		EIES7	==  0X07 ; External Interrupt 7 Edge Select Bit.0/1=>Falling/Rising
   975       0006 C        		EIES6	==  0X06 ; External Interrupt 6 Edge Select Bit.0/1=>Falling/Rising
   976       0005 C        		EIES5	==  0X05 ; External Interrupt 5 Edge Select Bit.0/1=>Falling/Rising
   977       0004 C        		EIES4	==  0X04 ; External Interrupt 4 Edge Select Bit.0/1=>Falling/Rising
   978       0003 C        		EIES3	==  0X03 ; External Interrupt 3 Edge Select Bit.0/1=>Falling/Rising
   979       0002 C        		EIES2	==  0X02 ; External Interrupt 2 Edge Select Bit.0/1=>Falling/Rising
   980       0001 C        		EIES1	==  0X01 ; External Interrupt 1 Edge Select Bit.0/1=>Falling/Rising
   981       0000 C        		EIES0	==  0X00 ; External Interrupt 0 Edge Select Bit.0/1=>Falling/Rising
   982            C        	;}
   983            C        ;
   984            C        ;  Bank3 RF (External Interrupt Edge Select Control Register Low Byte)
   985            C        ;
   986       000F C         B3_RF	==	0X0F
   987       000F C         EIESL	==	0X0F
   988            C        ;
   989            C        	;{
   990            C        				 ;Bit4~7 is "0"
   991       0004 C        		ADWK	==  0X04 ; A/D Converter Wake Up Function Enable Bit
   992       0003 C        		INTWK9	==  0X03 ; External Interrupt 9 Wake Up Function Enable Bit
   993       0002 C        		INTWK8	==  0X02 ; External Interrupt 8 Wake Up Function Enable Bit
   994       0001 C        		EIES9	==  0X01 ; External Interrupt 9 Edge Select Bit
   995       0000 C        		EIES8	==  0x00 ; External Interrupt 8 Edge Select Bit
   996            C        	;}
   997            C        ;
   998            C        ;  Bank4 R5 (LED Drive Control Register)
   999            C        ;
  1000       0005 C         B4_R5	==	0X05
  1001       0005 C         LEDDCR	==	0X05
  1002            C        ;
  1003            C        	;{
  1004       0007 C        		LEDD7	==  0X07 ; 0:P9.7 as normal I/O,1:P9.7 as LED direct drive I/O.
  1005       0006 C        		LEDD6	==  0X06 ; 0:P9.6 as normal I/O,1:P9.6 as LED direct drive I/O.
  1006       0005 C        		LEDD5	==  0X05 ; 0:P9.5 as normal I/O,1:P9.5 as LED direct drive I/O.
  1007       0004 C        		LEDD4	==  0X04 ; 0:P9.4 as normal I/O,1:P9.4 as LED direct drive I/O.
  1008       0003 C        		LEDD3	==  0X03 ; 0:P9.3 as normal I/O,1:P9.3 as LED direct drive I/O.
  1009       0002 C        		LEDD2	==  0X02 ; 0:P9.2 as normal I/O,1:P9.2 as LED direct drive I/O.
  1010       0001 C        		LEDD1	==  0X01 ; 0:P9.1 as normal I/O,1:P9.1 as LED direct drive I/O.
  1011       0000 C        		LEDD0	==  0X00 ; 0:P9.0 as normal I/O,1:P9.0 as LED direct drive I/O.
  1012            C        	;}
  1013            C        ;
  1014            C        ;  Bank4 R6 (Watch Timer and Buzzer Control Register)
  1015            C        ;
  1016       0006 C         B4_R6	==	0X06
  1017       0006 C         WBCR	==	0X06
  1018            C        ;
  1019            C        	;{
  1020       0007 C        		WTCS	==  0X07 ; Watch Timer and Buzzer Clock Source Select Bit.
  1021       0006 C        		WTIE	==  0X06 ; Watch Timer Enable Bit and Interrupt Mask
  1022       0005 C        		WTIF	==  0X05 ; Watch Timer Interrupt Flag
  1023       0004 C        		WTSSB1	==  0X04 ;
  1024       0003 C        		WTSSB0  ==  0X03 ; Watch Timer Interval Select Bits
  1025            C        				 ; |------|------|-----------------------------------|
  1026            C        				 ; |WTSSB1|WTSSB0|Watch Timer Interval Select(WTCS=1)|
  1027            C        				 ; |  0   |   0  |                1.0S               |
  1028            C        				 ; |------|------|-----------------------------------|
  1029            C        				 ; |  0   |   1  |                0.5S               |
  1030            C        				 ; |------|------|-----------------------------------|
  1031            C        				 ; |  1   |   0  |               0.25S               |
  1032            C        				 ; |------|------|-----------------------------------|
  1033            C        				 ; |  1   |   1  |              3.91MS               |
  1034            C        				 ; |------|------|-----------------------------------|
  1035       0002 C        		BUZE	==  0X02 ; Buzzer Enable and PORT91 as Buzzer Output Pin
  1036       0001 C        		BSSB1	==  0X01
  1037       0000 C        		BSSB0	==  0X00 ; Buzzer Output Frequency Select Bits
  1038            C        				 ; |-----|-----|----------------------------|
  1039            C        				 ; |BSSB1|BSSB0|Buzzer Signal Select(WTCS=1)|
  1040            C        				 ; |-----|-----|----------------------------|
  1041            C        				 ; |  0  |  0  |           0.5KHz           |
  1042            C        				 ; |-----|-----|----------------------------|
  1043            C        				 ; |  0  |  1  |           1.0KHz           |
  1044            C        				 ; |-----|-----|----------------------------|
  1045            C        				 ; |  1  |  0  |           2.0KHz           |
  1046            C        				 ; |-----|-----|----------------------------|
  1047            C        				 ; |  1  |  1  |           4.0KHz           |
  1048            C        				 ; |-----|-----|----------------------------|
  1049            C        	;}
  1050            C        ;
  1051            C        ;  Bank4 R7 (PORT7 I/O Control Register)
  1052            C        ;
  1053       0007 C         B4_R7	==	0X07
  1054       0007 C         IOC7	==	0X07
  1055       0007 C         P7IOCR	==	0X07
  1056            C        ;
  1057            C        ;  Bank4 R8 (PORT8 I/O Control Register)
  1058            C        ;
  1059       0008 C         B4_R8	==	0X08
  1060       0008 C         IOC8	==	0X08
  1061       0008 C         P8IOCR	==	0X08
  1062            C        ;
  1063            C        ;  Bank4 R9 (PORT9 I/O Control Register)
  1064            C        ;
  1065       0009 C         B4_R9	==	0X09
  1066       0009 C         IOC9	==	0X09
  1067       0009 C         P9IOCR	==	0X09
  1068            C        ;
  1069            C        ;  Bank4 RA (PORTA I/O Control Register)
  1070            C        ;
  1071       000A C         B4_RA	==	0X0A
  1072       000A C         IOCA	==	0X0A
  1073       000A C         PAIOCR	==	0X0A
  1074            C        ;
  1075            C        ;  Bank4 RB (PORTB I/O Control Register)
  1076            C        ;
  1077       000B C         B4_RB	==	0X0B
  1078       000B C         IOCB	==	0X0B
  1079       000B C         PBIOCR	==	0X0B
  1080            C        ;
  1081            C        ;  Bank4 RC (PORTC I/O Control Register)
  1082            C        ;
  1083       000C C         B4_RC	==	0X0C
  1084       000C C         IOCC	==	0X0C
  1085       000C C         PCIOCR	==	0X0C
  1086            C        ;
  1087            C        ;  Bank4 RF (Wake Up Control Register)
  1088            C        ;
  1089       000F C         B4_RF	==	0X0F
  1090       000F C         WKCR	==	0X0F
  1091            C        ;
  1092            C        	;{
  1093       0007 C        		INTWK7	==  0X07 ; External Interrupt 7 Wake Up Function Enable Bit.
  1094       0006 C        		INTWK6	==  0X06 ; External Interrupt 6 Wake Up Function Enable Bit.
  1095       0005 C        		INTWK5	==  0X05 ; External Interrupt 5 Wake Up Function Enable Bit.
  1096       0004 C        		INTWK4	==  0X04 ; External Interrupt 4 Wake Up Function Enable Bit.
  1097       0003 C        		INTWK3	==  0X03 ; External Interrupt 3 Wake Up Function Enable Bit.
  1098       0002 C        		INTWK2	==  0X02 ; External Interrupt 2 Wake Up Function Enable Bit.
  1099       0001 C        		INTWK1	==  0X01 ; External Interrupt 1 Wake Up Function Enable Bit.
  1100       0000 C        		INTWK0	==  0X00 ; External Interrupt 0 Wake Up Function Enable Bit.
  1101            C        	;}
  1102            C        ;
  1103            C        ;  Bank4 R6 (UART Control Register 2)
  1104            C        ;
  1105       0006 C         B5_R6	==	0X06
  1106       0006 C         UARC2	==	0X06
  1107            C        ;
  1108            C        	;{
  1109       0005 C        		UARTE	==  0X05  ; UART Function Enable
  1110       0003 C        		UINVEN	==  0X03  ; Enable UART TX and RX Port Inverse Ouput
  1111            C        				  ; other Bits is "0"
  1112            C        	;}
  1113            C        ;
  1114            C        ; Bank5 R7 (PORT7 Pull High Control Register)
  1115            C        ;
  1116       0007 C         B5_R7	==	0X07
  1117       0007 C         P7PHCR	==	0X07
  1118            C        ;
  1119            C        	;{
  1120       0007 C        		PH77	==  0X07 ;
  1121       0006 C        		PH76	==  0X06 ;
  1122       0005 C        		PH75	==  0X05 ;
  1123       0004 C        		PH74	==  0X04 ;
  1124       0003 C        		PH73	==  0X03 ;
  1125       0002 C        		PH72	==  0X02 ;
  1126       0001 C        		PH71	==  0X01 ;
  1127       0000 C        		PH70	==  0X00 ;
  1128            C        	;}
  1129            C        ;
  1130            C        ; Bank5 R8 (PORT8 Pull High Control Register)
  1131            C        ;
  1132       0008 C         B5_R8	==	0X08
  1133       0008 C         P8PHCR	==	0X08
  1134            C        ;
  1135            C        	;{
  1136       0007 C        		PH87	==  0X07 ;
  1137       0006 C        		PH86	==  0X06 ;
  1138       0005 C        		PH85	==  0X05 ;
  1139       0004 C        		PH84	==  0X04 ;
  1140       0003 C        		PH83	==  0X03 ;
  1141       0002 C        		PH82	==  0X02 ;
  1142       0001 C        		PH81	==  0X01 ;
  1143       0000 C        		PH80	==  0X00 ;
  1144            C        	;}
  1145            C        ;
  1146            C        ; Bank5 R9 (PORT9 Pull High Control Register)
  1147            C        ;
  1148       0009 C         B5_R9	==	0X09
  1149       0009 C         P9PHCR	==	0X09
  1150            C        ;
  1151            C        	;{
  1152       0007 C        		PH97	==  0X07 ;
  1153       0006 C        		PH96	==  0X06 ;
  1154       0005 C        		PH95	==  0X05 ;
  1155       0004 C        		PH94	==  0X04 ;
  1156       0003 C        		PH93	==  0X03 ;
  1157       0002 C        		PH92	==  0X02 ;
  1158       0001 C        		PH91	==  0X01 ;
  1159       0000 C        		PH90	==  0X00 ;
  1160            C        	;}
  1161            C        ;
  1162            C        ; Bank5 RA (PORTA Pull High Control Register)
  1163            C        ;
  1164       000A C         B5_RA	==	0X0A
  1165       000A C         PAPHCR	==	0X0A
  1166            C        ;
  1167            C        	;{
  1168       0007 C        		PHA7	==  0X07 ;
  1169       0006 C        		PHA6	==  0X06 ;
  1170       0005 C        		PHA5	==  0X05 ;
  1171       0004 C        		PHA4	==  0X04 ;
  1172       0003 C        		PHA3	==  0X03 ;
  1173       0002 C        		PHA2	==  0X02 ;
  1174       0001 C        		PHA1	==  0X01 ;
  1175       0000 C        		PHA0	==  0X00 ;
  1176            C        	;}
  1177            C        ;
  1178            C        ; Bank5 RB (PORTB Pull High Control Register)
  1179            C        ;
  1180       000B C         B5_RB	==	0X0B
  1181       000B C         PBPHCR	==	0X0B
  1182            C        ;
  1183            C        	;{
  1184       0007 C        		PHB7	==  0X07 ;
  1185       0006 C        		PHB6	==  0X06 ;
  1186       0005 C        		PHB5	==  0X05 ;
  1187       0004 C        		PHB4	==  0X04 ;
  1188       0003 C        		PHB3	==  0X03 ;
  1189       0002 C        		PHB2	==  0X02 ;
  1190       0001 C        		PHB1	==  0X01 ;
  1191       0000 C        		PHB0	==  0X00 ;
  1192            C        	;}
  1193            C        ;
  1194            C        ; Bank5 RC (PORTC Pull High Control Register)
  1195            C        ;
  1196       000C C         B5_RC	==	0X0C
  1197       000C C         PCPHCR	==	0X0C
  1198            C        ;
  1199            C        	;{
  1200       0003 C        		PHC3	==  0X03 ;
  1201       0002 C        		PHC2	==  0X02 ;
  1202       0001 C        		PHC1	==  0X01 ;
  1203       0000 C        		PHC0	==  0X00 ;
  1204            C        				 ; Other Bits is "0"
  1205            C        	;}
  1206            C        ;
  1207            C        ;  Bank6 R6 (Low Voltage Reset Control Register)
  1208            C        ;
  1209       0006 C         B6_R6  ==  0x06
  1210       0006 C         LVRCR  ==  0x06
  1211            C        ;
  1212            C            ;{
  1213       0002 C                LVREN   ==  0x02 ;
  1214       0001 C                LVRS1   ==  0x01 ;
  1215       0000 C                LVRS0   ==  0x00 ;
  1216            C            ;}
  1217            C        
  1218            C        ;  Bank6 R7 (PORT7 Open Drain Control Reister)
  1219            C        ;
  1220       0007 C         B6_R7	==	0X07
  1221       0007 C         P7ODCR	==	0X07
  1222            C        ;
  1223            C        	;{
  1224       0007 C        		P7OD7	==  0X07 ;
  1225       0006 C        		P7OD6	==  0X06 ;
  1226       0005 C        		P7OD5	==  0X05 ;
  1227       0004 C        		P7OD4	==  0X04 ;
  1228       0003 C        		P7OD3	==  0X03 ;
  1229       0002 C        		P7OD2	==  0X02 ;
  1230       0001 C        		P7OD1	==  0X01 ;
  1231       0000 C        		P7OD0	==  0X00 ;
  1232            C        	;}
  1233            C        ;
  1234            C        ;  Bank6 R8 (PORT8 Open Drain Control Reister)
  1235            C        ;
  1236       0008 C         B6_R8	==	0X08
  1237       0008 C         P8ODCR	==	0X08
  1238            C        ;
  1239            C        	;{
  1240       0007 C        		P8OD7	==  0X07 ;
  1241       0006 C        		P8OD6	==  0X06 ;
  1242       0005 C        		P8OD5	==  0X05 ;
  1243       0004 C        		P8OD4	==  0X04 ;
  1244       0003 C        		P8OD3	==  0X03 ;
  1245       0002 C        		P8OD2	==  0X02 ;
  1246       0001 C        		P8OD1	==  0X01 ;
  1247       0000 C        		P8OD0	==  0X00 ;
  1248            C        	;}
  1249            C        ;
  1250            C        ;  Bank6 R9 (PORT9 Open Drain Control Reister)
  1251            C        ;
  1252       0009 C         B6_R9	==	0X09
  1253       0009 C         P9ODCR	==	0X09
  1254            C        ;
  1255            C        	;{
  1256       0007 C        		P9OD7	==  0X07 ;
  1257       0006 C        		P9OD6	==  0X06 ;
  1258       0005 C        		P9OD5	==  0X05 ;
  1259       0004 C        		P9OD4	==  0X04 ;
  1260       0003 C        		P9OD3	==  0X03 ;
  1261       0002 C        		P9OD2	==  0X02 ;
  1262       0001 C        		P9OD1	==  0X01 ;
  1263       0000 C        		P9OD0	==  0X00 ;
  1264            C        	;}
  1265            C        ;
  1266            C        ;  Bank6 RA (PORTA Open Drain Control Reister)
  1267            C        ;
  1268       000A C         B6_RA	==	0X0A
  1269       000A C         PAODCR	==	0X0A
  1270            C        ;
  1271            C        	;{
  1272       0007 C        		PAOD7	==  0X07 ;
  1273       0006 C        		PAOD6	==  0X06 ;
  1274       0005 C        		PAOD5	==  0X05 ;
  1275       0004 C        		PAOD4	==  0X04 ;
  1276       0003 C        		PAOD3	==  0X03 ;
  1277       0002 C        		PAOD2	==  0X02 ;
  1278       0001 C        		PAOD1	==  0X01 ;
  1279       0000 C        		PAOD0	==  0X00 ;
  1280            C        	;}
  1281            C        ;
  1282            C        ;  Bank6 RB (PORTB Open Drain Control Reister)
  1283            C        ;
  1284       000B C         B6_RB	==	0X0B
  1285       000B C         PBODCR	==	0X0B
  1286            C        ;
  1287            C        	;{
  1288       0007 C        		PBOD7	==  0X07 ;
  1289       0006 C        		PBOD6	==  0X06 ;
  1290       0005 C        		PBOD5	==  0X05 ;
  1291       0004 C        		PBOD4	==  0X04 ;
  1292       0003 C        		PBOD3	==  0X03 ;
  1293       0002 C        		PBOD2	==  0X02 ;
  1294       0001 C        		PBOD1	==  0X01 ;
  1295       0000 C        		PBOD0	==  0X00 ;
  1296            C        	;}
  1297            C        ;
  1298            C        ;  Bank6 RC (PORTC Open Drain Control Reister)
  1299            C        ;
  1300       000C C         B6_RC	==	0X0C
  1301       000C C         PORTC	==	0X0C
  1302            C        ;
  1303            C        	;{
  1304            C        				 ; Other
  1305       0003 C        		PCOD3	==  0X03 ;
  1306       0002 C        		PCOD2	==  0X02 ;
  1307       0001 C        		PCOD1	==  0X01 ;
  1308       0000 C        		PCOD0	==  0X00 ;
  1309            C        	;}
  1310            C        ;
  1311            C        ;======================================================;
  1312            C        ; Register R10~R3F                                     ;
  1313            C        ;======================================================;
  1314            C        ;
  1315            C        ; (R10 ~ R3F): General Purpose Register
  1316            C        ;
  1317       0010 C         R10    ==    0x10
  1318       0011 C         R11    ==    0x11
  1319       0012 C         R12    ==    0x12
  1320       0013 C         R13    ==    0x13
  1321       0014 C         R14    ==    0x14
  1322       0015 C         R15    ==    0x15
  1323       0016 C         R16    ==    0x16
  1324       0017 C         R17    ==    0x17
  1325       0018 C         R18    ==    0x18
  1326       0019 C         R19    ==    0x19
  1327       001A C         R1A    ==    0x1A
  1328       001B C         R1B    ==    0x1B
  1329       001C C         R1C    ==    0x1C
  1330       001D C         R1D    ==    0x1D
  1331       001E C         R1E    ==    0x1E
  1332       001F C         R1F    ==    0x1F
  1333            C        ;
  1334       0020 C         R20    ==    0x20
  1335       0021 C         R21    ==    0x21
  1336       0022 C         R22    ==    0x22
  1337       0023 C         R23    ==    0x23
  1338       0024 C         R24    ==    0x24
  1339       0025 C         R25    ==    0x25
  1340       0026 C         R26    ==    0x26
  1341       0027 C         R27    ==    0x27
  1342       0028 C         R28    ==    0x28
  1343       0029 C         R29    ==    0x29
  1344       002A C         R2A    ==    0x2A
  1345       002B C         R2B    ==    0x2B
  1346       002C C         R2C    ==    0x2C
  1347       002D C         R2D    ==    0x2D
  1348       002E C         R2E    ==    0x2E
  1349       002F C         R2F    ==    0x2F
  1350            C        ;
  1351       0030 C         R30    ==    0x30
  1352       0031 C         R31    ==    0x31
  1353       0032 C         R32    ==    0x32
  1354       0033 C         R33    ==    0x33
  1355       0034 C         R34    ==    0x34
  1356       0035 C         R35    ==    0x35
  1357       0036 C         R36    ==    0x36
  1358       0037 C         R37    ==    0x37
  1359       0038 C         R38    ==    0x38
  1360       0039 C         R39    ==    0x39
  1361       003A C         R3A    ==    0x3A
  1362       003B C         R3B    ==    0x3B
  1363       003C C         R3C    ==    0x3C
  1364       003D C         R3D    ==    0x3D
  1365       003E C         R3E    ==    0x3E
  1366       003F C         R3F    ==    0x3F
  1367            C        
    14                     include "D:\include\EM78xx\inc\EM78Math.H"
     1            C        ;**********************************************************************;
     2            C        ; Title:        EM78Math Macros Define                                 ;
     3            C        ; Description:  The Maths for EM78x447xxx                              ;
     4            C        ; Company:      Elan Corp.Inc                                          ;
     5            C        ; Author:       Shenzhen 8Bit Tean                                     ;
     6            C        ; Date:         5/26/2004                                              ;
     7            C        ; Version:      1.0                                                    ;
     8            C        ;**********************************************************************
     9            C        ;----------------------------------------------------------------
    10            C        EM78Math.H      EQU     EM78Math.H
    11            C        
    12            C        
    13            C        ;----------------------------------------------------------------
    14            C        
    15            C        
    16            C        
    17            C        
    18            C        ;**********************************************************************;
    19            C        ; Title:       1 Byte Binary Code Transform BCD Code                   ;
    20            C        ; Description: Hundred Bigit Of Bcd Cade Storage In  Low Bigit  Of     ;
    21            C        ;              reg_acc3,Entries Bigit Of Bcd Cade Storage In High      ;
    22            C        ;              Bigit Of reg_acc2, Binary Data Storage In reg_acc1      ;
    23            C        ; Arithmetic:  BCD==100*a+10*b+c                                       ;
    24            C        ; Input:       reg_acc1                                                ;
    25            C        ; Output:      reg_acc3, reg_acc2                                      ;
    26            C        ; Variable Register:None                                               ;
    27            C        ; Register Changed: R3, 0 ;ACC                                         ;
    28            C        ;**********************************************************************;
    29            C        ;-----------------------------------------------------------------
    30            C        mBinToBcd1 MACRO reg_acc1, reg_acc3, reg_acc2
    31            C        ;
    32            C                CLR     reg_acc2        ;clear BCD data register
    33            C                CLR     reg_acc3
    34            C                MOV     A, reg_acc1
    35            C        $Bin_Bcd1:
    36            C                ADD     A, @156         ;subtract 100 from binary that is transform
    37            C                JBS     STATUS, C       ;borrow bigit?
    38            C                JMP     $Bin_Bcd2       ;borrow bigit jump to Bin_Bcd2
    39            C                INC     reg_acc3        ;if don't borrow bigit then hundred bigit adding 1
    40            C                JMP     $Bin_Bcd1       ;backing out
    41            C        $Bin_Bcd2:
    42            C                ADD     A, @100         ;100
    43            C                MOV     reg_acc1, A
    44            C        $Bin_Bcd3:
    45            C                ADD     A, @246         ;10
    46            C                JBS     STATUS, C       ;
    47            C                JMP     $Bin_Bcd4       ;
    48            C                INC     reg_acc2        ;BCD1
    49            C                JMP     $Bin_Bcd3
    50            C        $Bin_Bcd4:
    51            C                ADD     A, @10          ;10
    52            C                SWAP    reg_acc2        ;BCDreg_acc2
    53            C                ADD     reg_acc2, A     ;BCDreg_acc2
    54            C                ENDM
    55            C        ;
    56            C        ;**********************************************************************;
    57            C        ; Title:       2 Byte Binary Code Transform BCD Code                   ;
    58            C        ; Description: Highest Bigit Of Bcd Storage In Low Byte Of reg_acc5,   ;
    59            C        ;              Lowest Bigit Of Bcd Storage In Low Byte Of reg_acc3,    ;
    60            C        ;              High Bigit Of Binary Storage In reg_acc1,               ;
    61            C        ;              Low Bigit Of Binart Storage In reg_acc2,                ;
    62            C        ; Input:       reg_acc1, reg_acc2                                      ;
    63            C        ; Output:      reg_acc3, reg_acc4, reg_acc5                            ;
    64            C        ; Variable Register:reg_acc, reg_accd                                  ;
    65            C        ; Register Changed: R3, 0; ACC                                         ;
    66            C        ; Status:      1                                                       ;
    67            C        ;**********************************************************************;
    68            C        ;
    69            C        mBinToBcd2 MACRO reg_acc2, reg_acc1, reg_acc5, reg_acc4, reg_acc3
    70            C        ;
    71            C                MOV     A, @16          ;(=byte*8)
    72            C                MOV     reg_acc, A
    73            C                CLR     reg_acc5        ;BCD
    74            C                CLR     reg_acc4
    75            C                CLR     reg_acc3
    76            C                BC      STATUS, C       ;R3C
    77            C        $Bin_Bcd1:
    78            C                RLC     reg_acc1        ;
    79            C                RLC     reg_acc2        ;
    80            C                RLC     reg_acc3        ;BCD
    81            C                RLC     reg_acc4
    82            C                RLC     reg_acc5        ;BCD
    83            C                DJZ     reg_acc         ;
    84            C                JMP     $Bin_Bcd2       ;BCD
    85            C                JMP     $Bin_Bcd3       ;
    86            C        $Bin_Bcd2:
    87            C                MOV     A, reg_acc3     ;reg_acc3BCD
    88            C                CALL    $bcdadj         ;BCD
    89            C                MOV     reg_acc3, A     ;
    90            C                MOV     A, reg_acc4     ;reg_acc4BCD
    91            C                CALL    $BCDADJ
    92            C                MOV     reg_acc4, A
    93            C                MOV     A, reg_acc5     ;reg_acc5BCD
    94            C                CALL    $BCDADJ
    95            C                MOV     reg_acc5, A
    96            C                JMP     $Bin_Bcd1       ;
    97            C        ;-------BCD Code Adjust Subprogram---------------
    98            C        $BCDADJ:
    99            C                ADD     A, @51
   100            C                MOV     reg_accd, A
   101            C                JBS     reg_accd, 3
   102            C                ADD     A, @253
   103            C                JBS     reg_accd, 7
   104            C                ADD     A, @208
   105            C                RET
   106            C        $Bin_Bcd3:
   107            C                ENDM
   108            C        ;
   109            C        ;**********************************************************************;
   110            C        ; Title:      3 Byte Binary Code Transform Bcd Code                    ;
   111            C        ; Description:reg_acc7BCD                    ;
   112            C        ;             reg_acc4BCD,                     ;
   113            C        ;             reg_acc3                         ;
   114            C        ;             reg_acc1                         ;
   115            C        ; Input:      reg_acc1, reg_acc2, reg_acc3                             ;
   116            C        ; Output:     reg_acc4, reg_acc5, reg_acc6, reg_acc7                   ;
   117            C        ; Variable Register:reg_acc, reg_accd                                  ;
   118            C        ; Register Changed: R3, 0;ACC                                          ;
   119            C        ; stack:      1                                                        ;
   120            C        ;**********************************************************************;
   121            C        ;
   122            C        mBinToBcd3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5, reg_acc4
   123            C        ;
   124            C                MOV     A, @24          ;=byte*8)
   125            C                MOV     reg_acc, A
   126            C                CLR     reg_acc4
   127            C                CLR     reg_acc5
   128            C                CLR     reg_acc6
   129            C                CLR     reg_acc7
   130            C                BC      STATUS, C       ;R3C
   131            C        $Bin_Bcd1:
   132            C                RLC     reg_acc1        ;
   133            C                RLC     reg_acc2
   134            C                RLC     reg_acc3        ;
   135            C                RLC     reg_acc4        ;BCD
   136            C                RLC     reg_acc5
   137            C                RLC     reg_acc6
   138            C                RLC     reg_acc7        ;BCD
   139            C                DJZ     reg_acc         ;
   140            C                JMP     $Bin_Bcd2       ;BCD
   141            C                JMP     $Bin_Bcd3       ;
   142            C        $Bin_Bcd2:
   143            C                MOV     A, reg_acc4     ;reg_acc4BCD
   144            C                CALL    $BCDADJ         ;BCD
   145            C                MOV     reg_acc4, A
   146            C                MOV     A, reg_acc5     ;reg_acc5BCD
   147            C                CALL    $BCDADJ
   148            C                MOV     reg_acc5, A
   149            C                MOV     A, reg_acc6     ;reg_acc6BCD
   150            C                CALL    $BCDADJ
   151            C                MOV     reg_acc6, A
   152            C                MOV     A, reg_acc7     ;reg_acc7BCD
   153            C                CALL    $BCDADJ
   154            C                MOV     reg_acc7, A
   155            C                JMP     $Bin_Bcd1       ;
   156            C        ;-------BCD Code Adjust Subprogram---------------
   157            C        $BCDADJ:
   158            C                ADD     A, @51
   159            C                MOV     reg_accd, A
   160            C                JBS     reg_accd, 3
   161            C                ADD     A, @253
   162            C                JBS     reg_accd, 7
   163            C                ADD     A, @208
   164            C                RET
   165            C        $Bin_Bcd3:
   166            C                ENDM
   167            C        ;
   168            C        ;**********************************************************************;
   169            C        ; Title:      4 Byte Binary Code Transform Bcd Code                    ;
   170            C        ; Description:reg_acc9BCD                    ;
   171            C        ;             reg_acc5BCD                    ;
   172            C        ;             reg_acc4                         ;
   173            C        ;             reg_acc1?                          ;
   174            C        ; Arithmetic:                                                          ;
   175            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4                   ;
   176            C        ; Output:     reg_acc5, reg_acc6, reg_acc7, reg_acc8, reg_acc9         ;
   177            C        ; Variable Register:reg_acc, reg_accd                                  ;
   178            C        ; Register Changed: R3, 0; ACC                                         ;
   179            C        ; stack:      1                                                        ;
   180            C        ;**********************************************************************;
   181            C        ;
   182            C        mBinToBcd4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc9, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   183            C        ;
   184            C                MOV     A,  @32         ;(=byte*8)
   185            C                MOV     reg_acc, A
   186            C                CLR     reg_acc5        ;BCD
   187            C                CLR     reg_acc6
   188            C                CLR     reg_acc7
   189            C                CLR     reg_acc8
   190            C                CLR     reg_acc9
   191            C                BC      STATUS, C       ;R3C
   192            C        $Bin_Bcd1:
   193            C                RLC     reg_acc1        ;
   194            C                RLC     reg_acc2
   195            C                RLC     reg_acc3
   196            C                RLC     reg_acc4        ;
   197            C                RLC     reg_acc5
   198            C                RLC     reg_acc6        ;BCD
   199            C                RLC     reg_acc7
   200            C                RLC     reg_acc8
   201            C                RLC     reg_acc9        ;BCD
   202            C                DJZ     reg_acc         ;
   203            C                JMP     $Bin_Bcd2       ;BCD
   204            C                JMP     $Bin_Bcd3       ;
   205            C        $Bin_Bcd2:
   206            C                MOV     A, reg_acc5     ;reg_acc5BCD
   207            C                CALL    $BCDADJ         ;BCD
   208            C                MOV     reg_acc5, A
   209            C                MOV     A, reg_acc6     ;reg_acc6BCD
   210            C                CALL    $BCDADJ
   211            C                MOV     reg_acc6, A
   212            C                MOV     A, reg_acc7     ;reg_acc7BCD
   213            C                CALL    $BCDADJ
   214            C                MOV     reg_acc7, A
   215            C                MOV     A, reg_acc8     ;reg_acc8BCD
   216            C                CALL    $BCDADJ
   217            C                MOV     reg_acc8, A
   218            C                MOV     A, reg_acc9     ;reg_acc9BCD
   219            C                CALL    $BCDADJ
   220            C                MOV     reg_acc9, A
   221            C                JMP     $Bin_Bcd1       ;
   222            C        ;-------BCD Code Adjust Subprogram---------------
   223            C        $BCDADJ:
   224            C                ADD     A, @51
   225            C                MOV     reg_accd, A
   226            C                JBS     reg_accd, 3
   227            C                ADD     A, @253
   228            C                JBS     reg_accd, 7
   229            C                ADD     A, @208
   230            C                RET
   231            C        $Bin_Bcd3:
   232            C                ENDM
   233            C        ;**********************************************************************;
   234            C        ; Title:      5 Byte Binary Code Transform Bcd Code                    ;
   235            C        ; Description:reg_acccBCD                      ;
   236            C        ;             reg_acc6BCD                      ;
   237            C        ;             reg_acc5                         ;
   238            C        ;             reg_acc1                         ;
   239            C        ; Input:      reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,        ;
   240            C        ; Output:     reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca,        ;
   241            C        ;             reg_accb, reg_accc                                       ;
   242            C        ; Variable Register:reg_acc, reg_accd                                  ;
   243            C        ; Register Changed: R3, 0;ACC                                          ;
   244            C        ; Stack:      1                                                        ;
   245            C        ;**********************************************************************;
   246            C        ;
   247            C        mBinToBcd5 MACRO reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   248            C        ;
   249            C                MOV     A,  @40         ;(=byte*8)
   250            C                MOV     reg_acc, A
   251            C                CLR     reg_acc6        ;BCD
   252            C                CLR     reg_acc7
   253            C                CLR     reg_acc8
   254            C                CLR     reg_acc9
   255            C                CLR     reg_acca
   256            C                CLR     reg_accb
   257            C                CLR     reg_accc
   258            C                BC      STATUS, C       ;R3C
   259            C        $Bin_Bcd1:
   260            C                RLC     reg_acc1
   261            C                RLC     reg_acc2
   262            C                RLC     reg_acc3        ;
   263            C                RLC     reg_acc4        ;
   264            C                RLC     reg_acc5        ;
   265            C        ;
   266            C                RLC     reg_acc6        ;BCD
   267            C                RLC     reg_acc7
   268            C                RLC     reg_acc8
   269            C                RLC     reg_acc9
   270            C                RLC     reg_acca
   271            C                RLC     reg_accb
   272            C                RLC     reg_accc        ;BCD
   273            C                DJZ     reg_acc         ;
   274            C                JMP     $Bin_Bcd2       ;BCD
   275            C                JMP     $Bin_Bcd3       ;
   276            C        $Bin_Bcd2:
   277            C                MOV     A, reg_acc6     ;reg_acc6BCD
   278            C                CALL    $BCDADJ         ;BCD
   279            C                MOV     reg_acc6, A
   280            C                MOV     A, reg_acc7     ;reg_acc7BCD
   281            C                CALL    $BCDADJ
   282            C                MOV     reg_acc7, A
   283            C                MOV     A, reg_acc8     ;reg_acc8BCD
   284            C                CALL    $BCDADJ
   285            C                MOV     reg_acc8, A
   286            C                MOV     A, reg_acc9     ;reg_acc9BCD
   287            C                CALL    $BCDADJ
   288            C                MOV     reg_acc9, A
   289            C                MOV     A, reg_acca     ;reg_accaBCD
   290            C                CALL    $BCDADJ
   291            C                MOV     reg_acca, A
   292            C                MOV     A, reg_accb     ;reg_accbBCD
   293            C                CALL    $BCDADJ
   294            C                MOV     reg_accb, A
   295            C                MOV     A, reg_accc     ;reg_acccBCD
   296            C                CALL    $BCDADJ
   297            C                MOV     reg_accc, A
   298            C                JMP     $Bin_Bcd1       ;
   299            C        ;
   300            C        ;-------BCD Code Adjust Subprogram---------------
   301            C        $BCDADJ:
   302            C                ADD     A, @51
   303            C                MOV     reg_accd, A
   304            C                JBS     reg_accd, 3
   305            C                ADD     A, @253
   306            C                JBS     reg_accd, 7
   307            C                ADD     A, @208
   308            C                RET
   309            C        $Bin_Bcd3:
   310            C                ENDM
   311            C        ;
   312            C        ;**********************************************************************;
   313            C        ; Title:      1 Byte Bcd Code Transform 1 Byte Binary Code             ;
   314            C        ; Input:      reg_acc1(BCD code)                                       ;
   315            C        ; Output:     reg_acc2(Binary Code)                                    ;
   316            C        ; Register Changed: STATUS, C;ACC                                      ;
   317            C        ;**********************************************************************;
   318            C        ;
   319            C        mBcdToBin1 MACRO reg_acc1, reg_acc2
   320            C        ;
   321            C                CLR     reg_acc2
   322            C                SWAPA   reg_acc1        ;reg_acc1A
   323            C                AND     A, @0X0F        ;reg_acc1, 0-3bit.
   324            C                MOV     reg_acc2, A
   325            C                BC      STATUS, C
   326            C                RLC     reg_acc2        ;reg_acc2*10
   327            C                RLC     reg_acc2
   328            C                ADD     reg_acc2, A
   329            C                RLC     reg_acc2
   330            C                MOV     A, reg_acc1
   331            C                AND     A, @0X0F        ;reg_acc1, 4-7bit
   332            C                ADD     reg_acc2, A     ;bcd code10bcd code
   333            C                ENDM
   334            C        ;
   335            C        ;**********************************************************************;
   336            C        ; Title:     2 Byte Bcd Code Transform 2 Byte Binary Code              ;
   337            C        ; Input:     reg_acc1, reg_acc2;reg_acc2:High Bigit Of Bcd Code;       ;
   338            C        ;            reg_acc1:Low Bigit Of Bcd Code.                           ;
   339            C        ; Output:    reg_acc3, reg_acc4;reg_acc4:High Byte Binary Code;        ;
   340            C        ;            reg_acc3:Low Byte Of Binary Code.                         ;
   341            C        ; Register Changed: STATUS, C; ACC                                     ;
   342            C        ; Stack:     1                                                         ;
   343            C        ;**********************************************************************;
   344            C        ;
   345            C        mBcdToBin2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   346            C        ;
   347            C                CLR     reg_acc3        ;clear binary code register
   348            C                CLR     reg_acc4
   349            C                MOV     A, @16          ;reg_acc==byte*8)
   350            C                Mov     reg_acc, A
   351            C        $Bcd_Bin1:
   352            C                BC      STATUS, C
   353            C                RRC     reg_acc2        ;BCDBINARY
   354            C                RRC     reg_acc1
   355            C                RRC     reg_acc4
   356            C                RRC     reg_acc3
   357            C                MOV     A, reg_acc1     ;BCDBCD
   358            C                CALL    $Binadj
   359            C                MOV     reg_acc1, A
   360            C                MOV     A, reg_acc2
   361            C                CALL    $Binadj
   362            C                MOV     reg_acc2, A
   363            C                DJZ     reg_acc
   364            C                JMP     $Bcd_Bin1
   365            C                JMP     $Bcd_Bin2
   366            C        $Binadj:
   367            C                MOV     reg_accd, A
   368            C                JBC     reg_accd, 3
   369            C                ADD     A, @253
   370            C                JBC     reg_accd, 7
   371            C                ADD     A, @208
   372            C                RET
   373            C        $Bcd_Bin2:
   374            C                ENDM
   375            C        ;
   376            C        ;**********************************************************************;
   377            C        ; Title:    3 Byte Bcd Code Transform 3 Byte Binary Code               ;
   378            C        ; Input:    reg_acc1,reg_acc2,reg_acc3;reg_acc3:High Bigit Of Bcd Code;;
   379            C        ;           reg_acc1:Low Bigit Of Bcd Code.                            ;
   380            C        ; Output:   reg_acc4,reg_acc5,reg_acc6;reg_acc6:High Byte Binary Code; ;
   381            C        ;           reg_acc4:Low Byte Of Binary Code.                          ;
   382            C        ; Register Changed: STATUS, C; ACC                                     ;
   383            C        ; Stack:     1                                                         ;
   384            C        ;**********************************************************************;
   385            C        ;
   386            C        mBcdToBin3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   387            C        ;
   388            C                CLR     reg_acc4
   389            C                CLR     reg_acc5
   390            C                CLR     reg_acc6
   391            C                MOV     A, @24          ;reg_acc==BYTE*8)
   392            C                MOV     reg_acc, A
   393            C        $Bcd_Bin1:
   394            C                BC      STATUS, C
   395            C                RRC     reg_acc3
   396            C                RRC     reg_acc2
   397            C                RRC     reg_acc1
   398            C                RRC     reg_acc6
   399            C                RRC     reg_acc5
   400            C                RRC     reg_acc4
   401            C                MOV     A, reg_acc1
   402            C                CALL    $Binadj
   403            C                MOV     reg_acc1, A
   404            C                MOV     A, reg_acc2
   405            C                CALL    $Binadj
   406            C                MOV     reg_acc2, A
   407            C                MOV     A, reg_acc3
   408            C                CALL    $Binadj
   409            C                MOV     reg_acc3, A
   410            C                DJZ     reg_acc
   411            C                JMP     $Bcd_Bin1
   412            C                JMP     $Bcd_Bin2
   413            C        $Binadj:
   414            C                MOV     reg_accd, A
   415            C                JBC     reg_accd, 3
   416            C                ADD     A, @253
   417            C                JBC     reg_accd, 7
   418            C                ADD     A, @208
   419            C                RET
   420            C        $Bcd_Bin2:
   421            C                ENDM
   422            C        ;
   423            C        ;**********************************************************************;
   424            C        ; Title:     4 Byte Bcd Code Transform 4 Byte Binary Code              ;
   425            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4;reg_acc4:High Bigit;
   426            C        ;            Of Bcd Code;reg_acc1:Low Bigit Of Bcd Code.               ;
   427            C        ; Output:    reg_acc5, reg_acc6, reg_acc7, reg_acc8;reg_acc8:High Byte ;
   428            C        ;            Binary Code;reg_acc5:Low Byte Of Binary Code.             ;
   429            C        ; Register Changed: STATUS, C;ACC                                      ;
   430            C        ; Stack:     1                                                         ;
   431            C        ;**********************************************************************;
   432            C        ;
   433            C        mBcdToBin4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
   434            C        ;
   435            C                CLR     reg_acc5
   436            C                CLR     reg_acc6
   437            C                CLR     reg_acc7
   438            C                CLR     reg_acc8
   439            C                MOV     A, @32          ;reg_acc==BYTE*8)
   440            C                MOV     reg_acc, A
   441            C        $Bcd_Bin1:
   442            C                BC      STATUS, C
   443            C                RRC     reg_acc4
   444            C                RRC     reg_acc3
   445            C                RRC     reg_acc2
   446            C                RRC     reg_acc1
   447            C                RRC     reg_acc8
   448            C                RRC     reg_acc7
   449            C                RRC     reg_acc6
   450            C                RRC     reg_acc5
   451            C                MOV     A, reg_acc1
   452            C                CALL    $Binadj
   453            C                MOV     reg_acc1, A
   454            C                MOV     A, reg_acc2
   455            C                CALL    $Binadj
   456            C                MOV     reg_acc2, A
   457            C                MOV     A, reg_acc3
   458            C                CALL    $Binadj
   459            C                MOV     reg_acc3, A
   460            C                MOV     A, reg_acc4
   461            C                CALL    $Binadj
   462            C                MOV     reg_acc4, A
   463            C                DJZ     reg_acc
   464            C                JMP     $Bcd_Bin1
   465            C                JMP     $Bcd_Bin2
   466            C        $Binadj:
   467            C                MOV     reg_accd, A
   468            C                JBC     reg_accd, 3
   469            C                ADD     A, @253
   470            C                JBC     reg_accd, 7
   471            C                ADD     A, @208
   472            C                RET
   473            C        $Bcd_Bin2:
   474            C                ENDM
   475            C        ;
   476            C        ;**********************************************************************;
   477            C        ; Title:     5 Byte Bcd Code Transform 5 Byte Binary Code              ;
   478            C        ; Input:     reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5;         ;
   479            C        ;            reg_acc5:High Bigit Of Bcd Code;reg_acc1:lOw Bigit Of     ;
   480            C        ;            Bcd Code.                                                 ;
   481            C        ; Output:    reg_acc6, reg_acc7, reg_acc8, reg_acc9, reg_acca;         ;
   482            C        ;            reg_acca:High Byte Of Binary Code;reg_acc6:Low Byte       ;
   483            C        ;            Of Binary Code.                                           ;
   484            C        ; Register Changed: STATUS, C; ACC                                     ;
   485            C        ; Stack:     1                                                         ;
   486            C        ;**********************************************************************;
   487            C        ;
   488            C        mBcdToBin5 MACRO  reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
   489            C        ;
   490            C                CLR     reg_acc6
   491            C                CLR     reg_acc7
   492            C                CLR     reg_acc8
   493            C                CLR     reg_acc9
   494            C                CLR     reg_acca
   495            C                MOV     A, @40          ;reg_acc==BYTE*8)
   496            C                MOV     reg_acc, A
   497            C        $Bcd_Bin1:
   498            C                BC      STATUS, C
   499            C                RRC     reg_acc5
   500            C                RRC     reg_acc4
   501            C                RRC     reg_acc3
   502            C                RRC     reg_acc2
   503            C                RRC     reg_acc1
   504            C                RRC     reg_acca
   505            C                RRC     reg_acc9
   506            C                RRC     reg_acc8
   507            C                RRC     reg_acc7
   508            C                RRC     reg_acc6
   509            C                MOV     A, reg_acc1
   510            C                CALL    $Binadj
   511            C                MOV     reg_acc1, A
   512            C                MOV     A, reg_acc2
   513            C                CALL    $Binadj
   514            C                MOV     reg_acc2, A
   515            C                MOV     A, reg_acc3
   516            C                CALL    $Binadj
   517            C                MOV     reg_acc3, A
   518            C                MOV     A, reg_acc4
   519            C                CALL    $Binadj
   520            C                MOV     reg_acc4, A
   521            C                MOV     A, reg_acc5
   522            C                CALL    $Binadj
   523            C                MOV     reg_acc5, A
   524            C                DJZ     reg_acc
   525            C                JMP     $Bcd_Bin1
   526            C                JMP     $Bcd_Bin2
   527            C        $Binadj:
   528            C                MOV     reg_accd, A
   529            C                JBC     reg_accd, 3
   530            C                ADD     A, @253
   531            C                JBC     reg_accd, 7
   532            C                ADD     A, @208
   533            C                RET
   534            C        $Bcd_Bin2:
   535            C                ENDM
   536            C        
   537            C        
   538            C        ;*****************************************************************
   539            C        ;Function:    Subtration
   540            C        ;Input:       reg_acc2, reg_acc1, reg_acc3
   541            C        ;Output:      reg_acc2, reg_acc1
   542            C        ;description: reg_acc2/reg_acc1 is the reslut;
   543            C        ;             reg_acc3 is a symbol:
   544            C        ;             0X00 Mean reslut is plus
   545            C        ;             0X01 Mean reslut is negative
   546            C        ;*****************************************************************
   547            C        mSubtration2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   548            C                BC      STATUS,C
   549            C                MOV     A,reg_acc3
   550            C                SUB     reg_acc1,A
   551            C                JBC     STATUS,C
   552            C                JMP     Subtration_End
   553            C                CLR     reg_acc3
   554            C                MOV     A,@0X01
   555            C                SUB     A,reg_acc2
   556            C                JBC     STATUS,C
   557            C                DEC     reg_acc2
   558            C                JBC     STATUS,C
   559            C                INC     reg_acc3
   560            C          Subtration_End:
   561            C                ENDM
   562            C        
   563            C        ;**********************************************************************;
   564            C        ; Title:        Division 8 bits /8 bits -> 8 bit --8 bits              ;
   565            C        ; Description:  reg_acc1/reg_acc2->reg_acc1 --reg_acc2                 ;
   566            C        ; Input:        Dividend reg_acc1        Divisor    reg_acc2           ;
   567            C        ; Output:       Result   reg_acc1        Remainder  reg_acc2           ;
   568            C        ; Variable Register:None                                               ;
   569            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   570            C        ;**********************************************************************;
   571            C        mDIV1_1 MACRO reg_acc1, reg_acc2
   572            C        ;
   573            C                MOV     A, @8           ;Recurrence Cortrol Data
   574            C                MOV     reg_acc, A
   575            C                CLRA                    ;Check Divisor Is Zero
   576            C                OR      A, reg_acc2     ;Divisor load into A register
   577            C                JBC     STATUS, 2
   578            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   579            C                CLR     reg_acc2        ;Divisor Is Not Zero, Begin PerationThen A=1
   580            C        $_Div_Sub:
   581            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   582            C                RLC     reg_acc2
   583            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   584            C                SUB     reg_acc2, a
   585            C                JBC     STATUS, C
   586            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   587            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   588            C                ADD     reg_acc2, A     ;Revert Dividend
   589            C        $_Div_Cnt:
   590            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   591            C                JMP     $_Div_Sub
   592            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   593            C        $_Div_Out:
   594            C                ENDM
   595            C        ;
   596            C        ;**********************************************************************;
   597            C        ; Title:        Division 16 bits /8 bits -> 16 bit --8 bits            ;
   598            C        ; Description:  (reg_acc2,reg_acc1)/reg_acc3                           ;
   599            C        ;               ->(reg_acc2,reg_acc1)--reg_acc3                        ;
   600            C        ; Input:        Dividend reg_acc2,reg_acc1       Divisor    reg_acc3   ;
   601            C        ; Output:       Result   reg_acc2,reg_acc1       Remainder  reg_acc3   ;
   602            C        ; Variable Register:None                                               ;
   603            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   604            C        ;**********************************************************************;
   605            C        ;
   606            C        mDIV2_1 MACRO reg_acc2, reg_acc1, reg_acc3
   607            C        ;
   608            C                MOV     A, @16          ;Recurrence Cortrol Data
   609            C                MOV     reg_acc, A
   610            C                CLRA                    ;Check Divisor Is Zero
   611            C                OR      A, reg_acc3     ;Divisor load into A register
   612            C                JBC     STATUS, Z
   613            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   614            C                CLR     reg_acc3        ;Divisor Is Not Zero, Begin PerationThen A=1
   615            C        $_Div_Sub:
   616            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   617            C                RLC     reg_acc2
   618            C                RLC     reg_acc3
   619            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   620            C                JBS     STATUS, C
   621            C                JMP     $_Div_S_0
   622            C                SUB     reg_acc3, A
   623            C                JMP     $_Div_Cnt
   624            C        $_Div_S_0:
   625            C                SUB     reg_acc3, A
   626            C                JBC     STATUS, C
   627            C                JMP     $_Div_Cnt
   628            C                BC      reg_acc1, 0
   629            C                ADD     reg_acc3, A
   630            C        $_Div_Cnt:
   631            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   632            C                JMP     $_Div_Sub
   633            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   634            C        $_Div_Out:
   635            C                ENDM
   636            C        ;
   637            C        ;**********************************************************************;
   638            C        ; Title:        Division 16 bits /16 bits -> 16 bit --16 bits          ;
   639            C        ; Description:  (reg_acc2, reg_acc1)/(reg_acc4, reg_acc3)              ;
   640            C        ;               ->(reg_acc2, reg_acc1)--(reg_acc4, reg_acc3)           ;
   641            C        ; Input:        Dividend reg_acc2,reg_acc1 Divisor   reg_acc4,reg_acc3 ;
   642            C        ; Output:       Result   reg_acc2,reg_acc1 Remainder reg_acc4,reg_acc3 ;
   643            C        ; Variable Register:None                                               ;
   644            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   645            C        ;                   , reg_acc5(0x025), reg_acc6(0x26)                  ;
   646            C        ;**********************************************************************;
   647            C        ;
   648            C        mDIV2_2 MACRO reg_acc2, reg_acc1, reg_acc4, reg_acc3
   649            C        ;
   650            C                CLRA
   651            C                OR      A, reg_acc3     ;Check Divisor Is Zero
   652            C                OR      A, reg_acc4
   653            C                JBC     STATUS, Z
   654            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   655            C                MOV     A, @16          ;Recurrence Cortrol Data
   656            C                MOV     reg_acc, A
   657            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1
   658            C                CLR     reg_acc6
   659            C        $_Div_Sub:
   660            C                BC      STATUS, C       ;Clear c Flag
   661            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   662            C                RLC     reg_acc2
   663            C                RLC     reg_acc5
   664            C                RLC     reg_acc6
   665            C                MOV     A, reg_acc4     ;Check If Dividend > Divisor
   666            C                SUB     A, reg_acc6     ;Check High Word  Equal
   667            C                JBS     STATUS, Z
   668            C                JMP     $_Div_Set
   669            C                MOV     A, reg_acc3     ;High Word Equal Then Check  Low Word
   670            C                SUB     A, reg_acc5
   671            C        $_Div_Set:
   672            C                JBS     STATUS, C
   673            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   674            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   675            C                MOV     A, reg_acc3     ;Dividend-Divisor, From Low Word To High Word.
   676            C                SUB     reg_acc5, A     ;Save Diviso
   677            C                JBS     STATUS, C
   678            C                DEC     reg_acc6        ;If Low Word < High Word, Next High Word Sub 1.
   679            C                MOV     A, reg_acc4
   680            C                SUB     reg_acc6, A
   681            C        $_Div_S_0:
   682            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   683            C                JMP     $_Div_Sub
   684            C                MOV     A, reg_acc6     ;Save Result Into User's Register.
   685            C                MOV     reg_acc4, A
   686            C                MOV     A, reg_acc5
   687            C                MOV     reg_acc3, A
   688            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   689            C        $_Div_Out:
   690            C                ENDM
   691            C        ;
   692            C        ;**********************************************************************;
   693            C        ; Title:        Division 24 bits /8 bits -> 24 bit --8 bits            ;
   694            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/reg_acc4                ;
   695            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --reg_acc4            ;
   696            C        ; Input:        Dividend reg_acc3,reg_acc2,reg_acc1 Divisor   reg_acc4 ;
   697            C        ; Output:       Result   reg_acc3,reg_acc2,reg_acc1 Remainder reg_acc4 ;
   698            C        ; Variable Register:None                                               ;
   699            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   700            C        ;**********************************************************************;
   701            C        ;
   702            C        mDIV3_1 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc4
   703            C        ;
   704            C                MOV     A, @24          ;Recurrence Cortrol Data
   705            C                MOV     reg_acc, A
   706            C                CLRA                    ;Check Divisor Is Zero
   707            C                OR      A, reg_acc4     ;Divisor load into A register
   708            C                JBC     STATUS, Z
   709            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   710            C                CLR     reg_acc4        ;Divisor Is Not Zero, Begin PerationThen A=1
   711            C        $_Div_Sub:
   712            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   713            C                RLC     reg_acc2
   714            C                RLC     reg_acc3
   715            C                RLC     reg_acc4
   716            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Set 1.
   717            C                JBS     STATUS, C
   718            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   719            C                SUB     reg_acc4, A     ;C Flag Is 1, Quotient Low Bit Set 1
   720            C                JMP     $_Div_Cnt
   721            C        $_Div_S_0:
   722            C                SUB     reg_acc4, A
   723            C                JBC     STATUS, C
   724            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   725            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   726            C                ADD     reg_acc4, A     ;Revert Dividend
   727            C        $_Div_Cnt:
   728            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   729            C                JMP     $_Div_Sub
   730            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   731            C        $_Div_Out:
   732            C                ENDM
   733            C        ;
   734            C        ;**********************************************************************;
   735            C        ; Title:        Division 24 bits /16 bits -> 24 bit --16 bits          ;
   736            C        ; Description:  (reg_acc3, reg_acc2, reg_acc1)/(reg_acc5, reg_acc4)    ;
   737            C        ;               ->(reg_acc3, reg_acc2, reg_acc1) --(reg_acc5, reg_acc4);
   738            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   739            C        ;               Divisor   reg_acc5, reg_acc4                           ;
   740            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   741            C        ;               Remainder reg_acc5, reg_acc4                           ;
   742            C        ; Variable Register: None                                              ;
   743            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc6(0x26) ;
   744            C        ;                   , reg_acc7(0x27)                                   ;
   745            C        ;**********************************************************************;
   746            C        ;
   747            C        mDIV3_2 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc5, reg_acc4
   748            C        ;
   749            C                CLRA
   750            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   751            C                OR      A, reg_acc5
   752            C                JBC     STATUS, Z
   753            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   754            C                MOV     A, @24          ;Recurrence Cortrol Data
   755            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   756            C                CLR     reg_acc6        ;clear Remainder register
   757            C                CLR     reg_acc7
   758            C        $_Div_Sub:
   759            C                BC      STATUS, C       ;Clear c Flag
   760            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   761            C                RLC     reg_acc2
   762            C                RLC     reg_acc3
   763            C                RLC     reg_acc6
   764            C                RLC     reg_acc7
   765            C                JBC     STATUS, C
   766            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   767            C                MOV     A, reg_acc5     ;Check If Dividend > Divisor
   768            C                SUB     A, reg_acc7     ;Check High Word  Equal
   769            C                JBS     STATUS, Z
   770            C                JMP     $_Div_Set
   771            C                MOV     A, reg_acc4     ;High Word Equal Then Check  Low Word
   772            C                SUB     A, reg_acc6
   773            C        $_Div_Set:
   774            C                JBS     STATUS, C
   775            C                JMP     $_Div_S_0       ;Dividend < Divisor, Quotient Add 0.
   776            C        $_Div_Set_1:
   777            C                BS      reg_acc1, 0     ;Dividend > Divisor, Quotient Add 1.
   778            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   779            C                SUB     reg_acc6, A     ;Save Diviso
   780            C                JBS     STATUS, C
   781            C                DEC     reg_acc7        ;If Low Word < High Word, Next High Word Sub 1.
   782            C                MOV     A, reg_acc5
   783            C                SUB     reg_acc7, A
   784            C        $_Div_S_0:
   785            C                DJZ     reg_acc         ;If Finish Shift, SetA=1 Exit
   786            C                JMP     $_Div_Sub
   787            C                MOV     A, reg_acc7     ;Save Result Into User's Register.
   788            C                MOV     reg_acc5, A
   789            C                MOV     A, reg_acc6
   790            C                MOV     reg_acc4, A
   791            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   792            C        $_Div_Out:
   793            C                ENDM
   794            C        ;
   795            C        ;**********************************************************************;
   796            C        ; Title:        Division 24 bits /24 bits -> 24 bit --24 bits          ;
   797            C        ; Description:  (reg_acc3,reg_acc2,reg_acc1)/                          ;
   798            C        ;               (reg_acc6,reg_acc5,reg_acc4)                           ;
   799            C        ;               ->(reg_acc3,reg_acc2,reg_acc1)                         ;
   800            C        ;               --(reg_acc6,reg_acc5,reg_acc4)                         ;
   801            C        ; Input:        Dividend  reg_acc3 reg_acc2 reg_acc1                   ;
   802            C        ;               Divisor   reg_acc6 reg_acc5, reg_acc4                  ;
   803            C        ; Output:       Result    reg_acc3 reg_acc2 reg_acc1                   ;
   804            C        ;               Remainder reg_acc6, reg_acc5, reg_acc4                 ;
   805            C        ; Variable Register:None                                               ;
   806            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   807            C        ;                   , reg_acc8(0x28),  reg_acc9(0x29)                  ;
   808            C        ;**********************************************************************;
   809            C        ;
   810            C        mDIV3_3 MACRO reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5, reg_acc4
   811            C        ;
   812            C                CLRA
   813            C                OR      A, reg_acc4     ;Check Divisor Is Zero
   814            C                OR      A, reg_acc5
   815            C                OR      A, reg_acc6
   816            C                JBC     STATUS, Z
   817            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   818            C                MOV     A, @24          ;Recurrence Cortrol Data
   819            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   820            C                CLR     reg_acc7        ;clear Remainder register
   821            C                CLR     reg_acc8
   822            C                CLR     reg_acc9
   823            C        $_Div_Sub:
   824            C                BC      STATUS, C       ;Clear c Flag
   825            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   826            C                RLC     reg_acc2
   827            C                RLC     reg_acc3
   828            C                RLC     reg_acc7
   829            C                RLC     reg_acc8
   830            C                RLC     reg_acc9
   831            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   832            C                SUB     A, reg_acc9     ;Check High Word  Equal
   833            C                JBS     STATUS, Z
   834            C                JMP     $_Div_Set
   835            C                MOV     A, reg_acc5     ;High Word Equal Then Check  Low Word
   836            C                SUB     A, reg_acc8
   837            C                JBS     STATUS, Z
   838            C                JMP     $_Div_Set
   839            C                MOV     A, reg_acc4
   840            C                SUB     A, reg_acc7
   841            C        $_Div_Set:
   842            C                JBS     STATUS, C
   843            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   844            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   845            C                MOV     A, reg_acc4     ;Dividend-Divisor, From Low Word To High Word.
   846            C                SUB     reg_acc7, A     ;Save Diviso
   847            C                JBS     STATUS, C
   848            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   849            C                MOV     A, reg_acc5
   850            C                SUB     reg_acc8, A
   851            C                JBS     STATUS, C
   852            C                DEC     reg_acc9
   853            C                MOV     A, reg_acc6
   854            C                SUB     reg_acc9, A
   855            C        $_Div_S_0:
   856            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   857            C                JMP     $_Div_Sub
   858            C                MOV     A, reg_acc9     ;Save Result Into User's Register.
   859            C                MOV     reg_acc6, A
   860            C                MOV     A, reg_acc8
   861            C                MOV     reg_acc5, A
   862            C                MOV     A, reg_acc7
   863            C                MOV     reg_acc4, A
   864            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   865            C        $_Div_Out:
   866            C                ENDM
   867            C        ;
   868            C        ;**********************************************************************;
   869            C        ; Title:        Division 32 bits /8 bits -> 32 bit --8 bits            ;
   870            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/reg_acc5      ;
   871            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1) --reg_acc5  ;
   872            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   873            C        ;               Divisor   reg_acc5                                     ;
   874            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   875            C        ;               Remainder reg_acc5                                     ;
   876            C        ; Variable Register:None                                               ;
   877            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20)                 ;
   878            C        ;**********************************************************************;
   879            C        ;
   880            C        mDIV4_1 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc5
   881            C        ;
   882            C                MOV     A, @32          ;Recurrence Cortrol Data
   883            C                MOV     reg_acc, A
   884            C                CLRA                    ;Check Divisor Is Zero
   885            C                OR      A, reg_acc5     ;Divisor load into A register
   886            C                JBC     STATUS, Z
   887            C                JMP     $_Div_Out       ;Divisor Is Zero, A=0Exit Peration.
   888            C                CLR     reg_acc5        ;Divisor Is Not Zero, Begin PerationThen A=1.
   889            C        $_Div_Sub:
   890            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   891            C                RLC     reg_acc2
   892            C                RLC     reg_acc3
   893            C                RLC     reg_acc4
   894            C                RLC     reg_acc5
   895            C                BS      reg_acc1, 0     ;Before Check Dividend > Divisor,  Quotient Low Bit _Div_Set 1.
   896            C                JBS     STATUS, C
   897            C                JMP     $_Div_S_0       ;C Flag Is 0, Check Dividend > Divisor
   898            C                SUB     reg_acc5, A     ;C Flag Is 1, Quotient Low Bit Set 1
   899            C                JMP     $_Div_Cnt
   900            C        $_Div_S_0:
   901            C                SUB     reg_acc5, A
   902            C                JBC     STATUS, C
   903            C                JMP     $_Div_Cnt       ;Dividend > Divisor
   904            C                BC      reg_acc1, 0     ;Dividend < Divisor, Quotient low bit clear 0.
   905            C                ADD     reg_acc5, A     ;Revert Dividend
   906            C        $_Div_Cnt:
   907            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   908            C                JMP     $_Div_Sub
   909            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   910            C        $_Div_Out:
   911            C                ENDM
   912            C        ;
   913            C        ;**********************************************************************;
   914            C        ; Title:        Division 32 bits /16 bits -> 32 bit --16 bits          ;
   915            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   916            C        ;               (reg_acc6, reg_acc5)                                   ;
   917            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   918            C        ;               --(reg_acc6, reg_acc5)                                 ;
   919            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   920            C        ;               Divisor   reg_acc6 reg_acc5                            ;
   921            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   922            C        ;               Remainder reg_acc6, reg_acc5                           ;
   923            C        ; Variable Register:None                                               ;
   924            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc7(x027) ;
   925            C        ;                   , reg_acc8(0x28)                                   ;
   926            C        ;**********************************************************************;
   927            C        ;
   928            C        mDIV4_2 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc6, reg_acc5
   929            C        ;
   930            C                CLRA
   931            C                OR      A, reg_acc6     ;Check Divisor Is Zero
   932            C                OR      A, reg_acc5
   933            C                JBC     STATUS, Z
   934            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
   935            C                MOV     A, @32          ;Recurrence Cortrol Data
   936            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
   937            C                CLR     reg_acc7        ;clear Remainder register
   938            C                CLR     reg_acc8
   939            C        $_Div_Sub:
   940            C                BC      STATUS, C       ;Clear c Flag
   941            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
   942            C                RLC     reg_acc2
   943            C                RLC     reg_acc3
   944            C                RLC     reg_acc4
   945            C                RLC     reg_acc7
   946            C                RLC     reg_acc8
   947            C                JBC     STATUS, C
   948            C                JMP     $_Div_Set_1     ;C Flag Is 1, Quotient Low Bit Set 1
   949            C                MOV     A, reg_acc6     ;Check If Dividend > Divisor
   950            C                SUB     A, reg_acc8     ;Check High Word  Equal
   951            C                JBS     STATUS, Z
   952            C                JMP     $_Div_Set
   953            C                MOV     A, reg_acc5     ;if High Word Equal Then Check  Low Word
   954            C                SUB     A, reg_acc7
   955            C        $_Div_Set:
   956            C                JBS     STATUS, C
   957            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
   958            C        $_Div_Set_1:
   959            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
   960            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
   961            C                SUB     reg_acc7, A     ;Save Divisor
   962            C                JBS     STATUS, C
   963            C                DEC     reg_acc8        ;If Low Word < High Word, Next High Word Sub 1.
   964            C                MOV     A, reg_acc6
   965            C                SUB     reg_acc8, A
   966            C        $_Div_S_0:
   967            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
   968            C                JMP     $_Div_Sub
   969            C                MOV     A, reg_acc8     ;Save Result Into User's Register.
   970            C                MOV     reg_acc6, A
   971            C                MOV     A, reg_acc7
   972            C                MOV     reg_acc5, A
   973            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
   974            C        $_Div_Out:
   975            C                ENDM
   976            C        ;
   977            C        ;**********************************************************************;
   978            C        ; Title:        Division 32 bits /24 bits -> 32 bit --24 bits          ;
   979            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
   980            C        ;               (reg_acc7, reg_acc6, reg_acc5)                         ;
   981            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
   982            C        ;               --(reg_acc7, reg_acc6, reg_acc5)                       ;
   983            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
   984            C        ;               Divisor   reg_acc7 reg_acc6 reg_acc5                   ;
   985            C        ; Output:       Result    reg_acc4, reg_acc3 reg_acc2 reg_acc1         ;
   986            C        ;               Remainder reg_acc7 reg_acc6, reg_acc5                  ;
   987            C        ; Variable Register:None                                               ;
   988            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc8(x028) ;
   989            C        ;                   , reg_acc9(0x29) , reg_acca(0x2a)                  ;
   990            C        ;**********************************************************************;
   991            C        ;
   992            C        mDIV4_3 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc7, reg_acc6, reg_acc5
   993            C        ;
   994            C                CLRA
   995            C                OR      A, reg_acc7     ;Check Divisor Is Zero
   996            C                OR      A, reg_acc6
   997            C                OR      A, reg_acc5
   998            C                JBC     STATUS, Z
   999            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1000            C                MOV     A, @32          ;Recurrence Cortrol Data
  1001            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1002            C                CLR     reg_acc8        ;clear Remainder register
  1003            C                CLR     reg_acc9
  1004            C                CLR     reg_acca
  1005            C        $_Div_Sub:
  1006            C                BC      STATUS, 0       ;Clear c Flag
  1007            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1008            C                RLC     reg_acc2
  1009            C                RLC     reg_acc3
  1010            C                RLC     reg_acc4
  1011            C                RLC     reg_acc8
  1012            C                RLC     reg_acc9
  1013            C                RLC     reg_acca
  1014            C                JBC     STATUS, C       ;C Flag Is 1, Quotient Low Bit Set 1
  1015            C                JMP     $_Div_Set_1
  1016            C                MOV     A, reg_acc7     ;Check If Dividend > Divisor
  1017            C                SUB     A, reg_acca     ;Check High Word  Equal
  1018            C                JBS     STATUS, Z
  1019            C                JMP     $_Div_Set
  1020            C                MOV     A, reg_acc6     ;if High Word Equal Then Check  Low Word
  1021            C                SUB     A, reg_acc9
  1022            C                JBS     STATUS, Z
  1023            C                JMP     $_Div_Set
  1024            C                MOV     A, reg_acc5
  1025            C                SUB     A, reg_acc8
  1026            C        $_Div_Set:
  1027            C                JBS     STATUS, C
  1028            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1029            C        $_Div_Set_1:
  1030            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1031            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1032            C                SUB     reg_acc8, A     ;Save Divisor
  1033            C                JBS     STATUS, C
  1034            C                DEC     reg_acc9        ;If Low Word < High Word, Next High Word Sub 1.
  1035            C                MOV     A, reg_acc6
  1036            C                SUB     reg_acc9, A
  1037            C                JBS     STATUS, C
  1038            C                DEC     reg_acca
  1039            C                MOV     A, reg_acc7
  1040            C                SUB     reg_acca, A
  1041            C        $_Div_S_0:
  1042            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1043            C                JMP     $_Div_Sub
  1044            C                MOV     A, reg_acca     ;Save Result Into User's Register.
  1045            C                MOV     reg_acc7, A
  1046            C                MOV     A, reg_acc9
  1047            C                MOV     reg_acc6, A
  1048            C                MOV     A, reg_acc8
  1049            C                MOV     reg_acc5, A
  1050            C                MOV     A, @1           ;Finish Peration, A Register Return 1
  1051            C        $_Div_Out:
  1052            C                ENDM
  1053            C        ;
  1054            C        ;**********************************************************************;
  1055            C        ; Title:        Division 32 bits /32 bits -> 32 bit --32 bits          ;
  1056            C        ; Description:  (reg_acc4, reg_acc3, reg_acc2, reg_acc1)/              ;
  1057            C        ;               (reg_acc8, reg_acc7, reg_acc6, reg_acc5)               ;
  1058            C        ;               ->(reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1059            C        ;               --(reg_acc8, reg_acc7, reg_acc6, reg_acc5)             ;
  1060            C        ; Input:        Dividend  reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1061            C        ;               Divisor   reg_acc8 reg_acc7 reg_acc6 reg_acc5          ;
  1062            C        ; Output:       Result    reg_acc4 reg_acc3 reg_acc2 reg_acc1          ;
  1063            C        ;               Remainder reg_acc8 reg_acc7 reg_acc6, reg_acc5         ;
  1064            C        ; Variable Register:None                                               ;
  1065            C        ; Register Changed: STATUS, ACC, reg_acc(address 0x20), reg_acc9(x029) ;
  1066            C        ;                   , reg_acca(0x2a) , reg_accb(0x2b) , reg_accc(0x2c) ;
  1067            C        ;**********************************************************************;
  1068            C        ;
  1069            C        mDIV4_4 MACRO reg_acc4, reg_acc3, reg_acc2, reg_acc1, reg_acc8, reg_acc7, reg_acc6, reg_acc5
  1070            C        ;
  1071            C                CLRA
  1072            C                OR      A, reg_acc8     ;Check Divisor Is Zero
  1073            C                OR      A, reg_acc7
  1074            C                OR      A, reg_acc6
  1075            C                OR      A, reg_acc5
  1076            C                JBC     STATUS, Z
  1077            C                JMP     $_Div_Out       ;If Divisor Is Zero, A=0Exit Peration.
  1078            C                MOV     A, @32          ;Recurrence Cortrol Data
  1079            C                MOV     reg_acc, A      ;Divisor Is Not Zero, Begin PerationThen A=1.
  1080            C                CLR     reg_acc9        ;clear Remainder register
  1081            C                CLR     reg_acca
  1082            C                CLR     reg_accb
  1083            C                CLR     reg_accc
  1084            C        $_Div_Sub:
  1085            C                BC      STATUS, C       ;Clear c Flag
  1086            C                RLC     reg_acc1        ;Dividend Left Shift 1Bit
  1087            C                RLC     reg_acc2
  1088            C                RLC     reg_acc3
  1089            C                RLC     reg_acc4
  1090            C                RLC     reg_acc9
  1091            C                RLC     reg_acca
  1092            C                RLC     reg_accb
  1093            C                RLC     reg_accc
  1094            C                MOV     A, reg_acc8     ;Check If Dividend > Divisor
  1095            C                SUB     A, reg_accc     ;Check High Word  Equal
  1096            C                JBS     STATUS, Z
  1097            C                JMP     $_Div_Set
  1098            C                MOV     A, reg_acc7     ;if High Word Equal Then Check  Low Word
  1099            C                SUB     A, reg_accb
  1100            C                JBS     STATUS, Z
  1101            C                JMP     $_Div_Set
  1102            C                MOV     A, reg_acc6
  1103            C                SUB     A, reg_acca
  1104            C                JBS     STATUS, Z
  1105            C                JMP     $_Div_Set
  1106            C                MOV     A, reg_acc5
  1107            C                SUB     A, reg_acc9
  1108            C        $_Div_Set:
  1109            C                JBS     STATUS, C
  1110            C                JMP     $_Div_S_0       ;If Dividend < Divisor, Quotient Add 0.
  1111            C                BS      reg_acc1, 0     ;If Dividend > Divisor, Quotient Add 1.
  1112            C                MOV     A, reg_acc5     ;Dividend-Divisor, From Low Word To High Word.
  1113            C                SUB     reg_acc9, A     ;Save Divisor
  1114            C                JBS     STATUS, C
  1115            C                DEC     reg_acca        ;If Low Word < High Word, Next High Word Sub 1.
  1116            C                MOV     A, reg_acc6
  1117            C                SUB     reg_acca, A
  1118            C                JBS     STATUS, C
  1119            C                DEC     reg_accb
  1120            C                MOV     A, reg_acc7
  1121            C                SUB     reg_accb, A
  1122            C                JBS     STATUS, C
  1123            C                DEC     reg_accc
  1124            C                MOV     A, reg_acc8
  1125            C                SUB     reg_accc, A
  1126            C        $_Div_S_0:
  1127            C                DJZ     reg_acc         ;If Finish Shift, Set A=1 Exit
  1128            C                JMP     $_Div_Sub
  1129            C                MOV     A, reg_accc     ;Save Result Into User's Register.
  1130            C                MOV     reg_acc8, A
  1131            C                MOV     A, reg_accb
  1132            C                MOV     reg_acc7, A
  1133            C                MOV     A, reg_acca
  1134            C                MOV     reg_acc6, A
  1135            C                MOV     A, reg_acc9
  1136            C                MOV     reg_acc5, A
  1137            C                MOV     A, @1           ;Finish Peration ,  A Register Return 1
  1138            C        $_Div_Out:
  1139            C                ENDM
  1140            C        ;
  1141            C        ;**********************************************************************;
  1142            C        ; Title:          (1 byte) * (1 byte) operation                        ;
  1143            C        ; Description:    reg_acc2 * reg_acc1 = (reg_acc2, reg_acc1)           ;
  1144            C        ; Input:          reg_acc1, reg_acc2                                   ;
  1145            C        ; Output:         reg_acc1, reg_acc2                                   ;
  1146            C        ; Register change:reg_acc                                              ;
  1147            C        ;**********************************************************************;
  1148            C        ;
  1149            C        mMUL1_1 MACRO   reg_acc2, reg_acc1
  1150            C        ;
  1151            C                MOV     A, @8
  1152            C                MOV     reg_acc, A
  1153            C                MOV     A, reg_acc2
  1154            C                CLR     reg_acc2
  1155            C        $Mul11_Loop:
  1156            C                BC      STATUS, C
  1157            C                JBC     reg_acc1, 0
  1158            C                ADD     reg_acc2, A
  1159            C                RRC     reg_acc2
  1160            C                RRC     reg_acc1
  1161            C        ;
  1162            C                DJZ     reg_acc
  1163            C                JMP     $Mul11_Loop
  1164            C                ENDM
  1165            C        ;
  1166            C        ;**********************************************************************;
  1167            C        ; Title:          (1 byte) * (2 bytes) operation                       ;
  1168            C        ; Description:    reg_acc3 * (reg_acc2, reg_acc1)                      ;
  1169            C        ;                 = (reg_acc3, reg_acc2, reg_acc1)                     ;
  1170            C        ; Input:          reg_acc1, reg_acc2, reg_acc3                         ;
  1171            C        ; Output:         reg_acc1, reg_acc2, reg_acc3                         ;
  1172            C        ; Register change:reg_acc                                              ;
  1173            C        ;**********************************************************************;
  1174            C        ;
  1175            C        mMUL1_2 MACRO   reg_acc3, reg_acc2, reg_acc1
  1176            C        ;
  1177            C                MOV     A, @16
  1178            C                MOV     reg_acc, A
  1179            C                MOV     A, reg_acc3
  1180            C                CLR     reg_acc3
  1181            C        $Mul12_Loop:
  1182            C                BC      STATUS, C
  1183            C                JBC     reg_acc1, 0
  1184            C                ADD     reg_acc3, A
  1185            C                RRC     reg_acc3
  1186            C                RRC     reg_acc2
  1187            C                RRC     reg_acc1
  1188            C        ;
  1189            C                DJZ     reg_acc
  1190            C                JMP     $Mul12_Loop
  1191            C                ENDM
  1192            C        ;
  1193            C        ;**********************************************************************;
  1194            C        ; Title:          (1 byte) * (3 bytes) operation                       ;
  1195            C        ; Description:    reg_acc4 * (reg_acc3, reg_acc2, reg_acc1)            ;
  1196            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1197            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1198            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1199            C        ; Register change:reg_acc                                              ;
  1200            C        ;**********************************************************************;
  1201            C        ;
  1202            C        mMUL1_3 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1203            C        ;
  1204            C                MOV     A, @24
  1205            C                MOV     reg_acc, A
  1206            C                MOV     A, reg_acc4
  1207            C                CLR     reg_acc4
  1208            C        $Mul13_Loop:
  1209            C                BC      STATUS, C
  1210            C                JBC     reg_acc1, 0
  1211            C                ADD     reg_acc4, A
  1212            C                RRC     reg_acc4
  1213            C                RRC     reg_acc3
  1214            C                RRC     reg_acc2
  1215            C                RRC     reg_acc1
  1216            C        ;
  1217            C                DJZ     reg_acc
  1218            C                JMP     $Mul13_Loop
  1219            C                ENDM
  1220            C        ;
  1221            C        ;**********************************************************************;
  1222            C        ; Title:          (1 byte) * (4 bytes) operation                       ;
  1223            C        ; Description:    reg_acc5 * (reg_acc4, reg_acc3, reg_acc2, reg_acc1)  ;
  1224            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1225            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1226            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1227            C        ; Register change:reg_acc                                              ;
  1228            C        ;**********************************************************************;
  1229            C        ;
  1230            C        mMUL1_4  MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1231            C        ;
  1232            C                MOV     A, @32
  1233            C                MOV     reg_acc, A
  1234            C                MOV     A, reg_acc5
  1235            C                CLR     reg_acc5
  1236            C        $Mul14_Loop:
  1237            C                BC      STATUS, C
  1238            C                JBC     reg_acc1, 0
  1239            C                ADD     reg_acc5, A
  1240            C                RRC     reg_acc5
  1241            C                RRC     reg_acc4
  1242            C                RRC     reg_acc3
  1243            C                RRC     reg_acc2
  1244            C                RRC     reg_acc1
  1245            C        ;
  1246            C                DJZ     reg_acc
  1247            C                JMP     $Mul14_Loop
  1248            C                ENDM
  1249            C        ;
  1250            C        ;**********************************************************************;
  1251            C        ; Title:          (2 bytes) * (2 bytes) operation                      ;
  1252            C        ; Description:    (reg_acc4, reg_acc3) * (reg_acc2, reg_acc1)          ;
  1253            C        ;                 = (reg_acc4, reg_acc3, reg_acc2, reg_acc1)           ;
  1254            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1255            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4               ;
  1256            C        ; Register change:reg_acc, reg_acc5, reg_acc6                          ;
  1257            C        ;**********************************************************************;
  1258            C        ;
  1259            C        mMUL2_2 MACRO   reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1260            C        ;
  1261            C                MOV     A, @16
  1262            C                MOV     reg_acc, A
  1263            C                MOV     A, reg_acc4
  1264            C                MOV     reg_acc6, A
  1265            C                MOV     A, reg_acc3
  1266            C                MOV     reg_acc5, A
  1267            C                CLR     reg_acc3
  1268            C                CLR     reg_acc4
  1269            C        $Mul22_Loop:
  1270            C                BC      STATUS, C
  1271            C                JBS     reg_acc1, 0
  1272            C                JMP     $Mul22_Rs
  1273            C                MOV     A, reg_acc5
  1274            C                ADD     reg_acc3, A
  1275            C        ;--------------------------------------
  1276            C                MOV     A, reg_acc4
  1277            C                JBC     STATUS, C
  1278            C                ADD     A, @1
  1279            C                RLC     reg_acc
  1280            C                ADD     A, reg_acc6
  1281            C                MOV     reg_acc4, A
  1282            C                JBC     STATUS, C
  1283            C                BS      reg_acc, 0
  1284            C                RRC     reg_acc
  1285            C        $Mul22_Rs:
  1286            C                RRC     reg_acc4
  1287            C                RRC     reg_acc3
  1288            C                RRC     reg_acc2
  1289            C                RRC     reg_acc1
  1290            C        ;
  1291            C                BC      reg_acc, 7
  1292            C                DJZ     reg_acc
  1293            C                JMP     $Mul22_Loop
  1294            C                ENDM
  1295            C        ;
  1296            C        ;**********************************************************************;
  1297            C        ; Title:          (2 bytes) * (3 bytes) operation                      ;
  1298            C        ; Description:    (reg_acc5, reg_acc4) * (reg_acc3, reg_acc2, reg_acc1);
  1299            C        ;                 = (reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1) ;
  1300            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1301            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1302            C        ; Register change:reg_acc, reg_acc6, reg_acc7                          ;
  1303            C        ;**********************************************************************;
  1304            C        ;
  1305            C        mMUL2_3 MACRO   reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1306            C        ;
  1307            C                MOV     A, @24
  1308            C                MOV     reg_acc, A
  1309            C                MOV     A, reg_acc5
  1310            C                MOV     reg_acc7, A
  1311            C                MOV     A, reg_acc4
  1312            C                MOV     reg_acc6, A
  1313            C                CLR     reg_acc4
  1314            C                CLR     reg_acc5
  1315            C        $Mul23_Loop:
  1316            C                BC      STATUS, C
  1317            C                JBS     reg_acc1, 0
  1318            C                JMP     $Mul23_Rs
  1319            C                MOV     A, reg_acc6
  1320            C                ADD     reg_acc4, A
  1321            C        ;--------------------------------------
  1322            C                MOV     A, reg_acc5
  1323            C                JBC     STATUS, C
  1324            C                ADD     A, @1
  1325            C                RLC     reg_acc
  1326            C                ADD     A, reg_acc7
  1327            C                MOV     reg_acc5, A
  1328            C                JBC     STATUS, C
  1329            C                BS      reg_acc, 0
  1330            C                RRC     reg_acc
  1331            C        $Mul23_Rs:
  1332            C                RRC     reg_acc5
  1333            C                RRC     reg_acc4
  1334            C                RRC     reg_acc3
  1335            C                RRC     reg_acc2
  1336            C                RRC     reg_acc1
  1337            C        ;
  1338            C                BC      reg_acc, 7
  1339            C                DJZ     reg_acc
  1340            C                JMP     $Mul23_Loop
  1341            C                ENDM
  1342            C        ;
  1343            C        ;**********************************************************************;
  1344            C        ; Title:          (2 bytes) * (4 bytes) operation                      ;
  1345            C        ; Description:    (reg_acc6, reg_acc5) * (reg_acc4, reg_acc3, reg_acc2 ;
  1346            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1347            C        ;                 , reg_acc2, reg_acc1)                                ;
  1348            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1349            C        ;                 reg_acc6                                             ;
  1350            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5,    ;
  1351            C        ;                 reg_acc6                                             ;
  1352            C        ; Register change:reg_acc, reg_acc7, reg_acc8                          ;
  1353            C        ;**********************************************************************;
  1354            C        ;
  1355            C        mMUL2_4 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1356            C        ;
  1357            C                MOV     A, @32
  1358            C                MOV     reg_acc, A
  1359            C                MOV     A, reg_acc6
  1360            C                MOV     reg_acc8, A
  1361            C                MOV     A, reg_acc5
  1362            C                MOV     reg_acc7, A
  1363            C                CLR     reg_acc5
  1364            C                CLR     reg_acc6
  1365            C        $Mul24_Loop:
  1366            C                BC      STATUS, C
  1367            C                JBS     reg_acc1, 0
  1368            C                JMP     $Mul24_Rs
  1369            C                MOV     A, reg_acc7
  1370            C                ADD     reg_acc5, A
  1371            C        ;--------------------------------------
  1372            C                MOV     A, reg_acc6
  1373            C                JBC     STATUS, C
  1374            C                ADD     A, @1
  1375            C                RLC     reg_acc
  1376            C                ADD     A, reg_acc8
  1377            C                MOV     reg_acc6, A
  1378            C                JBC     STATUS, C
  1379            C                BS      reg_acc, 0
  1380            C                RRC     reg_acc
  1381            C        $Mul24_Rs:
  1382            C                RRC     reg_acc6
  1383            C                RRC     reg_acc5
  1384            C                RRC     reg_acc4
  1385            C                RRC     reg_acc3
  1386            C                RRC     reg_acc2
  1387            C                RRC     reg_acc1
  1388            C        ;
  1389            C                BC      reg_acc, 7
  1390            C                DJZ     reg_acc
  1391            C                JMP     $Mul24_Loop
  1392            C                ENDM
  1393            C        ;
  1394            C        ;**********************************************************************;
  1395            C        ; Title:          (3 bytes) * (3 bytes) operation                      ;
  1396            C        ; Description:    (reg_acc6, reg_acc5, reg_acc4) * (reg_acc3, reg_acc2 ;
  1397            C        ;                 , reg_acc1) = (reg_acc6, reg_acc5, reg_acc4, reg_acc3;
  1398            C        ;                 , reg_acc2, reg_acc1)                                ;
  1399            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1400            C        ;                 , reg_acc6                                           ;
  1401            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1402            C        ;                 , reg_acc6                                           ;
  1403            C        ; Register change:reg_acc, reg_acc7, reg_acc8, reg_acc9                ;
  1404            C        ;**********************************************************************;
  1405            C        ;
  1406            C        mMUL3_3 MACRO   reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1407            C        ;
  1408            C                MOV     A, @24
  1409            C                MOV     reg_acc, A
  1410            C                MOV     A, reg_acc4
  1411            C                MOV     reg_acc7, A
  1412            C                MOV     A, reg_acc5
  1413            C                MOV     reg_acc8, A
  1414            C                MOV     A, reg_acc6
  1415            C                MOV     reg_acc9, A
  1416            C                CLR     reg_acc4
  1417            C                CLR     reg_acc5
  1418            C                CLR     reg_acc6
  1419            C        $Mul33_Loop:
  1420            C                BC      STATUS, C
  1421            C                JBS     reg_acc1, 0
  1422            C                JMP     $Mul33_Rs
  1423            C                MOV     A, reg_acc7
  1424            C                ADD     reg_acc4, A
  1425            C        ;--------------------------------------
  1426            C                MOV     A, reg_acc5
  1427            C                JBC     STATUS, C
  1428            C                ADD     A, @1
  1429            C                RLC     reg_acc
  1430            C                ADD     A, reg_acc8
  1431            C                MOV     reg_acc5, A
  1432            C                JBC     STATUS, C
  1433            C                BS      reg_acc, 0
  1434            C                RRC     reg_acc
  1435            C        ;--------------------------------------
  1436            C                MOV     A, reg_acc6
  1437            C                JBC     STATUS, C
  1438            C                ADD     A, @1
  1439            C                RLC     reg_acc
  1440            C                ADD     A, reg_acc9
  1441            C                MOV     reg_acc6, A
  1442            C                JBC     STATUS, C
  1443            C                BS      reg_acc, 0
  1444            C                RRC     reg_acc
  1445            C        $Mul33_Rs:
  1446            C                RRC     reg_acc6
  1447            C                RRC     reg_acc5
  1448            C                RRC     reg_acc4
  1449            C                RRC     reg_acc3
  1450            C                RRC     reg_acc2
  1451            C                RRC     reg_acc1
  1452            C        ;
  1453            C                BC      reg_acc, 7
  1454            C                DJZ     reg_acc
  1455            C                JMP     $Mul33_Loop
  1456            C                ENDM
  1457            C        ;
  1458            C        ;**********************************************************************;
  1459            C        ; Title:          (3 bytes) * (4 bytes) operation                      ;
  1460            C        ; Description:    (reg_acc7, reg_acc6, reg_acc5) * (reg_acc4, reg_acc3 ;
  1461            C        ;                 , reg_acc2, reg_acc1) = (reg_acc7, reg_acc6, reg_acc5;
  1462            C        ;                 , reg_acc4, reg_acc3, reg_acc2, reg_acc1)            ;
  1463            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1464            C        ;                 , reg_acc6, reg_acc7                                 ;
  1465            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4, reg_acc5     ;
  1466            C        ;                 , reg_acc6, reg_acc7                                 ;
  1467            C        ; Register change:reg_acc, reg_acc8, reg_acc9, reg_acca                ;
  1468            C        ;**********************************************************************;
  1469            C        ;
  1470            C        mMUL3_4 MACRO   reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1471            C        ;
  1472            C                MOV     A, @32
  1473            C                MOV     reg_acc, A
  1474            C                MOV     A, reg_acc5
  1475            C                MOV     reg_acc8, A
  1476            C                MOV     A, reg_acc6
  1477            C                MOV     reg_acc9, A
  1478            C                MOV     A, reg_acc7
  1479            C                MOV     reg_acca, A
  1480            C                CLR     reg_acc5
  1481            C                CLR     reg_acc6
  1482            C                CLR     reg_acc7
  1483            C        $Mul34_Loop:
  1484            C                BC      STATUS, C
  1485            C                JBS     reg_acc1, 0
  1486            C                JMP     $Mul34_Rs
  1487            C                MOV     A, reg_acc8
  1488            C                ADD     reg_acc5, A
  1489            C        ;--------------------------------------
  1490            C                MOV     A, reg_acc6
  1491            C                JBC     STATUS, C
  1492            C                ADD     A, @1
  1493            C                RLC     reg_acc
  1494            C                ADD     A, reg_acc9
  1495            C                MOV     reg_acc6, A
  1496            C                JBC     STATUS, C
  1497            C                BS      reg_acc, 0
  1498            C                RRC     reg_acc
  1499            C        ;--------------------------------------
  1500            C                MOV     A, reg_acc7
  1501            C                JBC     STATUS, C
  1502            C                ADD     A, @1
  1503            C                RLC     reg_acc
  1504            C                ADD     A, reg_acca
  1505            C                MOV     reg_acc7, A
  1506            C                JBC     STATUS, C
  1507            C                BS      reg_acc, 0
  1508            C                RRC     reg_acc
  1509            C        $Mul34_Rs:
  1510            C                RRC     reg_acc7
  1511            C                RRC     reg_acc6
  1512            C                RRC     reg_acc5
  1513            C                RRC     reg_acc4
  1514            C                RRC     reg_acc3
  1515            C                RRC     reg_acc2
  1516            C                RRC     reg_acc1
  1517            C        ;
  1518            C                BC      reg_acc, 7
  1519            C                DJZ     reg_acc
  1520            C                JMP     $Mul34_Loop
  1521            C                ENDM
  1522            C        ;
  1523            C        ;**********************************************************************;
  1524            C        ; Title:          (4 bytes) * (4 bytes) operation                      ;
  1525            C        ; Description:    (reg_acc8, reg_acc7, reg_acc6, reg_acc5) *           ;
  1526            C        ;                 (reg_acc4, reg_acc3, reg_acc2, reg_acc1)             ;
  1527            C        ;                 = (reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4  ;
  1528            C        ;                 , reg_acc3, reg_acc2, reg_acc1)                      ;
  1529            C        ; Input:          reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1530            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1531            C        ; Output:         reg_acc1, reg_acc2, reg_acc3, reg_acc4,              ;
  1532            C        ;                 reg_acc5, reg_acc6, reg_acc7, reg_acc8               ;
  1533            C        ; Register change:reg_acc, reg_acc9, reg_acca, reg_accb, reg_accc      ;
  1534            C        ;**********************************************************************;
  1535            C        ;
  1536            C        mMUL4_4 MACRO   reg_acc8, reg_acc7, reg_acc6, reg_acc5, reg_acc4, reg_acc3, reg_acc2, reg_acc1
  1537            C        ;
  1538            C                MOV     A, @32
  1539            C                MOV     reg_acc, A
  1540            C                MOV     A, reg_acc5
  1541            C                MOV     reg_acc9, A
  1542            C                MOV     A, reg_acc6
  1543            C                MOV     reg_acca, A
  1544            C                MOV     A, reg_acc7
  1545            C                MOV     reg_accb, A
  1546            C                MOV     A, reg_acc8
  1547            C                MOV     reg_accc, A
  1548            C                CLR     reg_acc5
  1549            C                CLR     reg_acc6
  1550            C                CLR     reg_acc7
  1551            C                CLR     reg_acc8
  1552            C        $Mul44_Loop:
  1553            C                BC      STATUS, C
  1554            C                JBS     reg_acc1, 0
  1555            C                JMP     $Mul44_Rs
  1556            C                MOV     A, reg_acc9
  1557            C                ADD     reg_acc5, A
  1558            C        ;--------------------------------------
  1559            C                MOV     A, reg_acc6
  1560            C                JBC     STATUS, C
  1561            C                ADD     A, @1
  1562            C                RLC     reg_acc
  1563            C                ADD     A, reg_acca
  1564            C                MOV     reg_acc6, A
  1565            C                JBC     STATUS, C
  1566            C                BS      reg_acc, 0
  1567            C                RRC     reg_acc
  1568            C        ;--------------------------------------
  1569            C                MOV     A, reg_acc7
  1570            C                JBC     STATUS, C
  1571            C                ADD     A, @1
  1572            C                RLC     reg_acc
  1573            C                ADD     A, reg_accb
  1574            C                MOV     reg_acc7, A
  1575            C                JBC     STATUS, C
  1576            C                BS      reg_acc, 0
  1577            C                RRC     reg_acc
  1578            C        ;--------------------------------------
  1579            C                MOV     A, reg_acc8
  1580            C                JBC     STATUS, C
  1581            C                ADD     A, @1
  1582            C                RLC     reg_acc
  1583            C                ADD     A, reg_accc
  1584            C                MOV     reg_acc8, A
  1585            C                JBC     STATUS, C
  1586            C                BS      reg_acc, 0
  1587            C                RRC     reg_acc
  1588            C        $Mul44_Rs:
  1589            C                RRC     reg_acc8
  1590            C                RRC     reg_acc7
  1591            C                RRC     reg_acc6
  1592            C                RRC     reg_acc5
  1593            C                RRC     reg_acc4
  1594            C                RRC     reg_acc3
  1595            C                RRC     reg_acc2
  1596            C                RRC     reg_acc1
  1597            C        ;
  1598            C                BC      reg_acc, 7
  1599            C                DJZ     reg_acc
  1600            C                JMP     $Mul44_Loop
  1601            C                ENDM
  1602            C        
  1603            C        
  1604            C        
  1605            C        ;*****************************************************************
  1606            C        ;Function:    generat random data
  1607            C        ;Input:       @banksel,@address,@length
  1608            C        ;Output:      rang by address which is the lowest address
  1609            C        ;description: used common register temp,temp1,temp2 for operation
  1610            C        ;             rand address must be in the same bank
  1611            C        ;             TEMP:  Operate Data TEMP
  1612            C        ;             TEMP1:
  1613            C        ;             TEMP2:
  1614            C        ;*****************************************************************
  1615            C        RAND_FUCTION MACRO @BankSel,Address,@length
  1616            C        	MOV         TEMP,A
  1617            C        	BANK        @BankSel
  1618            C        	MOV         A,Address
  1619            C        	ADD         TEMP,A        ; save latest data as current seed
  1620            C        
  1621            C        	CLR         RSR
  1622            C          $_RAND_SEED_LOOP1:
  1623            C        	MOV         A,R0
  1624            C        	ADD         TEMP,A        ; seed
  1625            C        
  1626            C        	RLC         TEMP          ; x*y+1 MOD z
  1627            C        	RLC         TEMP
  1628            C        	RLC         TEMP
  1629            C        	INC         TEMP
  1630            C        	RRC         TEMP
  1631            C        	RRC         TEMP
  1632            C        	RRC         TEMP
  1633            C        	JBS         STATUS,C
  1634            C        	BC          TEMP,0
  1635            C        	JBC         STATUS,C
  1636            C        	BS          TEMP,0
  1637            C        
  1638            C        	INC         RSR
  1639            C        	MOV         A,RSR
  1640            C        	AND         A,@0X40         ; adding form 0x00 to bank 0
  1641            C        	XOR         A,@0X40
  1642            C        	JBS         STATUS,Z
  1643            C        	JMP         $_RAND_SEED_LOOP1
  1644            C        	MOV         A,R0
  1645            C        	ADD         TEMP,A          ;next seed
  1646            C        
  1647            C        	MOV         A,@length
  1648            C        	MOV         TEMP1,A
  1649            C        	MOV         A,@Address
  1650            C        	MOV         TEMP2,A
  1651            C        	MOV         RSR,A
  1652            C        	BANK        @BankSel
  1653            C        	MOV         A,RSR
  1654            C        	MOV         TEMP2,A       ; save address base
  1655            C        	MESSAGE     "adding form 0x00 to bank 0"
  1656            C        
  1657            C          $_RAND_DATA_LOOP1:
  1658            C        	MOV         A,TEMP2
  1659            C        	MOV         RSR,A
  1660            C        	MOV         A,TEMP
  1661            C        	MOV         R0,A
  1662            C        
  1663            C        	RLC         TEMP          ; X*Y+1 MOD Z
  1664            C        	RLC         TEMP
  1665            C        	RLC         TEMP
  1666            C        	INC         TEMP
  1667            C        	RRC         TEMP
  1668            C        	RRC         TEMP
  1669            C        	RRC         TEMP
  1670            C        	JBS         STATUS,C
  1671            C        	BC          TEMP,0
  1672            C        	JBC         STATUS,C
  1673            C        	BS          TEMP,0
  1674            C        
  1675            C        	INC         TEMP2
  1676            C        	DJZ         TEMP1
  1677            C        	JMP         $_RAND_DATA_LOOP1:
  1678            C        	NOP
  1679            C        
  1680            C          ENDM
  1681            C        
    15                     include "D:\include\EM78xx\inc\EM78CtrlIns.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  EM78CTRLINS.H
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.0
     6            C        * Creat date   :  2009/2
     7            C        * tool ver.    :  WicePlus II/eUIDE
     8            C        * Description  :  instruction aggregate
     9            C        *****************************************************************/
    10            C        ;------------------------------------------------------
    11            C        EM78CtrlIns.H    EQU         EM78CtrlIns.H
    12            C        
    13            C        ;-------------------------------------------------------
    14            C        
    15            C        ;***********************************************************
    16            C        ;sbit operator
    17            C        ;***********************************************************
    18            C        ; reg.bit exchange
    19            C        ;========================================
    20            C        COM MACRO REG,BIT
    21            C        	IF        BIT == 0
    22            C        		MOV        A,@0B00000001
    23            C        		XOR        REG,A
    24            C        	ELSEIF    BIT == 1
    25            C        		MOV        A,@0B00000010
    26            C        		XOR        REG,A
    27            C        	ELSEIF    BIT == 2
    28            C        		MOV        A,@0B00000100
    29            C        		XOR        REG,A
    30            C        	ELSEIF    BIT == 3
    31            C        		MOV        A,@0B00001000
    32            C        		XOR        REG,A
    33            C        	ELSEIF    BIT == 4
    34            C        		MOV        A,@0B00010000
    35            C        		XOR        REG,A
    36            C        	ELSEIF    BIT == 5
    37            C        		MOV        A,@0B00100000
    38            C        		XOR        REG,A
    39            C        	ELSEIF    BIT == 6
    40            C        		MOV        A,@0B01000000
    41            C        		XOR        REG,A
    42            C        	ELSEIF    BIT == 7
    43            C        		MOV        A,@0B10000000
    44            C        		XOR        REG,A
    45            C        	ELSE
    46            C        		MESSAGE    "BIT select ERROR"
    47            C        	ENDIF
    48            C        ENDM
    49            C        
    50            C        ;===============================================
    51            C        ; TO reg.bit1 = reg2.bit2
    52            C        ;================================================
    53            C        MOVB MACRO REG1,BIT1,REG2,BIT2
    54            C        	JBS       REG2,BIT2
    55            C        	BC        REG1,BIT1
    56            C        	JBC       REG2,BIT2
    57            C        	BS        REG1,BIT1
    58            C        ENDM
    59            C        
    60            C        ;===============================================
    61            C        ; TO reg1.bit1 = /reg2.bit2
    62            C        ;===============================================
    63            C        MOVBCPL MACRO REG1,BIT1,REG2,BIT2
    64            C        	JBS       REG2,BIT2
    65            C        	BS        REG1,BIT1
    66            C        	JBC       REG2,BIT2
    67            C        	BC        REG1,BIT1
    68            C        ENDM
    69            C        
    70            C        ;===============================================
    71            C        ; TO REG1=@DATA
    72            C        ;===============================================
    73            C        MOV MACRO REG,@DATA
    74            C        	MOV       A,@DATA
    75            C        	MOV       REG,A
    76            C        ENDM
    77            C        
    78            C        ;===============================================
    79            C        ; TO REG1=REG2
    80            C        ;===============================================
    81            C        MOV MACRO REG1,REG2
    82            C        	MOV       A,REG2
    83            C        	MOV       REG1,A
    84            C        ENDM
    85            C        
    86            C        
    87            C        
    88            C        ;***********************************************************
    89            C        ;
    90            C        ;***********************************************************
    91            C        ;===============================================
    92            C        ;decrement reg and jump when not zero
    93            C        ;================================================
    94            C        DJNZ MACRO REG,ADDRESS
    95            C        	DJZ       REG
    96            C        	JMP       ADDRESS
    97            C        ENDM
    98            C        
    99            C        ;=====================================================
   100            C        ; INC reg and jump when not zero
   101            C        ;=====================================================
   102            C        IJNZ MACRO REG,ADDRESS
   103            C        	JZ        REG
   104            C        	JMP       ADDRESS
   105            C        ENDM
   106            C        
   107            C        ;=====================================================
   108            C        ; compare and jump
   109            C        ; if reg1 > reg2 jump to add1
   110            C        ; if reg1 < reg2 jump to add2
   111            C        ;=====================================================
   112            C        CJLJG MACRO REG1,REG2,ADD1,ADD2
   113            C        	MOV       A,REG2
   114            C        	SUB       A,REG1
   115            C        	JBS       0X03,0 ;R3==0X03
   116            C        	JMP       ADD1
   117            C        	JBS       0X03,2
   118            C        	JMP       ADD2
   119            C        ENDM
   120            C        
   121            C        ;=====================================================
   122            C        ; compare and jump if in range
   123            C        ; if @LITE1 <= REG <= @LITE2 jump to ADDR
   124            C        ;=====================================================
   125            C        CJIN MACRO REG,@LITE1,@LITE2,ADDR
   126            C        	MOV       A,REG
   127            C        	ADD       A,@255-LITE2
   128            C        	ADD       A,@LITE2-LITE1+1
   129            C        	JBC       0X03,0
   130            C        	JMP       ADDR
   131            C        ENDM
   132            C        
   133            C        ;=====================================================
   134            C        ; COMPARE AND JUMP IF OUT RANGE
   135            C        ; if REG > @LITE2 or REG < @LITE1 jump to ADDR
   136            C        ;=====================================================
   137            C        CJOUT MACRO REG,@LITE1,@LITE2,ADDR
   138            C        	MOV       A,REG
   139            C        	ADD       A,@255-LITE2
   140            C        	ADD       A,@LITE2-LITE1+1
   141            C        	JBS       0X03,0
   142            C        	JMP       ADDR
   143            C        ENDM
   144            C        
   145            C        ;=====================================================
   146            C        ; compare and jump if REG1 > REG2
   147            C        ;=====================================================
   148            C        CJG       MACRO REG1,REG2,ADDRESS
   149            C        	MOV       A,REG1
   150            C        	SUB       A,REG2
   151            C        	JBS       0X03,0
   152            C        	JMP       ADDRESS
   153            C        ENDM
   154            C        
   155            C        ;=====================================================
   156            C        ; compare and jump if REG1 >= REG2
   157            C        ;=====================================================
   158            C        CJGE MACRO REG1,REG2,ADDRESS
   159            C        	MOV       A,REG2
   160            C        	SUB       A,REG1
   161            C        	JBC       0X03,0
   162            C        	JMP       ADDRESS
   163            C        ENDM
   164            C        
   165            C        ;=====================================================
   166            C        ; compare and jump if REG1 < REG2
   167            C        ;=====================================================
   168            C        CJL MACRO REG1,REG2,ADDRESS
   169            C        	MOV       A,REG2
   170            C        	SUB       A,REG1
   171            C        	JBS       0X03,0
   172            C        	JMP       ADDRESS
   173            C        ENDM
   174            C        
   175            C        ;=====================================================
   176            C        ; compare and jump if REG1 <= REG2
   177            C        ;=====================================================
   178            C        CJLE MACRO REG1,REG2,ADDRESS
   179            C        	MOV       A,REG1
   180            C        	SUB       A,REG2
   181            C        	JBC       0X03,0
   182            C        	JMP       ADDRESS
   183            C        ENDM
   184            C        
   185            C        ;=====================================================
   186            C        ; compare and jump if REG1 = REG2
   187            C        ;=====================================================
   188            C        CJE MACRO REG1,REG2,ADDRESS
   189            C        	MOV       A,REG2
   190            C        	SUB       A,REG1
   191            C        	JBC       0X03,2
   192            C        	JMP       ADDRESS
   193            C        ENDM
   194            C        
   195            C        ;=====================================================
   196            C        ; compare and jump if REG1 = @DATA jmp to ADDRESS
   197            C        ;=====================================================
   198            C        CJE MACRO REG,@DATA,ADDRESS
   199            C        	MOV       A,REG
   200            C        	SUB       A,@DATA
   201            C        	JBC       0X03,2
   202            C        	JMP       ADDRESS
   203            C        ENDM
   204            C        
   205            C        ;=====================================================
   206            C        ; compare and jump if REG1=REG2=@DATA jmp to ADDRESS
   207            C        ;=====================================================
   208            C        CJE MACRO REG1,REG2,@DATA,ADDRESS
   209            C        	MOV       A,REG2
   210            C        	SUB       A,REG1
   211            C        	JBS       0X03,2
   212            C        	JMP       $_CJE_DONE
   213            C        	MOV       A,REG1
   214            C        	SUB       A,@DATA
   215            C        	JBC       0X03,2
   216            C        	JMP       ADDRESS
   217            C        $_CJE_DONE:
   218            C        ENDM
   219            C        
   220            C        ;=====================================================
   221            C        ; compare and jump if REG1 <> REG2
   222            C        ;=====================================================
   223            C        CJNE MACRO REG1,REG2,ADDRESS
   224            C        	MOV       A,REG2
   225            C        	SUB       A,REG1
   226            C        	JBS       0X03,2
   227            C        	JMP       ADDRESS
   228            C        ENDM
   229            C        
   230            C        ;=====================================================
   231            C        ;compare and jump if REG = 0 JMP ADDRESS
   232            C        ;=====================================================
   233            C        CJZ MACRO REG,ADDRESS
   234            C        	MOV       REG,REG
   235            C        	JBC       0X03,2
   236            C        	JMP       ADDRESS
   237            C        ENDM
   238            C        
   239            C        ;=====================================================
   240            C        ; compare and jump if REG <> 0
   241            C        ;=====================================================
   242            C        CJNZ MACRO REG,ADDRESS
   243            C        	MOV       REG,REG
   244            C        	JBS       0X03,2
   245            C        	JMP       ADDRESS
   246            C        ENDM
   247            C        
   248            C        ;=====================================================
   249            C        ; compare and jump if REG.BIT = 0
   250            C        ;=====================================================
   251            C        CJBC MACRO REG,BIT,ADDRESS
   252            C        	JBS       REG,BIT
   253            C        	JMP       ADDRESS
   254            C        ENDM
   255            C        
   256            C        ;=====================================================
   257            C        ; compare and jump if REG.BIT = 1
   258            C        ;=====================================================
   259            C        CJBS MACRO REG,BIT,ADDRESS
   260            C        	JBC       REG,BIT
   261            C        	JMP       ADDRESS
   262            C        ENDM
   263            C        
   264            C        ;=====================================================
   265            C        ; compare and jump if REG.BIT = 0 JMP ADDRESS1
   266            C        ;                  if REG.BIT = 1 JMP ADDRESS2
   267            C        ;=====================================================
   268            C        CJBCS MACRO REG,BIT,ADDRESS1,ADDRESS2
   269            C        	JBC       REG,BIT
   270            C        	JMP       ADDRESS1
   271            C        	JBS       REG,BIT
   272            C        	JMP       ADDRESS2
   273            C        ENDM
   274            C        
   275            C        
   276            C        
   277            C        
   278            C        
   279            C        ;***********************************************************
   280            C        ;
   281            C        ;***********************************************************
   282            C        ;===============================================
   283            C        ; 
   284            C        ; :,ACC,R3
   285            C        ; A      -> A_TEMP
   286            C        ; R4    -> RSR_TEMP
   287            C        ; STATUS -> STATUS_TEMP
   288            C        ;================================================
   289            C        PUSH MACRO
   290            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   291            C        	SWAP                A_TEMP         ;A_TEMP
   292            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   293            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   294            C        IFDEF EM78P510.H
   295            C        	SWAPA               0X05           ;R5              ;SAVE R5(R5)
   296            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   297            C        ELSE
   298            C        	SWAPA               0X04           ;R4              ;SAVE R4(R4)
   299            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   300            C        ENDIF
   301            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   302            C        ENDM
   303            C        
   304            C        ;---------------------------------------
   305            C        POP MACRO
   306            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   307            C        	MOV                 0X03,A         ;STATUS,A
   308            C        IFDEF EM78P510.H
   309            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   310            C        	MOV                 0X05,A         ;R4,A
   311            C        ELSE
   312            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   313            C        	MOV                 0X04,A         ;R4,A
   314            C        ENDIF
   315            C        	SWAPA               A_TEMP         ;A_TEMP
   316            C        ENDM
   317            C        
   318            C        ;========================== EM78P520 =================================
   319            C        PUSH MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_Temp
   320            C        	MOV                 A_TEMP,A       ;A_TEMP,A         ;SAVE A
   321            C        	SWAP                A_TEMP         ;A_TEMP
   322            C        	SWAPA               0X03           ;STATUS           ;SAVE STATUS(R3)
   323            C        	MOV                 STATUS_TEMP,A  ;STATUS_TEMP,A
   324            C        	SWAPA               0X05           ;R4              ;SAVE R4(R4)
   325            C        	MOV                 RSR_TEMP,A     ;RSR_TEMP,A
   326            C        	CLR                 0X03           ;STATUS           ;SELECT PAGE0
   327            C        
   328            C        	BANK                @BankSel
   329            C        	MOV                 A,A_TEMP
   330            C        	MOV                 Ax_Temp,A
   331            C        	MOV                 A,STATUS_Temp
   332            C        	MOV                 STATUSx_Temp,A
   333            C        	MOV                 A,RSR_Temp
   334            C        	MOV                 RSRx_Temp,A
   335            C        ENDM
   336            C        
   337            C        ;---------------------------------------
   338            C        POP MACRO A_Temp,STATUS_Temp,RSR_Temp,@BankSel,Ax_Temp,STATUSx_Temp,RSRx_TEMP
   339            C        	BANK                @BankSel
   340            C        	MOV                 A,Ax_Temp
   341            C        	MOV                 A_TEMP,A
   342            C        	MOV                 A,STATUSx_Temp
   343            C        	MOV                 STATUS_Temp,A
   344            C        	MOV                 A,RSR_TEMP
   345            C        	MOV                 RSRx_TEMP,A
   346            C        
   347            C        	SWAPA               STATUS_TEMP    ;STATUS_TEMP    ;R3
   348            C        	MOV                 0X03,A         ;STATUS,A
   349            C        	SWAPA               RSR_TEMP       ;RSR_TEMP       ;R4
   350            C        	MOV                 0X05,A         ;R4,A
   351            C        	SWAPA               A_TEMP         ;A_TEMP
   352            C        ENDM
   353            C        
   354            C        ;***********************************************************
   355            C        ;long jmp/long call
   356            C        ;***********************************************************
   357            C        ;===================================================
   358            C        ; select page
   359            C        ;===================================================
   360            C        PAGE MACRO NUM
   361            C        IFDEF     EM78P510.H
   362            C        	ERROR
   363            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   364            C        	MESSAGE "can not use the instrction PAGE"
   365            C        ELSE
   366            C        	IF        NUM == 0
   367            C                      BC        0X03,7
   368            C                      BC        0X03,6
   369            C                      BC        0X03,5
   370            C        	ELSEIF    NUM == 1
   371            C        	          BC        0X03,7
   372            C        	          BC        0X03,6
   373            C        	          BS        0X03,5
   374            C        	ELSEIF    NUM == 2
   375            C        	          BC        0X03,7
   376            C        	          BS        0X03,6
   377            C        	          BC        0X03,5
   378            C        	ELSEIF    NUM == 3
   379            C        	          BC        0X03,7
   380            C        	          BS        0X03,6
   381            C        	          BS        0X03,5
   382            C        	ELSEIF    NUM == 4
   383            C        	          BS        0X03,7
   384            C        	          BC        0X03,6
   385            C        	          BC        0X03,5
   386            C        	ELSEIF    NUM == 5
   387            C        	          BS        0X03,7
   388            C        	          BC        0X03,6
   389            C        	          BS        0X03,5
   390            C        	ELSEIF    NUM == 6
   391            C        	          BS        0X03,7
   392            C        	          BS        0X03,6
   393            C        	          BC        0X03,5
   394            C        	ELSEIF    NUM == 7
   395            C        	          BS        0X03,7
   396            C        	          BS        0X03,6
   397            C        	          BS        0X03,5
   398            C        	ELSE
   399            C        	          MESSAGE "WARRING: don't have specify page"
   400            C        	ENDIF
   401            C        ENDIF
   402            C        
   403            C        ENDM
   404            C        
   405            C        ;===================================================%
   406            C        ; roboticized call
   407            C        ;===================================================
   408            C        FCALL MACRO ADDRESS
   409            C        IFDEF     EM78P510.H
   410            C        	ERROR
   411            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   412            C        	MESSAGE "can not use the instrction FCALL"
   413            C        ELSE
   414            C        	IF        ADDRESS/0X400 == $/0X400
   415            C        	          CALL      ADDRESS
   416            C        	ELSE
   417            C        	          PAGE      ADDRESS/0X400
   418            C        	          CALL      ADDRESS%0X400
   419            C        	          PAGE      $/0X400
   420            C        	ENDIF
   421            C        ENDIF
   422            C        ENDM
   423            C        
   424            C        ;===================================================
   425            C        ; roboticized call
   426            C        ; input:NUM = page number,  ADDRESS =  code address
   427            C        ;===================================================
   428            C        FCALL MACRO NUM,ADDRESS
   429            C        IFDEF     EM78P510.H
   430            C        	ERROR
   431            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   432            C        	MESSAGE "can not use the instrction FCALL"
   433            C        ELSE
   434            C        	PAGE      NUM
   435            C        	CALL      ADDRESS
   436            C        	PAGE      $/0X400
   437            C        ENDIF
   438            C        ENDM
   439            C        
   440            C        ;===================================================
   441            C        ; roboticized jmp
   442            C        ;===================================================
   443            C        FJMP MACRO ADDRESS
   444            C        IFDEF     EM78P510.H
   445            C        	ERROR
   446            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   447            C        	MESSAGE "can not use the instrction FJMP"
   448            C        ELSE
   449            C        	IF        ADDRESS/0X400 == $/0X400
   450            C        	          JMP       ADDRESS
   451            C        	ELSE
   452            C        	          PAGE      ADDRESS/0X400
   453            C        	          JMP       ADDRESS%0X400
   454            C        	ENDIF
   455            C        ENDIF
   456            C        ENDM
   457            C        
   458            C        ;===================================================
   459            C        ; roboticized jmp
   460            C        ; input:NUM = page number,  ADDRESS =  code address
   461            C        ;===================================================
   462            C        FJMP MACRO NUM,ADDRESS
   463            C        IFDEF     EM78P510.H
   464            C        	ERROR
   465            C        	MESSAGE "ERROR:THe EM78510 Not Support PAGE insruction but used LCALL or LJMP"
   466            C        	MESSAGE "can not use the instrction FJMP"
   467            C        ELSE
   468            C        	PAGE      NUM
   469            C        	JMP       ADDRESS
   470            C        ENDIF
   471            C        ENDM
   472            C        
   473            C        ;===================================================
   474            C        ; select bank
   475            C        ;===================================================
   476            C        BANK MACRO @NUM
   477            C        IFDEF EM78M611E.H
   478            C        	IF        @NUM == 0
   479            C                      BC        0X04,7
   480            C                      BC        0X04,6
   481            C        	ELSEIF    @NUM == 1
   482            C        	          BC        0X04,7
   483            C        	          BS        0X04,6
   484            C        	ELSEIF    @NUM == 2
   485            C        	          BS        0X04,7
   486            C        	          BC        0X04,6
   487            C        	ELSEIF    @NUM == 3
   488            C        	          BS        0X04,7
   489            C        	          BS        0X04,6
   490            C        	ENDIF
   491            C        
   492            C        ELSEIFDEF EM78M612.H
   493            C        	IF        @NUM == 0
   494            C                      BC        0X04,6
   495            C        	ELSEIF    @NUM == 1
   496            C        	          BS        0X04,6
   497            C        	ENDIF
   498            C        ELSE
   499            C        	MESSAGE "the MCU defualt have 'bank' intruction"
   500            C        ENDIF
   501            C        ENDM
   502            C        
   503            C        
   504            C        
   505            C        ;*******************************************
   506            C        ; RAM clear function
   507            C        ; [ELSE]: default the MCU have four bank
   508            C        ; others: xx.h must be define in "xx.h"
   509            C        ;*******************************************
   510            C        ClrRamBank MACRO
   511            C        IFDEF EM78P520.H
   512            C         	CLR     0X05
   513            C        	MOV     A,@0XD0
   514            C        	MOV     0X04,A
   515            C        
   516            C        	CLR     0X00
   517            C        	INC     0X04
   518            C        	MOV     A,0X04
   519            C        	AND     A,@0X3F
   520            C        	JBS     0X03,2
   521            C        	JMP     $-5
   522            C        	BC      0X04,6
   523            C        	INC     0X05
   524            C        	BS      0X04,5
   525            C        	MOV     A,@0X07
   526            C        	AND     0X05,A
   527            C        	BS      0X04,6
   528            C        	JBS     0X03,2
   529            C        	JMP     $-13
   530            C        	CLR		0X04
   531            C        	BS      0X04,6
   532            C        
   533            C        ELSEIFDEF EM78M611E.H
   534            C         	MOV     A,@0x10
   535            C        	MOV     R4,A
   536            C        
   537            C        	CLR     R0
   538            C        	INC     R4
   539            C        	JBC     R4,6
   540            C        	BS      R4,5
   541            C        	JBC     R4,7
   542            C        	BS      R4,5
   543            C        	JBS     R3,Z
   544            C        	JMP     $-7
   545            C        	CLR     R4
   546            C        
   547            C        	MOV     A,@0X11
   548            C        	MOV     RD,A
   549            C        	CLR     RE
   550            C        	MOV     A,@1
   551            C        	MOV     RD,A
   552            C        	MOV     A,@0X00
   553            C        	MOV     RE,A
   554            C        	MOV     RE,A
   555            C        	MOV     RE,A
   556            C        	MOV     RE,A
   557            C        	MOV     RE,A
   558            C        	MOV     RE,A
   559            C        	MOV     RE,A
   560            C        	MOV     RE,A
   561            C        	BS      RC,5
   562            C        
   563            C        ELSEIFDEF EM78P447.H
   564            C         	MOV     A,@0x10
   565            C        	MOV     R4,A
   566            C        
   567            C        	CLR     R0
   568            C        	INC     R4
   569            C        	JBC     R4,6
   570            C        	BS      R4,5
   571            C        	JBC     R4,7
   572            C        	BS      R4,5
   573            C        	JBS     R3,Z
   574            C        	JMP     $-7
   575            C        	CLR     R4
   576            C        
   577            C        ELSEIFDEF EM78P468.H
   578            C        	MOV     A,@0X10
   579            C        	MOV     0X04,A
   580            C        
   581            C        	CLR     0X00
   582            C        	INC     0X04
   583            C        	JBC     0X04,6
   584            C        	BS      0X04,5
   585            C        	JBC     0X04,7
   586            C        	BS      0X04,5
   587            C        	JBS     0X03,2
   588            C        	JMP     $-7
   589            C        
   590            C        ELSEIFDEF EM78P458.H
   591            C        	MOV     A,@0X10
   592            C        	MOV     R4,A
   593            C        
   594            C        	CLR     R0
   595            C        	INC     R4
   596            C        	JBC     R4,6
   597            C        	BS      R4,5
   598            C        	JBS     R4,7
   599            C        	JMP     $-5
   600            C        	CLR     R4
   601            C        
   602            C        ELSEIFDEF EM78P451.H
   603            C        	MOV     A,@0X10
   604            C        	MOV     R4,A
   605            C        
   606            C        	CLR     R0
   607            C        	INC     R4
   608            C        	JBC     R4,6
   609            C        	BS      R4,5
   610            C        	JBC     R4,7
   611            C        	BS      R4,5
   612            C        	JBS     STATUS,Z
   613            C        	JMP     $-7
   614            C        	CLR		RSR
   615            C        
   616            C        ELSEIFDEF EM78F651.H
   617            C        	MOV		A,@0X10
   618            C        	MOV		RSR,A
   619            C        
   620            C        	CLR		R0
   621            C        	INC		RSR
   622            C        	JBC	 	RSR,6
   623            C        	BS		RSR,5
   624            C        	JBC		RSR,7
   625            C        	BS		RSR,5
   626            C        	JBS		Z
   627            C        	JMP             $-7
   628            C        	CLR		RSR
   629            C        
   630            C        ELSEIFDEF EM78P153N.H
   631            C                MOV     A,@0X10
   632            C                MOV     RSR,A
   633            C        
   634            C                CLR     R0
   635            C                INC     RSR
   636            C                JBC     RSR,5
   637            C                JBS     RSR,4
   638            C                JMP     $-4
   639            C         
   640            C        
   641            C        ELSE
   642            C        	MOV     A,@0x10        ; clear all ram bank
   643            C        	MOV     R4,A
   644            C        
   645            C        	CLR     R0
   646            C        	INC     R4
   647            C        	JBC     R4,6
   648            C        	BS      R4,5
   649            C        	JBC     R4,7
   650            C        	BS      R4,5
   651            C        	JBS     R3,Z
   652            C        	JMP     $-7
   653            C        	CLR     R4
   654            C        	MESSAGE "Clear all RAM bank"
   655            C        ENDIF
   656            C        ENDM
   657            C        
   658            C        ;*******************************************
   659            C        ; RAM clear function
   660            C        ; [ELSE]: default the MCU have four bank
   661            C        ; others: xx.h must be define in "xx.h"
   662            C        ;*******************************************
   663            C        ClrCommRamBank MACRO
   664            C        	MOV                 A, @0X10        ; RAM 
   665            C        	MOV                 R4, A
   666            C        
   667            C        	WDTC
   668            C        	CLR                 R0
   669            C        	INC                 R4
   670            C        	MOV                 A,@0B00111111
   671            C        	AND                 A,R4
   672            C        	SUB                 A,@0X1F
   673            C        	JBC                 R3,C
   674            C        	JMP                 $-7
   675            C        	CLR                 R4
   676            C        ENDM
   677            C        
   678            C        ;********************************************************************
   679            C        ;********************************************************************
   680            C        Clearbuffer MACRO
   681            C          ifdef EM78P520.H
   682            C        	MOV                 A,@0B11100000   ; clear bank0 ram
   683            C        	MOV                 R4,A
   684            C        	BANK                0               ; R5=0
   685            C        
   686            C        	WDTC
   687            C        	CLR                 R0
   688            C        	INC                 R4
   689            C        	MOV                 A,@0B00111111
   690            C        	AND                 A,R4
   691            C        	XOR                 A,@0X3F
   692            C        	JBS                 R3,Z
   693            C        	JMP                 $-7
   694            C        	CLR                 R0
   695            C        	MOV                 A,@0B11000000
   696            C        	MOV                 R4,A
   697            C        
   698            C          elseifdef EM78M611E.H
   699            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   700            C        	MOV                 R4,A
   701            C        
   702            C        	WDTC
   703            C        	CLR                 R0
   704            C        	INC                 R4
   705            C        	MOV                 A,@0B00111111
   706            C        	AND                 A,R4
   707            C        	XOR                 A,@0X3F
   708            C        	JBS                 R3,Z
   709            C        	JMP                 $-7
   710            C        	CLR                 R0
   711            C        	CLR                 R4
   712            C        
   713            C          else
   714            C        	MOV                 A,@0B00100000   ; clear bank0 ram
   715            C        	MOV                 R4,A
   716            C        
   717            C        	WDTC
   718            C        	CLR                 R0
   719            C        	INC                 R4
   720            C        	MOV                 A,@0B00111111
   721            C        	AND                 A,R4
   722            C        	XOR                 A,@0X3F
   723            C        	JBS                 R3,Z
   724            C        	JMP                 $-7
   725            C        	CLR                 R4
   726            C          endif
   727            C        ENDM
   728            C        
   729            C        
    16                     include "config.h"
     1            C        /*****************************************************************
     2            C        * Filename     :  CONFIG.ASM
     3            C        * Author       :  yu.wei
     4            C        ; Company       : ELAN
     5            C        ; VERSION       : 1.2
     6            C        ; CRYSTAL       : 8MHZ
     7            C        ; Creat date    : 2009/12/3
     8            C        ; tool ver.     : WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;-------------------------------------------------------------------------
    12            C        config.h     EQU     config.h
    13            C        
    14            C        ;-------------------------------------------------------------------------
    15       00FA C        SetSleepTime            EQU     250     ; Into sleep Time=(SetSleepTime+1)*2s. default:250
    16       0002 C        RokerSampingType        EQU     2   	; 0 -> ADC_FUNCTION(default:0)
    17            C                                        		; 1 -> IO_FUNCTION
    18            C                                        		; 2 -> Totuch pad module
    19            C        
    17                     include "P520ksP44.H"
     1            C        /*****************************************************************
     2            C        * Filename     :  P520ksP44.ASM
     3            C        * Author       :  yu.wei
     4            C        * Company      :  ELAN
     5            C        * VERSION      :  1.1
     6            C        * CRYSTAL      :  8MHZ
     7            C        * Creat date   :  2009/13/3
     8            C        * tool ver.    :  WicePlus 2.7/eUIDE
     9            C        * Description  :  modify for code conformity
    10            C        *****************************************************************/
    11            C        ;  Description: PAGE0(0X0000-0X03FF): MCU initial
    12            C        ;               PAGE1(0X0400-0X07FF): searchmode
    13            C        ;               PAGE2(0X0800-0X0BFF): normalmode
    14            C        ;               PAGE3(0X0C00-0X0FFF): RF driver
    15            C        ;               PAGE4(0X1000-0X13FF): key scan driver
    16            C        ;               PAGE5(0X1400-0X17FF): CMOS driver
    17            C        ;               PAGE6(0X1800-0X1BFF): CMOS/GS driver
    18            C        ;               PAGE7(0X1C00-0X1FFF): Kalman Filter arithmetic
    19            C        
    20            C        ;========================================================================
    21            C        P520ksP44.H             EQU     P520ksP44.H
    22       0000 C        TIMER1_T_DEBUG          EQU     0
    23       0000 C        TIMER2_T_DEBUG          EQU     0
    24            C        
    25            C        
    26            C        ;========================================================================
    27       0010 C        TEMP                            EQU     0X10
    28       0011 C        TEMP1                           EQU     0X11
    29       0012 C        TEMP2                           EQU     0X12
    30       0013 C        TEMP3                           EQU     0X13
    31       0014 C        TEMP4                           EQU     0X14
    32       0015 C        TEMP5                           EQU     0X15
    33            C        
    34       0016 C        TPDataLossCNT                   EQU     0X16
    35       0017 C        ComuClock                       EQU     0X17  ;communicateion clock
    36       0018 C        ComuCycleNum                    EQU     0X18  ;communicateion time
    37       0019 C        ComuEndNum                      EQU     0X19  ;communicateion end time
    38       001A C        Databytelength                  EQU     0X1A  ;FIFO READ/WRITE DATA LENGTH
    39       001B C        DataShiftCounter                EQU     0X1B  ;data counter
    40       001C C        SleepCNT                        EQU     0X1C  ;data conunter
    41            C        
    42       001D C        GeneralStatusFlag1              EQU     0X1D
    43       00EF C        	RFInitialFailFlag           ==      GeneralStatusFlag1*8+7 ;
    44       00EE C        	RFInitialOKFlag             ==      GeneralStatusFlag1*8+6
    45       00ED C        	RFTestFailFlag              ==      GeneralStatusFlag1*8+5
    46       00EA C        	ReadLengthError             ==      GeneralStatusFlag1*8+2
    47       00E9 C        	IntoSleepFlag               ==      GeneralStatusFlag1*8+1
    48       00E8 C        	ToWakeupFlag                ==      GeneralStatusFlag1*8+0
    49            C        
    50       001E C        GeneralStatusFlag2              EQU     0X1E
    51            C        	;System2sFlag                ==      GeneralStatusFlag2*8+7
    52       00F6 C        	System16msFlag              ==      GeneralStatusFlag2*8+6
    53       00F5 C        	System8msFlag               ==      GeneralStatusFlag2*8+5
    54       00F3 C        	KeyScanFinishFlag           ==      GeneralStatusFlag2*8+3
    55       00F2 C        	KeyStatusFlag               ==      GeneralStatusFlag2*8+2
    56       00F1 C        	KeyScanStatusFlag           ==      GeneralStatusFlag2*8+1
    57       00F0 C        	KeyScanInitFlag             ==      GeneralStatusFlag2*8+0
    58            C        
    59       001F C        CommuStatusFlag                 EQU     0X1F
    60       00FF C        	DescriptorFinishFlag        ==      CommuStatusFlag*8+7   ; DESCRIPTOR FINISH(1) OR NOT(USB)
    61       00FE C        	FccTestModeFlag             ==      CommuStatusFlag*8+6
    62       00FD C        	ForceLinkModeFlag           ==      CommuStatusFlag*8+5   ; force link flag
    63       00FC C        	LinkModeFlag                ==      CommuStatusFlag*8+4   ; link flag
    64       00FB C        	EEpromWRStatusFlag          ==      CommuStatusFlag*8+3
    65       00FA C        	LoseFrameStatusFlag         ==      CommuStatusFlag*8+2   ; lose frequency and search mode flag
    66       00F9 C        	NormalStatusFlag            ==      CommuStatusFlag*8+1   ; Normal mode Flag
    67       00F8 C        	SearchStatusFlag            ==      CommuStatusFlag*8+0   ; Search mode flag
    68            C        
    69            C        ;------------------------------------------------------------------
    70            C        
    71            C        
    72            C        ;========================= I/O Port Define ==============================
    73       0041 C        LED1_STATUS                 ==      PORT8*8+1 ;LED
    74       0042 C        LED2_STATUS                 ==      PORT8*8+2 ;LED
    75            C        
    76       0057 C        TP_SPI_SS                   ==      PORTA*8+7
    77       0056 C        TP_SPI_SCK                  ==      PORTA*8+6
    78       0055 C        TP_SPI_MOSI                 ==      PORTA*8+5 ;SDI
    79       0054 C        TP_SPI_MISO                 ==      PORTA*8+4 ;SDO
    80       0052 C        TP_SPI_TPREQB               ==      PORTA*8+2
    81            C        
    82            C        
    83            C        ;======================= BANK 0 (data buffer)============================
    84            C        ; bank0 20-3f used for data exchange section
    85            C        ; such as read or write EEPROM and RF,it used for data buffer
    86            C        
    87            C        ;-----------------------------------------------------------------
    88       0020 C        TPPacket1Byte1          EQU     0X20
    89       0021 C        TPPacket1Byte2          EQU     0X21  
    90       010C C          P2FS                  ==      TPPacket1Byte2*8+4
    91       0108 C          P1FS                  ==      TPPacket1Byte2*8+0  
    92       0022 C        TPPacket1Byte3          EQU     0X22
    93       0023 C        TPPacket1Byte4          EQU     0X23
    94            C        
    95       0024 C        TPPacket2Byte1          EQU     0X24
    96       0025 C        TPPacket2Byte2          EQU     0X25
    97       0026 C        TPPacket2Byte3          EQU     0X26
    98       0027 C        TPPacket2Byte4          EQU     0X27
    99            C        
   100       0028 C        TPPacket3Byte1          EQU     0X28
   101       0029 C        TPPacket3Byte2          EQU     0X29
   102       002A C        TPPacket3Byte3          EQU     0X2A
   103       002B C        TPPacket3Byte4          EQU     0X2B
   104            C        
   105            C        
   106            C        
   107            C        ;======================= BANK 1 (RF variable)============================
   108       0030 C        ADDR                    EQU     0X30 ;in/out Data Address
   109       0031 C        VALUE                   EQU     0X31 ;in/out Data
   110            C        
   111            C        
   112            C        ;======================= BANK 2 (key data)==============================
   113       0020 C        HeaderFrameData         EQU     0X20 ; UART Header Frame Data for Airui Corp.
   114       0021 C        DataA                   EQU     0X21 ;rocker left-x(left-right)  RF transmitter data
   115       0022 C        DataB                   EQU     0X22 ;rocker left-y(up-down)     RF transmitter data
   116       0023 C        DataC                   EQU     0X23 ;rocker right-x(left-right) RF transmitter data
   117       0024 C        DataD                   EQU     0X24 ;rocker right-y(up-down)    RF transmitter data
   118       0025 C        DataE                   EQU     0x25 ;DataA(s10-s5):
   119            C                                ;bit7  bit6  Bit5  Bit4  Bit3  bit2  bit1  bit0
   120            C                                ;A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   121       0026 C        DataF                   EQU     0x26 ;DataB(s4-s1):
   122            C                                ;bit7      bit6      Bit5      Bit4   Bit3  bit2    bit1    bit0
   123            C                                ;SELECT_9  START_10  TEST2_14  MACRO  MODE  RSW_12  LSW_11  TEST1_13
   124            C                                ;MODE: 1:DealWithDigital  0:DealWithAnalog (default:1)
   125       0027 C        DataG                   EQU     0X27 ;bit[7..4]Hat Switch, bit[3..0]reserve.
   126            C                                ;000:00001:45010:90011:135100:180101:225110:270111:315
   127            C        
   128       002A C        IOcheckRefValue         EQU     0X2A    ; used for Store refrence value
   129       002B C        KeyCheckBakup           EQU     0X2B
   130       002C C        ComSystemTimeCNT        EQU     0X2C
   131       002D C        IOcheckTimeCNT          EQU     0X2D    ; used for count check time
   132       002E C        KeySystemTimeCNT        EQU     0x2E    ; key scan time
   133       002F C        LEDSystemTimeCNT        EQU     0X2F
   134            C        
   135       0030 C        KEY_LEFT_X              EQU     0X30 ;rocker,AD convert result left-x(left-right) data
   136       0031 C        KEY_LEFT_Y              EQU     0X31 ;rocker,AD convert result left-y(up-down) data
   137       0032 C        KEY_RIGHT_X             EQU     0X32 ;rocker,AD convert result right-x(left-right) data
   138       0033 C        KEY_RIGHT_Y             EQU     0X33 ;rocker,AD convert result right-y(up-down) data
   139       0036 C        KeystokeFlag_Befor      EQU     0X36
   140       0037 C        KeystokeTimeCNT         EQU     0X37        ;       Click                     Dblclick                    Lasting_Press
   141            C                                                    ;________    _______.__________    ______    ________.___________         ____________
   142            C                                                    ;        |__|                  |__|      |__|                    |_______|
   143       0038 C        KEY_NUM                 EQU     0X38
   144            C                                                    ;___________                       _________                              ____________
   145            C                                                    ;           |_______._____________|         |________.___________________|
   146            C        
   147            C        ;F_MODE                  EQU     0X32 ;Analog jugde falg
   148            C        ;F_MODE_BEFOR            EQU     0X33 ;Store keyboard select
   149       0039 C        KeyTempFlag             EQU     0X39 ;Store LINE4_KEY_INPUT TEMP
   150       01CC C        	ModeSelFlag         ==      KeyTempFlag*8+4 ;1:analog  0:digital(default 0)
   151       01CD C        	MacroFlag           ==      KeyTempFlag*8+5
   152       01CE C        	Test1Flag           ==      KeyTempFlag*8+6
   153       01CF C        	Test2Flag           ==      KeyTempFlag*8+7
   154            C        
   155       003A C        KeyTempBakupFlag        EQU     0X3A
   156       01D4 C        	ModeSelBakupFlag    ==      KeyTempBakupFlag*8+4 ;1:analog  0:digital(default 0)
   157       01D5 C        	MacroBakupFlag      ==      KeyTempBakupFlag*8+5
   158       01D6 C        	Test1BakupFlag      ==      KeyTempBakupFlag*8+6
   159       01D7 C        	Test2BakupFlag      ==      KeyTempBakupFlag*8+7
   160            C        
   161       003B C        LINE1_KEY_INPUT_CACHE   EQU     0X3B ;line 1,direction data
   162       003C C        LINE2_KEY_INPUT_CACHE   EQU     0X3C ;line 2,X_LINE2 output
   163       003D C        LINE3_KEY_INPUT_CACHE   EQU     0X3D ;line 3,X_LINE3 output
   164       003E C        LINE4_KEY_INPUT_CACHE   EQU     0X3E ;line 4,X_LINE4 output
   165       003F C        LINE5_KEY_INPUT_CACHE   EQU     0X3F ;line 5,X_LINE5 output
   166            C        
   167            C        ;======================= BANK 3 (reserve)===============================
   168            C        
   169            C        
   170            C        
   171            C        ;======================= BANK 4 (Push data)=============================
   172       0020 C        ATcc_TEMP               EQU     0X20  ;used for TCC and POP3
   173       0021 C        RSRTcc_TEMP             EQU     0X21
   174       0022 C        StatusTcc_TEMP          EQU     0X22
   175            C        
   176       0023 C        AExt_TEMP               EQU     0X23  ;used for External and POP3
   177       0024 C        RSRExt_TEMP             EQU     0X24
   178       0025 C        StatusExt_TEMP          EQU     0X25
   179            C        
   180       0026 C        A1_TEMP                 EQU     0X26  ;used for time1 and POP1
   181       0027 C        RSR1_TEMP               EQU     0X27
   182       0028 C        STATUS1_TEMP            EQU     0X28
   183            C        
   184       0029 C        A2_TEMP                 EQU     0X29  ;used for time2 and POP2
   185       002A C        RSR2_TEMP               EQU     0X2A
   186       002B C        STATUS2_TEMP            EQU     0X2B
   187            C        
   188            C        ;-----------------------------------------------------------
   189       0030 C        SPIS_TEMP               EQU     0X30
   190       0031 C        SPIC_TEMP               EQU     0X31
   191            C        
   192            C        ;======================= BANK 5 (CMOS Data)============================
   193            C        
   194            C        
   195            C        
   196            C        ;======================= BANK 6 (CMOS Data)============================
   197            C        
   198            C        
   199            C        
   200            C        ;======================= BANK 7 (GS Data)============================
   201            C        
    18                     include "uartcomu.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : uartcomu.h
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.2
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/12/3
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,used for airui
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        uartcomu.asm     EQU     uartcomu.asm
    14            C        
    15            C        include "uartcomu.h"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : uartcomu.h
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.2
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/12/3
     9            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    10            C        ; descripition  : For EM78P520,used for airui
    11            C        ;=============================================================================
    12            C        ;=============================================================================
    13            C        uartcomu.h     EQU     uartcomu.h
    14            C        
    15            C        
    16            C        
    17            C        ;-----------------------------------------------------------------------
    18       0001 C        COM_DEBUG               EQU     1      ; 1:uart delay debug,(enable); 0:disable
    19       0000 C        COM_T_DEBUG             EQU     0      ; 1:Time Test port enable, 0: disable
    20       0000 C        KeyScanTimeCtrl         EQU     0      ; T=(KeyScanTimeCtrl+1)*8ms             KeyScanTimeCtrl0
    21       0000 C        UartTimeCtrl            EQU     0      ; T=(ComTimeCtrl+1)*8ms, (default:180,Value=0 do the fastest)
    22            C        
    16            C        include "keyscan.asm"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : v1.2
     7            C        ;               : v1.3 modify for touch roker 2010-5-12 15:38:51
     8            C        ; CRYSTAL       : 8MHZ
     9            C        ; Creat date    : 2009/12/3
    10            C        ; tool ver.     : WicePlus 2.7/eUIDE v1.01.01
    11            C        ; descripition  : For EM78P520,used for airui
    12            C        ;=============================================================================
    13            C        ;=============================================================================
    14            C        
    15            C        ;---------------------------------------------------
    16            C        keyscan.asm             EQU       keyscan.asm
    17            C        include "keyscan.H"
     1            C        ;=============================================================================
     2            C        ;=============================================================================
     3            C        ; Filename      : KEYSCAN.ASM
     4            C        ; Author        : yu.wei
     5            C        ; Company       : ELAN
     6            C        ; VERSION       : 1.3
     7            C        ; CRYSTAL       : 8MHZ
     8            C        ; Creat date    : 2009/11/4
     9            C        ; tool ver.     : eUIDE
    10            C        ; descripition  : FOR EM78P520,
    11            C        ;=============================================================================
    12            C        keyscan.h           EQU        keyscan.h
    13            C        
    14            C        
    15            C        ;----------------------------------------------------------------
    16       0000 C        IOtoADC_T_DEBUG     EQU        0
    17       0001 C        TP_T_DEBUG          EQU        1
    18            C        
    19       0005 C        Kr                  EQU        5    ; Kr=5k/10k
    20       000A C        LeakresisTimeCNT    EQU        10     ; Leakresis time(default:4).T = LeakresisTimeCNT*[interrupt Time]
    21       0003 C        IOCheckRate         EQU        3   ; timer2 counter. Check IO when Time arrive (default:3)
    22       001B C        reg_acc             EQU        DataShiftCounter
    23            C        
    24            C        
    25            C        
    26            C        ;======================= key scan port define =========================
    27       0007 C        X_KeyLine           EQU        PORT7
    28       003C C        X_LINE1             ==         X_KeyLine*8+4		;R74
    29       003D C        X_LINE2             ==         X_KeyLine*8+5		;R73
    30       003E C        X_LINE3             ==         X_KeyLine*8+6		;R72
    31       003F C        X_LINE4             ==         X_KeyLine*8+7		;R71
    32            C        
    33       0009 C        X_Keyrow            EQU        PORT9
    34       004F C        X_ROW1              ==         X_Keyrow*8+7		;R97
    35       004E C        X_ROW2              ==         X_Keyrow*8+6		;R96
    36       004D C        X_ROW3              ==         X_Keyrow*8+5		;R95
    37       004C C        X_ROW4              ==         X_Keyrow*8+4		;R94
    38            C        
    39            C        ;
    40       0007 C        Reference           ==         7          ;port87
    41       0006 C        Leakresis           ==         6          ;port86
    42       0000 C        LeftYAxis           ==         0          ;port90  LY
    43       0001 C        LeftXAxis           ==         1          ;port91  LX
    44       0002 C        RightYAxis          ==         2          ;port92  RY
    45       0003 C        RightXAxis          ==         3          ;port93  RX
    46            C        
    47            C        ;------------------------ Define form SCH ----------------------------
    48       000F C        _Directions         EQU        0B00001111 ;Port83 Port82 Port81 Port80
    49            C        
    50       0003 C        _UP                 ==         3    ;Port83
    51       0002 C        _DOWN               ==         2    ;Port82
    52       0001 C        _LEFT               ==         1    ;Port81
    53       0000 C        _RIGHT              ==         0    ;Port80
    54            C        
    55            C        ;--------------------------------------------------
    56       0007 C        _A                  ==         7    ;Port97
    57       0006 C        _B                  ==         6    ;Port96
    58       0005 C        _C                  ==         5    ;Port95
    59       0004 C        _D                  ==         4    ;Port94
    60            C        
    61       0007 C        _L1                 ==         7    ;Port97
    62       0006 C        _R1                 ==         6    ;Port96
    63       0005 C        _L2                 ==         5    ;Port95
    64       0004 C        _R2                 ==         4    ;Port94
    65            C        
    66       0007 C        _SELECT             ==         7    ;Port97
    67       0006 C        _START              ==         6    ;Port96
    68       0007 C        _LSW                ==         7    ;Port97
    69       0004 C        _RSW                ==         4    ;Port94
    70            C        
    71       0005 C        _MODE               ==         5    ;Port95
    72       0004 C        _MACRO              ==         4    ;Port94
    73       0006 C        _TEST1              ==         6    ;Port96
    74       0005 C        _TEST2              ==         5    ;Port95
    75            C        
    76            C        ;----------------- Define by data -------------------
    77       0000 C        A_1                 ==         0    ;DataE
    78       0001 C        B_2                 ==         1
    79       0002 C        C_3                 ==         2
    80       0003 C        D_4                 ==         3
    81       0004 C        L1_5                ==         4
    82       0005 C        R1_6                ==         5
    83       0006 C        L2_7                ==         6
    84       0007 C        R2_8                ==         7
    85            C        
    86       0000 C        SELECT_9            ==         0    ;DataF
    87       0001 C        START_10            ==         1
    88       0002 C        LSW_11              ==         2
    89       0003 C        RSW_12              ==         3
    90       0004 C        MODE_13             ==         4
    91       0005 C        MACRO_14            ==         5
    92       0006 C        TEST1_15            ==         6
    93       0007 C        TEST2_16            ==         7
    94            C        
    95            C        
    96            C        ;=============== Connect key scan ======================
    97       00B4 C        KeyPressTime                EQU    180
    98       003C C        KeyScanTime                 EQU    60
    99       001E C        CrossingTime                EQU    30
   100       0002 C        KeyScanTimeCNT_default      EQU    2
   101            C        
   102            C        
   103            C        
   104            C        
   105            C        
    18            C        
    19            C        ifndef EM78CtrlIns.H
    20            C        include "D:\include\EM78xx\EM78CtrlIns.H"
    21            C        endif
    22            C        
    23            C        ifndef EM78Math.H
    24            C        include "D:\include\EM78xx\EM78Math.H"
    25            C        endif
    26            C        
    27            C        
    28            C        ;----------------------------------------------------
    29            C        
    30            C        	ORG                 0x10B0    ;PAGE 4
    31            C        	MESSAGE "define 'keyscan.asm' ROM address"
***     USER MESSAGE: DEFINE 'KEYSCAN.ASM' ROM ADDRESS
    32 010B0      C        Key_Scan:
    33 010B0 1E02 C        	BANK                2
    34 010B1 0C1E C        	JBC                 KeyScanInitFlag/8,KeyScanInitFlag%8
    35 010B2 14CD C        	JMP                 Key_Scan_startup
    36 010B3 0000 C        	NOP
    37 010B4 0000 C        	NOP
    38 010B5 0A1E C        	BS                  KeyScanInitFlag/8,KeyScanInitFlag%8
    39            C        
    40            C        ;========================== Iinitial setting ================================
    41            C          if RokerSampingType == 0
    42            C        	BANK                4
    43            C        	MOV                 A,@00000000B
    44            C        	MOV                 IOC7,A        ; Set Output
    45            C        	MOV                 A,@11111111B
    46            C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Input(Default IO)
    47            C        	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 As Input
    48            C        	MOV                 PBIOCR,A       	;
    49            C        	BANK                5
    50            C        	MOV                 A,@11110000B
    51            C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    52            C        	MOV                 A,@00001111B
    53            C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    54            C        	CALL                SUB_RINIT
    55            C        	CALL                SUB_ADJ
    56            C        
    57            C          elseif RokerSampingType == 1
    58            C        	BANK                4
    59            C        	MOV                 A,@00000000B
    60            C        	MOV                 IOC7,A        ; Set Output
    61            C        	MOV                 A,@11110000B
    62            C        	MOV                 IOC9,A         ; P97-P94:Input; P93-P90:Output(Default IO)
    63            C        	MOV                 A,@00001111B   ; PB0 PB1 PB2 PB3 As Input
    64            C        	MOV                 PBIOCR,A       ;
    65            C        	BANK                5
    66            C        	MOV                 A,@11110000B
    67            C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    68            C        	MOV                 A,@00001111B
    69            C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    70            C        	CALL                Pre_Discharge
    71            C        	CALL                SampingRefTiming
    72            C        
    73            C          elseif RokerSampingType == 2
    74 010B6 1E04 C        	BANK                4
    75 010B7 1800 C        	MOV                 A,@00000000B
    76 010B8 0047 C        	MOV                 IOC7,A        ; Set Output
    77 010B9 18F0 C        	MOV                 A,@11110000B
    78 010BA 0049 C        	MOV                 IOC9,A        ; P97-P94:Input; P93-P90:Output(Default IO)
    79 010BB 1814 C        	MOV                 A,@00010100B
    80 010BC 004A C        	MOV                 PAIOCR,A
    81 010BD 180F C        	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 As Input
    82 010BE 004B C        	MOV                 PBIOCR,A       	;
    83 010BF 1E05 C        	BANK                5
    84 010C0 18F0 C        	MOV                 A,@11110000B
    85 010C1 0049 C        	MOV                 P9PHCR,A      ; Set Pull Up, P93-P90 disable pull high
    86 010C2 1814 C        	MOV                 A,@00010100B
    87 010C3 004A C        	MOV                 PAPHCR,A
    88 010C4 180F C        	MOV                 A,@00001111B
    89 010C5 004B C        	MOV                 PBPHCR,A      ; PB0 PB1 PB2 PB4 Enable Pull High
    90 010C6 1E02 C        	BANK                2
    91 010C7 1800 C        	MOV                 A,@00000000B   ; Shift left, SDO delay time: 16clk,
    92 010C8 004C C        	MOV                 SPIS, A        ; disable open-drain
    93 010C9 18CC C        	MOV                 A,@11001100B   ; Data shift out rising edge, is on hold during low
    94 010CA 004D C        	MOV                 SPIC,A         ; Enable SPI mode, after data output SDO remain low
    95            C        
    96 010CB 1291 C        	CALL                TPModule_Ini
    97            C        
    98            C          endif
    99 010CC 0000 C        	NOP
   100            C        ;============================================================================
   101            C        
   102 010CD      C        Key_Scan_startup:
   103            C         ;===========================================================================
   104            C         ;Setting LED Status
   105            C         ;===========================================================================
   106 010CD 1E02 C        	BANK                2
   107 010CE 0F26 C        	JBS                 DataF,MODE_13    ; 1:analog  0:digital(default 0),LED light
   108 010CF 14D1 C        	JMP                 SET_VR_STATUS_0
   109 010D0 14D5 C        	JMP                 SET_VR_STATUS_1
   110 010D1      C          SET_VR_STATUS_0:
   111 010D1 0000 C        	NOP
   112 010D2 1E00 C        	BANK                0
   113 010D3 0848 C        	BC                  LED1_STATUS/8,LED1_STATUS%8		;PORT81
   114 010D4 14D9 C        	JMP                 SET_VR_STATUS_END
   115 010D5      C          SET_VR_STATUS_1:
   116 010D5 0000 C        	NOP
   117 010D6 1E00 C        	BANK                0
   118 010D7 0A48 C        	BS                  LED1_STATUS/8,LED1_STATUS%8		;PORT81
   119 010D8 14D9 C        	JMP                 SET_VR_STATUS_END
   120 010D9      C          SET_VR_STATUS_END:
   121 010D9 1E02 C        	BANK                2
   122 010DA 0000 C         	NOP
   123            C        
   124            C        ;================================================================================
   125            C        ;Keyscan Main
   126            C        ;================================================================================
   127 010DB 112F C        	CALL                KeyPort_Check
   128 010DC 0000 C        	NOP
   129            C        ;--------------------- Judge mode status ------------------------
   130 010DD 0D39 C        	JBC                 ModeSelFlag/8,ModeSelFlag%8
   131 010DE 14E5 C        	JMP                 MODE_NOCHANGE
   132 010DF 0F3A C        	JBS                 ModeSelBakupFlag/8,ModeSelBakupFlag%8
   133 010E0 14E5 C        	JMP                 MODE_NOCHANGE
   134 010E1 0000 C        	NOP
   135            C      M 	COM                 DataF,MODE_13
       010E2 1810     1     MOV A,@( 16 )
       010E3 0366     1     XOR  DATAF ,A
   136 010E4 0000 C        	NOP
   137 010E5      C          MODE_NOCHANGE:
   138            C      M 	MOVB                KeyTempBakupFlag,MODE_13,KeyTempFlag,MODE_13
       010E5 0F39     1     JBS  KEYTEMPFLAG , MODE_13 
       010E6 093A     1     BC  KEYTEMPBAKUPFLAG , MODE_13 
       010E7 0D39     1     JBC  KEYTEMPFLAG , MODE_13 
       010E8 0B3A     1     BS  KEYTEMPBAKUPFLAG , MODE_13 
   139 010E9 0939 C        	BC                  ModeSelFlag/8,ModeSelFlag%8
   140            C        
   141            C        ;---------------- Deal with DataA/DataB/DataC/DataD/DataG-----------------
   142            C          if RokerSampingType == 0
   143            C        	CALL                ADC_Rocker_KeyScan
   144            C          elseif RokerSampingType == 1
   145            C        	CALL                IO_Rocker_KeyScan
   146            C          elseif RokerSampingType == 2
   147 010EA 1261 C        	CALL                TP_Rocker_KeyScan
   148            C        
   149            C          if TP_T_DEBUG == 1
   150            C        	;BANK                0
   151            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   152            C        	;XOR                 PORT8,A
   153            C          endif
   154            C        
   155            C          endif
   156            C        
   157 010EB 0000 C        	NOP
   158 010EC 11F4 C        	CALL                Rocker_KeyScan
   159 010ED 0000 C        	NOP
   160 010EE 1168 C        	CALL                Direction_KeyCheck
   161            C        
   162            C        ;-----------------------deal with DataE------------------------------------------
   163            C        ; bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0
   164            C        ; A_1   B_2   C_3   D_4   L1_5  R1_6  L2_7  R2_8
   165            C        ;--------------------------------------------------------------------------------
   166 010EF 00D0 C        	CLR                 TEMP
   167            C      M 	MOVB                TEMP,A_1,LINE2_KEY_INPUT_CACHE,_A
       010F0 0FFC     1     JBS  LINE2_KEY_INPUT_CACHE , _A 
       010F1 0810     1     BC  TEMP , A_1 
       010F2 0DFC     1     JBC  LINE2_KEY_INPUT_CACHE , _A 
       010F3 0A10     1     BS  TEMP , A_1 
   168            C      M 	MOVB                TEMP,B_2,LINE3_KEY_INPUT_CACHE,_B
       010F4 0FBD     1     JBS  LINE3_KEY_INPUT_CACHE , _B 
       010F5 0850     1     BC  TEMP , B_2 
       010F6 0DBD     1     JBC  LINE3_KEY_INPUT_CACHE , _B 
       010F7 0A50     1     BS  TEMP , B_2 
   169            C      M 	MOVB                TEMP,C_3,LINE4_KEY_INPUT_CACHE,_C
       010F8 0F7E     1     JBS  LINE4_KEY_INPUT_CACHE , _C 
       010F9 0890     1     BC  TEMP , C_3 
       010FA 0D7E     1     JBC  LINE4_KEY_INPUT_CACHE , _C 
       010FB 0A90     1     BS  TEMP , C_3 
   170            C      M 	MOVB                TEMP,D_4,LINE5_KEY_INPUT_CACHE,_D
       010FC 0F3F     1     JBS  LINE5_KEY_INPUT_CACHE , _D 
       010FD 08D0     1     BC  TEMP , D_4 
       010FE 0D3F     1     JBC  LINE5_KEY_INPUT_CACHE , _D 
       010FF 0AD0     1     BS  TEMP , D_4 
   171            C      M 	MOVB                TEMP,L1_5,LINE3_KEY_INPUT_CACHE,_L1
       01100 0FFD     1     JBS  LINE3_KEY_INPUT_CACHE , _L1 
       01101 0910     1     BC  TEMP , L1_5 
       01102 0DFD     1     JBC  LINE3_KEY_INPUT_CACHE , _L1 
       01103 0B10     1     BS  TEMP , L1_5 
   172            C      M 	MOVB                TEMP,R1_6,LINE4_KEY_INPUT_CACHE,_R1
       01104 0FBE     1     JBS  LINE4_KEY_INPUT_CACHE , _R1 
       01105 0950     1     BC  TEMP , R1_6 
       01106 0DBE     1     JBC  LINE4_KEY_INPUT_CACHE , _R1 
       01107 0B50     1     BS  TEMP , R1_6 
   173            C      M 	MOVB                TEMP,L2_7,LINE2_KEY_INPUT_CACHE,_L2
       01108 0F7C     1     JBS  LINE2_KEY_INPUT_CACHE , _L2 
       01109 0990     1     BC  TEMP , L2_7 
       0110A 0D7C     1     JBC  LINE2_KEY_INPUT_CACHE , _L2 
       0110B 0B90     1     BS  TEMP , L2_7 
   174            C      M 	MOVB                TEMP,R2_8,LINE3_KEY_INPUT_CACHE,_R2
       0110C 0F3D     1     JBS  LINE3_KEY_INPUT_CACHE , _R2 
       0110D 09D0     1     BC  TEMP , R2_8 
       0110E 0D3D     1     JBC  LINE3_KEY_INPUT_CACHE , _R2 
       0110F 0BD0     1     BS  TEMP , R2_8 
   175 01110 0410 C        	MOV                 A,TEMP
   176 01111 0265 C        	OR                  DataE,A
   177            C        
   178            C        ;-----------------------deal with DataF------------------------------------------
   179            C        ; bit0      bit1      bit2     bit3     bit4     bit5      bit6      bit7
   180            C        ; Select_9  Start_10  LSW_11   RSW_12   MODE_13  MACRO_14  TEST1_15  TEST2_16
   181            C        ;--------------------------------------------------------------------------------
   182            C        	;CLR                 DataF
   183            C      M 	MOVB                DataF,SELECT_9,LINE4_KEY_INPUT_CACHE,_Select
       01112 0FFE     1     JBS  LINE4_KEY_INPUT_CACHE , _SELECT 
       01113 0826     1     BC  DATAF , SELECT_9 
       01114 0DFE     1     JBC  LINE4_KEY_INPUT_CACHE , _SELECT 
       01115 0A26     1     BS  DATAF , SELECT_9 
   184            C      M 	MOVB                DataF,Start_10,LINE5_KEY_INPUT_CACHE,_Start
       01116 0FBF     1     JBS  LINE5_KEY_INPUT_CACHE , _START 
       01117 0866     1     BC  DATAF , START_10 
       01118 0DBF     1     JBC  LINE5_KEY_INPUT_CACHE , _START 
       01119 0A66     1     BS  DATAF , START_10 
   185            C      M 	MOVB                DataF,LSW_11,LINE5_KEY_INPUT_CACHE,_LSW
       0111A 0FFF     1     JBS  LINE5_KEY_INPUT_CACHE , _LSW 
       0111B 08A6     1     BC  DATAF , LSW_11 
       0111C 0DFF     1     JBC  LINE5_KEY_INPUT_CACHE , _LSW 
       0111D 0AA6     1     BS  DATAF , LSW_11 
   186            C      M 	MOVB                DataF,RSW_12,LINE2_KEY_INPUT_CACHE,_RSW
       0111E 0F3C     1     JBS  LINE2_KEY_INPUT_CACHE , _RSW 
       0111F 08E6     1     BC  DATAF , RSW_12 
       01120 0D3C     1     JBC  LINE2_KEY_INPUT_CACHE , _RSW 
       01121 0AE6     1     BS  DATAF , RSW_12 
   187            C        	;MOVB                DataF,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE
   188            C      M 	MOVB                DataF,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO
       01122 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       01123 0966     1     BC  DATAF , MACRO_14 
       01124 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       01125 0B66     1     BS  DATAF , MACRO_14 
   189            C      M 	MOVB                DataF,TEST1_15,LINE2_KEY_INPUT_CACHE,_TEST1
       01126 0FBC     1     JBS  LINE2_KEY_INPUT_CACHE , _TEST1 
       01127 09A6     1     BC  DATAF , TEST1_15 
       01128 0DBC     1     JBC  LINE2_KEY_INPUT_CACHE , _TEST1 
       01129 0BA6     1     BS  DATAF , TEST1_15 
   190            C      M 	MOVB                DataF,TEST2_16,LINE5_KEY_INPUT_CACHE,_TEST2
       0112A 0F7F     1     JBS  LINE5_KEY_INPUT_CACHE , _TEST2 
       0112B 09E6     1     BC  DATAF , TEST2_16 
       0112C 0D7F     1     JBC  LINE5_KEY_INPUT_CACHE , _TEST2 
       0112D 0BE6     1     BS  DATAF , TEST2_16 
   191 0112E 0012 C        	RET
   192            C        
   193            C        
   194            C        ;===========================================================================
   195            C        ;Scan data form keyboard port
   196            C        ;===========================================================================
   197 0112F      C        KeyPort_Check:
   198            C        ;LINE1:	read direct data from PortB to LINE1_KEY_INPUT
   199 0112F 1E00 C        	BANK                0
   200 01130 040B C        	MOV                 A,PORTB		;PortB = 00110110
   201 01131 1E02 C        	BANK                2
   202 01132 007B C        	MOV                 LINE1_KEY_INPUT_CACHE,A
   203 01133 04FB C        	COM                 LINE1_KEY_INPUT_CACHE
   204 01134 180F C        	MOV                 A,@_Directions
   205 01135 02FB C        	AND                 LINE1_KEY_INPUT_CACHE,A
   206            C        
   207            C        ;LINE2:	;SET P77=1 P76=1 P75=1 P74=0
   208 01136 1E00 C        	BANK                0
   209 01137 18E8 C        	MOV                 A,@11101000B
   210 01138 0047 C        	MOV                 PORT7,A
   211 01139 11EC C        	CALL                KEY_DELAY
   212 0113A 0409 C        	MOV                 A,PORT9
   213 0113B 1E02 C        	BANK                2
   214 0113C 007C C        	MOV                 LINE2_KEY_INPUT_CACHE,A
   215 0113D 04FC C        	COM                 LINE2_KEY_INPUT_CACHE
   216 0113E 18F0 C        	MOV                 A,@0XF0
   217 0113F 02FC C        	AND                 LINE2_KEY_INPUT_CACHE,A
   218            C        
   219            C        ;LINE3:	;SET P77=1 P76=1 P75=0 P74=1
   220 01140 1E00 C        	BANK                0
   221 01141 18D8 C        	MOV                 A,@11011000B
   222 01142 0047 C        	MOV                 PORT7,A
   223 01143 11EC C        	CALL                KEY_DELAY
   224 01144 0409 C        	MOV                 A,PORT9
   225 01145 1E02 C        	BANK                2
   226 01146 007D C        	MOV                 LINE3_KEY_INPUT_CACHE,A
   227 01147 04FD C        	COM                 LINE3_KEY_INPUT_CACHE
   228 01148 18F0 C        	MOV                 A,@0XF0
   229 01149 02FD C        	AND                 LINE3_KEY_INPUT_CACHE,A
   230            C        
   231            C        ;LINE4:	;SET P77=1 P76=0 P75=1 P74=1
   232 0114A 1E00 C        	BANK                0
   233 0114B 18B8 C        	MOV                 A,@10111000B
   234 0114C 0047 C        	MOV                 PORT7,A
   235 0114D 11EC C        	CALL                KEY_DELAY
   236 0114E 0409 C        	MOV                 A,PORT9
   237 0114F 1E02 C        	BANK                2
   238 01150 007E C        	MOV                 LINE4_KEY_INPUT_CACHE,A
   239 01151 04FE C        	COM                 LINE4_KEY_INPUT_CACHE
   240 01152 18F0 C        	MOV                 A,@0XF0
   241 01153 02FE C        	AND                 LINE4_KEY_INPUT_CACHE,A
   242            C        
   243            C        ;LINE5:	;SET P77=0 P76=1 P75=1 P74=1
   244 01154 1E00 C        	BANK                0
   245 01155 1878 C        	MOV                 A,@01111000B
   246 01156 0047 C        	MOV                 PORT7,A
   247 01157 11EC C        	CALL                KEY_DELAY
   248 01158 0409 C        	MOV                 A,PORT9
   249 01159 1E02 C        	BANK                2
   250 0115A 007F C        	MOV                 LINE5_KEY_INPUT_CACHE,A
   251 0115B 04FF C        	COM                 LINE5_KEY_INPUT_CACHE
   252 0115C 18F0 C        	MOV                 A,@0XF0
   253 0115D 02FF C        	AND                 LINE5_KEY_INPUT_CACHE,A
   254            C        
   255            C        ;----------------------------------------------------------------
   256            C      M 	MOVB                KeyTempFlag,MODE_13,LINE3_KEY_INPUT_CACHE,_MODE  ;save MODE FLAG
       0115E 0F7D     1     JBS  LINE3_KEY_INPUT_CACHE , _MODE 
       0115F 0939     1     BC  KEYTEMPFLAG , MODE_13 
       01160 0D7D     1     JBC  LINE3_KEY_INPUT_CACHE , _MODE 
       01161 0B39     1     BS  KEYTEMPFLAG , MODE_13 
   257            C      M 	MOVB                KeyTempFlag,MACRO_14,LINE4_KEY_INPUT_CACHE,_MACRO ;save MACRO FLAG
       01162 0F3E     1     JBS  LINE4_KEY_INPUT_CACHE , _MACRO 
       01163 0979     1     BC  KEYTEMPFLAG , MACRO_14 
       01164 0D3E     1     JBC  LINE4_KEY_INPUT_CACHE , _MACRO 
       01165 0B79     1     BS  KEYTEMPFLAG , MACRO_14 
   258 01166 0000 C        	NOP
   259 01167 0012 C        	RET
   260            C        
   261            C        
   262            C        ;==============================================================================
   263            C        ;=======================Direction key board scan===============================
   264            C        ;==============================================================================
   265            C        ;------------------------deal with DataA/DataB---------------------------------
   266            C        ;DataA	left-right: left=0x00, right=0xff, no-left-right=0x7f
   267            C        ;DataB	up-down:    down=0x00, up=0xff,    no-left-right=0x7f
   268            C        ;DataG  000:00 001:45 010:90 011:135 100:180 101:225 110:270 111:315
   269            C        ;------------------------------------------------------------------------------
   270 01168      C        Direction_KeyCheck:
   271 01168 0F26 C        	JBS                 DataF,MODE_13
   272 01169 156B C        	JMP                 DealWith_Direction_Digital
   273 0116A 15AA C        	JMP                 DealWith_HatSwitch_Analog
   274            C        
   275 0116B      C        DealWith_Direction_Digital:
   276 0116B      C        LEFT_RIGHT_KEY:
   277 0116B 0C3B C        	JBC                 LINE1_KEY_INPUT_CACHE,_RIGHT   ;judge right
   278 0116C 1570 C        	JMP                 JudgeRight
   279 0116D 0C7B C        	JBC                 LINE1_KEY_INPUT_CACHE,_LEFT    ;judeg left
   280 0116E 157B C        	JMP                 JudgeLeft
   281 0116F 1585 C        	JMP                 Left_Right_Finsh
   282 01170      C          JudgeRight:
   283 01170 1800 C        	MOV                 A,@0X00
   284 01171 0321 C        	XOR                 A,DataA
   285 01172 0E83 C        	JBS                 STATUS,Z
   286 01173 1575 C        	JMP                 JudgeRight_1
   287 01174 1577 C        	JMP                 JudgeRight_2
   288 01175      C          JudgeRight_1:
   289 01175 18FF C        	MOV                 A,@0XFF
   290 01176 1579 C        	JMP                 JudgeRight_End
   291 01177      C          JudgeRight_2:
   292 01177 187F C        	MOV                 A,@0X7F
   293 01178 1579 C        	JMP                 JudgeRight_End
   294 01179      C          JudgeRight_End:
   295 01179 0061 C        	MOV                 DataA,A
   296 0117A 1585 C        	JMP                 Left_Right_Finsh
   297            C        
   298 0117B      C          JudgeLeft:
   299 0117B 18FF C        	MOV                 A,@0XFF
   300 0117C 0321 C        	XOR                 A,DataA
   301 0117D 0E83 C        	JBS                 STATUS,Z
   302 0117E 1580 C        	JMP                 JudgeLeft_1  ;Z=0,sameness
   303 0117F 1582 C        	JMP                 JudgeLeft_2  ;Z=1,reverse
   304 01180      C          JudgeLeft_1:
   305 01180 1800 C        	MOV                 A,@0X00
   306 01181 1584 C        	JMP                 JudgeLeft_End
   307 01182      C          JudgeLeft_2:
   308 01182 187F C        	MOV                 A,@0X7F
   309 01183 1584 C        	JMP                 JudgeLeft_End
   310 01184      C          JudgeLeft_End:
   311 01184 0061 C        	MOV                 DataA,A
   312 01185      C          Left_Right_Finsh:
   313 01185 0000 C        	NOP
   314            C        ;--------------------------------------------------------------
   315 01186      C        UP_DOWN_KEY:
   316 01186 0CFB C        	JBC                 LINE1_KEY_INPUT_CACHE,_UP     ;judge up(0X00)
   317 01187 1596 C        	JMP                 JudgeDown
   318 01188 0CBB C        	JBC                 LINE1_KEY_INPUT_CACHE,_DOWN   ;judeg down(0XFF)
   319 01189 158B C        	JMP                 JudgeUp
   320 0118A 15A1 C        	JMP                 UP_DOWN_Finsh
   321 0118B      C          JudgeUp:
   322 0118B 1800 C        	MOV                 A,@0X00
   323 0118C 0322 C        	XOR                 A,DataB
   324 0118D 0E83 C        	JBS                 STATUS,Z
   325 0118E 1590 C        	JMP                 JudgeUp_1
   326 0118F 1592 C        	JMP                 JudgeUp_2
   327 01190      C          JudgeUp_1:
   328 01190 18FF C        	MOV                 A,@0XFF
   329 01191 1594 C        	JMP                 JudgeUp_End
   330 01192      C          JudgeUp_2:
   331 01192 187F C        	MOV                 A,@0X7F
   332 01193 1594 C        	JMP                 JudgeUp_End
   333 01194      C          JudgeUp_End:
   334 01194 0062 C        	MOV                 DataB,A
   335 01195 15A1 C        	JMP                 UP_DOWN_Finsh
   336            C        
   337 01196      C          JudgeDown:
   338 01196 18FF C        	MOV                 A,@0XFF
   339 01197 0322 C        	XOR                 A,DataB
   340 01198 0E83 C        	JBS                 STATUS,Z
   341 01199 159B C        	JMP                 JudgeDown_1
   342 0119A 159D C        	JMP                 JudgeDown_2
   343 0119B      C          JudgeDown_1:
   344 0119B 1800 C        	MOV                 A,@0X00
   345 0119C 159F C        	JMP                 JudgeDown_End
   346 0119D      C          JudgeDown_2:
   347 0119D 187F C        	MOV                 A,@0X7F
   348 0119E 159F C        	JMP                 JudgeDown_End
   349 0119F      C          JudgeDown_End:
   350 0119F 0062 C        	MOV                 DataB,A
   351 011A0 15A1 C        	JMP                 UP_DOWN_Finsh
   352 011A1      C          UP_DOWN_Finsh:
   353 011A1 0000 C        	NOP
   354 011A2 187F C        	MOV                 A,@0X7F
   355 011A3 0063 C        	MOV                 DataC,A
   356 011A4 0064 C        	MOV                 DataD,A
   357 011A5 180F C          	MOV                 A,@0X0F
   358 011A6 0067 C          	MOV                 DataG,A
   359 011A7 0000 C        	NOP
   360 011A8 0012 C        	RET
   361 011A9 0000 C        	NOP
   362            C        
   363            C        ;----------------------------------------------------
   364 011AA      C        DealWith_HatSwitch_Analog:
   365 011AA 00E5 C        	CLR                 DataE
   366 011AB 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   367 011AC 1B00 C        	XOR                 A,@0B00000000
   368 011AD 0E83 C        	JBS                 STATUS,Z
   369 011AE 15B2 C        	JMP                 DATAG_0
   370            C      M 	MOV                 DataG,@0X0F          ;none
       011AF 180F     1     MOV A,@( 15 )
       011B0 0067     1     MOV  DATAG ,A
   371 011B1 15EA C        	JMP                 HAT_SWITCH_END
   372 011B2      C          DataG_0:
   373 011B2 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   374 011B3 1B20 C        	XOR                 A,@0B00100000
   375 011B4 0E83 C        	JBS                 STATUS,Z
   376 011B5 15B9 C        	JMP                 DataG_45
   377            C      M 	MOV                 DataG,@0X00          ;0
       011B6 1800     1     MOV A,@( 0 )
       011B7 0067     1     MOV  DATAG ,A
   378 011B8 15EA C        	JMP                 HAT_SWITCH_END
   379 011B9      C          DataG_45:
   380 011B9 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   381 011BA 1B30 C        	XOR                 A,@0B00110000
   382 011BB 0E83 C        	JBS                 STATUS,Z
   383 011BC 15C0 C        	JMP                 DataG_90
   384            C      M 	MOV                 DataG,@0X01          ;45
       011BD 1801     1     MOV A,@( 1 )
       011BE 0067     1     MOV  DATAG ,A
   385 011BF 15EA C        	JMP                 HAT_SWITCH_END
   386 011C0      C          DataG_90:
   387 011C0 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   388 011C1 1B10 C        	XOR                 A,@0B00010000
   389 011C2 0E83 C        	JBS                 STATUS,Z
   390 011C3 15C7 C        	JMP                 DataG_135
   391            C      M 	MOV                 DataG,@0X02          ;90
       011C4 1802     1     MOV A,@( 2 )
       011C5 0067     1     MOV  DATAG ,A
   392 011C6 15EA C        	JMP                 HAT_SWITCH_END
   393 011C7      C          DataG_135:
   394 011C7 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   395 011C8 1B14 C        	XOR                 A,@0B00010100
   396 011C9 0E83 C        	JBS                 STATUS,Z
   397 011CA 15CE C        	JMP                 DataG_180
   398            C      M 	MOV                 DataG,@0X03          ;135
       011CB 1803     1     MOV A,@( 3 )
       011CC 0067     1     MOV  DATAG ,A
   399 011CD 15EA C        	JMP                 HAT_SWITCH_END
   400 011CE      C          DataG_180:
   401 011CE 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   402 011CF 1B04 C        	XOR                 A,@0B00000100
   403 011D0 0E83 C        	JBS                 STATUS,Z
   404 011D1 15D5 C        	JMP                 DataG_225
   405            C      M 	MOV                 DataG,@0X04          ;180
       011D2 1804     1     MOV A,@( 4 )
       011D3 0067     1     MOV  DATAG ,A
   406 011D4 15EA C        	JMP                 HAT_SWITCH_END
   407 011D5      C          DataG_225:
   408 011D5 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   409 011D6 1B06 C        	XOR                 A,@0B00000110
   410 011D7 0E83 C        	JBS                 STATUS,Z
   411 011D8 15DC C        	JMP                 DataG_270
   412            C      M 	MOV                 DataG,@0X05          ;225
       011D9 1805     1     MOV A,@( 5 )
       011DA 0067     1     MOV  DATAG ,A
   413 011DB 15EA C        	JMP                 HAT_SWITCH_END
   414 011DC      C          DataG_270:
   415 011DC 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   416 011DD 1B02 C        	XOR                 A,@0B00000010
   417 011DE 0E83 C        	JBS                 STATUS,Z
   418 011DF 15E3 C        	JMP                 DataG_315
   419            C      M 	MOV                 DataG,@0X06          ;270
       011E0 1806     1     MOV A,@( 6 )
       011E1 0067     1     MOV  DATAG ,A
   420 011E2 15EA C        	JMP                 HAT_SWITCH_END
   421 011E3      C          DataG_315:
   422 011E3 043B C        	MOV                 A,LINE1_KEY_INPUT_CACHE
   423 011E4 1B22 C        	XOR                 A,@0B00100010
   424 011E5 0E83 C        	JBS                 STATUS,Z
   425 011E6 15EA C        	JMP                 HAT_SWITCH_END
   426            C      M 	MOV                 DataG,@0X07          ;315
       011E7 1807     1     MOV A,@( 7 )
       011E8 0067     1     MOV  DATAG ,A
   427 011E9 15EA C        	JMP                 HAT_SWITCH_END
   428            C        
   429 011EA      C          HAT_SWITCH_END:
   430 011EA 0000 C        	NOP
   431 011EB 0012 C        	RET
   432            C        
   433            C        ;===================================================================
   434            C        ; Delay function
   435            C        ;===================================================================
   436 011EC      C        KEY_DELAY:
   437 011EC 0000 C        	NOP
   438 011ED 0000 C        	NOP
   439 011EE 0000 C        	NOP
   440 011EF 0000 C        	NOP
   441 011F0 0000 C        	NOP
   442 011F1 0000 C        	NOP
   443 011F2 0000 C        	NOP
   444 011F3 0012 C        	RET
   445            C        
   446            C        ;===================================================================
   447            C        ; jugde rocker signal select
   448            C        ;===================================================================
   449 011F4      C        Rocker_KeyScan:
   450 011F4 1E02 C        	BANK                2
   451 011F5 0F26 C        	JBS                 DataF,MODE_13       ;select digital or analog
   452 011F6 15F8 C        	JMP                 DealWith_ADC_Digital
   453 011F7 160E C        	JMP                 DealWith_ADC_Analog
   454            C        
   455 011F8      C          DealWith_ADC_Digital:
   456 011F8 00E1 C        	CLR                 DataA
   457 011F9 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   458 011FA 0051 C        	MOV                 TEMP1,A
   459 011FB 1219 C        	CALL                AreaJudge_direction
   460 011FC 0061 C        	MOV                 DataA,A
   461            C        
   462 011FD 00E2 C        	CLR                 DataB
   463 011FE 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   464 011FF 0051 C        	MOV                 TEMP1,A
   465 01200 1219 C        	CALL                AreaJudge_direction
   466 01201 0062 C        	MOV                 DataB,A
   467            C        
   468 01202 187F C        	MOV                 A,@0X7F
   469 01203 0063 C        	MOV                 DataC,A
   470 01204 0064 C        	MOV                 DataD,A
   471            C        
   472 01205 00E5 C        	CLR                 DataE
   473 01206 0432 C        	MOV                 A,KEY_RIGHT_X		;A,B,C,D,
   474 01207 0052 C        	MOV                 TEMP2,A
   475 01208 0433 C        	MOV                 A,KEY_RIGHT_Y
   476 01209 0053 C        	MOV                 TEMP3,A
   477 0120A 122B C        	CALL                AreaJudge_Button
   478 0120B 0410 C        	MOV                 A,TEMP
   479 0120C 0065 C        	MOV                 DataE,A
   480 0120D 1617 C        	JMP                 RockerCheakFinish
   481            C        
   482 0120E      C          DealWith_ADC_Analog:
   483 0120E 0430 C        	MOV                 A,KEY_LEFT_X		;L-left_right
   484 0120F 0061 C        	MOV                 DataA,A
   485 01210 0431 C        	MOV                 A,KEY_LEFT_Y		;L-up_down
   486 01211 0062 C        	MOV                 DataB,A
   487 01212 0432 C        	MOV                 A,KEY_RIGHT_X		;R-left_right
   488 01213 0063 C        	MOV                 DataC,A
   489 01214 0433 C        	MOV                 A,KEY_RIGHT_Y		;R-up_down
   490 01215 0064 C        	MOV                 DataD,A
   491 01216 1617 C        	JMP                 RockerCheakFinish
   492            C        
   493 01217      C          RockerCheakFinish:
   494 01217 0000 C        	NOP
   495 01218 0012 C        	RET
   496            C        
   497            C        ;=============================jugde the direction=====================================
   498            C        ;Input:      TEMP1
   499            C        ;output:     A
   500            C        ;=====================================================================================
   501 01219      C        AreaJudge_direction:
   502 01219 1E02 C        	BANK                2
   503 0121A 0411 C        	MOV                 A,TEMP1     ;Store
   504 0121B 1DBF C        	SUB                 A,@0XBF
   505 0121C 0E03 C        	JBS                 R3,0        ;R3,bit0(C)
   506 0121D 161F C        	JMP                 CheakTop_Left
   507 0121E 1621 C        	JMP                 CheakMiddle_Left
   508 0121F      C          CheakTop_Left:
   509 0121F 18FF C        	MOV                 A,@0XFF   ;up
   510 01220 1629 C        	JMP                 CheakAreaFinish_Left
   511 01221      C          CheakMiddle_Left:
   512 01221 0411 C        	MOV                 A,TEMP1
   513 01222 1D40 C        	SUB                 A,@0X40
   514 01223 0C03 C        	JBC                 R3,0
   515 01224 1627 C        	JMP                 CheakBottom_Left
   516 01225 187F C        	MOV                 A,@0X7F
   517 01226 1629 C        	JMP                 CheakAreaFinish_Left
   518 01227      C          CheakBottom_Left:
   519 01227 1800 C        	MOV                 A,@0X00   ;down
   520 01228 1629 C        	JMP                 CheakAreaFinish_Left
   521 01229      C          CheakAreaFinish_Left:
   522 01229 0000 C        	NOP
   523 0122A 0012 C        	RET
   524            C        
   525            C        
   526            C        ;============================jugde what button press============================
   527            C        ;input:     TEMP2,TEMP3
   528            C        ;output:    TEMP
   529            C        ;===============================================================================
   530 0122B      C        AreaJudge_Button:
   531 0122B 1E02 C        	BANK                2
   532 0122C 0412 C        	MOV                 A,TEMP2    ;KEY_RIGHT_Y
   533 0122D 1DD0 C        	SUB                 A,@0XD0
   534 0122E 0E03 C        	JBS                 R3,C	     ;R3,bit0(C)
   535 0122F 1631 C        	JMP                 CheakTop_Right_y
   536 01230 1633 C        	JMP                 CheakMiddle_Right_y
   537            C        
   538 01231      C          CheakTop_Right_y:
   539 01231 18FF C        	MOV                 A,@0XFF  ;up
   540 01232 163B C        	JMP                 CheakAreaFinish_Right_y
   541 01233      C          CheakMiddle_Right_y:
   542 01233 0412 C        	MOV                 A,TEMP2
   543 01234 1D25 C        	SUB                 A,@0X25
   544 01235 0E03 C        	JBS                 R3,C
   545 01236 1639 C        	JMP                 CheakBottom_Right_y
   546 01237 1800 C        	MOV                 A,@0X00  ;dwon
   547 01238 163B C        	JMP                 CheakAreaFinish_Right_y
   548 01239      C          CheakBottom_Right_y:
   549 01239 187F C        	MOV                 A,@0X7F
   550 0123A 163B C        	JMP                 CheakAreaFinish_Right_y
   551 0123B      C          CheakAreaFinish_Right_y:
   552 0123B 0052 C        	MOV                 TEMP2,A
   553 0123C 0000 C        	NOP
   554            C        ;---------------------------------------------------
   555 0123D 1E02 C        	BANK                2
   556 0123E 0413 C        	MOV                 A,TEMP3    ;KEY_RIGHT_Y
   557 0123F 1DD0 C        	SUB                 A,@0XD0
   558 01240 0E03 C        	JBS                 R3,C       ;R3,bit0(C)
   559 01241 1643 C        	JMP                 CheakTop_Right_x
   560 01242 1645 C        	JMP                 CheakMiddle_Right_x
   561 01243      C          CheakTop_Right_x:
   562 01243 18FF C        	MOV                 A,@0XFF   ;right
   563 01244 164D C        	JMP                 CheakAreaFinish_Right_x
   564 01245      C          CheakMiddle_Right_x:
   565 01245 0413 C        	MOV                 A,TEMP3
   566 01246 1D25 C        	SUB                 A,@0X25
   567 01247 0E03 C        	JBS                 R3,0
   568 01248 164B C        	JMP                 CheakBottom_Right_x
   569 01249 1800 C        	MOV                 A,@0X00   ;left
   570 0124A 164D C        	JMP                 CheakAreaFinish_Right_x
   571 0124B      C          CheakBottom_Right_x:
   572 0124B 187F C        	MOV                 A,@0X7F
   573 0124C 164D C        	JMP                 CheakAreaFinish_Right_x
   574 0124D      C          CheakAreaFinish_Right_x:
   575 0124D 0053 C        	MOV                 TEMP3,A
   576 0124E 0000 C        	NOP
   577            C        
   578            C        ;-----------------------------------------------------
   579 0124F 00D0 C        	CLR                 TEMP
   580 01250 0412 C        	MOV                 A,TEMP2      ;left
   581 01251 1B00 C        	XOR                 A,@0X00
   582 01252 0C83 C        	JBC                 STATUS,Z
   583 01253 0A10 C        	BS                  TEMP,A_1
   584            C        
   585 01254 0412 C        	MOV                 A,TEMP2      ;right
   586 01255 1BFF C        	XOR                 A,@0XFF
   587 01256 0C83 C        	JBC                 STATUS,Z
   588 01257 0A90 C        	BS                  TEMP,C_3
   589            C        
   590 01258 0413 C        	MOV                 A,TEMP3      ;down
   591 01259 1BFF C        	XOR                 A,@0XFF
   592 0125A 0C83 C        	JBC                 STATUS,Z
   593 0125B 0AD0 C        	BS                  TEMP,D_4
   594            C        
   595 0125C 0413 C        	MOV                 A,TEMP3      ;up
   596 0125D 1B00 C        	XOR                 A,@0X00
   597 0125E 0C83 C        	JBC                 STATUS,Z
   598 0125F 0A50 C        	BS                  TEMP,B_2
   599 01260 0012 C        	RET
   600            C        
   601            C        
   602            C        ;****************************************************************
   603            C          if RokerSampingType == 0
   604            C        ;****************************************************************
   605            C        ;============================================================================
   606            C        ;file name:     ADC 3D Rocker KeyScan
   607            C        ;INPUT PORT:
   608            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   609            C        ;TIME:          1050uS
   610            C        ;Descrition:    Use for check AD rocker data
   611            C        ;============================================================================
   612            C        ADC_Rocker_KeyScan:
   613            C        	BANK                 3
   614            C        	BS                   ADCR,ADP
   615            C        	CLR                  ADDH
   616            C        	MOV                  A,ADCR
   617            C        	AND                  A,@0B11110000
   618            C        	OR                   A,@0B00000000
   619            C        	MOV                  ADCR,A              ;Select ADE0/P93.Rx
   620            C        	CALL                 SUB_ADC
   621            C        	MOV                  A,ADDH
   622            C        	BANK                 2
   623            C        	MOV                  KEY_RIGHT_X,A
   624            C        
   625            C        	BANK                 3
   626            C        	CLR                  ADDH
   627            C        	MOV                  A,ADCR
   628            C        	AND                  A,@0B11110000
   629            C        	OR                   A,@0B00000001
   630            C        	MOV                  ADCR,A              ;Select ADE1/P92.Ry
   631            C        	MOV                  A,@5
   632            C        	LCALL                DELAY_X10US
   633            C        	CALL                 SUB_ADC
   634            C        	MOV                  A,ADDH
   635            C        	BANK                 2
   636            C        	MOV                  KEY_RIGHT_Y,A
   637            C        	;COM                  KEY_RIGHT_Y
   638            C        
   639            C        	BANK                 3
   640            C        	CLR                  ADDH
   641            C        	MOV                  A,ADCR
   642            C        	AND                  A,@0B11110000
   643            C        	OR                   A,@0B00000010
   644            C        	MOV                  ADCR,A              ;Select ADE2/P91.Lx
   645            C        	MOV                  A,@5
   646            C        	LCALL                DELAY_X10US
   647            C        	CALL                 SUB_ADC
   648            C        	MOV                  A,ADDH
   649            C        	BANK                 2
   650            C        	MOV                  KEY_LEFT_X,A
   651            C        
   652            C        	BANK                 3
   653            C        	CLR                  ADDH
   654            C        	MOV                  A,ADCR
   655            C        	AND                  A,@0B11110000
   656            C        	OR                   A,@0B00000011
   657            C        	MOV                  ADCR,A              ;Select ADE3/P90.Ly
   658            C        	MOV                  A,@5
   659            C        	LCALL                DELAY_X10US
   660            C        	CALL                 SUB_ADC
   661            C        	MOV                  A,ADDH
   662            C        	BANK                 2
   663            C        	MOV                  KEY_LEFT_Y,A
   664            C        	;COM                  KEY_LEFT_Y
   665            C        	BANK                 3
   666            C        	BC                   ADCR,ADP
   667            C        
   668            C        	;bank                 2
   669            C        	;mov                  a,@0x7f
   670            C        	;mov                  key_right_x,a
   671            C        	;mov                  key_right_y,a
   672            C        	;mov                  key_left_x,a
   673            C        	;mov                  key_left_y,a
   674            C        
   675            C        	NOP
   676            C        	RET
   677            C        
   678            C        
   679            C        
   680            C        ;===================================================================
   681            C        SUB_ADJ:
   682            C        	BANK                3
   683            C        	BS                  ADICH,CALI    ;ENABLE CALIBRATION
   684            C          ADCJUDGE_LOOP:
   685            C        	BS                  ADCR,ADRUN
   686            C        	JBC                 ADCR,ADRUN
   687            C        	JMP                 $-1
   688            C        
   689            C        	MOV                 A,ADDL
   690            C        	AND                 A,@0X0F
   691            C        	JBS                 R3,Z
   692            C        	JMP                 ADCJUDGE_DONE
   693            C        	MOV                 A,ADDH
   694            C        	JBS                 R3,Z
   695            C        	JMP                 ADCJUDGE_DONE
   696            C        	MOV                 A,@0X10
   697            C        	ADD                 ADDL,A
   698            C        	JMP                 ADCJUDGE_LOOP
   699            C          ADCJUDGE_DONE:
   700            C        	BC                  ADICH,CALI
   701            C        	RET
   702            C        
   703            C        ;===================================================================
   704            C        SUB_RINIT:
   705            C        	BANK                3
   706            C        	MOV                 A,@0X0F
   707            C        	MOV                 ADICL,A      ;SELECT ADE0~ ADE3 AS ANALOG INPUT
   708            C        	CLR                 ADICH         ;VREFS==VDD
   709            C        	MOV                 A,@0B01100000
   710            C        	MOV                 ADCR,A       ;SELECT  AD0,SELECT ADCKR1/ADCKR0=1:0,ADP=1
   711            C        	RET
   712            C        
   713            C        ;===================================================================
   714            C        SUB_ADC:
   715            C        	BANK                3
   716            C        	BS                  ADCR,ADRUN
   717            C        	JBC                 ADCR,ADRUN
   718            C        	JMP                 $-1
   719            C        	NOP
   720            C        	RET
   721            C        
   722            C        
   723            C        ;****************************************************************
   724            C          elseif RokerSampingType == 1
   725            C        ;****************************************************************
   726            C        ;============================================================================
   727            C        ;file name:     IO 2D Rocker KeyScan
   728            C        ;INPUT PORT:
   729            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
   730            C        ;TIME:
   731            C        ;Descrition:    Use for check AD rocker data
   732            C        ;============================================================================
   733            C        IO_Rocker_KeyScan:
   734            C        	CALL                Pre_Discharge
   735            C        	CALL                SampingRefTiming   ; Ref
   736            C        	CALL                Pre_Discharge
   737            C        	CALL                SampingLxTiming    ; Lx
   738            C        	CALL                Pre_Discharge
   739            C        	CALL                SampingLyTiming    ; Ly
   740            C        	CALL                Pre_Discharge
   741            C        	CALL                SampingRxTiming    ; Rx
   742            C        	CALL                Pre_Discharge
   743            C        	CALL                SampingRyTiming    ; Ry
   744            C        	CALL                Back_Discharge
   745            C        
   746            C        	BANK                2
   747            C        	MOV                 A,KEY_LEFT_X
   748            C        	CALL                Conversion_Data
   749            C        	MOV                 KEY_LEFT_X,A        ; Left x Axis
   750            C        	MOV                 A,KEY_LEFT_Y
   751            C        	CALL                Conversion_Data
   752            C        	MOV                 KEY_LEFT_Y,A        ; Left y Axis
   753            C        	MOV                 A,KEY_RIGHT_X
   754            C        	CALL                Conversion_Data
   755            C        	MOV                 KEY_RIGHT_X,A       ; right x Axis
   756            C        	MOV                 A,KEY_RIGHT_Y
   757            C        	CALL                Conversion_Data
   758            C        	MOV                 KEY_RIGHT_Y,A       ; right y Axis
   759            C        
   760            C        	NOP
   761            C        	NOP
   762            C        	RET
   763            C        
   764            C        ;---------------------------------------------------------------
   765            C        Pre_Discharge:
   766            C        	BANK                4
   767            C        	MOV                 A,@0B11111111
   768            C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   769            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   770            C        	;BS                  P8IOCR,Reference     ; Input P87
   771            C        	MOV                 A,P8IOCR
   772            C        	AND                 A,@0B00111111
   773            C        	OR                  A,@0B11000000
   774            C        	MOV                 P8IOCR,A             ; Set P87->Input,P86->Input
   775            C        
   776            C        	MOV                 A,@0B11110000
   777            C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   778            C        	BC                  P8IOCR,Leakresis     ; Output P86
   779            C        	BC                  P8IOCR,Reference     ; Output P87
   780            C        	;MOV                 A,P8IOCR
   781            C        	;AND                 A,@0B00111111
   782            C        	;OR                  A,@0B00000000
   783            C        	;MOV                 P8IOCR,A            ; Set P87->Output,P86->Output
   784            C        	BANK                0
   785            C        	CLR                 PORT9
   786            C        	;BC                  PORT9,LeftYAxis
   787            C        	;BC                  PORT9,LeftXAxis
   788            C        	;BC                  PORT9,RightYAxis
   789            C        	;BC                  PORT9,RightXAxis
   790            C        	BC                  PORT8,Leakresis     ; Set P86 Low
   791            C        	BC                  PORT8,Reference     ; Set P87 Low
   792            C        
   793            C        	CLR                 IMR                ; Disable Timier1/TCC
   794            C        ;  if IOtoADC_T_DEBUG ==1
   795            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   796            C        ;	XOR                 PORT8,A
   797            C        ;  endif
   798            C        	BANK                2
   799            C        	BS                  T2CR,T2EN          ; START
   800            C        	CLR                 IOcheckTimeCNT
   801            C        	MOV                 A,IOcheckTimeCNT
   802            C        	SUB                 A,@LeakresisTimeCNT
   803            C        	JBC                 STATUS,C
   804            C        	JMP                 $-3
   805            C        	BC                  T2CR,T2EN          ; Disable
   806            C        	BANK                0
   807            C        ;  if IOtoADC_T_DEBUG ==1
   808            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   809            C        ;	XOR                 PORT8,A
   810            C        ;  endif
   811            C        	MOV                 A,@0B10000001
   812            C        	MOV                 IMR,A             ; Enable Timier1/TCC
   813            C        	RET
   814            C        
   815            C        Back_Discharge:
   816            C        	BANK                4
   817            C        	MOV                 A,@0B11111111
   818            C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Input
   819            C        	;BS                  P8IOCR,Leakresis     ; Input P86
   820            C        	;BS                  P8IOCR,Reference     ; Input P87
   821            C        	MOV                 A,P8IOCR
   822            C        	AND                 A,@0B00111111
   823            C        	OR                  A,@0B11000000
   824            C        	MOV                 P8IOCR,A            ; Set P87->Input,P86->Input
   825            C        
   826            C        	MOV                 A,@0B11110000
   827            C        	MOV                 P9IOCR,A             ; P97-P94:Input; P93-P90:Output
   828            C        	BC                  P8IOCR,Leakresis     ; Output P86
   829            C        	BC                  P8IOCR,Reference     ; Output P87
   830            C        	;MOV                 A,P8IOCR
   831            C        	;AND                 A,@0B00111111
   832            C        	;OR                  A,@0B10000000
   833            C        	;MOV                 P8IOCR,A            ; Set P87->Input,P86->Output
   834            C        	BANK                0
   835            C        	CLR                 PORT9
   836            C        	;BC                  PORT9,LeftYAxis
   837            C        	;BC                  PORT9,LeftXAxis
   838            C        	;BC                  PORT9,RightYAxis
   839            C        	;BC                  PORT9,RightXAxis
   840            C        	BC                  PORT8,Leakresis     ; Set P86 Low
   841            C        	BC                  PORT8,Reference     ; Set P87 Low
   842            C        	RET
   843            C        
   844            C        ;---------------------------------------------------------------
   845            C        SampingRefTiming:
   846            C        	BANK                4
   847            C        	MOV                 A,@0B11111111
   848            C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93-P90:Input
   849            C        	BS                  P8IOCR,Leakresis    ; Input  P86
   850            C        	BC                  P8IOCR,Reference    ; Output P87
   851            C        	;MOV                 A,P8IOCR
   852            C        	;AND                 A,@0B00111111
   853            C        	;OR                  A,@0B01000000
   854            C        	;MOV                 P8IOCR,A           ; Set P87->Output,P86->Input
   855            C        	BANK                0
   856            C        	;BS                  PORT9,LeftYAxis
   857            C        	;BS                  PORT9,LeftXAxis
   858            C        	;BS                  PORT9,RightYAxis
   859            C        	;BS                  PORT9,RightXAxis
   860            C        	;BS                  PORT8,Leakresis    ; Set P86
   861            C        	BS                  PORT8,Reference     ; Set P87 High
   862            C        
   863            C        	CLR                 IMR                ; Disable Timier1/TCC
   864            C        ;  if IOtoADC_T_DEBUG ==1
   865            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   866            C        ;	XOR                 PORT8,A
   867            C        ;  endif
   868            C        	BANK                2
   869            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   870            C        	;MOV                 T2PD,A
   871            C        	BS                  T2CR,T2EN          ; START
   872            C        	CLR                 IOcheckTimeCNT
   873            C        	BANK                0
   874            C        	JBS                 PORT8,Leakresis
   875            C        	JMP                 $-1
   876            C        	;MOV                 A,@0B10000001
   877            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   878            C        ;  if IOtoADC_T_DEBUG ==1
   879            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   880            C        ;	XOR                 PORT8,A
   881            C        ;  endif
   882            C        	BANK                2
   883            C        	BC                  T2CR,T2EN          ; Disable
   884            C        	MOV                 A,IOcheckTimeCNT
   885            C        	MOV                 IOcheckRefValue,A
   886            C        	BANK                0
   887            C        	MOV                 A,@0B10000001
   888            C        	MOV                 IMR,A             ; Enable Timier1/TCC
   889            C        	RET
   890            C        
   891            C        
   892            C        ;---------------------------------------------------------------
   893            C        SampingLxTiming:
   894            C        	BANK                4
   895            C        	MOV                 A,@0B11111101
   896            C        	MOV                 P9IOCR,A            ; P97-P92:Input; P91:output; P90:Input
   897            C        	BS                  P8IOCR,Leakresis    ; input
   898            C        	BS                  P8IOCR,Reference    ; input
   899            C        	;MOV                 A,P8IOCR
   900            C        	;AND                 A,@0B00111111
   901            C        	;OR                  A,@0B11000000
   902            C        	;MOV                 P8IOCR,A
   903            C        	BANK                0
   904            C        	;BS                  PORT9,LeftYAxis
   905            C        	BS                  PORT9,LeftXAxis     ; Set P91 HIGH
   906            C        	;BS                  PORT9,RightYAxis
   907            C        	;BS                  PORT9,RightXAxis
   908            C        	;BS                  PORT8,Reference    ; Set P87
   909            C        	;BS                  PORT8,Leakresis    ; Set P86
   910            C        
   911            C        	CLR                 IMR                ; Disable Timier1/TCC
   912            C        ;  if IOtoADC_T_DEBUG ==1
   913            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   914            C        ;	XOR                 PORT8,A
   915            C        ;  endif
   916            C        	BANK                2
   917            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   918            C        	;MOV                 T2PD,A
   919            C        	BS                  T2CR,T2EN          ; START
   920            C        	CLR                 IOcheckTimeCNT
   921            C        	BANK                0
   922            C        	JBS                 PORT8,Leakresis
   923            C        	JMP                 $-1
   924            C        	;MOV                 A,@0B10000001
   925            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   926            C        ;  if IOtoADC_T_DEBUG ==1
   927            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   928            C        ;	XOR                 PORT8,A
   929            C        ;  endif
   930            C        	BANK                2
   931            C        	BC                  T2CR,T2EN           ; Disable
   932            C        	MOV                 A,IOcheckTimeCNT
   933            C        	MOV                 KEY_LEFT_X,A
   934            C        	BANK                0
   935            C        	MOV                 A,@0B10000001
   936            C        	MOV                 IMR,A             ; Enable Timier1/TCC
   937            C        	RET
   938            C        
   939            C        ;---------------------------------------------------------------
   940            C        SampingLyTiming:
   941            C        	BANK                4
   942            C        	MOV                 A,@0B11111110
   943            C        	MOV                 P9IOCR,A            ; P97-P91:Input; P90:output
   944            C        	BS                  P8IOCR,Leakresis    ; input P86
   945            C        	BS                  P8IOCR,Reference    ; input P87
   946            C        	;MOV                 A,P8IOCR
   947            C        	;AND                 A,@0B00111111
   948            C        	;OR                  A,@0B11000000
   949            C        	;MOV                 P8IOCR,A
   950            C        	BANK                0
   951            C        	BS                  PORT9,LeftYAxis     ; Set P90 HIGH
   952            C        	;BS                  PORT9,LeftXAxis
   953            C        	;BS                  PORT9,RightYAxis
   954            C        	;BS                  PORT9,RightXAxis
   955            C        	;BS                  PORT8,Reference    ; Set P87
   956            C        	;BS                  PORT8,Leakresis    ; Set P86
   957            C        
   958            C        	CLR                 IMR                ; Disable Timier1/TCC
   959            C        ;  if IOtoADC_T_DEBUG ==1
   960            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   961            C        ;	XOR                 PORT8,A
   962            C        ;  endif
   963            C        	BANK                2
   964            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
   965            C        	;MOV                 T2PD,A
   966            C        	BS                  T2CR,T2EN          ; START
   967            C        	CLR                 IOcheckTimeCNT
   968            C        	BANK                0
   969            C        	JBS                 PORT8,Leakresis
   970            C        	JMP                 $-1
   971            C        	;MOV                 A,@0B10000001
   972            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
   973            C        ;  if IOtoADC_T_DEBUG ==1
   974            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   975            C        ;	XOR                 PORT8,A
   976            C        ;  endif
   977            C        	BANK                2
   978            C        	BC                  T2CR,T2EN           ; Disable
   979            C        	MOV                 A,IOcheckTimeCNT
   980            C        	MOV                 KEY_LEFT_Y,A
   981            C        	BANK                0
   982            C        	MOV                 A,@0B10000001
   983            C        	MOV                 IMR,A             ; Enable Timier1/TCC
   984            C        	RET
   985            C        
   986            C        ;---------------------------------------------------------------
   987            C        SampingRxTiming:
   988            C        	BANK                4
   989            C        	MOV                 A,@0B11110111
   990            C        	MOV                 P9IOCR,A            ; P97-P94:Input; P93:output; P92-P90:Input
   991            C        	BS                  P8IOCR,Leakresis    ; input
   992            C        	BS                  P8IOCR,Reference    ; input
   993            C        	;MOV                 A,P8IOCR
   994            C        	;AND                 A,@0B00111111
   995            C        	;OR                  A,@0B11000000
   996            C        	;MOV                 P8IOCR,A
   997            C        	BANK                0
   998            C        	;BS                  PORT9,LeftYAxis
   999            C        	;BS                  PORT9,LeftXAxis
  1000            C        	;BS                  PORT9,RightYAxis
  1001            C        	BS                  PORT9,RightXAxis    ; Set P93 HIGH
  1002            C        	;BS                  PORT8,Reference    ; Set P87
  1003            C        	;BS                  PORT8,Leakresis    ; Set P86
  1004            C        
  1005            C        	CLR                 IMR                ; Disable Timier1/TCC
  1006            C        ;  if IOtoADC_T_DEBUG ==1
  1007            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1008            C        ;	XOR                 PORT8,A
  1009            C        ;  endif
  1010            C        	BANK                2
  1011            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
  1012            C        	;MOV                 T2PD,A
  1013            C        	BS                  T2CR,T2EN          ; START
  1014            C        	CLR                 IOcheckTimeCNT
  1015            C        	BANK                0
  1016            C        	JBS                 PORT8,Leakresis
  1017            C        	JMP                 $-1
  1018            C        	;MOV                 A,@0B10000001
  1019            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1020            C        ;  if IOtoADC_T_DEBUG ==1
  1021            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1022            C        ;	XOR                 PORT8,A
  1023            C        ;  endif
  1024            C        	BANK                2
  1025            C        	BC                  T2CR,T2EN           ; Disable
  1026            C        	MOV                 A,IOcheckTimeCNT
  1027            C        	MOV                 KEY_RIGHT_X,A
  1028            C        	BANK                0
  1029            C        	MOV                 A,@0B10000001
  1030            C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1031            C        	RET
  1032            C        
  1033            C        ;---------------------------------------------------------------
  1034            C        SampingRyTiming:
  1035            C        	BANK                4
  1036            C        	MOV                 A,@0B11111011
  1037            C        	MOV                 P9IOCR,A            ; P97-P93:Input; P92:output; P91-P90:Input
  1038            C        	BS                  P8IOCR,Leakresis    ; input
  1039            C        	BS                  P8IOCR,Reference    ; input
  1040            C        	;MOV                 A,P8IOCR
  1041            C        	;AND                 A,@0B00111111
  1042            C        	;OR                  A,@0B11000000
  1043            C        	;MOV                 P8IOCR,A
  1044            C        	BANK                0
  1045            C        	;BS                  PORT9,LeftYAxis
  1046            C        	;BS                  PORT9,LeftXAxis
  1047            C        	BS                  PORT9,RightYAxis    ; Set P92 HIGH
  1048            C        	;BS                  PORT9,RightXAxis
  1049            C        	;BS                  PORT8,Reference    ; Set P87
  1050            C        	;BS                  PORT8,Leakresis    ; Set P86
  1051            C        
  1052            C        	CLR                 IMR                ; Disable Timier1/TCC
  1053            C        ;  if IOtoADC_T_DEBUG ==1
  1054            C        ;	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1055            C        ;	XOR                 PORT8,A
  1056            C        ;  endif
  1057            C        	BANK                2
  1058            C        	;MOV                 A,@IOCheckRate     ; N=, Auto reload
  1059            C        	;MOV                 T2PD,A
  1060            C        	BS                  T2CR,T2EN          ; START
  1061            C        	CLR                 IOcheckTimeCNT
  1062            C        	BANK                0
  1063            C        	JBS                 PORT8,Leakresis
  1064            C        	JMP                 $-1
  1065            C        	;MOV                 A,@0B10000001
  1066            C        	;MOV                 IMR,A             ; Enable Timier1/TCC
  1067            C          ;if IOtoADC_T_DEBUG ==1
  1068            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1069            C        	;XOR                 PORT8,A
  1070            C          ;endif
  1071            C        	BANK                2
  1072            C        	BC                  T2CR,T2EN          ; START
  1073            C        	MOV                 A,IOcheckTimeCNT
  1074            C        	MOV                 KEY_RIGHT_Y,A
  1075            C        	;COM                 KEY_RIGHT_Y
  1076            C        	BANK                0
  1077            C        	MOV                 A,@0B10000001
  1078            C        	MOV                 IMR,A             ; Enable Timier1/TCC
  1079            C        	NOP
  1080            C        	RET
  1081            C        
  1082            C        ;=======================================================================
  1083            C        ; input:        ACC
  1084            C        ; output:       ACC
  1085            C        ; registor:     TEMP, TEMP1, TEMP2
  1086            C        ; descripition: Operate io data change to anylize data. Kr=0x80(2^7)
  1087            C        ;=======================================================================
  1088            C        Conversion_Data:
  1089            C        	CLR                 TEMP1
  1090            C        	CLR                 TEMP2
  1091            C          if Kr == 5
  1092            C        	MOV                 TEMP2,A
  1093            C        	BC                  STATUS,C
  1094            C        	RRC                 TEMP2
  1095            C        	RRC                 TEMP1
  1096            C        	MOV                 A,IOcheckRefValue
  1097            C        	MOV                 TEMP,A
  1098            C          elseif Kr == 10
  1099            C        	MOV                 TEMP2,A
  1100            C        	;BC                  STATUS,C
  1101            C        	;RRC                 TEMP2
  1102            C        	;RRC                 TEMP1
  1103            C        	MOV                 A,IOcheckRefValue
  1104            C        	MOV                 TEMP,A
  1105            C          endif
  1106            C        
  1107            C        	mDIV2_1             TEMP2,TEMP1,TEMP
  1108            C        	MOV                 A,TEMP1
  1109            C        	NOP
  1110            C        	RET
  1111            C        
  1112            C        
  1113            C        
  1114            C        ;****************************************************************
  1115            C          elseif RokerSampingType == 2
  1116            C        ;****************************************************************
  1117            C        ;===========================================================
  1118            C        ;file name:     Touch Module 2D Rocker KeyScan
  1119            C        ;INPUT PORT:
  1120            C        ;OUTPUT PORT:   KEY_LEFT_X,KEY_LEFT_Y,KEY_RIGHT_X,KEY_RIGHT_Y
  1121            C        ;TIME:
  1122            C        ;Descrition:    Use for check AD rocker data
  1123            C        ;===========================================================
  1124 01261      C        TP_Rocker_KeyScan:
  1125 01261 1E00 C        	BANK                0
  1126 01262 0C8A C        	JBC                 TP_SPI_TPREQB/8,TP_SPI_TPREQB%8
  1127 01263 0012 C        	RET
  1128 01264 1860 C        	MOV                 A,@0X60
  1129 01265 0044 C        	MOV                 R4,A	
  1130 01266      C          TP_READ_SPI_LOOP:
  1131 01266 1E00 C        	BANK                0
  1132 01267 0000 C        	NOP
  1133 01268 0000 C        	NOP
  1134 01269 0000 C        	NOP
  1135 0126A 0000 C        	NOP
  1136            C        	;BS                  TP_SPI_SS/8,TP_SPI_SS%8
  1137 0126B 0C8A C        	JBC                 TP_SPI_TPREQB/8,TP_SPI_TPREQB%8
  1138 0126C 166B C        	JMP                 $-1               ; Waitting for moment
  1139 0126D 1278 C        	CALL                READ_SPI_REG
  1140 0126E 1E00 C        	BANK                0
  1141            C        	;BC                  TP_SPI_SS/8,TP_SPI_SS%8
  1142 0126F 0404 C        	MOV                 A,R4
  1143 01270 1A0F C        	AND                 A,@0B00001111
  1144 01271 1D0B C        	SUB                 A,@11
  1145 01272 0C03 C        	JBC                 STATUS,C
  1146 01273 1666 C        	JMP                 TP_READ_SPI_LOOP
  1147            C        	;BS                  TP_SPI_SS/8,TP_SPI_SS%8
  1148 01274 12AC C        	CALL                Makeup_TPData
  1149 01275 0000 C        	NOP
  1150 01276 0000 C        	NOP
  1151 01277 0012 C        	RET
  1152            C        
  1153            C        ;===============================================
  1154            C        ; Function: Read SPI Register
  1155            C        ; Input:    R4(Database)
  1156            C        ; Output:   SPIRB
  1157            C        ; description: 4 byte a packet
  1158            C        ;===============================================
  1159 01278      C        READ_SPI_REG:
  1160 01278 1804 C        	MOV                 A,@4              ;
  1161 01279 005A C        	MOV                 Databytelength,A  ;Power-On Synchronizes 4Byte(0X55)
  1162 0127A      C          READ_SIP_LOOP:
  1163 0127A 1E00 C        	BANK                0
  1164 0127B 1805 C        	MOV                 A,@5
  1165 0127C 1EA0 C        	LCALL               DELAY_X10US     ; Wait for TP module deal with
  1165 0127D 042C C        	LCALL               DELAY_X10US     ; Wait for TP module deal with
  1166            C        
  1167 0127E 1E02 C        	BANK                2
  1168 0127F 00CC C        	CLR                 SPIS
  1169 01280 00CE C        	CLR                 SPIR
  1170 01281 00CF C        	CLR                 SPIW            ; Write data to buffer
  1171 01282 0B0D C        	BS                  SPIC, SSE       ; Start to shift data
  1172 01283 0000 C        	NOP
  1173 01284 0D0D C        	JBC                 SPIC, SSE       ; Wait to finish shift data
  1174 01285 1683 C        	JMP                 $-2
  1175 01286 040E C        	MOV                 A,SPIR
  1176 01287 1E00 C        	BANK                0
  1177 01288 0040 C        	MOV                 R0,A
  1178 01289 0544 C        	INC                 R4
  1179 0128A 05DA C        	DJZ                 Databytelength
  1180 0128B 167A C        	JMP                 READ_SIP_LOOP
  1181            C        
  1182 0128C 1805 C        	MOV                 A,@5
  1183 0128D 1EA0 C        	LCALL               DELAY_X10US
  1183 0128E 042C C        	LCALL               DELAY_X10US
  1184 0128F 0000 C        	NOP
  1185 01290 0012 C        	RET
  1186            C        
  1187            C        
  1188            C        ;===============================================
  1189            C        ; Function: TP module initial
  1190            C        ; Input:    none
  1191            C        ; Output:
  1192            C        ;===============================================
  1193 01291      C        TPModule_Ini:
  1194 01291 1E00 C        	BANK                0
  1195            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1196            C        	;XOR                 PORT8,A	
  1197 01292 1803 C        	MOV                 A,@3
  1198 01293 1EA0 C        	LCALL               DELAY_X20MS	
  1198 01294 043E C        	LCALL               DELAY_X20MS	
  1199            C        	;MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
  1200            C        	;XOR                 PORT8,A	
  1201 01295 0BCA C        	BS                  TP_SPI_SS/8,TP_SPI_SS%8  ; TP module sleeclt
  1202 01296 1801 C        	MOV                 A,@1
  1203 01297 1EA0 C        	LCALL               DELAY_X10US	
  1203 01298 042C C        	LCALL               DELAY_X10US	
  1204 01299 0C8A C        	JBC                 TP_SPI_TPREQB/8,TP_SPI_TPREQB%8
  1205 0129A 1699 C        	JMP                 $-1
  1206 0129B 1860 C        	MOV                 A,@0X60
  1207 0129C 0044 C        	MOV                 R4,A
  1208 0129D 1278 C        	CALL                READ_SPI_REG
  1209 0129E 12A5 C        	CALL                Reload_Default_TPData
  1210 0129F 1803 C        	MOV                 A,@3
  1211 012A0 1EA0 C        	LCALL               DELAY_X20MS
  1211 012A1 043E C        	LCALL               DELAY_X20MS
  1212 012A2 0000 C        	NOP
  1213 012A3 0000 C        	NOP
  1214 012A4 0012 C        	RET
  1215            C        
  1216            C        ;---------------------------------------------------------------	
  1217 012A5      C        Reload_Default_TPData:
  1218 012A5 1E02 C        	BANK                2
  1219 012A6 187F C        	MOV                 A,@0X7F
  1220 012A7 0070 C        	MOV                 KEY_LEFT_X,A
  1221 012A8 0071 C        	MOV                 KEY_LEFT_Y,A
  1222 012A9 0072 C        	MOV                 KEY_RIGHT_X,A
  1223 012AA 0073 C        	MOV                 KEY_RIGHT_Y,A
  1224 012AB 0012 C        	RET	
  1225            C        
  1226            C        ;===============================================
  1227            C        ; Function: TP module Data make up to range
  1228            C        ; Input:    none
  1229            C        ; Output:
  1230            C        ;===============================================
  1231 012AC      C        Makeup_TPData:
  1232 012AC 1E00 C        	BANK                0
  1233 012AD 0420 C        	MOV                 A,TPPacket1Byte1
  1234 012AE 1B56 C        	XOR                 A,@0X56
  1235 012AF 0E83 C        	JBS                 STATUS,Z
  1236 012B0 0012 C        	RET
  1237 012B1 0424 C        	MOV                 A,TPPacket2Byte1
  1238 012B2 1B57 C        	XOR                 A,@0X57
  1239 012B3 0E83 C        	JBS                 STATUS,Z
  1240 012B4 0012 C        	RET
  1241 012B5 0428 C        	MOV                 A,TPPacket3Byte1
  1242 012B6 1B59 C        	XOR                 A,@0X59
  1243 012B7 0E83 C        	JBS                 STATUS,Z
  1244 012B8 0012 C        	RET
  1245            C          
  1246 012B9      C          TPdata_Lxy:
  1247 012B9 0E21 C        	JBS                 TPPacket1Byte2,0      ;P1FS
  1248 012BA 16BC C        	JMP                 TPdata_ReloadDef_Lxy	
  1249 012BB 16C1 C        	JMP                 TPdata_Reload_Lxy
  1250 012BC      C          TPdata_ReloadDef_Lxy:
  1251 012BC 1E02 C        	BANK                2
  1252 012BD 187F C        	MOV                 A,@0X7F
  1253 012BE 0070 C        	MOV                 KEY_LEFT_X,A
  1254 012BF 0071 C        	MOV                 KEY_LEFT_Y,A
  1255 012C0 16C8 C        	JMP                 TPdata_Rxy 	
  1256 012C1      C          TPdata_Reload_Lxy:	
  1257 012C1 0425 C        	MOV                 A,TPPacket2Byte2
  1258 012C2 1E02 C        	BANK                2
  1259 012C3 0070 C        	MOV                 KEY_LEFT_X,A
  1260 012C4 1E00 C        	BANK                0
  1261 012C5 04A6 C        	COMA                TPPacket2Byte3
  1262 012C6 1E02 C        	BANK                2
  1263 012C7 0071 C        	MOV                 KEY_LEFT_Y,A
  1264            C            
  1265 012C8      C          TPdata_Rxy:
  1266 012C8 1E00 C        	BANK                0
  1267 012C9 0F21 C        	JBS                 TPPacket1Byte2,4      ;P2FS
  1268 012CA 16CC C        	JMP                 TPdata_ReloadDef_Rxy	
  1269 012CB 16D1 C        	JMP                 TPdata_Reload_Rxy
  1270 012CC      C          TPdata_ReloadDef_Rxy:
  1271 012CC 1E02 C        	BANK                2
  1272 012CD 187F C        	MOV                 A,@0X7F
  1273 012CE 0072 C        	MOV                 KEY_RIGHT_X,A
  1274 012CF 0073 C        	MOV                 KEY_RIGHT_Y,A
  1275 012D0 0012 C        	RET 	
  1276 012D1      C          TPdata_Reload_Rxy:
  1277 012D1 0429 C        	MOV                 A,TPPacket3Byte2
  1278 012D2 1E02 C        	BANK                2
  1279 012D3 0072 C        	MOV                 KEY_RIGHT_X,A
  1280 012D4 1E00 C        	BANK                0
  1281 012D5 04AA C        	COMA                TPPacket3Byte3
  1282 012D6 1E02 C        	BANK                2
  1283 012D7 0073 C        	MOV                 KEY_RIGHT_Y,A
  1284 012D8 0000 C        	NOP
  1285 012D9 0000 C        	NOP
  1286 012DA 0012 C        	RET
  1287            C        
  1288            C          endif
    17            C        
    18            C        ;-----------------------------------------------------------------------
    19            C        
    20            C        
    21            C        	ORG                 0x0400    ;PAGE 1
    22            C        	MESSAGE "define 'uartcomu.asm' ROM address"
***     USER MESSAGE: DEFINE 'UARTCOMU.ASM' ROM ADDRESS
    23 00400      C        Uart_Commucation:
    24 00400 0000 C        	NOP
    25 00401 1E02 C        	BANK                2
    26 00402 0F5E C        	JBS                 System8msFlag/8,System8msFlag%8
    27 00403 140E C        	JMP                 Uart_Transmit
    28 00404 095E C        	BC                  System8msFlag/8,System8msFlag%8
    29 00405 056E C        	INC                 KeySystemTimeCNT
    30 00406 056C C        	INC                 ComSystemTimeCNT
    31 00407 042E C        	MOV                 A,KeySystemTimeCNT
    32 00408 1D00 C        	SUB                 A,@KeyScanTimeCtrl
    33 00409 0C03 C        	JBC                 STATUS,C
    34 0040A 140E C        	JMP                 Uart_Transmit
    35 0040B 00EE C        	CLR                 KeySystemTimeCNT
    36 0040C 1EA0 C        	LCALL               Key_Scan
    36 0040D 10B0 C        	LCALL               Key_Scan
    37            C        
    38            C          if COM_T_DEBUG == 1
    39            C        	BANK                0
    40            C        	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    41            C        	XOR                 PORT8,A
    42            C          endif
    43            C        
    44            C        ;----------------------------------------------------------------------
    45 0040E      C          Uart_Transmit:
    46            C          if COM_DEBUG == 1
    47 0040E 042C C        	MOV                 A,ComSystemTimeCNT
    48 0040F 1D00 C        	SUB                 A,@UartTimeCtrl
    49 00410 0C03 C        	JBC                 STATUS,C
    50 00411 0012 C        	RET
    51 00412 00EC C        	CLR                 ComSystemTimeCNT
    52            C          endif
    53            C        
    54            C          if COM_T_DEBUG == 1
    55            C        	BANK                0
    56            C        	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
    57            C        	XOR                 PORT8,A
    58            C          endif
    59            C        
    60 00413 1E02 C        	BANK                2
    61 00414 18A1 C        	MOV                 A,@0XA1
    62 00415 0060 C        	MOV                 HeaderFrameData,A      ; airui UART data header frame
    63 00416 1E00 C        	BANK                0
    64 00417 18E0 C        	MOV                 A,@0XE0
    65 00418 0044 C        	MOV                 R4,A
    66 00419      C          Uart_Transmit_Loop:
    67 00419 1E02 C        	BANK                2
    68 0041A 0400 C        	MOV                 A,R0
    69 0041B 1E03 C        	BANK                3
    70 0041C 0A05 C        	BS                  URC,TXE        ; Enable transmission
    71 0041D 0000 C        	NOP
    72 0041E 0000 C        	NOP
    73 0041F 0000 C        	NOP
    74 00420 0048 C        	MOV                 URTD,A
    75 00421 0000 C        	NOP
    76 00422 0544 C        	INC                 R4
    77 00423 0E45 C        	JBS                 URC,UTBE
    78 00424 1423 C        	JMP                 $-1
    79 00425 0404 C        	MOV                 A,R4
    80 00426 1DE7 C        	SUB                 A,@0XE7        ; Uart Data, bank2: 0X20-0X27
    81 00427 0C03 C        	JBC                 STATUS,C
    82 00428 1419 C        	JMP                 Uart_Transmit_Loop
    83            C        
    84            C        	;MOV                 A,@2
    85            C        	;CALL                DELAY_X20MS   ; delay(debug com)
    86            C        	
    87 00429 0000 C        	NOP
    88 0042A 0000 C        	NOP
    89 0042B 0012 C        	RET
    90            C        
    91            C        
    92            C        ;===============================================
    93            C        ; Function: Delay 20us
    94            C        ; Input:    None
    95            C        ; Output:   None
    96            C        ; Crystal:  8MHz
    97            C        ;===============================================
    98 0042C      C        DELAY_X10US:
    99 0042C 0051 C        	MOV                 TEMP1,A
   100 0042D      C          Delay_Loop_X10US:
   101 0042D 1812 C        	MOV                 A,@18      ;
   102 0042E 0052 C        	MOV                 TEMP2,A
   103 0042F      C          Waiting_X10US:
   104 0042F 05D2 C        	DJZ                 TEMP2
   105 00430 142F C        	JMP                 Waiting_X10US
   106 00431 05D1 C        	DJZ                 TEMP1
   107 00432 142D C        	JMP                 Delay_Loop_X10US
   108 00433 0012 C        	RET
   109 00434 0000 C        	NOP
   110            C        
   111            C        ;===============================================
   112            C        ; Function: Delay 100us
   113            C        ; Input:    None
   114            C        ; Output:   None
   115            C        ; Crystal:  8MHz
   116            C        ;===============================================
   117 00435      C        DELAY_X100US:
   118 00435 0051 C        	MOV                 TEMP1,A
   119 00436      C          Delay_Loop:
   120 00436 18C4 C        	MOV                 A,@196     ;
   121 00437 0052 C        	MOV                 TEMP2,A
   122 00438      C          Waiting:
   123 00438 05D2 C        	DJZ                 TEMP2
   124 00439 1438 C        	JMP                 Waiting
   125 0043A 05D1 C        	DJZ                 TEMP1
   126 0043B 1436 C        	JMP                 Delay_Loop
   127 0043C 0012 C        	RET
   128 0043D 0000 C        	NOP
   129            C        
   130            C        ;===============================================
   131            C        ; Function: Delay
   132            C        ; Input:    ACC
   133            C        ; Output:   None
   134            C        ; Crystal:  8MHz
   135            C        ;===============================================
   136 0043E      C        DELAY_X20MS:
   137 0043E 0052 C        	MOV                 TEMP2, A
   138 0043F      C          Delay1:
   139 0043F 18C8 C        	MOV                 A,@200
   140 00440 0051 C        	MOV                 TEMP1, A
   141 00441      C          Delay2:
   142 00441 18C6 C        	MOV                 A,@198
   143 00442 0050 C        	MOV                 TEMP,A
   144 00443 05D0 C        	DJZ                 TEMP
   145 00444 1443 C        	JMP                 $-1
   146 00445 05D1 C        	DJZ                 TEMP1
   147 00446 1441 C        	JMP                 Delay2
   148 00447 05D2 C        	DJZ                 TEMP2
   149 00448 143F C        	JMP                 Delay1
   150 00449 0012 C        	RET
    19                     
    20                     ;-----------------------------------------------------------------
    21                     
    22                     
    23                     
    24                     ;=================== MAIN PROGRAM =================================
    25                     	ORG                 0X00
    26 00000 1EB0          	LJMP                INITIAL
    26 00001 0116          	LJMP                INITIAL
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    27                     	ORG                 0X03
    28 00003 1EB0          	LJMP                TCC_INT
    28 00004 0100          	LJMP                TCC_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    29                     	ORG                 0X06
    30 00006 1EB0          	LJMP                EXTERNAL_INT
    30 00007 0106          	LJMP                EXTERNAL_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    31                     	ORG                 0X09
    32 00009 1EB0          	LJMP                WDT_INT
    32 0000A 0109          	LJMP                WDT_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    33                     	ORG                 0X0C
    34 0000C 1EB0          	LJMP                TIMER1_INT
    34 0000D 010B          	LJMP                TIMER1_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    35                     	ORG                 0X0F
    36 0000F 1EB0          	LJMP                TIMER2_INT
    36 00010 010E          	LJMP                TIMER2_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    37                     	ORG                 0X12
    38 00012 1EB0          	LJMP                AD_INT
    38 00013 010A          	LJMP                AD_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    39                     	ORG                 0X15
    40 00015 1EB0          	LJMP                UART_INT
    40 00016 0113          	LJMP                UART_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    41                     	ORG                 0X18
    42 00018 1EB0          	LJMP                SPI_INT
    42 00019 0114          	LJMP                SPI_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    43                     	ORG                 0X1B
    44 0001B 1EB0          	LJMP                LVD_INT
    44 0001C 0115          	LJMP                LVD_INT
***     Warning A053: The target address of 'lcall' or 'ljmp' instruction is not over page (1K).
    45                     
    46                     
    47                     	ORG                 0X100
    48                     ;========================= TCC Interrupt Service ==================================
    49 00100               TCC_INT:
    50 00100 1E00          	BANK                0
    51 00101 080F          	BC                  ISR,TCIF               ;clear TCC interrupt flag
    52                     	;MOV                 A,@0B00001101        ; N=4,P=64,f=32.768K ==> T=8ms
    53                     	;MOV                 TWTCR,A
    54 00102 18FC          	MOV                 A,@(256-4)           ; reload initial value
    55 00103 0041          	MOV                 TCC,A
    56 00104 0B5E          	BS                  System8msFlag/8,System8msFlag%8
    57                     	;BANK                0
    58                     	;MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    59                     	;XOR                 PORT8,A
    60 00105 0013          	RETI
    61                     
    62 00106               EXTERNAL_INT:
    63 00106 1E01          	BANK                1
    64 00107 00CF          	CLR                 EISR               ;clear the external interrupt flag
    65 00108 0013          	RETI
    66                     
    67 00109               WDT_INT:
    68 00109 0013          	RETI
    69                     
    70 0010A               AD_INT:
    71 0010A 0013          	RETI
    72                     
    73 0010B               TIMER1_INT:
    74 0010B 1E00          	BANK                0
    75 0010C 09CF          	BC                  ISR,T1IF               ; clear Timer1 interrupt flag
    76 0010D 0013          	RETI
    77                     
    78 0010E               TIMER2_INT:
    79 0010E 1E02          	BANK                2
    80 0010F 09C9          	BC                  T2CR,T2IF              ; clear Timer2 interrupt flag
    81 00110 056D          	INC                 IOcheckTimeCNT
    82 00111 1E00          	BANK                0
    83                       if TIMER2_T_DEBUG == 1
    84                     	MOV                 A,@0B00100000          ; (test)P85 exchange when intrrupt
    85                     	XOR                 PORT8,A
    86                       endif
    87 00112 0013          	RETI
    88 00113               UART_INT:
    89 00113 0013          	RETI
    90 00114               SPI_INT:
    91 00114 0013          	RETI
    92 00115               LVD_INT:
    93 00115 0013          	RETI
    94                     
    95                     
    96                     ;=======================================================================
    97                     ;============================ Begin Program ============================
    98 00116               INITIAL:
    99 00116 0000          	NOP
   100 00117 0000          	NOP
   101 00118 0000          	NOP
   102 00119 0000          	NOP
   103 0011A 0000          	NOP
   104 0011B 0000          	NOP
   105 0011C 0000          	NOP
   106 0011D 0000          	NOP
   107 0011E 0000          	NOP
   108 0011F 0011          	DISI
   109 00120 0000          	NOP
   110 00121 0000          	NOP
   111 00122 0000          	NOP
   112 00123 0011          	DISI
   113 00124 0000          	NOP
   114 00125 0000          	NOP
   115 00126 0000          	NOP
   116 00127 0011          	DISI
   117 00128 0000          	NOP
   118 00129 0004          	WDTC
   119                   M 	ClrCommRamBank
       0012A 1810     1     MOV A,@( 16 )
       0012B 0044     1     MOV  R4 ,A
       0012C 0004     1     WDTC 
       0012D 00C0     1     CLR  R0 ,
       0012E 0544     1     INC  R4 ,
       0012F 183F     1     MOV A,@( 63 )
       00130 0284     1     AND A, R4 
       00131 1D1F     1     SUB A,@( 31 )
       00132 0C03     1     JBC  R3 , C 
       00133 152C     1     JMP ( $ - 7 ),
       00134 00C4     1     CLR  R4 ,
   120                   M 	ClrRamBank
       00135 00C5     1     CLR  5 ,
       00136 18D0     1     MOV A,@( 208 )
       00137 0044     1     MOV  4 ,A
       00138 00C0     1     CLR  0 ,
       00139 0544     1     INC  4 ,
       0013A 0404     1     MOV A, 4 
       0013B 1A3F     1     AND A,@( 63 )
       0013C 0E83     1     JBS  3 , 2 
       0013D 1538     1     JMP ( $ - 5 ),
       0013E 0984     1     BC  4 , 6 
       0013F 0545     1     INC  5 ,
       00140 0B44     1     BS  4 , 5 
       00141 1807     1     MOV A,@( 7 )
       00142 02C5     1     AND  5 ,A
       00143 0B84     1     BS  4 , 6 
       00144 0E83     1     JBS  3 , 2 
       00145 1538     1     JMP ( $ - 13 ),
       00146 00C4     1     CLR  4 ,
       00147 0B84     1     BS  4 , 6 
   121 00148 1166          	CALL                IO_INITIAL	
   122 00149 1E00          	BANK                0
   123 0014A 1808          	MOV                 A,@0B00001000          ; (test)P83 exchange when intrrupt
   124 0014B 0348          	XOR                 PORT8,A	
   125 0014C 1EA0          	LCALL               Key_Scan     ;initial keyscan
   125 0014D 10B0          	LCALL               Key_Scan     ;initial keyscan
   126 0014E 0000          	NOP
   127 0014F 0000          	NOP
   128                     	
   129 00150 1E00          	BANK                0
   130 00151 00CF          	CLR                 ISR
   131 00152 09C9          	BC                  T2CR,T2IF        ; Clear timer1 intrrupt flag
   132 00153 0010          	ENI
   133 00154 0000          	NOP
   134                     
   135 00155 1E00          	BANK                0
   136 00156 0A48          	BS                  LED1_STATUS/8,LED1_STATUS%8		     ; PORT81,LED
   137 00157 00DC          	CLR                 SleepCNT
   138 00158 00DF          	CLR                 CommuStatusFlag
   139 00159 00DD          	CLR                 GeneralStatusFlag1
   140                     	;CLR                 GeneralStatusFlag2
   141                     
   142 0015A 1E02          	BANK                2
   143 0015B 00EE          	CLR                 KeySystemTimeCNT
   144 0015C 18FF          	MOV                 A,@0XFF
   145 0015D 0076          	MOV                 KeystokeFlag_Befor,A
   146 0015E 0077          	MOV                 KeystokeTimeCNT,A
   147 0015F 0000          	NOP
   148                     
   149                     ;=============================================================================
   150 00160               MAIN:
   151                     	;LCALL  Key_Scan
   152                     	;NOP
   153                     	;JMP    MAIN
   154                     ;-----------------------------------------------------------------
   155 00160 1EA0          	LCALL               Uart_Commucation
   155 00161 0400          	LCALL               Uart_Commucation
   156                     
   157                     
   158                     ;-------------------- test ----------------------
   159                     	;BANK                0
   160                     	;MOV                 A,@0B00000000
   161                     	;MOV                 IMR,A             ; Disable Timier1/TCC
   162                     	;BANK                2
   163                     	;BS                  T2CR,T2EN          ; START
   164                     
   165                     	;LCALL               IO_Rocker_KeyScan
   166                     ;-----------------------------------------------------
   167                     
   168 00162 0000          	NOP
   169 00163 0000          	NOP
   170 00164 0000          	NOP
   171 00165 1560          	JMP                 MAIN
   172                     
   173                     
   174                     ;*****************************************************************
   175                     ;Function:    IO INITIAL SET
   176                     ;Input:       None
   177                     ;Output:      None
   178                     ;*****************************************************************
   179 00166               IO_INITIAL:
   180                     ;============================ TCC config ====================================
   181 00166 1E00          	BANK                0
   182 00167 180D          	MOV                 A,@0B00001101        ; N=4,P=64,f=32.768K ==> T=8ms
   183 00168 004D          	MOV                 TWTCR,A
   184 00169 18FC          	MOV                 A,@(256-4)    ; load initial value
   185 0016A 0041          	MOV                 TCC,A
   186 0016B 0A0E          	BS                  IMR,TCIE        ; set   TCIE=1  tcc enable interrupt
   187 0016C 00CF          	CLR                 ISR             ; clear interrupt flag
   188 0016D 1E01          	BANK                1
   189 0016E 00CF          	CLR                 EISR            ; Clear External Interrupt Status Register
   190 0016F 00CE          	CLR                 EIMR            ; Clear External Interrupt Mask  Register
   191                     
   192                     ;============================ Timer 1 config ===================================
   193 00170 1E00          	BANK                0
   194 00171 09CE          	BC                  IMR,T1IE         ; Disable Timier1
   195 00172 09CF          	BC                  ISR,T1IF         ; Clear timer1 intrrupt flag
   196 00173 1E02          	BANK                2
   197 00174 1807          	MOV                 A,@0B00000111    ; N=255, P=128, T=1s
   198 00175 0045          	MOV                 T1CR,A
   199 00176 18FF          	MOV                 A,@255           ; N=255, Auto reload
   200 00177 0047          	MOV                 T1PD,A
   201 00178 1814          	MOV                 A,@0B00010100    ; 8 bit counter, f=32.768KHz
   202 00179 0046          	MOV                 TSR,A
   203 0017A 0885          	BC                  T1CR,T1EN       ; Disable
   204                     
   205                     ;============================ Timer 2 config ===================================
   206 0017B 1E00          	BANK                0
   207 0017C 0B89          	BS                  T2CR,T2IE        ; Enable Timier2
   208 0017D 09C9          	BC                  T2CR,T2IF        ; Clear timer1 intrrupt flag
   209 0017E 1E02          	BANK                2
   210 0017F 1843          	MOV                 A,@0B01000011    ; N=2, P=16, T=4us
   211 00180 0249          	OR                  T2CR,A
   212 00181 1803          	MOV                 A,@IOCheckRate   ; N=, Auto reload
   213 00182 004A          	MOV                 T2PD,A
   214 00183 08C6          	BC                  TSR,T2CSS       ; Set Timer2 Clock Source f=8MHz
   215 00184 09C6          	BC                  TSR,T1MOD       ; Set 8 Bit Timer
   216 00185 0949          	BC                  T2CR,T2EN       ; Disable
   217                     
   218                     ;==========================PORT 7/8/9 INITIAL===============================
   219 00186 1E01          	BANK                1
   220 00187 1800          	MOV                 A,@0B00000000	;Disable LCD common dirver pin
   221 00188 004A          	MOV                 LCDSCR0,A
   222 00189 004B          	MOV                 LCDSCR1,A
   223 0018A 004C          	MOV                 LCDSCR2,A
   224 0018B 1E06          	BANK                6
   225 0018C 00C7          	CLR                 P7ODCR          ;Disable Open Drain
   226 0018D 00C8          	CLR                 P8ODCR
   227 0018E 00C9          	CLR                 P9ODCR
   228 0018F 1E00          	BANK                0
   229 00190 00C7          	CLR                 PORT7           ; Port7 output logic "0"
   230 00191 00C8          	CLR                 PORT8           ; Port8 output logic "0"
   231 00192 00C9          	CLR                 PORT9
   232 00193 1E04          	BANK                4
   233 00194 1800          	MOV                 A,@0B00000000
   234 00195 0047          	MOV                 IOC7,A          ;Set Output
   235 00196 1800          	MOV                 A,@0B00000000
   236 00197 0048          	MOV                 IOC8,A          ;Set Output
   237 00198 18F0          	MOV                 A,@0B11110000
   238 00199 0049          	MOV                 IOC9,A          ;P97-P94:Input; P93-P90:Output
   239 0019A 1E05          	BANK                5
   240 0019B 1800          	MOV                 A,@0B00000000
   241 0019C 0047          	MOV                 P7PHCR,A		;Disable PULL UP
   242 0019D 1800          	MOV                 A,@0B00000000
   243 0019E 0048          	MOV                 P8PHCR,A		;Disable PULL UP
   244 0019F 18F0          	MOV                 A,@0B11110000
   245 001A0 0049          	MOV                 P9PHCR,A		;SET PULL UP
   246                     
   247                     ;==============================PORT A/B======================================
   248 001A1 1E00          	BANK                0
   249 001A2 1840          	MOV                 A,@01000000B
   250 001A3 004A          	MOV                 PORTA,A         ; PortA output logic "0",SCK output high
   251 001A4 1830          	MOV                 A,@00110000B
   252 001A5 004B          	MOV                 PORTB,A         ; PortB output logic "0"
   253 001A6 1E04          	BANK                4
   254 001A7 1814          	MOV                 A,@00010100B    ; PA As output
   255 001A8 004A          	MOV                 PAIOCR,A        ;
   256 001A9 180F          	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 As Input
   257 001AA 004B          	MOV                 PBIOCR,A       	;
   258 001AB 1E05          	BANK                5
   259 001AC 1814          	MOV                 A,@00010100B    ; Disable PA Pull High
   260 001AD 004A          	MOV                 PAPHCR,A        ;
   261 001AE 180F          	MOV                 A,@00001111B    ; PB0 PB1 PB2 PB3 Enable Pull High
   262 001AF 004B          	MOV                 PBPHCR,A        ;
   263                     
   264                     
   265                     ;------------------------------------------------------------------
   266 001B0 1E03          	BANK                3
   267 001B1 1820          	MOV                 A,@0B00100000   ; 8-Bit Mode,Fc=8MHz,Baud=38400
   268 001B2 0045          	MOV                 URC,A           ; Disable TXE
   269 001B3 1800          	MOV                 A,@0B00000000
   270 001B4 0046          	MOV                 URS,A           ; disable parity, Odd parity
   271 001B5 1E05          	BANK                5
   272 001B6 1820          	MOV                 A,@0B00100000   ; Enable uart function
   273 001B7 0046          	MOV                 UARC2,A
   274 001B8 0000          	NOP
   275 001B9 0012          	RET
   276                     
  0 Error(s), 10 Warning(s), 2 User Message(s)